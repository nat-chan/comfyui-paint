{"mappings":"IyI4BI,EAAI,E8FpBJ,EACA,E6DPO,ED6BP,EuB7BA,E,InOmBuC,EACrC,EAYA,EkEmBD,E,E4ErDL,E,E,A,a,O,W,W,A,a,O,K,K,A,a,O,O,O,A,a,O,O,O,C,E,S,E,C,C,C,C,C,C,C,E,O,c,C,E,E,C,I,E,I,E,W,C,E,a,C,C,E,C,S,E,C,E,O,G,E,U,C,E,O,C,C,C,I,E,C,E,E,C,E,E,E,iB,A,O,I,A,C,E,S,C,E,G,K,E,O,C,C,E,C,O,C,G,K,E,C,I,E,C,C,E,A,Q,C,C,E,C,I,E,C,G,E,Q,C,C,E,O,C,C,E,C,E,E,I,C,E,O,C,E,E,O,E,E,O,A,C,I,E,A,M,uB,E,I,O,E,I,C,mB,C,C,E,Q,C,S,C,C,C,E,C,C,E,C,C,E,E,iB,C,G,I,E,E,Q,CrMyGA,G,E,Q,S,C,C,C,E/BzGA,EAAA,OAAA,CAAkB,AAAA,EAAA,SAA6C,AAAA,EAAA,SAAA,OAAA,CAA6C,UAAW,IAAI,CAAC,IAAM,EAAc,S,G,E,Q,S,C,C,C,E,I,E,E,QCGhJ,CAAA,EAAA,OAAA,CAAiB,EAAY,SAAU,CAAM,EAC3C,OAAO,IAAI,QAAQ,SAAU,CAAO,CAAE,CAAM,EAE1C,IAAI,EAAa,IAAI,MAAM,CAAC,AAAC,CAAA,GAAK,KAAK,MAAM,EAAA,EAAI,KAAK,CAAC,GACvD,CAAA,CAAM,CAAC,EAAW,CAAG,SAAU,CAAC,EAC9B,EAAQ,GACR,GACF,EAGA,IAAI,EAAU,WACZ,OAAO,CAAM,CAAC,EAAW,CACzB,EAAO,OAAO,CAAG,KACjB,EAAO,MAAM,EACf,EAGI,EAAS,SAAS,aAAa,CAAC,SACpC,CAAA,EAAO,KAAK,CAAG,CAAA,EACf,EAAO,IAAI,CAAG,SACd,EAAO,OAAO,CAAG,QACjB,EAAO,WAAW,CAAG,uBAAuB,MAAM,CAAC,EAAQ,OAAO,MAAM,CAAC,EAAY,QACrF,EAAO,OAAO,CAAG,SAAU,CAAC,EAC1B,EAAO,GACP,GACF,EACA,SAAS,IAAI,CAAC,WAAW,CAAC,EAC5B,EACF,E,G,E,Q,S,C,C,C,EC7BA,IAAI,EAAgB,CAAC,EACjB,EAAiB,CAAC,EAClB,EAAmB,CAAC,CAWx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,cAAc,CAAC,GAG1C,CAAA,IAAI,CAAC,GAAG,EACV,EAEA,EAAO,KAAK,CAAG,WAEb,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,SAAU,CAAG,EAC7B,OAAO,EAAI,UAAU,EAAI,EAAI,UAAU,CAAC,WAAW,CAAC,EACtD,GACA,IAAI,CAAC,IAAI,CAAG,EAAE,CACd,IAAI,CAAC,GAAG,CAAG,CAKb,EAEO,CACT,G,G,E,Q,S,C,C,C,E,E,E,O,C,K,W,O,C,G,E,E,O,C,M,W,O,C,G,E,E,O,C,S,W,O,C,G,E,E,O,C,U,W,O,C,G,E,E,O,C,c,W,O,C,G,E,E,O,C,Y,W,O,C,G,E,E,O,C,O,W,O,C,G,E,E,O,C,O,W,O,C,G,E,E,O,C,S,W,O,C,G,E,E,O,C,Q,W,O,C,G,E,E,O,C,U,W,O,C,G,E,E,O,C,U,W,O,C,G,E,E,O,C,S,W,O,C,G,E,E,O,C,U,W,O,C,G,E,E,O,C,W,W,O,C,G,E,E,O,C,O,W,O,C,G,E,E,O,C,O,W,O,C,G,E,E,O,C,O,W,O,C,G,E,E,O,C,Q,W,O,C,G,E,E,O,C,Q,W,O,C,G,E,E,O,C,Q,W,O,C,G,E,E,O,C,U,W,O,C,G,E,E,O,C,U,W,O,C,G,E,E,O,C,U,W,O,C,G,E,E,O,C,Y,W,O,C,G,E,E,O,C,Y,W,O,C,G,E,E,O,C,a,W,O,C,G,E,E,O,C,Y,W,O,C,GEvJU,IAAC0L,EAAK,OACLD,EAAM,QACND,EAAS,WAETo0H,EAAU,OACV3zH,EAAU,OACVZ,EAAc,OAUdS,EAAY,aCZZsF,EAAM9N,KAAK8N,GAAAA,CAMXpH,EAAOqH,OAAOC,YAAAA,CAMdE,EAASjQ,OAAOiQ,MAAAA,CAOpB,SAASjG,EAAMzG,CAAAA,CAAOqC,CAAAA,EAC5B,OAAOyE,AAAmB,GAAnBA,EAAO9G,EAAO,GAAK,AAAA,CAAA,AAAYqC,CAAAA,AAAAA,CAAAA,GAAU,EAAKyE,EAAO9G,EAAO,EAAA,GAAO,EAAK8G,EAAO9G,EAAO,EAAA,GAAO,EAAK8G,EAAO9G,EAAO,EAAA,GAAO,EAAK8G,EAAO9G,EAAO,GAAK,CAAA,CAgBhJ,SAASqH,EAAOrH,CAAAA,CAAOm+C,CAAAA,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,IAAI,IAAI,EAAE,IAAI,IAAI,GAAG,IAAI,GAAG,GAAG,IAAI,EAAE,GAAG,GAAG,IAAI,GAAG,GAAG,GACzE,IAAK,EAAE,IAAI,IAAI,IAAI,IAAI,GAAG,EAAE,GAAG,IAAI,GAAG,GAAG,IAAI,IAAI,IAAI,IAAI,GAAG,GAAG,GAAG,GAAG,IAAI,GACzE,GAAG,IAAI,IAAI,GAAG,GAAG,IAAI,GAAG,IAAI,IAAI,IAAI,IAAK,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,IAAI,GAAG,GAAG,IACxE,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,IACxE,IAAI,IAAI,GAAI,GAAG,GAAG,GAAG,IAAK,EAAE,IAAI,GAAG,GAAG,IAAI,GAAG,IAAI,IAAI,IAAK,GAAG,GAAG,IAAI,IAAI,IACxE,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,IAAI,IAAI,IAAK,EAAE,GAAG,GAAG,IAAI,IAAI,IAAI,IAAI,IACxE,EAAE,IAAI,GAAG,IAAI,IAAI,IAAI,IAAI,GAAG,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,GAAG,GAAG,GAAG,GAAG,IAAI,IAAI,GAAG,GACzE,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAK,EAAE,GAAG,IAAI,IAAK,GAAG,IAAI,IAAI,IAAI,IAAI,IAAK,GAAG,IAAI,EAC1E,IAAI,GAAG,GAAG,IAAK,GAAG,GAAG,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,IAAI,IAAK,IAAI,IAAI,IAAI,IAAI,GAAG,IACxE,IAAI,GAAG,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,IAAK,GAAG,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,IACxE,GAAG,IAAI,IAAK,GAAG,IAAI,IAAI,IAAI,IAAI,IAAK,GAAG,IAAI,IAAI,IAAI,IAAI,GAAG,GAAG,IAAK,EAAE,IAAI,IACxE,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,GAAG,GAAG,GAAG,GAAG,IAAI,IAAI,IAAI,IAA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","sources":["<anon>","node_modules/@parcel/runtime-js/lib/runtime-1001b4abe11f03bc.js","node_modules/@parcel/runtime-js/lib/helpers/browser/import-polyfill.js","node_modules/@parcel/runtime-js/lib/helpers/cacheLoader.js","node_modules/@parcel/runtime-js/lib/runtime-dca89d4fc9e8abbf.js","node_modules/@parcel/runtime-js/lib/runtime-ce96498435744e75.js","node_modules/@parcel/runtime-js/lib/runtime-cdbd683e8fc633da.js","node_modules/@parcel/runtime-js/lib/runtime-e3a7f017ccd74b2e.js","node_modules/@parcel/runtime-js/lib/runtime-8d58b853539c3850.js","node_modules/@parcel/runtime-js/lib/runtime-a2f0be8a9f9d9a96.js","node_modules/@emotion/css/dist/emotion-css.cjs.prod.js","node_modules/@emotion/css/create-instance/dist/emotion-css-create-instance.cjs.prod.js","node_modules/@emotion/cache/dist/emotion-cache.browser.esm.js","node_modules/@emotion/sheet/dist/emotion-sheet.browser.esm.js","node_modules/stylis/dist/stylis.mjs","node_modules/stylis/src/Enum.js","node_modules/stylis/src/Utility.js","node_modules/stylis/src/Tokenizer.js","node_modules/stylis/src/Parser.js","node_modules/stylis/src/Prefixer.js","node_modules/stylis/src/Serializer.js","node_modules/stylis/src/Middleware.js","node_modules/@emotion/weak-memoize/dist/emotion-weak-memoize.esm.js","node_modules/@emotion/memoize/dist/emotion-memoize.esm.js","node_modules/@emotion/serialize/dist/emotion-serialize.browser.esm.js","node_modules/@emotion/hash/dist/emotion-hash.esm.js","node_modules/@emotion/unitless/dist/emotion-unitless.esm.js","node_modules/@emotion/utils/dist/emotion-utils.browser.esm.js","node_modules/@parcel/runtime-js/lib/runtime-4678dcfe442f55b0.js","node_modules/@parcel/runtime-js/lib/runtime-cfed9128d2971b35.js","node_modules/@parcel/runtime-js/lib/runtime-3cb8ab01a22ab753.js","src/app/script/main-standalone.ts","src/app/script/polyfills/polyfills.ts","src/app/script/polyfills/polyfills-nomodule.ts","node_modules/mdn-polyfills/Node.prototype.append.js","node_modules/mdn-polyfills/Node.prototype.prepend.js","node_modules/mdn-polyfills/String.prototype.padStart.js","node_modules/mdn-polyfills/Array.prototype.findIndex.js","src/app/script/klecks/kl.ts","src/app/script/klecks/history/kl-history.ts","src/app/script/bb/base/base.ts","src/app/script/klecks/ui/modals/base/showModal.ts","src/app/script/klecks/ui/modals/modal-count.ts","src/app/script/bb/bb.ts","src/app/script/bb/base/browser.ts","src/app/script/bb/input/key-listener.ts","src/app/script/bb/input/pointer-listener.ts","src/app/script/bb/input/wheel-cleaner.ts","src/app/script/bb/input/pressure-normalizer.ts","src/app/script/bb/math/math.ts","src/app/script/bb/base/canvas.ts","src/app/script/bb/base/create-canvas.ts","src/app/script/bb/math/matrix.ts","src/app/script/bb/math/vec2.ts","src/app/script/bb/math/line.ts","src/app/script/bb/color/color.ts","src/app/script/bb/base/ui.ts","src/app/script/bb/base/bb-log.ts","src/app/script/bb/base/local-storage.ts","src/app/script/bb/input/event-chain/coalesced-exploder.ts","src/app/script/bb/input/event-chain/n-finger-tapper.ts","src/app/script/bb/input/event-chain/pinch-zoomer.ts","src/app/script/bb/input/event-chain/double-tapper.ts","src/app/script/bb/input/event-chain/one-pointer-limiter.ts","src/app/script/bb/input/event-chain/event-chain.ts","src/app/script/language/language.ts","src/app/languages/languages.ts","src/app/languages/en.json","src/app/script/klecks/ui/modals/base/scroll-fix.ts","node_modules/@parcel/runtime-js/lib/runtime-3d959721d9a5ffab.js","node_modules/@parcel/runtime-js/lib/runtime-061b21c791e2eab5.js","src/app/script/klecks/ui/modals/base/dynamic-modal.ts","src/app/script/klecks/ui/components/checkbox.ts","src/app/script/klecks/ui/components/input.ts","src/app/script/klecks/ui/components/select.ts","src/app/script/klecks/ui/components/image-toggle.ts","src/app/script/klecks/ui/components/image-radio-list.ts","src/app/script/klecks/ui/components/create-pen-pressure-toggle.ts","node_modules/@parcel/runtime-js/lib/runtime-21061b2360aa86de.js","src/app/script/klecks/ui/components/box-toggle.ts","src/app/script/klecks/ui/components/kl-slider.ts","src/app/script/klecks/ui/components/slider-falloff.ts","src/app/script/klecks/ui/components/kl-slider-manual-input.ts","src/app/script/klecks/ui/modals/color-slider-hex-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-95eaae534e7050a1.js","src/app/script/bb/base/c.ts","node_modules/@emotion/css/dist/emotion-css.esm.js","node_modules/@emotion/css/create-instance/dist/emotion-css-create-instance.esm.js","src/app/script/klecks/ui/components/kl-color-slider.ts","node_modules/@parcel/runtime-js/lib/runtime-740911d19d370a2c.js","src/app/script/klecks/brushes/erase-color.ts","src/app/script/theme/theme.ts","src/app/script/klecks/ui/components/kl-color-slider-small.ts","src/app/script/klecks/ui/components/point-slider.ts","src/app/script/klecks/ui/components/color-options.ts","src/app/script/klecks/ui/components/options.ts","src/app/script/klecks/ui/components/status-overlay.ts","node_modules/@parcel/runtime-js/lib/runtime-f40232a4f7ea07e6.js","src/app/script/klecks/ui/components/crop-copy.ts","src/app/script/klecks/ui/project-viewport/preview.ts","src/app/script/klecks/ui/project-viewport/project-viewport.ts","node_modules/transformation-matrix/src/index.js","node_modules/transformation-matrix/src/applyToPoint.js","node_modules/transformation-matrix/src/fromObject.js","node_modules/transformation-matrix/src/fromString.js","node_modules/transformation-matrix/src/identity.js","node_modules/transformation-matrix/src/inverse.js","node_modules/transformation-matrix/src/isAffineMatrix.js","node_modules/transformation-matrix/src/utils.js","node_modules/transformation-matrix/src/rotate.js","node_modules/transformation-matrix/src/translate.js","node_modules/transformation-matrix/src/transform.js","node_modules/transformation-matrix/src/scale.js","node_modules/transformation-matrix/src/shear.js","node_modules/transformation-matrix/src/skew.js","node_modules/transformation-matrix/src/toString.js","node_modules/transformation-matrix/src/fromTriangles.js","node_modules/transformation-matrix/src/smoothMatrix.js","node_modules/transformation-matrix/src/fromDefinition.js","node_modules/transformation-matrix/src/fromTransformAttribute.js","node_modules/transformation-matrix/src/fromTransformAttribute.autogenerated.js","node_modules/transformation-matrix/src/decompose.js","node_modules/transformation-matrix/src/flip.js","node_modules/transformation-matrix/src/fromMovingPoints.js","src/app/script/klecks/ui/project-viewport/utils/create-transform-matrix.ts","node_modules/@parcel/runtime-js/lib/runtime-c0c9999cdf2d6827.js","node_modules/@parcel/runtime-js/lib/runtime-23f688d6e164a430.js","node_modules/@parcel/runtime-js/lib/runtime-9d83f48c416e2e7c.js","node_modules/@parcel/runtime-js/lib/runtime-c021613649da7dd3.js","node_modules/@parcel/runtime-js/lib/runtime-3477e235b2d5ec78.js","src/app/script/klecks/ui/project-viewport/utils/zoom-by-step.ts","src/app/script/klecks/ui/project-viewport/utils/create-transform.ts","src/app/script/klecks/ui/project-viewport/utils/to-meta-transform.ts","node_modules/@parcel/runtime-js/lib/runtime-9cc16e110cdbef37.js","src/app/script/klecks/ui/modals/clipboard-dialog.ts","src/app/script/klecks/ui/tool-tabs/layer-manager/layer-manager.ts","src/app/script/klecks/canvas/kl-canvas.ts","src/app/script/klecks/image-operations/flood-fill.ts","src/app/script/klecks/image-operations/shape-tool.ts","src/app/script/klecks/image-operations/render-text.ts","src/app/script/klecks/canvas/draw-project.ts","src/app/script/klecks/image-operations/gradient-tool.ts","src/app/script/klecks/canvas/translate-blending.ts","src/app/script/klecks/ui/tool-tabs/layer-manager/rename-layer-dialog.ts","node_modules/@parcel/runtime-js/lib/runtime-6897c1fca3d4e2fd.js","src/app/script/klecks/ui/tool-tabs/layer-manager/merge-layer-dialog.ts","src/app/script/klecks/ui/components/dropdown-menu.ts","node_modules/@parcel/runtime-js/lib/runtime-cb368520eedb4c7f.js","node_modules/@parcel/runtime-js/lib/runtime-31569613b278b02e.js","node_modules/@parcel/runtime-js/lib/runtime-6cba829b77c466ae.js","node_modules/@parcel/runtime-js/lib/runtime-bf10b40c0c4d9441.js","node_modules/@parcel/runtime-js/lib/runtime-7f80d27b60f67e20.js","src/app/script/klecks/canvas-ui/workspace-svg-overlay.ts","src/app/script/klecks/canvas-ui/kl-canvas-workspace.ts","node_modules/@parcel/runtime-js/lib/runtime-d2b4add65292f2fb.js","node_modules/@parcel/runtime-js/lib/runtime-102807a1d2e0f340.js","node_modules/@parcel/runtime-js/lib/runtime-ce822b145bb65e36.js","node_modules/@parcel/runtime-js/lib/runtime-fce53b4d950138ca.js","src/app/script/klecks/events/linetool-processor.ts","src/app/script/klecks/kl-config.ts","src/app/script/klecks/canvas-ui/canvas-preview.ts","src/app/script/klecks/ui/components/free-transform.ts","node_modules/@parcel/runtime-js/lib/runtime-ee9fdf537e348a07.js","src/app/script/klecks/ui/components/free-transform-utils.ts","src/app/script/klecks/ui/components/free-transform-canvas.ts","node_modules/@emotion/css/dist/emotion-css.cjs.mjs","node_modules/@emotion/css/dist/emotion-css.cjs.js","src/app/script/klecks/ui/components/cropper.ts","src/app/script/klecks/ui/components/layer-preview.ts","src/app/script/klecks/ui/modals/show-import-as-layer-dialog.ts","src/app/script/klecks/ui/utils/test-is-small.ts","src/app/script/klecks/ui/utils/preview-size.ts","src/app/script/klecks/ui/components/kl-image-dropper.ts","src/app/script/klecks/ui/components/overlay-toolspace.ts","src/app/script/klecks/ui/components/toolspace-top-row.ts","node_modules/@parcel/runtime-js/lib/runtime-7813ddc215dc9a0f.js","node_modules/@parcel/runtime-js/lib/runtime-c0f1c288c138e1f7.js","node_modules/@parcel/runtime-js/lib/runtime-0ba587430db12376.js","node_modules/@parcel/runtime-js/lib/runtime-3f77141780636436.js","node_modules/@parcel/runtime-js/lib/runtime-580dce1b0b28af10.js","node_modules/@parcel/runtime-js/lib/runtime-8883c2ce34ff031d.js","src/app/script/klecks/ui/components/tool-dropdown.ts","node_modules/@parcel/runtime-js/lib/runtime-f6655cfb4f99c89e.js","node_modules/@parcel/runtime-js/lib/runtime-1c27ce26ccfb99ee.js","node_modules/@parcel/runtime-js/lib/runtime-710049657289fe43.js","node_modules/@parcel/runtime-js/lib/runtime-c318aa4ea5d44395.js","node_modules/@parcel/runtime-js/lib/runtime-2e7bd1216dcb7654.js","src/app/script/klecks/ui/components/toolspace-tool-row.ts","node_modules/@parcel/runtime-js/lib/runtime-863827fb7b7a9670.js","src/app/script/klecks/ui/components/toolspace-stabilizer-row.ts","src/app/script/klecks/ui/components/tab-row.ts","node_modules/@parcel/runtime-js/lib/runtime-a7905548b0b7692f.js","src/app/script/klecks/ui/tool-tabs/hand-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-ef9aaf5d8152a57c.js","src/app/script/klecks/ui/tool-tabs/fill-ui.ts","src/app/script/klecks/ui/tool-tabs/text-ui.ts","src/app/script/klecks/ui/tool-tabs/shape-ui.ts","src/app/script/klecks/ui/modals/new-image-dialog.ts","src/app/script/klecks/ui/components/table.ts","src/app/script/klecks/ui/components/toolspace-collapser.ts","node_modules/@parcel/runtime-js/lib/runtime-7c8b0011b85828bb.js","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-dialog.ts","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-fill-ui.ts","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-font-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-b5058bfe6f7dc7ca.js","node_modules/@parcel/runtime-js/lib/runtime-b4602c27f5ae27ab.js","node_modules/@parcel/runtime-js/lib/runtime-56ec1b157fbdf5e5.js","node_modules/@parcel/runtime-js/lib/runtime-da77c130a84988b1.js","node_modules/@parcel/runtime-js/lib/runtime-b68219d0ef1e031d.js","src/app/fonts/fonts.ts","node_modules/@parcel/runtime-js/lib/runtime-d832926826a47c20.js","node_modules/@parcel/runtime-js/lib/runtime-0e610ddc0a145ff0.js","node_modules/@parcel/runtime-js/lib/runtime-e7c83d1a98f0a570.js","node_modules/@parcel/runtime-js/lib/runtime-90c205e7caa18ae6.js","node_modules/@parcel/runtime-js/lib/runtime-c695fb45e63ab7b9.js","node_modules/@parcel/runtime-js/lib/runtime-1c0040e7b3cf13c7.js","node_modules/@parcel/runtime-js/lib/runtime-334bddbcecf5fd7e.js","node_modules/@parcel/runtime-js/lib/runtime-534a2ac51d7bdcd8.js","node_modules/@parcel/runtime-js/lib/runtime-11920e33c766db08.js","node_modules/@parcel/runtime-js/lib/runtime-5ab877b1458469bb.js","node_modules/@parcel/runtime-js/lib/runtime-3116dd5c37264879.js","node_modules/@parcel/runtime-js/lib/runtime-dc3928db9e2db09d.js","node_modules/@parcel/runtime-js/lib/runtime-9ee15c8d8be7fc3e.js","node_modules/@parcel/runtime-js/lib/runtime-dee1481afbda4a2a.js","node_modules/@parcel/runtime-js/lib/runtime-c3197db069cc89d0.js","node_modules/@parcel/runtime-js/lib/runtime-9b8b4e7078d90064.js","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-stroke-ui.ts","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-text-ui.ts","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-viewport-ui.ts","src/app/script/klecks/ui/modals/text-tool-dialog/text-tool-dialog.module.scss","src/app/script/klecks/ui/modals/show-import-image-dialog.ts","src/app/script/klecks/storage/psd.ts","src/app/script/klecks/storage/indexed-db.ts","src/app/script/klecks/filters/filters.ts","node_modules/@parcel/runtime-js/lib/runtime-1b597dc04e1f1d1e.js","node_modules/@parcel/runtime-js/lib/runtime-52cb0655ff8fcf9d.js","node_modules/@parcel/runtime-js/lib/runtime-2be3c858a504cfb7.js","node_modules/@parcel/runtime-js/lib/runtime-9a50263e79be7f8d.js","node_modules/@parcel/runtime-js/lib/runtime-b05402e157362d54.js","node_modules/@parcel/runtime-js/lib/runtime-63c76e5cc21da8e8.js","node_modules/@parcel/runtime-js/lib/runtime-f411d59f16a002a0.js","node_modules/@parcel/runtime-js/lib/runtime-1e2edcc527ca7658.js","node_modules/@parcel/runtime-js/lib/runtime-7b1474e9c71f32d0.js","node_modules/@parcel/runtime-js/lib/runtime-db4d47842e8594e8.js","node_modules/@parcel/runtime-js/lib/runtime-d19287428595bdaa.js","node_modules/@parcel/runtime-js/lib/runtime-52cef762ee6cd093.js","node_modules/@parcel/runtime-js/lib/runtime-b8024c27c4763139.js","node_modules/@parcel/runtime-js/lib/runtime-930d1faa7e2c3b05.js","node_modules/@parcel/runtime-js/lib/runtime-23bb7aca198bae55.js","node_modules/@parcel/runtime-js/lib/runtime-d7ea670f29d04f05.js","node_modules/@parcel/runtime-js/lib/runtime-aecd0ddb5674777d.js","src/app/script/klecks/brushes/brushes.ts","src/app/script/klecks/brushes/pen-brush.ts","src/app/script/klecks/brushes/brushes-common.ts","src/app/script/klecks/brushes/alphas/brush-alphas.ts","src/app/script/bb/math/perlin.ts","src/app/script/klecks/brushes/blend-brush.ts","src/app/script/klecks/brushes/sketchy-brush.ts","src/app/script/klecks/brushes/pixel-brush.ts","src/app/script/klecks/brushes/eraser-brush.ts","src/app/script/klecks/brushes/smudge-brush.ts","src/app/script/klecks/brushes/chemy-brush.ts","src/app/script/klecks/brushes-ui/brushes-ui.ts","src/app/script/klecks/brushes-ui/pen-brush-ui.ts","src/app/script/klecks/brushes-ui/brushes-consts.ts","node_modules/@parcel/runtime-js/lib/runtime-509967f4633865b1.js","src/app/script/klecks/brushes-ui/blend-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-02430688d8a21afc.js","src/app/script/klecks/brushes-ui/sketchy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-c02252e336535797.js","src/app/script/klecks/brushes-ui/pixel-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-ae01f01ee4a448d0.js","src/app/script/klecks/brushes-ui/eraser-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-d5063d6553de0d36.js","src/app/script/klecks/brushes-ui/smudge-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-46bb96fb8680fee5.js","src/app/script/klecks/brushes-ui/chemy-brush-ui.ts","node_modules/@parcel/runtime-js/lib/runtime-91f8b46fd9a146d4.js","src/app/script/klecks/ui/modals/show-iframe-modal.ts","src/app/script/klecks/ui/components/radio-list.ts","src/app/script/klecks/ui/components/browser-storage-ui.ts","src/app/script/klecks/storage/project-store.ts","src/app/script/klecks/storage/project-converter.ts","src/app/script/klecks/storage/base-64-to-blob.ts","src/app/script/klecks/ui/tool-tabs/file-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-fdedc95a61c26e40.js","src/app/script/klecks/ui/tool-tabs/filter-tab.ts","src/app/script/fx-canvas/shared-fx.ts","src/app/script/fx-canvas/fx-canvas.ts","src/app/script/fx-canvas/filters/brightness-contrast.ts","src/app/script/fx-canvas/core/simple-shader.ts","src/app/script/fx-canvas/core/fx-shader.ts","src/app/script/fx-canvas/core/gl.ts","src/app/script/fx-canvas/core/fx-texture.ts","src/app/script/fx-canvas/filters/curves.ts","src/app/script/fx-canvas/math/spline-interpolate.ts","src/app/script/fx-canvas/filters/hue-saturation.ts","src/app/script/fx-canvas/filters/noise.ts","src/app/script/fx-canvas/shaders/shader-noise.glsl","src/app/script/fx-canvas/filters/triangle-blur.ts","src/app/script/fx-canvas/shaders/random-shader-func.ts","src/app/script/fx-canvas/filters/tilt-shift.ts","src/app/script/fx-canvas/filters/matrix-warp.ts","src/app/script/fx-canvas/shaders/warp-shader.ts","src/app/script/fx-canvas/math/matrix.ts","src/app/script/fx-canvas/filters/unsharp-mask.ts","src/app/script/fx-canvas/filters/to-alpha.ts","src/app/script/fx-canvas/filters/invert.ts","src/app/script/fx-canvas/filters/perspective.ts","src/app/script/fx-canvas/filters/unmultiply-alpha.ts","src/app/script/fx-canvas/filters/distort.ts","src/app/script/fx-canvas/filters/multiply-alpha.ts","src/app/script/klecks/ui/modals/imgur-upload.ts","node_modules/@parcel/runtime-js/lib/runtime-f99b040580b1a2c3.js","src/app/script/klecks/storage/load-ag-psd.ts","src/app/script/klecks/ui/components/save-reminder.ts","src/app/script/klecks/storage/save-to-computer.ts","src/app/script/bb/base/save-as.ts","src/app/script/klecks/history/undo-redo-catchup.ts","src/app/script/klecks/brushes-ui/brush-setting-service.ts","src/app/script/klecks/ui/tool-tabs/settings-tab.ts","node_modules/@parcel/runtime-js/lib/runtime-f437c3d2eabb9e4d.js","node_modules/@parcel/runtime-js/lib/runtime-73260374214d7baa.js","src/app/script/klecks/ui/modals/licenses-dialog/show-licenses-dialog.ts","src/app/script/klecks/ui/components/toolspace-scroller.ts","src/app/script/klecks/ui/tool-tabs/gradient-ui.ts","src/app/script/app/kl-app.ts","src/app/script/embed/embed-toolspace-top-row.ts","src/app/script/klecks/filters/filters-lazy.ts","src/app/script/klecks/filters/filter-brightness-contrast.ts","src/app/script/klecks/filters/filters-consts.ts","src/app/script/klecks/ui/project-viewport/fx-preview-renderer.ts","src/app/script/klecks/filters/filter-crop-extend.ts","src/app/script/klecks/filters/filter-curves.ts","src/app/script/klecks/filters/filter-curves/curves-input.ts","src/app/script/klecks/filters/filter-flip.ts","src/app/script/klecks/filters/filter-hue-saturation.ts","src/app/script/klecks/filters/filter-invert.ts","src/app/script/klecks/filters/filter-perspective.ts","src/app/script/klecks/ui/components/two-tabs.ts","src/app/script/klecks/ui/components/draggable-input.ts","src/app/script/klecks/filters/filter-resize.ts","node_modules/@parcel/runtime-js/lib/runtime-2a401146ee8ce9d6.js","src/app/script/klecks/filters/filter-rotate.ts","src/app/script/klecks/filters/filter-tilt-shift.ts","src/app/script/klecks/filters/filter-transform.ts","src/app/script/klecks/filters/filter-blur.ts","src/app/script/klecks/filters/filter-unsharp-mask.ts","src/app/script/klecks/filters/filter-to-alpha.ts","src/app/script/klecks/filters/filter-grid.ts","src/app/script/klecks/image-operations/draw-grid.ts","src/app/script/klecks/filters/filter-noise.ts","src/app/script/klecks/filters/filter-pattern.ts","src/app/script/klecks/filters/filter-distort.ts","src/app/script/klecks/filters/filter-vanish-point.ts","src/app/script/klecks/image-operations/draw-vanish-point.ts","src/app/script/klecks/storage/kl-canvas-to-psd-blob.ts","src/app/script/klecks/events/line-smoothing.ts","src/app/script/klecks/events/line-sanitizer.ts","src/app/script/klecks/utils/translate-smoothing.ts","src/app/script/app/import-handler.ts","node_modules/@parcel/runtime-js/lib/runtime-09cefc98d4252d7d.js","node_modules/@parcel/runtime-js/lib/runtime-407c069cd6067c07.js","src/app/script/app/console-api.ts"],"sourcesContent":["\n      var $parcel$global =\n        typeof globalThis !== 'undefined'\n          ? globalThis\n          : typeof self !== 'undefined'\n          ? self\n          : typeof window !== 'undefined'\n          ? window\n          : typeof global !== 'undefined'\n          ? global\n          : {};\n  \nfunction $parcel$defineInteropFlag(a) {\n  Object.defineProperty(a, '__esModule', {value: true, configurable: true});\n}\n\nfunction $parcel$export(e, n, v, s) {\n  Object.defineProperty(e, n, {get: v, set: s, enumerable: true, configurable: true});\n}\n\nfunction $parcel$interopDefault(a) {\n  return a && a.__esModule ? a.default : a;\n}\n\nvar $parcel$modules = {};\nvar $parcel$inits = {};\n\nvar parcelRequire = $parcel$global[\"parcelRequire94c2\"];\n\nif (parcelRequire == null) {\n  parcelRequire = function(id) {\n    if (id in $parcel$modules) {\n      return $parcel$modules[id].exports;\n    }\n    if (id in $parcel$inits) {\n      var init = $parcel$inits[id];\n      delete $parcel$inits[id];\n      var module = {id: id, exports: {}};\n      $parcel$modules[id] = module;\n      init.call(module.exports, module, module.exports);\n      return module.exports;\n    }\n    var err = new Error(\"Cannot find module '\" + id + \"'\");\n    err.code = 'MODULE_NOT_FOUND';\n    throw err;\n  };\n\n  parcelRequire.register = function register(id, init) {\n    $parcel$inits[id] = init;\n  };\n\n  $parcel$global[\"parcelRequire94c2\"] = parcelRequire;\n}\n\nvar parcelRegister = parcelRequire.register;\nparcelRegister(\"lytfz\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"fKq5I\"))((parcelRequire(\"kb8hZ\")).resolve(\"6OT74\")).then(()=>parcelRequire(\"11sRX\"));\n\n});\nparcelRegister(\"fKq5I\", function(module, exports) {\n\"use strict\";\n\nvar $20Uq9 = parcelRequire(\"20Uq9\");\nmodule.exports = $20Uq9(function(bundle) {\n    return new Promise(function(resolve, reject) {\n        // Add a global function to handle when the script loads.\n        var globalName = \"i\".concat((\"\" + Math.random()).slice(2));\n        $parcel$global[globalName] = function(m) {\n            resolve(m);\n            cleanup();\n        };\n        // Remove script on load or error\n        var cleanup = function() {\n            delete $parcel$global[globalName];\n            script.onerror = null;\n            script.remove();\n        };\n        // Append an inline script tag into the document head\n        var script = document.createElement(\"script\");\n        script.async = true;\n        script.type = \"module\";\n        script.charset = \"utf-8\";\n        script.textContent = \"import * as m from '\".concat(bundle, \"'; \").concat(globalName, \"(m);\");\n        script.onerror = function(e) {\n            reject(e);\n            cleanup();\n        };\n        document.head.appendChild(script);\n    });\n});\n\n});\nparcelRegister(\"20Uq9\", function(module, exports) {\n\"use strict\";\nvar $177758dc750d50ea$var$cachedBundles = {};\nvar $177758dc750d50ea$var$cachedPreloads = {};\nvar $177758dc750d50ea$var$cachedPrefetches = {};\nfunction $177758dc750d50ea$var$getCache(type) {\n    switch(type){\n        case \"preload\":\n            return $177758dc750d50ea$var$cachedPreloads;\n        case \"prefetch\":\n            return $177758dc750d50ea$var$cachedPrefetches;\n        default:\n            return $177758dc750d50ea$var$cachedBundles;\n    }\n}\nmodule.exports = function(loader, type) {\n    return function(bundle) {\n        var cache = $177758dc750d50ea$var$getCache(type);\n        if (cache[bundle]) return cache[bundle];\n        return cache[bundle] = loader.apply(null, arguments).catch(function(e) {\n            delete cache[bundle];\n            throw e;\n        });\n    };\n};\n\n});\n\n\n\nparcelRegister(\"1JS1i\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"fKq5I\"))((parcelRequire(\"kb8hZ\")).resolve(\"i8WN1\")).then(()=>parcelRequire(\"aZ0Sx\"));\n\n});\n\nparcelRegister(\"9KmPU\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"fKq5I\"))((parcelRequire(\"kb8hZ\")).resolve(\"hUIiR\")).then(()=>parcelRequire(\"2BQEx\"));\n\n});\n\nparcelRegister(\"1Rdf4\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"fKq5I\"))((parcelRequire(\"kb8hZ\")).resolve(\"klZAl\")).then(()=>parcelRequire(\"68m8f\"));\n\n});\n\nparcelRegister(\"lb7jn\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"fKq5I\"))((parcelRequire(\"kb8hZ\")).resolve(\"i3Nr5\")).then(()=>parcelRequire(\"5ukhf\"));\n\n});\n\nparcelRegister(\"hpkwJ\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"fKq5I\"))((parcelRequire(\"kb8hZ\")).resolve(\"eiNJp\")).then(()=>parcelRequire(\"2C9ch\"));\n\n});\n\nparcelRegister(\"cGAWy\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"fKq5I\"))((parcelRequire(\"kb8hZ\")).resolve(\"b1997\")).then(()=>parcelRequire(\"aGeQD\"));\n\n});\n\nparcelRegister(\"6KItP\", function(module, exports) {\n\"use strict\";\nObject.defineProperty(module.exports, \"__esModule\", {\n    value: true\n});\n\nvar $1erBK = parcelRequire(\"1erBK\");\nparcelRequire(\"brs90\");\nparcelRequire(\"7YdyD\");\nparcelRequire(\"42Upt\");\nvar $4ea98ac1647cc6f1$var$_createEmotion = $1erBK.default({\n    key: \"css\"\n}), $4ea98ac1647cc6f1$var$flush = $4ea98ac1647cc6f1$var$_createEmotion.flush, $4ea98ac1647cc6f1$var$hydrate = $4ea98ac1647cc6f1$var$_createEmotion.hydrate, $4ea98ac1647cc6f1$var$cx = $4ea98ac1647cc6f1$var$_createEmotion.cx, $4ea98ac1647cc6f1$var$merge = $4ea98ac1647cc6f1$var$_createEmotion.merge, $4ea98ac1647cc6f1$var$getRegisteredStyles = $4ea98ac1647cc6f1$var$_createEmotion.getRegisteredStyles, $4ea98ac1647cc6f1$var$injectGlobal = $4ea98ac1647cc6f1$var$_createEmotion.injectGlobal, $4ea98ac1647cc6f1$var$keyframes = $4ea98ac1647cc6f1$var$_createEmotion.keyframes, $4ea98ac1647cc6f1$var$css = $4ea98ac1647cc6f1$var$_createEmotion.css, $4ea98ac1647cc6f1$var$sheet = $4ea98ac1647cc6f1$var$_createEmotion.sheet, $4ea98ac1647cc6f1$var$cache = $4ea98ac1647cc6f1$var$_createEmotion.cache;\nmodule.exports.cache = $4ea98ac1647cc6f1$var$cache;\nmodule.exports.css = $4ea98ac1647cc6f1$var$css;\nmodule.exports.cx = $4ea98ac1647cc6f1$var$cx;\nmodule.exports.flush = $4ea98ac1647cc6f1$var$flush;\nmodule.exports.getRegisteredStyles = $4ea98ac1647cc6f1$var$getRegisteredStyles;\nmodule.exports.hydrate = $4ea98ac1647cc6f1$var$hydrate;\nmodule.exports.injectGlobal = $4ea98ac1647cc6f1$var$injectGlobal;\nmodule.exports.keyframes = $4ea98ac1647cc6f1$var$keyframes;\nmodule.exports.merge = $4ea98ac1647cc6f1$var$merge;\nmodule.exports.sheet = $4ea98ac1647cc6f1$var$sheet;\n\n});\nparcelRegister(\"1erBK\", function(module, exports) {\n\"use strict\";\nObject.defineProperty(module.exports, \"__esModule\", {\n    value: true\n});\n\nvar $brs90 = parcelRequire(\"brs90\");\n\nvar $7YdyD = parcelRequire(\"7YdyD\");\n\nvar $42Upt = parcelRequire(\"42Upt\");\nfunction $0e5c839687e65192$var$_interopDefault(e) {\n    return e && e.__esModule ? e : {\n        \"default\": e\n    };\n}\nvar $0e5c839687e65192$var$createCache__default = /*#__PURE__*/ $0e5c839687e65192$var$_interopDefault($brs90);\nfunction $0e5c839687e65192$var$insertWithoutScoping(cache, serialized) {\n    if (cache.inserted[serialized.name] === undefined) return cache.insert(\"\", serialized, cache.sheet, true);\n}\nfunction $0e5c839687e65192$var$merge(registered, css, className) {\n    var registeredStyles = [];\n    var rawClassName = $42Upt.getRegisteredStyles(registered, registeredStyles, className);\n    if (registeredStyles.length < 2) return className;\n    return rawClassName + css(registeredStyles);\n}\nvar $0e5c839687e65192$var$createEmotion = function createEmotion(options) {\n    var cache = $0e5c839687e65192$var$createCache__default[\"default\"](options); // $FlowFixMe\n    cache.sheet.speedy = function(value) {\n        this.isSpeedy = value;\n    };\n    cache.compat = true;\n    var css = function css() {\n        for(var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++)args[_key] = arguments[_key];\n        var serialized = $7YdyD.serializeStyles(args, cache.registered, undefined);\n        $42Upt.insertStyles(cache, serialized, false);\n        return cache.key + \"-\" + serialized.name;\n    };\n    var keyframes = function keyframes() {\n        for(var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++)args[_key2] = arguments[_key2];\n        var serialized = $7YdyD.serializeStyles(args, cache.registered);\n        var animation = \"animation-\" + serialized.name;\n        $0e5c839687e65192$var$insertWithoutScoping(cache, {\n            name: serialized.name,\n            styles: \"@keyframes \" + animation + \"{\" + serialized.styles + \"}\"\n        });\n        return animation;\n    };\n    var injectGlobal = function injectGlobal() {\n        for(var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++)args[_key3] = arguments[_key3];\n        var serialized = $7YdyD.serializeStyles(args, cache.registered);\n        $0e5c839687e65192$var$insertWithoutScoping(cache, serialized);\n    };\n    var cx = function cx() {\n        for(var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++)args[_key4] = arguments[_key4];\n        return $0e5c839687e65192$var$merge(cache.registered, css, $0e5c839687e65192$var$classnames(args));\n    };\n    return {\n        css: css,\n        cx: cx,\n        injectGlobal: injectGlobal,\n        keyframes: keyframes,\n        hydrate: function hydrate(ids) {\n            ids.forEach(function(key) {\n                cache.inserted[key] = true;\n            });\n        },\n        flush: function flush() {\n            cache.registered = {};\n            cache.inserted = {};\n            cache.sheet.flush();\n        },\n        // $FlowFixMe\n        sheet: cache.sheet,\n        cache: cache,\n        getRegisteredStyles: $42Upt.getRegisteredStyles.bind(null, cache.registered),\n        merge: $0e5c839687e65192$var$merge.bind(null, cache.registered, css)\n    };\n};\nvar $0e5c839687e65192$var$classnames = function classnames(args) {\n    var cls = \"\";\n    for(var i = 0; i < args.length; i++){\n        var arg = args[i];\n        if (arg == null) continue;\n        var toAdd = void 0;\n        switch(typeof arg){\n            case \"boolean\":\n                break;\n            case \"object\":\n                if (Array.isArray(arg)) toAdd = classnames(arg);\n                else {\n                    toAdd = \"\";\n                    for(var k in arg)if (arg[k] && k) {\n                        toAdd && (toAdd += \" \");\n                        toAdd += k;\n                    }\n                }\n                break;\n            default:\n                toAdd = arg;\n        }\n        if (toAdd) {\n            cls && (cls += \" \");\n            cls += toAdd;\n        }\n    }\n    return cls;\n};\nmodule.exports[\"default\"] = $0e5c839687e65192$var$createEmotion;\n\n});\nparcelRegister(\"brs90\", function(module, exports) {\n\n$parcel$defineInteropFlag(module.exports);\n\n$parcel$export(module.exports, \"default\", function () { return $85480c33a4508c92$export$2e2bcd8739ae039; });\n\nvar $n9S4x = parcelRequire(\"n9S4x\");\n\nvar $fOtsb = parcelRequire(\"fOtsb\");\nparcelRequire(\"irnze\");\nparcelRequire(\"tBGmN\");\nvar $85480c33a4508c92$var$identifierWithPointTracking = function identifierWithPointTracking(begin, points, index) {\n    var previous = 0;\n    var character = 0;\n    while(true){\n        previous = character;\n        character = (0, $fOtsb.peek)(); // &\\f\n        if (previous === 38 && character === 12) points[index] = 1;\n        if ((0, $fOtsb.token)(character)) break;\n        (0, $fOtsb.next)();\n    }\n    return (0, $fOtsb.slice)(begin, (0, $fOtsb.position));\n};\nvar $85480c33a4508c92$var$toRules = function toRules(parsed, points) {\n    // pretend we've started with a comma\n    var index = -1;\n    var character = 44;\n    do switch((0, $fOtsb.token)(character)){\n        case 0:\n            // &\\f\n            if (character === 38 && (0, $fOtsb.peek)() === 12) // this is not 100% correct, we don't account for literal sequences here - like for example quoted strings\n            // stylis inserts \\f after & to know when & where it should replace this sequence with the context selector\n            // and when it should just concatenate the outer and inner selectors\n            // it's very unlikely for this sequence to actually appear in a different context, so we just leverage this fact here\n            points[index] = 1;\n            parsed[index] += $85480c33a4508c92$var$identifierWithPointTracking((0, $fOtsb.position) - 1, points, index);\n            break;\n        case 2:\n            parsed[index] += (0, $fOtsb.delimit)(character);\n            break;\n        case 4:\n            // comma\n            if (character === 44) {\n                // colon\n                parsed[++index] = (0, $fOtsb.peek)() === 58 ? \"&\\f\" : \"\";\n                points[index] = parsed[index].length;\n                break;\n            }\n        // fallthrough\n        default:\n            parsed[index] += (0, $fOtsb.from)(character);\n    }\n    while (character = (0, $fOtsb.next)());\n    return parsed;\n};\nvar $85480c33a4508c92$var$getRules = function getRules(value, points) {\n    return (0, $fOtsb.dealloc)($85480c33a4508c92$var$toRules((0, $fOtsb.alloc)(value), points));\n}; // WeakSet would be more appropriate, but only WeakMap is supported in IE11\nvar $85480c33a4508c92$var$fixedElements = /* #__PURE__ */ new WeakMap();\nvar $85480c33a4508c92$var$compat = function compat(element) {\n    if (element.type !== \"rule\" || !element.parent || // positive .length indicates that this rule contains pseudo\n    // negative .length indicates that this rule has been already prefixed\n    element.length < 1) return;\n    var value = element.value, parent = element.parent;\n    var isImplicitRule = element.column === parent.column && element.line === parent.line;\n    while(parent.type !== \"rule\"){\n        parent = parent.parent;\n        if (!parent) return;\n    } // short-circuit for the simplest case\n    if (element.props.length === 1 && value.charCodeAt(0) !== 58 && !$85480c33a4508c92$var$fixedElements.get(parent)) return;\n     // if this is an implicitly inserted rule (the one eagerly inserted at the each new nested level)\n    // then the props has already been manipulated beforehand as they that array is shared between it and its \"rule parent\"\n    if (isImplicitRule) return;\n    $85480c33a4508c92$var$fixedElements.set(element, true);\n    var points = [];\n    var rules = $85480c33a4508c92$var$getRules(value, points);\n    var parentRules = parent.props;\n    for(var i = 0, k = 0; i < rules.length; i++)for(var j = 0; j < parentRules.length; j++, k++)element.props[k] = points[i] ? rules[i].replace(/&\\f/g, parentRules[j]) : parentRules[j] + \" \" + rules[i];\n};\nvar $85480c33a4508c92$var$removeLabel = function removeLabel(element) {\n    if (element.type === \"decl\") {\n        var value = element.value;\n        if (value.charCodeAt(0) === 108 && // charcode for b\n        value.charCodeAt(2) === 98) {\n            // this ignores label\n            element[\"return\"] = \"\";\n            element.value = \"\";\n        }\n    }\n};\nvar $85480c33a4508c92$var$ignoreFlag = \"emotion-disable-server-rendering-unsafe-selector-warning-please-do-not-use-this-the-warning-exists-for-a-reason\";\nvar $85480c33a4508c92$var$isIgnoringComment = function isIgnoringComment(element) {\n    return element.type === \"comm\" && element.children.indexOf($85480c33a4508c92$var$ignoreFlag) > -1;\n};\nvar $85480c33a4508c92$var$createUnsafeSelectorsAlarm = function createUnsafeSelectorsAlarm(cache) {\n    return function(element, index, children) {\n        if (element.type !== \"rule\" || cache.compat) return;\n        var unsafePseudoClasses = element.value.match(/(:first|:nth|:nth-last)-child/g);\n        if (unsafePseudoClasses) {\n            var isNested = !!element.parent; // in nested rules comments become children of the \"auto-inserted\" rule and that's always the `element.parent`\n            //\n            // considering this input:\n            // .a {\n            //   .b /* comm */ {}\n            //   color: hotpink;\n            // }\n            // we get output corresponding to this:\n            // .a {\n            //   & {\n            //     /* comm */\n            //     color: hotpink;\n            //   }\n            //   .b {}\n            // }\n            var commentContainer = isNested ? element.parent.children : children;\n            for(var i = commentContainer.length - 1; i >= 0; i--){\n                var node = commentContainer[i];\n                if (node.line < element.line) break;\n                 // it is quite weird but comments are *usually* put at `column: element.column - 1`\n                // so we seek *from the end* for the node that is earlier than the rule's `element` and check that\n                // this will also match inputs like this:\n                // .a {\n                //   /* comm */\n                //   .b {}\n                // }\n                //\n                // but that is fine\n                //\n                // it would be the easiest to change the placement of the comment to be the first child of the rule:\n                // .a {\n                //   .b { /* comm */ }\n                // }\n                // with such inputs we wouldn't have to search for the comment at all\n                // TODO: consider changing this comment placement in the next major version\n                if (node.column < element.column) {\n                    if ($85480c33a4508c92$var$isIgnoringComment(node)) return;\n                    break;\n                }\n            }\n            unsafePseudoClasses.forEach(function(unsafePseudoClass) {\n                console.error('The pseudo class \"' + unsafePseudoClass + '\" is potentially unsafe when doing server-side rendering. Try changing it to \"' + unsafePseudoClass.split(\"-child\")[0] + '-of-type\".');\n            });\n        }\n    };\n};\nvar $85480c33a4508c92$var$isImportRule = function isImportRule(element) {\n    return element.type.charCodeAt(1) === 105 && element.type.charCodeAt(0) === 64;\n};\nvar $85480c33a4508c92$var$isPrependedWithRegularRules = function isPrependedWithRegularRules(index, children) {\n    for(var i = index - 1; i >= 0; i--){\n        if (!$85480c33a4508c92$var$isImportRule(children[i])) return true;\n    }\n    return false;\n}; // use this to remove incorrect elements from further processing\n// so they don't get handed to the `sheet` (or anything else)\n// as that could potentially lead to additional logs which in turn could be overhelming to the user\nvar $85480c33a4508c92$var$nullifyElement = function nullifyElement(element) {\n    element.type = \"\";\n    element.value = \"\";\n    element[\"return\"] = \"\";\n    element.children = \"\";\n    element.props = \"\";\n};\nvar $85480c33a4508c92$var$incorrectImportAlarm = function incorrectImportAlarm(element, index, children) {\n    if (!$85480c33a4508c92$var$isImportRule(element)) return;\n    if (element.parent) {\n        console.error(\"`@import` rules can't be nested inside other rules. Please move it to the top level and put it before regular rules. Keep in mind that they can only be used within global styles.\");\n        $85480c33a4508c92$var$nullifyElement(element);\n    } else if ($85480c33a4508c92$var$isPrependedWithRegularRules(index, children)) {\n        console.error(\"`@import` rules can't be after other rules. Please put your `@import` rules before your other rules.\");\n        $85480c33a4508c92$var$nullifyElement(element);\n    }\n};\n/* eslint-disable no-fallthrough */ function $85480c33a4508c92$var$prefix(value, length) {\n    switch((0, $fOtsb.hash)(value, length)){\n        // color-adjust\n        case 5103:\n            return (0, $fOtsb.WEBKIT) + \"print-\" + value + value;\n        // animation, animation-(delay|direction|duration|fill-mode|iteration-count|name|play-state|timing-function)\n        case 5737:\n        case 4201:\n        case 3177:\n        case 3433:\n        case 1641:\n        case 4457:\n        case 2921:\n        case 5572:\n        case 6356:\n        case 5844:\n        case 3191:\n        case 6645:\n        case 3005:\n        case 6391:\n        case 5879:\n        case 5623:\n        case 6135:\n        case 4599:\n        case 4855:\n        case 4215:\n        case 6389:\n        case 5109:\n        case 5365:\n        case 5621:\n        case 3829:\n            return (0, $fOtsb.WEBKIT) + value + value;\n        // appearance, user-select, transform, hyphens, text-size-adjust\n        case 5349:\n        case 4246:\n        case 4810:\n        case 6968:\n        case 2756:\n            return (0, $fOtsb.WEBKIT) + value + (0, $fOtsb.MOZ) + value + (0, $fOtsb.MS) + value + value;\n        // flex, flex-direction\n        case 6828:\n        case 4268:\n            return (0, $fOtsb.WEBKIT) + value + (0, $fOtsb.MS) + value + value;\n        // order\n        case 6165:\n            return (0, $fOtsb.WEBKIT) + value + (0, $fOtsb.MS) + \"flex-\" + value + value;\n        // align-items\n        case 5187:\n            return (0, $fOtsb.WEBKIT) + value + (0, $fOtsb.replace)(value, /(\\w+).+(:[^]+)/, (0, $fOtsb.WEBKIT) + \"box-$1$2\" + (0, $fOtsb.MS) + \"flex-$1$2\") + value;\n        // align-self\n        case 5443:\n            return (0, $fOtsb.WEBKIT) + value + (0, $fOtsb.MS) + \"flex-item-\" + (0, $fOtsb.replace)(value, /flex-|-self/, \"\") + value;\n        // align-content\n        case 4675:\n            return (0, $fOtsb.WEBKIT) + value + (0, $fOtsb.MS) + \"flex-line-pack\" + (0, $fOtsb.replace)(value, /align-content|flex-|-self/, \"\") + value;\n        // flex-shrink\n        case 5548:\n            return (0, $fOtsb.WEBKIT) + value + (0, $fOtsb.MS) + (0, $fOtsb.replace)(value, \"shrink\", \"negative\") + value;\n        // flex-basis\n        case 5292:\n            return (0, $fOtsb.WEBKIT) + value + (0, $fOtsb.MS) + (0, $fOtsb.replace)(value, \"basis\", \"preferred-size\") + value;\n        // flex-grow\n        case 6060:\n            return (0, $fOtsb.WEBKIT) + \"box-\" + (0, $fOtsb.replace)(value, \"-grow\", \"\") + (0, $fOtsb.WEBKIT) + value + (0, $fOtsb.MS) + (0, $fOtsb.replace)(value, \"grow\", \"positive\") + value;\n        // transition\n        case 4554:\n            return (0, $fOtsb.WEBKIT) + (0, $fOtsb.replace)(value, /([^-])(transform)/g, \"$1\" + (0, $fOtsb.WEBKIT) + \"$2\") + value;\n        // cursor\n        case 6187:\n            return (0, $fOtsb.replace)((0, $fOtsb.replace)((0, $fOtsb.replace)(value, /(zoom-|grab)/, (0, $fOtsb.WEBKIT) + \"$1\"), /(image-set)/, (0, $fOtsb.WEBKIT) + \"$1\"), value, \"\") + value;\n        // background, background-image\n        case 5495:\n        case 3959:\n            return (0, $fOtsb.replace)(value, /(image-set\\([^]*)/, (0, $fOtsb.WEBKIT) + \"$1\" + \"$`$1\");\n        // justify-content\n        case 4968:\n            return (0, $fOtsb.replace)((0, $fOtsb.replace)(value, /(.+:)(flex-)?(.*)/, (0, $fOtsb.WEBKIT) + \"box-pack:$3\" + (0, $fOtsb.MS) + \"flex-pack:$3\"), /s.+-b[^;]+/, \"justify\") + (0, $fOtsb.WEBKIT) + value + value;\n        // (margin|padding)-inline-(start|end)\n        case 4095:\n        case 3583:\n        case 4068:\n        case 2532:\n            return (0, $fOtsb.replace)(value, /(.+)-inline(.+)/, (0, $fOtsb.WEBKIT) + \"$1$2\") + value;\n        // (min|max)?(width|height|inline-size|block-size)\n        case 8116:\n        case 7059:\n        case 5753:\n        case 5535:\n        case 5445:\n        case 5701:\n        case 4933:\n        case 4677:\n        case 5533:\n        case 5789:\n        case 5021:\n        case 4765:\n            // stretch, max-content, min-content, fill-available\n            if ((0, $fOtsb.strlen)(value) - 1 - length > 6) switch((0, $fOtsb.charat)(value, length + 1)){\n                // (m)ax-content, (m)in-content\n                case 109:\n                    // -\n                    if ((0, $fOtsb.charat)(value, length + 4) !== 45) break;\n                // (f)ill-available, (f)it-content\n                case 102:\n                    return (0, $fOtsb.replace)(value, /(.+:)(.+)-([^]+)/, \"$1\" + (0, $fOtsb.WEBKIT) + \"$2-$3\" + \"$1\" + (0, $fOtsb.MOZ) + ((0, $fOtsb.charat)(value, length + 3) == 108 ? \"$3\" : \"$2-$3\")) + value;\n                // (s)tretch\n                case 115:\n                    return ~(0, $fOtsb.indexof)(value, \"stretch\") ? $85480c33a4508c92$var$prefix((0, $fOtsb.replace)(value, \"stretch\", \"fill-available\"), length) + value : value;\n            }\n            break;\n        // position: sticky\n        case 4949:\n            // (s)ticky?\n            if ((0, $fOtsb.charat)(value, length + 1) !== 115) break;\n        // display: (flex|inline-flex)\n        case 6444:\n            switch((0, $fOtsb.charat)(value, (0, $fOtsb.strlen)(value) - 3 - (~(0, $fOtsb.indexof)(value, \"!important\") && 10))){\n                // stic(k)y\n                case 107:\n                    return (0, $fOtsb.replace)(value, \":\", \":\" + (0, $fOtsb.WEBKIT)) + value;\n                // (inline-)?fl(e)x\n                case 101:\n                    return (0, $fOtsb.replace)(value, /(.+:)([^;!]+)(;|!.+)?/, \"$1\" + (0, $fOtsb.WEBKIT) + ((0, $fOtsb.charat)(value, 14) === 45 ? \"inline-\" : \"\") + \"box$3\" + \"$1\" + (0, $fOtsb.WEBKIT) + \"$2$3\" + \"$1\" + (0, $fOtsb.MS) + \"$2box$3\") + value;\n            }\n            break;\n        // writing-mode\n        case 5936:\n            switch((0, $fOtsb.charat)(value, length + 11)){\n                // vertical-l(r)\n                case 114:\n                    return (0, $fOtsb.WEBKIT) + value + (0, $fOtsb.MS) + (0, $fOtsb.replace)(value, /[svh]\\w+-[tblr]{2}/, \"tb\") + value;\n                // vertical-r(l)\n                case 108:\n                    return (0, $fOtsb.WEBKIT) + value + (0, $fOtsb.MS) + (0, $fOtsb.replace)(value, /[svh]\\w+-[tblr]{2}/, \"tb-rl\") + value;\n                // horizontal(-)tb\n                case 45:\n                    return (0, $fOtsb.WEBKIT) + value + (0, $fOtsb.MS) + (0, $fOtsb.replace)(value, /[svh]\\w+-[tblr]{2}/, \"lr\") + value;\n            }\n            return (0, $fOtsb.WEBKIT) + value + (0, $fOtsb.MS) + value + value;\n    }\n    return value;\n}\nvar $85480c33a4508c92$var$prefixer = function prefixer(element, index, children, callback) {\n    if (element.length > -1) {\n        if (!element[\"return\"]) switch(element.type){\n            case 0, $fOtsb.DECLARATION:\n                element[\"return\"] = $85480c33a4508c92$var$prefix(element.value, element.length);\n                break;\n            case 0, $fOtsb.KEYFRAMES:\n                return (0, $fOtsb.serialize)([\n                    (0, $fOtsb.copy)(element, {\n                        value: (0, $fOtsb.replace)(element.value, \"@\", \"@\" + (0, $fOtsb.WEBKIT))\n                    })\n                ], callback);\n            case 0, $fOtsb.RULESET:\n                if (element.length) return (0, $fOtsb.combine)(element.props, function(value) {\n                    switch((0, $fOtsb.match)(value, /(::plac\\w+|:read-\\w+)/)){\n                        // :read-(only|write)\n                        case \":read-only\":\n                        case \":read-write\":\n                            return (0, $fOtsb.serialize)([\n                                (0, $fOtsb.copy)(element, {\n                                    props: [\n                                        (0, $fOtsb.replace)(value, /:(read-\\w+)/, \":\" + (0, $fOtsb.MOZ) + \"$1\")\n                                    ]\n                                })\n                            ], callback);\n                        // :placeholder\n                        case \"::placeholder\":\n                            return (0, $fOtsb.serialize)([\n                                (0, $fOtsb.copy)(element, {\n                                    props: [\n                                        (0, $fOtsb.replace)(value, /:(plac\\w+)/, \":\" + (0, $fOtsb.WEBKIT) + \"input-$1\")\n                                    ]\n                                }),\n                                (0, $fOtsb.copy)(element, {\n                                    props: [\n                                        (0, $fOtsb.replace)(value, /:(plac\\w+)/, \":\" + (0, $fOtsb.MOZ) + \"$1\")\n                                    ]\n                                }),\n                                (0, $fOtsb.copy)(element, {\n                                    props: [\n                                        (0, $fOtsb.replace)(value, /:(plac\\w+)/, (0, $fOtsb.MS) + \"input-$1\")\n                                    ]\n                                })\n                            ], callback);\n                    }\n                    return \"\";\n                });\n        }\n    }\n};\nvar $85480c33a4508c92$var$defaultStylisPlugins = [\n    $85480c33a4508c92$var$prefixer\n];\nvar $85480c33a4508c92$export$2e2bcd8739ae039 = function createCache(options) {\n    var key = options.key;\n    if (key === \"css\") {\n        var ssrStyles = document.querySelectorAll(\"style[data-emotion]:not([data-s])\"); // get SSRed styles out of the way of React's hydration\n        // document.head is a safe place to move them to(though note document.head is not necessarily the last place they will be)\n        // note this very very intentionally targets all style elements regardless of the key to ensure\n        // that creating a cache works inside of render of a React component\n        Array.prototype.forEach.call(ssrStyles, function(node) {\n            // we want to only move elements which have a space in the data-emotion attribute value\n            // because that indicates that it is an Emotion 11 server-side rendered style elements\n            // while we will already ignore Emotion 11 client-side inserted styles because of the :not([data-s]) part in the selector\n            // Emotion 10 client-side inserted styles did not have data-s (but importantly did not have a space in their data-emotion attributes)\n            // so checking for the space ensures that loading Emotion 11 after Emotion 10 has inserted some styles\n            // will not result in the Emotion 10 styles being destroyed\n            var dataEmotionAttribute = node.getAttribute(\"data-emotion\");\n            if (dataEmotionAttribute.indexOf(\" \") === -1) return;\n            document.head.appendChild(node);\n            node.setAttribute(\"data-s\", \"\");\n        });\n    }\n    var stylisPlugins = options.stylisPlugins || $85480c33a4508c92$var$defaultStylisPlugins;\n    var inserted = {};\n    var container;\n    var nodesToHydrate = [];\n    container = options.container || document.head;\n    Array.prototype.forEach.call(// means that the style elements we're looking at are only Emotion 11 server-rendered style elements\n    document.querySelectorAll('style[data-emotion^=\"' + key + ' \"]'), function(node) {\n        var attrib = node.getAttribute(\"data-emotion\").split(\" \"); // $FlowFixMe\n        for(var i = 1; i < attrib.length; i++)inserted[attrib[i]] = true;\n        nodesToHydrate.push(node);\n    });\n    var _insert;\n    var omnipresentPlugins = [\n        $85480c33a4508c92$var$compat,\n        $85480c33a4508c92$var$removeLabel\n    ];\n    var currentSheet;\n    var finalizingPlugins = [\n        (0, $fOtsb.stringify),\n        (0, $fOtsb.rulesheet)(function(rule) {\n            currentSheet.insert(rule);\n        })\n    ];\n    var serializer = (0, $fOtsb.middleware)(omnipresentPlugins.concat(stylisPlugins, finalizingPlugins));\n    var stylis = function stylis(styles) {\n        return (0, $fOtsb.serialize)((0, $fOtsb.compile)(styles), serializer);\n    };\n    _insert = function insert(selector, serialized, sheet, shouldCache) {\n        currentSheet = sheet;\n        stylis(selector ? selector + \"{\" + serialized.styles + \"}\" : serialized.styles);\n        if (shouldCache) cache.inserted[serialized.name] = true;\n    };\n    var cache = {\n        key: key,\n        sheet: new (0, $n9S4x.StyleSheet)({\n            key: key,\n            container: container,\n            nonce: options.nonce,\n            speedy: options.speedy,\n            prepend: options.prepend,\n            insertionPoint: options.insertionPoint\n        }),\n        nonce: options.nonce,\n        inserted: inserted,\n        registered: {},\n        insert: _insert\n    };\n    cache.sheet.hydrate(nodesToHydrate);\n    return cache;\n};\n\n});\nparcelRegister(\"n9S4x\", function(module, exports) {\n\n$parcel$export(module.exports, \"StyleSheet\", function () { return $0459ce4c5047536b$export$9d753cd7ae895cce; });\n/*\n\nBased off glamor's StyleSheet, thanks Sunil \n\nhigh performance StyleSheet for css-in-js systems\n\n- uses multiple style tags behind the scenes for millions of rules\n- uses `insertRule` for appending in production for *much* faster performance\n\n// usage\n\nimport { StyleSheet } from '@emotion/sheet'\n\nlet styleSheet = new StyleSheet({ key: '', container: document.head })\n\nstyleSheet.insert('#box { border: 1px solid red; }')\n- appends a css rule into the stylesheet\n\nstyleSheet.flush()\n- empties the stylesheet of all its contents\n\n*/ // $FlowFixMe\nfunction $0459ce4c5047536b$var$sheetForTag(tag) {\n    if (tag.sheet) // $FlowFixMe\n    return tag.sheet;\n     // this weirdness brought to you by firefox\n    /* istanbul ignore next */ for(var i = 0; i < document.styleSheets.length; i++){\n        if (document.styleSheets[i].ownerNode === tag) // $FlowFixMe\n        return document.styleSheets[i];\n    }\n}\nfunction $0459ce4c5047536b$var$createStyleElement(options) {\n    var tag = document.createElement(\"style\");\n    tag.setAttribute(\"data-emotion\", options.key);\n    if (options.nonce !== undefined) tag.setAttribute(\"nonce\", options.nonce);\n    tag.appendChild(document.createTextNode(\"\"));\n    tag.setAttribute(\"data-s\", \"\");\n    return tag;\n}\nvar $0459ce4c5047536b$export$9d753cd7ae895cce = /*#__PURE__*/ function() {\n    // Using Node instead of HTMLElement since container may be a ShadowRoot\n    function StyleSheet(options) {\n        var _this = this;\n        this._insertTag = function(tag) {\n            var before;\n            if (_this.tags.length === 0) {\n                if (_this.insertionPoint) before = _this.insertionPoint.nextSibling;\n                else if (_this.prepend) before = _this.container.firstChild;\n                else before = _this.before;\n            } else before = _this.tags[_this.tags.length - 1].nextSibling;\n            _this.container.insertBefore(tag, before);\n            _this.tags.push(tag);\n        };\n        this.isSpeedy = options.speedy === undefined ? true : options.speedy;\n        this.tags = [];\n        this.ctr = 0;\n        this.nonce = options.nonce; // key is the value of the data-emotion attribute, it's used to identify different sheets\n        this.key = options.key;\n        this.container = options.container;\n        this.prepend = options.prepend;\n        this.insertionPoint = options.insertionPoint;\n        this.before = null;\n    }\n    var _proto = StyleSheet.prototype;\n    _proto.hydrate = function hydrate(nodes) {\n        nodes.forEach(this._insertTag);\n    };\n    _proto.insert = function insert(rule) {\n        // the max length is how many rules we have per style tag, it's 65000 in speedy mode\n        // it's 1 in dev because we insert source maps that map a single rule to a location\n        // and you can only have one source map per style tag\n        if (this.ctr % (this.isSpeedy ? 65000 : 1) === 0) this._insertTag($0459ce4c5047536b$var$createStyleElement(this));\n        var tag = this.tags[this.tags.length - 1];\n        var isImportRule;\n        if (this.isSpeedy) {\n            var sheet = $0459ce4c5047536b$var$sheetForTag(tag);\n            try {\n                // this is the ultrafast version, works across browsers\n                // the big drawback is that the css won't be editable in devtools\n                sheet.insertRule(rule, sheet.cssRules.length);\n            } catch (e) {}\n        } else tag.appendChild(document.createTextNode(rule));\n        this.ctr++;\n    };\n    _proto.flush = function flush() {\n        // $FlowFixMe\n        this.tags.forEach(function(tag) {\n            return tag.parentNode && tag.parentNode.removeChild(tag);\n        });\n        this.tags = [];\n        this.ctr = 0;\n    };\n    return StyleSheet;\n}();\n\n});\n\nparcelRegister(\"fOtsb\", function(module, exports) {\n\n$parcel$export(module.exports, \"MS\", function () { return $3e52240dff875db8$export$71ad59f2e432cfe8; });\n$parcel$export(module.exports, \"MOZ\", function () { return $3e52240dff875db8$export$2c0f367103c8d01c; });\n$parcel$export(module.exports, \"WEBKIT\", function () { return $3e52240dff875db8$export$39dfd62a25e0fe93; });\n$parcel$export(module.exports, \"RULESET\", function () { return $3e52240dff875db8$export$aa3a2e812ca8570d; });\n$parcel$export(module.exports, \"DECLARATION\", function () { return $3e52240dff875db8$export$527d108ccf083c2b; });\n$parcel$export(module.exports, \"KEYFRAMES\", function () { return $3e52240dff875db8$export$b44a8529a35fcb60; });\n$parcel$export(module.exports, \"from\", function () { return $3e52240dff875db8$export$6788812c4e6611e6; });\n$parcel$export(module.exports, \"hash\", function () { return $3e52240dff875db8$export$d6af199866bfb566; });\n$parcel$export(module.exports, \"charat\", function () { return $3e52240dff875db8$export$a9db5e087081082d; });\n$parcel$export(module.exports, \"match\", function () { return $3e52240dff875db8$export$4659b591c19bdf3d; });\n$parcel$export(module.exports, \"replace\", function () { return $3e52240dff875db8$export$77ad94ebf1c2b9ed; });\n$parcel$export(module.exports, \"indexof\", function () { return $3e52240dff875db8$export$f8e21b1e77979a08; });\n$parcel$export(module.exports, \"strlen\", function () { return $3e52240dff875db8$export$36776f635604f274; });\n$parcel$export(module.exports, \"combine\", function () { return $3e52240dff875db8$export$1be1fc439b849fdf; });\n$parcel$export(module.exports, \"position\", function () { return $3e52240dff875db8$export$5880b8b5730aff45; });\n$parcel$export(module.exports, \"copy\", function () { return $3e52240dff875db8$export$784d13d8ee351f07; });\n$parcel$export(module.exports, \"next\", function () { return $3e52240dff875db8$export$48cfd1e771a65c4f; });\n$parcel$export(module.exports, \"peek\", function () { return $3e52240dff875db8$export$4d3fb11e950abb9e; });\n$parcel$export(module.exports, \"slice\", function () { return $3e52240dff875db8$export$58adb3bec8346d0f; });\n$parcel$export(module.exports, \"token\", function () { return $3e52240dff875db8$export$9e1725a4cfeada27; });\n$parcel$export(module.exports, \"alloc\", function () { return $3e52240dff875db8$export$2de70f21292aac9e; });\n$parcel$export(module.exports, \"dealloc\", function () { return $3e52240dff875db8$export$45918ac1574455b1; });\n$parcel$export(module.exports, \"delimit\", function () { return $3e52240dff875db8$export$410ac95b9ec204b8; });\n$parcel$export(module.exports, \"compile\", function () { return $3e52240dff875db8$export$ef7acd7185315e22; });\n$parcel$export(module.exports, \"serialize\", function () { return $3e52240dff875db8$export$dfdc1655ccc5b9cb; });\n$parcel$export(module.exports, \"stringify\", function () { return $3e52240dff875db8$export$fac44ee5b035f737; });\n$parcel$export(module.exports, \"middleware\", function () { return $3e52240dff875db8$export$5a7767152ae0305f; });\n$parcel$export(module.exports, \"rulesheet\", function () { return $3e52240dff875db8$export$38bcb760f1d4871c; });\nvar $3e52240dff875db8$export$71ad59f2e432cfe8 = \"-ms-\";\nvar $3e52240dff875db8$export$2c0f367103c8d01c = \"-moz-\";\nvar $3e52240dff875db8$export$39dfd62a25e0fe93 = \"-webkit-\";\nvar $3e52240dff875db8$export$a29989082612d0d9 = \"comm\";\nvar $3e52240dff875db8$export$aa3a2e812ca8570d = \"rule\";\nvar $3e52240dff875db8$export$527d108ccf083c2b = \"decl\";\nvar $3e52240dff875db8$export$d3d35020fa5b54f0 = \"@page\";\nvar $3e52240dff875db8$export$500415a86c544f73 = \"@media\";\nvar $3e52240dff875db8$export$a763edbf796b780a = \"@import\";\nvar $3e52240dff875db8$export$2790aeb8b4e5c826 = \"@charset\";\nvar $3e52240dff875db8$export$1cc683e23b84b133 = \"@viewport\";\nvar $3e52240dff875db8$export$9447a5efea57e862 = \"@supports\";\nvar $3e52240dff875db8$export$ef011b4e114b1fba = \"@document\";\nvar $3e52240dff875db8$export$6aad947bda0f3f46 = \"@namespace\";\nvar $3e52240dff875db8$export$b44a8529a35fcb60 = \"@keyframes\";\nvar $3e52240dff875db8$export$2c16de31893252e6 = \"@font-face\";\nvar $3e52240dff875db8$export$3d846dd52e150c6f = \"@counter-style\";\nvar $3e52240dff875db8$export$22314bfbb57653fe = \"@font-feature-values\";\nvar $3e52240dff875db8$export$d773506282b3cfe6 = \"@layer\";\nvar $3e52240dff875db8$export$2335f513bbd82c6d = Math.abs;\nvar $3e52240dff875db8$export$6788812c4e6611e6 = String.fromCharCode;\nvar $3e52240dff875db8$export$e6e34fd1f2686227 = Object.assign;\nfunction $3e52240dff875db8$export$d6af199866bfb566(e, r) {\n    return $3e52240dff875db8$export$a9db5e087081082d(e, 0) ^ 45 ? (((r << 2 ^ $3e52240dff875db8$export$a9db5e087081082d(e, 0)) << 2 ^ $3e52240dff875db8$export$a9db5e087081082d(e, 1)) << 2 ^ $3e52240dff875db8$export$a9db5e087081082d(e, 2)) << 2 ^ $3e52240dff875db8$export$a9db5e087081082d(e, 3) : 0;\n}\nfunction $3e52240dff875db8$export$87c2784dc9fc4ab(e) {\n    return e.trim();\n}\nfunction $3e52240dff875db8$export$4659b591c19bdf3d(e, r) {\n    return (e = r.exec(e)) ? e[0] : e;\n}\nfunction $3e52240dff875db8$export$77ad94ebf1c2b9ed(e, r, a) {\n    return e.replace(r, a);\n}\nfunction $3e52240dff875db8$export$f8e21b1e77979a08(e, r) {\n    return e.indexOf(r);\n}\nfunction $3e52240dff875db8$export$a9db5e087081082d(e, r) {\n    return e.charCodeAt(r) | 0;\n}\nfunction $3e52240dff875db8$export$2f35ab04d2335697(e, r, a) {\n    return e.slice(r, a);\n}\nfunction $3e52240dff875db8$export$36776f635604f274(e) {\n    return e.length;\n}\nfunction $3e52240dff875db8$export$f9084667e487ed46(e) {\n    return e.length;\n}\nfunction $3e52240dff875db8$export$10d8903dec122b9d(e, r) {\n    return r.push(e), e;\n}\nfunction $3e52240dff875db8$export$1be1fc439b849fdf(e, r) {\n    return e.map(r).join(\"\");\n}\nvar $3e52240dff875db8$export$53f1d5ea8de3d7c = 1;\nvar $3e52240dff875db8$export$4e0c71f277ca26b3 = 1;\nvar $3e52240dff875db8$export$f24224f1c91d8156 = 0;\nvar $3e52240dff875db8$export$5880b8b5730aff45 = 0;\nvar $3e52240dff875db8$export$c0306caf338ac095 = 0;\nvar $3e52240dff875db8$export$30a86d91af8ff6e6 = \"\";\nfunction $3e52240dff875db8$export$35059013cd4a06db(e, r, a, n, c, s, t) {\n    return {\n        value: e,\n        root: r,\n        parent: a,\n        type: n,\n        props: c,\n        children: s,\n        line: $3e52240dff875db8$export$53f1d5ea8de3d7c,\n        column: $3e52240dff875db8$export$4e0c71f277ca26b3,\n        length: t,\n        return: \"\"\n    };\n}\nfunction $3e52240dff875db8$export$784d13d8ee351f07(e, r) {\n    return $3e52240dff875db8$export$e6e34fd1f2686227($3e52240dff875db8$export$35059013cd4a06db(\"\", null, null, \"\", null, null, 0), e, {\n        length: -e.length\n    }, r);\n}\nfunction $3e52240dff875db8$export$eba6f6f03b0a92e7() {\n    return $3e52240dff875db8$export$c0306caf338ac095;\n}\nfunction $3e52240dff875db8$export$232faf9add678146() {\n    $3e52240dff875db8$export$c0306caf338ac095 = $3e52240dff875db8$export$5880b8b5730aff45 > 0 ? $3e52240dff875db8$export$a9db5e087081082d($3e52240dff875db8$export$30a86d91af8ff6e6, --$3e52240dff875db8$export$5880b8b5730aff45) : 0;\n    if ($3e52240dff875db8$export$4e0c71f277ca26b3--, $3e52240dff875db8$export$c0306caf338ac095 === 10) $3e52240dff875db8$export$4e0c71f277ca26b3 = 1, $3e52240dff875db8$export$53f1d5ea8de3d7c--;\n    return $3e52240dff875db8$export$c0306caf338ac095;\n}\nfunction $3e52240dff875db8$export$48cfd1e771a65c4f() {\n    $3e52240dff875db8$export$c0306caf338ac095 = $3e52240dff875db8$export$5880b8b5730aff45 < $3e52240dff875db8$export$f24224f1c91d8156 ? $3e52240dff875db8$export$a9db5e087081082d($3e52240dff875db8$export$30a86d91af8ff6e6, $3e52240dff875db8$export$5880b8b5730aff45++) : 0;\n    if ($3e52240dff875db8$export$4e0c71f277ca26b3++, $3e52240dff875db8$export$c0306caf338ac095 === 10) $3e52240dff875db8$export$4e0c71f277ca26b3 = 1, $3e52240dff875db8$export$53f1d5ea8de3d7c++;\n    return $3e52240dff875db8$export$c0306caf338ac095;\n}\nfunction $3e52240dff875db8$export$4d3fb11e950abb9e() {\n    return $3e52240dff875db8$export$a9db5e087081082d($3e52240dff875db8$export$30a86d91af8ff6e6, $3e52240dff875db8$export$5880b8b5730aff45);\n}\nfunction $3e52240dff875db8$export$e88cb2efb12ae807() {\n    return $3e52240dff875db8$export$5880b8b5730aff45;\n}\nfunction $3e52240dff875db8$export$58adb3bec8346d0f(e, r) {\n    return $3e52240dff875db8$export$2f35ab04d2335697($3e52240dff875db8$export$30a86d91af8ff6e6, e, r);\n}\nfunction $3e52240dff875db8$export$9e1725a4cfeada27(e) {\n    switch(e){\n        case 0:\n        case 9:\n        case 10:\n        case 13:\n        case 32:\n            return 5;\n        case 33:\n        case 43:\n        case 44:\n        case 47:\n        case 62:\n        case 64:\n        case 126:\n        case 59:\n        case 123:\n        case 125:\n            return 4;\n        case 58:\n            return 3;\n        case 34:\n        case 39:\n        case 40:\n        case 91:\n            return 2;\n        case 41:\n        case 93:\n            return 1;\n    }\n    return 0;\n}\nfunction $3e52240dff875db8$export$2de70f21292aac9e(e) {\n    return $3e52240dff875db8$export$53f1d5ea8de3d7c = $3e52240dff875db8$export$4e0c71f277ca26b3 = 1, $3e52240dff875db8$export$f24224f1c91d8156 = $3e52240dff875db8$export$36776f635604f274($3e52240dff875db8$export$30a86d91af8ff6e6 = e), $3e52240dff875db8$export$5880b8b5730aff45 = 0, [];\n}\nfunction $3e52240dff875db8$export$45918ac1574455b1(e) {\n    return $3e52240dff875db8$export$30a86d91af8ff6e6 = \"\", e;\n}\nfunction $3e52240dff875db8$export$410ac95b9ec204b8(e) {\n    return $3e52240dff875db8$export$87c2784dc9fc4ab($3e52240dff875db8$export$58adb3bec8346d0f($3e52240dff875db8$export$5880b8b5730aff45 - 1, $3e52240dff875db8$export$c889f2fcc19dbf12(e === 91 ? e + 2 : e === 40 ? e + 1 : e)));\n}\nfunction $3e52240dff875db8$export$660b2ee2d4fb4eff(e) {\n    return $3e52240dff875db8$export$45918ac1574455b1($3e52240dff875db8$export$5f8c09e3ae6f64e1($3e52240dff875db8$export$2de70f21292aac9e(e)));\n}\nfunction $3e52240dff875db8$export$7af1228ff777d175(e) {\n    while($3e52240dff875db8$export$c0306caf338ac095 = $3e52240dff875db8$export$4d3fb11e950abb9e())if ($3e52240dff875db8$export$c0306caf338ac095 < 33) $3e52240dff875db8$export$48cfd1e771a65c4f();\n    else break;\n    return $3e52240dff875db8$export$9e1725a4cfeada27(e) > 2 || $3e52240dff875db8$export$9e1725a4cfeada27($3e52240dff875db8$export$c0306caf338ac095) > 3 ? \"\" : \" \";\n}\nfunction $3e52240dff875db8$export$5f8c09e3ae6f64e1(e) {\n    while($3e52240dff875db8$export$48cfd1e771a65c4f())switch($3e52240dff875db8$export$9e1725a4cfeada27($3e52240dff875db8$export$c0306caf338ac095)){\n        case 0:\n            $3e52240dff875db8$export$10d8903dec122b9d($3e52240dff875db8$export$c2ab62c7bf24634($3e52240dff875db8$export$5880b8b5730aff45 - 1), e);\n            break;\n        case 2:\n            $3e52240dff875db8$export$10d8903dec122b9d($3e52240dff875db8$export$410ac95b9ec204b8($3e52240dff875db8$export$c0306caf338ac095), e);\n            break;\n        default:\n            $3e52240dff875db8$export$10d8903dec122b9d($3e52240dff875db8$export$6788812c4e6611e6($3e52240dff875db8$export$c0306caf338ac095), e);\n    }\n    return e;\n}\nfunction $3e52240dff875db8$export$955ba06d119e085e(e, r) {\n    while(--r && $3e52240dff875db8$export$48cfd1e771a65c4f())if ($3e52240dff875db8$export$c0306caf338ac095 < 48 || $3e52240dff875db8$export$c0306caf338ac095 > 102 || $3e52240dff875db8$export$c0306caf338ac095 > 57 && $3e52240dff875db8$export$c0306caf338ac095 < 65 || $3e52240dff875db8$export$c0306caf338ac095 > 70 && $3e52240dff875db8$export$c0306caf338ac095 < 97) break;\n    return $3e52240dff875db8$export$58adb3bec8346d0f(e, $3e52240dff875db8$export$e88cb2efb12ae807() + (r < 6 && $3e52240dff875db8$export$4d3fb11e950abb9e() == 32 && $3e52240dff875db8$export$48cfd1e771a65c4f() == 32));\n}\nfunction $3e52240dff875db8$export$c889f2fcc19dbf12(e) {\n    while($3e52240dff875db8$export$48cfd1e771a65c4f())switch($3e52240dff875db8$export$c0306caf338ac095){\n        case e:\n            return $3e52240dff875db8$export$5880b8b5730aff45;\n        case 34:\n        case 39:\n            if (e !== 34 && e !== 39) $3e52240dff875db8$export$c889f2fcc19dbf12($3e52240dff875db8$export$c0306caf338ac095);\n            break;\n        case 40:\n            if (e === 41) $3e52240dff875db8$export$c889f2fcc19dbf12(e);\n            break;\n        case 92:\n            $3e52240dff875db8$export$48cfd1e771a65c4f();\n            break;\n    }\n    return $3e52240dff875db8$export$5880b8b5730aff45;\n}\nfunction $3e52240dff875db8$export$4254d4e2b3745c4c(e, r) {\n    while($3e52240dff875db8$export$48cfd1e771a65c4f())if (e + $3e52240dff875db8$export$c0306caf338ac095 === 57) break;\n    else if (e + $3e52240dff875db8$export$c0306caf338ac095 === 84 && $3e52240dff875db8$export$4d3fb11e950abb9e() === 47) break;\n    return \"/*\" + $3e52240dff875db8$export$58adb3bec8346d0f(r, $3e52240dff875db8$export$5880b8b5730aff45 - 1) + \"*\" + $3e52240dff875db8$export$6788812c4e6611e6(e === 47 ? e : $3e52240dff875db8$export$48cfd1e771a65c4f());\n}\nfunction $3e52240dff875db8$export$c2ab62c7bf24634(e) {\n    while(!$3e52240dff875db8$export$9e1725a4cfeada27($3e52240dff875db8$export$4d3fb11e950abb9e()))$3e52240dff875db8$export$48cfd1e771a65c4f();\n    return $3e52240dff875db8$export$58adb3bec8346d0f(e, $3e52240dff875db8$export$5880b8b5730aff45);\n}\nfunction $3e52240dff875db8$export$ef7acd7185315e22(e) {\n    return $3e52240dff875db8$export$45918ac1574455b1($3e52240dff875db8$export$98e6a39c04603d36(\"\", null, null, null, [\n        \"\"\n    ], e = $3e52240dff875db8$export$2de70f21292aac9e(e), 0, [\n        0\n    ], e));\n}\nfunction $3e52240dff875db8$export$98e6a39c04603d36(e, r, a, n, c, s, t, u, i) {\n    var f = 0;\n    var o = 0;\n    var l = t;\n    var v = 0;\n    var p = 0;\n    var h = 0;\n    var b = 1;\n    var w = 1;\n    var d = 1;\n    var $ = 0;\n    var g = \"\";\n    var m = c;\n    var x = s;\n    var y = n;\n    var j = g;\n    while(w)switch(h = $, $ = $3e52240dff875db8$export$48cfd1e771a65c4f()){\n        case 40:\n            if (h != 108 && $3e52240dff875db8$export$a9db5e087081082d(j, l - 1) == 58) {\n                if ($3e52240dff875db8$export$f8e21b1e77979a08(j += $3e52240dff875db8$export$77ad94ebf1c2b9ed($3e52240dff875db8$export$410ac95b9ec204b8($), \"&\", \"&\\f\"), \"&\\f\") != -1) d = -1;\n                break;\n            }\n        case 34:\n        case 39:\n        case 91:\n            j += $3e52240dff875db8$export$410ac95b9ec204b8($);\n            break;\n        case 9:\n        case 10:\n        case 13:\n        case 32:\n            j += $3e52240dff875db8$export$7af1228ff777d175(h);\n            break;\n        case 92:\n            j += $3e52240dff875db8$export$955ba06d119e085e($3e52240dff875db8$export$e88cb2efb12ae807() - 1, 7);\n            continue;\n        case 47:\n            switch($3e52240dff875db8$export$4d3fb11e950abb9e()){\n                case 42:\n                case 47:\n                    $3e52240dff875db8$export$10d8903dec122b9d($3e52240dff875db8$export$4a34f930e789283c($3e52240dff875db8$export$4254d4e2b3745c4c($3e52240dff875db8$export$48cfd1e771a65c4f(), $3e52240dff875db8$export$e88cb2efb12ae807()), r, a), i);\n                    break;\n                default:\n                    j += \"/\";\n            }\n            break;\n        case 123 * b:\n            u[f++] = $3e52240dff875db8$export$36776f635604f274(j) * d;\n        case 125 * b:\n        case 59:\n        case 0:\n            switch($){\n                case 0:\n                case 125:\n                    w = 0;\n                case 59 + o:\n                    if (d == -1) j = $3e52240dff875db8$export$77ad94ebf1c2b9ed(j, /\\f/g, \"\");\n                    if (p > 0 && $3e52240dff875db8$export$36776f635604f274(j) - l) $3e52240dff875db8$export$10d8903dec122b9d(p > 32 ? $3e52240dff875db8$export$f8483753829ec8f3(j + \";\", n, a, l - 1) : $3e52240dff875db8$export$f8483753829ec8f3($3e52240dff875db8$export$77ad94ebf1c2b9ed(j, \" \", \"\") + \";\", n, a, l - 2), i);\n                    break;\n                case 59:\n                    j += \";\";\n                default:\n                    $3e52240dff875db8$export$10d8903dec122b9d(y = $3e52240dff875db8$export$3307ffa7023ede1e(j, r, a, f, o, c, u, g, m = [], x = [], l), s);\n                    if ($ === 123) {\n                        if (o === 0) $3e52240dff875db8$export$98e6a39c04603d36(j, r, y, y, m, s, l, u, x);\n                        else switch(v === 99 && $3e52240dff875db8$export$a9db5e087081082d(j, 3) === 110 ? 100 : v){\n                            case 100:\n                            case 108:\n                            case 109:\n                            case 115:\n                                $3e52240dff875db8$export$98e6a39c04603d36(e, y, y, n && $3e52240dff875db8$export$10d8903dec122b9d($3e52240dff875db8$export$3307ffa7023ede1e(e, y, y, 0, 0, c, u, g, c, m = [], l), x), c, x, l, u, n ? m : x);\n                                break;\n                            default:\n                                $3e52240dff875db8$export$98e6a39c04603d36(j, y, y, y, [\n                                    \"\"\n                                ], x, 0, u, x);\n                        }\n                    }\n            }\n            f = o = p = 0, b = d = 1, g = j = \"\", l = t;\n            break;\n        case 58:\n            l = 1 + $3e52240dff875db8$export$36776f635604f274(j), p = h;\n        default:\n            if (b < 1) {\n                if ($ == 123) --b;\n                else if ($ == 125 && b++ == 0 && $3e52240dff875db8$export$232faf9add678146() == 125) continue;\n            }\n            switch(j += $3e52240dff875db8$export$6788812c4e6611e6($), $ * b){\n                case 38:\n                    d = o > 0 ? 1 : (j += \"\\f\", -1);\n                    break;\n                case 44:\n                    u[f++] = ($3e52240dff875db8$export$36776f635604f274(j) - 1) * d, d = 1;\n                    break;\n                case 64:\n                    if ($3e52240dff875db8$export$4d3fb11e950abb9e() === 45) j += $3e52240dff875db8$export$410ac95b9ec204b8($3e52240dff875db8$export$48cfd1e771a65c4f());\n                    v = $3e52240dff875db8$export$4d3fb11e950abb9e(), o = l = $3e52240dff875db8$export$36776f635604f274(g = j += $3e52240dff875db8$export$c2ab62c7bf24634($3e52240dff875db8$export$e88cb2efb12ae807())), $++;\n                    break;\n                case 45:\n                    if (h === 45 && $3e52240dff875db8$export$36776f635604f274(j) == 2) b = 0;\n            }\n    }\n    return s;\n}\nfunction $3e52240dff875db8$export$3307ffa7023ede1e(e, r, a, n, s, t, u, i, f, o, l) {\n    var v = s - 1;\n    var p = s === 0 ? t : [\n        \"\"\n    ];\n    var h = $3e52240dff875db8$export$f9084667e487ed46(p);\n    for(var b = 0, w = 0, d = 0; b < n; ++b)for(var $ = 0, k = $3e52240dff875db8$export$2f35ab04d2335697(e, v + 1, v = $3e52240dff875db8$export$2335f513bbd82c6d(w = u[b])), m = e; $ < h; ++$)if (m = $3e52240dff875db8$export$87c2784dc9fc4ab(w > 0 ? p[$] + \" \" + k : $3e52240dff875db8$export$77ad94ebf1c2b9ed(k, /&\\f/g, p[$]))) f[d++] = m;\n    return $3e52240dff875db8$export$35059013cd4a06db(e, r, a, s === 0 ? $3e52240dff875db8$export$aa3a2e812ca8570d : i, f, o, l);\n}\nfunction $3e52240dff875db8$export$4a34f930e789283c(e, r, a) {\n    return $3e52240dff875db8$export$35059013cd4a06db(e, r, a, $3e52240dff875db8$export$a29989082612d0d9, $3e52240dff875db8$export$6788812c4e6611e6($3e52240dff875db8$export$eba6f6f03b0a92e7()), $3e52240dff875db8$export$2f35ab04d2335697(e, 2, -2), 0);\n}\nfunction $3e52240dff875db8$export$f8483753829ec8f3(e, r, a, n) {\n    return $3e52240dff875db8$export$35059013cd4a06db(e, r, a, $3e52240dff875db8$export$527d108ccf083c2b, $3e52240dff875db8$export$2f35ab04d2335697(e, 0, n), $3e52240dff875db8$export$2f35ab04d2335697(e, n + 1, -1), n);\n}\nfunction $3e52240dff875db8$export$82e9f45cca5ba907(n, c, s) {\n    switch($3e52240dff875db8$export$d6af199866bfb566(n, c)){\n        case 5103:\n            return $3e52240dff875db8$export$39dfd62a25e0fe93 + \"print-\" + n + n;\n        case 5737:\n        case 4201:\n        case 3177:\n        case 3433:\n        case 1641:\n        case 4457:\n        case 2921:\n        case 5572:\n        case 6356:\n        case 5844:\n        case 3191:\n        case 6645:\n        case 3005:\n        case 6391:\n        case 5879:\n        case 5623:\n        case 6135:\n        case 4599:\n        case 4855:\n        case 4215:\n        case 6389:\n        case 5109:\n        case 5365:\n        case 5621:\n        case 3829:\n            return $3e52240dff875db8$export$39dfd62a25e0fe93 + n + n;\n        case 4789:\n            return $3e52240dff875db8$export$2c0f367103c8d01c + n + n;\n        case 5349:\n        case 4246:\n        case 4810:\n        case 6968:\n        case 2756:\n            return $3e52240dff875db8$export$39dfd62a25e0fe93 + n + $3e52240dff875db8$export$2c0f367103c8d01c + n + $3e52240dff875db8$export$71ad59f2e432cfe8 + n + n;\n        case 5936:\n            switch($3e52240dff875db8$export$a9db5e087081082d(n, c + 11)){\n                case 114:\n                    return $3e52240dff875db8$export$39dfd62a25e0fe93 + n + $3e52240dff875db8$export$71ad59f2e432cfe8 + $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, /[svh]\\w+-[tblr]{2}/, \"tb\") + n;\n                case 108:\n                    return $3e52240dff875db8$export$39dfd62a25e0fe93 + n + $3e52240dff875db8$export$71ad59f2e432cfe8 + $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, /[svh]\\w+-[tblr]{2}/, \"tb-rl\") + n;\n                case 45:\n                    return $3e52240dff875db8$export$39dfd62a25e0fe93 + n + $3e52240dff875db8$export$71ad59f2e432cfe8 + $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, /[svh]\\w+-[tblr]{2}/, \"lr\") + n;\n            }\n        case 6828:\n        case 4268:\n        case 2903:\n            return $3e52240dff875db8$export$39dfd62a25e0fe93 + n + $3e52240dff875db8$export$71ad59f2e432cfe8 + n + n;\n        case 6165:\n            return $3e52240dff875db8$export$39dfd62a25e0fe93 + n + $3e52240dff875db8$export$71ad59f2e432cfe8 + \"flex-\" + n + n;\n        case 5187:\n            return $3e52240dff875db8$export$39dfd62a25e0fe93 + n + $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, /(\\w+).+(:[^]+)/, $3e52240dff875db8$export$39dfd62a25e0fe93 + \"box-$1$2\" + $3e52240dff875db8$export$71ad59f2e432cfe8 + \"flex-$1$2\") + n;\n        case 5443:\n            return $3e52240dff875db8$export$39dfd62a25e0fe93 + n + $3e52240dff875db8$export$71ad59f2e432cfe8 + \"flex-item-\" + $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, /flex-|-self/g, \"\") + (!$3e52240dff875db8$export$4659b591c19bdf3d(n, /flex-|baseline/) ? $3e52240dff875db8$export$71ad59f2e432cfe8 + \"grid-row-\" + $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, /flex-|-self/g, \"\") : \"\") + n;\n        case 4675:\n            return $3e52240dff875db8$export$39dfd62a25e0fe93 + n + $3e52240dff875db8$export$71ad59f2e432cfe8 + \"flex-line-pack\" + $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, /align-content|flex-|-self/g, \"\") + n;\n        case 5548:\n            return $3e52240dff875db8$export$39dfd62a25e0fe93 + n + $3e52240dff875db8$export$71ad59f2e432cfe8 + $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, \"shrink\", \"negative\") + n;\n        case 5292:\n            return $3e52240dff875db8$export$39dfd62a25e0fe93 + n + $3e52240dff875db8$export$71ad59f2e432cfe8 + $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, \"basis\", \"preferred-size\") + n;\n        case 6060:\n            return $3e52240dff875db8$export$39dfd62a25e0fe93 + \"box-\" + $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, \"-grow\", \"\") + $3e52240dff875db8$export$39dfd62a25e0fe93 + n + $3e52240dff875db8$export$71ad59f2e432cfe8 + $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, \"grow\", \"positive\") + n;\n        case 4554:\n            return $3e52240dff875db8$export$39dfd62a25e0fe93 + $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, /([^-])(transform)/g, \"$1\" + $3e52240dff875db8$export$39dfd62a25e0fe93 + \"$2\") + n;\n        case 6187:\n            return $3e52240dff875db8$export$77ad94ebf1c2b9ed($3e52240dff875db8$export$77ad94ebf1c2b9ed($3e52240dff875db8$export$77ad94ebf1c2b9ed(n, /(zoom-|grab)/, $3e52240dff875db8$export$39dfd62a25e0fe93 + \"$1\"), /(image-set)/, $3e52240dff875db8$export$39dfd62a25e0fe93 + \"$1\"), n, \"\") + n;\n        case 5495:\n        case 3959:\n            return $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, /(image-set\\([^]*)/, $3e52240dff875db8$export$39dfd62a25e0fe93 + \"$1\" + \"$`$1\");\n        case 4968:\n            return $3e52240dff875db8$export$77ad94ebf1c2b9ed($3e52240dff875db8$export$77ad94ebf1c2b9ed(n, /(.+:)(flex-)?(.*)/, $3e52240dff875db8$export$39dfd62a25e0fe93 + \"box-pack:$3\" + $3e52240dff875db8$export$71ad59f2e432cfe8 + \"flex-pack:$3\"), /s.+-b[^;]+/, \"justify\") + $3e52240dff875db8$export$39dfd62a25e0fe93 + n + n;\n        case 4200:\n            if (!$3e52240dff875db8$export$4659b591c19bdf3d(n, /flex-|baseline/)) return $3e52240dff875db8$export$71ad59f2e432cfe8 + \"grid-column-align\" + $3e52240dff875db8$export$2f35ab04d2335697(n, c) + n;\n            break;\n        case 2592:\n        case 3360:\n            return $3e52240dff875db8$export$71ad59f2e432cfe8 + $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, \"template-\", \"\") + n;\n        case 4384:\n        case 3616:\n            if (s && s.some(function(e, r) {\n                return c = r, $3e52240dff875db8$export$4659b591c19bdf3d(e.props, /grid-\\w+-end/);\n            })) return ~$3e52240dff875db8$export$f8e21b1e77979a08(n + (s = s[c].value), \"span\") ? n : $3e52240dff875db8$export$71ad59f2e432cfe8 + $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, \"-start\", \"\") + n + $3e52240dff875db8$export$71ad59f2e432cfe8 + \"grid-row-span:\" + (~$3e52240dff875db8$export$f8e21b1e77979a08(s, \"span\") ? $3e52240dff875db8$export$4659b591c19bdf3d(s, /\\d+/) : +$3e52240dff875db8$export$4659b591c19bdf3d(s, /\\d+/) - +$3e52240dff875db8$export$4659b591c19bdf3d(n, /\\d+/)) + \";\";\n            return $3e52240dff875db8$export$71ad59f2e432cfe8 + $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, \"-start\", \"\") + n;\n        case 4896:\n        case 4128:\n            return s && s.some(function(e) {\n                return $3e52240dff875db8$export$4659b591c19bdf3d(e.props, /grid-\\w+-start/);\n            }) ? n : $3e52240dff875db8$export$71ad59f2e432cfe8 + $3e52240dff875db8$export$77ad94ebf1c2b9ed($3e52240dff875db8$export$77ad94ebf1c2b9ed(n, \"-end\", \"-span\"), \"span \", \"\") + n;\n        case 4095:\n        case 3583:\n        case 4068:\n        case 2532:\n            return $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, /(.+)-inline(.+)/, $3e52240dff875db8$export$39dfd62a25e0fe93 + \"$1$2\") + n;\n        case 8116:\n        case 7059:\n        case 5753:\n        case 5535:\n        case 5445:\n        case 5701:\n        case 4933:\n        case 4677:\n        case 5533:\n        case 5789:\n        case 5021:\n        case 4765:\n            if ($3e52240dff875db8$export$36776f635604f274(n) - 1 - c > 6) switch($3e52240dff875db8$export$a9db5e087081082d(n, c + 1)){\n                case 109:\n                    if ($3e52240dff875db8$export$a9db5e087081082d(n, c + 4) !== 45) break;\n                case 102:\n                    return $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, /(.+:)(.+)-([^]+)/, \"$1\" + $3e52240dff875db8$export$39dfd62a25e0fe93 + \"$2-$3\" + \"$1\" + $3e52240dff875db8$export$2c0f367103c8d01c + ($3e52240dff875db8$export$a9db5e087081082d(n, c + 3) == 108 ? \"$3\" : \"$2-$3\")) + n;\n                case 115:\n                    return ~$3e52240dff875db8$export$f8e21b1e77979a08(n, \"stretch\") ? $3e52240dff875db8$export$82e9f45cca5ba907($3e52240dff875db8$export$77ad94ebf1c2b9ed(n, \"stretch\", \"fill-available\"), c, s) + n : n;\n            }\n            break;\n        case 5152:\n        case 5920:\n            return $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, /(.+?):(\\d+)(\\s*\\/\\s*(span)?\\s*(\\d+))?(.*)/, function(r, a, c, s, t, u, i) {\n                return $3e52240dff875db8$export$71ad59f2e432cfe8 + a + \":\" + c + i + (s ? $3e52240dff875db8$export$71ad59f2e432cfe8 + a + \"-span:\" + (t ? u : +u - +c) + i : \"\") + n;\n            });\n        case 4949:\n            if ($3e52240dff875db8$export$a9db5e087081082d(n, c + 6) === 121) return $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, \":\", \":\" + $3e52240dff875db8$export$39dfd62a25e0fe93) + n;\n            break;\n        case 6444:\n            switch($3e52240dff875db8$export$a9db5e087081082d(n, $3e52240dff875db8$export$a9db5e087081082d(n, 14) === 45 ? 18 : 11)){\n                case 120:\n                    return $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, /(.+:)([^;\\s!]+)(;|(\\s+)?!.+)?/, \"$1\" + $3e52240dff875db8$export$39dfd62a25e0fe93 + ($3e52240dff875db8$export$a9db5e087081082d(n, 14) === 45 ? \"inline-\" : \"\") + \"box$3\" + \"$1\" + $3e52240dff875db8$export$39dfd62a25e0fe93 + \"$2$3\" + \"$1\" + $3e52240dff875db8$export$71ad59f2e432cfe8 + \"$2box$3\") + n;\n                case 100:\n                    return $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, \":\", \":\" + $3e52240dff875db8$export$71ad59f2e432cfe8) + n;\n            }\n            break;\n        case 5719:\n        case 2647:\n        case 2135:\n        case 3927:\n        case 2391:\n            return $3e52240dff875db8$export$77ad94ebf1c2b9ed(n, \"scroll-\", \"scroll-snap-\") + n;\n    }\n    return n;\n}\nfunction $3e52240dff875db8$export$dfdc1655ccc5b9cb(e, r) {\n    var a = \"\";\n    var n = $3e52240dff875db8$export$f9084667e487ed46(e);\n    for(var c = 0; c < n; c++)a += r(e[c], c, e, r) || \"\";\n    return a;\n}\nfunction $3e52240dff875db8$export$fac44ee5b035f737(e, r, a, t) {\n    switch(e.type){\n        case $3e52240dff875db8$export$d773506282b3cfe6:\n            if (e.children.length) break;\n        case $3e52240dff875db8$export$a763edbf796b780a:\n        case $3e52240dff875db8$export$527d108ccf083c2b:\n            return e.return = e.return || e.value;\n        case $3e52240dff875db8$export$a29989082612d0d9:\n            return \"\";\n        case $3e52240dff875db8$export$b44a8529a35fcb60:\n            return e.return = e.value + \"{\" + $3e52240dff875db8$export$dfdc1655ccc5b9cb(e.children, t) + \"}\";\n        case $3e52240dff875db8$export$aa3a2e812ca8570d:\n            e.value = e.props.join(\",\");\n    }\n    return $3e52240dff875db8$export$36776f635604f274(a = $3e52240dff875db8$export$dfdc1655ccc5b9cb(e.children, t)) ? e.return = e.value + \"{\" + a + \"}\" : \"\";\n}\nfunction $3e52240dff875db8$export$5a7767152ae0305f(e) {\n    var r = $3e52240dff875db8$export$f9084667e487ed46(e);\n    return function(a, n, c, s) {\n        var t = \"\";\n        for(var u = 0; u < r; u++)t += e[u](a, n, c, s) || \"\";\n        return t;\n    };\n}\nfunction $3e52240dff875db8$export$38bcb760f1d4871c(e) {\n    return function(r) {\n        if (!r.root) {\n            if (r = r.return) e(r);\n        }\n    };\n}\nfunction $3e52240dff875db8$export$e08c7d021b829b7a(n, t, u, i) {\n    if (n.length > -1) {\n        if (!n.return) switch(n.type){\n            case $3e52240dff875db8$export$527d108ccf083c2b:\n                n.return = $3e52240dff875db8$export$82e9f45cca5ba907(n.value, n.length, u);\n                return;\n            case $3e52240dff875db8$export$b44a8529a35fcb60:\n                return $3e52240dff875db8$export$dfdc1655ccc5b9cb([\n                    $3e52240dff875db8$export$784d13d8ee351f07(n, {\n                        value: $3e52240dff875db8$export$77ad94ebf1c2b9ed(n.value, \"@\", \"@\" + $3e52240dff875db8$export$39dfd62a25e0fe93)\n                    })\n                ], i);\n            case $3e52240dff875db8$export$aa3a2e812ca8570d:\n                if (n.length) return $3e52240dff875db8$export$1be1fc439b849fdf(n.props, function(c) {\n                    switch($3e52240dff875db8$export$4659b591c19bdf3d(c, /(::plac\\w+|:read-\\w+)/)){\n                        case \":read-only\":\n                        case \":read-write\":\n                            return $3e52240dff875db8$export$dfdc1655ccc5b9cb([\n                                $3e52240dff875db8$export$784d13d8ee351f07(n, {\n                                    props: [\n                                        $3e52240dff875db8$export$77ad94ebf1c2b9ed(c, /:(read-\\w+)/, \":\" + $3e52240dff875db8$export$2c0f367103c8d01c + \"$1\")\n                                    ]\n                                })\n                            ], i);\n                        case \"::placeholder\":\n                            return $3e52240dff875db8$export$dfdc1655ccc5b9cb([\n                                $3e52240dff875db8$export$784d13d8ee351f07(n, {\n                                    props: [\n                                        $3e52240dff875db8$export$77ad94ebf1c2b9ed(c, /:(plac\\w+)/, \":\" + $3e52240dff875db8$export$39dfd62a25e0fe93 + \"input-$1\")\n                                    ]\n                                }),\n                                $3e52240dff875db8$export$784d13d8ee351f07(n, {\n                                    props: [\n                                        $3e52240dff875db8$export$77ad94ebf1c2b9ed(c, /:(plac\\w+)/, \":\" + $3e52240dff875db8$export$2c0f367103c8d01c + \"$1\")\n                                    ]\n                                }),\n                                $3e52240dff875db8$export$784d13d8ee351f07(n, {\n                                    props: [\n                                        $3e52240dff875db8$export$77ad94ebf1c2b9ed(c, /:(plac\\w+)/, $3e52240dff875db8$export$71ad59f2e432cfe8 + \"input-$1\")\n                                    ]\n                                })\n                            ], i);\n                    }\n                    return \"\";\n                });\n        }\n    }\n}\nfunction $3e52240dff875db8$export$76a88f7de6507443(e) {\n    switch(e.type){\n        case $3e52240dff875db8$export$aa3a2e812ca8570d:\n            e.props = e.props.map(function(r) {\n                return $3e52240dff875db8$export$1be1fc439b849fdf($3e52240dff875db8$export$660b2ee2d4fb4eff(r), function(r, a, n) {\n                    switch($3e52240dff875db8$export$a9db5e087081082d(r, 0)){\n                        case 12:\n                            return $3e52240dff875db8$export$2f35ab04d2335697(r, 1, $3e52240dff875db8$export$36776f635604f274(r));\n                        case 0:\n                        case 40:\n                        case 43:\n                        case 62:\n                        case 126:\n                            return r;\n                        case 58:\n                            if (n[++a] === \"global\") n[a] = \"\", n[++a] = \"\\f\" + $3e52240dff875db8$export$2f35ab04d2335697(n[a], a = 1, -1);\n                        case 32:\n                            return a === 1 ? \"\" : r;\n                        default:\n                            switch(a){\n                                case 0:\n                                    e = r;\n                                    return $3e52240dff875db8$export$f9084667e487ed46(n) > 1 ? \"\" : r;\n                                case a = $3e52240dff875db8$export$f9084667e487ed46(n) - 1:\n                                case 2:\n                                    return a === 2 ? r + e + e : r + e;\n                                default:\n                                    return r;\n                            }\n                    }\n                });\n            });\n    }\n}\n\n});\n\nparcelRegister(\"irnze\", function(module, exports) {\nvar $d6cd0798f5625022$export$2e2bcd8739ae039 = function weakMemoize(func) {\n    // $FlowFixMe flow doesn't include all non-primitive types as allowed for weakmaps\n    var cache = new WeakMap();\n    return function(arg) {\n        if (cache.has(arg)) // $FlowFixMe\n        return cache.get(arg);\n        var ret = func(arg);\n        cache.set(arg, ret);\n        return ret;\n    };\n};\n\n});\n\nparcelRegister(\"tBGmN\", function(module, exports) {\n\n$parcel$export(module.exports, \"default\", function () { return $058ff0798b669563$export$2e2bcd8739ae039; });\nfunction $058ff0798b669563$export$2e2bcd8739ae039(fn) {\n    var cache = Object.create(null);\n    return function(arg) {\n        if (cache[arg] === undefined) cache[arg] = fn(arg);\n        return cache[arg];\n    };\n}\n\n});\n\n\nparcelRegister(\"7YdyD\", function(module, exports) {\n\n$parcel$export(module.exports, \"serializeStyles\", function () { return $5cd8a743d76500ca$export$6321afa313b251b5; });\n\nvar $9Z4kD = parcelRequire(\"9Z4kD\");\n\nvar $6mYn6 = parcelRequire(\"6mYn6\");\n\nvar $tBGmN = parcelRequire(\"tBGmN\");\nvar $5cd8a743d76500ca$var$ILLEGAL_ESCAPE_SEQUENCE_ERROR = \"You have illegal escape sequence in your template literal, most likely inside content's property value.\\nBecause you write your CSS inside a JavaScript string you actually have to do double escaping, so for example \\\"content: '\\\\00d7';\\\" should become \\\"content: '\\\\\\\\00d7';\\\".\\nYou can read more about this here:\\nhttps://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#ES2018_revision_of_illegal_escape_sequences\";\nvar $5cd8a743d76500ca$var$UNDEFINED_AS_OBJECT_KEY_ERROR = \"You have passed in falsy value as style object's key (can happen when in example you pass unexported component as computed key).\";\nvar $5cd8a743d76500ca$var$hyphenateRegex = /[A-Z]|^ms/g;\nvar $5cd8a743d76500ca$var$animationRegex = /_EMO_([^_]+?)_([^]*?)_EMO_/g;\nvar $5cd8a743d76500ca$var$isCustomProperty = function isCustomProperty(property) {\n    return property.charCodeAt(1) === 45;\n};\nvar $5cd8a743d76500ca$var$isProcessableValue = function isProcessableValue(value) {\n    return value != null && typeof value !== \"boolean\";\n};\nvar $5cd8a743d76500ca$var$processStyleName = /* #__PURE__ */ (0, $tBGmN.default)(function(styleName) {\n    return $5cd8a743d76500ca$var$isCustomProperty(styleName) ? styleName : styleName.replace($5cd8a743d76500ca$var$hyphenateRegex, \"-$&\").toLowerCase();\n});\nvar $5cd8a743d76500ca$var$processStyleValue = function processStyleValue(key, value) {\n    switch(key){\n        case \"animation\":\n        case \"animationName\":\n            if (typeof value === \"string\") return value.replace($5cd8a743d76500ca$var$animationRegex, function(match, p1, p2) {\n                $5cd8a743d76500ca$var$cursor = {\n                    name: p1,\n                    styles: p2,\n                    next: $5cd8a743d76500ca$var$cursor\n                };\n                return p1;\n            });\n    }\n    if ((0, $6mYn6.default)[key] !== 1 && !$5cd8a743d76500ca$var$isCustomProperty(key) && typeof value === \"number\" && value !== 0) return value + \"px\";\n    return value;\n};\nvar $5cd8a743d76500ca$var$contentValuePattern, $5cd8a743d76500ca$var$contentValues, $5cd8a743d76500ca$var$oldProcessStyleValue, $5cd8a743d76500ca$var$msPattern, $5cd8a743d76500ca$var$hyphenPattern, $5cd8a743d76500ca$var$hyphenatedCache;\nvar $5cd8a743d76500ca$var$noComponentSelectorMessage = \"Component selectors can only be used in conjunction with @emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware compiler transform.\";\nfunction $5cd8a743d76500ca$var$handleInterpolation(mergedProps, registered, interpolation) {\n    if (interpolation == null) return \"\";\n    if (interpolation.__emotion_styles !== undefined) return interpolation;\n    switch(typeof interpolation){\n        case \"boolean\":\n            return \"\";\n        case \"object\":\n            if (interpolation.anim === 1) {\n                $5cd8a743d76500ca$var$cursor = {\n                    name: interpolation.name,\n                    styles: interpolation.styles,\n                    next: $5cd8a743d76500ca$var$cursor\n                };\n                return interpolation.name;\n            }\n            if (interpolation.styles !== undefined) {\n                var next = interpolation.next;\n                if (next !== undefined) // not the most efficient thing ever but this is a pretty rare case\n                // and there will be very few iterations of this generally\n                while(next !== undefined){\n                    $5cd8a743d76500ca$var$cursor = {\n                        name: next.name,\n                        styles: next.styles,\n                        next: $5cd8a743d76500ca$var$cursor\n                    };\n                    next = next.next;\n                }\n                var styles = interpolation.styles + \";\";\n                return styles;\n            }\n            return $5cd8a743d76500ca$var$createStringFromObject(mergedProps, registered, interpolation);\n        case \"function\":\n            if (mergedProps !== undefined) {\n                var previousCursor = $5cd8a743d76500ca$var$cursor;\n                var result = interpolation(mergedProps);\n                $5cd8a743d76500ca$var$cursor = previousCursor;\n                return $5cd8a743d76500ca$var$handleInterpolation(mergedProps, registered, result);\n            }\n            break;\n        case \"string\":\n            var matched, replaced;\n            break;\n    } // finalize string values (regular strings and functions interpolated into css calls)\n    if (registered == null) return interpolation;\n    var cached = registered[interpolation];\n    return cached !== undefined ? cached : interpolation;\n}\nfunction $5cd8a743d76500ca$var$createStringFromObject(mergedProps, registered, obj) {\n    var string = \"\";\n    if (Array.isArray(obj)) for(var i = 0; i < obj.length; i++)string += $5cd8a743d76500ca$var$handleInterpolation(mergedProps, registered, obj[i]) + \";\";\n    else for(var _key in obj){\n        var value = obj[_key];\n        if (typeof value !== \"object\") {\n            if (registered != null && registered[value] !== undefined) string += _key + \"{\" + registered[value] + \"}\";\n            else if ($5cd8a743d76500ca$var$isProcessableValue(value)) string += $5cd8a743d76500ca$var$processStyleName(_key) + \":\" + $5cd8a743d76500ca$var$processStyleValue(_key, value) + \";\";\n        } else if (Array.isArray(value) && typeof value[0] === \"string\" && (registered == null || registered[value[0]] === undefined)) {\n            for(var _i = 0; _i < value.length; _i++)if ($5cd8a743d76500ca$var$isProcessableValue(value[_i])) string += $5cd8a743d76500ca$var$processStyleName(_key) + \":\" + $5cd8a743d76500ca$var$processStyleValue(_key, value[_i]) + \";\";\n        } else {\n            var interpolated = $5cd8a743d76500ca$var$handleInterpolation(mergedProps, registered, value);\n            switch(_key){\n                case \"animation\":\n                case \"animationName\":\n                    string += $5cd8a743d76500ca$var$processStyleName(_key) + \":\" + interpolated + \";\";\n                    break;\n                default:\n                    string += _key + \"{\" + interpolated + \"}\";\n            }\n        }\n    }\n    return string;\n}\nvar $5cd8a743d76500ca$var$labelPattern = /label:\\s*([^\\s;\\n{]+)\\s*(;|$)/g;\nvar $5cd8a743d76500ca$var$sourceMapPattern;\n// keyframes are stored on the SerializedStyles object as a linked list\nvar $5cd8a743d76500ca$var$cursor;\nvar $5cd8a743d76500ca$export$6321afa313b251b5 = function serializeStyles(args, registered, mergedProps) {\n    if (args.length === 1 && typeof args[0] === \"object\" && args[0] !== null && args[0].styles !== undefined) return args[0];\n    var stringMode = true;\n    var styles = \"\";\n    $5cd8a743d76500ca$var$cursor = undefined;\n    var strings = args[0];\n    if (strings == null || strings.raw === undefined) {\n        stringMode = false;\n        styles += $5cd8a743d76500ca$var$handleInterpolation(mergedProps, registered, strings);\n    } else styles += strings[0];\n     // we start at 1 since we've already handled the first arg\n    for(var i = 1; i < args.length; i++){\n        styles += $5cd8a743d76500ca$var$handleInterpolation(mergedProps, registered, args[i]);\n        if (stringMode) styles += strings[i];\n    }\n    var sourceMap;\n    $5cd8a743d76500ca$var$labelPattern.lastIndex = 0;\n    var identifierName = \"\";\n    var match; // https://esbench.com/bench/5b809c2cf2949800a0f61fb5\n    while((match = $5cd8a743d76500ca$var$labelPattern.exec(styles)) !== null)identifierName += \"-\" + // $FlowFixMe we know it's not null\n    match[1];\n    var name = (0, $9Z4kD.default)(styles) + identifierName;\n    return {\n        name: name,\n        styles: styles,\n        next: $5cd8a743d76500ca$var$cursor\n    };\n};\n\n});\nparcelRegister(\"9Z4kD\", function(module, exports) {\n\n$parcel$export(module.exports, \"default\", function () { return $744d2bc027be075c$export$2e2bcd8739ae039; });\n/* eslint-disable */ // Inspired by https://github.com/garycourt/murmurhash-js\n// Ported from https://github.com/aappleby/smhasher/blob/61a0530f28277f2e850bfc39600ce61d02b518de/src/MurmurHash2.cpp#L37-L86\nfunction $744d2bc027be075c$export$2e2bcd8739ae039(str) {\n    // 'm' and 'r' are mixing constants generated offline.\n    // They're not really 'magic', they just happen to work well.\n    // const m = 0x5bd1e995;\n    // const r = 24;\n    // Initialize the hash\n    var h = 0; // Mix 4 bytes at a time into the hash\n    var k, i = 0, len = str.length;\n    for(; len >= 4; ++i, len -= 4){\n        k = str.charCodeAt(i) & 0xff | (str.charCodeAt(++i) & 0xff) << 8 | (str.charCodeAt(++i) & 0xff) << 16 | (str.charCodeAt(++i) & 0xff) << 24;\n        k = /* Math.imul(k, m): */ (k & 0xffff) * 0x5bd1e995 + ((k >>> 16) * 0xe995 << 16);\n        k ^= /* k >>> r: */ k >>> 24;\n        h = /* Math.imul(k, m): */ (k & 0xffff) * 0x5bd1e995 + ((k >>> 16) * 0xe995 << 16) ^ /* Math.imul(h, m): */ (h & 0xffff) * 0x5bd1e995 + ((h >>> 16) * 0xe995 << 16);\n    } // Handle the last few bytes of the input array\n    switch(len){\n        case 3:\n            h ^= (str.charCodeAt(i + 2) & 0xff) << 16;\n        case 2:\n            h ^= (str.charCodeAt(i + 1) & 0xff) << 8;\n        case 1:\n            h ^= str.charCodeAt(i) & 0xff;\n            h = /* Math.imul(h, m): */ (h & 0xffff) * 0x5bd1e995 + ((h >>> 16) * 0xe995 << 16);\n    } // Do a few final mixes of the hash to ensure the last few\n    // bytes are well-incorporated.\n    h ^= h >>> 13;\n    h = /* Math.imul(h, m): */ (h & 0xffff) * 0x5bd1e995 + ((h >>> 16) * 0xe995 << 16);\n    return ((h ^ h >>> 15) >>> 0).toString(36);\n}\n\n});\n\nparcelRegister(\"6mYn6\", function(module, exports) {\n\n$parcel$export(module.exports, \"default\", function () { return $4a33a0aed687e21c$export$2e2bcd8739ae039; });\nvar $4a33a0aed687e21c$export$2e2bcd8739ae039 = {\n    animationIterationCount: 1,\n    aspectRatio: 1,\n    borderImageOutset: 1,\n    borderImageSlice: 1,\n    borderImageWidth: 1,\n    boxFlex: 1,\n    boxFlexGroup: 1,\n    boxOrdinalGroup: 1,\n    columnCount: 1,\n    columns: 1,\n    flex: 1,\n    flexGrow: 1,\n    flexPositive: 1,\n    flexShrink: 1,\n    flexNegative: 1,\n    flexOrder: 1,\n    gridRow: 1,\n    gridRowEnd: 1,\n    gridRowSpan: 1,\n    gridRowStart: 1,\n    gridColumn: 1,\n    gridColumnEnd: 1,\n    gridColumnSpan: 1,\n    gridColumnStart: 1,\n    msGridRow: 1,\n    msGridRowSpan: 1,\n    msGridColumn: 1,\n    msGridColumnSpan: 1,\n    fontWeight: 1,\n    lineHeight: 1,\n    opacity: 1,\n    order: 1,\n    orphans: 1,\n    tabSize: 1,\n    widows: 1,\n    zIndex: 1,\n    zoom: 1,\n    WebkitLineClamp: 1,\n    // SVG-related properties\n    fillOpacity: 1,\n    floodOpacity: 1,\n    stopOpacity: 1,\n    strokeDasharray: 1,\n    strokeDashoffset: 1,\n    strokeMiterlimit: 1,\n    strokeOpacity: 1,\n    strokeWidth: 1\n};\n\n});\n\n\nparcelRegister(\"42Upt\", function(module, exports) {\n\n$parcel$export(module.exports, \"getRegisteredStyles\", function () { return $2f231b2c70f2d4a5$export$95d99596f328fd52; });\n$parcel$export(module.exports, \"insertStyles\", function () { return $2f231b2c70f2d4a5$export$6f077d94b33a01aa; });\nvar $2f231b2c70f2d4a5$var$isBrowser = true;\nfunction $2f231b2c70f2d4a5$export$95d99596f328fd52(registered, registeredStyles, classNames) {\n    var rawClassName = \"\";\n    classNames.split(\" \").forEach(function(className) {\n        if (registered[className] !== undefined) registeredStyles.push(registered[className] + \";\");\n        else rawClassName += className + \" \";\n    });\n    return rawClassName;\n}\nvar $2f231b2c70f2d4a5$export$580009a5da2a8b4b = function registerStyles(cache, serialized, isStringTag) {\n    var className = cache.key + \"-\" + serialized.name;\n    if (// class name could be used further down\n    // the tree but if it's a string tag, we know it won't\n    // so we don't have to add it to registered cache.\n    // this improves memory usage since we can avoid storing the whole style string\n    (isStringTag === false || // we need to always store it if we're in compat mode and\n    // in node since emotion-server relies on whether a style is in\n    // the registered cache to know whether a style is global or not\n    // also, note that this check will be dead code eliminated in the browser\n    $2f231b2c70f2d4a5$var$isBrowser === false) && cache.registered[className] === undefined) cache.registered[className] = serialized.styles;\n};\nvar $2f231b2c70f2d4a5$export$6f077d94b33a01aa = function insertStyles(cache, serialized, isStringTag) {\n    $2f231b2c70f2d4a5$export$580009a5da2a8b4b(cache, serialized, isStringTag);\n    var className = cache.key + \"-\" + serialized.name;\n    if (cache.inserted[serialized.name] === undefined) {\n        var current = serialized;\n        do {\n            cache.insert(serialized === current ? \".\" + className : \"\", current, cache.sheet, true);\n            current = current.next;\n        }while (current !== undefined);\n    }\n};\n\n});\n\n\n\nparcelRegister(\"k6Jw8\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"fKq5I\"))((parcelRequire(\"kb8hZ\")).resolve(\"4tKUq\")).then(()=>parcelRequire(\"duojR\"));\n\n});\n\nparcelRegister(\"cMiRD\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"fKq5I\"))((parcelRequire(\"kb8hZ\")).resolve(\"hn23i\")).then(()=>parcelRequire(\"2vgBY\"));\n\n});\n\nparcelRegister(\"5goSP\", function(module, exports) {\n\n\nmodule.exports = (parcelRequire(\"fKq5I\"))((parcelRequire(\"kb8hZ\")).resolve(\"af9Ft\")).then(()=>parcelRequire(\"lbeJP\"));\n\n});\n\n/**\n * by bitbof (bitbof.com)\n */ /**\n * features that were available before module script tags:\n * chrome 61\n * edge 16\n * safari 11\n * firefox 60\n * https://caniuse.com/es6-module\n */ !function() {\n    function t() {\n        var e = Array.prototype.slice.call(arguments), n = document.createDocumentFragment();\n        e.forEach(function(e) {\n            var t = e instanceof Node;\n            n.appendChild(t ? e : document.createTextNode(String(e)));\n        }), this.appendChild(n);\n    }\n    [\n        Element.prototype,\n        Document.prototype,\n        DocumentFragment.prototype\n    ].forEach(function(e) {\n        e.hasOwnProperty(\"append\") || Object.defineProperty(e, \"append\", {\n            configurable: !0,\n            enumerable: !0,\n            writable: !0,\n            value: t\n        });\n    });\n}();\n\n\n!function() {\n    function t() {\n        var e = Array.prototype.slice.call(arguments), n = document.createDocumentFragment();\n        e.forEach(function(e) {\n            var t = e instanceof Node;\n            n.appendChild(t ? e : document.createTextNode(String(e)));\n        }), this.insertBefore(n, this.firstChild);\n    }\n    [\n        Element.prototype,\n        Document.prototype,\n        DocumentFragment.prototype\n    ].forEach(function(e) {\n        e.hasOwnProperty(\"prepend\") || Object.defineProperty(e, \"prepend\", {\n            configurable: !0,\n            enumerable: !0,\n            writable: !0,\n            value: t\n        });\n    });\n}();\n\n\nString.prototype.padStart || (String.prototype.padStart = function(t, n) {\n    return t >>= 0, n = String(n || \" \"), this.length > t ? String(this) : ((t -= this.length) > n.length && (n += n.repeat(t / n.length)), n.slice(0, t) + String(this));\n});\n\n\nArray.prototype.findIndex || Object.defineProperty(Array.prototype, \"findIndex\", {\n    value: function(r) {\n        if (null == this) throw new TypeError('\"this\" is null or not defined');\n        var e = Object(this), t = e.length >>> 0;\n        if (\"function\" != typeof r) throw new TypeError(\"predicate must be a function\");\n        for(var n = arguments[1], o = 0; o < t;){\n            var i = e[o];\n            if (r.call(n, i, o, e)) return o;\n            o++;\n        }\n        return -1;\n    }\n});\n\n\n\n\n/*\n * ---- Below ----------------------\n * features that didn't have support until *after* browsers supported the modules script tag:\n * Chrome 61\n * Edge 16\n * Safari 11\n * Firefox 60\n * https://caniuse.com/es6-module\n */ // chrome 61, edge 79, safari 16, firefox 107\nif (!(\"scrollTo\" in Element.prototype)) Object.defineProperty(Element.prototype, \"scrollTo\", {\n    value: function(x, y) {\n        this.scrollLeft = x;\n        this.scrollTop = y;\n    }\n});\n// chrome 61, edge 79, safari 16, firefox 107\nif (!(\"scrollBy\" in Element.prototype)) Object.defineProperty(Element.prototype, \"scrollBy\", {\n    value: function(x, y) {\n        this.scrollLeft += x;\n        this.scrollTop += y;\n    }\n});\n// chrome 69, edge 79, safari 12, firefox 62\nif (!Array.prototype.flat) Object.defineProperty(Array.prototype, \"flat\", {\n    configurable: true,\n    value: function flat(...args) {\n        const depth = isNaN(args[0]) ? 1 : Number(args[0]);\n        return depth ? Array.prototype.reduce.call(this, function(acc, cur) {\n            if (Array.isArray(cur)) // eslint-disable-next-line prefer-spread\n            acc.push.apply(acc, flat.call(cur, depth - 1));\n            else acc.push(cur);\n            return acc;\n        }, []) : Array.prototype.slice.call(this);\n    },\n    writable: true\n});\n// Chrome 85, Firefox 77, Safari 13.1\n// if there are problems, maybe use core-js\nif (!String.prototype.replaceAll) Object.defineProperty(String.prototype, \"replaceAll\", {\n    value: function(searchValue, replaceValue) {\n        if (typeof replaceValue === \"function\") throw new Error(\"replaceAll polyfill does not support replaceValue: function\");\n        return this.replace(new RegExp(searchValue, \"g\"), replaceValue);\n    }\n});\n/*\n    Copyright 2018  Alfredo Mungo <alfredo.mungo@protonmail.ch>\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to\n    deal in the Software without restriction, including without limitation the\n    rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\n    sell copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in\n    all copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n    IN THE SOFTWARE.\n*/ if (!Object.fromEntries) Object.defineProperty(Object, \"fromEntries\", {\n    value (entries) {\n        if (!entries || !entries[Symbol.iterator]) throw new Error(\"Object.fromEntries() requires a single iterable argument\");\n        const o = {};\n        Object.keys(entries).forEach((key)=>{\n            const [k, v] = entries[key];\n            o[k] = v;\n        });\n        return o;\n    }\n});\n// sometimes Android WebView has no localStorage\nif (!(\"localStorage\" in window)) try {\n    window.localStorage = {\n        getItem: ()=>null,\n        setItem: ()=>{},\n        removeItem: ()=>{}\n    };\n} catch (e) {\n// maybe it fails?\n}\n\n\n// --------- history entry types ------------------------------\nfunction $fc4403c8ee6a33dc$export$c4f94c8b3850a5a9(referenceNode, newNode) {\n    if (referenceNode.parentNode) referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n}\nfunction $fc4403c8ee6a33dc$export$fe58198efe02b173(im, callback) {\n    let counter = 0;\n    function check() {\n        if (counter === 1000) {\n            alert(\"couldn't load\");\n            return;\n        }\n        if (im.complete) {\n            counter++;\n            callback();\n        } else setTimeout(check, 1);\n    }\n    check();\n}\nfunction $fc4403c8ee6a33dc$export$2a09375022a33e78(src) {\n    return new Promise((resolve, reject)=>{\n        const img = new Image();\n        img.onload = ()=>resolve(img);\n        img.onerror = reject;\n        img.src = src;\n    });\n}\nfunction $fc4403c8ee6a33dc$export$dbf350e5966cf602(el, styleObj) {\n    const keyArr = Object.keys(styleObj);\n    let keyStr;\n    const style = el.style;\n    for(let i = 0; i < keyArr.length; i++){\n        keyStr = keyArr[i];\n        style[keyStr] = styleObj[keyStr];\n        if (keyStr === \"userSelect\") style.webkitUserSelect = styleObj[keyStr]; // safari\n    }\n}\nfunction $fc4403c8ee6a33dc$export$74da2cba014bdc09(el, attrObj) {\n    const keyArr = Object.keys(attrObj);\n    let keyStr;\n    for(let i = 0; i < keyArr.length; i++){\n        keyStr = keyArr[i];\n        el.setAttribute(keyStr, attrObj[keyStr]);\n    }\n}\nfunction $fc4403c8ee6a33dc$export$10d8903dec122b9d(target, els) {\n    const fragment = document.createDocumentFragment();\n    els.forEach((item)=>item && fragment.append(item));\n    target.append(fragment);\n}\nfunction $fc4403c8ee6a33dc$export$fa55905620c22535(aw, ah, bw, bh, min) {\n    let width = aw * bw, height = ah * bw;\n    if (width > bw) {\n        height = bw / width * height;\n        width = bw;\n    }\n    if (height > bh) {\n        width = bh / height * width;\n        height = bh;\n    }\n    if (min) {\n        width = Math.max(min, width);\n        height = Math.max(min, height);\n    }\n    return {\n        width: width,\n        height: height\n    };\n}\nfunction $fc4403c8ee6a33dc$export$76d0c1a172b67a61(aw, ah, bw, bh) {\n    return {\n        x: aw / 2 - bw / 2,\n        y: ah / 2 - bh / 2\n    };\n}\nfunction $fc4403c8ee6a33dc$export$aa350b96d91cd94() {\n    const date = new Date();\n    const year = date.getFullYear();\n    const month = (date.getMonth() + 1).toString().padStart(2, \"0\");\n    const day = date.getDate().toString().padStart(2, \"0\");\n    const minutes = (date.getHours() * 60 + date.getMinutes()).toString(36).padStart(3, \"0\");\n    return year + \"_\" + month + \"_\" + day + \"_\" + minutes + \"_\";\n}\nfunction $fc4403c8ee6a33dc$export$f81847884871263e(a, b) {\n    return b ? $fc4403c8ee6a33dc$export$f81847884871263e(b, a % b) : a;\n}\nfunction $fc4403c8ee6a33dc$export$533b26079ad0b4b(numerator, denominator) {\n    const g = $fc4403c8ee6a33dc$export$f81847884871263e(numerator, denominator);\n    return [\n        numerator / g,\n        denominator / g\n    ];\n}\nfunction $fc4403c8ee6a33dc$export$8215e6b900906daa(decimalNumber) {\n    const len = decimalNumber.toString().length - 2;\n    const denominator = Math.pow(10, len);\n    const numerator = decimalNumber * denominator;\n    return $fc4403c8ee6a33dc$export$533b26079ad0b4b(numerator, denominator);\n}\nfunction $fc4403c8ee6a33dc$export$5063ec57a23c4f2e(blobObj) {\n    if (!blobObj) throw new Error(\"blobObj is undefined or null\");\n    if (window.Blob && blobObj instanceof Blob) return URL.createObjectURL(blobObj); // object url\n    else if (blobObj.constructor.name === \"Object\") {\n        const fauxBlob = blobObj;\n        return \"data:\" + fauxBlob.type + \";\" + fauxBlob.encoding + \",\" + fauxBlob.data; // data url\n    } else throw new Error(\"unknown blob format\");\n}\nfunction $fc4403c8ee6a33dc$export$1093707c159148e8(dateA, dateB) {\n    dateA = new Date(dateA);\n    dateB = new Date(dateB);\n    dateA.setHours(0, 0, 0, 0);\n    dateB.setHours(0, 0, 0, 0);\n    return (dateB.getTime() - dateA.getTime()) / 86400000;\n}\nfunction $fc4403c8ee6a33dc$export$af0d87255f3cfd7e(obj) {\n    return JSON.parse(JSON.stringify(obj));\n}\nfunction $fc4403c8ee6a33dc$export$331c30fd60da0115(p) {\n    const mimetype = \"image/png\";\n    const err = ()=>alert(\"sharing not supported\");\n    p.canvas.toBlob(function(blob) {\n        if (!blob) {\n            err();\n            p.callback();\n            return;\n        }\n        try {\n            const filesArray = [\n                new File([\n                    blob\n                ], p.fileName, {\n                    type: mimetype\n                })\n            ];\n            navigator.share({\n                title: p.title,\n                files: filesArray\n            }).then(()=>{}).catch(()=>{\n                err();\n            });\n        } catch (e) {\n            err();\n        }\n        p.callback();\n    }, mimetype);\n}\nfunction $fc4403c8ee6a33dc$export$b981489921ee18cd(clickEvent) {\n    const target = clickEvent.target;\n    if (!target) return false;\n    if ([\n        \"A\",\n        \"LABEL\",\n        \"INPUT\",\n        \"SUMMARY\"\n    ].includes(target.tagName) || target.allowClick) return true;\n    clickEvent.preventDefault();\n    return false;\n}\nfunction $fc4403c8ee6a33dc$export$c54fe3b9ecaa84cf(p) {\n    const result = document.createElementNS(\"http://www.w3.org/2000/svg\", p.elementType);\n    Object.entries(p).forEach(([keyStr, item])=>{\n        if (keyStr === \"childrenArr\") item.forEach((child)=>{\n            result.append($fc4403c8ee6a33dc$export$c54fe3b9ecaa84cf(child));\n        });\n        else if (keyStr !== \"elementType\") result.setAttribute(keyStr, item);\n    });\n    return result;\n}\nfunction $fc4403c8ee6a33dc$export$b813e062795b89b5(v) {\n    // (disabled) eslint-disable-next-line no-null/no-null\n    if (v === null) throw new Error(\"value is null\");\n    return v;\n}\nfunction $fc4403c8ee6a33dc$export$5c097f720de072a2(v, message = \"value is undefined\") {\n    if (v === undefined) throw new Error(message);\n    return v;\n}\nfunction $fc4403c8ee6a33dc$export$d802c22d109d9806(v) {\n    return v === null ? undefined : v;\n}\nconst $fc4403c8ee6a33dc$var$matchMediaDark = \"matchMedia\" in window ? window.matchMedia(\"(prefers-color-scheme: dark)\") : false;\nfunction $fc4403c8ee6a33dc$export$a79ad82046afa44e() {\n    return $fc4403c8ee6a33dc$var$matchMediaDark && $fc4403c8ee6a33dc$var$matchMediaDark.matches;\n}\nfunction $fc4403c8ee6a33dc$export$a9dfd81f95a8a526(func) {\n    $fc4403c8ee6a33dc$var$matchMediaDark && \"addEventListener\" in $fc4403c8ee6a33dc$var$matchMediaDark && $fc4403c8ee6a33dc$var$matchMediaDark.addEventListener(\"change\", func);\n}\nfunction $fc4403c8ee6a33dc$export$326d4de4659beb75(func) {\n    $fc4403c8ee6a33dc$var$matchMediaDark && \"removeEventListener\" in $fc4403c8ee6a33dc$var$matchMediaDark && $fc4403c8ee6a33dc$var$matchMediaDark.removeEventListener(\"change\", func);\n}\n\n\nlet $d2dccce11beb16cf$var$historyInstance = false;\nclass $d2dccce11beb16cf$export$2a772a91f059c0f9 {\n    pause() {}\n    addListener() {}\n    push() {}\n    undo() {\n        return [];\n    }\n    redo() {\n        return undefined;\n    }\n    getAll() {\n        return [];\n    }\n    canRedo() {\n        return false;\n    }\n    canUndo() {\n        return false;\n    }\n    getState() {\n        return 0;\n    }\n    getActionNumber() {\n        return 0;\n    }\n}\nconst $d2dccce11beb16cf$var$DO_DELETE_OLD = true;\nclass $d2dccce11beb16cf$export$1a1044741a812c67 {\n    broadcast(p) {\n        setTimeout(()=>{\n            for(let i = 0; i < this.listeners.length; i++)this.listeners[i](p);\n            this.state++;\n        }, 1);\n    }\n    /**\n     * Needed, because sometimes there are actions that would cause other undo steps.\n     * For example a filter that does something with two layers and then merges them.\n     * That should be a single undo step, and prevent merging from creating its own undo step.\n     * Pause prevents creation of unintended undo steps.\n     */ pause(b) {\n        if (b) this.pauseStack++;\n        else this.pauseStack = Math.max(0, this.pauseStack - 1);\n    }\n    addListener(l) {\n        this.listeners.push(l);\n    }\n    push(newEntry) {\n        if (this.pauseStack > 0) return;\n        while(this.actionNumber < this.entries.length - 1)this.entries.pop();\n        //taking care of actions that shouldn't cause a new undo step\n        const lastEntry = this.entries[this.entries.length - 1];\n        // opacity\n        if (lastEntry && newEntry.tool[0] === \"canvas\" && lastEntry.tool[0] === \"canvas\" && newEntry.action === \"layerOpacity\" && lastEntry.action === \"layerOpacity\" && lastEntry.params[0] === newEntry.params[0]) {\n            this.entries[this.entries.length - 1] = newEntry;\n            this.state++; //still needs to increment because something changed\n            return;\n        }\n        // layer visibility\n        if (lastEntry && newEntry.tool[0] === \"canvas\" && lastEntry.tool[0] === \"canvas\" && newEntry.action === \"setLayerIsVisible\" && lastEntry.action === \"setLayerIsVisible\" && lastEntry.params[0] === newEntry.params[0] && lastEntry.params[1] != newEntry.params[1]) {\n            // if last and current step toggle visibility -> that means it's the way it was before\n            this.entries.pop();\n            this.actionNumber--;\n            this.state++; //still needs to increment because something changed\n            this.broadcast(null);\n            return;\n        }\n        // select layer\n        if (newEntry.action === \"focusLayer\" && lastEntry && lastEntry.action === \"focusLayer\") {\n            this.entries[this.entries.length - 1] = newEntry;\n            this.state++;\n            return;\n        }\n        this.entries[this.entries.length] = newEntry;\n        this.actionNumber = this.entries.length - 1;\n        const maxBefore = this.maxState;\n        this.maxState = Math.max(this.maxState, this.actionNumber - this.max);\n        if (maxBefore < this.maxState) {\n            const item = this.entries[this.maxState];\n            if (!item) throw new Error(\"this.dataArr[this.maxState] null\");\n            this.broadcast({\n                bufferUpdate: item\n            });\n        } else this.broadcast(null);\n        if ($d2dccce11beb16cf$var$DO_DELETE_OLD && this.maxState >= 0) this.entries[this.maxState] = null; //to free some memory...imported images take a lot of space\n    }\n    /**\n     * lowers action number, returns all entries that need to be executed\n     * on trailing snapshot to represent the canvas one undo step back.\n     * Empty array if it can't undo\n     */ undo() {\n        const result = [];\n        if (!this.canUndo()) return result;\n        for(let i = this.maxState + 1; i < this.actionNumber; i++)result.push((0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.entries[i]));\n        this.actionNumber--;\n        this.broadcast(null);\n        return result;\n    }\n    /**\n     * raises action number, returns the action to be redone\n     */ redo() {\n        if (!this.canRedo()) return undefined;\n        this.actionNumber++;\n        this.broadcast(null);\n        return (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.entries[this.actionNumber]);\n    }\n    getAll() {\n        return [\n            ...this.entries\n        ];\n    }\n    canRedo() {\n        return this.actionNumber < this.entries.length - 1;\n    }\n    canUndo() {\n        return this.actionNumber > this.maxState;\n    }\n    getState() {\n        return this.state;\n    }\n    /**\n     * actionNumber - number of undo-able actions a user has done (e.g. if drawn 5 lines total -> 5)\n     */ getActionNumber() {\n        return this.actionNumber + 1;\n    }\n    // ---- public ----\n    constructor(){\n        this.max = 20 // max number undo steps\n        ;\n        if ($d2dccce11beb16cf$var$historyInstance) throw new Error(\"klHistory already instantiated\");\n        $d2dccce11beb16cf$var$historyInstance = true;\n        this.state = 0;\n        this.entries = [];\n        this.listeners = [];\n        this.pauseStack = 0;\n        this.maxState = -1;\n        this.actionNumber = -1;\n    }\n}\nconst $d2dccce11beb16cf$export$28b6f4d98dde9845 = new $d2dccce11beb16cf$export$1a1044741a812c67();\n\n\n// not the best\n/**\n * how many modals are open\n */ class $6b37b427615ca1fa$export$f5386afdb763a67e {\n    emit() {\n        this.listeners.forEach((item)=>{\n            item(this.count);\n        });\n    }\n    increase(v) {\n        if (v !== undefined) this.count += v;\n        else this.count++;\n        this.emit();\n    }\n    decrease(v) {\n        if (v !== undefined) this.count -= v;\n        else this.count--;\n        this.emit();\n    }\n    get() {\n        return this.count;\n    }\n    subscribe(listener) {\n        this.listeners.push(listener);\n    }\n    constructor(){\n        this.listeners = [];\n        this.count = 0;\n    }\n}\nconst $6b37b427615ca1fa$export$17eb8275e0c4cab8 = new $6b37b427615ca1fa$export$f5386afdb763a67e();\n\n\n\nconst $604d9bbf77127967$export$b7d78993b74f766d = navigator.userAgent.toLowerCase().indexOf(\"firefox\") > -1;\nconst $604d9bbf77127967$export$4ec3bfbae69fbb50 = function() {\n    const eventUsesHighResTimeStamp = new Event(\"\").timeStamp < 3600000;\n    return function() {\n        return eventUsesHighResTimeStamp;\n    };\n}();\nconst $604d9bbf77127967$export$b7b64c480b083ae0 = !!window.PointerEvent;\nconst $604d9bbf77127967$export$fe0a7220ab4eecad = function() {\n    let result;\n    function test() {\n        const div = document.createElement(\"div\");\n        div.style.position = \"absolute\";\n        div.style.top = \"0\";\n        div.style.left = \"max(0px, 25px)\";\n        document.body.append(div);\n        setTimeout(function() {\n            result = div.offsetLeft === 25;\n            div.remove();\n        }, 25);\n    }\n    if (document.body) test();\n    else window.addEventListener(\"DOMContentLoaded\", function() {\n        test();\n    });\n    return function() {\n        if (result === undefined) throw new Error(\"isCssMinMaxSupported not initialized\");\n        return result;\n    };\n}();\nconst $604d9bbf77127967$export$558f5e20caee48c2 = function() {\n    return \"share\" in navigator && \"canShare\" in navigator;\n};\nfunction $604d9bbf77127967$export$4fb2cccfca937a8c(obj, ...handlers) {\n    handlers.forEach((handler)=>{\n        // (disabled) eslint-disable-next-line no-null/no-null\n        obj[handler] = null;\n    });\n}\n\n\nconst $08e838e8af75c5e2$var$globalKey = (()=>{\n    // keyStr - our key naming system\n    // key - KeyboardEvent.key\n    // code - KeyboardEvent.code\n    const keyStrToKeyObj = {\n        \"space\": [\n            \" \",\n            \"Spacebar\"\n        ],\n        \"alt\": [\n            \"Alt\",\n            \"AltGraph\"\n        ],\n        \"shift\": \"Shift\",\n        \"ctrl\": \"Control\",\n        \"cmd\": [\n            \"Meta\",\n            \"MetaLeft\",\n            \"MetaRight\"\n        ],\n        \"enter\": \"Enter\",\n        \"esc\": \"Escape\",\n        \"backspace\": \"Backspace\",\n        \"delete\": \"Delete\",\n        \"sqbr_open\": \"[\",\n        \"sqbr_close\": \"]\",\n        \"a\": [\n            \"a\",\n            \"A\"\n        ],\n        \"b\": [\n            \"b\",\n            \"B\"\n        ],\n        \"c\": [\n            \"c\",\n            \"C\"\n        ],\n        \"e\": [\n            \"e\",\n            \"E\"\n        ],\n        \"f\": [\n            \"f\",\n            \"F\"\n        ],\n        \"g\": [\n            \"g\",\n            \"G\"\n        ],\n        \"r\": [\n            \"r\",\n            \"R\"\n        ],\n        \"s\": [\n            \"s\",\n            \"S\"\n        ],\n        \"t\": [\n            \"t\",\n            \"T\"\n        ],\n        \"u\": [\n            \"u\",\n            \"U\"\n        ],\n        \"x\": [\n            \"x\",\n            \"X\"\n        ],\n        \"y\": [\n            \"y\",\n            \"Y\"\n        ],\n        \"z\": [\n            \"z\",\n            \"Z\"\n        ],\n        \"plus\": \"+\",\n        \"minus\": \"-\",\n        \"left\": \"ArrowLeft\",\n        \"right\": \"ArrowRight\",\n        \"up\": \"ArrowUp\",\n        \"down\": \"ArrowDown\",\n        \"home\": \"Home\",\n        \"end\": \"End\"\n    };\n    // ['space', 'alt', ... ]\n    const keyStrArr = Object.keys(keyStrToKeyObj);\n    // { space: false, ... }\n    const isDownObj = Object.entries(keyStrToKeyObj).reduce((acc, [key])=>{\n        acc[key] = false;\n        return acc;\n    }, {});\n    // event.key to keyStr\n    // { ArrowLeft: 'left', ... }\n    const keyToKeyStrObj = Object.entries(keyStrToKeyObj).reduce((acc, [key, code])=>{\n        if (typeof code === \"string\") acc[code] = key;\n        else code.forEach((item)=>{\n            acc[item] = key;\n        });\n        return acc;\n    }, {});\n    let comboArr = [];\n    // a physical key's \"key\" can change as other keys get pressed. to keep track, need to also track the code\n    // { KeyE: 'e', KeyF: undefined } - undefined - not down, string - the associated keyStr\n    let codeIsDownObj = {};\n    const listenerArr = [];\n    const emitDown = function(a, b, c, d) {\n        listenerArr.forEach((item)=>{\n            if (!item[0]) return;\n            item[0](a, b, c, d);\n        });\n    };\n    const emitUp = function(a, b, c) {\n        listenerArr.forEach((item)=>{\n            if (!item[1]) return;\n            item[1](a, b, c);\n        });\n    };\n    const emitBlur = function() {\n        listenerArr.forEach((item)=>{\n            if (!item[2]) return;\n            item[2]();\n        });\n    };\n    function keyDown(e) {\n        const key = e.key;\n        const code = e.code;\n        if (key in keyToKeyStrObj) {\n            const keyStr = keyToKeyStrObj[key];\n            if (isDownObj[keyStr]) {\n                emitDown(keyStr, e, comboArr.join(\"+\"), true);\n                return;\n            }\n            isDownObj[keyStr] = true;\n            codeIsDownObj[code] = keyStr;\n            //add to combo\n            comboArr.push(keyStr);\n            emitDown(keyStr, e, comboArr.join(\"+\"));\n        }\n    }\n    function keyUp(e) {\n        const code = e.code;\n        const oldComboStr = comboArr.join(\"+\");\n        // because of a macOS bug: when meta key is down, keyup of other keys does not fire.\n        // https://stackoverflow.com/questions/25438608/javascript-keyup-isnt-called-when-command-and-another-is-pressed\n        if ([\n            \"Meta\",\n            \"MetaLeft\",\n            \"MetaRight\",\n            \"OSLeft\",\n            \"OSRight\"\n        ].includes(code)) {\n            blur();\n            return;\n        }\n        const keyStr = codeIsDownObj[code];\n        if (keyStr !== undefined) {\n            isDownObj[keyStr] = false;\n            codeIsDownObj[code] = undefined;\n            // remove from combo\n            for(let i = 0; i < comboArr.length; i++)if (comboArr[i] == keyStr) {\n                comboArr.splice(i, 1);\n                i--;\n            }\n            emitUp(keyStr, e, oldComboStr);\n        }\n    }\n    function blur() {\n        const oldComboStr = comboArr.join(\"+\");\n        comboArr = [];\n        codeIsDownObj = {};\n        const eventArr = [];\n        keyStrArr.forEach((keyStr)=>{\n            if (isDownObj[keyStr]) {\n                isDownObj[keyStr] = false;\n                eventArr.push(keyStr);\n            }\n        });\n        for(let i = 0; i < eventArr.length; i++)emitUp(eventArr[i], {\n            preventDefault: function() {},\n            stopPropagation: function() {}\n        }, oldComboStr);\n        emitBlur();\n    }\n    return {\n        add: (keyListenerRef)=>{\n            if (listenerArr.includes(keyListenerRef)) return;\n            const first = listenerArr.length === 0;\n            listenerArr.push(keyListenerRef);\n            if (first) {\n                document.addEventListener(\"keydown\", keyDown);\n                document.addEventListener(\"keyup\", keyUp);\n                window.addEventListener(\"blur\", blur);\n            }\n        },\n        remove: (keyListenerRef)=>{\n            if (!listenerArr.includes(keyListenerRef)) return;\n            const last = listenerArr.length === 1;\n            for(let i = 0; i < listenerArr.length; i++)if (listenerArr[i] === keyListenerRef) {\n                listenerArr.splice(i, 1);\n                break;\n            }\n            if (last) {\n                document.removeEventListener(\"keydown\", keyDown);\n                document.removeEventListener(\"keyup\", keyUp);\n                window.removeEventListener(\"blur\", blur);\n            }\n        },\n        getIsDown: ()=>isDownObj,\n        getCombo: ()=>comboArr\n    };\n})();\nclass $08e838e8af75c5e2$export$f17908c5de22d32e {\n    isPressed(keyStr) {\n        if (!(keyStr in $08e838e8af75c5e2$var$globalKey.getIsDown())) throw 'key \"' + keyStr + '\" not found';\n        return $08e838e8af75c5e2$var$globalKey.getIsDown()[keyStr];\n    }\n    getComboStr() {\n        return $08e838e8af75c5e2$var$globalKey.getCombo().join(\"+\");\n    }\n    comboOnlyContains(keyStrArr) {\n        for(let i = 0; i < $08e838e8af75c5e2$var$globalKey.getCombo().length; i++){\n            if (!keyStrArr.includes($08e838e8af75c5e2$var$globalKey.getCombo()[i])) return false;\n        }\n        return true;\n    }\n    destroy() {\n        $08e838e8af75c5e2$var$globalKey.remove(this.ref);\n    }\n    constructor(p){\n        this.onDown = p.onDown;\n        this.onUp = p.onUp;\n        this.onBlur = p.onBlur;\n        this.ref = [\n            this.onDown,\n            this.onUp,\n            this.onBlur\n        ];\n        $08e838e8af75c5e2$var$globalKey.add(this.ref);\n    }\n}\nfunction $08e838e8af75c5e2$export$e9f65b0175de4c03(comboAStr, comboBStr) {\n    return comboAStr.split(\"+\").sort().join(\"+\") === comboBStr.split(\"+\").sort().join(\"+\");\n}\n\n\n\nconst $7b537f840072781f$var$SEQUENCE_TIMEOUT_MS = 200;\nclass $7b537f840072781f$export$c734b8535f2f8e38 {\n    emit(delta) {\n        if (this.position === null || this.sequenceUnit === null) return;\n        this.callback({\n            deltaY: Math.round(delta / this.sequenceUnit),\n            pageX: this.position.pageX,\n            pageY: this.position.pageY,\n            clientX: this.position.clientX,\n            clientY: this.position.clientY\n        });\n    }\n    endSequence() {\n        if (this.toEmitDelta !== null) {\n            this.emit(this.toEmitDelta);\n            this.toEmitDelta = null;\n        }\n        if (this.sequenceUnit !== null && !this.knownUnitArr.includes(this.sequenceUnit)) this.knownUnitArr.push(this.sequenceUnit);\n        this.sequenceLength = 0;\n        this.sequenceUnit = null;\n    }\n    process(event) {\n        this.position = {\n            pageX: event.pageX,\n            pageY: event.pageY,\n            clientX: event.clientX,\n            clientY: event.clientY\n        };\n        if (this.endSequenceTimeout) clearTimeout(this.endSequenceTimeout);\n        this.endSequenceTimeout = setTimeout(()=>this.endSequence(), $7b537f840072781f$var$SEQUENCE_TIMEOUT_MS);\n        //prep delta\n        let delta = event.deltaY;\n        if (\"deltaMode\" in event && event.deltaMode === 1) delta *= 100 / 3;\n        const absDelta = Math.abs(delta);\n        //sequence begins\n        if (this.sequenceLength === 0) {\n            this.sequenceLength++;\n            if (absDelta < 50) //dirty - probably a swipe scroll or pinch scroll on trackpad\n            return;\n            this.sequenceUnit = absDelta;\n            if (this.knownUnitArr.includes(this.sequenceUnit)) //we know this unit - emit right away\n            this.emit(delta);\n            else //unknown unit - wait until next event or sequence end, to have more certainty that it's clean\n            this.toEmitDelta = delta;\n            return;\n        }\n        if (this.sequenceUnit === null) {\n            //previously determined dirty sequence\n            this.toEmitDelta = null;\n            return;\n        }\n        //sequence continues\n        if (absDelta === 0) //ignore zero scroll\n        return;\n        if (absDelta === this.sequenceUnit || absDelta / this.sequenceUnit % 1 < 0.0001 // a multiple\n        ) ;\n        else if (this.sequenceUnit / absDelta % 1 < 0.0001) //unit was actually a multiple - update it\n        this.sequenceUnit = absDelta;\n        else if (absDelta !== this.sequenceUnit) {\n            //not clean - delta is varying - probably a swipe scroll or pinch scroll on trackpad\n            this.sequenceUnit = null;\n            this.toEmitDelta = null;\n            return;\n        }\n        if (this.toEmitDelta !== null) {\n            this.emit(this.toEmitDelta);\n            this.toEmitDelta = null;\n        }\n        this.emit(delta);\n    }\n    // ---- public ----\n    constructor(callback){\n        this.callback = callback;\n        this.knownUnitArr = [\n            100\n        ];\n        this.sequenceLength = 0;\n        this.sequenceUnit = null;\n        this.toEmitDelta = null;\n        this.position = null;\n    }\n}\n\n\nfunction $9414f5ea41e9cf25$export$2c9e8a9632a706b2(a, b, f) {\n    return a * (1 - f) + b * f;\n}\nfunction $9414f5ea41e9cf25$export$6c4a311cc157c764(ax, ay, bx, by) {\n    return Math.sqrt(Math.pow(ax - bx, 2) + Math.pow(ay - by, 2));\n}\nfunction $9414f5ea41e9cf25$export$499eb56409f6cbc2(ax, ay, bx, by) {\n    // faster because no square-root\n    return Math.pow(ax - bx, 2) + Math.pow(ay - by, 2);\n}\nfunction $9414f5ea41e9cf25$export$a4f99f99d3e99cfa(x, y) {\n    // faster because no square-root\n    return x * x + y * y;\n}\nfunction $9414f5ea41e9cf25$export$627023b405ba5028(p1, p2) {\n    return Math.atan2(p2.y - p1.y, p2.x - p1.x);\n}\nfunction $9414f5ea41e9cf25$export$c03a8450eabc2532(p1, p2) {\n    return $9414f5ea41e9cf25$export$627023b405ba5028(p1, p2) * 180 / Math.PI;\n}\nfunction $9414f5ea41e9cf25$export$151bd845d70e2099(p, rect) {\n    return rect.x <= p.x && p.x <= rect.x + rect.width && rect.y <= p.y && p.y <= rect.y + rect.height;\n}\nfunction $9414f5ea41e9cf25$export$7d15b64cf5a3a4c4(num, min, max) {\n    return num < min ? min : num > max ? max : num;\n}\nfunction $9414f5ea41e9cf25$export$bb628a54ab399bc9(x, y, deg) {\n    const theta = deg * (Math.PI / 180);\n    const cs = Math.cos(theta);\n    const sn = Math.sin(theta);\n    return {\n        x: x * cs - y * sn,\n        y: x * sn + y * cs\n    };\n}\nfunction $9414f5ea41e9cf25$export$95ec0760d3d00713(center, point, deg) {\n    const rot = $9414f5ea41e9cf25$export$bb628a54ab399bc9(point.x - center.x, point.y - center.y, deg);\n    rot.x += center.x;\n    rot.y += center.y;\n    return rot;\n}\nfunction $9414f5ea41e9cf25$export$bbf9af158036c5e9(remainder, fDx, fDy) {\n    remainder.x += fDx;\n    remainder.y += fDy;\n    const dX = Math.round(remainder.x);\n    const dY = Math.round(remainder.y);\n    remainder.x -= dX;\n    remainder.y -= dY;\n    return {\n        dX: dX,\n        dY: dY\n    };\n}\nfunction $9414f5ea41e9cf25$export$94cce7adf2ec2d08(f) {\n    if (f % 1 === 0) {\n        if (f % 2 === 0) return f;\n        return f + 1;\n    }\n    const above = Math.ceil(f);\n    const below = Math.floor(f);\n    if (above % 2 === 0) return above;\n    else return below;\n}\nfunction $9414f5ea41e9cf25$export$f373b6a7b0c159a(f) {\n    if (f % 1 === 0) {\n        if (f % 2 === 0) return f + 1;\n        return f;\n    }\n    const above = Math.ceil(f);\n    const below = Math.floor(f);\n    if (above % 2 === 1) return above;\n    else return below;\n}\nfunction $9414f5ea41e9cf25$export$2077e0241d6afd3c(f, digits) {\n    const digitMult = Math.pow(10, digits);\n    return Math.round(f /* + Number.EPSILON*/  * digitMult) / digitMult;\n}\nfunction $9414f5ea41e9cf25$export$f4467a4f41373bc7(target, bounds) {\n    if (!bounds && !target) throw new Error(\"at least one param needs to be defined\");\n    if (!bounds) return target;\n    if (!target) target = {\n        x1: bounds.x1,\n        y1: bounds.y1,\n        x2: bounds.x2,\n        y2: bounds.y2\n    };\n    else {\n        target.x1 = Math.min(target.x1, bounds.x1);\n        target.y1 = Math.min(target.y1, bounds.y1);\n        target.x2 = Math.max(target.x2, bounds.x2);\n        target.y2 = Math.max(target.y2, bounds.y2);\n    }\n    return target;\n}\nfunction $9414f5ea41e9cf25$export$bbb91bbc54e7d9ac(bounds, width, height) {\n    if (!bounds) return undefined;\n    const x1 = Math.max(0, bounds.x1);\n    const y1 = Math.max(0, bounds.y1);\n    const x2 = Math.min(width - 1, bounds.x2);\n    const y2 = Math.min(height - 1, bounds.y2);\n    if (x1 > x2 || y1 > y2) return undefined;\n    return {\n        x1: x1,\n        y1: y1,\n        x2: x2,\n        y2: y2\n    };\n}\n\n\nclass $11fbdc7b09b4db73$export$61f95f4b79132931 {\n    // ---- public ----\n    normalize(pressure) {\n        if (pressure === 0 || pressure === 1) return pressure;\n        if (this.count < 60) {\n            if (this.count === 0 || this.count === null) this.avgPressure = pressure;\n            else this.avgPressure = (0, $9414f5ea41e9cf25$export$2c9e8a9632a706b2)(pressure, this.avgPressure, 0.95);\n            this.count++;\n        } else if (!this.normalizeIsComplete) {\n            this.normalizeIsComplete = true;\n            //BB.throwOut('avg pressure decision!' + this.avgPressure);\n            if (this.avgPressure < 0.13) this.normalizeFactor = 2.3;\n        }\n        return Math.pow(pressure, 1 / this.normalizeFactor);\n    }\n    constructor(){\n        this.count = 0;\n        this.avgPressure = 0 // float [0, 1]\n        ;\n        this.normalizeIsComplete = false;\n        this.normalizeFactor = 1;\n    }\n}\n\n\n// keeping track of pointers for movement fallback\nconst $a07742141701d1f2$var$pointerArr = [];\nfunction $a07742141701d1f2$var$addPointer(event) {\n    const pointerObj = {\n        pointerId: event.pointerId,\n        lastPageX: null,\n        lastPageY: null\n    };\n    $a07742141701d1f2$var$pointerArr.push(pointerObj);\n    if ($a07742141701d1f2$var$pointerArr.length > 15) $a07742141701d1f2$var$pointerArr.shift();\n    return pointerObj;\n}\nfunction $a07742141701d1f2$var$getPointer(event) {\n    for(let i = $a07742141701d1f2$var$pointerArr.length - 1; i >= 0; i--){\n        if (event.pointerId === $a07742141701d1f2$var$pointerArr[i].pointerId) return $a07742141701d1f2$var$pointerArr[i];\n    }\n    return null;\n}\nfunction $a07742141701d1f2$var$getButtonStr(buttons) {\n    switch(buttons){\n        case 1:\n            return \"left\";\n        case 2:\n            return \"right\";\n        case 4:\n            return \"middle\";\n        default:\n            return undefined;\n    }\n}\nconst $a07742141701d1f2$var$pressureNormalizer = new (0, $11fbdc7b09b4db73$export$61f95f4b79132931)();\nconst $a07742141701d1f2$var$timeStampOffset = (0, $604d9bbf77127967$export$4ec3bfbae69fbb50)() ? 0 : -performance.timing.navigationStart;\nconst $a07742141701d1f2$var$pointerDownEvt = (0, $604d9bbf77127967$export$b7b64c480b083ae0) ? \"pointerdown\" : \"mousedown\";\nconst $a07742141701d1f2$var$pointerMoveEvt = (0, $604d9bbf77127967$export$b7b64c480b083ae0) ? \"pointermove\" : \"mousemove\";\nconst $a07742141701d1f2$var$pointerUpEvt = (0, $604d9bbf77127967$export$b7b64c480b083ae0) ? \"pointerup\" : \"mouseup\";\nconst $a07742141701d1f2$var$pointerCancelEvt = (0, $604d9bbf77127967$export$b7b64c480b083ae0) ? \"pointercancel\" : \"mousecancel\";\nconst $a07742141701d1f2$var$pointerLeaveEvt = (0, $604d9bbf77127967$export$b7b64c480b083ae0) ? \"pointerleave\" : \"mouseleave\";\nconst $a07742141701d1f2$var$pointerEnterEvt = (0, $604d9bbf77127967$export$b7b64c480b083ae0) ? \"pointerenter\" : \"mouseenter\";\n/**\n * More trustworthy pointer attributes. that behave the same across browsers.\n * returns a new object. Also attaches itself to the orig event. -> event.corrected\n */ function $a07742141701d1f2$var$correctPointerEvent(event) {\n    if (\"corrected\" in event) return event.corrected;\n    function determineButtons() {\n        if (event.buttons !== undefined) return event.buttons;\n        /*\n                button -> buttons\n        none:\tundefined -> 0\n        left:\t0 -> 1\n        middle:\t1 -> 4\n        right:\t2 -> 2\n        fourth:\t3 -> 8\n        fifth:\t4 -> 16\n         */ if (event.button !== undefined) return [\n            1,\n            4,\n            2,\n            8,\n            16\n        ][event.button];\n        return 0;\n    }\n    const correctedObj = {\n        pointerId: event.pointerId,\n        pointerType: event.pointerType,\n        pageX: event.pageX,\n        pageY: event.pageY,\n        clientX: event.clientX,\n        clientY: event.clientY,\n        movementX: event.movementX,\n        movementY: event.movementY,\n        timeStamp: event.timeStamp + $a07742141701d1f2$var$timeStampOffset,\n        pressure: $a07742141701d1f2$var$pressureNormalizer.normalize(event.pressure),\n        buttons: determineButtons(),\n        button: event.button,\n        coalescedArr: [],\n        eventPreventDefault: ()=>event.preventDefault(),\n        eventStopPropagation: ()=>event.stopPropagation()\n    };\n    event.corrected = correctedObj;\n    let customPressure = null;\n    if (\"pointerId\" in event) {\n        if (\"pressure\" in event && event.buttons !== 0 && ([\n            \"mouse\"\n        ].includes(event.pointerType) || event.pointerType === \"touch\" && event.pressure === 0)) {\n            correctedObj.pressure = 1;\n            customPressure = 1;\n        }\n    } else {\n        correctedObj.pointerId = 0;\n        correctedObj.pointerType = \"mouse\";\n        correctedObj.pressure = event.buttons !== 0 ? 1 : 0;\n        customPressure = correctedObj.pressure;\n    }\n    if ((0, $604d9bbf77127967$export$b7d78993b74f766d) && event.pointerType != \"mouse\" && event.type === \"pointermove\" && event.buttons === 0) correctedObj.buttons = 1; // todo wrong if no buttons actually pressed\n    let coalescedEventArr = [];\n    if (\"getCoalescedEvents\" in event) coalescedEventArr = event.getCoalescedEvents();\n    // chrome somehow movementX not same scale as pageX. todo: only chrome?\n    // so make my own\n    const pointerObj = $a07742141701d1f2$var$getPointer(correctedObj) || $a07742141701d1f2$var$addPointer(correctedObj);\n    const totalLastX = pointerObj.lastPageX;\n    const totalLastY = pointerObj.lastPageY;\n    for(let i = 0; i < coalescedEventArr.length; i++){\n        const eventItem = coalescedEventArr[i];\n        correctedObj.coalescedArr.push({\n            pageX: eventItem.pageX,\n            pageY: eventItem.pageY,\n            clientX: eventItem.clientX,\n            clientY: eventItem.clientY,\n            movementX: pointerObj.lastPageX === null ? 0 : eventItem.pageX - pointerObj.lastPageX,\n            movementY: pointerObj.lastPageY === null ? 0 : eventItem.pageY - pointerObj.lastPageY,\n            timeStamp: eventItem.timeStamp === 0 ? correctedObj.timeStamp : eventItem.timeStamp + $a07742141701d1f2$var$timeStampOffset,\n            pressure: customPressure === null ? $a07742141701d1f2$var$pressureNormalizer.normalize(eventItem.pressure) : customPressure\n        });\n        pointerObj.lastPageX = eventItem.pageX;\n        pointerObj.lastPageY = eventItem.pageY;\n    }\n    pointerObj.lastPageX = correctedObj.pageX;\n    pointerObj.lastPageY = correctedObj.pageY;\n    correctedObj.movementX = totalLastX === null ? 0 : pointerObj.lastPageX - totalLastX;\n    correctedObj.movementY = totalLastY === null ? 0 : pointerObj.lastPageY - totalLastY;\n    return correctedObj;\n}\nclass $a07742141701d1f2$export$9371bd96776f4e82 {\n    getDragObj(pointerId) {\n        for(let i = 0; i < this.dragObjArr.length; i++){\n            if (pointerId === this.dragObjArr[i].pointerId) return this.dragObjArr[i];\n        }\n        return null;\n    }\n    removeDragObj(pointerId) {\n        let removedDragObj = null;\n        for(let i = 0; i < this.dragPointerIdArr.length; i++)if (this.dragPointerIdArr[i] === pointerId) {\n            removedDragObj = this.dragObjArr[i];\n            this.dragObjArr.splice(i, 1);\n            this.dragPointerIdArr.splice(i, 1);\n            i--;\n        }\n        return removedDragObj;\n    }\n    /**\n     * Creates a value for onPointer, from a pointer event handler.\n     */ createPointerOutEvent(typeStr, correctedEvent, custom) {\n        const bounds = this.targetElement.getBoundingClientRect();\n        const result = {\n            type: typeStr,\n            pointerId: correctedEvent.pointerId,\n            pointerType: correctedEvent.pointerType,\n            pageX: correctedEvent.pageX,\n            pageY: correctedEvent.pageY,\n            clientX: correctedEvent.clientX,\n            clientY: correctedEvent.clientY,\n            relX: correctedEvent.clientX - bounds.left + this.targetElement.scrollLeft,\n            relY: correctedEvent.clientY - bounds.top + this.targetElement.scrollTop,\n            dX: correctedEvent.movementX,\n            dY: correctedEvent.movementY,\n            time: correctedEvent.timeStamp,\n            eventPreventDefault: correctedEvent.eventPreventDefault,\n            eventStopPropagation: correctedEvent.eventStopPropagation,\n            ...custom\n        };\n        if (typeStr === \"pointermove\") {\n            result.coalescedArr = [];\n            if (correctedEvent.coalescedArr.length > 1) {\n                let coalescedItem;\n                for(let i = 0; i < correctedEvent.coalescedArr.length; i++){\n                    coalescedItem = correctedEvent.coalescedArr[i];\n                    result.coalescedArr.push({\n                        pageX: coalescedItem.pageX,\n                        pageY: coalescedItem.pageY,\n                        clientX: coalescedItem.clientX,\n                        clientY: coalescedItem.clientY,\n                        relX: coalescedItem.clientX - bounds.left + this.targetElement.scrollLeft,\n                        relY: coalescedItem.clientY - bounds.top + this.targetElement.scrollTop,\n                        dX: coalescedItem.movementX,\n                        dY: coalescedItem.movementY,\n                        time: coalescedItem.timeStamp\n                    });\n                }\n            }\n        }\n        return result;\n    }\n    setupDocumentListeners() {\n        this.windowOnPointerMove && document.addEventListener($a07742141701d1f2$var$pointerMoveEvt, this.windowOnPointerMove);\n        this.windowOnPointerUp && document.addEventListener($a07742141701d1f2$var$pointerUpEvt, this.windowOnPointerUp);\n        this.windowOnPointerLeave && document.addEventListener($a07742141701d1f2$var$pointerCancelEvt, this.windowOnPointerLeave);\n        this.windowOnPointerLeave && document.addEventListener($a07742141701d1f2$var$pointerLeaveEvt, this.windowOnPointerLeave);\n    }\n    destroyDocumentListeners() {\n        this.windowOnPointerMove && document.removeEventListener($a07742141701d1f2$var$pointerMoveEvt, this.windowOnPointerMove);\n        this.windowOnPointerUp && document.removeEventListener($a07742141701d1f2$var$pointerUpEvt, this.windowOnPointerUp);\n        this.windowOnPointerLeave && document.removeEventListener($a07742141701d1f2$var$pointerCancelEvt, this.windowOnPointerLeave);\n        this.windowOnPointerLeave && document.removeEventListener($a07742141701d1f2$var$pointerLeaveEvt, this.windowOnPointerLeave);\n    }\n    destroy() {\n        if (this.isDestroyed) return;\n        this.isDestroyed = true;\n        this.onPointerEnter && this.targetElement.removeEventListener($a07742141701d1f2$var$pointerEnterEvt, this.onPointerEnter);\n        this.onPointerLeave && this.targetElement.removeEventListener($a07742141701d1f2$var$pointerLeaveEvt, this.onPointerLeave);\n        this.onPointerMove && this.targetElement.removeEventListener($a07742141701d1f2$var$pointerMoveEvt, this.onPointerMove);\n        this.onPointerDown && this.targetElement.removeEventListener($a07742141701d1f2$var$pointerDownEvt, this.onPointerDown);\n        this.onWheel && this.targetElement.removeEventListener(\"wheel\", this.onWheel);\n        this.destroyDocumentListeners();\n        this.onTouchMoveScribbleFix && document.removeEventListener(\"touchmove\", this.onTouchMoveScribbleFix);\n        this.onTouchStart && this.targetElement.removeEventListener(\"touchstart\", this.onTouchStart);\n        this.onTouchMove && this.targetElement.removeEventListener(\"touchmove\", this.onTouchMove);\n        this.onTouchEnd && this.targetElement.removeEventListener(\"touchend\", this.onTouchEnd);\n        this.onTouchCancel && this.targetElement.removeEventListener(\"touchcancel\", this.onTouchCancel);\n    }\n    // ---- public ----\n    constructor(p){\n        this.isDestroyed = false;\n        this.isOverCounter = 0;\n        // pointers that are pressing a button\n        this.dragObjArr = [];\n        this.dragPointerIdArr = [];\n        // chrome input glitch workaround\n        this.lastPointerType = null;\n        this.didSkip = false;\n        this.targetElement = p.target;\n        this.onPointerCallback = p.onPointer;\n        this.onWheelCallback = p.onWheel;\n        this.onEnterLeaveCallback = p.onEnterLeave;\n        this.maxPointers = Math.max(1, p.maxPointers || 1);\n        this.wheelCleaner = new (0, $7b537f840072781f$export$c734b8535f2f8e38)((cleanerEvent)=>{\n            if (this.isDestroyed || !this.onWheelCallback) return;\n            const bounds = this.targetElement.getBoundingClientRect();\n            const whlEvent = {\n                ...cleanerEvent,\n                relX: cleanerEvent.clientX - bounds.left + this.targetElement.scrollLeft,\n                relY: cleanerEvent.clientY - bounds.top + this.targetElement.scrollTop\n            };\n            this.onWheelCallback(whlEvent);\n        });\n        if (this.onPointerCallback) {\n            this.onPointerMove = (event)=>{\n                const correctedEvent = $a07742141701d1f2$var$correctPointerEvent(event);\n                const tempLastPointerType = this.lastPointerType;\n                this.lastPointerType = correctedEvent.pointerType;\n                if (this.dragPointerIdArr.includes(correctedEvent.pointerId) || this.dragPointerIdArr.length === this.maxPointers || correctedEvent.pointerType === \"touch\") {\n                    this.didSkip = false;\n                    return;\n                }\n                // chrome input glitch workaround - throws in a random mouse event with the wrong position when using a stylus\n                if (!this.didSkip && correctedEvent.pointerType === \"mouse\" && tempLastPointerType === \"pen\") {\n                    this.didSkip = true;\n                    return;\n                }\n                this.didSkip = false;\n                const outEvent = this.createPointerOutEvent(\"pointermove\", correctedEvent);\n                this.onPointerCallback && this.onPointerCallback(outEvent);\n            };\n            this.onPointerDown = (event, onSkipGlobal)=>{\n                //BB.throwOut('pointerdown ' + event.pointerId + ' | ' + dragPointerIdArr.length);\n                const correctedEvent = $a07742141701d1f2$var$correctPointerEvent(event);\n                ////console.log('debug: ' + event.pointerId + ' pointerdown');\n                if (this.dragPointerIdArr.includes(correctedEvent.pointerId) || this.dragPointerIdArr.length === this.maxPointers || ![\n                    1,\n                    2,\n                    4\n                ].includes(correctedEvent.buttons)) //BB.throwOut('pointerdown ignored');\n                return;\n                //set up global listeners\n                if (this.dragObjArr.length === 0 && !onSkipGlobal) this.setupDocumentListeners();\n                const dragObj = {\n                    pointerId: correctedEvent.pointerId,\n                    pointerType: correctedEvent.pointerType,\n                    downPageX: correctedEvent.pageX,\n                    downPageY: correctedEvent.pageY,\n                    buttons: correctedEvent.buttons,\n                    lastPageX: correctedEvent.pageX,\n                    lastPageY: correctedEvent.pageY,\n                    lastTimeStamp: correctedEvent.timeStamp\n                };\n                this.dragObjArr.push(dragObj);\n                this.dragPointerIdArr.push(correctedEvent.pointerId);\n                const outEvent = this.createPointerOutEvent(\"pointerdown\", correctedEvent, {\n                    downPageX: correctedEvent.pageX,\n                    downPageY: correctedEvent.pageY,\n                    button: $a07742141701d1f2$var$getButtonStr(correctedEvent.buttons),\n                    pressure: correctedEvent.pressure\n                });\n                this.onPointerCallback && this.onPointerCallback(outEvent);\n            };\n            this.windowOnPointerMove = (event)=>{\n                //BB.throwOut('pointermove ' + event.pointerId);\n                const correctedEvent = $a07742141701d1f2$var$correctPointerEvent(event);\n                ////console.log('debug: ' + event.pointerId + ' GLOBALpointermove');\n                if (!this.dragPointerIdArr.includes(correctedEvent.pointerId)) return;\n                const dragObj = this.getDragObj(correctedEvent.pointerId);\n                if (!dragObj) // todo need to handle this!\n                return;\n                //if pointer changes button its pressing -> turn into pointerup\n                if (correctedEvent.buttons !== dragObj.buttons) {\n                    //pointer up\n                    //remove listener\n                    if (this.dragObjArr.length === 1) this.destroyDocumentListeners();\n                    this.removeDragObj(correctedEvent.pointerId);\n                    const outEvent = this.createPointerOutEvent(\"pointerup\", correctedEvent, {\n                        downPageX: dragObj.downPageX,\n                        downPageY: dragObj.downPageY\n                    });\n                    this.onPointerCallback && this.onPointerCallback(outEvent);\n                    return;\n                }\n                // ipad likes to do this\n                if (correctedEvent.pointerType === \"pen\" && correctedEvent.pageX === dragObj.lastPageX && correctedEvent.pageY === dragObj.lastPageY && correctedEvent.timeStamp === dragObj.lastTimeStamp) //ignore\n                return;\n                const outEvent = this.createPointerOutEvent(\"pointermove\", correctedEvent, {\n                    downPageX: dragObj.downPageX,\n                    downPageY: dragObj.downPageY,\n                    button: $a07742141701d1f2$var$getButtonStr(correctedEvent.buttons),\n                    pressure: correctedEvent.pressure\n                });\n                dragObj.lastPageX = correctedEvent.pageX;\n                dragObj.lastPageY = correctedEvent.pageY;\n                dragObj.lastTimeStamp = correctedEvent.timeStamp;\n                this.onPointerCallback && this.onPointerCallback(outEvent);\n            };\n            this.windowOnPointerUp = (event)=>{\n                //BB.throwOut('pointerup ' + event.pointerId);\n                const correctedEvent = $a07742141701d1f2$var$correctPointerEvent(event);\n                ////console.log('debug: ' + event.pointerId + ' GLOBALpointerup');\n                if (!this.dragPointerIdArr.includes(correctedEvent.pointerId)) return;\n                //remove listener\n                if (this.dragObjArr.length === 1) this.destroyDocumentListeners();\n                const dragObj = this.removeDragObj(correctedEvent.pointerId);\n                if (!dragObj) // todo need to handle this!\n                return;\n                const outEvent = this.createPointerOutEvent(\"pointerup\", correctedEvent, {\n                    downPageX: dragObj.downPageX,\n                    downPageY: dragObj.downPageY\n                });\n                this.onPointerCallback && this.onPointerCallback(outEvent);\n            };\n            this.windowOnPointerLeave = (event)=>{\n                //BB.throwOut('pointerleave ' + event.pointerId);\n                const correctedEvent = $a07742141701d1f2$var$correctPointerEvent(event);\n                ////console.log('debug: ' + event.pointerId + ' onGlobalPointerLeave', event);\n                if (!this.dragPointerIdArr.includes(correctedEvent.pointerId)) return;\n                //remove listener\n                if (this.dragObjArr.length === 1) this.destroyDocumentListeners();\n                const dragObj = this.removeDragObj(correctedEvent.pointerId);\n                if (!dragObj) // todo need to handle this!\n                return;\n                const outEvent = this.createPointerOutEvent(\"pointerup\", correctedEvent, {\n                    downPageX: dragObj.downPageX,\n                    downPageY: dragObj.downPageY\n                });\n                this.onPointerCallback && this.onPointerCallback(outEvent);\n            };\n            this.targetElement.addEventListener($a07742141701d1f2$var$pointerMoveEvt, this.onPointerMove);\n            this.targetElement.addEventListener($a07742141701d1f2$var$pointerDownEvt, this.onPointerDown);\n            if (!(0, $604d9bbf77127967$export$b7b64c480b083ae0)) {\n                const touchToFakePointer = (touch, touchEvent, isDown)=>{\n                    return {\n                        pointerId: touch.identifier,\n                        pointerType: \"touch\",\n                        pageX: touch.pageX,\n                        pageY: touch.pageY,\n                        clientX: touch.clientX,\n                        clientY: touch.clientY,\n                        button: isDown ? 0 : undefined,\n                        buttons: isDown ? 1 : 0,\n                        timeStamp: touchEvent.timeStamp,\n                        target: touchEvent.target,\n                        pressure: isDown ? 1 : 0,\n                        preventDefault: ()=>touchEvent.preventDefault(),\n                        stopPropagation: ()=>touchEvent.stopPropagation()\n                    };\n                };\n                const handleTouch = (e, type)=>{\n                    for(let i = 0; i < e.changedTouches.length; i++){\n                        const touch = e.changedTouches[i];\n                        const fakePointer = touchToFakePointer(touch, e, [\n                            \"start\",\n                            \"move\"\n                        ].includes(type));\n                        if (type === \"start\") this.onPointerDown(fakePointer, false);\n                        else if (type === \"move\") this.windowOnPointerMove(fakePointer);\n                        else if (type === \"end\") this.windowOnPointerUp(fakePointer);\n                        else this.windowOnPointerLeave(fakePointer);\n                    }\n                };\n                this.onTouchStart = (e)=>{\n                    e.preventDefault();\n                    handleTouch(e, \"start\");\n                };\n                this.onTouchMove = (e)=>{\n                    handleTouch(e, \"move\");\n                };\n                this.onTouchEnd = (e)=>{\n                    handleTouch(e, \"end\");\n                };\n                this.onTouchCancel = (e)=>{\n                    handleTouch(e, \"cancel\");\n                };\n                this.targetElement.addEventListener(\"touchstart\", this.onTouchStart);\n                this.targetElement.addEventListener(\"touchmove\", this.onTouchMove);\n                this.targetElement.addEventListener(\"touchend\", this.onTouchEnd);\n                this.targetElement.addEventListener(\"touchcancel\", this.onTouchCancel);\n            }\n        }\n        if (this.onWheelCallback) {\n            this.onWheel = (e)=>{\n                this.wheelCleaner.process(e);\n            };\n            this.targetElement.addEventListener(\"wheel\", this.onWheel);\n        }\n        if (this.onEnterLeaveCallback) {\n            this.onPointerEnter = ()=>{\n                this.isOverCounter++;\n                this.onEnterLeaveCallback && this.onEnterLeaveCallback(true);\n            };\n            this.onPointerLeave = ()=>{\n                this.isOverCounter--;\n                this.onEnterLeaveCallback && this.onEnterLeaveCallback(false);\n            };\n            this.targetElement.addEventListener($a07742141701d1f2$var$pointerEnterEvt, this.onPointerEnter);\n            this.targetElement.addEventListener($a07742141701d1f2$var$pointerLeaveEvt, this.onPointerLeave);\n        }\n        if (p.fixScribble) {\n            //ipad scribble workaround https://developer.apple.com/forums/thread/662874\n            this.onTouchMoveScribbleFix = (e)=>e.preventDefault();\n            this.targetElement.addEventListener(\"touchmove\", this.onTouchMoveScribbleFix);\n        }\n    }\n}\n\n\n/*window['canvases'] = [];\n\nwindow['printCanvases'] = () => {\n    let total = 0;\n\n    console.log(window['canvases'].map(item => {\n        total += item.width * item.height;\n        return {w: item.width, h: item.height};\n    }));\n\n    console.log('total: ' + (total * 4 / 1000 / 1000) + 'mb');\n};*/ function $9f64dcf89d8f9132$export$cd3d1f114b139967(w, h) {\n    const result = document.createElement(\"canvas\");\n    if (w && h) {\n        result.width = w;\n        result.height = h;\n    }\n    // window['canvases'].push(result);\n    return result;\n}\n\n\n\nfunction $13d5aa49e37e2734$export$dd0873c0fb3ccff6(canvas) {\n    const resultCanvas = (0, $9f64dcf89d8f9132$export$cd3d1f114b139967)(canvas.width, canvas.height);\n    const ctx = resultCanvas.getContext(\"2d\");\n    if (!ctx) throw new Error(\"2d context not supported or canvas already initialized\");\n    ctx.drawImage(canvas, 0, 0);\n    return resultCanvas;\n}\nfunction $13d5aa49e37e2734$export$39f92e86d1722f3a(canvas, options) {\n    const ctx = canvas.getContext(\"2d\", options);\n    if (!ctx) throw new Error(\"couldn't get 2d context\");\n    return ctx;\n}\nfunction $13d5aa49e37e2734$export$1555f643cc9a976(transform, scaleX, scaleY) {\n    if (![\n        1,\n        -1\n    ].includes(scaleX) || ![\n        1,\n        -1\n    ].includes(scaleY) || transform.width % 1 !== 0 || transform.height % 1 !== 0 || Math.abs(transform.angleDeg) % 90 !== 0) return false;\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\n    const width = whSwapped ? transform.height : transform.width;\n    const height = whSwapped ? transform.width : transform.height;\n    return (Math.abs(width) % 2 === 0 && transform.x % 1 === 0 || Math.abs(width) % 2 === 1 && transform.x % 1 === 0.5) && (Math.abs(height) % 2 === 0 && transform.y % 1 === 0 || Math.abs(height) % 2 === 1 && transform.y % 1 === 0.5);\n}\nfunction $13d5aa49e37e2734$export$ded2b43392504635(destCtx, transformImage, transform, bounds, pixelated) {\n    if (!bounds) bounds = {\n        x: 0,\n        y: 0,\n        width: transformImage.width,\n        height: transformImage.height\n    };\n    destCtx.save();\n    if (pixelated) destCtx.imageSmoothingEnabled = false;\n    else {\n        destCtx.imageSmoothingEnabled = true;\n        destCtx.imageSmoothingQuality = \"high\";\n    }\n    destCtx.translate(transform.x, transform.y);\n    destCtx.rotate(transform.angleDeg / 180 * Math.PI);\n    destCtx.scale(transform.width > 0 ? 1 : -1, transform.height > 0 ? 1 : -1);\n    destCtx.drawImage(transformImage, bounds.x, bounds.y, bounds.width, bounds.height, -Math.abs(transform.width) / 2, -Math.abs(transform.height) / 2, Math.abs(transform.width), Math.abs(transform.height));\n    destCtx.restore();\n}\nfunction $13d5aa49e37e2734$export$425a419ef9fc761f(baseCanvas, transformImage, transformObj) {\n    transformObj = (0, $fc4403c8ee6a33dc$export$af0d87255f3cfd7e)(transformObj);\n    if (!transformObj.center) transformObj.center = {\n        x: transformImage.width / 2,\n        y: transformImage.height / 2\n    };\n    if (!transformObj.scale) transformObj.scale = {\n        x: 1,\n        y: 1\n    };\n    if (!transformObj.angleDegree) transformObj.angleDegree = 0;\n    if (!transformObj.translate) transformObj.translate = {\n        x: 0,\n        y: 0\n    };\n    const ctx = baseCanvas.getContext(\"2d\");\n    if (!ctx) throw new Error(\"2d context not supported or canvas already initialized\");\n    ctx.save();\n    if (Math.abs(transformObj.scale.x - 1) > 0.000001 || Math.abs(transformObj.scale.y - 1) > 0.000001 || Math.abs(transformObj.angleDegree % 90) > 0.000001) {\n        ctx.imageSmoothingEnabled = true;\n        ctx.imageSmoothingQuality = \"high\";\n    } else ctx.imageSmoothingEnabled = false;\n    ctx.translate(transformObj.translate.x, transformObj.translate.y);\n    ctx.translate(transformObj.center.x, transformObj.center.y);\n    ctx.rotate(transformObj.angleDegree / 180 * Math.PI);\n    ctx.scale(transformObj.scale.x, transformObj.scale.y);\n    ctx.translate(-transformObj.center.x, -transformObj.center.y);\n    ctx.drawImage(transformImage, 0, 0, transformImage.width, transformImage.height);\n    ctx.restore();\n}\nconst $13d5aa49e37e2734$export$754559b36e94ea2f = function(size, isDark) {\n    const canvas = (0, $9f64dcf89d8f9132$export$cd3d1f114b139967)();\n    let ctx;\n    if (size < 1) {\n        canvas.width = 1;\n        canvas.height = 1;\n        ctx = canvas.getContext(\"2d\");\n        if (!ctx) throw new Error(\"2d context not supported or canvas already initialized\");\n        ctx.fillStyle = \"rgb(128, 128, 128)\";\n        ctx.fillRect(0, 0, 1, 1);\n    } else if (size > 200) {\n        canvas.width = 401;\n        canvas.height = 401;\n    } else {\n        canvas.width = size * 2;\n        canvas.height = size * 2;\n        ctx = canvas.getContext(\"2d\");\n        if (!ctx) throw new Error(\"2d context not supported or canvas already initialized\");\n        ctx.fillStyle = isDark ? \"rgb(90, 90, 90)\" : \"rgb(255, 255, 255)\";\n        ctx.fillRect(0, 0, size * 2, size * 2);\n        ctx.fillStyle = isDark ? \"rgb(63, 63, 63)\" : \"rgb(200, 200, 200)\";\n        ctx.fillRect(0, 0, size, size);\n        ctx.fillRect(size, size, size * 2, size * 2);\n    }\n    return canvas;\n};\nconst $13d5aa49e37e2734$export$42af33c76b681867 = function() {\n    const cache = {\n        \"8l\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMElEQVQ4T2M8ceLEfwY8wNzcHJ80A+OoAcMiDP7//483HZw8eRJ/Ohg1gIFx6IcBAIhJUqnarXQ1AAAAAElFTkSuQmCC\",\n        \"4l\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJ0lEQVQoU2M8ceLEfwYkYG5ujsxlYKSDgv///6O44eTJk6huoL0CAGsOKVVu8UYvAAAAAElFTkSuQmCC\"\n    };\n    return function(size, callback, isDark) {\n        const modeStr = isDark ? \"d\" : \"l\";\n        function create(size) {\n            size = parseInt(\"\" + size);\n            if (cache[\"\" + size + modeStr]) return cache[\"\" + size + modeStr];\n            const canvas = $13d5aa49e37e2734$export$754559b36e94ea2f(size, isDark);\n            const result = canvas.toDataURL(\"image/png\");\n            cache[\"\" + size + modeStr] = result;\n            return result;\n        }\n        if (callback) setTimeout(function() {\n            callback(create(size));\n        }, 1);\n        else return create(size);\n    };\n}();\nfunction $13d5aa49e37e2734$export$59b33278b5b2fc8a(canvas, w, h, tmp1, tmp2) {\n    //determine base 2 exponents of old and new size\n    function getBase2Obj(oldW, oldH, newW, newH) {\n        const result = {\n            oldWidthEx: Math.round(Math.log2(oldW)),\n            oldHeightEx: Math.round(Math.log2(oldH)),\n            newWidthEx: Math.ceil(Math.log2(newW)),\n            newHeightEx: Math.ceil(Math.log2(newH))\n        };\n        result.oldWidthEx = Math.max(result.oldWidthEx, result.newWidthEx);\n        result.oldHeightEx = Math.max(result.oldHeightEx, result.newHeightEx);\n        return result;\n    }\n    if (!w || !h || w === canvas.width && h === canvas.height) return;\n    w = Math.max(w, 1);\n    h = Math.max(h, 1);\n    if (w <= canvas.width && h <= canvas.height) {\n        tmp1 = !tmp1 ? (0, $9f64dcf89d8f9132$export$cd3d1f114b139967)() : tmp1;\n        tmp2 = !tmp2 ? (0, $9f64dcf89d8f9132$export$cd3d1f114b139967)() : tmp2;\n        const base2 = getBase2Obj(canvas.width, canvas.height, w, h);\n        //initially scale to a base of 2. unless new size is too close to old. e.g. sizing from 900 to 600\n        tmp2.width = base2.oldWidthEx > base2.newWidthEx ? Math.pow(2, base2.oldWidthEx) : w;\n        tmp2.height = base2.oldHeightEx > base2.newHeightEx ? Math.pow(2, base2.oldHeightEx) : h;\n        tmp1.getContext(\"2d\").save();\n        tmp2.getContext(\"2d\").save();\n        let ew, eh;\n        let buffer1 = tmp1, buffer2 = tmp2;\n        ew = base2.oldWidthEx;\n        eh = base2.oldHeightEx;\n        let bufferCtx = buffer2.getContext(\"2d\");\n        bufferCtx.imageSmoothingEnabled = true;\n        bufferCtx.imageSmoothingQuality = \"high\";\n        bufferCtx.globalCompositeOperation = \"copy\";\n        bufferCtx.drawImage(canvas, 0, 0, buffer2.width, buffer2.height);\n        let currentWidth = buffer2.width;\n        let currentHeight = buffer2.height;\n        //stepwise half the size\n        for(; ew > base2.newWidthEx || eh > base2.newHeightEx; ew--, eh--){\n            bufferCtx = buffer1.getContext(\"2d\");\n            bufferCtx.imageSmoothingEnabled = true;\n            bufferCtx.imageSmoothingQuality = \"high\";\n            bufferCtx.globalCompositeOperation = \"copy\";\n            const newWidth = ew > base2.newWidthEx ? currentWidth / 2 : currentWidth;\n            const newHeight = eh > base2.newHeightEx ? currentHeight / 2 : currentHeight;\n            //buffer also needs to be properly sized, unfortunately\n            buffer1.width = newWidth;\n            buffer1.height = newHeight;\n            bufferCtx.drawImage(buffer2, 0, 0, currentWidth, currentHeight, 0, 0, newWidth, newHeight);\n            currentWidth = newWidth;\n            currentHeight = newHeight;\n            //swap\n            const tmp = buffer1;\n            buffer1 = buffer2;\n            buffer2 = tmp;\n        }\n        //when no longer can be halved, bring to target size\n        canvas.width = w;\n        canvas.height = h;\n        const canvasCtx = canvas.getContext(\"2d\");\n        canvasCtx.save();\n        canvasCtx.imageSmoothingEnabled = true;\n        canvasCtx.imageSmoothingQuality = \"high\";\n        canvasCtx.drawImage(buffer2, 0, 0, currentWidth, currentHeight, 0, 0, w, h);\n        canvasCtx.restore();\n        tmp1.getContext(\"2d\").restore();\n        tmp2.getContext(\"2d\").restore();\n    } else if (w >= canvas.width && h >= canvas.height) {\n        tmp1 = !tmp1 ? (0, $9f64dcf89d8f9132$export$cd3d1f114b139967)() : tmp1;\n        tmp1.width = w;\n        tmp1.height = h;\n        const tmp1Ctx = tmp1.getContext(\"2d\");\n        tmp1Ctx.save();\n        tmp1Ctx.imageSmoothingEnabled = true;\n        tmp1Ctx.imageSmoothingQuality = \"high\";\n        tmp1Ctx.drawImage(canvas, 0, 0, w, h);\n        tmp1Ctx.restore();\n        canvas.width = w;\n        canvas.height = h;\n        canvas.getContext(\"2d\").drawImage(tmp1, 0, 0);\n    } else {\n        $13d5aa49e37e2734$export$59b33278b5b2fc8a(canvas, w, canvas.height, tmp1, tmp2);\n        $13d5aa49e37e2734$export$59b33278b5b2fc8a(canvas, w, h, tmp1, tmp2);\n    }\n}\nfunction $13d5aa49e37e2734$export$5a7576952c826b4f(canvas) {\n    const imdat = canvas.getContext(\"2d\").getImageData(0, 0, canvas.width, canvas.height);\n    for(let i = 0; i < imdat.data.length; i += 4){\n        if (imdat.data[i + 3] === 0) continue;\n        imdat.data[i + 3] = (imdat.data[i] + imdat.data[i + 1] + imdat.data[i + 2]) / 3 * (imdat.data[i + 3] / 255);\n    }\n    canvas.getContext(\"2d\").putImageData(imdat, 0, 0);\n}\nfunction $13d5aa49e37e2734$export$2384aff49c9b73c2(canvas) {\n    canvas.width = 1;\n    canvas.height = 1;\n    canvas.remove();\n}\nfunction $13d5aa49e37e2734$export$3db033c6ee0b8700(context) {\n    const boundsObj = {\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0\n    };\n    {\n        const tempBounds = {\n            x1: undefined,\n            y1: undefined,\n            x2: undefined,\n            y2: undefined\n        };\n        const imdat = context.getImageData(0, 0, context.canvas.width, context.canvas.height);\n        if (imdat.data[3] > 0 && imdat.data[imdat.data.length - 1] > 0) {\n            tempBounds.x1 = 0;\n            tempBounds.y1 = 0;\n            tempBounds.x2 = context.canvas.width - 1;\n            tempBounds.y2 = context.canvas.height - 1;\n        } else {\n            for(let i = 3; i < imdat.data.length; i += 4)if (imdat.data[i] > 0) {\n                const x = (i - 3) / 4 % context.canvas.width;\n                const y = Math.floor((i - 3) / 4 / context.canvas.width);\n                if (tempBounds.x1 === undefined || tempBounds.x1 > x) tempBounds.x1 = x;\n                if (tempBounds.y1 === undefined) tempBounds.y1 = y;\n                if (tempBounds.x2 === undefined || tempBounds.x2 < x) tempBounds.x2 = x;\n                if (tempBounds.y2 === undefined || tempBounds.y2 < y) tempBounds.y2 = y;\n            }\n        }\n        if (tempBounds.x1 === undefined || tempBounds.y1 === undefined || tempBounds.x2 === undefined || tempBounds.y2 === undefined) return undefined;\n        boundsObj.x = tempBounds.x1;\n        boundsObj.y = tempBounds.y1;\n        boundsObj.width = tempBounds.x2 - tempBounds.x1 + 1;\n        boundsObj.height = tempBounds.y2 - tempBounds.y1 + 1;\n    }\n    return boundsObj;\n}\n\n\n// https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Matrix_math_for_the_web\n// not optimized\nfunction $1460f8c17429a8fd$var$getIdentity() {\n    return [\n        1,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        1\n    ];\n}\n// point  matrix\nfunction $1460f8c17429a8fd$var$multiplyMatrixAndPoint(matrix, point) {\n    return [\n        point[0] * matrix[0] + point[1] * matrix[4] + point[2] * matrix[8] + point[3] * matrix[12],\n        point[0] * matrix[1] + point[1] * matrix[5] + point[2] * matrix[9] + point[3] * matrix[13],\n        point[0] * matrix[2] + point[1] * matrix[6] + point[2] * matrix[10] + point[3] * matrix[14],\n        point[0] * matrix[3] + point[1] * matrix[7] + point[2] * matrix[11] + point[3] * matrix[15]\n    ];\n}\n//matrixB  matrixA\nfunction $1460f8c17429a8fd$var$multiplyMatrices(matrixA, matrixB) {\n    // Slice the second matrix up into rows\n    const row0 = [\n        matrixB[0],\n        matrixB[1],\n        matrixB[2],\n        matrixB[3]\n    ];\n    const row1 = [\n        matrixB[4],\n        matrixB[5],\n        matrixB[6],\n        matrixB[7]\n    ];\n    const row2 = [\n        matrixB[8],\n        matrixB[9],\n        matrixB[10],\n        matrixB[11]\n    ];\n    const row3 = [\n        matrixB[12],\n        matrixB[13],\n        matrixB[14],\n        matrixB[15]\n    ];\n    // Multiply each row by matrixA\n    const result0 = $1460f8c17429a8fd$var$multiplyMatrixAndPoint(matrixA, row0);\n    const result1 = $1460f8c17429a8fd$var$multiplyMatrixAndPoint(matrixA, row1);\n    const result2 = $1460f8c17429a8fd$var$multiplyMatrixAndPoint(matrixA, row2);\n    const result3 = $1460f8c17429a8fd$var$multiplyMatrixAndPoint(matrixA, row3);\n    // Turn the result rows back into a single matrix\n    return [\n        result0[0],\n        result0[1],\n        result0[2],\n        result0[3],\n        result1[0],\n        result1[1],\n        result1[2],\n        result1[3],\n        result2[0],\n        result2[1],\n        result2[2],\n        result2[3],\n        result3[0],\n        result3[1],\n        result3[2],\n        result3[3]\n    ];\n}\nfunction $1460f8c17429a8fd$var$createTranslationMatrix(x, y) {\n    return [\n        1,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        x,\n        y,\n        0,\n        1\n    ];\n}\nfunction $1460f8c17429a8fd$var$createRotationMatrix(angleRad) {\n    //let angleRad = angleDeg / 360 * 2 * Math.PI;\n    return [\n        Math.cos(-angleRad),\n        -Math.sin(-angleRad),\n        0,\n        0,\n        Math.sin(-angleRad),\n        Math.cos(-angleRad),\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        1\n    ];\n}\nfunction $1460f8c17429a8fd$var$createScaleMatrix(f) {\n    return [\n        f,\n        0,\n        0,\n        0,\n        0,\n        f,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        1\n    ];\n}\nconst $1460f8c17429a8fd$export$5b12bf1653c0dd85 = Object.freeze({\n    getIdentity: $1460f8c17429a8fd$var$getIdentity,\n    multiplyMatrixAndPoint: $1460f8c17429a8fd$var$multiplyMatrixAndPoint,\n    multiplyMatrices: $1460f8c17429a8fd$var$multiplyMatrices,\n    createTranslationMatrix: $1460f8c17429a8fd$var$createTranslationMatrix,\n    createRotationMatrix: $1460f8c17429a8fd$var$createRotationMatrix,\n    createScaleMatrix: $1460f8c17429a8fd$var$createScaleMatrix\n});\n\n\nconst $2890e4902986ac94$export$ac4bca90992eed1 = {\n    add: function(p1, p2) {\n        return {\n            x: p1.x + p2.x,\n            y: p1.y + p2.y\n        };\n    },\n    sub: function(p1, p2) {\n        return {\n            x: p1.x - p2.x,\n            y: p1.y - p2.y\n        };\n    },\n    nor: function(p) {\n        const len = Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\n        return {\n            x: p.x / len,\n            y: p.y / len\n        };\n    },\n    len: function(p) {\n        return Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\n    },\n    dist: function(p1, p2) {\n        return $2890e4902986ac94$export$ac4bca90992eed1.len($2890e4902986ac94$export$ac4bca90992eed1.sub(p1, p2));\n    },\n    mul: function(p, s) {\n        return {\n            x: p.x * s,\n            y: p.y * s\n        };\n    },\n    angle: function(p1, p2) {\n        return Math.atan2(p2.y - p1.y, p2.x - p1.x);\n    },\n    dot: function(a, b) {\n        const aArr = [\n            a.x,\n            a.y\n        ];\n        const bArr = [\n            b.x,\n            b.y\n        ];\n        return aArr.map((x, i)=>aArr[i] * bArr[i]).reduce((m, n)=>m + n);\n    }\n};\n\n\n\n\n\nconst $4e47553489a532e8$export$b4c5b177db876445 = function(lineStart, lineEnd, p) {\n    let x, y;\n    if (lineStart.x === lineEnd.x) {\n        x = lineStart.x;\n        y = p.y;\n        return {\n            x: x,\n            y: y\n        };\n    }\n    const m = (lineEnd.y - lineStart.y) / (lineEnd.x - lineStart.x);\n    const b = lineStart.y - m * lineStart.x;\n    x = (m * p.y + p.x - m * b) / (m * m + 1);\n    y = (m * m * p.y + m * p.x + b) / (m * m + 1);\n    return {\n        x: x,\n        y: y\n    };\n};\nclass $4e47553489a532e8$export$8b36a4a83269a640 {\n    // ---- interface ----\n    /**\n     * returns point when traveling *dist* along the line, > 0\n     * @param dist\n     */ getAtDist(dist) {\n        let remainder = Math.min(this.getLength(), dist);\n        let i = 0;\n        for(; remainder > this.segmentArr[i].length && i < this.segmentArr.length - 2; i++)remainder -= this.segmentArr[i].length;\n        const fac = Math.min(1, Math.max(0, remainder / this.segmentArr[i].length));\n        return {\n            x: this.segmentArr[i].x * (1 - fac) + this.segmentArr[i + 1].x * fac,\n            y: this.segmentArr[i].y * (1 - fac) + this.segmentArr[i + 1].y * fac\n        };\n    }\n    /**\n     * total length of line\n     */ getLength() {\n        let result = 0;\n        for(let i = 0; i < this.segmentArr.length - 1; i++)result += this.segmentArr[i].length;\n        return result;\n    }\n    // ---- public ----\n    constructor(p){\n        this.segmentArr = [];\n        for(let i = 0; i < p.points.length; i++)((i)=>{\n            let length = 0;\n            if (i < p.points.length - 1) length = (0, $9414f5ea41e9cf25$export$6c4a311cc157c764)(p.points[i].x, p.points[i].y, p.points[i + 1].x, p.points[i + 1].y);\n            this.segmentArr[i] = {\n                x: p.points[i].x,\n                y: p.points[i].y,\n                length: length\n            };\n        })(i);\n    }\n}\nclass $4e47553489a532e8$export$5379d955c16d4d43 {\n    /**\n     * creates bezier curve from control points\n     * @param p1 - control point 1 {x: float, y: float}\n     * @param p2 - control point 2 {x: float, y: float}\n     * @param p3 - control point 3 {x: float, y: float}\n     * @param p4 - control point 4 {x: float, y: float}\n     * @param resolution - int\n     * @returns bezier curve made up of points {x: float, y: float}\n     */ getBezierPoints(p1, p2, p3, p4, resolution) {\n        const curvePoints = [];\n        let t;\n        for(let i = 0; i <= resolution; i++){\n            t = i / resolution;\n            curvePoints[curvePoints.length] = {\n                x: Math.pow(1 - t, 3) * p1.x + 3 * Math.pow(1 - t, 2) * t * p2.x + 3 * (1 - t) * Math.pow(t, 2) * p3.x + Math.pow(t, 3) * p4.x,\n                y: Math.pow(1 - t, 3) * p1.y + 3 * Math.pow(1 - t, 2) * t * p2.y + 3 * (1 - t) * Math.pow(t, 2) * p3.y + Math.pow(t, 3) * p4.y\n            };\n        }\n        return curvePoints;\n    }\n    // ---- interface ----\n    /**\n     * Add new point to line. \"Drawn\" line will go until the previous point.\n     *\n     * @param x - coord of new point\n     * @param y\n     * @param spacing - space between each step\n     * @param callback - calls for each step\n     * @param controlsCallback - calls that callback with the bezier control points\n     */ add(x, y, spacing, callback, controlsCallback) {\n        if (this.lastPoint && x === this.lastPoint.x && y === this.lastPoint.y) return;\n        this.lastPoint = {\n            x: x,\n            y: y\n        };\n        this.pointArr[this.pointArr.length] = {\n            x: x,\n            y: y,\n            spacing: spacing\n        };\n        //calculate directions\n        if (this.pointArr.length === 1) {\n            this.lastSpacing = spacing;\n            return;\n        } else if (this.pointArr.length === 2) {\n            this.pointArr[0].dir = (0, $2890e4902986ac94$export$ac4bca90992eed1).nor((0, $2890e4902986ac94$export$ac4bca90992eed1).sub(this.pointArr[1], this.pointArr[0]));\n            this.lastDot = spacing;\n            this.lastSpacing = spacing;\n            return;\n        } else {\n            const pointM1 = this.pointArr[this.pointArr.length - 1];\n            const pointM2 = this.pointArr[this.pointArr.length - 2];\n            const pointM3 = this.pointArr[this.pointArr.length - 3];\n            pointM2.dir = (0, $2890e4902986ac94$export$ac4bca90992eed1).nor((0, $2890e4902986ac94$export$ac4bca90992eed1).sub(pointM1, pointM3));\n            if (isNaN(pointM2.dir.x) || isNaN(pointM2.dir.y)) //when xy -3 == -1\n            pointM2.dir = (0, $fc4403c8ee6a33dc$export$af0d87255f3cfd7e)(pointM3.dir);\n        }\n        //get bezier curve\n        const a = this.pointArr[this.pointArr.length - 3];\n        const b = this.pointArr[this.pointArr.length - 2];\n        const p1 = a;\n        const p2 = (0, $2890e4902986ac94$export$ac4bca90992eed1).add(a, (0, $2890e4902986ac94$export$ac4bca90992eed1).mul(a.dir, (0, $2890e4902986ac94$export$ac4bca90992eed1).dist(a, b) / 4));\n        const p3 = (0, $2890e4902986ac94$export$ac4bca90992eed1).sub(b, (0, $2890e4902986ac94$export$ac4bca90992eed1).mul(b.dir, (0, $2890e4902986ac94$export$ac4bca90992eed1).dist(a, b) / 4));\n        const p4 = b;\n        let pointLine;\n        if (callback) {\n            const curvePoints = this.getBezierPoints(p1, p2, p3, p4, 20);\n            pointLine = new $4e47553489a532e8$export$8b36a4a83269a640({\n                points: curvePoints\n            });\n        } else pointLine = new $4e47553489a532e8$export$8b36a4a83269a640({\n            points: [\n                p1,\n                p4\n            ]\n        });\n        //iterate over curve with spacing and callback\n        const len = pointLine.getLength();\n        let tempSpacing = (0, $9414f5ea41e9cf25$export$2c9e8a9632a706b2)(this.lastSpacing, spacing, (0, $9414f5ea41e9cf25$export$7d15b64cf5a3a4c4)(this.lastDot / len, 0, 1));\n        let d = this.lastDot;\n        for(; d <= len; d += tempSpacing){\n            tempSpacing = (0, $9414f5ea41e9cf25$export$2c9e8a9632a706b2)(this.lastSpacing, spacing, (0, $9414f5ea41e9cf25$export$7d15b64cf5a3a4c4)(d / len, 0, 1));\n            const point = pointLine.getAtDist(d);\n            const angle = this.lastCallbackPoint ? (0, $9414f5ea41e9cf25$export$c03a8450eabc2532)(this.lastCallbackPoint, point) : undefined;\n            if (callback) callback({\n                x: point.x,\n                y: point.y,\n                t: d / len,\n                angle: angle,\n                dAngle: this.lastCallbackPoint ? angle - this.lastAngle : 0\n            });\n            this.lastCallbackPoint = point;\n            this.lastAngle = angle;\n        }\n        if (callback) this.lastDot = d - len;\n        else {\n            this.lastDot = 0;\n            controlsCallback && controlsCallback({\n                p1: p1,\n                p2: p2,\n                p3: p3,\n                p4: p4\n            });\n        }\n        this.lastSpacing = spacing;\n    }\n    addFinal(spacing, callback, controlsCallback) {\n        if (this.pointArr.length < 2) return;\n        const p1 = this.pointArr[this.pointArr.length - 2];\n        const p2 = this.pointArr[this.pointArr.length - 1];\n        const newP = (0, $2890e4902986ac94$export$ac4bca90992eed1).add(p2, (0, $2890e4902986ac94$export$ac4bca90992eed1).sub(p2, p1));\n        this.add(newP.x, newP.y, spacing, callback, controlsCallback);\n    }\n    // ---- public ----\n    constructor(){\n        this.lastDot = 0;\n        this.pointArr = [];\n    }\n}\nclass $4e47553489a532e8$export$80967b1eb9fd6eb4 {\n    // ---- interface ----\n    getFirstX() {\n        return this.first;\n    }\n    getLastX() {\n        return this.last;\n    }\n    interpolate(x) {\n        const n = this.ya.length;\n        let klo = 0;\n        let khi = n - 1;\n        // We will find the right place in the table by means of\n        // bisection. This is optimal if sequential calls to this\n        // routine are at random values of x. If sequential calls\n        // are in order, and closely spaced, one would do better\n        // to store previous values of klo and khi.\n        while(khi - klo > 1){\n            const k = khi + klo >> 1;\n            if (this.xa[k] > x) khi = k;\n            else klo = k;\n        }\n        const h = this.xa[khi] - this.xa[klo];\n        const a = (this.xa[khi] - x) / h;\n        const b = (x - this.xa[klo]) / h;\n        // Cubic spline polynomial is now evaluated.\n        return a * this.ya[klo] + b * this.ya[khi] + ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\n    }\n    /**\n     * find x to y. simply by stepping through. suboptimal, so don't call often.\n     * searches in x 0-1 range\n     */ findX(y, resolution) {\n        let x;\n        let dist;\n        for(let i = 0; i <= resolution; i++){\n            const tempX = i / resolution;\n            const tempY = this.interpolate(tempX);\n            if (x === undefined) {\n                x = tempX;\n                dist = Math.abs(tempY - y);\n                continue;\n            }\n            const tempDist = Math.abs(tempY - y);\n            if (tempDist < dist) {\n                x = tempX;\n                dist = tempDist;\n            } else break;\n        }\n        return x;\n    }\n    // ---- public ----\n    constructor(points){\n        const n = points.length;\n        this.xa = [];\n        this.ya = [];\n        this.u = [];\n        this.y2 = [];\n        let i;\n        this.first = points[0][0];\n        this.last = points[points.length - 1][0];\n        points.sort(function(a, b) {\n            return a[0] - b[0];\n        });\n        for(i = 0; i < n; i++){\n            this.xa.push(points[i][0]);\n            this.ya.push(points[i][1]);\n        }\n        this.u[0] = 0;\n        this.y2[0] = 0;\n        for(i = 1; i < n - 1; ++i){\n            // This is the decomposition loop of the tridiagonal algorithm.\n            // y2 and u are used for temporary storage of the decomposed factors.\n            const wx = this.xa[i + 1] - this.xa[i - 1];\n            const sig = (this.xa[i] - this.xa[i - 1]) / wx;\n            const p = sig * this.y2[i - 1] + 2.0;\n            this.y2[i] = (sig - 1.0) / p;\n            const ddydx = (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) - (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\n            this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\n        }\n        this.y2[n - 1] = 0;\n        // This is the backsubstitution loop of the tridiagonal algorithm\n        for(i = n - 2; i >= 0; --i)this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\n    }\n}\nfunction $4e47553489a532e8$export$4551d4af86c1eb08(startVal, endVal, stepSize) {\n    function round(v, dec) {\n        return Math.round(v * Math.pow(10, dec)) / Math.pow(10, dec);\n    }\n    const resultArr = [];\n    for(let i = 0; i <= 1; i += stepSize)resultArr.push([\n        round(i, 4),\n        round(startVal + Math.pow(i, 2) * (endVal - startVal), 4)\n    ]);\n    return resultArr;\n}\n\n\n// based on js color conversion http://www.webtoolkit.info/\nclass $b68f66663c02a5d5$export$d2edaecd208aed43 {\n    constructor(h, s, v){\n        this.h = Math.max(0, Math.min(360, h));\n        this.s = Math.max(0.001, Math.min(100, s)); //bug when 0\n        this.v = Math.max(0, Math.min(100, v));\n    }\n}\nclass $b68f66663c02a5d5$export$8f9ece5a47764b93 {\n    constructor(r, g, b){\n        this.r = Math.max(0, Math.min(255, r));\n        this.g = Math.max(0, Math.min(255, g));\n        this.b = Math.max(0, Math.min(255, b));\n    }\n}\nclass $b68f66663c02a5d5$export$89d3f85304bf0767 {\n    constructor(c, m, y, k){\n        this.c = Math.max(0, Math.min(100, c));\n        this.m = Math.max(0, Math.min(100, m));\n        this.y = Math.max(0, Math.min(100, y));\n        this.k = Math.max(0, Math.min(100, k));\n    }\n}\nconst $b68f66663c02a5d5$export$fb7efcd2e153af6e = {\n    _RGBtoHSV: function(RGB) {\n        const result = new $b68f66663c02a5d5$export$d2edaecd208aed43(0, 0, 0);\n        const r = RGB.r / 255;\n        const g = RGB.g / 255;\n        const b = RGB.b / 255;\n        const minVal = Math.min(r, g, b);\n        const maxVal = Math.max(r, g, b);\n        const delta = maxVal - minVal;\n        result.v = maxVal;\n        if (delta == 0) {\n            result.h = 0;\n            result.s = 0;\n        } else {\n            result.s = delta / maxVal;\n            const del_R = ((maxVal - r) / 6 + delta / 2) / delta;\n            const del_G = ((maxVal - g) / 6 + delta / 2) / delta;\n            const del_B = ((maxVal - b) / 6 + delta / 2) / delta;\n            if (r == maxVal) result.h = del_B - del_G;\n            else if (g == maxVal) result.h = 1 / 3 + del_R - del_B;\n            else if (b == maxVal) result.h = 2 / 3 + del_G - del_R;\n            if (result.h < 0) result.h += 1;\n            if (result.h > 1) result.h -= 1;\n        }\n        result.h = Math.round(result.h * 360);\n        result.s = Math.round(result.s * 100);\n        result.v = Math.round(result.v * 100);\n        return result;\n    },\n    _HSVtoRGB: function(HSV) {\n        const result = new $b68f66663c02a5d5$export$8f9ece5a47764b93(0, 0, 0);\n        let var_h, var_i, var_1, var_2, var_3, var_r, var_g, var_b;\n        const h = HSV.h / 360 % 1;\n        const s = HSV.s / 100;\n        const v = HSV.v / 100;\n        if (s == 0) {\n            result.r = v * 255;\n            result.g = v * 255;\n            result.b = v * 255;\n        } else {\n            var_h = h * 6;\n            var_i = Math.floor(var_h);\n            var_1 = v * (1 - s);\n            var_2 = v * (1 - s * (var_h - var_i));\n            var_3 = v * (1 - s * (1 - (var_h - var_i)));\n            if (var_i == 0) {\n                var_r = v;\n                var_g = var_3;\n                var_b = var_1;\n            } else if (var_i == 1) {\n                var_r = var_2;\n                var_g = v;\n                var_b = var_1;\n            } else if (var_i == 2) {\n                var_r = var_1;\n                var_g = v;\n                var_b = var_3;\n            } else if (var_i == 3) {\n                var_r = var_1;\n                var_g = var_2;\n                var_b = v;\n            } else if (var_i == 4) {\n                var_r = var_3;\n                var_g = var_1;\n                var_b = v;\n            } else {\n                var_r = v;\n                var_g = var_1;\n                var_b = var_2;\n            }\n            result.r = var_r * 255;\n            result.g = var_g * 255;\n            result.b = var_b * 255;\n            result.r = Math.round(result.r);\n            result.g = Math.round(result.g);\n            result.b = Math.round(result.b);\n        }\n        return result;\n    },\n    _CMYKtoRGB: function(CMYK) {\n        const result = new $b68f66663c02a5d5$export$8f9ece5a47764b93(0, 0, 0);\n        const c = CMYK.c / 100;\n        const m = CMYK.m / 100;\n        const y = CMYK.y / 100;\n        const k = CMYK.k / 100;\n        result.r = 1 - Math.min(1, c * (1 - k) + k);\n        result.g = 1 - Math.min(1, m * (1 - k) + k);\n        result.b = 1 - Math.min(1, y * (1 - k) + k);\n        result.r = Math.round(result.r * 255);\n        result.g = Math.round(result.g * 255);\n        result.b = Math.round(result.b * 255);\n        return result;\n    },\n    _RGBtoCMYK: function(RGB) {\n        const result = new $b68f66663c02a5d5$export$89d3f85304bf0767(0, 0, 0, 0);\n        const r = RGB.r / 255;\n        const g = RGB.g / 255;\n        const b = RGB.b / 255;\n        result.k = Math.min(1 - r, 1 - g, 1 - b);\n        result.c = (1 - r - result.k) / (1 - result.k);\n        result.m = (1 - g - result.k) / (1 - result.k);\n        result.y = (1 - b - result.k) / (1 - result.k);\n        result.c = Math.round(result.c * 100);\n        result.m = Math.round(result.m * 100);\n        result.y = Math.round(result.y * 100);\n        result.k = Math.round(result.k * 100);\n        return result;\n    },\n    toRGB: function(o) {\n        if (o instanceof $b68f66663c02a5d5$export$8f9ece5a47764b93) return o;\n        if (o instanceof $b68f66663c02a5d5$export$d2edaecd208aed43) return this._HSVtoRGB(o);\n        if (o instanceof $b68f66663c02a5d5$export$89d3f85304bf0767) return this._CMYKtoRGB(o);\n        throw new Error(\"unknown type\");\n    },\n    toHSV: function(o) {\n        if (o instanceof $b68f66663c02a5d5$export$d2edaecd208aed43) return o;\n        if (o instanceof $b68f66663c02a5d5$export$8f9ece5a47764b93) return this._RGBtoHSV(o);\n        if (o instanceof $b68f66663c02a5d5$export$89d3f85304bf0767) return this._RGBtoHSV(this._CMYKtoRGB(o));\n        throw new Error(\"unknown type\");\n    },\n    toCMYK: function(o) {\n        if (o instanceof $b68f66663c02a5d5$export$89d3f85304bf0767) return o;\n        if (o instanceof $b68f66663c02a5d5$export$8f9ece5a47764b93) return this._RGBtoCMYK(o);\n        if (o instanceof $b68f66663c02a5d5$export$d2edaecd208aed43) return this._RGBtoCMYK(this._HSVtoRGB(o));\n        throw new Error(\"unknown type\");\n    },\n    toHexString: function(o) {\n        if (o instanceof $b68f66663c02a5d5$export$8f9ece5a47764b93 || \"r\" in o && \"g\" in o && \"b\" in o) {\n            let ha = parseInt(\"\" + o.r).toString(16);\n            let hb = parseInt(\"\" + o.g).toString(16);\n            let hc = parseInt(\"\" + o.b).toString(16);\n            if (ha.length == 1) ha = \"0\" + ha;\n            if (hb.length == 1) hb = \"0\" + hb;\n            if (hc.length == 1) hc = \"0\" + hc;\n            return ha + hb + hc;\n        }\n        return \"#000\";\n    },\n    toRgbStr: function(rgbObj) {\n        return \"rgb(\" + Math.round(rgbObj.r) + \", \" + Math.round(rgbObj.g) + \", \" + Math.round(rgbObj.b) + \")\";\n    },\n    toRgbaStr: function(rgbaObj) {\n        return \"rgba(\" + Math.round(rgbaObj.r) + \", \" + Math.round(rgbaObj.g) + \", \" + Math.round(rgbaObj.b) + \", \" + rgbaObj.a + \")\";\n    },\n    hexToRGB: function(hexStr) {\n        hexStr = hexStr.trim();\n        // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\n        const shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n        hexStr = hexStr.replace(shorthandRegex, function(m, r, g, b) {\n            return r + r + g + g + b + b;\n        });\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hexStr);\n        return result ? new $b68f66663c02a5d5$export$8f9ece5a47764b93(parseInt(result[1], 16), parseInt(result[2], 16), parseInt(result[3], 16)) : undefined;\n    }\n};\nfunction $b68f66663c02a5d5$export$5cf396345d1238ae(rgbObj) {\n    return rgbObj.r * 0.299 + rgbObj.g * 0.587 + rgbObj.b * 0.114 < 125;\n}\n\n\n\n\nfunction $52ad4d7a7d6372c1$export$7868464f598ba79d(target, text) {\n    const div = document.createElement(\"div\");\n    div.innerHTML = text;\n    target.append(div);\n    return div;\n}\nfunction $52ad4d7a7d6372c1$export$906dfdb7df31ccfc(getAll = false) {\n    var _document_activeElement;\n    const result = !!document.activeElement && [\n        \"INPUT\",\n        \"TEXTAREA\",\n        \"SELECT\"\n    ].includes(document.activeElement.tagName);\n    if (getAll) return result;\n    else return result && !((_document_activeElement = document.activeElement) === null || _document_activeElement === void 0 ? void 0 : _document_activeElement.getAttribute(\"data-ignore-focus\"));\n}\nfunction $52ad4d7a7d6372c1$export$e05240ca9e0b8bd9() {\n    if ($52ad4d7a7d6372c1$export$906dfdb7df31ccfc(true)) {\n        /*\n            Unfocus anything that is focused.\n\n            If an Input is focused in Firefox, and it gets detached from the DOM via a Node\n            that isn't its direct parent, then Firefox will keep anything attached to this\n            Input in memory. It will not be garbage collected until a new Input is focused.\n\n            Workaround: Temporarily create an input, focus it, detach it.\n             */ const focusEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: document.body,\n            tagName: \"input\",\n            css: {\n                opacity: \"0\",\n                width: \"0\",\n                height: \"0\"\n            }\n        });\n        setTimeout(()=>{\n            focusEl.select();\n            focusEl.focus();\n            focusEl.remove();\n        }, 10);\n    }\n}\nfunction $52ad4d7a7d6372c1$export$a3d02541b0ebf605() {\n    if (window.getSelection) {\n        const sel = window.getSelection();\n        if (sel) {\n            if (sel.empty) sel.empty();\n            else if (sel.removeAllRanges) sel.removeAllRanges();\n        }\n    }\n}\nconst $52ad4d7a7d6372c1$export$6bd63bfceaafae0c = function() {\n    function preventFocus(event) {\n        event.preventDefault();\n        let didFocusRelated = false;\n        if (event.relatedTarget) try {\n            event.relatedTarget.focus();\n            didFocusRelated = true;\n        } catch (e) {\n            console.error(\"failed to focus\");\n        }\n        if (!didFocusRelated) event.currentTarget.blur();\n    }\n    return function(el) {\n        el.setAttribute(\"tabindex\", \"-1\");\n        el.addEventListener(\"focus\", preventFocus);\n    };\n}();\nconst $52ad4d7a7d6372c1$var$els = [];\nfunction $52ad4d7a7d6372c1$export$c3da0dad1b44eea9(params) {\n    if (!params) return document.createElement(\"div\");\n    const result = document.createElement(params.tagName ? params.tagName : \"div\");\n    params.css && (0, $fc4403c8ee6a33dc$export$dbf350e5966cf602)(result, params.css);\n    if (params.content) {\n        if (typeof params.content === \"string\") result.innerHTML = params.content;\n        else if (Array.isArray(params.content)) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).append(result, params.content);\n        else result.append(params.content);\n    }\n    if (params.textContent) result.textContent = params.textContent;\n    if (params.className) result.className = params.className;\n    if (params.id) result.id = params.id;\n    if (params.parent) params.parent.append(result);\n    if (\"title\" in params && params.title !== undefined) result.title = params.title;\n    const listeners = [];\n    if (params.onClick !== undefined) {\n        result.addEventListener(\"click\", params.onClick);\n        !params.noRef && listeners.push([\n            \"click\",\n            params.onClick\n        ]);\n    }\n    if (params.onChange !== undefined) {\n        result.addEventListener(\"change\", params.onChange);\n        !params.noRef && listeners.push([\n            \"change\",\n            params.onChange\n        ]);\n    }\n    if (listeners.length > 0) $52ad4d7a7d6372c1$var$els.push({\n        el: result,\n        listeners: listeners\n    });\n    if (\"custom\" in params && params.custom) {\n        const customKeyArr = Object.keys(params.custom);\n        for(let i = 0; i < customKeyArr.length; i++)result.setAttribute(customKeyArr[i], params.custom[customKeyArr[i]]);\n    }\n    return result;\n}\nfunction $52ad4d7a7d6372c1$export$b1da1db524e22115(el) {\n    if (!el) return;\n    for(let i = 0; i < $52ad4d7a7d6372c1$var$els.length; i++){\n        const item = $52ad4d7a7d6372c1$var$els[i];\n        if (item.el === el) {\n            item.listeners.forEach((item)=>{\n                el.removeEventListener(item[0], item[1]);\n            });\n            $52ad4d7a7d6372c1$var$els.splice(i, 1);\n            return;\n        }\n    }\n    // not found\n    return;\n}\n\n\n\n\nclass $e0f57e18e675096c$export$9860cd9e09e6f8ba {\n    static subscribe(listener) {\n        if ($e0f57e18e675096c$export$9860cd9e09e6f8ba.listeners.includes(listener)) return;\n        $e0f57e18e675096c$export$9860cd9e09e6f8ba.listeners.push(listener);\n    }\n    static unsubscribe(listener) {\n        for(let i = 0; i < $e0f57e18e675096c$export$9860cd9e09e6f8ba.listeners.length; i++)if (listener === $e0f57e18e675096c$export$9860cd9e09e6f8ba.listeners[i]) {\n            $e0f57e18e675096c$export$9860cd9e09e6f8ba.listeners.splice(i, 1);\n            return;\n        }\n    }\n    static emit(msg) {\n        $e0f57e18e675096c$export$9860cd9e09e6f8ba.listeners.forEach((item)=>{\n            item(msg);\n        });\n    }\n    constructor(){}\n}\n$e0f57e18e675096c$export$9860cd9e09e6f8ba.listeners = [];\n\n\n/**\n * LocalStorage wrapper that does not throw exceptions.\n * If cookies disabled in Safari localStorage interactions throw exception \"insecure operation\"\n */ class $0ecef66681b62a8c$export$19fffca37ef3e106 {\n    static getItem(key) {\n        // (disabled) eslint-disable-next-line no-null/no-null\n        let result = null;\n        try {\n            result = localStorage.getItem(key);\n        } catch (e) {\n            this.error = e;\n        }\n        return result;\n    }\n    static setItem(key, value) {\n        try {\n            localStorage.setItem(key, value);\n        } catch (e) {\n            this.error = e;\n        }\n    }\n    static removeItem(key) {\n        try {\n            localStorage.removeItem(key);\n        } catch (e) {\n            this.error = e;\n        }\n    }\n    static getError() {\n        return this.error;\n    }\n}\n\n\n\nclass $2df67d7abe113884$export$fe11e0afe623a677 {\n    // ---- public ----\n    setChainOut(func) {\n        this.chainOut = func;\n    }\n    chainIn(event) {\n        if (event.type === \"pointermove\") {\n            if (event.coalescedArr && event.coalescedArr.length > 0) for(let i = 0; i < event.coalescedArr.length; i++){\n                const eventCopy = (0, $fc4403c8ee6a33dc$export$af0d87255f3cfd7e)(event);\n                if (i === 0) eventCopy.coalescedArr = [];\n                const coalescedItem = event.coalescedArr[i];\n                eventCopy.pageX = coalescedItem.pageX;\n                eventCopy.pageY = coalescedItem.pageY;\n                eventCopy.relX = coalescedItem.relX;\n                eventCopy.relY = coalescedItem.relY;\n                eventCopy.dX = coalescedItem.dX;\n                eventCopy.dY = coalescedItem.dY;\n                eventCopy.time = coalescedItem.time;\n                if (i < event.coalescedArr.length - 1) eventCopy.isCoalesced = true;\n                this.chainOut && this.chainOut(eventCopy);\n            }\n            else return event;\n        } else return event;\n        return null;\n    }\n}\n\n\n\nclass $ee2eb319667e1e48$export$510622b8aed00381 {\n    failGesture() {\n        if (this.eventQueueArr.length === 0) return;\n        this.timeoutObj.firstLastDownTimeout && clearTimeout(this.timeoutObj.firstLastDownTimeout);\n        this.timeoutObj.tapTimeout && clearTimeout(this.timeoutObj.tapTimeout);\n        for(let i = 0; i < this.eventQueueArr.length; i++)this.chainOut && this.chainOut(this.eventQueueArr[i]);\n        this.eventQueueArr = [];\n        this.fingerArr = [];\n    }\n    success() {\n        this.timeoutObj.firstLastDownTimeout && clearTimeout(this.timeoutObj.firstLastDownTimeout);\n        this.timeoutObj.tapTimeout && clearTimeout(this.timeoutObj.tapTimeout);\n        this.eventQueueArr = []; // events get swallowed\n        this.fingerArr = [];\n        this.onTap();\n    }\n    setupTimeout(timeoutStr, timeMS) {\n        const diff = timeMS - this.nowTime;\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\n        if (diff <= 0) return false;\n        this.timeoutObj[timeoutStr] = setTimeout(()=>this.failGesture(), diff);\n        return true;\n    }\n    processEvent(event) {\n        const tempLastEventTime = this.lastEventTime;\n        this.lastEventTime = event.time;\n        if (event.type === \"pointerdown\") this.pointersDownIdArr.push(event.pointerId);\n        else if (event.type === \"pointerup\") {\n            for(let i = 0; i < this.pointersDownIdArr.length; i++)if (this.pointersDownIdArr[i] === event.pointerId) {\n                this.pointersDownIdArr.splice(i, 1);\n                break;\n            }\n        }\n        if (event.pointerType !== \"touch\") {\n            if (this.fingerArr.length > 0) this.failGesture();\n            return;\n        }\n        this.nowTime = performance.now();\n        if (event.type === \"pointerdown\") {\n            //console.log('down');\n            if (this.fingerArr.length + 1 !== this.pointersDownIdArr.length) {\n                this.failGesture();\n                return;\n            }\n            if (this.fingerArr.length === this.fingers) {\n                //console.log(fingers + ': too many fingers down -> fail');\n                this.failGesture();\n                return;\n            }\n            if (this.fingerArr.length > 0 && event.time - this.maxFirstLastFingerDownMs > this.fingerArr[0].downTimeMs) {\n                //console.log(fingers + ': took too long to touch with all fingers -> fail');\n                this.failGesture();\n                return;\n            }\n            if (this.fingerArr.length === 0 && event.time - this.minSilenceBeforeDurationMs < tempLastEventTime) {\n                //console.log(fingers + ': not enough silence before -> fail');\n                this.failGesture();\n                return;\n            }\n            if (this.fingerArr.length === 0) {\n                this.firstDownTime = event.time;\n                if (!this.setupTimeout(\"firstLastDownTimeout\", event.time + this.maxFirstLastFingerDownMs) || !this.setupTimeout(\"tapTimeout\", event.time + this.maxTapMs)) {\n                    this.failGesture();\n                    return;\n                }\n            }\n            this.fingerArr.push({\n                pointerId: event.pointerId,\n                downTimeMs: event.time,\n                downPageX: event.pageX,\n                downPageY: event.pageY\n            });\n            return;\n        }\n        if (event.type === \"pointermove\") {\n            if (this.fingerArr.length === 0) //not in a gesture -> ignore\n            return;\n            let fingerObj = null;\n            for(let i = 0; i < this.fingerArr.length; i++)if (this.fingerArr[i].pointerId === event.pointerId) {\n                fingerObj = this.fingerArr[i];\n                break;\n            }\n            if (fingerObj === null) {\n                this.failGesture();\n                return;\n            }\n            if (event.time - this.maxTapMs > this.firstDownTime) {\n                //console.log(fingers + ': tap took too long -> fail');\n                this.failGesture();\n                return;\n            }\n            const distance = (0, $9414f5ea41e9cf25$export$6c4a311cc157c764)(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\n            if (distance > this.maxPressedDistancePx) {\n                //console.log(fingers + ': a finger moved too much -> fail', distance);\n                this.failGesture();\n                return;\n            }\n        }\n        if (event.type === \"pointerup\") {\n            if (this.fingerArr.length === 0) //not in a gesture -> ignore\n            return;\n            //console.log('up', event.pageX, event.pageY);\n            if (this.fingerArr.length !== this.fingers) {\n                //console.log(fingers + ': not enough fingers -> fail');\n                this.failGesture();\n                return;\n            }\n            let fingerObj = null;\n            let i = 0;\n            for(; i < this.fingerArr.length; i++)if (this.fingerArr[i].pointerId === event.pointerId) {\n                fingerObj = this.fingerArr[i];\n                break;\n            }\n            if (fingerObj === null) //do nothing\n            return;\n            if (event.time - this.maxTapMs > this.firstDownTime) {\n                //console.log(fingers + ': tap took too long -> fail');\n                this.failGesture();\n                return;\n            }\n            const distance = (0, $9414f5ea41e9cf25$export$6c4a311cc157c764)(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\n            if (distance > this.maxPressedDistancePx) {\n                //console.log(fingers + ': b finger moved too much -> fail', distance, event.pageX, event.pageY);\n                //console.log(fingerArr);\n                this.failGesture();\n                return;\n            }\n            fingerObj.isUp = true;\n            let allAreUp = true;\n            for(let i = 0; i < this.fingerArr.length; i++)if (!this.fingerArr[i].isUp) {\n                allAreUp = false;\n                break;\n            }\n            //console.log('fingerArr', fingerArr);\n            if (allAreUp) {\n                this.success();\n                return true;\n            }\n        }\n    }\n    chainIn(event) {\n        const result = this.processEvent(event);\n        //console.log(fingerArr.length);\n        if (result === true) //tap success -> event gets swallowed\n        return null;\n        if (this.fingerArr.length === 0) return event;\n        else this.eventQueueArr.push(event);\n        return null;\n    }\n    setChainOut(func) {\n        this.chainOut = func;\n    }\n    // ---- public ----\n    constructor(p){\n        this.minSilenceBeforeDurationMs = 50;\n        this.maxTapMs = 500;\n        this.maxFirstLastFingerDownMs = 250;\n        this.maxPressedDistancePx = 12 //5 + fingers * 5;\n        ;\n        this.fingerArr = [];\n        this.eventQueueArr = [];\n        this.firstDownTime = 0;\n        this.lastEventTime = 0;\n        this.nowTime = performance.now();\n        this.pointersDownIdArr = [];\n        this.timeoutObj = {\n            firstLastDownTimeout: null,\n            tapTimeout: null\n        };\n        this.fingers = p.fingers;\n        this.onTap = p.onTap;\n    }\n}\n\n\n\nclass $5ba93bbe34fd1582$export$d62358ac2d82abb3 {\n    end() {\n        this.gestureObj = null;\n        this.eventQueueArr = [];\n    }\n    fail(doSwallow) {\n        if (!this.gestureObj) return;\n        this.timeoutObj.secondFingerTimeout && clearTimeout(this.timeoutObj.secondFingerTimeout);\n        if (!doSwallow) for(let i = 0; i < this.eventQueueArr.length; i++)this.chainOut && this.chainOut(this.eventQueueArr[i]);\n        this.end();\n    }\n    setupFailTimeout(timeMS) {\n        const diff = timeMS - this.nowTime;\n        if (diff <= 0) return false;\n        this.timeoutObj.secondFingerTimeout = setTimeout(()=>this.fail(), diff);\n        return true;\n    }\n    processEvent(event) {\n        if (event.type === \"pointerdown\") this.pointersDownIdArr.push(event.pointerId);\n        else if (event.type === \"pointerup\") {\n            for(let i = 0; i < this.pointersDownIdArr.length; i++)if (this.pointersDownIdArr[i] === event.pointerId) {\n                this.pointersDownIdArr.splice(i, 1);\n                break;\n            }\n        }\n        //pass through scenarios\n        if (!this.gestureObj && (event.pointerType !== \"touch\" || // wrong pointer type\n        event.type === \"pointermove\" && this.pointersDownIdArr.length > 0 || // failed before\n        this.pointersDownIdArr.length > 1 || // failed before\n        event.type === \"pointerup\" // failed before\n        )) return;\n        this.nowTime = performance.now();\n        //pointer down\n        if (event.type === \"pointerdown\") {\n            if (this.gestureObj) {\n                if (event.pointerType === \"touch\") {\n                    this.gestureObj.touchPointerArr.push({\n                        pointerId: event.pointerId,\n                        relX: event.relX,\n                        relY: event.relY\n                    });\n                    if (this.gestureObj.isInProgress) this.continuePinch(this.gestureObj, {\n                        type: \"down\",\n                        index: this.gestureObj.touchPointerArr.length - 1\n                    });\n                    else {\n                        this.timeoutObj.secondFingerTimeout && clearTimeout(this.timeoutObj.secondFingerTimeout);\n                        this.gestureObj.isInProgress = true;\n                        this.beginPinch(this.gestureObj);\n                    }\n                    return;\n                } else {\n                    if (this.gestureObj.isInProgress) this.gestureObj.otherPointerIdArr.push(event.pointerId);\n                    else this.fail();\n                    return;\n                }\n            } else {\n                // first finger down - can only be touch if no gestureObj\n                this.gestureObj = {\n                    touchPointerArr: [\n                        {\n                            pointerId: event.pointerId,\n                            relX: event.relX,\n                            relY: event.relY,\n                            downRelX: event.relX,\n                            downRelY: event.relY\n                        }\n                    ],\n                    otherPointerIdArr: [],\n                    isInProgress: false\n                };\n                if (!this.setupFailTimeout(event.time + this.untilSecondFingerDurationMs)) {\n                    this.fail();\n                    return;\n                }\n                return;\n            }\n        }\n        // should not happen. something went wrong\n        if (!this.gestureObj) {\n            // throw? would make it less robust\n            this.fail();\n            return;\n        }\n        //pointer move\n        if (event.type === \"pointermove\" && event.pointerType === \"touch\") {\n            //gesture object should always exist here\n            let touchPointerObj = null;\n            let i = 0;\n            for(; i < this.gestureObj.touchPointerArr.length; i++)if (event.pointerId === this.gestureObj.touchPointerArr[i].pointerId) {\n                touchPointerObj = this.gestureObj.touchPointerArr[i];\n                break;\n            }\n            //null should not be possible. something went wrong\n            if (!touchPointerObj) {\n                // throw? would make it less robust\n                this.fail();\n                return;\n            }\n            touchPointerObj.relX = event.relX;\n            touchPointerObj.relY = event.relY;\n            if (!this.gestureObj.isInProgress) {\n                // should not happen. something went wrong\n                if (!(\"downRelX\" in touchPointerObj && touchPointerObj.downRelX !== undefined) || !(\"downRelY\" in touchPointerObj && touchPointerObj.downRelY !== undefined)) {\n                    this.fail();\n                    return;\n                }\n                const distance = (0, $9414f5ea41e9cf25$export$6c4a311cc157c764)(touchPointerObj.downRelX, touchPointerObj.downRelY, touchPointerObj.relX, touchPointerObj.relY);\n                if (distance > this.firstFingerMaxDistancePx) {\n                    this.fail();\n                    return;\n                }\n            } else if (i < 2) this.continuePinch(this.gestureObj, {\n                type: \"move\",\n                index: i\n            });\n            return;\n        }\n        //pointer up\n        if (event.type === \"pointerup\") {\n            //gesture object should always exist here\n            if (event.pointerType === \"touch\") {\n                let i = 0;\n                for(; i < this.gestureObj.touchPointerArr.length; i++)if (this.gestureObj.touchPointerArr[i].pointerId === event.pointerId) {\n                    this.gestureObj.touchPointerArr.splice(i, 1);\n                    break;\n                }\n                if (this.gestureObj.touchPointerArr.length > 0) this.continuePinch(this.gestureObj, {\n                    type: \"up\",\n                    index: i\n                });\n            } else {\n                for(let i = 0; i < this.gestureObj.otherPointerIdArr.length; i++)if (this.gestureObj.otherPointerIdArr[i] === event.pointerId) {\n                    this.gestureObj.otherPointerIdArr.splice(i, 1);\n                    break;\n                }\n            }\n            //all fingers lifted?\n            if (this.gestureObj.touchPointerArr.length === 0 && this.gestureObj.otherPointerIdArr.length === 0) {\n                if (this.gestureObj.isInProgress) {\n                    this.end();\n                    this.endPinch();\n                } else this.fail();\n                return;\n            }\n        }\n    }\n    beginPinch(gestureObj) {\n        for(let i = 0; i < gestureObj.touchPointerArr.length; i++){\n            const pointerObj = gestureObj.touchPointerArr[i];\n            this.pincherArr.push({\n                pointerId: pointerObj.pointerId,\n                relX: pointerObj.relX,\n                relY: pointerObj.relY,\n                downRelX: pointerObj.relX,\n                downRelY: pointerObj.relY\n            });\n        }\n        const event = {\n            type: \"move\",\n            // temp\n            downRelX: 0,\n            downRelY: 0,\n            relX: 0,\n            relY: 0,\n            angleRad: 0,\n            scale: 1\n        };\n        if (this.pincherArr.length === 1) {\n            event.relX = this.pincherArr[0].downRelX;\n            event.relY = this.pincherArr[0].downRelY;\n        } else {\n            event.relX = 0.5 * (this.pincherArr[0].downRelX + this.pincherArr[1].downRelX);\n            event.relY = 0.5 * (this.pincherArr[0].downRelY + this.pincherArr[1].downRelY);\n        }\n        event.downRelX = event.relX;\n        event.downRelY = event.relY;\n        this.onPinch(event);\n    }\n    //actionObj = {type: 'down'|'move'|'up', index: number}\n    continuePinch(gestureObj, actionObj) {\n        if (actionObj.index > 1) return;\n        if (actionObj.type === \"move\") {\n            let event;\n            this.pincherArr[actionObj.index].relX = gestureObj.touchPointerArr[actionObj.index].relX;\n            this.pincherArr[actionObj.index].relY = gestureObj.touchPointerArr[actionObj.index].relY;\n            if (this.pincherArr.length === 1) event = {\n                type: \"move\",\n                downRelX: this.pincherArr[0].downRelX,\n                downRelY: this.pincherArr[0].downRelY,\n                relX: this.pincherArr[0].relX,\n                relY: this.pincherArr[0].relY,\n                angleRad: 0,\n                scale: 1\n            };\n            else {\n                const startDist = (0, $9414f5ea41e9cf25$export$6c4a311cc157c764)(this.pincherArr[0].downRelX, this.pincherArr[0].downRelY, this.pincherArr[1].downRelX, this.pincherArr[1].downRelY);\n                const distance = (0, $9414f5ea41e9cf25$export$6c4a311cc157c764)(this.pincherArr[0].relX, this.pincherArr[0].relY, this.pincherArr[1].relX, this.pincherArr[1].relY);\n                const startAngle = (0, $9414f5ea41e9cf25$export$627023b405ba5028)({\n                    x: this.pincherArr[0].downRelX,\n                    y: this.pincherArr[0].downRelY\n                }, {\n                    x: this.pincherArr[1].downRelX,\n                    y: this.pincherArr[1].downRelY\n                });\n                const angle = (0, $9414f5ea41e9cf25$export$627023b405ba5028)({\n                    x: this.pincherArr[0].relX,\n                    y: this.pincherArr[0].relY\n                }, {\n                    x: this.pincherArr[1].relX,\n                    y: this.pincherArr[1].relY\n                });\n                event = {\n                    type: \"move\",\n                    downRelX: 0.5 * (this.pincherArr[0].downRelX + this.pincherArr[1].downRelX),\n                    downRelY: 0.5 * (this.pincherArr[0].downRelY + this.pincherArr[1].downRelY),\n                    relX: 0.5 * (this.pincherArr[0].relX + this.pincherArr[1].relX),\n                    relY: 0.5 * (this.pincherArr[0].relY + this.pincherArr[1].relY),\n                    angleRad: angle - startAngle,\n                    scale: distance / startDist\n                };\n            }\n            this.onPinch(event);\n        } else if (actionObj.type === \"down\" || actionObj.type === \"up\") {\n            this.endPinch();\n            this.beginPinch(gestureObj);\n        }\n    }\n    endPinch() {\n        this.pincherArr = [];\n        this.onPinch({\n            type: \"end\"\n        });\n    }\n    chainIn(event) {\n        this.processEvent(event);\n        if (this.gestureObj) {\n            if (!this.gestureObj.isInProgress) this.eventQueueArr.push(event);\n        } else return event;\n        return null;\n    }\n    setChainOut(func) {\n        this.chainOut = func;\n    }\n    // ---- public ----\n    constructor(p){\n        this.firstFingerMaxDistancePx = 10;\n        this.untilSecondFingerDurationMs = 250;\n        this.pointersDownIdArr = [];\n        this.gestureObj = null;\n        this.eventQueueArr = [];\n        this.nowTime = performance.now();\n        this.timeoutObj = {\n            secondFingerTimeout: null\n        };\n        this.pincherArr = [];\n        this.onPinch = p.onPinch;\n    }\n}\n\n\n\nclass $afe05ecd8ae7f4be$export$db3963a21c01d803 {\n    // double tap achieved\n    success() {\n        this.timeoutObj.fail = null;\n        this.timeoutObj.success = null;\n        this.eventQueueArr = []; // events get swallowed\n        const lastSequenceItem = this.sequenceArr[this.sequenceArr.length - 1];\n        this.sequenceArr = [];\n        if (\"pageX\" in lastSequenceItem) this.onDoubleTap({\n            pageX: lastSequenceItem.pageX,\n            pageY: lastSequenceItem.pageY,\n            relX: lastSequenceItem.relX,\n            relY: lastSequenceItem.relY\n        });\n    }\n    // returns false if time already up. otherwise sets up timeout\n    setupTimeout(timeoutStr, targetFunc, timeMS, noComparison) {\n        const diff = timeMS - this.nowTime;\n        // console.log(fingers + ': ' + timeoutStr + ' diff', diff);\n        if (diff <= 0 && !noComparison) return false;\n        this.timeoutObj[timeoutStr] = setTimeout(targetFunc, Math.max(0, diff));\n        return true;\n    }\n    /**\n     * @param event object - a pointer event from BB.PointerListener\n     */ processEvent(event) {\n        if (event.type === \"pointerdown\") this.pointersDownIdArr.push(event.pointerId);\n        else if (event.type === \"pointerup\") {\n            for(let i = 0; i < this.pointersDownIdArr.length; i++)if (this.pointersDownIdArr[i] === event.pointerId) {\n                this.pointersDownIdArr.splice(i, 1);\n                break;\n            }\n        }\n        if (!this.allowedPointerTypeArr.includes(event.pointerType)) {\n            //console.log('wrong input type -> fail');\n            this.gestureFailed();\n            return;\n        }\n        this.nowTime = performance.now();\n        const lastSequenceItem = this.sequenceArr.length > 0 ? this.sequenceArr[this.sequenceArr.length - 1] : null;\n        if (event.type === \"pointerup\") this.lastUpTime = event.time;\n        if (event.type === \"pointerdown\") {\n            if (this.pointersDownIdArr.length > 1) {\n                //console.log('more than one pointer down -> fail');\n                this.gestureFailed();\n                return;\n            }\n            if (this.timeoutObj.success !== null) {\n                //console.log('silence-after not achieved -> fail');\n                this.gestureFailed();\n                return;\n            }\n            if (this.sequenceArr.length === 0 && this.nowTime - this.lastUpTime < this.minSilenceBeforeDurationMs) {\n                //console.log('silence before not achieved -> fail');\n                this.gestureFailed();\n                return;\n            }\n            if (event.button && !this.allowedButtonArr.includes(event.button)) {\n                //console.log('wrong button -> fail', event.button, allowedButtonArr);\n                this.gestureFailed();\n                return;\n            }\n            if (lastSequenceItem && \"isDown\" in lastSequenceItem && lastSequenceItem.isDown || this.sequenceArr.length > 2) {\n                //console.log('jumbled -> fail');\n                this.gestureFailed();\n                return;\n            }\n            if (lastSequenceItem && \"position\" in lastSequenceItem) {\n                const distance = (0, $9414f5ea41e9cf25$export$6c4a311cc157c764)(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\n                if (distance > this.maxInbetweenDistancePx) {\n                    //console.log('maxInbetweenDistancePx -> reset');\n                    this.gestureFailed();\n                    if (\"time\" in lastSequenceItem && this.nowTime - lastSequenceItem.time < this.minSilenceBeforeDurationMs) return;\n                }\n            }\n            this.sequenceArr.push({\n                isDown: true,\n                time: this.nowTime,\n                position: [\n                    event.pageX,\n                    event.pageY\n                ],\n                pointerId: event.pointerId\n            });\n            //maxUntilSecondDown\n            if (this.sequenceArr.length > 1) this.timeoutObj.maxUntilSecondDown && clearTimeout(this.timeoutObj.maxUntilSecondDown);\n            else if (!this.setupTimeout(\"maxUntilSecondDown\", ()=>this.gestureFailed(), event.time + this.maxUntilSecondDownDurationMs)) {\n                //console.log('event.time + maxPressedDurationMs -> fail');\n                this.gestureFailed();\n                return;\n            }\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\n            if (!this.setupTimeout(\"fail\", ()=>this.gestureFailed(), event.time + this.maxPressedDurationMs)) {\n                //console.log('event.time + maxPressedDurationMs -> fail');\n                this.gestureFailed();\n                return;\n            }\n        }\n        if (lastSequenceItem && event.type === \"pointermove\" && \"pointerId\" in lastSequenceItem && lastSequenceItem.pointerId === event.pointerId) {\n            /*if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\n                console.log('another pointer mixing in -> fail');\n                this.fail();\n                return;\n            }*/ const distance = (0, $9414f5ea41e9cf25$export$6c4a311cc157c764)(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\n            if (distance > this.maxPressedDistancePx) {\n                //console.log('maxPressedDistancePx -> fail');\n                this.gestureFailed();\n                return;\n            }\n        }\n        if (lastSequenceItem && event.type === \"pointerup\") {\n            if (\"pointerId\" in lastSequenceItem && lastSequenceItem.pointerId !== event.pointerId) {\n                this.gestureFailed();\n                return;\n            }\n            if (\"time\" in lastSequenceItem && this.nowTime >= lastSequenceItem.time + this.maxPressedDurationMs) {\n                this.gestureFailed();\n                return;\n            }\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\n            if (this.sequenceArr.length < 3) {\n                if (!this.setupTimeout(\"fail\", ()=>this.gestureFailed(), event.time + this.maxUpToUpDurationMs)) {\n                    this.gestureFailed();\n                    return;\n                }\n                this.sequenceArr = [\n                    lastSequenceItem,\n                    {\n                        isUp: true,\n                        time: this.nowTime,\n                        position: [\n                            event.pageX,\n                            event.pageY\n                        ]\n                    }\n                ];\n                return;\n            }\n            if (\"time\" in this.sequenceArr[1] && this.nowTime < this.sequenceArr[1].time + this.maxUpToUpDurationMs) {\n                // double tap almost success\n                // only needs silence\n                this.sequenceArr.push({\n                    pageX: event.pageX,\n                    pageY: event.pageY,\n                    relX: event.relX,\n                    relY: event.relY\n                });\n                if (!this.setupTimeout(\"success\", ()=>this.success(), event.time + this.minSilenceAfterMs, true)) this.gestureFailed();\n            } else this.gestureFailed();\n        }\n    }\n    chainIn(event) {\n        this.processEvent(event);\n        if (this.sequenceArr.length === 0) {\n            this.gestureFailed();\n            return event;\n        }\n        // events might become a double tap -> queue\n        this.eventQueueArr.push(event);\n        return null;\n    }\n    setChainOut(func) {\n        this.chainOut = func;\n    }\n    setAllowedPointerTypeArr(arr) {\n        this.allowedPointerTypeArr = [\n            ...arr\n        ];\n    }\n    setAllowedButtonArr(arr) {\n        this.allowedButtonArr = [\n            ...arr\n        ];\n    }\n    // ---- public ----\n    constructor(p){\n        this.allowedPointerTypeArr = [\n            \"touch\",\n            \"mouse\",\n            \"pen\"\n        ];\n        this.allowedButtonArr = [\n            \"left\"\n        ];\n        this.minSilenceBeforeDurationMs = 400;\n        this.maxPressedDurationMs = 300;\n        this.maxPressedDistancePx = 10;\n        this.maxInbetweenDistancePx = 19;\n        this.maxUpToUpDurationMs = 500;\n        this.maxUntilSecondDownDurationMs = 300;\n        this.minSilenceAfterMs = 250;\n        this.sequenceArr = [];\n        this.pointersDownIdArr = [];\n        this.lastUpTime = 0;\n        this.nowTime = 0;\n        this.eventQueueArr = [];\n        this.timeoutObj = {\n            fail: null,\n            maxUntilSecondDown: null,\n            success: null\n        };\n        this.onDoubleTap = p.onDoubleTap;\n        if (p.isInstant) {\n            this.minSilenceBeforeDurationMs = 0;\n            this.minSilenceAfterMs = 0;\n        }\n        this.gestureFailed = ()=>{\n            if (this.sequenceArr.length === 0) return;\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\n            this.timeoutObj.maxUntilSecondDown && clearTimeout(this.timeoutObj.maxUntilSecondDown);\n            this.timeoutObj.success && clearTimeout(this.timeoutObj.success);\n            this.timeoutObj.fail = null;\n            this.timeoutObj.maxUntilSecondDown = null;\n            this.timeoutObj.success = null;\n            if (this.chainOut) for(let i = 0; i < this.eventQueueArr.length; i++)this.chainOut(this.eventQueueArr[i]);\n            this.eventQueueArr = [];\n            this.sequenceArr = [];\n        };\n    }\n}\n\n\nclass $68c13f25614f29c1$export$71ff2f51bf1f4062 {\n    // ---- public ----\n    chainIn(event) {\n        if (this.ignorePointerIdArr.includes(event.pointerId)) {\n            if (event.type === \"pointerup\") {\n                for(let i = 0; i < this.ignorePointerIdArr.length; i++)if (this.ignorePointerIdArr[i] === event.pointerId) {\n                    this.ignorePointerIdArr.splice(i, 1);\n                    break;\n                }\n            }\n            return null;\n        }\n        if (this.downPointerId === null) {\n            if (event.type === \"pointerdown\") this.downPointerId = event.pointerId;\n            return event;\n        } else {\n            if (event.pointerId !== this.downPointerId) {\n                if (event.type === \"pointerdown\") this.ignorePointerIdArr.push(event.pointerId);\n                return null;\n            }\n            if (event.type === \"pointerup\") this.downPointerId = null;\n            return event;\n        }\n    }\n    setChainOut(func) {\n        this.chainOut = func;\n    }\n    constructor(){\n        this.downPointerId = null;\n        this.ignorePointerIdArr = [];\n    }\n}\n\n\nclass $3c485cff20ed4548$export$649a211db9812745 {\n    continueChain(i, event) {\n        for(; i < this.chainArr.length; i++){\n            event = this.chainArr[i].chainIn(event);\n            if (event === null) return null;\n        }\n        this.chainOut && this.chainOut(event);\n        return null;\n    }\n    /**\n     * feed an event into the chain\n     */ chainIn(event) {\n        return this.continueChain(0, event);\n    }\n    /**\n     * func will be called when event has passed through the chain\n     */ setChainOut(func) {\n        this.chainOut = func;\n    }\n    // ---- public ----\n    constructor(p){\n        this.chainArr = p.chainArr;\n        for(let i = 0; i < this.chainArr.length; i++)((i)=>{\n            this.chainArr[i].setChainOut((event)=>{\n                this.continueChain(i + 1, event);\n            });\n        })(i);\n    }\n}\n\n\nconst $d9f9f4926aa80a1c$export$921068d8846a1559 = {\n    eventUsesHighResTimeStamp: // ---- browser ----\n    $604d9bbf77127967$export$4ec3bfbae69fbb50,\n    hasPointerEvents: $604d9bbf77127967$export$b7b64c480b083ae0,\n    isCssMinMaxSupported: $604d9bbf77127967$export$fe0a7220ab4eecad,\n    canShareFiles: $604d9bbf77127967$export$558f5e20caee48c2,\n    unsetEventHandler: $604d9bbf77127967$export$4fb2cccfca937a8c,\n    insertAfter: // ---- base ----\n    $fc4403c8ee6a33dc$export$c4f94c8b3850a5a9,\n    loadImage: $fc4403c8ee6a33dc$export$fe58198efe02b173,\n    css: $fc4403c8ee6a33dc$export$dbf350e5966cf602,\n    setAttributes: $fc4403c8ee6a33dc$export$74da2cba014bdc09,\n    append: $fc4403c8ee6a33dc$export$10d8903dec122b9d,\n    fitInto: $fc4403c8ee6a33dc$export$fa55905620c22535,\n    centerWithin: $fc4403c8ee6a33dc$export$76d0c1a172b67a61,\n    getDate: $fc4403c8ee6a33dc$export$aa350b96d91cd94,\n    gcd: $fc4403c8ee6a33dc$export$f81847884871263e,\n    reduce: $fc4403c8ee6a33dc$export$533b26079ad0b4b,\n    decToFraction: $fc4403c8ee6a33dc$export$8215e6b900906daa,\n    imageBlobToUrl: $fc4403c8ee6a33dc$export$5063ec57a23c4f2e,\n    dateDayDifference: $fc4403c8ee6a33dc$export$1093707c159148e8,\n    copyObj: $fc4403c8ee6a33dc$export$af0d87255f3cfd7e,\n    shareCanvas: $fc4403c8ee6a33dc$export$331c30fd60da0115,\n    handleClick: $fc4403c8ee6a33dc$export$b981489921ee18cd,\n    createSvg: $fc4403c8ee6a33dc$export$c54fe3b9ecaa84cf,\n    BbLog: $e0f57e18e675096c$export$9860cd9e09e6f8ba,\n    LocalStorage: $0ecef66681b62a8c$export$19fffca37ef3e106,\n    throwIfNull: $fc4403c8ee6a33dc$export$b813e062795b89b5,\n    nullToUndefined: $fc4403c8ee6a33dc$export$d802c22d109d9806,\n    isDark: $fc4403c8ee6a33dc$export$a79ad82046afa44e,\n    mix: // ---- math ----\n    $9414f5ea41e9cf25$export$2c9e8a9632a706b2,\n    dist: $9414f5ea41e9cf25$export$6c4a311cc157c764,\n    distSquared: $9414f5ea41e9cf25$export$499eb56409f6cbc2,\n    lenSquared: $9414f5ea41e9cf25$export$a4f99f99d3e99cfa,\n    pointsToAngleRad: $9414f5ea41e9cf25$export$627023b405ba5028,\n    pointsToAngleDeg: $9414f5ea41e9cf25$export$c03a8450eabc2532,\n    isInsideRect: $9414f5ea41e9cf25$export$151bd845d70e2099,\n    clamp: $9414f5ea41e9cf25$export$7d15b64cf5a3a4c4,\n    rotate: $9414f5ea41e9cf25$export$bb628a54ab399bc9,\n    rotateAround: $9414f5ea41e9cf25$export$95ec0760d3d00713,\n    Matrix: $1460f8c17429a8fd$export$5b12bf1653c0dd85,\n    Vec2: $2890e4902986ac94$export$ac4bca90992eed1,\n    intDxy: $9414f5ea41e9cf25$export$bbf9af158036c5e9,\n    roundEven: $9414f5ea41e9cf25$export$94cce7adf2ec2d08,\n    roundUneven: $9414f5ea41e9cf25$export$f373b6a7b0c159a,\n    round: $9414f5ea41e9cf25$export$2077e0241d6afd3c,\n    updateBounds: $9414f5ea41e9cf25$export$f4467a4f41373bc7,\n    boundsInArea: $9414f5ea41e9cf25$export$bbb91bbc54e7d9ac,\n    projectPointOnLine: // ---- line ----\n    $4e47553489a532e8$export$b4c5b177db876445,\n    PointLine: $4e47553489a532e8$export$8b36a4a83269a640,\n    BezierLine: $4e47553489a532e8$export$5379d955c16d4d43,\n    SplineInterpolator: $4e47553489a532e8$export$80967b1eb9fd6eb4,\n    quadraticSplineInput: $4e47553489a532e8$export$4551d4af86c1eb08,\n    // ---- canvas ----\n    canvas: (0, $9f64dcf89d8f9132$export$cd3d1f114b139967),\n    ctx: $13d5aa49e37e2734$export$39f92e86d1722f3a,\n    copyCanvas: $13d5aa49e37e2734$export$dd0873c0fb3ccff6,\n    testShouldPixelate: $13d5aa49e37e2734$export$1555f643cc9a976,\n    drawTransformedImageWithBounds: $13d5aa49e37e2734$export$ded2b43392504635,\n    drawTransformedImageOnCanvas: $13d5aa49e37e2734$export$425a419ef9fc761f,\n    createCheckerCanvas: $13d5aa49e37e2734$export$754559b36e94ea2f,\n    createCheckerDataUrl: $13d5aa49e37e2734$export$42af33c76b681867,\n    resizeCanvas: $13d5aa49e37e2734$export$59b33278b5b2fc8a,\n    convertToAlphaChannelCanvas: $13d5aa49e37e2734$export$5a7576952c826b4f,\n    freeCanvas: $13d5aa49e37e2734$export$2384aff49c9b73c2,\n    canvasBounds: $13d5aa49e37e2734$export$3db033c6ee0b8700,\n    HSV: // ---- color ----\n    $b68f66663c02a5d5$export$d2edaecd208aed43,\n    RGB: $b68f66663c02a5d5$export$8f9ece5a47764b93,\n    CMYK: $b68f66663c02a5d5$export$89d3f85304bf0767,\n    ColorConverter: $b68f66663c02a5d5$export$fb7efcd2e153af6e,\n    testIsWhiteBestContrast: $b68f66663c02a5d5$export$5cf396345d1238ae,\n    appendTextDiv: // ---- UI ----\n    $52ad4d7a7d6372c1$export$7868464f598ba79d,\n    clearSelection: $52ad4d7a7d6372c1$export$a3d02541b0ebf605,\n    makeUnfocusable: $52ad4d7a7d6372c1$export$6bd63bfceaafae0c,\n    el: $52ad4d7a7d6372c1$export$c3da0dad1b44eea9,\n    destroyEl: $52ad4d7a7d6372c1$export$b1da1db524e22115,\n    isInputFocused: $52ad4d7a7d6372c1$export$906dfdb7df31ccfc,\n    unfocusAnyInput: $52ad4d7a7d6372c1$export$e05240ca9e0b8bd9,\n    KeyListener: // ---- events / input ----\n    $08e838e8af75c5e2$export$f17908c5de22d32e,\n    PointerListener: $a07742141701d1f2$export$9371bd96776f4e82,\n    sameKeys: $08e838e8af75c5e2$export$e9f65b0175de4c03,\n    EventChain: $3c485cff20ed4548$export$649a211db9812745,\n    DoubleTapper: $afe05ecd8ae7f4be$export$db3963a21c01d803,\n    NFingerTapper: $ee2eb319667e1e48$export$510622b8aed00381,\n    PinchZoomer: $5ba93bbe34fd1582$export$d62358ac2d82abb3,\n    CoalescedExploder: $2df67d7abe113884$export$fe11e0afe623a677,\n    OnePointerLimiter: $68c13f25614f29c1$export$71ff2f51bf1f4062\n};\nObject.keys($d9f9f4926aa80a1c$export$921068d8846a1559); // without this, parcel build may break this object\n\n\n// generated from src/languages. \"npm run lang:build\" to update\nvar $3b474fbd2c41de06$exports = {};\n$3b474fbd2c41de06$exports = JSON.parse('{\"switch-ui-left-right\":\"Switch left/right UI\",\"toggle-show-tools\":\"Show/Hide Tools\",\"scroll\":\"Scroll\",\"donate\":\"Donate\",\"home\":\"Home\",\"modal-new-tab\":\"Open in new tab\",\"tab-edit\":\"Edit\",\"tab-file\":\"File\",\"tool-brush\":\"Brush\",\"tool-paint-bucket\":\"Paint Bucket\",\"tool-gradient\":\"Gradient\",\"tool-shape\":\"Shape\",\"tool-text\":\"Text\",\"tool-hand\":\"Hand Tool\",\"tool-zoom\":\"Zoom\",\"undo\":\"Undo\",\"redo\":\"Redo\",\"brush-pen\":\"Pen\",\"brush-blend\":\"Blend\",\"brush-sketchy\":\"Sketchy\",\"brush-pixel\":\"Pixel\",\"brush-chemy\":\"Chemy\",\"brush-smudge\":\"Smudge\",\"brush-size\":\"Size\",\"brush-blending\":\"Blending\",\"brush-toggle-pressure\":\"Toggle Pressure Sensitivity\",\"brush-pen-circle\":\"Circle\",\"brush-pen-chalk\":\"Chalk\",\"brush-pen-calligraphy\":\"Calligraphy\",\"brush-pen-square\":\"Square\",\"brush-sketchy-scale\":\"Scale\",\"brush-pixel-dither\":\"Dither\",\"brush-chemy-fill\":\"Fill\",\"brush-chemy-stroke\":\"Stroke\",\"brush-chemy-mirror-x\":\"Horizontal Symmetry\",\"brush-chemy-mirror-y\":\"Vertical Symmetry\",\"brush-chemy-gradient\":\"Gradient\",\"brush-eraser-transparent-bg\":\"Transparent Background\",\"stabilizer\":\"Stabilizer\",\"stabilizer-title\":\"Stroke Stabilizer\",\"eyedropper\":\"Eyedropper\",\"secondary-color\":\"Secondary Color\",\"manual-color-input\":\"Manual Color Input\",\"mci-hex\":\"Hex\",\"mci-copy\":\"Copy\",\"modal-ok\":\"Ok\",\"modal-cancel\":\"Cancel\",\"modal-close\":\"Close\",\"layers-active-layer\":\"Active Layer\",\"layers-layer\":\"Layer\",\"layers-copy\":\"copy\",\"layers-blending\":\"Blending\",\"layers-new\":\"New Layer\",\"layers-remove\":\"Remove Layer\",\"layers-duplicate\":\"Duplicate Layer\",\"layers-merge\":\"Merge with layer below\",\"layers-merge-all\":\"Merge all\",\"layers-rename\":\"Rename\",\"layers-active-layer-visible\":\"Active layer is visible\",\"layers-active-layer-hidden\":\"Active layer is hidden\",\"layers-visibility-toggle\":\"Layer Visibility\",\"layers-blend-normal\":\"normal\",\"layers-blend-darken\":\"darken\",\"layers-blend-multiply\":\"multiply\",\"layers-blend-color-burn\":\"color burn\",\"layers-blend-lighten\":\"lighten\",\"layers-blend-screen\":\"screen\",\"layers-blend-color-dodge\":\"color dodge\",\"layers-blend-overlay\":\"overlay\",\"layers-blend-soft-light\":\"soft light\",\"layers-blend-hard-light\":\"hard light\",\"layers-blend-difference\":\"difference\",\"layers-blend-exclusion\":\"exclusion\",\"layers-blend-hue\":\"hue\",\"layers-blend-saturation\":\"saturation\",\"layers-blend-color\":\"color\",\"layers-blend-luminosity\":\"luminosity\",\"layers-rename-title\":\"Rename Layer\",\"layers-rename-name\":\"Name\",\"layers-rename-clear\":\"Clear Name\",\"layers-rename-sketch\":\"Sketch\",\"layers-rename-colors\":\"Colors\",\"layers-rename-shading\":\"Shading\",\"layers-rename-lines\":\"Lines\",\"layers-rename-effects\":\"Effects\",\"layers-rename-foreground\":\"Foreground\",\"layers-merge-modal-title\":\"Merge/Mix Layers\",\"layers-merge-description\":\"Merges the selected layer with the one underneath. Select the mix mode:\",\"file-no-autosave\":\"No autosave, no cloud storage\",\"file-new\":\"New\",\"file-import\":\"Import\",\"file-save\":\"Save\",\"file-format\":\"File Format\",\"file-copy\":\"Copy\",\"file-copy-title\":\"Copy To Clipboard\",\"file-share\":\"Share\",\"file-storage\":\"Browser Storage\",\"file-storage-thumb-title\":\"Restores when reopening page\",\"file-storage-about\":\"About Browser Storage\",\"file-storage-cant-access\":\"Can\\'t access\",\"file-storage-empty\":\"Empty\",\"file-storage-store\":\"Store\",\"file-storage-clear\":\"Clear\",\"file-storage-storing\":\"Storing\",\"file-storage-overwrite\":\"Overwrite\",\"file-storage-min-ago\":\"{x}min ago\",\"file-storage-hours-ago\":\"{x}h ago\",\"file-storage-days-ago\":\"{x}d ago\",\"file-storage-month-ago\":\"> 1month ago\",\"file-storage-restored\":\"Restored from Browser Storage\",\"file-storage-stored\":\"Stored to Browser Storage\",\"file-storage-failed\":\"Failed to store to Browser Storage\",\"file-storage-failed-1\":\"Failed to store. Possible causes:\",\"file-storage-failed-2\":\"Out of disk space\",\"file-storage-failed-3\":\"Storage disabled in incognito tab\",\"file-storage-failed-4\":\"Browser doesn\\'t support storage\",\"file-storage-failed-clear\":\"Failed to clear.\",\"file-upload\":\"Upload\",\"cleared-layer\":\"Cleared layer\",\"filled\":\"Filled\",\"new-title\":\"New Image\",\"new-current\":\"Current\",\"new-fit\":\"Fit\",\"new-oversize\":\"Oversize\",\"new-square\":\"Square\",\"new-landscape\":\"Landscape\",\"new-portrait\":\"Portrait\",\"new-screen\":\"Screen\",\"new-video\":\"Video\",\"new-din-paper\":\"DIN Paper\",\"new-px\":\"px\",\"new-ratio\":\"Ratio\",\"upload-title\":\"Upload to Imgur\",\"upload-link-notice\":\"Anyone with the link to your uploaded image will be able to view it.\",\"upload-name\":\"Title\",\"upload-title-untitled\":\"Untitled\",\"upload-caption\":\"Caption\",\"upload-submit\":\"Upload\",\"upload-uploading\":\"Uploading...\",\"upload-success\":\"Upload Successful\",\"upload-failed\":\"Upload failed.\",\"upload-delete\":\"To delete your image from Imgur visit:\",\"cropcopy-title-copy\":\"Copy To Clipboard\",\"cropcopy-title-crop\":\"Crop\",\"cropcopy-click-hold\":\"Right-click or press hold to copy.\",\"cropcopy-btn-copy\":\"To Clipboard\",\"cropcopy-copied\":\"Copied.\",\"cropcopy-btn-crop\":\"Apply Crop\",\"crop-drag-to-crop\":\"Drag to crop\",\"filter-crop-extend\":\"Crop/Extend\",\"filter-flip\":\"Flip\",\"filter-perspective\":\"Perspective\",\"filter-resize\":\"Resize\",\"filter-rotate\":\"Rotate\",\"filter-transform\":\"Transform\",\"filter-bright-contrast\":\"Bright/Contrast\",\"filter-curves\":\"Curves\",\"filter-hue-sat\":\"Hue/Saturation\",\"filter-invert\":\"Invert\",\"filter-tilt-shift\":\"Tilt Shift\",\"filter-to-alpha\":\"To Alpha\",\"filter-triangle-blur\":\"Triangle Blur\",\"filter-unsharp-mask\":\"Unsharp Mask\",\"filter-crop-title\":\"Crop / Extend\",\"filter-crop-description\":\"Crop or extend the image.\",\"filter-crop-left\":\"Left\",\"filter-crop-right\":\"Right\",\"filter-crop-top\":\"Top\",\"filter-crop-bottom\":\"Bottom\",\"filter-crop-rule-thirds\":\"Rule of Thirds\",\"filter-crop-fill\":\"Fill\",\"filter-flip-title\":\"Flip\",\"filter-flip-description\":\"Flips layer or whole image.\",\"filter-flip-horizontal\":\"Horizontal\",\"filter-flip-vertical\":\"Vertical\",\"filter-flip-image\":\"Flip Image\",\"filter-flip-layer\":\"Flip Layer\",\"filter-perspective-title\":\"Perspective\",\"filter-perspective-description\":\"Transforms the selected layer.\",\"filter-resize-title\":\"Resize\",\"filter-resize-description\":\"Resizes the image.\",\"filter-rotate-title\":\"Rotate\",\"filter-rotate-description\":\"Rotates the image.\",\"filter-transform-empty\":\"Layer is empty.\",\"filter-transform-title\":\"Transform\",\"filter-transform-description\":\"Transforms selected layer. Hold Shift for additional behavior.\",\"filter-transform-rotation\":\"Rotation\",\"filter-transform-flip\":\"Flip\",\"filter-transform-center\":\"Center\",\"filter-transform-constrain\":\"Constrain\",\"filter-transform-snap\":\"Snap\",\"filter-transform-snap-title\":\"Snap Rotation And Position\",\"filter-bright-contrast-title\":\"Brightness / Contrast\",\"filter-bright-contrast-description\":\"Change brightness and contrast for the selected layer.\",\"filter-bright-contrast-brightness\":\"Brightness\",\"filter-bright-contrast-contrast\":\"Contrast\",\"filter-curves-title\":\"Curves\",\"filter-curves-description\":\"Apply curves on the selected layer.\",\"filter-curves-all\":\"All\",\"filter-hue-sat-title\":\"Hue / Saturation\",\"filter-hue-sat-description\":\"Change hue and saturation for the selected layer.\",\"filter-hue-sat-hue\":\"Hue\",\"filter-hue-sat-saturation\":\"Saturation\",\"filter-applied\":\"applied\",\"filter-tilt-shift-title\":\"Tilt Shift\",\"filter-tilt-shift-description\":\"Applies tilt shift on the selected layer.\",\"filter-tilt-shift-blur\":\"Blur Radius\",\"filter-tilt-shift-gradient\":\"Gradient Radius\",\"filter-to-alpha-title\":\"To Alpha\",\"filter-to-alpha-description\":\"Generates alpha channel for selected layer from:\",\"filter-to-alpha-inverted-lum\":\"Inverted Luminance\",\"filter-to-alpha-lum\":\"Luminance\",\"filter-to-alpha-replace\":\"Replace RGB\",\"filter-triangle-blur-title\":\"Triangle Blur\",\"filter-triangle-blur-description\":\"Applies triangle blur on the selected layer.\",\"filter-unsharp-mask-title\":\"Unsharp Mask\",\"filter-unsharp-mask-description\":\"Sharpens the selected layer by scaling pixels away from the average of their neighbors.\",\"filter-unsharp-mask-strength\":\"Strength\",\"filter-grid\":\"Grid\",\"filter-grid-description\":\"Draws grid on selected layer.\",\"filter-noise\":\"Noise\",\"filter-noise-description\":\"Adds noise to selected layer.\",\"filter-noise-scale\":\"Scale\",\"filter-noise-alpha\":\"Alpha\",\"filter-pattern\":\"Pattern\",\"filter-pattern-description\":\"Generates pattern on selected layer. Drag the preview for further controls.\",\"filter-distort\":\"Distort\",\"filter-distort-description\":\"Distorts the selected layer.\",\"filter-distort-phase\":\"Phase\",\"filter-distort-stepsize\":\"Step Size\",\"filter-distort-sync-xy\":\"Sync XY\",\"filter-vanish-point\":\"Vanish Point\",\"filter-vanish-point-title\":\"Vanishing Point\",\"filter-vanish-point-description\":\"Adds vanishing point to selected layer. Drag preview to move.\",\"filter-vanish-point-lines\":\"Lines\",\"import-opening\":\"Opening file...\",\"import-title\":\"Import Image\",\"import-too-large\":\"Image too large, will be downscaled.\",\"import-btn-as-layer\":\"As Layer\",\"import-btn-as-image\":\"As Image\",\"import-as-layer-title\":\"Import Image as New Layer\",\"import-as-layer-description\":\"Adjust the position of the imported image.\",\"import-as-layer-limit-reached\":\"Layer limit reached. Image will be placed on existing layer.\",\"import-as-layer-fit\":\"Fit\",\"import-flatten\":\"Flatten image\",\"import-unsupported-file\":\"Unsupported file type. See Help for supported types.\",\"import-broken-file\":\"Couldn\\'t load image. File might be corrupted.\",\"import-psd-unsupported\":\"Unsupported features. PSD had to be flattened.\",\"import-psd-limited-support\":\"PSD support is limited. Flattened will more likely look correct.\",\"import-psd-too-large\":\"Image exceeds maximum dimensions of {x} x {x} pixels. Unable to import.\",\"import-psd-size\":\"Image size\",\"hand-reset\":\"Reset\",\"hand-fit\":\"Fit\",\"bucket-tolerance\":\"Tolerance\",\"bucket-sample\":\"Sample\",\"bucket-sample-title\":\"Which layers to sample color from\",\"bucket-sample-all\":\"All\",\"bucket-sample-active\":\"Active\",\"bucket-sample-above\":\"Above\",\"bucket-grow\":\"Grow\",\"bucket-grow-title\":\"Grow filled area (in pixels)\",\"bucket-contiguous\":\"Contiguous\",\"bucket-contiguous-title\":\"Only fill connected areas\",\"gradient-linear\":\"Linear\",\"gradient-linear-mirror\":\"Linear-Mirror\",\"gradient-radial\":\"Radial\",\"shape-stroke\":\"Stroke\",\"shape-fill\":\"Fill\",\"shape-rect\":\"Rectangle\",\"shape-ellipse\":\"Ellipse\",\"shape-line\":\"Line\",\"shape-line-width\":\"Line Width\",\"shape-outwards\":\"Outwards\",\"shape-fixed\":\"Fixed 1:1\",\"text-instruction\":\"Click canvas to place text\",\"text-title\":\"Add Text\",\"text-text\":\"Text\",\"text-font\":\"Font\",\"text-placeholder\":\"Your text\",\"text-color\":\"Color\",\"text-size\":\"Size\",\"text-line-height\":\"Line Height\",\"text-letter-spacing\":\"Letter Spacing\",\"text-left\":\"Left\",\"text-center\":\"Center\",\"text-right\":\"Right\",\"text-italic\":\"Italic\",\"text-bold\":\"Bold\",\"save-reminder-title\":\"Unsaved Work\",\"save-reminder-text\":\"Image was not saved in {a} minutes{b}. Save now to prevent eventual loss.\",\"save-reminder-save-psd\":\"Save As PSD\",\"save-reminder-psd-layers\":\"PSD will remember all layers.\",\"backup-drawing\":\"You can backup your drawing.\",\"submit\":\"Submit\",\"submit-title\":\"Submit Drawing\",\"submit-prompt\":\"Submit drawing?\",\"submit-submitting\":\"Submitting\",\"embed-init-loading\":\"Loading app\",\"embed-init-waiting\":\"Waiting for image\",\"unsaved\":\"Unsaved\",\"help\":\"Help\",\"tab-settings\":\"Settings\",\"settings-language\":\"Language\",\"settings-language-reload\":\"Will update after reloading.\",\"settings-theme\":\"Theme\",\"settings-save-reminder-label\":\"Save Reminder\",\"settings-save-reminder-disabled\":\"disabled\",\"settings-save-reminder-confirm-title\":\"Turn off Save Reminder?\",\"settings-save-reminder-confirm-a\":\"There is no autosave and browser tabs don\\'t last forever. If you don\\'t periodically save you will likely lose work.\",\"settings-save-reminder-confirm-b\":\"Disable at your own risk?\",\"settings-save-reminder-confirm-disable\":\"Disable\",\"theme-dark\":\"Dark\",\"theme-light\":\"Light\",\"terms-of-service\":\"Terms of Service\",\"licenses\":\"Licenses\",\"source-code\":\"Source Code\",\"auto\":\"auto\",\"zoom-in\":\"Zoom In\",\"zoom-out\":\"Zoom Out\",\"radius\":\"Radius\",\"constrain-proportions\":\"Constrain Proportions\",\"width\":\"Width\",\"height\":\"Height\",\"opacity\":\"Opacity\",\"red\":\"Red\",\"green\":\"Green\",\"blue\":\"Blue\",\"eraser\":\"Eraser\",\"center\":\"Center\",\"layers\":\"Layers\",\"background\":\"Background\",\"scaling-algorithm\":\"Scaling Algorithm\",\"algorithm-smooth\":\"Smooth\",\"algorithm-pixelated\":\"Pixelated\",\"preview\":\"Preview\",\"angle-snap\":\"Snap\",\"angle-snap-title\":\"45\\xb0 Angle Snapping\",\"lock-alpha\":\"Lock Alpha\",\"lock-alpha-title\":\"Locks layer\\'s alpha channel\",\"reverse\":\"Reverse\",\"compare-before\":\"Before\",\"compare-after\":\"After\",\"loading\":\"Loading\",\"more\":\"More\",\"x-minutes\":\"{x}min\"}');\n\n\nconst $970d7af44d8b8038$export$33e6c23ebe2ee669 = (0, (/*@__PURE__*/$parcel$interopDefault($3b474fbd2c41de06$exports)));\nconst $970d7af44d8b8038$export$d0d68bb9ed2c643d = [\n    {\n        code: \"en\",\n        name: \"English\"\n    },\n    {\n        code: \"de\",\n        name: \"Deutsch\"\n    },\n    {\n        code: \"fr\",\n        name: \"Fran\\xe7ais\"\n    },\n    {\n        code: \"ja\",\n        name: \"\\u65E5\\u672C\\u8A9E\"\n    },\n    {\n        code: \"ko\",\n        name: \"\\uD55C\\uAD6D\\uC5B4\"\n    },\n    {\n        code: \"ru\",\n        name: \"\\u0440\\u0443\\u0441\\u0441\\u043A\\u0438\\u0439\"\n    },\n    {\n        code: \"zh-CN\",\n        name: \"\\u7B80\\u4F53\\u4E2D\\u6587\"\n    },\n    {\n        code: \"zh-TW\",\n        name: \"\\u7E41\\u9AD4\\u4E2D\\u6587\"\n    }\n];\n\n\n\n\n\n\n\nconst $970d7af44d8b8038$export$f02cbd868e2f57cf = async (code)=>{\n    if (code === \"en\") return $970d7af44d8b8038$export$33e6c23ebe2ee669;\n    else if (code === \"de\") return await (parcelRequire(\"lytfz\"));\n    else if (code === \"fr\") return await (parcelRequire(\"1JS1i\"));\n    else if (code === \"ja\") return await (parcelRequire(\"9KmPU\"));\n    else if (code === \"ko\") return await (parcelRequire(\"1Rdf4\"));\n    else if (code === \"ru\") return await (parcelRequire(\"lb7jn\"));\n    else if (code === \"zh-CN\") return await (parcelRequire(\"hpkwJ\"));\n    else if (code === \"zh-TW\") return await (parcelRequire(\"cGAWy\"));\n    throw new Error(\"unknown language code\");\n};\n // {x}min\n\n\nconst $63d0b335c576c718$export$991796128b2ca217 = \"klecks-language\";\nclass $63d0b335c576c718$var$LanguageStrings {\n    async setLanguage(langCode) {\n        if (langCode === \"en\") this.data = {\n            ...(0, $970d7af44d8b8038$export$33e6c23ebe2ee669)\n        };\n        else this.data = {\n            ...(0, $970d7af44d8b8038$export$33e6c23ebe2ee669),\n            ...await (0, $970d7af44d8b8038$export$f02cbd868e2f57cf)(langCode)\n        };\n        this.code = langCode;\n        document.documentElement.setAttribute(\"lang\", langCode);\n        this.listeners.forEach((item)=>{\n            item();\n        });\n    }\n    get(code) {\n        if (!(code in this.data)) throw new Error(\"translation code doesn't exist: \" + code);\n        return this.data[code];\n    }\n    getLanguage() {\n        return (0, $970d7af44d8b8038$export$d0d68bb9ed2c643d).find((item)=>{\n            return item.code === this.code;\n        });\n    }\n    getAutoLanguage() {\n        const autoCode = $63d0b335c576c718$export$64783e31db14f0ba(false);\n        return (0, $970d7af44d8b8038$export$d0d68bb9ed2c643d).find((item)=>{\n            return item.code === autoCode;\n        });\n    }\n    getCode() {\n        return this.code;\n    }\n    // get notified on language change\n    subscribe(subscriber) {\n        if (this.listeners.includes(subscriber)) return;\n        this.listeners.push(subscriber);\n    }\n    unsubscribe(subscriber) {\n        for(let i = 0; i < this.listeners.length; i++)if (subscriber === this.listeners[i]) {\n            this.listeners.splice(i, 1);\n            return;\n        }\n    }\n    // --- public ----\n    constructor(){\n        this.listeners = [];\n        // need to use setLanguage for a different language\n        this.data = {\n            ...(0, $970d7af44d8b8038$export$33e6c23ebe2ee669)\n        };\n        this.code = \"en\";\n    }\n}\nfunction $63d0b335c576c718$export$64783e31db14f0ba(useLocalStorage) {\n    let result = \"en\";\n    const langs = []; // from highest to lowest priority\n    const navLangs = navigator.languages ? navigator.languages : [\n        navigator.language\n    ];\n    navLangs.forEach((item)=>{\n        const split = item.split(\"-\");\n        langs.push(item);\n        if (split.length === 2) langs.push(split[0]);\n    });\n    if (useLocalStorage) try {\n        const item = localStorage.getItem($63d0b335c576c718$export$991796128b2ca217);\n        if (item) langs.unshift(item);\n    } catch (e) {\n    // likely cookies disabled in Safari\n    }\n    for(let i = 0; i < langs.length; i++){\n        const lang = langs[i];\n        const found = (0, $970d7af44d8b8038$export$d0d68bb9ed2c643d).find((item)=>{\n            return item.code.toLowerCase() === lang.toLowerCase();\n        });\n        if (found) {\n            result = found.code;\n            break;\n        }\n    }\n    return result;\n}\nconst $63d0b335c576c718$var$activeLanguageCode = $63d0b335c576c718$export$64783e31db14f0ba(true);\nconst $63d0b335c576c718$export$ea44c9eff2c31da6 = new $63d0b335c576c718$var$LanguageStrings();\nconst $63d0b335c576c718$export$ce37e184d908d785 = (code, replace)=>{\n    if (replace) {\n        let result = $63d0b335c576c718$export$ea44c9eff2c31da6.get(code);\n        const keyArr = Object.keys(replace);\n        keyArr.forEach((key)=>{\n            result = result.replace(`{${key}}`, replace[key]);\n        });\n        return result;\n    } else return $63d0b335c576c718$export$ea44c9eff2c31da6.get(code);\n};\nconst $63d0b335c576c718$export$7a2ea9f2e4d199d3 = ()=>$63d0b335c576c718$export$ea44c9eff2c31da6.setLanguage($63d0b335c576c718$var$activeLanguageCode);\n\n\nwindow.onscroll = (e)=>{\n    e.preventDefault();\n};\n\n\nvar $3850a23a79465c04$exports = {};\n\n$3850a23a79465c04$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"cancel.5edb67d5.svg\";\n\n\nvar $b9928cc2ba634150$exports = {};\n\n$b9928cc2ba634150$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"check.42e17e77.svg\";\n\n\nfunction $2016c314bff36ab9$export$d7e8d4d4450c819c(p) {\n    (0, $6b37b427615ca1fa$export$17eb8275e0c4cab8).increase();\n    let isClosed = false;\n    let ignoreBackground = !!p.ignoreBackground;\n    // need this extra layer because chrome mobile otherwise scrolls the page and then glitches as the address bar goes away\n    const rootRootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        parent: document.body,\n        css: {\n            position: \"absolute\",\n            left: \"0\",\n            top: \"0\",\n            right: \"0\",\n            bottom: \"0\",\n            overflow: \"hidden\"\n        }\n    });\n    const rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        parent: rootRootEl,\n        className: \"kl-popup\"\n    });\n    const scrollContent = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        parent: rootEl,\n        css: {\n            width: \"100%\",\n            minHeight: \"100%\",\n            // padding: '10px 0',\n            position: \"relative\",\n            display: \"flex\",\n            flexDirection: \"column\",\n            justifyContent: \"center\",\n            alignItems: \"center\"\n        }\n    });\n    const bgEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        parent: scrollContent,\n        onClick: ()=>{\n            if (ignoreBackground) return;\n            close(\"Cancel\");\n        },\n        css: {\n            position: \"absolute\",\n            left: \"0\",\n            top: \"0\",\n            zIndex: \"0\",\n            width: \"100%\",\n            height: \"100%\"\n        }\n    });\n    const titleHeight = 40;\n    const xButton = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        tagName: \"button\",\n        className: \"popup-x\",\n        content: `<img alt=\"${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"modal-close\")}\" height=\"20\" src=\"${(0, (/*@__PURE__*/$parcel$interopDefault($3850a23a79465c04$exports)))}\">`,\n        title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"modal-close\"),\n        onClick: ()=>{\n            close(\"Cancel\");\n        },\n        css: {\n            width: titleHeight + \"px\",\n            height: titleHeight + \"px\",\n            lineHeight: titleHeight + \"px\",\n            position: \"absolute\",\n            right: \"0\",\n            top: \"0\",\n            background: \"none\",\n            boxShadow: \"none\"\n        }\n    });\n    let icon = undefined;\n    if (p.type) icon = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        className: {\n            error: \"kl-popup__icon-error\",\n            ok: \"kl-popup__icon-ok\",\n            warning: \"kl-popup__icon-warning\",\n            upload: \"kl-popup__icon-upload\"\n        }[p.type]\n    });\n    const boxClasses = [\n        \"kl-popup-box\"\n    ];\n    boxClasses.push(\"kl-popup-box--sm\");\n    const boxEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        content: [\n            xButton,\n            icon,\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                content: p.message,\n                css: {\n                    marginRight: \"15px\",\n                    marginBottom: p.div ? \"10px\" : undefined\n                }\n            }),\n            p.div\n        ],\n        className: boxClasses.join(\" \"),\n        css: p.style ? p.style : undefined\n    });\n    scrollContent.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        css: {\n            flex: \"0.5\"\n        }\n    }), boxEl, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        css: {\n            flex: \"1\"\n        }\n    }));\n    const keyListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).KeyListener({\n        onDown: function(keyStr, e, comboStr) {\n            if (isClosed) return;\n            if (clickOnEnterBtn && comboStr === \"enter\" && !(0, $d9f9f4926aa80a1c$export$921068d8846a1559).isInputFocused()) {\n                e.stopPropagation();\n                setTimeout(()=>{\n                    clickOnEnterBtn && clickOnEnterBtn.click();\n                }, 10);\n            }\n            if (comboStr === \"esc\") {\n                e.stopPropagation();\n                close(\"Cancel\");\n            }\n        }\n    });\n    // prevent ctrl scroll -> zooming page\n    const wheelPrevent = (event)=>{\n        if (keyListener.isPressed(\"ctrl\")) event.preventDefault();\n    };\n    rootEl.addEventListener(\"wheel\", wheelPrevent);\n    rootEl.onclick = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).handleClick;\n    let autoFocus;\n    if (p.autoFocus) autoFocus = p.autoFocus;\n    else if (p.autoFocus === false) autoFocus = undefined;\n    else autoFocus = \"Ok\";\n    const buttonRowEl = p.buttons && p.buttons.length > 0 ? (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        parent: boxEl,\n        css: {\n            display: \"flex\",\n            flexWrap: \"wrap\",\n            justifyContent: \"flex-end\",\n            marginTop: \"12px\",\n            marginLeft: \"-8px\"\n        }\n    }) : undefined;\n    let clickOnEnterBtn;\n    const btnElArr = [];\n    if (p.buttons) p.buttons.forEach((buttonName)=>{\n        const btnClasses = [\n            \"kl-popup__btn\"\n        ];\n        if (buttonName === \"Ok\" || p.primaries && p.primaries.includes(buttonName)) btnClasses.push(\"kl-button-primary\");\n        let iconUrl;\n        let label = buttonName;\n        if (buttonName === \"Ok\") {\n            label = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"modal-ok\");\n            iconUrl = (0, (/*@__PURE__*/$parcel$interopDefault($b9928cc2ba634150$exports)));\n        }\n        if (buttonName === \"Cancel\") {\n            label = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"modal-cancel\");\n            iconUrl = (0, (/*@__PURE__*/$parcel$interopDefault($3850a23a79465c04$exports)));\n            btnClasses.push(\"kl-button-cancel\");\n        }\n        let iconImg = undefined;\n        if (iconUrl) iconImg = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"img\",\n            custom: {\n                src: iconUrl,\n                height: \"17\"\n            }\n        });\n        const btn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: buttonRowEl,\n            tagName: \"button\",\n            className: btnClasses.join(\" \"),\n            content: [\n                iconImg,\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    className: \"kl-popup__btn__text\",\n                    content: label\n                })\n            ],\n            onClick: ()=>{\n                close(buttonName);\n            }\n        });\n        btnElArr.push(btn);\n        if (autoFocus === buttonName) {\n            setTimeout(()=>{\n                btn.focus();\n                rootEl.scrollTo(0, 0);\n            }, 10);\n            setTimeout(()=>{\n                // safari needs a separate timeout\n                rootEl.scrollTo(0, 0);\n            }, 20);\n        }\n        if (buttonName === p.clickOnEnter) clickOnEnterBtn = btn;\n    });\n    function close(value) {\n        if (isClosed) return;\n        isClosed = true;\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clearSelection();\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).unfocusAnyInput();\n        rootRootEl.remove();\n        (0, $6b37b427615ca1fa$export$17eb8275e0c4cab8).decrease();\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(xButton);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(bgEl);\n        keyListener.destroy();\n        rootEl.removeEventListener(\"wheel\", wheelPrevent);\n        // (disabled) eslint-disable-next-line no-null/no-null\n        rootEl.onclick = null;\n        btnElArr.forEach((item)=>(0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(item));\n        btnElArr.splice(0, btnElArr.length);\n        if (p.callback) p.callback(value);\n    }\n    if (p.closeFunc) p.closeFunc(function() {\n        close(\"Cancel\");\n    });\n    return {\n        setIgnoreBackground: (b)=>{\n            ignoreBackground = b;\n        }\n    };\n}\n\n\n\n\n\n\n\nclass $18361e3f5d6257e8$export$185108a9b725b68 {\n    // ---- interface ----\n    close() {\n        (0, $6b37b427615ca1fa$export$17eb8275e0c4cab8).decrease();\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(this.rootEl);\n        this.rootEl.remove();\n        window.removeEventListener(\"resize\", this.updatePos);\n        this.keyListener.destroy();\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(this.xButton);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(this.bgEl);\n        this.onClose && this.onClose();\n    }\n    // ---- public ----\n    constructor(p){\n        (0, $6b37b427615ca1fa$export$17eb8275e0c4cab8).increase();\n        this.onClose = p.onClose;\n        this.parent = document.body;\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.parent,\n            className: \"g-root kl-d-modal-root\",\n            css: {\n                position: \"fixed\",\n                left: \"0\",\n                top: \"0\",\n                bottom: \"0\",\n                right: \"0\",\n                overflow: \"auto\",\n                animationName: \"consoleIn\",\n                animationDuration: \"0.3s\",\n                animationTimingFunction: \"ease-out\"\n            },\n            onClick: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).handleClick\n        });\n        //background element registering clicks\n        this.bgEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            css: {\n                position: \"absolute\",\n                left: \"0\",\n                top: \"0\",\n                bottom: \"0\",\n                right: \"0\"\n            },\n            onClick: ()=>this.close()\n        });\n        //the actual popup box\n        const popupEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            className: \"kl-d-modal\",\n            css: {\n                position: \"absolute\",\n                width: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).isCssMinMaxSupported() ? \"min(calc(100% - 40px), \" + (p.width ? p.width : 400) + \"px)\" : (p.width ? p.width : 400) + \"px\",\n                height: \"calc(100% - 40px)\",\n                borderRadius: \"10px\",\n                overflow: \"hidden\"\n            }\n        });\n        //x and y position via script. flex not powerful enough imo\n        this.updatePos = ()=>{\n            const elW = popupEl.offsetWidth;\n            const elH = popupEl.offsetHeight;\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(popupEl, {\n                left: Math.max(0, (window.innerWidth - elW) / 2) + \"px\",\n                top: Math.max(20, (window.innerHeight - elH) / 2 - elH * 0.20) + \"px\"\n            });\n        };\n        this.updatePos();\n        window.addEventListener(\"resize\", this.updatePos);\n        //title row in popup\n        const titleHeight = 40;\n        const titleEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: popupEl,\n            css: {\n                height: titleHeight + \"px\",\n                display: \"flex\",\n                justifyContent: \"space-between\",\n                alignItems: \"center\",\n                paddingLeft: titleHeight / 2 + \"px\"\n            }\n        });\n        if (p.title) titleEl.append(p.title);\n        this.xButton = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: titleEl,\n            tagName: \"button\",\n            className: \"popup-x\",\n            content: `<img alt=\"${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"modal-close\")}\" height=\"20\" src=\"${(0, (/*@__PURE__*/$parcel$interopDefault($3850a23a79465c04$exports)))}\">`,\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"modal-close\"),\n            onClick: ()=>this.close(),\n            css: {\n                width: titleHeight + \"px\",\n                height: titleHeight + \"px\",\n                lineHeight: titleHeight + \"px\",\n                background: \"none\",\n                boxShadow: \"none\"\n            },\n            custom: {\n                tabindex: \"0\"\n            }\n        });\n        const contentEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: popupEl,\n            css: {\n                height: \"calc(100% - \" + titleHeight + \"px)\"\n            }\n        });\n        if (p.content) contentEl.append(p.content);\n        this.keyListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).KeyListener({\n            onDown: (keyStr, e)=>{\n                if (keyStr === \"esc\") {\n                    e.stopPropagation();\n                    this.close();\n                }\n            }\n        });\n    }\n}\n\n\n\n\nclass $213947897b67ec3a$export$48513f6b9f8ce62d {\n    getValue() {\n        return this.check.checked;\n    }\n    setValue(b) {\n        this.check.checked = !!b;\n        if (this.doHighlight) this.element.classList.toggle(\"kl-checkbox--highlight\", this.check.checked);\n    }\n    getElement() {\n        return this.element;\n    }\n    destroy() {\n        this.check.onchange = null;\n    }\n    // --- public ---\n    constructor(params){\n        this.doHighlight = !!params.doHighlight;\n        this.element = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-checkbox\"\n        });\n        const innerEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.element,\n            tagName: \"label\",\n            className: \"kl-checkbox__inner\",\n            css: {\n                display: \"flex\"\n            }\n        });\n        this.check = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: innerEl,\n            tagName: \"input\",\n            css: {\n                margin: \"0 5px 0 0\"\n            },\n            custom: {\n                type: \"checkbox\"\n            }\n        });\n        this.check.checked = !!params.init;\n        if (this.doHighlight && this.check.checked) this.element.classList.add(\"kl-checkbox--highlight\");\n        if (!params.allowTab) this.check.tabIndex = -1;\n        if (params.title) innerEl.title = params.title;\n        const label = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: innerEl,\n            content: params.label,\n            css: {}\n        });\n        label.allowClick = true;\n        this.check.onchange = ()=>{\n            if (this.doHighlight) this.element.classList.toggle(\"kl-checkbox--highlight\", this.check.checked);\n            params.callback && params.callback(this.check.checked);\n            setTimeout(()=>{\n                this.check.blur();\n            }, 0);\n        };\n        if (params.css) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.element, params.css);\n    }\n}\n\n\n\nclass $760dd90d44275661$export$f5b8910cec6cf069 {\n    getElement() {\n        return this.rootEl;\n    }\n    getValue() {\n        return this.input.value;\n    }\n    setValue(v) {\n        this.input.value = \"\" + v;\n    }\n    destroy() {\n        this.pointerListener && this.pointerListener.destroy();\n        this.keyListener.destroy();\n    }\n    // ---- public ----\n    constructor(p){\n        this.keyListener = {\n            destroy: ()=>{}\n        };\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"label\",\n            content: p.label,\n            css: {\n                display: \"flex\",\n                alignItems: \"center\",\n                gap: \"5px\"\n            }\n        });\n        this.input = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"input\",\n            parent: this.rootEl,\n            title: p.title\n        });\n        this.input.type;\n        var _p_type;\n        this.type = (_p_type = p.type) !== null && _p_type !== void 0 ? _p_type : \"text\";\n        try {\n            this.input.type = this.type;\n        } catch (e) {\n        // ie can't deal with number\n        }\n        var _p_step;\n        const stepSize = (_p_step = p.step) !== null && _p_step !== void 0 ? _p_step : 1;\n        if (this.type === \"number\") {\n            if (p.min !== undefined) this.input.min = \"\" + p.min;\n            if (p.max !== undefined) this.input.max = \"\" + p.max;\n            if (p.step !== undefined) this.input.step = \"\" + stepSize;\n        }\n        this.input.value = \"\" + p.init;\n        let lastValidValue = this.input.value;\n        /**\n         * return true if not changed\n         */ const handleChange = ()=>{\n            const oldVal = lastValidValue;\n            let newValue = this.input.value;\n            if (p.doResetIfInvalid) {\n                let didChange = false;\n                if (newValue === \"\") {\n                    newValue = lastValidValue;\n                    didChange = true;\n                }\n                if (p.min !== undefined && parseFloat(newValue) < p.min) {\n                    newValue = \"\" + p.min;\n                    didChange = true;\n                }\n                if (p.max !== undefined && parseFloat(newValue) > p.max) {\n                    newValue = \"\" + p.max;\n                    didChange = true;\n                }\n                if (didChange) this.input.value = \"\" + newValue;\n            }\n            lastValidValue = newValue;\n            return oldVal !== newValue;\n        };\n        if (p.onChange) {\n            const onChange = p.onChange;\n            this.input.onchange = ()=>{\n                handleChange() && onChange(this.input.value);\n            };\n        }\n        if (p.css) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.input, p.css);\n        if (p.doScrollWithoutFocus && p.type === \"number\" && p.onChange) {\n            const onChange = p.onChange;\n            this.keyListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).KeyListener({});\n            this.pointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n                target: this.input,\n                onWheel: (e)=>{\n                    /*if (document.hasFocus()) { // what was the point of this?\n                        return;\n                    }*/ const fac = this.keyListener.isPressed(\"shift\") ? 4 : 1;\n                    this.input.value = \"\" + (parseFloat(this.input.value) - e.deltaY * stepSize * fac);\n                    handleChange() && onChange(this.input.value);\n                }\n            });\n        }\n    }\n}\nconst $760dd90d44275661$export$b7e3ae3d7c15e42e = function(params) {\n    const result = document.createElement(\"input\");\n    if (params.type) try {\n        result.type = params.type;\n    } catch (e) {\n    /* empty */ // ie can't deal with number\n    }\n    else result.type = \"text\";\n    if (params.min !== undefined) result.min = \"\" + params.min;\n    if (params.max !== undefined) result.max = \"\" + params.max;\n    result.value = \"\" + params.init;\n    if (params.callback) result.onchange = function() {\n        params.callback(result.value);\n    };\n    if (params.css) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(result, params.css);\n    return result;\n};\n\n\n\nclass $b1ef42bd443626ca$export$ef9b1a59e592288f {\n    setValue(val) {\n        this.selectEl.value = val === undefined ? \"\" : val;\n    }\n    getValue() {\n        return this.selectEl.value;\n    }\n    setDeltaValue(delta) {\n        let index = 0;\n        for(let i = 0; i < this.optionArr.length; i++){\n            const option = this.optionArr[i];\n            if (option.item && \"\" + option.item[0] === this.selectEl.value) {\n                index = i;\n                break;\n            }\n        }\n        index = Math.max(0, Math.min(this.optionArr.length - 1, index + delta));\n        const option = this.optionArr[index];\n        this.selectEl.value = option.item ? option.item[0] : \"\";\n        this.onChange && this.onChange(this.getValue());\n    }\n    getElement() {\n        return this.selectEl;\n    }\n    updateLabel(id, label) {\n        this.optionArr.forEach((option)=>{\n            if (option.item && option.item[0] === id && option.el) {\n                option.item[1] = label;\n                option.el.textContent = option.item[1];\n            }\n        });\n    }\n    setOptionArr(optionArr) {\n        this.optionArr = [];\n        this.selectEl.innerHTML = \"\";\n        for(let i = 0; i < optionArr.length; i++){\n            const item = optionArr[i];\n            if (!item) {\n                this.optionArr.push({\n                    item: item\n                });\n                continue;\n            }\n            const el = document.createElement(\"option\");\n            el.value = item[0];\n            el.textContent = item[1];\n            if (item[2]) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(el, item[2].css);\n            this.optionArr.push({\n                item: item,\n                el: el\n            });\n            this.selectEl.append(el);\n        }\n    }\n    destroy() {\n        this.selectEl.removeEventListener(\"change\", this.changeListener);\n    }\n    // --- public ---\n    constructor(p){\n        this.optionArr = [];\n        this.selectEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"select\",\n            title: p.title,\n            className: \"kl-select\",\n            css: {\n                cursor: \"pointer\",\n                fontSize: \"15px\",\n                padding: \"3px\"\n            }\n        });\n        if (p.css) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.selectEl, p.css);\n        const isFocusable = p.isFocusable;\n        if (!isFocusable) this.selectEl.tabIndex = -1;\n        this.setOptionArr(p.optionArr);\n        if (p.onChange) this.onChange = p.onChange;\n        this.changeListener = ()=>{\n            if (!isFocusable) this.selectEl.blur();\n            this.onChange && this.onChange(this.getValue());\n        };\n        this.selectEl.addEventListener(\"change\", this.changeListener);\n        this.selectEl.value = p.initValue !== undefined ? p.initValue : \"\";\n    }\n}\n\n\n\nclass $a14a8e8cf8cc5885$export$b6d053cded550773 {\n    update() {\n        this.rootEl.classList.toggle(\"image-toggle-active\", this.isActive);\n    }\n    // --- interface ---\n    setValue(b) {\n        this.isActive = !!b;\n        this.update();\n    }\n    getElement() {\n        return this.rootEl;\n    }\n    getValue() {\n        return this.isActive;\n    }\n    destroy() {\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(this.rootEl);\n    }\n    // --- public ---\n    constructor(p){\n        this.isActive = !!p.initValue;\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"image-toggle\",\n            title: p.title,\n            content: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                className: \"image-toggle__im\" + (p.darkInvert ? \" dark-invert\" : \"\"),\n                css: {\n                    backgroundImage: \"url('\" + p.image + \"')\"\n                }\n            }),\n            onClick: (e)=>{\n                e.preventDefault();\n                if (p.isRadio && this.isActive) return;\n                this.isActive = !this.isActive;\n                this.update();\n                p.onChange(this.isActive);\n            }\n        });\n        this.update();\n    }\n}\n\n\n\n\nclass $fa6faa989b2cc6b2$export$7cc1012a658e6ad8 {\n    // --- interface ---\n    getElement() {\n        return this.rootEl;\n    }\n    getValue() {\n        return this.optionArr[this.activeIndex].id;\n    }\n    destroy() {\n        this.optionArr.forEach((item)=>{\n            item.radioEl.destroy();\n        });\n    }\n    // --- public ---\n    constructor(p){\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"image-radio-wrapper\",\n            css: {\n                display: \"flex\"\n            }\n        });\n        this.optionArr = [];\n        const select = (index, id)=>{\n            this.activeIndex = index;\n            for(let i = 0; i < this.optionArr.length; i++)this.optionArr[i].radioEl.setValue(i === this.activeIndex);\n            p.onChange(id);\n        };\n        let initialIndex;\n        const createOption = (index, o)=>{\n            if (o.id === p.initId) initialIndex = index;\n            const radioEl = new (0, $a14a8e8cf8cc5885$export$b6d053cded550773)({\n                image: o.image,\n                title: o.title,\n                initValue: o.id === p.initId,\n                isRadio: true,\n                onChange: ()=>{\n                    select(index, o.id);\n                },\n                darkInvert: o.darkInvert\n            });\n            this.rootEl.append(radioEl.getElement());\n            return {\n                id: o.id,\n                radioEl: radioEl\n            };\n        };\n        for(let i = 0; i < p.optionArr.length; i++)this.optionArr.push(createOption(i, p.optionArr[i]));\n        if (initialIndex === undefined) throw new Error(\"initId not in optionArr\");\n        this.activeIndex = initialIndex;\n    }\n}\n\n\n\n\nvar $cd94405b237f3b25$exports = {};\n\n$cd94405b237f3b25$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"brush-pressure.f4437531.svg\";\n\n\n\nclass $8d99bd5fadaac7f9$export$2358c75ad3c15b2d {\n    update() {\n        this.el.classList.toggle(\"kl-box-toggle--active\", this.value);\n    }\n    getValue() {\n        return this.value;\n    }\n    setValue(b) {\n        this.value = !!b;\n        this.update();\n    }\n    getElement() {\n        return this.el;\n    }\n    destroy() {\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(this.el);\n    }\n    // --- public ---\n    constructor(p){\n        this.value = !!p.init;\n        this.el = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: p.label,\n            title: p.title,\n            className: typeof p.label === \"string\" ? \"kl-box-toggle\" : \"kl-box-toggle kl-box-toggle--custom-el\",\n            onClick: ()=>{\n                this.value = !this.value;\n                this.update();\n                p.onChange(this.value);\n            },\n            css: {\n                cursor: \"pointer\"\n            }\n        });\n        if (typeof p.label !== \"string\") (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(p.label, {\n            display: \"block\",\n            pointerEvents: \"none\"\n        });\n        this.update();\n    }\n}\n\n\nconst $218f70778c2bf652$export$9da2e8821e6cbb57 = function(isChecked, changeCallback) {\n    const toggleEl = new (0, $8d99bd5fadaac7f9$export$2358c75ad3c15b2d)({\n        label: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"dark-invert\",\n            css: {\n                width: \"17px\",\n                height: \"17px\",\n                backgroundImage: 'url(\"' + (0, (/*@__PURE__*/$parcel$interopDefault($cd94405b237f3b25$exports))) + '\")',\n                backgroundSize: \"contain\",\n                backgroundRepeat: \"no-repeat\",\n                margin: \"1px\",\n                borderRadius: \"3px\"\n            }\n        }),\n        title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-toggle-pressure\"),\n        init: isChecked,\n        onChange: (b)=>{\n            changeCallback(b);\n        }\n    });\n    return toggleEl.getElement();\n};\n\n\n\n/**\n * To make sliders more fine-grained. The falloff when moving cursor away from cursor.\n * Returns the factor [0,1]\n *  0 -> infinite movement required for change of 1\n *  1 -> 1px movement for change of 1\n *\n * @param deltaY vertical distance from pointerdown\n * @param isRightButton\n */ function $6e485eb0c82960d0$export$f8e41e222e32615d(deltaY, isRightButton) {\n    let result = Math.min(10, 1 + Math.pow(Math.floor(deltaY / 50), 2));\n    if (isRightButton) result *= 2;\n    return 1 / result;\n}\n\n\n\n\n\nclass $31b6ab403d8e5713$export$db3d4fde05db9a5e {\n    emit() {\n        if (this.lastValue !== Number(this.input.value)) {\n            this.onChange(Number(this.input.value));\n            this.lastValue = Number(this.input.value);\n        }\n    }\n    privateOnClose() {\n        if (this.isClosed) return;\n        this.isClosed = true;\n        this.emit();\n        this.onClose();\n        setTimeout(()=>{\n            // because iPad keyboard changes the scroll position\n            this.scrollBefore && window.scrollTo(this.scrollBefore.x, this.scrollBefore.y);\n            this.scrollBefore = undefined;\n        });\n    }\n    getElement() {\n        return this.input;\n    }\n    setIsEnabled(b) {\n        this.isEnabled = !!b;\n    }\n    focus() {\n        this.input.focus();\n        this.input.select();\n    }\n    destroy() {\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(this.input);\n    }\n    // --- public ---\n    constructor(value, min, max, rect, onChange, onClose, roundDigits){\n        this.onChange = onChange;\n        this.onClose = onClose;\n        this.isEnabled = true;\n        this.isClosed = false;\n        this.input = (0, $760dd90d44275661$export$b7e3ae3d7c15e42e)({\n            type: \"number\",\n            init: value,\n            min: min,\n            max: max,\n            callback: (val)=>{\n                this.emit();\n            }\n        });\n        if (roundDigits !== 0) this.input.setAttribute(\"step\", \"any\");\n        this.input.onblur = ()=>{\n            this.privateOnClose();\n        };\n        this.input.addEventListener(\"keyup\", (e)=>{\n            if ([\n                \"Enter\",\n                \"Escape\"\n            ].includes(e.key)) this.privateOnClose();\n            else this.emit();\n        });\n        this.input.addEventListener(\"wheel\", ()=>this.emit());\n        this.scrollBefore = {\n            x: window.scrollX,\n            y: window.scrollY\n        };\n        let currentValue;\n        if (roundDigits || roundDigits === 0) currentValue = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).round(value, roundDigits);\n        else currentValue = value;\n        this.lastValue = currentValue;\n        this.input.value = \"\" + currentValue;\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.input, {\n            width: rect.width + \"px\",\n            height: rect.height + \"px\"\n        });\n    }\n}\n\n\nclass $cd73d123a4560ac3$export$a1855b925e534de7 {\n    valueToSliderValue(value) {\n        if (this.useSpline && this.splineInterpolator) return this.splineInterpolator.findX(value, Math.floor(this.resolution)) || 0;\n        return (value - this.min) / (this.max - this.min);\n    }\n    sliderValueToValue(sliderValue) {\n        let result = this.min + sliderValue * (this.max - this.min);\n        if (this.useSpline && this.splineInterpolator) result = this.splineInterpolator.interpolate(sliderValue) || 0;\n        return result;\n    }\n    updateLabel() {\n        let displayValue = this.valueToDisplayValue(this.value);\n        displayValue = this.formatFunc ? this.formatFunc(displayValue) : Math.round(displayValue);\n        displayValue = displayValue.toLocaleString((0, $63d0b335c576c718$export$ea44c9eff2c31da6).getCode());\n        const unit = this.unit !== undefined ? this.unit : \"\";\n        this.textEl.innerHTML = this.label + '&nbsp;&nbsp;<span style=\"font-weight:bold\">' + displayValue + unit + \"</span>\";\n        const sliderValue = this.valueToSliderValue(this.value);\n        this.control.style.width = sliderValue * this.elementWidth + \"px\";\n    }\n    emit(isFinal) {\n        if (!isFinal && this.isChangeOnFinal) return;\n        if (isFinal || !this.eventResMs) {\n            this.onChange(this.value);\n            if (this.emitInterval) {\n                clearInterval(this.emitInterval);\n                this.emitInterval = undefined;\n            }\n            return;\n        }\n        if (this.emitInterval) this.emitValue = this.value;\n        else {\n            this.onChange(this.value);\n            this.emitInterval = setInterval(()=>{\n                if (this.emitValue === undefined) {\n                    clearInterval(this.emitInterval);\n                    this.emitInterval = undefined;\n                } else {\n                    this.onChange(this.emitValue);\n                    this.emitValue = undefined;\n                }\n            }, this.eventResMs);\n        }\n    }\n    updateEnable() {\n        this.sliderWrapperEl.classList.toggle(\"slider-wrapper--disabled\", !this.isEnabled);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.sliderWrapperEl, {\n            opacity: this.isEnabled ? \"\" : \"0.5\",\n            pointerEvents: this.isEnabled ? \"\" : \"none\"\n        });\n        if (this.manualInput) this.manualInput.setIsEnabled(this.isEnabled);\n    }\n    showManualInput() {\n        this.manualInput = new (0, $31b6ab403d8e5713$export$db3d4fde05db9a5e)(this.valueToDisplayValue(this.value), this.valueToDisplayValue(this.min), this.valueToDisplayValue(this.max), this.sliderWrapperEl.getBoundingClientRect(), (val)=>{\n            val = this.displayValueToValue(val);\n            this.setValue((0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(val, this.min, this.max));\n            this.onChange(this.value);\n        }, ()=>{\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.sliderWrapperEl, {\n                display: \"\"\n            });\n            if (this.manualInput) {\n                this.manualInput.getElement().remove();\n                this.manualInput.destroy();\n            }\n            this.manualInput = undefined;\n        }, this.manualInputRoundDigits && this.manualInputRoundDigits > 0 ? this.manualInputRoundDigits : 0);\n        this.manualInput.setIsEnabled(this.isEnabled);\n        this.rootEl.append(this.manualInput.getElement());\n        setTimeout(()=>{\n            this.manualInput && this.manualInput.focus();\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.sliderWrapperEl, {\n            display: \"none\"\n        });\n    }\n    changeSliderValue(f) {\n        if (!this.isEnabled) return;\n        let sliderValue = this.valueToSliderValue(this.value);\n        sliderValue = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(sliderValue + f, 0, 1);\n        this.value = this.sliderValueToValue(sliderValue);\n        this.updateLabel();\n        this.onChange(this.value);\n    }\n    setValue(v) {\n        this.value = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(v, this.min, this.max);\n        this.updateLabel();\n    }\n    getValue() {\n        return this.value;\n    }\n    update(config) {\n        this.min = config.min;\n        this.max = config.max;\n        this.useSpline = !!config.curve;\n        if (this.useSpline) {\n            if (!config.curve) throw new Error(\"curve needs to be set if useSpline true\");\n            const curveArr = config.curve === \"quadratic\" ? (0, $d9f9f4926aa80a1c$export$921068d8846a1559).quadraticSplineInput(this.min, this.max, 0.1) : config.curve;\n            this.splineInterpolator = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).SplineInterpolator(curveArr);\n        } else this.splineInterpolator = undefined;\n        this.setIsEnabled(!config.isDisabled);\n    }\n    setIsEnabled(e) {\n        this.isEnabled = !!e;\n        this.updateEnable();\n    }\n    destroy() {\n        clearTimeout(this.pointerListenerTimeout);\n        this.pointerListener && this.pointerListener.destroy();\n        if (this.manualInput) this.manualInput.destroy();\n        if (this.emitInterval) clearInterval(this.emitInterval);\n    }\n    getElement() {\n        return this.rootEl;\n    }\n    // --- public ---\n    constructor(p){\n        this.isEnabled = p.isEnabled !== false;\n        this.manualInputRoundDigits = p.manualInputRoundDigits;\n        this.useSpline = !!p.curve;\n        if (!p.label) throw new Error(\"KlSlider missing params\");\n        if (p.min != 0 && p.max != 0 && p.value != 0) {\n            if (!p.min || !p.max || !p.value) throw new Error(\"KlSlider broken params\");\n        }\n        if (p.min >= p.max) throw new Error(\"KlSlider broken params\");\n        this.min = p.min;\n        this.max = p.max;\n        this.value = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(p.value, this.min, this.max);\n        this.elementWidth = p.width;\n        this.elementHeight = p.height;\n        this.resolution = p.resolution ? p.resolution : this.elementWidth * 2;\n        this.onChange = p.onChange ? p.onChange : ()=>{};\n        if (!p.toValue !== !p.toDisplayValue) throw new Error(\"both or neither have to be set, toValue and toDisplayValue\");\n        this.displayValueToValue = p.toValue ? p.toValue : (displayValue)=>displayValue;\n        this.valueToDisplayValue = p.toDisplayValue ? p.toDisplayValue : (value)=>value;\n        this.isChangeOnFinal = !!p.isChangeOnFinal;\n        this.formatFunc = p.formatFunc;\n        this.eventResMs = p.eventResMs;\n        this.unit = p.unit;\n        if (this.useSpline) {\n            if (!p.curve) throw new Error(\"curve needs to be set if useSpline true\");\n            const curveArr = p.curve === \"quadratic\" ? (0, $d9f9f4926aa80a1c$export$921068d8846a1559).quadraticSplineInput(this.min, this.max, 0.1) : p.curve;\n            this.splineInterpolator = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).SplineInterpolator(curveArr);\n        }\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                display: \"flex\"\n            }\n        });\n        this.sliderWrapperEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            className: \"slider-wrapper\",\n            css: {\n                overflow: \"hidden\",\n                position: \"relative\",\n                width: this.elementWidth + \"px\",\n                height: this.elementHeight + \"px\",\n                userSelect: \"none\"\n            }\n        });\n        this.rootEl.oncontextmenu = function() {\n            return false;\n        };\n        this.label = p.label;\n        const labelFontSize = this.elementHeight - 14;\n        this.textEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: this.label,\n            css: {\n                position: \"absolute\",\n                display: \"flex\",\n                alignItems: \"center\",\n                marginLeft: \"7px\",\n                height: \"100%\",\n                fontSize: labelFontSize + \"px\",\n                pointerEvents: \"none\"\n            }\n        });\n        this.control = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"slider-inner\",\n            css: {\n                position: \"absolute\",\n                left: \"0\",\n                top: \"0\",\n                width: this.valueToSliderValue(this.value) * this.elementWidth + \"px\",\n                height: this.elementHeight + \"px\"\n            }\n        });\n        const controlInner = document.createElement(\"div\");\n        this.sliderWrapperEl.append(this.control, this.textEl);\n        this.control.append(controlInner);\n        this.updateEnable();\n        const doubleTapper = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).DoubleTapper({\n            onDoubleTap: ()=>{\n                this.showManualInput();\n            }\n        });\n        doubleTapper.setAllowedButtonArr([\n            \"left\",\n            \"right\"\n        ]);\n        const eventChain = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).EventChain({\n            chainArr: [\n                doubleTapper\n            ]\n        });\n        let virtualVal;\n        const onPointer = (event)=>{\n            event.eventPreventDefault();\n            if (!this.isEnabled) return;\n            if (event.type === \"pointerdown\") {\n                // unfocus manual slider input\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).unfocusAnyInput();\n                this.sliderWrapperEl.className = \"slider-wrapper slider-wrapper--active\";\n                if (event.button === \"left\") {\n                    let sliderValue = event.relX / this.elementWidth;\n                    sliderValue = Math.max(0, Math.min(1, sliderValue));\n                    this.value = this.sliderValueToValue(sliderValue);\n                    this.updateLabel();\n                    this.emit(false);\n                }\n                virtualVal = this.valueToSliderValue(this.value);\n            }\n            if (event.type === \"pointermove\" && [\n                \"left\",\n                \"right\"\n            ].includes(event.button || \"\")) {\n                let deltaX = event.dX;\n                const deltaY = Math.abs(event.pageY - (event.downPageY || 0));\n                const factor = (0, $6e485eb0c82960d0$export$f8e41e222e32615d)(deltaY, event.button === \"right\");\n                deltaX *= factor;\n                deltaX /= this.elementWidth;\n                virtualVal += deltaX;\n                const sliderValue = Math.max(0, Math.min(1, virtualVal));\n                this.value = this.sliderValueToValue(sliderValue);\n                this.updateLabel();\n                this.emit(false);\n            }\n            if (event.type === \"pointerup\") {\n                this.sliderWrapperEl.className = \"slider-wrapper\";\n                this.emit(true);\n            }\n        };\n        this.pointerListenerTimeout = setTimeout(()=>{\n            this.pointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n                target: this.sliderWrapperEl,\n                fixScribble: true,\n                onPointer: (e)=>{\n                    onPointer(e);\n                    eventChain.chainIn(e);\n                },\n                onWheel: (event)=>{\n                    let sliderValue = this.valueToSliderValue(this.value);\n                    sliderValue = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(sliderValue - event.deltaY / 40, 0, 1);\n                    this.value = this.sliderValueToValue(sliderValue);\n                    this.updateLabel();\n                    this.onChange(this.value);\n                }\n            });\n            this.updateLabel();\n        }, 1);\n    }\n}\n\n\n\n\n\n\n\nvar $832ede4dddff27fa$exports = {};\n\n$832ede4dddff27fa$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"copy.4adadd0c.svg\";\n\n\n\n\nfunction $934e5f47c3374e21$var$decomposeElString(el) {\n    if (el === \"\") return {};\n    let split;\n    let tagName;\n    const classes = [];\n    split = el.split(\".\");\n    if (split.length === 1) {\n        split = split[0].split(\",\");\n        tagName = split.shift();\n    } else {\n        tagName = split.shift();\n        split.forEach((item, index)=>{\n            const isLast = index === split.length - 1;\n            if (isLast) {\n                split = item.split(\",\");\n                const last = split.shift();\n                if (last !== undefined) classes.push(last);\n            } else classes.push(item);\n        });\n    }\n    const result = {};\n    if (tagName !== \"\") result.tagName = tagName;\n    if (classes.length > 0) result.classes = classes;\n    if (split.length > 0) result.styles = split;\n    return result;\n}\nfunction $934e5f47c3374e21$var$applyStyleNames(el, styleNames) {\n    const style = {};\n    const operations = {\n        c: (params)=>{\n            style.color = params[0];\n        },\n        bg: (params)=>{\n            style.background = params[0];\n        },\n        p: (params)=>{\n            style.padding = params[0] + \"px\";\n        },\n        py: (params)=>{\n            style.paddingTop = params[0] + \"px\";\n            style.paddingBottom = params[0] + \"px\";\n        },\n        pt: (params)=>{\n            style.paddingTop = params[0] + \"px\";\n        },\n        pr: (params)=>{\n            style.paddingRight = params[0] + \"px\";\n        },\n        pb: (params)=>{\n            style.paddingBottom = params[0] + \"px\";\n        },\n        pl: (params)=>{\n            style.paddingLeft = params[0] + \"px\";\n        },\n        mt: (params)=>{\n            style.marginTop = params[0] + \"px\";\n        },\n        mr: (params)=>{\n            style.marginRight = params[0] + \"px\";\n        },\n        mb: (params)=>{\n            style.marginBottom = params[0] + \"px\";\n        },\n        ml: (params)=>{\n            style.marginLeft = params[0] + \"px\";\n        },\n        // flex\n        flex: ()=>{\n            style.display = \"flex\";\n        },\n        \"flexCol\": ()=>{\n            style.flexDirection = \"column\";\n        },\n        \"flexWrap\": ()=>{\n            style.flexWrap = \"wrap\";\n        },\n        gap: (params)=>{\n            style.gap = params.map((item)=>item + \"px\").join(\" \");\n        },\n        grow: ()=>{\n            style.flexGrow = \"1\";\n        },\n        justify: (params)=>{\n            style.justifyContent = params[0];\n        },\n        items: (params)=>{\n            style.alignItems = params[0];\n        },\n        hidden: ()=>{\n            style.display = \"none\";\n        },\n        nowrap: ()=>{\n            style.whiteSpace = \"nowrap\";\n        },\n        abs: (params)=>{\n            style.position = \"absolute\";\n            style.left = params[0] + \"px\";\n            style.top = params[1] + \"px\";\n        },\n        w: (params)=>{\n            style.width = params[0] === \"full\" ? \"100%\" : params[0] + \"px\";\n        },\n        h: (params)=>{\n            style.height = params[0] === \"full\" ? \"100%\" : params[0] + \"px\";\n        },\n        minh: (params)=>{\n            style.minHeight = params[0] + \"px\";\n        },\n        z: (params)=>{\n            style.zIndex = params[0];\n        },\n        overflow: (params)=>{\n            style.overflow = params[0];\n        },\n        pos: (params)=>{\n            style.position = params[0];\n        },\n        left: (params)=>{\n            style.left = params[0] === \"full\" ? \"100%\" : params[0] + \"px\";\n        },\n        top: (params)=>{\n            style.top = params[0] === \"full\" ? \"100%\" : params[0] + \"px\";\n        },\n        right: (params)=>{\n            style.right = params[0] === \"full\" ? \"100%\" : params[0] + \"px\";\n        },\n        bottom: (params)=>{\n            style.bottom = params[0] === \"full\" ? \"100%\" : params[0] + \"px\";\n        },\n        size: (params)=>{\n            style.fontSize = params[0] + \"px\";\n        },\n        pointer: (params)=>{\n            style.pointerEvents = params[0];\n        }\n    };\n    styleNames.forEach((item)=>{\n        const params = item.split(\"-\");\n        const operation = params.shift();\n        operations[operation](params);\n    });\n    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(el, style);\n}\nfunction $934e5f47c3374e21$export$db3b6bfb95261072(element, inner) {\n    if (element === undefined) return document.createElement(\"div\");\n    if (typeof element !== \"string\") {\n        if (!(element instanceof HTMLElement)) element = (0, $52ad4d7a7d6372c1$export$c3da0dad1b44eea9)(element);\n        if (inner) {\n            if (typeof inner === \"string\") element.innerHTML = inner;\n            else element.append(...inner);\n        }\n        return element;\n    }\n    const decomp = $934e5f47c3374e21$var$decomposeElString(element);\n    var _decomp_tagName;\n    const result = document.createElement((_decomp_tagName = decomp.tagName) !== null && _decomp_tagName !== void 0 ? _decomp_tagName : \"div\");\n    decomp.classes && result.classList.add(...decomp.classes);\n    decomp.styles && $934e5f47c3374e21$var$applyStyleNames(result, decomp.styles);\n    if (inner) {\n        if (typeof inner === \"string\") result.innerHTML = inner;\n        else result.append(...inner);\n    }\n    return result;\n}\n\n\n\nvar $brs90 = parcelRequire(\"brs90\");\n\nvar $7YdyD = parcelRequire(\"7YdyD\");\n\nvar $42Upt = parcelRequire(\"42Upt\");\nfunction $259a10c9e59c769e$var$insertWithoutScoping(cache, serialized) {\n    if (cache.inserted[serialized.name] === undefined) return cache.insert(\"\", serialized, cache.sheet, true);\n}\nfunction $259a10c9e59c769e$var$merge(registered, css, className) {\n    var registeredStyles = [];\n    var rawClassName = (0, $42Upt.getRegisteredStyles)(registered, registeredStyles, className);\n    if (registeredStyles.length < 2) return className;\n    return rawClassName + css(registeredStyles);\n}\nvar $259a10c9e59c769e$export$2e2bcd8739ae039 = function createEmotion(options) {\n    var cache = (0, $brs90.default)(options); // $FlowFixMe\n    cache.sheet.speedy = function(value) {\n        this.isSpeedy = value;\n    };\n    cache.compat = true;\n    var css = function css() {\n        for(var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++)args[_key] = arguments[_key];\n        var serialized = (0, $7YdyD.serializeStyles)(args, cache.registered, undefined);\n        (0, $42Upt.insertStyles)(cache, serialized, false);\n        return cache.key + \"-\" + serialized.name;\n    };\n    var keyframes = function keyframes() {\n        for(var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++)args[_key2] = arguments[_key2];\n        var serialized = (0, $7YdyD.serializeStyles)(args, cache.registered);\n        var animation = \"animation-\" + serialized.name;\n        $259a10c9e59c769e$var$insertWithoutScoping(cache, {\n            name: serialized.name,\n            styles: \"@keyframes \" + animation + \"{\" + serialized.styles + \"}\"\n        });\n        return animation;\n    };\n    var injectGlobal = function injectGlobal() {\n        for(var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++)args[_key3] = arguments[_key3];\n        var serialized = (0, $7YdyD.serializeStyles)(args, cache.registered);\n        $259a10c9e59c769e$var$insertWithoutScoping(cache, serialized);\n    };\n    var cx = function cx() {\n        for(var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++)args[_key4] = arguments[_key4];\n        return $259a10c9e59c769e$var$merge(cache.registered, css, $259a10c9e59c769e$var$classnames(args));\n    };\n    return {\n        css: css,\n        cx: cx,\n        injectGlobal: injectGlobal,\n        keyframes: keyframes,\n        hydrate: function hydrate(ids) {\n            ids.forEach(function(key) {\n                cache.inserted[key] = true;\n            });\n        },\n        flush: function flush() {\n            cache.registered = {};\n            cache.inserted = {};\n            cache.sheet.flush();\n        },\n        // $FlowFixMe\n        sheet: cache.sheet,\n        cache: cache,\n        getRegisteredStyles: (0, $42Upt.getRegisteredStyles).bind(null, cache.registered),\n        merge: $259a10c9e59c769e$var$merge.bind(null, cache.registered, css)\n    };\n};\nvar $259a10c9e59c769e$var$classnames = function classnames(args) {\n    var cls = \"\";\n    for(var i = 0; i < args.length; i++){\n        var arg = args[i];\n        if (arg == null) continue;\n        var toAdd = void 0;\n        switch(typeof arg){\n            case \"boolean\":\n                break;\n            case \"object\":\n                if (Array.isArray(arg)) toAdd = classnames(arg);\n                else {\n                    toAdd = \"\";\n                    for(var k in arg)if (arg[k] && k) {\n                        toAdd && (toAdd += \" \");\n                        toAdd += k;\n                    }\n                }\n                break;\n            default:\n                toAdd = arg;\n        }\n        if (toAdd) {\n            cls && (cls += \" \");\n            cls += toAdd;\n        }\n    }\n    return cls;\n};\n\n\nparcelRequire(\"brs90\");\nparcelRequire(\"7YdyD\");\nparcelRequire(\"42Upt\");\nvar $c072f29bb0ad2433$var$_createEmotion = (0, $259a10c9e59c769e$export$2e2bcd8739ae039)({\n    key: \"css\"\n}), $c072f29bb0ad2433$export$4909b86c8034bf73 = $c072f29bb0ad2433$var$_createEmotion.flush, $c072f29bb0ad2433$export$fa8d919ba61d84db = $c072f29bb0ad2433$var$_createEmotion.hydrate, $c072f29bb0ad2433$export$a274e22fb40f762e = $c072f29bb0ad2433$var$_createEmotion.cx, $c072f29bb0ad2433$export$4950aa0f605343fb = $c072f29bb0ad2433$var$_createEmotion.merge, $c072f29bb0ad2433$export$95d99596f328fd52 = $c072f29bb0ad2433$var$_createEmotion.getRegisteredStyles, $c072f29bb0ad2433$export$efb9f5caaa2ca0c7 = $c072f29bb0ad2433$var$_createEmotion.injectGlobal, $c072f29bb0ad2433$export$d25ddfdf17c3ad3e = $c072f29bb0ad2433$var$_createEmotion.keyframes, $c072f29bb0ad2433$export$dbf350e5966cf602 = $c072f29bb0ad2433$var$_createEmotion.css, $c072f29bb0ad2433$export$995990c5c04c46f0 = $c072f29bb0ad2433$var$_createEmotion.sheet, $c072f29bb0ad2433$export$69a3209f1a06c04d = $c072f29bb0ad2433$var$_createEmotion.cache;\n\n\nclass $49ce344532144fcf$export$cc42e119007cb939 {\n    // ---- public ----\n    constructor(p){\n        let lastValidRgb = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).RGB(p.color.r, p.color.g, p.color.b);\n        const previewEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                width: \"20px\",\n                height: \"20px\",\n                marginBottom: \"10px\",\n                boxShadow: \"inset 0 0 0 1px #fff, 0 0 0 1px #000\",\n                background: \"#\" + (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toHexString(lastValidRgb)\n            }\n        });\n        // --- Hex ---\n        const hexLabel = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"mci-hex\")\n        });\n        const hexInput = (0, $760dd90d44275661$export$b7e3ae3d7c15e42e)({\n            init: \"#\" + (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toHexString(lastValidRgb),\n            css: {\n                width: \"80px\"\n            },\n            callback: function() {\n                let rgbObj = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.hexToRGB(hexInput.value);\n                if (!rgbObj) {\n                    rgbObj = lastValidRgb;\n                    hexInput.value = \"#\" + (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toHexString(lastValidRgb);\n                } else lastValidRgb = rgbObj;\n                previewEl.style.background = \"#\" + (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toHexString(rgbObj);\n                for(let i = 0; i < rgbArr.length; i++)rgbArr[i].update();\n            }\n        });\n        const copyButton = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"button\",\n            content: '<img src=\"' + (0, (/*@__PURE__*/$parcel$interopDefault($832ede4dddff27fa$exports))) + '\" height=\"20\" alt=\"\"/>',\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"mci-copy\"),\n            onClick: function() {\n                hexInput.select();\n                navigator.clipboard.writeText(hexInput.value).then().catch();\n            }\n        });\n        const hexRowEl = (0, $934e5f47c3374e21$export$db3b6bfb95261072)({\n            css: {\n                display: \"flex\",\n                alignItems: \"center\",\n                marginBottom: \"15px\",\n                flexWrap: \"wrap\",\n                gap: \"5px 10px\",\n                maxWidth: \"250px\"\n            }\n        }, [\n            hexLabel,\n            (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\",flex,items-center,gap-10\", [\n                hexInput,\n                copyButton\n            ])\n        ]);\n        setTimeout(function() {\n            hexInput.focus();\n            hexInput.select();\n        }, 0);\n        // --- R G B ---\n        function createRgbInputRow(labelStr, attributeStr) {\n            const inputEl = (0, $760dd90d44275661$export$b7e3ae3d7c15e42e)({\n                init: lastValidRgb[attributeStr],\n                min: 0,\n                max: 255,\n                type: \"number\",\n                css: {\n                    width: \"80px\"\n                },\n                callback: function() {\n                    if (inputEl.value === \"\" || parseFloat(inputEl.value) < 0 || parseFloat(inputEl.value) > 255) {\n                        result.update();\n                        return;\n                    }\n                    inputEl.value = \"\" + Math.round(parseFloat(inputEl.value));\n                    lastValidRgb[attributeStr] = Number(inputEl.value);\n                    previewEl.style.background = \"#\" + (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toHexString(lastValidRgb);\n                    hexInput.value = \"#\" + (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toHexString(lastValidRgb);\n                }\n            });\n            const rowEl = (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\"tr\", [\n                (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\"td,pr-10\", labelStr),\n                (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\"td\", [\n                    inputEl\n                ])\n            ]);\n            const result = {\n                update: ()=>{\n                    inputEl.value = \"\" + lastValidRgb[attributeStr];\n                },\n                destroy: ()=>{\n                    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).unsetEventHandler(inputEl, \"onchange\");\n                },\n                element: rowEl\n            };\n            return result;\n        }\n        const rgbArr = [\n            createRgbInputRow((0, $63d0b335c576c718$export$ce37e184d908d785)(\"red\"), \"r\"),\n            createRgbInputRow((0, $63d0b335c576c718$export$ce37e184d908d785)(\"green\"), \"g\"),\n            createRgbInputRow((0, $63d0b335c576c718$export$ce37e184d908d785)(\"blue\"), \"b\")\n        ];\n        const tableCss = (0, $c072f29bb0ad2433$export$dbf350e5966cf602)({\n            borderCollapse: \"collapse\",\n            \"td\": {\n                paddingBottom: \"5px\"\n            }\n        });\n        const rootEl = (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\"\", [\n            previewEl,\n            hexRowEl,\n            (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\"table.\" + tableCss, [\n                (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\"tbody\", rgbArr.map((item)=>item.element))\n            ])\n        ]);\n        (0, $2016c314bff36ab9$export$d7e8d4d4450c819c)({\n            target: document.body,\n            message: `<b>${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"manual-color-input\")}</b>`,\n            div: rootEl,\n            autoFocus: false,\n            clickOnEnter: \"Ok\",\n            buttons: [\n                \"Ok\",\n                \"Cancel\"\n            ],\n            callback: function(resultStr) {\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(copyButton);\n                rgbArr.forEach((item)=>item.destroy());\n                rgbArr.splice(0, rgbArr.length);\n                p.onClose(resultStr === \"Ok\" ? (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.hexToRGB(hexInput.value) : undefined);\n            }\n        });\n    }\n}\n\n\n\n\n\nvar $1675a096da5c857d$exports = {};\n\n$1675a096da5c857d$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"tool-picker.d0e69c3a.svg\";\n\n\n\n\nconst $74a507c74cfe9692$var$LS_THEME_KEY = \"klecks-theme\";\nclass $74a507c74cfe9692$var$Theme {\n    updateTheme() {\n        const oldTheme = this.theme;\n        this.theme = this.storedTheme || this.mediaQueryTheme;\n        if (this.theme === oldTheme) return;\n        document.body.classList.toggle(\"kl-theme-dark\", this.theme === \"dark\");\n        this.listeners.forEach((item)=>item());\n    }\n    readLocalStorage() {\n        let result = localStorage.getItem($74a507c74cfe9692$var$LS_THEME_KEY);\n        if (!result || typeof result === \"string\" && ![\n            \"dark\",\n            \"light\"\n        ].includes(result)) {\n            result = undefined;\n            localStorage.removeItem($74a507c74cfe9692$var$LS_THEME_KEY); // reset because invalid\n        }\n        return result;\n    }\n    isDark() {\n        return this.theme === \"dark\";\n    }\n    addIsDarkListener(func) {\n        if (this.listeners.includes(func)) return;\n        this.listeners.push(func);\n    }\n    removeIsDarkListener(func) {\n        for(let i = 0; i < this.listeners.length; i++)if (this.listeners[i] === func) {\n            this.listeners.splice(i, 1);\n            return;\n        }\n    }\n    getMediaQueryTheme() {\n        return this.mediaQueryTheme;\n    }\n    getStoredTheme() {\n        return this.storedTheme;\n    }\n    setStoredTheme(theme) {\n        if (theme) localStorage.setItem($74a507c74cfe9692$var$LS_THEME_KEY, theme);\n        else localStorage.removeItem($74a507c74cfe9692$var$LS_THEME_KEY);\n        this.storedTheme = theme;\n        this.updateTheme();\n    }\n    // ---- public ----\n    constructor(){\n        // initialization will be overwritten.\n        this.mediaQueryTheme = \"light\" // prefers-color-scheme\n        ;\n        this.theme = \"light\";\n        this.listeners = [];\n        // init media query\n        this.mediaQueryTheme = (0, $fc4403c8ee6a33dc$export$a79ad82046afa44e)() ? \"dark\" : \"light\";\n        (0, $fc4403c8ee6a33dc$export$a9dfd81f95a8a526)(()=>{\n            this.mediaQueryTheme = (0, $fc4403c8ee6a33dc$export$a79ad82046afa44e)() ? \"dark\" : \"light\";\n            this.updateTheme();\n        });\n        // init local storage\n        this.storedTheme = this.readLocalStorage();\n        addEventListener(\"storage\", (e)=>{\n            if (e.key === $74a507c74cfe9692$var$LS_THEME_KEY) {\n                this.storedTheme = this.readLocalStorage();\n                this.updateTheme();\n            }\n        });\n        this.updateTheme();\n    }\n}\nconst $74a507c74cfe9692$export$bca14c5b3b88a9c9 = new $74a507c74cfe9692$var$Theme();\n\n\nconst $7a2aeb795d64bafc$export$e4203cb02d5e5b28 = (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark() ? 255 : 255;\n\n\nclass $90a88670cfc900e0$export$4e5102252876c5d7 {\n    updatePrimaryHSV(hsv) {\n        if (hsv.s === 0) this.primaryColorHSV = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).HSV(this.primaryColorHSV.h, hsv.s, hsv.v);\n        else this.primaryColorHSV = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).HSV(hsv.h, hsv.s, hsv.v);\n    }\n    updateSVCanvas() {\n        const rgb = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRGB(new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).HSV(this.primaryColorHSV.h, 100, 100));\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).setAttributes(this.hueStop, {\n            \"stop-color\": \"#\" + (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toHexString(rgb)\n        });\n    }\n    updateSVPointer() {\n        const left = this.primaryColorHSV.s / 100 * this.width - 7;\n        const top = (1 - this.primaryColorHSV.v / 100) * this.svHeight - 6;\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.pointerSV, {\n            left: left + \"px\",\n            top: top + \"px\"\n        });\n    }\n    setColPreview() {\n        this.divPreview.style.backgroundColor = \"rgb(\" + this.primaryColorRGB.r + \",\" + this.primaryColorRGB.g + \",\" + this.primaryColorRGB.b + \")\";\n        if ((0, $d9f9f4926aa80a1c$export$921068d8846a1559).testIsWhiteBestContrast(this.primaryColorRGB)) {\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.pickerButton, {\n                filter: \"invert(1)\"\n            });\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.hexButton, {\n                filter: \"invert(1)\"\n            });\n        } else {\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.pickerButton, {\n                filter: \"\"\n            });\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.hexButton, {\n                filter: \"\"\n            });\n        }\n    }\n    updateSecondaryColor() {\n        this.secondaryColorBtn.style.backgroundColor = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRgbStr(this.secondaryColorRGB);\n    }\n    setColor(c) {\n        this.primaryColorRGB = {\n            r: parseInt(\"\" + c.r),\n            g: parseInt(\"\" + c.g),\n            b: parseInt(\"\" + c.b)\n        };\n        this.updatePrimaryHSV((0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toHSV(c));\n        this.controlH.style.left = parseInt(\"\" + (this.primaryColorHSV.h / 359 * this.width - 1)) + \"px\";\n        this.updateSVCanvas();\n        this.updateSVPointer();\n        this.setColPreview();\n    }\n    getColor() {\n        return new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b);\n    }\n    getSecondaryRGB() {\n        return new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).RGB(this.secondaryColorRGB.r, this.secondaryColorRGB.g, this.secondaryColorRGB.b);\n    }\n    setPickCallback(func) {\n        this.pickCallback = func;\n    }\n    pickingDone() {\n        if (!this.isPicking) return;\n        this.isPicking = false;\n        this.pickerButton.classList.remove(\"color-picker-preview-button-active\");\n    }\n    enable(e) {\n        if (e) {\n            this.rootEl.style.pointerEvents = \"\";\n            this.rootEl.style.opacity = \"1\";\n            this.outputDiv.style.pointerEvents = \"\";\n            this.outputDiv.style.opacity = \"1\";\n        } else {\n            this.rootEl.style.pointerEvents = \"none\";\n            this.rootEl.style.opacity = \"0.5\";\n            this.outputDiv.style.pointerEvents = \"none\";\n            this.outputDiv.style.opacity = \"0.5\";\n        }\n    }\n    setHeight(h) {\n        h = parseInt(\"\" + (h - this.height * 2 - 3), 10);\n        if (h === this.svHeight) return;\n        this.svHeight = h;\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.svSvg, {\n            width: this.width + \"px\",\n            height: this.svHeight + \"px\"\n        });\n        this.SVContainer.style.height = this.svHeight + \"px\";\n        this.updateSVPointer();\n    }\n    swapColors() {\n        // swap hsv\n        let tmp = this.secondaryColorHSV;\n        this.secondaryColorHSV = this.primaryColorHSV;\n        this.updatePrimaryHSV(tmp);\n        // swap rgb\n        tmp = this.secondaryColorRGB;\n        this.secondaryColorRGB = this.primaryColorRGB;\n        this.primaryColorRGB = tmp;\n        this.controlH.style.left = parseInt(\"\" + (this.primaryColorHSV.h / 359 * this.width - 1)) + \"px\";\n        this.updateSVCanvas();\n        this.updateSVPointer();\n        this.setColPreview();\n        this.updateSecondaryColor();\n        this.emitColor(new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b));\n    }\n    getElement() {\n        return this.rootEl;\n    }\n    getOutputElement() {\n        return this.outputDiv;\n    }\n    // ---- public ----\n    constructor(p){\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-color-picker\",\n            css: {\n                position: \"relative\"\n            }\n        });\n        this.outputDiv = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                display: \"flex\",\n                alignItems: \"center\"\n            }\n        });\n        this.width = p.width;\n        this.svHeight = p.svHeight;\n        this.height = p.height;\n        this.emitColor = p.onPick;\n        this.primaryColorRGB = {\n            r: parseInt(\"\" + p.startValue.r),\n            g: parseInt(\"\" + p.startValue.g),\n            b: parseInt(\"\" + p.startValue.b)\n        };\n        this.primaryColorHSV = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toHSV(p.startValue); // BB.HSV\n        this.secondaryColorRGB = {\n            r: (0, $7a2aeb795d64bafc$export$e4203cb02d5e5b28),\n            g: (0, $7a2aeb795d64bafc$export$e4203cb02d5e5b28),\n            b: (0, $7a2aeb795d64bafc$export$e4203cb02d5e5b28)\n        };\n        this.secondaryColorHSV = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter._RGBtoHSV(this.secondaryColorRGB); // BB.HSV\n        const svWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        this.svSvg = new DOMParser().parseFromString('<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"none\"><defs><linearGradient id=\"value\" gradientTransform=\"rotate(90)\"><stop offset=\"0\" stop-color=\"#fff\"/><stop offset=\"100%\" stop-color=\"#000\"/></linearGradient><linearGradient id=\"hue\" gradientTransform=\"rotate(0)\"><stop offset=\"0\" stop-color=\"#fff\"/><stop id=\"hue-stop\" offset=\"100%\" stop-color=\"#f00\"/></linearGradient></defs><rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#hue\\')\"/><rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#value\\')\" style=\"mix-blend-mode: multiply\"/></svg>', \"image/svg+xml\").documentElement;\n        {\n            const hueStop = this.svSvg.querySelector(\"#hue-stop\");\n            if (!hueStop) throw Error(\"#hue-stop not found in svSvg\");\n            this.hueStop = hueStop;\n        }\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).setAttributes(this.hueStop, {\n            \"stop-color\": \"#f0f\"\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.svSvg, {\n            width: this.width + \"px\",\n            height: this.svHeight + \"px\"\n        });\n        svWrapper.append(this.svSvg);\n        const divH = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-color-picker__h\",\n            css: {\n                overflow: \"hidden\",\n                position: \"relative\",\n                width: this.width + \"px\",\n                height: this.height + \"px\",\n                cursor: \"ew-resize\",\n                marginTop: \"1px\",\n                marginBottom: \"1px\"\n            }\n        });\n        this.divPreview = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-color-picker__preview\",\n            css: {\n                display: \"flex\",\n                justifyContent: \"space-between\",\n                width: this.height * 2.5 + \"px\",\n                height: this.height + \"px\"\n            }\n        });\n        this.controlH = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const createHueBg = (targetEl)=>{\n            const im = new Image();\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(im, {\n                position: \"absolute\",\n                left: \"0\",\n                top: \"0\",\n                display: \"none\",\n                pointerEvents: \"none\"\n            });\n            const cv = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(this.width, this.height);\n            const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(cv);\n            const gradH = ctx.createLinearGradient(0, 0, this.width, 0);\n            for(let i = 0; i < 1; i += 0.01){\n                const col = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRGB(new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).HSV(i * 360, 100, 100));\n                let ha = parseInt(\"\" + col.r).toString(16);\n                let hb = parseInt(\"\" + col.g).toString(16);\n                let hc = parseInt(\"\" + col.b).toString(16);\n                if (ha.length === 1) ha = \"0\" + ha;\n                if (hb.length === 1) hb = \"0\" + hb;\n                if (hc.length === 1) hc = \"0\" + hc;\n                gradH.addColorStop(i, \"#\" + ha + hb + hc);\n            }\n            ctx.fillStyle = gradH;\n            ctx.fillRect(0, 0, this.width, this.height);\n            targetEl.append(im);\n            im.alt = \"hue\";\n            im.src = cv.toDataURL(\"image/png\");\n            im.style.display = \"block\";\n        };\n        this.updateSVCanvas();\n        this.rootEl.style.width = this.width + \"px\";\n        this.rootEl.oncontextmenu = ()=>{\n            return false;\n        };\n        this.SVContainer = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-color-picker__sv\",\n            css: {\n                width: this.width + \"px\",\n                height: this.svHeight + \"px\",\n                overflow: \"hidden\",\n                display: \"block\",\n                position: \"relative\",\n                cursor: \"crosshair\"\n            }\n        });\n        this.pointerSV = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                width: \"12px\",\n                height: \"12px\",\n                borderRadius: \"6px\",\n                position: \"absolute\",\n                pointerEvents: \"none\",\n                boxShadow: \"0px 0px 0 1px #000, inset 0px 0px 0 1px #fff\"\n            }\n        });\n        this.SVContainer.append(svWrapper, this.pointerSV);\n        this.updateSVPointer();\n        this.rootEl.append(this.SVContainer, divH);\n        this.outputDiv.append(this.divPreview);\n        //divH.className = \"svSlider\";\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.controlH, {\n            width: \"1px\",\n            height: this.height + \"px\",\n            background: \"#000\",\n            borderLeft: \"1px solid #fff\",\n            position: \"absolute\",\n            top: \"0\",\n            left: parseInt(\"\" + (this.primaryColorHSV.h / 360 * this.width - 1)) + \"px\"\n        });\n        const virtualHSV = {\n            h: 0,\n            s: 0,\n            v: 0\n        };\n        this.pickerButton = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"eyedropper\") + \" [Alt]\",\n            className: \"color-picker-preview-button\",\n            css: {\n                width: \"30px\",\n                height: \"30px\",\n                backgroundImage: \"url(\" + (0, (/*@__PURE__*/$parcel$interopDefault($1675a096da5c857d$exports))) + \")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundSize: \"70%\",\n                backgroundPosition: \"center\"\n            },\n            onClick: ()=>{\n                if (this.isPicking) {\n                    this.pickCallback && this.pickCallback(false);\n                    this.pickingDone();\n                } else {\n                    this.pickerButton.classList.remove(\"color-picker-preview-button-hover\");\n                    this.pickerButton.classList.add(\"color-picker-preview-button-active\");\n                    this.isPicking = true;\n                    this.pickCallback && this.pickCallback(true);\n                }\n            }\n        });\n        this.isPicking = false;\n        const pickerButtonPointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.pickerButton,\n            onEnterLeave: (isOver)=>{\n                if (this.isPicking) return;\n                this.pickerButton.classList.toggle(\"color-picker-preview-button-hover\", isOver);\n            }\n        });\n        this.divPreview.append(this.pickerButton);\n        this.hexButton = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: \"#\",\n            className: \"color-picker-preview-button\",\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"manual-color-input\"),\n            css: {\n                height: \"100%\",\n                width: this.height + \"px\",\n                lineHeight: this.height + \"px\",\n                fontSize: this.height * 0.65 + \"px\"\n            },\n            onClick: ()=>{\n                new (0, $49ce344532144fcf$export$cc42e119007cb939)({\n                    color: new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b),\n                    onClose: (rgbObj)=>{\n                        if (!rgbObj) return;\n                        this.setColor(rgbObj);\n                        this.emitColor(new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b));\n                    }\n                });\n            }\n        });\n        const hexButtonPointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.hexButton,\n            onEnterLeave: (isOver)=>{\n                this.hexButton.classList.toggle(\"color-picker-preview-button-hover\", isOver);\n            }\n        });\n        this.divPreview.append(this.hexButton);\n        this.setColPreview();\n        setTimeout(()=>{\n            createHueBg(divH);\n            divH.append(this.controlH);\n            const svPointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n                target: svWrapper,\n                fixScribble: true,\n                onPointer: (event)=>{\n                    if (event.type === \"pointerdown\") {\n                        // prevent manual slider input keeping focus on iPad\n                        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).unfocusAnyInput();\n                        this.SVContainer.classList.toggle(\"kl-color-picker--active\", true);\n                        if (event.button === \"left\") {\n                            virtualHSV.s = event.relX / this.width * 100;\n                            virtualHSV.v = 100 - event.relY / this.svHeight * 100;\n                            this.primaryColorHSV = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).HSV(this.primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\n                            this.primaryColorRGB = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRGB(this.primaryColorHSV);\n                            this.updateSVPointer();\n                            this.setColPreview();\n                            this.emitColor((0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRGB(this.primaryColorHSV));\n                        } else {\n                            virtualHSV.s = this.primaryColorHSV.s;\n                            virtualHSV.v = this.primaryColorHSV.v;\n                        }\n                    }\n                    if (event.type === \"pointermove\" && [\n                        \"left\",\n                        \"right\"\n                    ].includes(event.button || \"\")) {\n                        let factor = 1;\n                        if (event.button === \"right\") factor = 0.5;\n                        virtualHSV.s += event.dX / this.width * 100 * factor;\n                        virtualHSV.v -= event.dY / this.svHeight * 100 * factor;\n                        this.primaryColorHSV = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).HSV(this.primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\n                        this.primaryColorRGB = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRGB(this.primaryColorHSV);\n                        this.updateSVPointer();\n                        this.setColPreview();\n                        this.emitColor((0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRGB(this.primaryColorHSV));\n                    }\n                    if (event.type === \"pointerup\") this.SVContainer.classList.toggle(\"kl-color-picker--active\", false);\n                }\n            });\n            const hPointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n                target: divH,\n                fixScribble: true,\n                onPointer: (event)=>{\n                    if (event.type === \"pointerdown\") {\n                        // prevent manual slider input keeping focus on iPad\n                        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).unfocusAnyInput();\n                        divH.classList.toggle(\"kl-color-picker--active\", true);\n                        if (event.button === \"left\") {\n                            virtualHSV.h = event.relX / this.width * 359.99;\n                            this.primaryColorHSV = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).HSV(virtualHSV.h, this.primaryColorHSV.s, this.primaryColorHSV.v);\n                            this.primaryColorRGB = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRGB(this.primaryColorHSV);\n                            this.controlH.style.left = Math.round(this.primaryColorHSV.h / 359.99 * this.width) - 1 + \"px\";\n                            this.updateSVCanvas();\n                            this.setColPreview();\n                            this.emitColor((0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRGB(this.primaryColorHSV));\n                        } else virtualHSV.h = this.primaryColorHSV.h;\n                    }\n                    if (event.type === \"pointermove\" && [\n                        \"left\",\n                        \"right\"\n                    ].includes(event.button || \"\")) {\n                        const deltaY = Math.abs(event.pageY - event.downPageY);\n                        const factor = (0, $6e485eb0c82960d0$export$f8e41e222e32615d)(deltaY, event.button === \"right\");\n                        virtualHSV.h += event.dX / this.width * 359.99 * factor;\n                        if (event.button === \"right\") {\n                            virtualHSV.h = virtualHSV.h % 359.99;\n                            if (virtualHSV.h < 0) virtualHSV.h += 359.99;\n                        }\n                        virtualHSV.h = Math.min(359.99, virtualHSV.h);\n                        this.primaryColorHSV = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).HSV(virtualHSV.h, this.primaryColorHSV.s, this.primaryColorHSV.v);\n                        this.primaryColorRGB = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRGB(this.primaryColorHSV);\n                        this.controlH.style.left = Math.round(this.primaryColorHSV.h / 359.99 * this.width) - 1 + \"px\";\n                        this.updateSVCanvas();\n                        this.setColPreview();\n                        this.emitColor((0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRGB(this.primaryColorHSV));\n                    }\n                    if (event.type === \"pointerup\") divH.classList.toggle(\"kl-color-picker--active\", false);\n                }\n            });\n        }, 1);\n        // --- secondary color ---\n        this.secondaryColorBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.outputDiv,\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"secondary-color\") + \" [X]\",\n            className: \"kl-color-picker__secondary\",\n            css: {\n                cursor: \"pointer\",\n                marginLeft: \"5px\",\n                width: \"22px\",\n                height: \"22px\"\n            },\n            onClick: (e)=>{\n                e.preventDefault();\n                this.swapColors();\n            }\n        });\n        this.updateSecondaryColor();\n    }\n}\n\n\n\n\nclass $8f768338795db7a0$export$66306bf21a9ff39e {\n    updateSV() {\n        const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.canvasSV);\n        if (!ctx) throw new Error(\"couldnt create canvas\");\n        for(let i = 0; i < this.canvasSV.height; i += 1){\n            const gradient1 = ctx.createLinearGradient(0, 0, this.canvasSV.width, 0);\n            const colleft = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRGB(new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).HSV(this.color.h, 1, 100 - i / this.canvasSV.height * 100.0));\n            const colright = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRGB(new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).HSV(this.color.h, 100, 100 - i / this.canvasSV.height * 100.0));\n            gradient1.addColorStop(0, \"#\" + (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toHexString(colleft));\n            gradient1.addColorStop(1, \"#\" + (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toHexString(colright));\n            ctx.fillStyle = \"#ff0000\"; //needed for chrome...otherwise alpha problem\n            ctx.fillStyle = gradient1;\n            ctx.fillRect(0, i, this.canvasSV.width, 1);\n        }\n    }\n    updateSVPointer() {\n        const left = this.color.s / 100 * this.width - 4;\n        const top = (1 - this.color.v / 100) * this.heightSV - 4;\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.pointerSV, {\n            left: left + \"px\",\n            top: top + \"px\"\n        });\n    }\n    updateHPointer() {\n        this.pointerH.style.left = this.color.h / 359.999 * this.width - 1 + \"px\";\n    }\n    // ---- interface ----\n    setColor(c) {\n        this.color = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toHSV(new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).RGB(c.r, c.g, c.b));\n        this.updateSV();\n        this.updateSVPointer();\n        this.updateHPointer();\n    }\n    getColor() {\n        return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRGB(this.color);\n    }\n    getElement() {\n        return this.rootEl;\n    }\n    destroy() {\n        this.svPointerListener.destroy();\n        this.hPointerListener.destroy();\n    }\n    end() {\n        this.svPointerId = null;\n        this.hPointerId = null;\n    }\n    // ----- public ----\n    constructor(p){\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                width: p.width + \"px\",\n                position: \"relative\",\n                overflow: \"hidden\",\n                userSelect: \"none\"\n            }\n        });\n        this.rootEl.oncontextmenu = (e)=>{\n            e.preventDefault();\n        };\n        this.color = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toHSV(new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).RGB(p.color.r, p.color.g, p.color.b));\n        this.width = p.width;\n        this.heightSV = p.heightSV;\n        this.canvasSV = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(10, 10);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.canvasSV, {\n            width: this.width + \"px\",\n            height: this.heightSV + \"px\",\n            cursor: \"crosshair\"\n        });\n        this.updateSV();\n        const canvasH = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(p.width, p.heightH);\n        canvasH.style.cursor = \"ew-resize\";\n        (()=>{\n            const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(canvasH);\n            const gradH = ctx.createLinearGradient(0, 0, p.width, 0);\n            for(let i = 0; i < 1; i += 0.01){\n                const col = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRGB(new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).HSV(i * 360, 100, 100));\n                gradH.addColorStop(i, \"rgba(\" + parseInt(\"\" + col.r) + \", \" + parseInt(\"\" + col.g) + \", \" + parseInt(\"\" + col.b) + \", 1)\");\n            }\n            ctx.fillStyle = gradH;\n            ctx.fillRect(0, 0, p.width, p.heightH);\n        })();\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.canvasSV, {\n            width: p.width + \"px\",\n            height: p.heightSV + \"px\",\n            overflow: \"hidden\",\n            position: \"relative\"\n        });\n        this.canvasSV.style.cssFloat = \"left\";\n        canvasH.style.cssFloat = \"left\";\n        this.rootEl.append(this.canvasSV, canvasH);\n        this.pointerSV = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            css: {\n                width: \"8px\",\n                height: \"8px\",\n                borderRadius: \"8px\",\n                position: \"absolute\",\n                pointerEvents: \"none\",\n                boxShadow: \"0 0 0 1px #000, inset 0 0 0 1px #fff\"\n            }\n        });\n        this.pointerH = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            css: {\n                width: \"0\",\n                height: p.heightH + \"px\",\n                borderLeft: \"1px solid #fff\",\n                borderRight: \"1px solid #000\",\n                position: \"absolute\",\n                top: p.heightSV + \"px\",\n                pointerEvents: \"none\"\n            }\n        });\n        this.updateSVPointer();\n        this.updateHPointer();\n        const virtualHSV = {\n            h: 0,\n            s: 0,\n            v: 0\n        };\n        this.svPointerId = null;\n        this.svPointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.canvasSV,\n            fixScribble: true,\n            onPointer: (event)=>{\n                if (event.type === \"pointerdown\") {\n                    // prevent manual slider input keeping focus on iPad\n                    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).unfocusAnyInput();\n                    this.svPointerId = event.pointerId;\n                    if (event.button === \"left\") {\n                        virtualHSV.s = event.relX / p.width * 100;\n                        virtualHSV.v = 100 - event.relY / p.heightSV * 100;\n                        this.color = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).HSV(this.color.h, virtualHSV.s, virtualHSV.v);\n                        this.updateSVPointer();\n                        p.callback((0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRGB(this.color));\n                    } else {\n                        virtualHSV.s = this.color.s;\n                        virtualHSV.v = this.color.v;\n                    }\n                }\n                if (event.type === \"pointermove\" && [\n                    \"left\",\n                    \"right\"\n                ].includes(\"\" + event.button) && this.svPointerId === event.pointerId) {\n                    let factor = 1;\n                    if (event.button === \"right\") factor = 0.5;\n                    virtualHSV.s += event.dX / p.width * 100 * factor;\n                    virtualHSV.v -= event.dY / p.heightSV * 100 * factor;\n                    this.color = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).HSV(this.color.h, virtualHSV.s, virtualHSV.v);\n                    this.updateSVPointer();\n                    p.callback((0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRGB(this.color));\n                }\n                if (event.type === \"pointerup\") this.svPointerId = null;\n            }\n        });\n        this.hPointerId = null;\n        this.hPointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: canvasH,\n            fixScribble: true,\n            onPointer: (event)=>{\n                if (event.type === \"pointerdown\") {\n                    this.hPointerId = event.pointerId;\n                    if (event.button === \"left\") {\n                        virtualHSV.h = event.relX / p.width * 359.99;\n                        this.color = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).HSV(virtualHSV.h, this.color.s, this.color.v);\n                        this.updateSV();\n                        this.updateHPointer();\n                        p.callback((0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRGB(this.color));\n                    } else virtualHSV.h = this.color.h;\n                }\n                if (event.type === \"pointermove\" && [\n                    \"left\",\n                    \"right\"\n                ].includes(\"\" + event.button) && this.hPointerId === event.pointerId) {\n                    const deltaY = Math.abs(event.pageY - event.downPageY);\n                    const factor = (0, $6e485eb0c82960d0$export$f8e41e222e32615d)(deltaY, event.button === \"right\");\n                    virtualHSV.h += event.dX / p.width * 359.99 * factor;\n                    if (event.button === \"right\") {\n                        virtualHSV.h = virtualHSV.h % 359.99;\n                        if (virtualHSV.h < 0) virtualHSV.h += 359.99;\n                    }\n                    virtualHSV.h = Math.min(359.99, virtualHSV.h);\n                    this.color = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).HSV(virtualHSV.h, this.color.s, this.color.v);\n                    this.updateSV();\n                    this.updateHPointer();\n                    p.callback((0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRGB(this.color));\n                }\n                if (event.type === \"pointerup\") this.hPointerId = null;\n            }\n        });\n        const cleardiv = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            css: {\n                clear: \"both\"\n            }\n        });\n    }\n}\n\n\n\nclass $867da577d723d824$export$ac00cea56cec3037 {\n    // ---- interface ----\n    getEl() {\n        return this.rootEl;\n    }\n    setActive(isActive) {\n        this.sliderPoint.style.backgroundColor = isActive ? \"#fff\" : \"#eaeaea\";\n    }\n    destroy() {\n        this.pointerListener.destroy();\n    }\n    // ---- public ----\n    constructor(p){\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                position: \"relative\"\n            }\n        });\n        const sliderLine = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            className: \"kl-point-slider__line\",\n            css: {\n                marginTop: parseInt(\"\" + (p.pointSize / 2 - 1)) + \"px\",\n                width: p.width + \"px\"\n            }\n        });\n        this.sliderPoint = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            className: \"kl-point-slider__point\"\n        });\n        let sliderPos;\n        let isDragging = false;\n        //sliderPoint\n        const touchAreaEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.sliderPoint,\n            css: {\n                // background: 'rgba(255,0,0,0.4)',\n                margin: \"-7px 0 0 -7px\",\n                width: \"calc(100% + 14px)\",\n                height: \"calc(100% + 7px)\"\n            }\n        });\n        const redrawPoint = ()=>{\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.sliderPoint, {\n                left: sliderPos + \"px\"\n            });\n        };\n        const getValue = ()=>{\n            return sliderPos / (p.width - p.pointSize);\n        };\n        {\n            let isFirst;\n            sliderPos = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(p.init * (p.width - p.pointSize), 0, p.width - p.pointSize);\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.sliderPoint, {\n                width: p.pointSize + \"px\",\n                height: p.pointSize + \"px\",\n                borderRadius: p.pointSize + \"px\"\n            });\n            redrawPoint();\n            let imaginaryPos;\n            this.pointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n                target: this.sliderPoint,\n                fixScribble: true,\n                onPointer: (event)=>{\n                    if (event.type === \"pointerdown\" && event.button === \"left\") {\n                        isFirst = true;\n                        isDragging = true;\n                        imaginaryPos = sliderPos;\n                        redrawPoint();\n                        event.eventStopPropagation();\n                    } else if (event.type === \"pointermove\" && event.button === \"left\") {\n                        event.eventStopPropagation();\n                        imaginaryPos = imaginaryPos + event.dX;\n                        sliderPos = parseInt(\"\" + (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(imaginaryPos, 0, p.width - p.pointSize));\n                        redrawPoint();\n                        p.callback(getValue(), isFirst, false);\n                        isFirst = false;\n                    }\n                    if (event.type === \"pointerup\") {\n                        event.eventStopPropagation();\n                        isDragging = false;\n                        redrawPoint();\n                        p.callback(getValue(), false, true);\n                    }\n                }\n            });\n        }\n    }\n}\n\n\n\n\n\n\nclass $3032e23fa8f3a9e5$export$24ba9b81662d4366 {\n    // ---- interface ----\n    getElement() {\n        return this.rootEl;\n    }\n    getValue() {\n        return this.colorArr[this.selectedIndex];\n    }\n    destroy() {\n        this.rootEl.remove();\n        this.buttonArr.forEach((item)=>{\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(item.el);\n        });\n        this.buttonArr.splice(0, this.buttonArr.length);\n        (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).removeIsDarkListener(this.updateCheckerboard);\n        this.colorInput.onchange = null;\n        this.colorInput.oninput = null;\n    }\n    // ---- public ----\n    constructor(p){\n        this.colorArr = [];\n        this.selectedIndex = 0;\n        var _p_title;\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: p.label ? p.label : \"\",\n            title: (_p_title = p.title) !== null && _p_title !== void 0 ? _p_title : undefined,\n            css: {\n                display: \"flex\",\n                alignItems: \"center\",\n                gap: \"7px\"\n            }\n        });\n        this.buttonArr = [];\n        const buttonSize = 22;\n        const checkerUrl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createCheckerDataUrl(5, undefined, (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark());\n        this.onColorInputChange = ()=>{\n            const i = this.selectedIndex;\n            const color = this.colorArr[i];\n            if (!color || color.a < 1) // ignore\n            return;\n            const newRawColor = this.colorInput.value;\n            this.buttonArr[this.selectedIndex].el.style.backgroundColor = newRawColor;\n            this.colorArr[i] = {\n                ...(0, $b68f66663c02a5d5$export$fb7efcd2e153af6e).hexToRGB(newRawColor),\n                a: 1\n            };\n            p.onChange(this.colorArr[i]);\n        };\n        this.colorInput = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"input\",\n            custom: {\n                type: \"color\",\n                tabIndex: \"-1\"\n            }\n        });\n        this.colorInput.onchange = this.onColorInputChange;\n        this.colorInput.oninput = this.onColorInputChange;\n        // build colorArr while removing duplicates\n        for(let i = 0; i < p.colorArr.length; i++){\n            const item = p.colorArr[i];\n            let found = false;\n            for(let e = 0; e < this.colorArr.length; e++){\n                const sItem = this.colorArr[e];\n                if (sItem === item) {\n                    found = true;\n                    break;\n                }\n                if (sItem === null || item === null) continue;\n                if (sItem.r === item.r && sItem.g === item.g && sItem.b === item.b && sItem.a === item.a) {\n                    found = true;\n                    break;\n                }\n            }\n            if (found) continue;\n            this.colorArr.push(item);\n            if (\"initialIndex\" in p && p.initialIndex === i) this.selectedIndex = this.colorArr.length - 1;\n        }\n        for(let i = 0; i < this.colorArr.length; i++)((i)=>{\n            const color = this.colorArr[i];\n            const colorButton = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                parent: this.rootEl,\n                content: color ? \"\" : \"X\",\n                className: \"kl-color-option\",\n                css: {\n                    width: buttonSize + \"px\",\n                    height: buttonSize + \"px\",\n                    backgroundColor: color ? (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRgbaStr(color) : \"transparent\",\n                    lineHeight: buttonSize + 1 + \"px\"\n                },\n                onClick: (e)=>{\n                    if (this.selectedIndex === i) {\n                        if (color && color.a === 1) this.colorInput.showPicker ? this.colorInput.showPicker() : this.colorInput.click();\n                        return;\n                    }\n                    e.preventDefault();\n                    this.selectedIndex = i;\n                    update();\n                    p.onChange(this.colorArr[i]); // color may change\n                }\n            });\n            if (color && color.a === 0) colorButton.style.backgroundImage = \"url(\" + checkerUrl + \")\";\n            const setIsSelected = (b)=>{\n                colorButton.classList.toggle(\"kl-color-option--active\", b);\n            };\n            this.buttonArr.push({\n                el: colorButton,\n                setIsSelected: setIsSelected\n            });\n        })(i);\n        this.rootEl.append((0, $934e5f47c3374e21$export$db3b6bfb95261072)(\",w-0,h-0,overflow-hidden\", [\n            this.colorInput\n        ]));\n        const update = ()=>{\n            for(let i = 0; i < this.buttonArr.length; i++)this.buttonArr[i].setIsSelected(i === this.selectedIndex);\n        };\n        update();\n        this.updateCheckerboard = ()=>{\n            const checkerUrl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createCheckerDataUrl(5, undefined, (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark());\n            this.buttonArr.forEach((button, i)=>{\n                const color = this.colorArr[i];\n                if (color && color.a === 0) button.el.style.backgroundImage = \"url(\" + checkerUrl + \")\";\n            });\n        };\n        (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).addIsDarkListener(this.updateCheckerboard);\n    }\n}\n\n\n\nclass $1166276dc18d3ea9$export$c019608e5b5bb4cb {\n    getIndex() {\n        for(let i = 0; i < this.optionArr.length; i++){\n            if (this.optionArr[i].id === this.selectedId) return i;\n        }\n        return -1;\n    }\n    update() {\n        for(let i = 0; i < this.optionArr.length; i++)this.optionArr[i].el.classList.toggle(\"kl-option-selected\", this.optionArr[i].id === this.selectedId);\n    }\n    getElement() {\n        return this.rootEl;\n    }\n    getValue() {\n        return this.selectedId;\n    }\n    next() {\n        this.selectedId = this.optionArr[(this.getIndex() + 1) % this.optionArr.length].id;\n        this.update();\n        this.onChange && this.onChange(this.selectedId);\n    }\n    previous() {\n        this.selectedId = this.optionArr[(this.optionArr.length + this.getIndex() - 1) % this.optionArr.length].id;\n        this.update();\n        this.onChange && this.onChange(this.selectedId);\n    }\n    destroy() {\n        this.rootEl.remove();\n        this.optionArr.forEach((item)=>{\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(item.el);\n        });\n        this.optionArr.splice(0, this.optionArr.length);\n    }\n    // ---- public ----\n    constructor(p){\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const wrapperEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            className: \"kl-option-wrapper\",\n            css: {\n                display: \"flex\"\n            }\n        });\n        if (p.onChange) this.onChange = p.onChange;\n        this.optionArr = [];\n        this.selectedId = \"initialId\" in p && p.initId !== undefined ? p.initId : p.optionArr[0].id;\n        const createOption = (o)=>{\n            const classArr = [\n                \"kl-option\"\n            ];\n            if (p.isSmall) classArr.push(\"kl-option--small\");\n            if (typeof o.label !== \"string\") {\n                classArr.push(\"kl-option--custom-el\");\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(o.label, {\n                    display: \"block\",\n                    pointerEvents: \"none\"\n                });\n            }\n            const optionObj = {\n                id: o.id,\n                el: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    parent: wrapperEl,\n                    content: o.label,\n                    className: classArr.join(\" \"),\n                    onClick: ()=>{\n                        if (this.selectedId !== optionObj.id) {\n                            this.selectedId = optionObj.id;\n                            this.update();\n                            this.onChange && this.onChange(this.selectedId);\n                        }\n                    }\n                })\n            };\n            if (o.title) optionObj.el.title = o.title;\n            this.optionArr.push(optionObj);\n        };\n        for(let i = 0; i < p.optionArr.length; i++)createOption(p.optionArr[i]);\n        this.update();\n        if (p.changeOnInit) setTimeout(()=>{\n            this.onChange && this.onChange(this.selectedId);\n        }, 0);\n    }\n}\n\n\n\nvar $ae5de6f4526dc7dd$exports = {};\n\n$ae5de6f4526dc7dd$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"angle.f0b557ac.svg\";\n\n\nclass $7ed35ae008fa6be6$export$5ee0af1d5c87e856 {\n    updateUiState() {\n        if (this.uiState === \"left\") this.el.style.left = \"271px\";\n        else this.el.style.removeProperty(\"left\");\n    }\n    setWide(b) {\n        this.isWide = b;\n        if (!this.el) return;\n        if (this.isWide) {\n            this.el.style.width = \"100%\";\n            this.el.style.left = \"\";\n        } else {\n            this.el.style.removeProperty(\"width\");\n            this.el.style.left = this.uiState === \"left\" ? \"271px\" : \"\";\n        }\n    }\n    setUiState(state) {\n        this.uiState = state;\n        this.updateUiState();\n    }\n    out(msg, doPulse) {\n        if (typeof msg === \"string\") {\n            this.angleIm.style.display = \"none\";\n            this.innerInnerEl.innerHTML = msg;\n        } else if (msg.type === \"transform\") {\n            this.angleIm.style.display = \"inline-block\";\n            this.angleIm.style.transform = \"rotate(\" + msg.angleDeg + \"deg)\";\n            if (msg.angleDeg % 90 === 0) this.angleIm.style.boxShadow = \"inset 0 0 0 1px rgba(255, 255, 255, 0.7)\";\n            else this.angleIm.style.boxShadow = \"\";\n            this.innerInnerEl.innerHTML = Math.round(msg.scale * 100) + \"%\";\n        } else this.angleIm.style.display = \"none\";\n        if (doPulse) {\n            this.innerEl.style.animation = \"\";\n            setTimeout(()=>this.innerEl.style.animation = \"topOverlayPulse 0.5s ease-out\", 20);\n            clearTimeout(this.timeout3);\n            this.timeout3 = setTimeout(()=>this.innerEl.style.animation = \"\", 520);\n        }\n        clearTimeout(this.timeout);\n        clearTimeout(this.timeout2);\n        this.el.style.animationName = doPulse ? \"consoleInFast\" : \"consoleIn\";\n        this.el.style.opacity = \"1\";\n        this.timeout = setTimeout(()=>{\n            this.el.style.opacity = \"0\";\n            this.el.style.animationName = \"consoleOut\";\n            this.timeout2 = setTimeout(()=>{\n                this.el.style.display = \"none\";\n            }, 450);\n        }, 1200);\n        this.el.style.display = \"flex\";\n    }\n    // --- public ---\n    constructor(){\n        this.isWide = false // tool space hidden\n        ;\n        this.uiState = \"right\";\n        this.el = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"top-overlay g-root\",\n            onClick: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).handleClick\n        });\n        this.updateUiState();\n        this.innerEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"top-overlay--inner\"\n        });\n        this.angleIm = new Image();\n        this.angleIm.src = (0, (/*@__PURE__*/$parcel$interopDefault($ae5de6f4526dc7dd$exports)));\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.angleIm, {\n            verticalAlign: \"bottom\",\n            width: \"20px\",\n            height: \"20px\",\n            marginLeft: \"5px\",\n            borderRadius: \"10px\"\n        });\n        this.innerInnerEl = document.createElement(\"div\");\n        this.innerInnerEl.style.display = \"inline-block\";\n        this.innerEl.append(this.innerInnerEl, this.angleIm);\n        this.el.append(this.innerEl);\n        document.body.append(this.el);\n        this.el.style.display = \"none\";\n    }\n}\n\n\n\n\n\n\n\n/**\n * Calculate a point transformed with an affine matrix\n * @param matrix {Matrix} Affine Matrix\n * @param  point {Point} Point\n * @returns {Point} Point\n */ function $855520c81dfcb96a$export$9b20165a36586806(matrix, point) {\n    return Array.isArray(point) ? [\n        matrix.a * point[0] + matrix.c * point[1] + matrix.e,\n        matrix.b * point[0] + matrix.d * point[1] + matrix.f\n    ] : {\n        x: matrix.a * point.x + matrix.c * point.y + matrix.e,\n        y: matrix.b * point.x + matrix.d * point.y + matrix.f\n    };\n}\nfunction $855520c81dfcb96a$export$25080e195dd950cc(matrix, points) {\n    return points.map((point)=>$855520c81dfcb96a$export$9b20165a36586806(matrix, point));\n}\n\n\n/**\n * Extract an affine matrix from an object that contains a,b,c,d,e,f keys\n * Any value could be a float or a string that contains a float\n * @param object {Object} Object that contains a,b,c,d,e,f keys\n * @return {Matrix} Affine Matrix\n */ function $93526789c874f75a$export$9144c32b59cbaec4(object) {\n    return {\n        a: parseFloat(object.a),\n        b: parseFloat(object.b),\n        c: parseFloat(object.c),\n        d: parseFloat(object.d),\n        e: parseFloat(object.e),\n        f: parseFloat(object.f)\n    };\n}\n\n\n/**\n * @ignore\n * @type {RegExp}\n */ const $9e90c8f24fdf1c6b$var$matrixRegex = /^matrix\\(\\s*([0-9_+-.e]+)\\s*,\\s*([0-9_+-.e]+)\\s*,\\s*([0-9_+-.e]+)\\s*,\\s*([0-9_+-.e]+)\\s*,\\s*([0-9_+-.e]+)\\s*,\\s*([0-9_+-.e]+)\\s*\\)$/i;\nfunction $9e90c8f24fdf1c6b$export$3004f64547af360e(string) {\n    const parsed = string.match($9e90c8f24fdf1c6b$var$matrixRegex);\n    if (parsed === null || parsed.length < 7) throw new Error(`'${string}' is not a matrix`);\n    return {\n        a: parseFloat(parsed[1]),\n        b: parseFloat(parsed[2]),\n        c: parseFloat(parsed[3]),\n        d: parseFloat(parsed[4]),\n        e: parseFloat(parsed[5]),\n        f: parseFloat(parsed[6])\n    };\n}\n\n\n/**\n * Identity matrix\n * @returns {Matrix} Affine Matrix\n */ function $5c473edaf09eadd3$export$f0954fd7d5368655() {\n    return {\n        a: 1,\n        c: 0,\n        e: 0,\n        b: 0,\n        d: 1,\n        f: 0\n    };\n}\n\n\n/**\n * Calculate a matrix that is the inverse of the provided matrix\n * @param matrix {Matrix} Affine Matrix\n * @returns {Matrix} Inverted Affine Matrix\n */ function $077740f52fe6870e$export$70ae2c07e401031b(matrix) {\n    // http://www.wolframalpha.com/input/?i=Inverse+%5B%7B%7Ba,c,e%7D,%7Bb,d,f%7D,%7B0,0,1%7D%7D%5D\n    const { a: a, b: b, c: c, d: d, e: e, f: f } = matrix;\n    const denom = a * d - b * c;\n    return {\n        a: d / denom,\n        b: b / -denom,\n        c: c / -denom,\n        d: a / denom,\n        e: (d * e - c * f) / -denom,\n        f: (b * e - a * f) / denom\n    };\n}\n\n\nfunction $bd2ee0a774cbe423$export$fce6876652108ab(val) {\n    return typeof val === \"undefined\";\n}\nfunction $bd2ee0a774cbe423$export$e90fb89750dba83f(n) {\n    return typeof n === \"number\" && !Number.isNaN(n) && Number.isFinite(n);\n}\nfunction $bd2ee0a774cbe423$export$a6cdc56e425d0d0a(obj) {\n    return typeof obj === \"object\" && obj !== null && !Array.isArray(obj);\n}\nfunction $bd2ee0a774cbe423$export$ea33763237293206(obj, keys) {\n    return keys.every((key)=>key in obj);\n}\n\n\nfunction $a6f1fb0b7ca0d744$export$b500e24115cd4dcf(object) {\n    return (0, $bd2ee0a774cbe423$export$a6cdc56e425d0d0a)(object) && \"a\" in object && (0, $bd2ee0a774cbe423$export$e90fb89750dba83f)(object.a) && \"b\" in object && (0, $bd2ee0a774cbe423$export$e90fb89750dba83f)(object.b) && \"c\" in object && (0, $bd2ee0a774cbe423$export$e90fb89750dba83f)(object.c) && \"d\" in object && (0, $bd2ee0a774cbe423$export$e90fb89750dba83f)(object.d) && \"e\" in object && (0, $bd2ee0a774cbe423$export$e90fb89750dba83f)(object.e) && \"f\" in object && (0, $bd2ee0a774cbe423$export$e90fb89750dba83f)(object.f);\n}\n\n\n\n/**\n * Calculate a translate matrix\n * @param tx {number} Translation on axis x\n * @param [ty = 0] {number} Translation on axis y\n * @returns {Matrix} Affine Matrix\n */ function $cf0617f9860dc277$export$d73ee8ef04f5226a(tx, ty = 0) {\n    return {\n        a: 1,\n        c: 0,\n        e: tx,\n        b: 0,\n        d: 1,\n        f: ty\n    };\n}\n\n\n/**\n * Merge multiple matrices into one\n * @param matrices {...Matrix | Matrix[]} Matrices listed as separate parameters or in an array\n * @returns {Matrix} Affine Matrix\n */ function $611d5fdbbcda65d9$export$51186ad6e864892a(...matrices) {\n    matrices = Array.isArray(matrices[0]) ? matrices[0] : matrices;\n    const multiply = (m1, m2)=>{\n        return {\n            a: m1.a * m2.a + m1.c * m2.b,\n            c: m1.a * m2.c + m1.c * m2.d,\n            e: m1.a * m2.e + m1.c * m2.f + m1.e,\n            b: m1.b * m2.a + m1.d * m2.b,\n            d: m1.b * m2.c + m1.d * m2.d,\n            f: m1.b * m2.e + m1.d * m2.f + m1.f\n        };\n    };\n    switch(matrices.length){\n        case 0:\n            throw new Error(\"no matrices provided\");\n        case 1:\n            return matrices[0];\n        case 2:\n            return multiply(matrices[0], matrices[1]);\n        default:\n            {\n                const [m1, m2, ...rest] = matrices;\n                const m = multiply(m1, m2);\n                return $611d5fdbbcda65d9$export$51186ad6e864892a(m, ...rest);\n            }\n    }\n}\nfunction $611d5fdbbcda65d9$export$f672e0b6f7222cd7(...matrices) {\n    return $611d5fdbbcda65d9$export$51186ad6e864892a(...matrices);\n}\n\n\nconst { cos: $20520e5c69c4ad5d$var$cos, sin: $20520e5c69c4ad5d$var$sin, PI: $20520e5c69c4ad5d$var$PI } = Math;\nfunction $20520e5c69c4ad5d$export$bb628a54ab399bc9(angle, cx, cy) {\n    const cosAngle = $20520e5c69c4ad5d$var$cos(angle);\n    const sinAngle = $20520e5c69c4ad5d$var$sin(angle);\n    const rotationMatrix = {\n        a: cosAngle,\n        c: -sinAngle,\n        e: 0,\n        b: sinAngle,\n        d: cosAngle,\n        f: 0\n    };\n    if ((0, $bd2ee0a774cbe423$export$fce6876652108ab)(cx) || (0, $bd2ee0a774cbe423$export$fce6876652108ab)(cy)) return rotationMatrix;\n    return (0, $611d5fdbbcda65d9$export$51186ad6e864892a)([\n        (0, $cf0617f9860dc277$export$d73ee8ef04f5226a)(cx, cy),\n        rotationMatrix,\n        (0, $cf0617f9860dc277$export$d73ee8ef04f5226a)(-cx, -cy)\n    ]);\n}\nfunction $20520e5c69c4ad5d$export$9ade995dfe562073(angle, cx, cy) {\n    return $20520e5c69c4ad5d$export$bb628a54ab399bc9(angle * $20520e5c69c4ad5d$var$PI / 180, cx, cy);\n}\n\n\n\n\n\nfunction $a78c550eaaca7cca$export$dcdf75081b88279d(sx, sy, cx, cy) {\n    if ((0, $bd2ee0a774cbe423$export$fce6876652108ab)(sy)) sy = sx;\n    const scaleMatrix = {\n        a: sx,\n        c: 0,\n        e: 0,\n        b: 0,\n        d: sy,\n        f: 0\n    };\n    if ((0, $bd2ee0a774cbe423$export$fce6876652108ab)(cx) || (0, $bd2ee0a774cbe423$export$fce6876652108ab)(cy)) return scaleMatrix;\n    return (0, $611d5fdbbcda65d9$export$51186ad6e864892a)([\n        (0, $cf0617f9860dc277$export$d73ee8ef04f5226a)(cx, cy),\n        scaleMatrix,\n        (0, $cf0617f9860dc277$export$d73ee8ef04f5226a)(-cx, -cy)\n    ]);\n}\n\n\n/**\n * Calculate a shear matrix\n * @param shx {number} Shear on axis x\n * @param shy {number} Shear on axis y\n * @returns {Matrix} Affine Matrix\n */ function $f7fa8858c5bed69e$export$4861775273fb6d4f(shx, shy) {\n    return {\n        a: 1,\n        c: shx,\n        e: 0,\n        b: shy,\n        d: 1,\n        f: 0\n    };\n}\n\n\n// https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function/skew\nconst { tan: $efe14c63f0506f3c$var$tan } = Math;\nfunction $efe14c63f0506f3c$export$dd2d5a892675faf1(ax, ay) {\n    return {\n        a: 1,\n        c: $efe14c63f0506f3c$var$tan(ax),\n        e: 0,\n        b: $efe14c63f0506f3c$var$tan(ay),\n        d: 1,\n        f: 0\n    };\n}\nfunction $efe14c63f0506f3c$export$80b820e0f249e768(ax, ay) {\n    return $efe14c63f0506f3c$export$dd2d5a892675faf1(ax * Math.PI / 180, ay * Math.PI / 180);\n}\n\n\n/**\n * Serialize an affine matrix to a string that can be used with CSS or SVG\n * @param matrix {Matrix} Affine Matrix\n * @returns {string} String that contains an affine matrix formatted as matrix(a,b,c,d,e,f)\n */ function $3855bc26fe20e480$export$5d05fd1a2be8c220(matrix) {\n    return $3855bc26fe20e480$export$f84e8e69fd4488a5(matrix);\n}\nfunction $3855bc26fe20e480$export$1d0eee16b7a93374(matrix) {\n    return $3855bc26fe20e480$export$f84e8e69fd4488a5(matrix);\n}\nfunction $3855bc26fe20e480$export$f84e8e69fd4488a5(matrix) {\n    return `matrix(${matrix.a},${matrix.b},${matrix.c},${matrix.d},${matrix.e},${matrix.f})`;\n}\n\n\n\n\n\n\n/**\n * Rounds all elements of the given matrix using the given precision\n * @param matrix {Matrix} An affine matrix to round\n * @param [precision] {number} A precision to use for Math.round. Defaults to 10000000000 (meaning which rounds to the 10th digit after the comma).\n * @returns {Matrix} The rounded Affine Matrix\n */ function $31383089db14caf7$export$8459a0a25f7ea1f1(matrix, precision = 10000000000) {\n    return {\n        a: Math.round(matrix.a * precision) / precision,\n        b: Math.round(matrix.b * precision) / precision,\n        c: Math.round(matrix.c * precision) / precision,\n        d: Math.round(matrix.d * precision) / precision,\n        e: Math.round(matrix.e * precision) / precision,\n        f: Math.round(matrix.f * precision) / precision\n    };\n}\n\n\nfunction $858256bd43cb5a95$export$2565f8052cb7f44a(t1, t2) {\n    // point p = first point of the triangle\n    const px1 = t1[0].x != null ? t1[0].x : t1[0][0];\n    const py1 = t1[0].y != null ? t1[0].y : t1[0][1];\n    const px2 = t2[0].x != null ? t2[0].x : t2[0][0];\n    const py2 = t2[0].y != null ? t2[0].y : t2[0][1];\n    // point q = second point of the triangle\n    const qx1 = t1[1].x != null ? t1[1].x : t1[1][0];\n    const qy1 = t1[1].y != null ? t1[1].y : t1[1][1];\n    const qx2 = t2[1].x != null ? t2[1].x : t2[1][0];\n    const qy2 = t2[1].y != null ? t2[1].y : t2[1][1];\n    // point r = third point of the triangle\n    const rx1 = t1[2].x != null ? t1[2].x : t1[2][0];\n    const ry1 = t1[2].y != null ? t1[2].y : t1[2][1];\n    const rx2 = t2[2].x != null ? t2[2].x : t2[2][0];\n    const ry2 = t2[2].y != null ? t2[2].y : t2[2][1];\n    const r1 = {\n        a: px1 - rx1,\n        b: py1 - ry1,\n        c: qx1 - rx1,\n        d: qy1 - ry1,\n        e: rx1,\n        f: ry1\n    };\n    const r2 = {\n        a: px2 - rx2,\n        b: py2 - ry2,\n        c: qx2 - rx2,\n        d: qy2 - ry2,\n        e: rx2,\n        f: ry2\n    };\n    const inverseR1 = (0, $077740f52fe6870e$export$70ae2c07e401031b)(r1);\n    const affineMatrix = (0, $611d5fdbbcda65d9$export$51186ad6e864892a)([\n        r2,\n        inverseR1\n    ]);\n    // round the matrix elements to smooth the finite inversion\n    return (0, $31383089db14caf7$export$8459a0a25f7ea1f1)(affineMatrix);\n}\n\n\n\n\n\n\n\n\n\nfunction $780e51f01f4de949$export$36aa15ab5c729b62(definitionOrArrayOfDefinition) {\n    return Array.isArray(definitionOrArrayOfDefinition) ? definitionOrArrayOfDefinition.map(mapper) : mapper(definitionOrArrayOfDefinition);\n    function mapper(descriptor) {\n        switch(descriptor.type){\n            case \"matrix\":\n                if (\"a\" in descriptor && \"b\" in descriptor && \"c\" in descriptor && \"d\" in descriptor && \"e\" in descriptor && \"f\" in descriptor) return (0, $93526789c874f75a$export$9144c32b59cbaec4)(descriptor);\n                else throw new Error(\"MISSING_MANDATORY_PARAM\");\n            case \"translate\":\n                if (!(\"tx\" in descriptor)) throw new Error(\"MISSING_MANDATORY_PARAM\");\n                if (\"ty\" in descriptor) return (0, $cf0617f9860dc277$export$d73ee8ef04f5226a)(descriptor.tx, descriptor.ty);\n                return (0, $cf0617f9860dc277$export$d73ee8ef04f5226a)(descriptor.tx);\n            case \"scale\":\n                if (!(\"sx\" in descriptor)) throw new Error(\"MISSING_MANDATORY_PARAM\");\n                if (\"sy\" in descriptor) return (0, $a78c550eaaca7cca$export$dcdf75081b88279d)(descriptor.sx, descriptor.sy);\n                return (0, $a78c550eaaca7cca$export$dcdf75081b88279d)(descriptor.sx);\n            case \"rotate\":\n                if (!(\"angle\" in descriptor)) throw new Error(\"MISSING_MANDATORY_PARAM\");\n                if (\"cx\" in descriptor && \"cy\" in descriptor) return (0, $20520e5c69c4ad5d$export$9ade995dfe562073)(descriptor.angle, descriptor.cx, descriptor.cy);\n                return (0, $20520e5c69c4ad5d$export$9ade995dfe562073)(descriptor.angle);\n            case \"skewX\":\n                if (!(\"angle\" in descriptor)) throw new Error(\"MISSING_MANDATORY_PARAM\");\n                return (0, $efe14c63f0506f3c$export$80b820e0f249e768)(descriptor.angle, 0);\n            case \"skewY\":\n                if (!(\"angle\" in descriptor)) throw new Error(\"MISSING_MANDATORY_PARAM\");\n                return (0, $efe14c63f0506f3c$export$80b820e0f249e768)(0, descriptor.angle);\n            case \"shear\":\n                if (!(\"shx\" in descriptor && \"shy\" in descriptor)) throw new Error(\"MISSING_MANDATORY_PARAM\");\n                return (0, $f7fa8858c5bed69e$export$4861775273fb6d4f)(descriptor.shx, descriptor.shy);\n            default:\n                throw new Error(\"UNSUPPORTED_DESCRIPTOR\");\n        }\n    }\n}\n\n\n// Generated by Peggy 3.0.0.\n//\n// https://peggyjs.org/\nfunction $2c16fa132dd43ca2$var$peg$subclass(child, parent) {\n    function C() {\n        this.constructor = child;\n    }\n    C.prototype = parent.prototype;\n    child.prototype = new C();\n}\nfunction $2c16fa132dd43ca2$export$f21cea08b0dd60e8(message, expected, found, location) {\n    var self = Error.call(this, message);\n    // istanbul ignore next Check is a necessary evil to support older environments\n    if (Object.setPrototypeOf) Object.setPrototypeOf(self, $2c16fa132dd43ca2$export$f21cea08b0dd60e8.prototype);\n    self.expected = expected;\n    self.found = found;\n    self.location = location;\n    self.name = \"SyntaxError\";\n    return self;\n}\n$2c16fa132dd43ca2$var$peg$subclass($2c16fa132dd43ca2$export$f21cea08b0dd60e8, Error);\nfunction $2c16fa132dd43ca2$var$peg$padEnd(str, targetLength, padString) {\n    padString = padString || \" \";\n    if (str.length > targetLength) return str;\n    targetLength -= str.length;\n    padString += padString.repeat(targetLength);\n    return str + padString.slice(0, targetLength);\n}\n$2c16fa132dd43ca2$export$f21cea08b0dd60e8.prototype.format = function(sources) {\n    var str = \"Error: \" + this.message;\n    if (this.location) {\n        var src = null;\n        var k;\n        for(k = 0; k < sources.length; k++)if (sources[k].source === this.location.source) {\n            src = sources[k].text.split(/\\r\\n|\\n|\\r/g);\n            break;\n        }\n        var s = this.location.start;\n        var offset_s = this.location.source && typeof this.location.source.offset === \"function\" ? this.location.source.offset(s) : s;\n        var loc = this.location.source + \":\" + offset_s.line + \":\" + offset_s.column;\n        if (src) {\n            var e = this.location.end;\n            var filler = $2c16fa132dd43ca2$var$peg$padEnd(\"\", offset_s.line.toString().length, \" \");\n            var line = src[s.line - 1];\n            var last = s.line === e.line ? e.column : line.length + 1;\n            var hatLen = last - s.column || 1;\n            str += \"\\n --> \" + loc + \"\\n\" + filler + \" |\\n\" + offset_s.line + \" | \" + line + \"\\n\" + filler + \" | \" + $2c16fa132dd43ca2$var$peg$padEnd(\"\", s.column - 1, \" \") + $2c16fa132dd43ca2$var$peg$padEnd(\"\", hatLen, \"^\");\n        } else str += \"\\n at \" + loc;\n    }\n    return str;\n};\n$2c16fa132dd43ca2$export$f21cea08b0dd60e8.buildMessage = function(expected, found) {\n    var DESCRIBE_EXPECTATION_FNS = {\n        literal: function(expectation) {\n            return '\"' + literalEscape(expectation.text) + '\"';\n        },\n        class: function(expectation) {\n            var escapedParts = expectation.parts.map(function(part) {\n                return Array.isArray(part) ? classEscape(part[0]) + \"-\" + classEscape(part[1]) : classEscape(part);\n            });\n            return \"[\" + (expectation.inverted ? \"^\" : \"\") + escapedParts.join(\"\") + \"]\";\n        },\n        any: function() {\n            return \"any character\";\n        },\n        end: function() {\n            return \"end of input\";\n        },\n        other: function(expectation) {\n            return expectation.description;\n        }\n    };\n    function hex(ch) {\n        return ch.charCodeAt(0).toString(16).toUpperCase();\n    }\n    function literalEscape(s) {\n        return s.replace(/\\\\/g, \"\\\\\\\\\").replace(/\"/g, '\\\\\"').replace(/\\0/g, \"\\\\0\").replace(/\\t/g, \"\\\\t\").replace(/\\n/g, \"\\\\n\").replace(/\\r/g, \"\\\\r\").replace(/[\\x00-\\x0F]/g, function(ch) {\n            return \"\\\\x0\" + hex(ch);\n        }).replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, function(ch) {\n            return \"\\\\x\" + hex(ch);\n        });\n    }\n    function classEscape(s) {\n        return s.replace(/\\\\/g, \"\\\\\\\\\").replace(/\\]/g, \"\\\\]\").replace(/\\^/g, \"\\\\^\").replace(/-/g, \"\\\\-\").replace(/\\0/g, \"\\\\0\").replace(/\\t/g, \"\\\\t\").replace(/\\n/g, \"\\\\n\").replace(/\\r/g, \"\\\\r\").replace(/[\\x00-\\x0F]/g, function(ch) {\n            return \"\\\\x0\" + hex(ch);\n        }).replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, function(ch) {\n            return \"\\\\x\" + hex(ch);\n        });\n    }\n    function describeExpectation(expectation) {\n        return DESCRIBE_EXPECTATION_FNS[expectation.type](expectation);\n    }\n    function describeExpected(expected) {\n        var descriptions = expected.map(describeExpectation);\n        var i, j;\n        descriptions.sort();\n        if (descriptions.length > 0) {\n            for(i = 1, j = 1; i < descriptions.length; i++)if (descriptions[i - 1] !== descriptions[i]) {\n                descriptions[j] = descriptions[i];\n                j++;\n            }\n            descriptions.length = j;\n        }\n        switch(descriptions.length){\n            case 1:\n                return descriptions[0];\n            case 2:\n                return descriptions[0] + \" or \" + descriptions[1];\n            default:\n                return descriptions.slice(0, -1).join(\", \") + \", or \" + descriptions[descriptions.length - 1];\n        }\n    }\n    function describeFound(found) {\n        return found ? '\"' + literalEscape(found) + '\"' : \"end of input\";\n    }\n    return \"Expected \" + describeExpected(expected) + \" but \" + describeFound(found) + \" found.\";\n};\nfunction $2c16fa132dd43ca2$export$98e6a39c04603d36(input, options) {\n    options = options !== undefined ? options : {};\n    var peg$FAILED = {};\n    var peg$source = options.grammarSource;\n    var peg$startRuleFunctions = {\n        transformList: peg$parsetransformList\n    };\n    var peg$startRuleFunction = peg$parsetransformList;\n    var peg$c0 = \"matrix\";\n    var peg$c1 = \"(\";\n    var peg$c2 = \")\";\n    var peg$c3 = \"translate\";\n    var peg$c4 = \"scale\";\n    var peg$c5 = \"rotate\";\n    var peg$c6 = \"skewX\";\n    var peg$c7 = \"skewY\";\n    var peg$c8 = \",\";\n    var peg$c9 = \".\";\n    var peg$r0 = /^[eE]/;\n    var peg$r1 = /^[+\\-]/;\n    var peg$r2 = /^[0-9]/;\n    var peg$r3 = /^[ \\t\\r\\n]/;\n    var peg$e0 = peg$literalExpectation(\"matrix\", false);\n    var peg$e1 = peg$literalExpectation(\"(\", false);\n    var peg$e2 = peg$literalExpectation(\")\", false);\n    var peg$e3 = peg$literalExpectation(\"translate\", false);\n    var peg$e4 = peg$literalExpectation(\"scale\", false);\n    var peg$e5 = peg$literalExpectation(\"rotate\", false);\n    var peg$e6 = peg$literalExpectation(\"skewX\", false);\n    var peg$e7 = peg$literalExpectation(\"skewY\", false);\n    var peg$e8 = peg$literalExpectation(\",\", false);\n    var peg$e9 = peg$otherExpectation(\"fractionalConstant\");\n    var peg$e10 = peg$literalExpectation(\".\", false);\n    var peg$e11 = peg$classExpectation([\n        \"e\",\n        \"E\"\n    ], false, false);\n    var peg$e12 = peg$classExpectation([\n        \"+\",\n        \"-\"\n    ], false, false);\n    var peg$e13 = peg$classExpectation([\n        [\n            \"0\",\n            \"9\"\n        ]\n    ], false, false);\n    var peg$e14 = peg$classExpectation([\n        \" \",\n        \"\t\",\n        \"\\r\",\n        \"\\n\"\n    ], false, false);\n    var peg$f0 = function(ts) {\n        return ts;\n    };\n    var peg$f1 = function(t, ts) {\n        return t.concat(ts);\n    };\n    var peg$f2 = function(a, b, c, d, e, f) {\n        return [\n            {\n                type: \"matrix\",\n                a: a,\n                b: b,\n                c: c,\n                d: d,\n                e: e,\n                f: f\n            }\n        ];\n    };\n    var peg$f3 = function(tx, ty) {\n        var t = {\n            type: \"translate\",\n            tx: tx\n        };\n        if (ty) t.ty = ty;\n        return [\n            t\n        ];\n    };\n    var peg$f4 = function(sx, sy) {\n        var s = {\n            type: \"scale\",\n            sx: sx\n        };\n        if (sy) s.sy = sy;\n        return [\n            s\n        ];\n    };\n    var peg$f5 = function(angle, c) {\n        var r = {\n            type: \"rotate\",\n            angle: angle\n        };\n        if (c) {\n            r.cx = c[0];\n            r.cy = c[1];\n        }\n        return [\n            r\n        ];\n    };\n    var peg$f6 = function(angle) {\n        return [\n            {\n                type: \"skewX\",\n                angle: angle\n            }\n        ];\n    };\n    var peg$f7 = function(angle) {\n        return [\n            {\n                type: \"skewY\",\n                angle: angle\n            }\n        ];\n    };\n    var peg$f8 = function(f) {\n        return parseFloat(f.join(\"\"));\n    };\n    var peg$f9 = function(i) {\n        return parseInt(i.join(\"\"));\n    };\n    var peg$f10 = function(n) {\n        return n;\n    };\n    var peg$f11 = function(n1, n2) {\n        return [\n            n1,\n            n2\n        ];\n    };\n    var peg$f12 = function(ds) {\n        return ds.join(\"\");\n    };\n    var peg$f13 = function(f, e) {\n        return [\n            f,\n            e || null\n        ].join(\"\");\n    };\n    var peg$f14 = function(d, e) {\n        return [\n            d,\n            e\n        ].join(\"\");\n    };\n    var peg$f15 = function(d1, d2) {\n        return [\n            d1 ? d1.join(\"\") : null,\n            \".\",\n            d2.join(\"\")\n        ].join(\"\");\n    };\n    var peg$f16 = function(d) {\n        return d.join(\"\");\n    };\n    var peg$f17 = function(s, d) {\n        return [\n            \"e\",\n            s,\n            d.join(\"\")\n        ].join(\"\");\n    };\n    var peg$currPos = 0;\n    var peg$savedPos = 0;\n    var peg$posDetailsCache = [\n        {\n            line: 1,\n            column: 1\n        }\n    ];\n    var peg$maxFailPos = 0;\n    var peg$maxFailExpected = [];\n    var peg$silentFails = 0;\n    var peg$result;\n    if (\"startRule\" in options) {\n        if (!(options.startRule in peg$startRuleFunctions)) throw new Error(\"Can't start parsing from rule \\\"\" + options.startRule + '\".');\n        peg$startRuleFunction = peg$startRuleFunctions[options.startRule];\n    }\n    function text() {\n        return input.substring(peg$savedPos, peg$currPos);\n    }\n    function offset() {\n        return peg$savedPos;\n    }\n    function range() {\n        return {\n            source: peg$source,\n            start: peg$savedPos,\n            end: peg$currPos\n        };\n    }\n    function location() {\n        return peg$computeLocation(peg$savedPos, peg$currPos);\n    }\n    function expected(description, location) {\n        location = location !== undefined ? location : peg$computeLocation(peg$savedPos, peg$currPos);\n        throw peg$buildStructuredError([\n            peg$otherExpectation(description)\n        ], input.substring(peg$savedPos, peg$currPos), location);\n    }\n    function error(message, location) {\n        location = location !== undefined ? location : peg$computeLocation(peg$savedPos, peg$currPos);\n        throw peg$buildSimpleError(message, location);\n    }\n    function peg$literalExpectation(text, ignoreCase) {\n        return {\n            type: \"literal\",\n            text: text,\n            ignoreCase: ignoreCase\n        };\n    }\n    function peg$classExpectation(parts, inverted, ignoreCase) {\n        return {\n            type: \"class\",\n            parts: parts,\n            inverted: inverted,\n            ignoreCase: ignoreCase\n        };\n    }\n    function peg$anyExpectation() {\n        return {\n            type: \"any\"\n        };\n    }\n    function peg$endExpectation() {\n        return {\n            type: \"end\"\n        };\n    }\n    function peg$otherExpectation(description) {\n        return {\n            type: \"other\",\n            description: description\n        };\n    }\n    function peg$computePosDetails(pos) {\n        var details = peg$posDetailsCache[pos];\n        var p;\n        if (details) return details;\n        else {\n            p = pos - 1;\n            while(!peg$posDetailsCache[p])p--;\n            details = peg$posDetailsCache[p];\n            details = {\n                line: details.line,\n                column: details.column\n            };\n            while(p < pos){\n                if (input.charCodeAt(p) === 10) {\n                    details.line++;\n                    details.column = 1;\n                } else details.column++;\n                p++;\n            }\n            peg$posDetailsCache[pos] = details;\n            return details;\n        }\n    }\n    function peg$computeLocation(startPos, endPos, offset) {\n        var startPosDetails = peg$computePosDetails(startPos);\n        var endPosDetails = peg$computePosDetails(endPos);\n        var res = {\n            source: peg$source,\n            start: {\n                offset: startPos,\n                line: startPosDetails.line,\n                column: startPosDetails.column\n            },\n            end: {\n                offset: endPos,\n                line: endPosDetails.line,\n                column: endPosDetails.column\n            }\n        };\n        if (offset && peg$source && typeof peg$source.offset === \"function\") {\n            res.start = peg$source.offset(res.start);\n            res.end = peg$source.offset(res.end);\n        }\n        return res;\n    }\n    function peg$fail(expected) {\n        if (peg$currPos < peg$maxFailPos) return;\n        if (peg$currPos > peg$maxFailPos) {\n            peg$maxFailPos = peg$currPos;\n            peg$maxFailExpected = [];\n        }\n        peg$maxFailExpected.push(expected);\n    }\n    function peg$buildSimpleError(message, location) {\n        return new $2c16fa132dd43ca2$export$f21cea08b0dd60e8(message, null, null, location);\n    }\n    function peg$buildStructuredError(expected, found, location) {\n        return new $2c16fa132dd43ca2$export$f21cea08b0dd60e8($2c16fa132dd43ca2$export$f21cea08b0dd60e8.buildMessage(expected, found), expected, found, location);\n    }\n    function peg$parsetransformList() {\n        var s0, s1, s2, s3, s4;\n        s0 = peg$currPos;\n        s1 = [];\n        s2 = peg$parsewsp();\n        while(s2 !== peg$FAILED){\n            s1.push(s2);\n            s2 = peg$parsewsp();\n        }\n        s2 = peg$parsetransforms();\n        if (s2 === peg$FAILED) s2 = null;\n        s3 = [];\n        s4 = peg$parsewsp();\n        while(s4 !== peg$FAILED){\n            s3.push(s4);\n            s4 = peg$parsewsp();\n        }\n        peg$savedPos = s0;\n        s0 = peg$f0(s2);\n        return s0;\n    }\n    function peg$parsetransforms() {\n        var s0, s1, s2, s3;\n        s0 = peg$currPos;\n        s1 = peg$parsetransform();\n        if (s1 !== peg$FAILED) {\n            s2 = [];\n            s3 = peg$parsecommaWsp();\n            if (s3 !== peg$FAILED) while(s3 !== peg$FAILED){\n                s2.push(s3);\n                s3 = peg$parsecommaWsp();\n            }\n            else s2 = peg$FAILED;\n            if (s2 !== peg$FAILED) {\n                s3 = peg$parsetransforms();\n                if (s3 !== peg$FAILED) {\n                    peg$savedPos = s0;\n                    s0 = peg$f1(s1, s3);\n                } else {\n                    peg$currPos = s0;\n                    s0 = peg$FAILED;\n                }\n            } else {\n                peg$currPos = s0;\n                s0 = peg$FAILED;\n            }\n        } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n        }\n        if (s0 === peg$FAILED) s0 = peg$parsetransform();\n        return s0;\n    }\n    function peg$parsetransform() {\n        var s0;\n        s0 = peg$parsematrix();\n        if (s0 === peg$FAILED) {\n            s0 = peg$parsetranslate();\n            if (s0 === peg$FAILED) {\n                s0 = peg$parsescale();\n                if (s0 === peg$FAILED) {\n                    s0 = peg$parserotate();\n                    if (s0 === peg$FAILED) {\n                        s0 = peg$parseskewX();\n                        if (s0 === peg$FAILED) s0 = peg$parseskewY();\n                    }\n                }\n            }\n        }\n        return s0;\n    }\n    function peg$parsematrix() {\n        var s0, s1, s2, s3, s4, s5, s6, s7, s8, s9, s10, s11, s12, s13, s14, s15, s16, s17;\n        s0 = peg$currPos;\n        if (input.substr(peg$currPos, 6) === peg$c0) {\n            s1 = peg$c0;\n            peg$currPos += 6;\n        } else {\n            s1 = peg$FAILED;\n            if (peg$silentFails === 0) peg$fail(peg$e0);\n        }\n        if (s1 !== peg$FAILED) {\n            s2 = [];\n            s3 = peg$parsewsp();\n            while(s3 !== peg$FAILED){\n                s2.push(s3);\n                s3 = peg$parsewsp();\n            }\n            if (input.charCodeAt(peg$currPos) === 40) {\n                s3 = peg$c1;\n                peg$currPos++;\n            } else {\n                s3 = peg$FAILED;\n                if (peg$silentFails === 0) peg$fail(peg$e1);\n            }\n            if (s3 !== peg$FAILED) {\n                s4 = [];\n                s5 = peg$parsewsp();\n                while(s5 !== peg$FAILED){\n                    s4.push(s5);\n                    s5 = peg$parsewsp();\n                }\n                s5 = peg$parsenumber();\n                if (s5 !== peg$FAILED) {\n                    s6 = peg$parsecommaWsp();\n                    if (s6 !== peg$FAILED) {\n                        s7 = peg$parsenumber();\n                        if (s7 !== peg$FAILED) {\n                            s8 = peg$parsecommaWsp();\n                            if (s8 !== peg$FAILED) {\n                                s9 = peg$parsenumber();\n                                if (s9 !== peg$FAILED) {\n                                    s10 = peg$parsecommaWsp();\n                                    if (s10 !== peg$FAILED) {\n                                        s11 = peg$parsenumber();\n                                        if (s11 !== peg$FAILED) {\n                                            s12 = peg$parsecommaWsp();\n                                            if (s12 !== peg$FAILED) {\n                                                s13 = peg$parsenumber();\n                                                if (s13 !== peg$FAILED) {\n                                                    s14 = peg$parsecommaWsp();\n                                                    if (s14 !== peg$FAILED) {\n                                                        s15 = peg$parsenumber();\n                                                        if (s15 !== peg$FAILED) {\n                                                            s16 = [];\n                                                            s17 = peg$parsewsp();\n                                                            while(s17 !== peg$FAILED){\n                                                                s16.push(s17);\n                                                                s17 = peg$parsewsp();\n                                                            }\n                                                            if (input.charCodeAt(peg$currPos) === 41) {\n                                                                s17 = peg$c2;\n                                                                peg$currPos++;\n                                                            } else {\n                                                                s17 = peg$FAILED;\n                                                                if (peg$silentFails === 0) peg$fail(peg$e2);\n                                                            }\n                                                            if (s17 !== peg$FAILED) {\n                                                                peg$savedPos = s0;\n                                                                s0 = peg$f2(s5, s7, s9, s11, s13, s15);\n                                                            } else {\n                                                                peg$currPos = s0;\n                                                                s0 = peg$FAILED;\n                                                            }\n                                                        } else {\n                                                            peg$currPos = s0;\n                                                            s0 = peg$FAILED;\n                                                        }\n                                                    } else {\n                                                        peg$currPos = s0;\n                                                        s0 = peg$FAILED;\n                                                    }\n                                                } else {\n                                                    peg$currPos = s0;\n                                                    s0 = peg$FAILED;\n                                                }\n                                            } else {\n                                                peg$currPos = s0;\n                                                s0 = peg$FAILED;\n                                            }\n                                        } else {\n                                            peg$currPos = s0;\n                                            s0 = peg$FAILED;\n                                        }\n                                    } else {\n                                        peg$currPos = s0;\n                                        s0 = peg$FAILED;\n                                    }\n                                } else {\n                                    peg$currPos = s0;\n                                    s0 = peg$FAILED;\n                                }\n                            } else {\n                                peg$currPos = s0;\n                                s0 = peg$FAILED;\n                            }\n                        } else {\n                            peg$currPos = s0;\n                            s0 = peg$FAILED;\n                        }\n                    } else {\n                        peg$currPos = s0;\n                        s0 = peg$FAILED;\n                    }\n                } else {\n                    peg$currPos = s0;\n                    s0 = peg$FAILED;\n                }\n            } else {\n                peg$currPos = s0;\n                s0 = peg$FAILED;\n            }\n        } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n        }\n        return s0;\n    }\n    function peg$parsetranslate() {\n        var s0, s1, s2, s3, s4, s5, s6, s7, s8;\n        s0 = peg$currPos;\n        if (input.substr(peg$currPos, 9) === peg$c3) {\n            s1 = peg$c3;\n            peg$currPos += 9;\n        } else {\n            s1 = peg$FAILED;\n            if (peg$silentFails === 0) peg$fail(peg$e3);\n        }\n        if (s1 !== peg$FAILED) {\n            s2 = [];\n            s3 = peg$parsewsp();\n            while(s3 !== peg$FAILED){\n                s2.push(s3);\n                s3 = peg$parsewsp();\n            }\n            if (input.charCodeAt(peg$currPos) === 40) {\n                s3 = peg$c1;\n                peg$currPos++;\n            } else {\n                s3 = peg$FAILED;\n                if (peg$silentFails === 0) peg$fail(peg$e1);\n            }\n            if (s3 !== peg$FAILED) {\n                s4 = [];\n                s5 = peg$parsewsp();\n                while(s5 !== peg$FAILED){\n                    s4.push(s5);\n                    s5 = peg$parsewsp();\n                }\n                s5 = peg$parsenumber();\n                if (s5 !== peg$FAILED) {\n                    s6 = peg$parsecommaWspNumber();\n                    if (s6 === peg$FAILED) s6 = null;\n                    s7 = [];\n                    s8 = peg$parsewsp();\n                    while(s8 !== peg$FAILED){\n                        s7.push(s8);\n                        s8 = peg$parsewsp();\n                    }\n                    if (input.charCodeAt(peg$currPos) === 41) {\n                        s8 = peg$c2;\n                        peg$currPos++;\n                    } else {\n                        s8 = peg$FAILED;\n                        if (peg$silentFails === 0) peg$fail(peg$e2);\n                    }\n                    if (s8 !== peg$FAILED) {\n                        peg$savedPos = s0;\n                        s0 = peg$f3(s5, s6);\n                    } else {\n                        peg$currPos = s0;\n                        s0 = peg$FAILED;\n                    }\n                } else {\n                    peg$currPos = s0;\n                    s0 = peg$FAILED;\n                }\n            } else {\n                peg$currPos = s0;\n                s0 = peg$FAILED;\n            }\n        } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n        }\n        return s0;\n    }\n    function peg$parsescale() {\n        var s0, s1, s2, s3, s4, s5, s6, s7, s8;\n        s0 = peg$currPos;\n        if (input.substr(peg$currPos, 5) === peg$c4) {\n            s1 = peg$c4;\n            peg$currPos += 5;\n        } else {\n            s1 = peg$FAILED;\n            if (peg$silentFails === 0) peg$fail(peg$e4);\n        }\n        if (s1 !== peg$FAILED) {\n            s2 = [];\n            s3 = peg$parsewsp();\n            while(s3 !== peg$FAILED){\n                s2.push(s3);\n                s3 = peg$parsewsp();\n            }\n            if (input.charCodeAt(peg$currPos) === 40) {\n                s3 = peg$c1;\n                peg$currPos++;\n            } else {\n                s3 = peg$FAILED;\n                if (peg$silentFails === 0) peg$fail(peg$e1);\n            }\n            if (s3 !== peg$FAILED) {\n                s4 = [];\n                s5 = peg$parsewsp();\n                while(s5 !== peg$FAILED){\n                    s4.push(s5);\n                    s5 = peg$parsewsp();\n                }\n                s5 = peg$parsenumber();\n                if (s5 !== peg$FAILED) {\n                    s6 = peg$parsecommaWspNumber();\n                    if (s6 === peg$FAILED) s6 = null;\n                    s7 = [];\n                    s8 = peg$parsewsp();\n                    while(s8 !== peg$FAILED){\n                        s7.push(s8);\n                        s8 = peg$parsewsp();\n                    }\n                    if (input.charCodeAt(peg$currPos) === 41) {\n                        s8 = peg$c2;\n                        peg$currPos++;\n                    } else {\n                        s8 = peg$FAILED;\n                        if (peg$silentFails === 0) peg$fail(peg$e2);\n                    }\n                    if (s8 !== peg$FAILED) {\n                        peg$savedPos = s0;\n                        s0 = peg$f4(s5, s6);\n                    } else {\n                        peg$currPos = s0;\n                        s0 = peg$FAILED;\n                    }\n                } else {\n                    peg$currPos = s0;\n                    s0 = peg$FAILED;\n                }\n            } else {\n                peg$currPos = s0;\n                s0 = peg$FAILED;\n            }\n        } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n        }\n        return s0;\n    }\n    function peg$parserotate() {\n        var s0, s1, s2, s3, s4, s5, s6, s7, s8;\n        s0 = peg$currPos;\n        if (input.substr(peg$currPos, 6) === peg$c5) {\n            s1 = peg$c5;\n            peg$currPos += 6;\n        } else {\n            s1 = peg$FAILED;\n            if (peg$silentFails === 0) peg$fail(peg$e5);\n        }\n        if (s1 !== peg$FAILED) {\n            s2 = [];\n            s3 = peg$parsewsp();\n            while(s3 !== peg$FAILED){\n                s2.push(s3);\n                s3 = peg$parsewsp();\n            }\n            if (input.charCodeAt(peg$currPos) === 40) {\n                s3 = peg$c1;\n                peg$currPos++;\n            } else {\n                s3 = peg$FAILED;\n                if (peg$silentFails === 0) peg$fail(peg$e1);\n            }\n            if (s3 !== peg$FAILED) {\n                s4 = [];\n                s5 = peg$parsewsp();\n                while(s5 !== peg$FAILED){\n                    s4.push(s5);\n                    s5 = peg$parsewsp();\n                }\n                s5 = peg$parsenumber();\n                if (s5 !== peg$FAILED) {\n                    s6 = peg$parsecommaWspTwoNumbers();\n                    if (s6 === peg$FAILED) s6 = null;\n                    s7 = [];\n                    s8 = peg$parsewsp();\n                    while(s8 !== peg$FAILED){\n                        s7.push(s8);\n                        s8 = peg$parsewsp();\n                    }\n                    if (input.charCodeAt(peg$currPos) === 41) {\n                        s8 = peg$c2;\n                        peg$currPos++;\n                    } else {\n                        s8 = peg$FAILED;\n                        if (peg$silentFails === 0) peg$fail(peg$e2);\n                    }\n                    if (s8 !== peg$FAILED) {\n                        peg$savedPos = s0;\n                        s0 = peg$f5(s5, s6);\n                    } else {\n                        peg$currPos = s0;\n                        s0 = peg$FAILED;\n                    }\n                } else {\n                    peg$currPos = s0;\n                    s0 = peg$FAILED;\n                }\n            } else {\n                peg$currPos = s0;\n                s0 = peg$FAILED;\n            }\n        } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n        }\n        return s0;\n    }\n    function peg$parseskewX() {\n        var s0, s1, s2, s3, s4, s5, s6, s7;\n        s0 = peg$currPos;\n        if (input.substr(peg$currPos, 5) === peg$c6) {\n            s1 = peg$c6;\n            peg$currPos += 5;\n        } else {\n            s1 = peg$FAILED;\n            if (peg$silentFails === 0) peg$fail(peg$e6);\n        }\n        if (s1 !== peg$FAILED) {\n            s2 = [];\n            s3 = peg$parsewsp();\n            while(s3 !== peg$FAILED){\n                s2.push(s3);\n                s3 = peg$parsewsp();\n            }\n            if (input.charCodeAt(peg$currPos) === 40) {\n                s3 = peg$c1;\n                peg$currPos++;\n            } else {\n                s3 = peg$FAILED;\n                if (peg$silentFails === 0) peg$fail(peg$e1);\n            }\n            if (s3 !== peg$FAILED) {\n                s4 = [];\n                s5 = peg$parsewsp();\n                while(s5 !== peg$FAILED){\n                    s4.push(s5);\n                    s5 = peg$parsewsp();\n                }\n                s5 = peg$parsenumber();\n                if (s5 !== peg$FAILED) {\n                    s6 = [];\n                    s7 = peg$parsewsp();\n                    while(s7 !== peg$FAILED){\n                        s6.push(s7);\n                        s7 = peg$parsewsp();\n                    }\n                    if (input.charCodeAt(peg$currPos) === 41) {\n                        s7 = peg$c2;\n                        peg$currPos++;\n                    } else {\n                        s7 = peg$FAILED;\n                        if (peg$silentFails === 0) peg$fail(peg$e2);\n                    }\n                    if (s7 !== peg$FAILED) {\n                        peg$savedPos = s0;\n                        s0 = peg$f6(s5);\n                    } else {\n                        peg$currPos = s0;\n                        s0 = peg$FAILED;\n                    }\n                } else {\n                    peg$currPos = s0;\n                    s0 = peg$FAILED;\n                }\n            } else {\n                peg$currPos = s0;\n                s0 = peg$FAILED;\n            }\n        } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n        }\n        return s0;\n    }\n    function peg$parseskewY() {\n        var s0, s1, s2, s3, s4, s5, s6, s7;\n        s0 = peg$currPos;\n        if (input.substr(peg$currPos, 5) === peg$c7) {\n            s1 = peg$c7;\n            peg$currPos += 5;\n        } else {\n            s1 = peg$FAILED;\n            if (peg$silentFails === 0) peg$fail(peg$e7);\n        }\n        if (s1 !== peg$FAILED) {\n            s2 = [];\n            s3 = peg$parsewsp();\n            while(s3 !== peg$FAILED){\n                s2.push(s3);\n                s3 = peg$parsewsp();\n            }\n            if (input.charCodeAt(peg$currPos) === 40) {\n                s3 = peg$c1;\n                peg$currPos++;\n            } else {\n                s3 = peg$FAILED;\n                if (peg$silentFails === 0) peg$fail(peg$e1);\n            }\n            if (s3 !== peg$FAILED) {\n                s4 = [];\n                s5 = peg$parsewsp();\n                while(s5 !== peg$FAILED){\n                    s4.push(s5);\n                    s5 = peg$parsewsp();\n                }\n                s5 = peg$parsenumber();\n                if (s5 !== peg$FAILED) {\n                    s6 = [];\n                    s7 = peg$parsewsp();\n                    while(s7 !== peg$FAILED){\n                        s6.push(s7);\n                        s7 = peg$parsewsp();\n                    }\n                    if (input.charCodeAt(peg$currPos) === 41) {\n                        s7 = peg$c2;\n                        peg$currPos++;\n                    } else {\n                        s7 = peg$FAILED;\n                        if (peg$silentFails === 0) peg$fail(peg$e2);\n                    }\n                    if (s7 !== peg$FAILED) {\n                        peg$savedPos = s0;\n                        s0 = peg$f7(s5);\n                    } else {\n                        peg$currPos = s0;\n                        s0 = peg$FAILED;\n                    }\n                } else {\n                    peg$currPos = s0;\n                    s0 = peg$FAILED;\n                }\n            } else {\n                peg$currPos = s0;\n                s0 = peg$FAILED;\n            }\n        } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n        }\n        return s0;\n    }\n    function peg$parsenumber() {\n        var s0, s1, s2, s3;\n        s0 = peg$currPos;\n        s1 = peg$currPos;\n        s2 = peg$parsesign();\n        if (s2 === peg$FAILED) s2 = null;\n        s3 = peg$parsefloatingPointConstant();\n        if (s3 !== peg$FAILED) {\n            s2 = [\n                s2,\n                s3\n            ];\n            s1 = s2;\n        } else {\n            peg$currPos = s1;\n            s1 = peg$FAILED;\n        }\n        if (s1 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s1 = peg$f8(s1);\n        }\n        s0 = s1;\n        if (s0 === peg$FAILED) {\n            s0 = peg$currPos;\n            s1 = peg$currPos;\n            s2 = peg$parsesign();\n            if (s2 === peg$FAILED) s2 = null;\n            s3 = peg$parseintegerConstant();\n            if (s3 !== peg$FAILED) {\n                s2 = [\n                    s2,\n                    s3\n                ];\n                s1 = s2;\n            } else {\n                peg$currPos = s1;\n                s1 = peg$FAILED;\n            }\n            if (s1 !== peg$FAILED) {\n                peg$savedPos = s0;\n                s1 = peg$f9(s1);\n            }\n            s0 = s1;\n        }\n        return s0;\n    }\n    function peg$parsecommaWspNumber() {\n        var s0, s1, s2;\n        s0 = peg$currPos;\n        s1 = peg$parsecommaWsp();\n        if (s1 !== peg$FAILED) {\n            s2 = peg$parsenumber();\n            if (s2 !== peg$FAILED) {\n                peg$savedPos = s0;\n                s0 = peg$f10(s2);\n            } else {\n                peg$currPos = s0;\n                s0 = peg$FAILED;\n            }\n        } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n        }\n        return s0;\n    }\n    function peg$parsecommaWspTwoNumbers() {\n        var s0, s1, s2, s3, s4;\n        s0 = peg$currPos;\n        s1 = peg$parsecommaWsp();\n        if (s1 !== peg$FAILED) {\n            s2 = peg$parsenumber();\n            if (s2 !== peg$FAILED) {\n                s3 = peg$parsecommaWsp();\n                if (s3 !== peg$FAILED) {\n                    s4 = peg$parsenumber();\n                    if (s4 !== peg$FAILED) {\n                        peg$savedPos = s0;\n                        s0 = peg$f11(s2, s4);\n                    } else {\n                        peg$currPos = s0;\n                        s0 = peg$FAILED;\n                    }\n                } else {\n                    peg$currPos = s0;\n                    s0 = peg$FAILED;\n                }\n            } else {\n                peg$currPos = s0;\n                s0 = peg$FAILED;\n            }\n        } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n        }\n        return s0;\n    }\n    function peg$parsecommaWsp() {\n        var s0, s1, s2, s3, s4;\n        s0 = peg$currPos;\n        s1 = [];\n        s2 = peg$parsewsp();\n        if (s2 !== peg$FAILED) while(s2 !== peg$FAILED){\n            s1.push(s2);\n            s2 = peg$parsewsp();\n        }\n        else s1 = peg$FAILED;\n        if (s1 !== peg$FAILED) {\n            s2 = peg$parsecomma();\n            if (s2 === peg$FAILED) s2 = null;\n            s3 = [];\n            s4 = peg$parsewsp();\n            while(s4 !== peg$FAILED){\n                s3.push(s4);\n                s4 = peg$parsewsp();\n            }\n            s1 = [\n                s1,\n                s2,\n                s3\n            ];\n            s0 = s1;\n        } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n        }\n        if (s0 === peg$FAILED) {\n            s0 = peg$currPos;\n            s1 = peg$parsecomma();\n            if (s1 !== peg$FAILED) {\n                s2 = [];\n                s3 = peg$parsewsp();\n                while(s3 !== peg$FAILED){\n                    s2.push(s3);\n                    s3 = peg$parsewsp();\n                }\n                s1 = [\n                    s1,\n                    s2\n                ];\n                s0 = s1;\n            } else {\n                peg$currPos = s0;\n                s0 = peg$FAILED;\n            }\n        }\n        return s0;\n    }\n    function peg$parsecomma() {\n        var s0;\n        if (input.charCodeAt(peg$currPos) === 44) {\n            s0 = peg$c8;\n            peg$currPos++;\n        } else {\n            s0 = peg$FAILED;\n            if (peg$silentFails === 0) peg$fail(peg$e8);\n        }\n        return s0;\n    }\n    function peg$parseintegerConstant() {\n        var s0, s1;\n        s0 = peg$currPos;\n        s1 = peg$parsedigitSequence();\n        if (s1 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s1 = peg$f12(s1);\n        }\n        s0 = s1;\n        return s0;\n    }\n    function peg$parsefloatingPointConstant() {\n        var s0, s1, s2;\n        s0 = peg$currPos;\n        s1 = peg$parsefractionalConstant();\n        if (s1 !== peg$FAILED) {\n            s2 = peg$parseexponent();\n            if (s2 === peg$FAILED) s2 = null;\n            peg$savedPos = s0;\n            s0 = peg$f13(s1, s2);\n        } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n        }\n        if (s0 === peg$FAILED) {\n            s0 = peg$currPos;\n            s1 = peg$parsedigitSequence();\n            if (s1 !== peg$FAILED) {\n                s2 = peg$parseexponent();\n                if (s2 !== peg$FAILED) {\n                    peg$savedPos = s0;\n                    s0 = peg$f14(s1, s2);\n                } else {\n                    peg$currPos = s0;\n                    s0 = peg$FAILED;\n                }\n            } else {\n                peg$currPos = s0;\n                s0 = peg$FAILED;\n            }\n        }\n        return s0;\n    }\n    function peg$parsefractionalConstant() {\n        var s0, s1, s2, s3;\n        peg$silentFails++;\n        s0 = peg$currPos;\n        s1 = peg$parsedigitSequence();\n        if (s1 === peg$FAILED) s1 = null;\n        if (input.charCodeAt(peg$currPos) === 46) {\n            s2 = peg$c9;\n            peg$currPos++;\n        } else {\n            s2 = peg$FAILED;\n            if (peg$silentFails === 0) peg$fail(peg$e10);\n        }\n        if (s2 !== peg$FAILED) {\n            s3 = peg$parsedigitSequence();\n            if (s3 !== peg$FAILED) {\n                peg$savedPos = s0;\n                s0 = peg$f15(s1, s3);\n            } else {\n                peg$currPos = s0;\n                s0 = peg$FAILED;\n            }\n        } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n        }\n        if (s0 === peg$FAILED) {\n            s0 = peg$currPos;\n            s1 = peg$parsedigitSequence();\n            if (s1 !== peg$FAILED) {\n                if (input.charCodeAt(peg$currPos) === 46) {\n                    s2 = peg$c9;\n                    peg$currPos++;\n                } else {\n                    s2 = peg$FAILED;\n                    if (peg$silentFails === 0) peg$fail(peg$e10);\n                }\n                if (s2 !== peg$FAILED) {\n                    peg$savedPos = s0;\n                    s0 = peg$f16(s1);\n                } else {\n                    peg$currPos = s0;\n                    s0 = peg$FAILED;\n                }\n            } else {\n                peg$currPos = s0;\n                s0 = peg$FAILED;\n            }\n        }\n        peg$silentFails--;\n        if (s0 === peg$FAILED) {\n            s1 = peg$FAILED;\n            if (peg$silentFails === 0) peg$fail(peg$e9);\n        }\n        return s0;\n    }\n    function peg$parseexponent() {\n        var s0, s1, s2, s3;\n        s0 = peg$currPos;\n        if (peg$r0.test(input.charAt(peg$currPos))) {\n            s1 = input.charAt(peg$currPos);\n            peg$currPos++;\n        } else {\n            s1 = peg$FAILED;\n            if (peg$silentFails === 0) peg$fail(peg$e11);\n        }\n        if (s1 !== peg$FAILED) {\n            s2 = peg$parsesign();\n            if (s2 === peg$FAILED) s2 = null;\n            s3 = peg$parsedigitSequence();\n            if (s3 !== peg$FAILED) {\n                peg$savedPos = s0;\n                s0 = peg$f17(s2, s3);\n            } else {\n                peg$currPos = s0;\n                s0 = peg$FAILED;\n            }\n        } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n        }\n        return s0;\n    }\n    function peg$parsesign() {\n        var s0;\n        if (peg$r1.test(input.charAt(peg$currPos))) {\n            s0 = input.charAt(peg$currPos);\n            peg$currPos++;\n        } else {\n            s0 = peg$FAILED;\n            if (peg$silentFails === 0) peg$fail(peg$e12);\n        }\n        return s0;\n    }\n    function peg$parsedigitSequence() {\n        var s0, s1;\n        s0 = [];\n        s1 = peg$parsedigit();\n        if (s1 !== peg$FAILED) while(s1 !== peg$FAILED){\n            s0.push(s1);\n            s1 = peg$parsedigit();\n        }\n        else s0 = peg$FAILED;\n        return s0;\n    }\n    function peg$parsedigit() {\n        var s0;\n        if (peg$r2.test(input.charAt(peg$currPos))) {\n            s0 = input.charAt(peg$currPos);\n            peg$currPos++;\n        } else {\n            s0 = peg$FAILED;\n            if (peg$silentFails === 0) peg$fail(peg$e13);\n        }\n        return s0;\n    }\n    function peg$parsewsp() {\n        var s0;\n        if (peg$r3.test(input.charAt(peg$currPos))) {\n            s0 = input.charAt(peg$currPos);\n            peg$currPos++;\n        } else {\n            s0 = peg$FAILED;\n            if (peg$silentFails === 0) peg$fail(peg$e14);\n        }\n        return s0;\n    }\n    peg$result = peg$startRuleFunction();\n    if (peg$result !== peg$FAILED && peg$currPos === input.length) return peg$result;\n    else {\n        if (peg$result !== peg$FAILED && peg$currPos < input.length) peg$fail(peg$endExpectation());\n        throw peg$buildStructuredError(peg$maxFailExpected, peg$maxFailPos < input.length ? input.charAt(peg$maxFailPos) : null, peg$maxFailPos < input.length ? peg$computeLocation(peg$maxFailPos, peg$maxFailPos + 1) : peg$computeLocation(peg$maxFailPos, peg$maxFailPos));\n    }\n}\n\n\nfunction $b513f9bb54aec525$export$dd451a2a4984e188(transformString) {\n    return (0, $2c16fa132dd43ca2$export$98e6a39c04603d36)(transformString);\n}\n\n\n\n\nfunction $9048946b52312c93$export$34daa7fcbfeb2849(matrix, flipX = false, flipY = false) {\n    // Remove flip from the matrix first - flip could be incorrectly interpreted as\n    // rotations (e.g. flipX + flipY = rotate by 180 degrees).\n    // Note flipX is a vertical flip, and flipY is a horizontal flip.\n    if (flipX) {\n        if (flipY) matrix = (0, $611d5fdbbcda65d9$export$f672e0b6f7222cd7)(matrix, (0, $a78c550eaaca7cca$export$dcdf75081b88279d)(-1, -1));\n        else matrix = (0, $611d5fdbbcda65d9$export$f672e0b6f7222cd7)(matrix, (0, $a78c550eaaca7cca$export$dcdf75081b88279d)(1, -1));\n    } else if (flipY) matrix = (0, $611d5fdbbcda65d9$export$f672e0b6f7222cd7)(matrix, (0, $a78c550eaaca7cca$export$dcdf75081b88279d)(-1, 1));\n    const a = matrix.a;\n    const b = matrix.b;\n    const c = matrix.c;\n    const d = matrix.d;\n    let scaleX, scaleY, rotation;\n    if (a !== 0 || c !== 0) {\n        const hypotAc = Math.hypot(a, c);\n        scaleX = hypotAc;\n        scaleY = (a * d - b * c) / hypotAc;\n        const acos = Math.acos(a / hypotAc);\n        rotation = c > 0 ? -acos : acos;\n    } else if (b !== 0 || d !== 0) {\n        const hypotBd = Math.hypot(b, d);\n        scaleX = (a * d - b * c) / hypotBd;\n        scaleY = hypotBd;\n        const acos = Math.acos(b / hypotBd);\n        rotation = Math.PI / 2 + (d > 0 ? -acos : acos);\n    } else {\n        scaleX = 0;\n        scaleY = 0;\n        rotation = 0;\n    }\n    // put the flip factors back\n    if (flipY) scaleX = -scaleX;\n    if (flipX) scaleY = -scaleY;\n    return {\n        translate: {\n            tx: matrix.e,\n            ty: matrix.f\n        },\n        scale: {\n            sx: scaleX,\n            sy: scaleY\n        },\n        rotation: {\n            angle: rotation\n        }\n    };\n}\n\n\n/**\n * Tranformation matrix that mirrors on x-axis\n * @returns {Matrix} Affine Matrix\n */ function $c5e3ac5094d89f40$export$9ffbcc0b36390a8f() {\n    return {\n        a: 1,\n        c: 0,\n        e: 0,\n        b: 0,\n        d: -1,\n        f: 0\n    };\n}\nfunction $c5e3ac5094d89f40$export$13e88519d622f890() {\n    return {\n        a: -1,\n        c: 0,\n        e: 0,\n        b: 0,\n        d: 1,\n        f: 0\n    };\n}\nfunction $c5e3ac5094d89f40$export$8817f89b5790665a() {\n    return {\n        a: -1,\n        c: 0,\n        e: 0,\n        b: 0,\n        d: -1,\n        f: 0\n    };\n}\n\n\n\n\n\n\n\nfunction $c3d40be9971a56b4$export$91619259a15f04b8(startingPoint, endingPoint) {\n    const tx = endingPoint.x - startingPoint.x;\n    const ty = endingPoint.y - startingPoint.y;\n    return (0, $cf0617f9860dc277$export$d73ee8ef04f5226a)(tx, ty);\n}\nfunction $c3d40be9971a56b4$export$87d7516aee2dd9d9(startingPoint1, startingPoint2, endingPoint1, endingPoint2) {\n    // finds translation\n    const translationMatrix = $c3d40be9971a56b4$export$91619259a15f04b8(startingPoint1, endingPoint1);\n    const pointA = (0, $855520c81dfcb96a$export$9b20165a36586806)(translationMatrix, startingPoint2) // I have to translate this point\n    ;\n    const center = endingPoint1;\n    const pointB = endingPoint2;\n    // finds rotation matrix\n    const angle = Math.atan2(pointB.y - center.y, pointB.x - center.x) - Math.atan2(pointA.y - center.y, pointA.x - center.x);\n    const rotationMatrix = (0, $20520e5c69c4ad5d$export$bb628a54ab399bc9)(angle, center.x, center.y);\n    // finds scale matrix\n    const d1 = Math.sqrt(Math.pow(pointA.x - center.x, 2) + Math.pow(pointA.y - center.y, 2));\n    const d2 = Math.sqrt(Math.pow(pointB.x - center.x, 2) + Math.pow(pointB.y - center.y, 2));\n    const scalingLevel = d2 / d1;\n    const scalingMatrix = (0, $a78c550eaaca7cca$export$dcdf75081b88279d)(scalingLevel, scalingLevel, center.x, center.y);\n    return (0, $611d5fdbbcda65d9$export$f672e0b6f7222cd7)([\n        translationMatrix,\n        scalingMatrix,\n        rotationMatrix\n    ]);\n}\n\n\n\n\n\nfunction $a8ca0a6a49a8f94f$export$d562d1c5145f86d0(transform) {\n    const scaleX = \"scale\" in transform ? transform.scale : transform.scaleX;\n    const scaleY = \"scale\" in transform ? transform.scale : transform.scaleY;\n    return (0, $611d5fdbbcda65d9$export$f672e0b6f7222cd7)((0, $cf0617f9860dc277$export$d73ee8ef04f5226a)(transform.x, transform.y), (0, $20520e5c69c4ad5d$export$bb628a54ab399bc9)(transform.angleDeg / 180 * Math.PI), (0, $a78c550eaaca7cca$export$dcdf75081b88279d)(scaleX, scaleY));\n}\n\n\nfunction $0ca7fca685ce788f$var$fixScale(scale, pixels) {\n    return Math.round(pixels * scale) / pixels;\n}\nclass $0ca7fca685ce788f$export$a140ed60c2ca052c {\n    render() {\n        const isDark = (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark();\n        const transform = {\n            ...this.transform,\n            x: this.transform.x,\n            y: this.transform.y,\n            scale: this.transform.scale\n        };\n        if (this.doResize) {\n            this.doResize = false;\n            this.resFactor = this.useNativeResolution ? devicePixelRatio : 1;\n            this.canvas.width = Math.round(this.width * this.resFactor);\n            this.canvas.height = Math.round(this.height * this.resFactor);\n        }\n        const renderedTransform = {\n            x: Math.round(transform.x),\n            y: Math.round(transform.y),\n            scaleX: $0ca7fca685ce788f$var$fixScale(transform.scale, this.project.width),\n            scaleY: $0ca7fca685ce788f$var$fixScale(transform.scale, this.project.height),\n            angleDeg: transform.angleDeg\n        };\n        const renderedMat = (0, $a8ca0a6a49a8f94f$export$d562d1c5145f86d0)(renderedTransform);\n        this.ctx.save();\n        this.ctx.imageSmoothingEnabled = false;\n        if (this.drawBackground) {\n            this.ctx.fillStyle = isDark ? \"rgb(33, 33, 33)\" : \"rgb(158,158,158)\";\n            this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n        } else {\n            this.ctx.fillStyle = this.pattern;\n            this.ctx.fillRect(0, 0, this.width, this.height);\n        }\n        // this.ctx.scale(this.resFactor, this.resFactor);\n        this.ctx.translate(renderedTransform.x, renderedTransform.y);\n        this.ctx.scale(renderedTransform.scaleX, renderedTransform.scaleY);\n        this.ctx.rotate(renderedTransform.angleDeg / 180 * Math.PI);\n        if (this.drawBackground) {\n            this.ctx.save();\n            this.ctx.fillStyle = (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark() ? \"rgba(255,255,255,0.25)\" : \"rgba(0,0,0,0.2)\";\n            const scaledPixelX = 1 / renderedTransform.scaleX;\n            const scaledPixelY = 1 / renderedTransform.scaleY;\n            this.ctx.fillRect(-scaledPixelX, -scaledPixelY, this.project.width + scaledPixelX * 2, this.project.height + scaledPixelY * 2);\n            this.ctx.fillStyle = this.pattern;\n            this.pattern.setTransform((0, $077740f52fe6870e$export$70ae2c07e401031b)(renderedMat));\n            this.ctx.fillRect(0, 0, this.project.width, this.project.height);\n            this.ctx.restore();\n        }\n        this.project.layers.forEach((layer)=>{\n            if (!layer.isVisible || !layer.opacity) return;\n            this.ctx.save();\n            this.ctx.globalCompositeOperation = layer.mixModeStr;\n            this.ctx.globalAlpha = layer.opacity;\n            let image = {};\n            if (typeof layer.image === \"function\") {\n                const res = layer.image(renderedTransform, this.canvas.width, this.canvas.height);\n                if (\"image\" in res && \"transform\" in res) {\n                    image = res.image;\n                    this.ctx.setTransform((0, $611d5fdbbcda65d9$export$f672e0b6f7222cd7)(renderedMat, res.transform));\n                } else image = res;\n            } else image = layer.image;\n            this.ctx.drawImage(image, 0, 0); // , this.project.width, this.project.height);\n            this.ctx.restore();\n        });\n        this.ctx.restore();\n    }\n    setSize(width, height) {\n        this.doResize = true;\n        this.width = width;\n        this.height = height;\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.canvas, {\n            width: this.doFillParent ? \"100%\" : this.width + \"px\",\n            height: this.doFillParent ? \"100%\" : this.height + \"px\"\n        });\n    }\n    setTransform(transform) {\n        this.transform = {\n            ...transform\n        };\n    }\n    getTransform() {\n        return {\n            ...this.transform\n        };\n    }\n    setUseNativeResolution(b) {\n        this.useNativeResolution = b;\n        this.doResize = true;\n    }\n    getUseNativeResolution() {\n        return this.useNativeResolution;\n    }\n    getElement() {\n        return this.canvas;\n    }\n    destroy() {\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).freeCanvas(this.canvas);\n        (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).removeIsDarkListener(this.onIsDark);\n        window.removeEventListener(\"resize\", this.resizeListener);\n    }\n    // ---- public ----\n    constructor(p){\n        this.doResize = true;\n        this.onIsDark = ()=>{\n            this.pattern = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.ctx.createPattern((0, $d9f9f4926aa80a1c$export$921068d8846a1559).createCheckerCanvas(10, (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark()), \"repeat\"));\n            this.render();\n        };\n        this.oldDPR = devicePixelRatio;\n        this.resizeListener = ()=>{\n            if (devicePixelRatio !== this.oldDPR) {\n                this.canvas.style.imageRendering = Math.round(devicePixelRatio) !== devicePixelRatio ? \"\" : \"pixelated\";\n                this.oldDPR = devicePixelRatio;\n            }\n        };\n        this.width = p.width;\n        this.height = p.height;\n        this.project = p.project;\n        this.useNativeResolution = !!p.useNativeResolution;\n        this.drawBackground = !!p.drawBackground;\n        this.doFillParent = !!p.fillParent;\n        this.transform = {\n            ...p.transform\n        };\n        this.resFactor = this.useNativeResolution ? devicePixelRatio : 1;\n        this.canvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(this.width * this.resFactor, this.height * this.resFactor);\n        this.ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.canvas);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.canvas, {\n            width: this.doFillParent ? \"100%\" : this.width + \"px\",\n            height: this.doFillParent ? \"100%\" : this.height + \"px\",\n            imageRendering: Math.round(devicePixelRatio) !== devicePixelRatio ? undefined : \"pixelated\",\n            display: \"block\"\n        });\n        window.addEventListener(\"resize\", this.resizeListener);\n        this.pattern = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.ctx.createPattern((0, $d9f9f4926aa80a1c$export$921068d8846a1559).createCheckerCanvas(10, (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark()), \"repeat\"));\n        (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).addIsDarkListener(this.onIsDark);\n    // this.render();\n    }\n}\n\n\n\n\nvar $28619fc623d210a6$exports = {};\n\n$28619fc623d210a6$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"tool-zoom-in.d413f042.svg\";\n\n\nvar $eb15d36c7e085410$exports = {};\n\n$eb15d36c7e085410$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"tool-zoom-out.299f4d1f.svg\";\n\n\nvar $038147589e0b18d4$exports = {};\n\n$038147589e0b18d4$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"viewport-reset.25476ab5.svg\";\n\n\nvar $acb9aa66d548f601$exports = {};\n\n$acb9aa66d548f601$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"tool-hand.e7fc81b9.svg\";\n\n\nvar $0c94c5abf484f496$exports = {};\n\n$0c94c5abf484f496$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"edit-pencil.d7636d97.svg\";\n\n\n\n\n\n\nfunction $b18d1bd8e7aad78b$export$8c03162b1a39d183(oldScale, stepNum) {\n    const step = Math.log2(oldScale);\n    let newStep = step / Math.abs(stepNum);\n    newStep += stepNum > 0 ? 1 : -1;\n    newStep = Math.round(newStep);\n    newStep *= Math.abs(stepNum);\n    return Math.pow(2, newStep);\n}\n\n\n\n\n\n\nfunction $9ed053ee5aed84fa$export$99c68a89351e15c0(viewportPoint, canvasPoint, scale, angleDeg) {\n    const mat = (0, $611d5fdbbcda65d9$export$f672e0b6f7222cd7)((0, $a78c550eaaca7cca$export$dcdf75081b88279d)(-scale, -scale), (0, $20520e5c69c4ad5d$export$bb628a54ab399bc9)(angleDeg / 180 * Math.PI));\n    const topLeftP = (0, $855520c81dfcb96a$export$9b20165a36586806)(mat, canvasPoint);\n    topLeftP.x += viewportPoint.x;\n    topLeftP.y += viewportPoint.y;\n    return {\n        x: topLeftP.x,\n        y: topLeftP.y,\n        scale: scale,\n        angleDeg: angleDeg\n    };\n}\n\n\n\n\nfunction $87cc58581059531b$export$935bc53f7df03c95(transform, viewportP) {\n    const m = (0, $a8ca0a6a49a8f94f$export$d562d1c5145f86d0)(transform);\n    const canvasP = (0, $855520c81dfcb96a$export$9b20165a36586806)((0, $077740f52fe6870e$export$70ae2c07e401031b)(m), viewportP);\n    return {\n        viewportP: viewportP,\n        canvasP: canvasP,\n        scale: transform.scale,\n        angleDeg: transform.angleDeg\n    };\n}\n\n\n\nconst $324add89932145ee$var$DEFAULT_PADDING = 10;\nclass $324add89932145ee$export$133773870222880f {\n    requestRerender() {\n        this.doRender = true;\n    }\n    resetOrZoom(x, y) {\n        if (this.isReset) {\n            this.isReset = false;\n            const canvasP = (0, $855520c81dfcb96a$export$9b20165a36586806)((0, $077740f52fe6870e$export$70ae2c07e401031b)((0, $a8ca0a6a49a8f94f$export$d562d1c5145f86d0)(this.viewport.getTransform())), {\n                x: x,\n                y: y\n            });\n            this.viewport.setTransform((0, $9ed053ee5aed84fa$export$99c68a89351e15c0)({\n                x: this.width / 2,\n                y: this.height / 2\n            }, canvasP, 1, 0));\n            this.requestRerender();\n        } else this.reset();\n    }\n    reset() {\n        const fit = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).fitInto(this.project.width, this.project.height, this.width - this.padding * 2, this.height - this.padding * 2);\n        const scale = fit.width / this.project.width;\n        this.viewport.setTransform((0, $9ed053ee5aed84fa$export$99c68a89351e15c0)({\n            x: this.width / 2,\n            y: this.height / 2\n        }, {\n            x: this.project.width / 2,\n            y: this.project.height / 2\n        }, scale, 0));\n        this.isReset = true;\n        this.requestRerender();\n    }\n    transformCanvas(t) {\n        if (t.type === \"translate\") {\n            const old = this.viewport.getTransform();\n            if (t.x === 0 && t.y === 0) return;\n            this.viewport.setTransform({\n                ...old,\n                x: old.x + t.x,\n                y: old.y + t.y\n            });\n        } else if (t.type === \"zoom\") {\n            const old = this.viewport.getTransform();\n            const viewportRect = this.viewport.getElement().getBoundingClientRect();\n            var _t_vX;\n            t.vX = (_t_vX = t.vX) !== null && _t_vX !== void 0 ? _t_vX : viewportRect.width / 2;\n            var _t_vY;\n            t.vY = (_t_vY = t.vY) !== null && _t_vY !== void 0 ? _t_vY : viewportRect.height / 2;\n            const metaTransform = (0, $87cc58581059531b$export$935bc53f7df03c95)(old, {\n                x: t.vX,\n                y: t.vY\n            });\n            metaTransform.scale *= t.fac;\n            this.viewport.setTransform((0, $9ed053ee5aed84fa$export$99c68a89351e15c0)(metaTransform.viewportP, metaTransform.canvasP, metaTransform.scale, metaTransform.angleDeg));\n        }\n        this.isReset = false;\n        this.requestRerender();\n    }\n    render() {\n        this.requestRerender();\n    }\n    setTransform(transform) {\n        this.viewport.setTransform(transform);\n        this.requestRerender();\n        this.isReset = false;\n    }\n    getTransform() {\n        return this.viewport.getTransform();\n    }\n    onPointer(event) {\n        this.pointerChain.chainIn(event);\n    }\n    getElement() {\n        return this.rootEl;\n    }\n    destroy() {\n        this.animationFrameId !== undefined && cancelAnimationFrame(this.animationFrameId);\n        this.viewport.destroy();\n        this.viewportPointerListener.destroy();\n        this.rootEl.remove();\n        this.modeToggle && this.modeToggle.destroy();\n    }\n    // ---- public ----\n    constructor(p){\n        this.isReset = true;\n        this.doRender = false;\n        this.lastEmittedTransform = {\n            x: 0,\n            y: 0,\n            scale: 0,\n            angleDeg: 0\n        };\n        this.renderLoop = ()=>{\n            this.animationFrameId = requestAnimationFrame(this.renderLoop);\n            if (this.doRender) {\n                this.doRender = false;\n                this.viewport.render();\n                const viewportTransform = this.viewport.getTransform();\n                if (this.onTransformChange && JSON.stringify(this.lastEmittedTransform) !== JSON.stringify(viewportTransform)) {\n                    this.onTransformChange(viewportTransform);\n                    this.lastEmittedTransform = viewportTransform;\n                }\n            }\n        };\n        this.onWheel = (e)=>{\n            const viewportRect = this.viewport.getElement().getBoundingClientRect();\n            const vX = e.pageX - viewportRect.x;\n            const vY = e.pageY - viewportRect.y;\n            const oldScale = this.viewport.getTransform().scale;\n            const newScale = (0, $b18d1bd8e7aad78b$export$8c03162b1a39d183)(oldScale, -e.deltaY / 2);\n            this.transformCanvas({\n                type: \"zoom\",\n                vX: vX,\n                vY: vY,\n                fac: newScale / oldScale\n            });\n        };\n        this.width = p.width;\n        this.height = p.height;\n        this.project = p.project;\n        this.onTransformChange = p.onTransformChange;\n        var _p_padding;\n        this.padding = (_p_padding = p.padding) !== null && _p_padding !== void 0 ? _p_padding : $324add89932145ee$var$DEFAULT_PADDING;\n        const fit = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).fitInto(this.project.width, this.project.height, this.width - this.padding * 2, this.height - this.padding * 2);\n        const scale = fit.width / this.project.width;\n        this.viewport = new (0, $0ca7fca685ce788f$export$a140ed60c2ca052c)({\n            width: this.width,\n            height: this.height,\n            transform: (0, $9ed053ee5aed84fa$export$99c68a89351e15c0)({\n                x: this.width / 2,\n                y: this.height / 2\n            }, {\n                x: this.project.width / 2,\n                y: this.project.height / 2\n            }, scale, 0),\n            project: this.project,\n            useNativeResolution: false,\n            drawBackground: true\n        });\n        const doubleTapper = new (0, $afe05ecd8ae7f4be$export$db3963a21c01d803)({\n            onDoubleTap: (e)=>{\n                const m = (0, $a8ca0a6a49a8f94f$export$d562d1c5145f86d0)(this.viewport.getTransform());\n                const tl = (0, $855520c81dfcb96a$export$9b20165a36586806)(m, {\n                    x: 0,\n                    y: 0\n                });\n                const br = (0, $855520c81dfcb96a$export$9b20165a36586806)(m, {\n                    x: this.project.width,\n                    y: this.project.height\n                });\n                const isInside = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).isInsideRect({\n                    x: e.relX,\n                    y: e.relY\n                }, {\n                    x: tl.x,\n                    y: tl.y,\n                    width: br.x - tl.x,\n                    height: br.y - tl.y\n                });\n                if (!this.isReset || isInside) this.resetOrZoom(e.relX, e.relY);\n            },\n            isInstant: true\n        });\n        let oldTransform = undefined;\n        const pinchZoomer = new (0, $5ba93bbe34fd1582$export$d62358ac2d82abb3)({\n            onPinch: (e)=>{\n                if (e.type === \"move\") {\n                    if (!oldTransform) oldTransform = this.viewport.getTransform();\n                    const metaTransform = (0, $87cc58581059531b$export$935bc53f7df03c95)(oldTransform, {\n                        x: e.downRelX,\n                        y: e.downRelY\n                    });\n                    metaTransform.scale *= e.scale;\n                    metaTransform.viewportP.x += e.relX - e.downRelX;\n                    metaTransform.viewportP.y += e.relY - e.downRelY;\n                    this.viewport.setTransform((0, $9ed053ee5aed84fa$export$99c68a89351e15c0)(metaTransform.viewportP, metaTransform.canvasP, metaTransform.scale, metaTransform.angleDeg));\n                    this.requestRerender();\n                    this.isReset = false;\n                } else if (e.type === \"end\") oldTransform = undefined;\n            }\n        });\n        this.pointerChain = new (0, $3c485cff20ed4548$export$649a211db9812745)({\n            chainArr: [\n                pinchZoomer,\n                doubleTapper\n            ]\n        });\n        this.pointerChain.setChainOut((e)=>{\n            if (e.button && [\n                \"left\",\n                \"middle\"\n            ].includes(e.button)) // debugOut(JSON.stringify(e));\n            this.transformCanvas({\n                type: \"translate\",\n                x: e.dX,\n                y: e.dY\n            });\n        });\n        this.viewport.getElement().classList.add((0, $c072f29bb0ad2433$export$dbf350e5966cf602)({\n            cursor: \"grab\",\n            \":active\": {\n                cursor: \"grabbing\"\n            }\n        }));\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.viewport.getElement(), {\n            userSelect: \"none\",\n            touchAction: \"none\"\n        });\n        this.viewport.getElement().addEventListener(\"touchend\", (e)=>{\n            e.preventDefault();\n            return false;\n        });\n        this.viewport.getElement().addEventListener(\"contextmenu\", (e)=>{\n            e.preventDefault();\n            return false;\n        });\n        this.viewport.getElement().addEventListener(\"dragstart\", (e)=>{\n            e.preventDefault();\n            return false;\n        });\n        this.viewportPointerListener = new (0, $a07742141701d1f2$export$9371bd96776f4e82)({\n            target: this.viewport.getElement(),\n            onPointer: (e)=>{\n                this.pointerChain.chainIn(e);\n            },\n            onWheel: this.onWheel,\n            maxPointers: 2\n        });\n        this.viewport.getElement().addEventListener(\"wheel\", (e)=>{\n            e.preventDefault();\n        });\n        if (p.hasEditMode) this.modeToggle = new (0, $1166276dc18d3ea9$export$c019608e5b5bb4cb)({\n            optionArr: [\n                \"edit\",\n                \"hand\"\n            ].map((id)=>{\n                var _p_editIcon;\n                const el = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    className: \"dark-invert\",\n                    css: {\n                        width: \"28px\",\n                        height: \"28px\",\n                        backgroundSize: \"contain\",\n                        margin: \"5px\",\n                        backgroundImage: `url(${id === \"edit\" ? (_p_editIcon = p.editIcon) !== null && _p_editIcon !== void 0 ? _p_editIcon : (0, (/*@__PURE__*/$parcel$interopDefault($0c94c5abf484f496$exports))) : (0, (/*@__PURE__*/$parcel$interopDefault($acb9aa66d548f601$exports)))})`,\n                        backgroundPosition: \"center\",\n                        backgroundRepeat: \"no-repeat\"\n                    }\n                });\n                return {\n                    id: id,\n                    label: el,\n                    title: id === \"edit\" ? (0, $63d0b335c576c718$export$ce37e184d908d785)(\"tab-edit\") : (0, $63d0b335c576c718$export$ce37e184d908d785)(\"tool-hand\")\n                };\n            }),\n            initId: \"edit\",\n            onChange: (val)=>{\n                p.onModeChange && p.onModeChange(val);\n            }\n        });\n        const elCss = (0, $c072f29bb0ad2433$export$dbf350e5966cf602)(p.hasBorder === false ? {} : {\n            borderTop: \"1px solid #7f7f7f\",\n            borderBottom: \"1px solid #7f7f7f\",\n            \".kl-theme-dark &\": {\n                borderTop: \"1px solid #636363\",\n                borderBottom: \"1px solid #636363\"\n            }\n        });\n        // pointer-events: auto - So the canvas can be ignored, while the buttons still work.\n        this.rootEl = (0, $934e5f47c3374e21$export$db3b6bfb95261072)({\n            className: elCss,\n            css: {\n                position: \"relative\"\n            }\n        }, [\n            this.viewport.getElement(),\n            ...this.modeToggle ? [\n                (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\",pos-absolute,left-5,top-5,z-1,pointer-auto\", [\n                    this.modeToggle.getElement()\n                ])\n            ] : [],\n            (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\",pos-absolute,right-5,bottom-5,flex,flexCol,gap-5,z-1,pointer-auto\", [\n                (0, $934e5f47c3374e21$export$db3b6bfb95261072)({\n                    tagName: \"button\",\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"hand-reset\"),\n                    onClick: ()=>{\n                        this.reset();\n                    },\n                    content: `<img alt=\"reset\" height=\"20\" src=\"${(0, (/*@__PURE__*/$parcel$interopDefault($038147589e0b18d4$exports)))}\">`,\n                    noRef: true\n                }),\n                (0, $934e5f47c3374e21$export$db3b6bfb95261072)({\n                    tagName: \"button\",\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"zoom-in\"),\n                    onClick: ()=>{\n                        const oldScale = this.viewport.getTransform().scale;\n                        const newScale = (0, $b18d1bd8e7aad78b$export$8c03162b1a39d183)(oldScale, 1);\n                        this.transformCanvas({\n                            type: \"zoom\",\n                            fac: newScale / oldScale\n                        });\n                    },\n                    content: `<img alt=\"zoom-in\" height=\"20\" src=\"${(0, (/*@__PURE__*/$parcel$interopDefault($28619fc623d210a6$exports)))}\">`,\n                    noRef: true\n                }),\n                (0, $934e5f47c3374e21$export$db3b6bfb95261072)({\n                    tagName: \"button\",\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"zoom-out\"),\n                    onClick: ()=>{\n                        const oldScale = this.viewport.getTransform().scale;\n                        const newScale = (0, $b18d1bd8e7aad78b$export$8c03162b1a39d183)(oldScale, -1);\n                        this.transformCanvas({\n                            type: \"zoom\",\n                            fac: newScale / oldScale\n                        });\n                    },\n                    content: `<img alt=\"zoom-out\" height=\"20\" src=\"${(0, (/*@__PURE__*/$parcel$interopDefault($eb15d36c7e085410$exports)))}\">`,\n                    noRef: true\n                })\n            ])\n        ]);\n        this.renderLoop();\n    }\n}\n\n\n\n\n\n\nvar $15f04c4a93604cc0$exports = {};\n\n$15f04c4a93604cc0$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"edit-crop.16c534dd.svg\";\n\n\n\n\nclass $c5a9090dbc3ef918$export$40175a5948a88a57 {\n    resetCrop() {\n        this.crop = {\n            x: 0,\n            y: 0,\n            width: this.canvas.width,\n            height: this.canvas.height\n        };\n    }\n    getViewportSelectionRect() {\n        const transform = this.preview.getTransform();\n        const mat = (0, $a8ca0a6a49a8f94f$export$d562d1c5145f86d0)(transform);\n        const p = (0, $855520c81dfcb96a$export$9b20165a36586806)(mat, this.crop);\n        return {\n            x: p.x,\n            y: p.y,\n            width: this.crop.width * transform.scale,\n            height: this.crop.height * transform.scale\n        };\n    }\n    updateCroppedCanvas() {\n        this.croppedCanvas.width = Math.round(this.crop.width);\n        this.croppedCanvas.height = Math.round(this.crop.height);\n        const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.croppedCanvas);\n        ctx.drawImage(this.canvas, Math.round(-this.crop.x), Math.round(-this.crop.y));\n        if (this.croppedImage) this.croppedImage.src = this.croppedCanvas.toDataURL(\"image/png\");\n        this.onChange && this.onChange(this.croppedCanvas.width, this.croppedCanvas.height);\n    }\n    updateSelectionRect() {\n        const rect = this.getViewportSelectionRect();\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.selectionRectEl, {\n            left: rect.x + \"px\",\n            top: rect.y + \"px\",\n            width: rect.width + \"px\",\n            height: rect.height + \"px\",\n            display: this.isReset() ? \"none\" : \"\"\n        });\n        this.onChange && this.onChange(Math.round(this.crop.width), Math.round(this.crop.height));\n    }\n    // ---- interface ----\n    getEl() {\n        return this.rootEl;\n    }\n    reset() {\n        this.resetCrop();\n        this.updateCroppedCanvas();\n        this.updateSelectionRect();\n    }\n    destroy() {\n        this.rootEl.remove();\n        this.eventTarget.style.removeProperty(\"width\");\n        this.eventTarget.style.removeProperty(\"height\");\n        this.keyListener.destroy();\n        this.pointerListener.destroy();\n        this.preview.destroy();\n    }\n    isReset() {\n        return this.crop.x === 0 && this.crop.y === 0 && this.crop.width === this.canvas.width && this.crop.height === this.canvas.height;\n    }\n    getRect() {\n        return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(this.crop);\n    }\n    getCroppedCanvas() {\n        return this.croppedCanvas;\n    }\n    // ---- public ----\n    constructor(param){\n        this.crop = {\n            x: 0,\n            y: 0,\n            width: 0,\n            height: 0\n        } // canvas coordinates\n        ;\n        this.mode = \"edit\";\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-edit-crop-preview\",\n            css: {\n                position: \"relative\",\n                height: param.height + \"px\",\n                width: param.width + \"px\",\n                overflow: \"hidden\"\n            }\n        });\n        if (param.onChange) this.onChange = param.onChange;\n        this.canvas = param.canvas;\n        this.resetCrop();\n        const isInsideSelectionRect = (p)=>{\n            return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).isInsideRect(p, this.getViewportSelectionRect());\n        };\n        this.croppedCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas();\n        this.eventTarget = this.croppedCanvas;\n        if (!param.isNotCopy) {\n            this.croppedImage = new Image();\n            this.eventTarget = this.croppedImage;\n        }\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.eventTarget, {\n            height: param.height + \"px\",\n            width: param.width + \"px\"\n        });\n        this.rootEl.append(this.eventTarget);\n        this.updateCroppedCanvas();\n        this.preview = new (0, $324add89932145ee$export$133773870222880f)({\n            width: param.width,\n            height: param.height - 2,\n            project: {\n                width: param.canvas.width,\n                height: param.canvas.height,\n                layers: [\n                    {\n                        image: param.canvas,\n                        opacity: 1,\n                        isVisible: true,\n                        mixModeStr: \"source-over\",\n                        hasClipping: false\n                    }\n                ]\n            },\n            hasEditMode: true,\n            onModeChange: (mode)=>{\n                this.mode = mode;\n                this.preview.getElement().style.pointerEvents = mode === \"edit\" ? \"none\" : \"\";\n                this.rootEl.title = mode === \"edit\" ? (0, $63d0b335c576c718$export$ce37e184d908d785)(\"crop-drag-to-crop\") : \"\";\n            },\n            onTransformChange: ()=>this.updateSelectionRect(),\n            padding: 20,\n            hasBorder: false,\n            editIcon: (0, (/*@__PURE__*/$parcel$interopDefault($15f04c4a93604cc0$exports)))\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.preview.getElement(), {\n            position: \"absolute\",\n            left: \"0\",\n            top: \"0\",\n            overflow: \"hidden\",\n            pointerEvents: \"none\"\n        });\n        this.preview.render();\n        this.rootEl.append(this.preview.getElement());\n        this.selectionRectEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.preview.getElement(),\n            className: \"kl-edit-crop-preview__sel\"\n        });\n        this.updateSelectionRect();\n        //gen crop from viewport points\n        const genCrop = (p1, p2)=>{\n            const mat = (0, $a8ca0a6a49a8f94f$export$d562d1c5145f86d0)(this.preview.getTransform());\n            const inverseMat = (0, $077740f52fe6870e$export$70ae2c07e401031b)(mat);\n            const topLeftP = {\n                x: Math.min(p1.x, p2.x),\n                y: Math.min(p1.y, p2.y)\n            };\n            const bottomRightP = {\n                x: Math.max(p1.x, p2.x),\n                y: Math.max(p1.y, p2.y)\n            };\n            const origTopLeftP = (0, $855520c81dfcb96a$export$9b20165a36586806)(inverseMat, topLeftP);\n            const origBottomRightP = (0, $855520c81dfcb96a$export$9b20165a36586806)(inverseMat, bottomRightP);\n            origTopLeftP.x = (0, $9414f5ea41e9cf25$export$7d15b64cf5a3a4c4)(Math.floor(origTopLeftP.x), 0, this.canvas.width);\n            origTopLeftP.y = (0, $9414f5ea41e9cf25$export$7d15b64cf5a3a4c4)(Math.floor(origTopLeftP.y), 0, this.canvas.height);\n            origBottomRightP.x = (0, $9414f5ea41e9cf25$export$7d15b64cf5a3a4c4)(Math.ceil(origBottomRightP.x), 0, this.canvas.width);\n            origBottomRightP.y = (0, $9414f5ea41e9cf25$export$7d15b64cf5a3a4c4)(Math.ceil(origBottomRightP.y), 0, this.canvas.height);\n            return {\n                x: origTopLeftP.x,\n                y: origTopLeftP.y,\n                width: origBottomRightP.x - origTopLeftP.x,\n                height: origBottomRightP.y - origTopLeftP.y\n            };\n        };\n        let startP;\n        let startCrop = null;\n        let isDragging = false;\n        let didMove = false;\n        let updateCropTimeout;\n        const pointerChain = new (0, $3c485cff20ed4548$export$649a211db9812745)({\n            chainArr: [\n                new (0, $68c13f25614f29c1$export$71ff2f51bf1f4062)()\n            ]\n        });\n        pointerChain.setChainOut((event)=>{\n            if (event.type === \"pointerdown\" && event.button === \"left\") {\n                event.eventPreventDefault();\n                isDragging = true;\n                startP = {\n                    x: event.relX,\n                    y: event.relY\n                };\n                if (!this.isReset() && isInsideSelectionRect(startP)) startCrop = {\n                    x: this.crop.x,\n                    y: this.crop.y,\n                    width: this.crop.width,\n                    height: this.crop.height\n                };\n                else this.crop = genCrop(startP, startP);\n            } else if (event.type === \"pointermove\" && event.button === \"left\") {\n                event.eventPreventDefault();\n                didMove = true;\n                if (startCrop) {\n                    const transform = this.preview.getTransform();\n                    this.crop.x = startCrop.x + Math.round((event.relX - startP.x) / transform.scale);\n                    this.crop.y = startCrop.y + Math.round((event.relY - startP.y) / transform.scale);\n                    this.crop.x = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(this.crop.x, 0, this.canvas.width - this.crop.width);\n                    this.crop.y = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(this.crop.y, 0, this.canvas.height - this.crop.height);\n                } else this.crop = genCrop(startP, {\n                    x: event.relX,\n                    y: event.relY\n                });\n                this.updateSelectionRect();\n            } else if (event.type === \"pointerup\" && startP) {\n                event.eventPreventDefault();\n                isDragging = false;\n                startCrop = null;\n                startP = null;\n                if (this.crop.width === 0 || this.crop.height === 0 || !didMove) {\n                    this.resetCrop();\n                    this.updateSelectionRect();\n                }\n                didMove = false;\n                updateCropTimeout = setTimeout(()=>this.updateCroppedCanvas(), 1);\n            }\n        });\n        this.pointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.eventTarget,\n            fixScribble: true,\n            onWheel: (event)=>{\n                this.preview.onWheel(event);\n            },\n            onPointer: (event)=>{\n                if (this.mode === \"hand\") {\n                    event.eventPreventDefault();\n                    this.preview.onPointer(event);\n                    return;\n                }\n                pointerChain.chainIn(event);\n            },\n            maxPointers: 2\n        });\n        this.keyListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).KeyListener({\n            onDown: (keyStr, e)=>{\n                if (isDragging) return;\n                let doUpdate = false;\n                const transform = this.preview.getTransform();\n                const stepSize = Math.max(1, 1 / transform.scale);\n                const shiftIsPressed = this.keyListener.isPressed(\"shift\");\n                if (keyStr === \"left\") {\n                    if (shiftIsPressed) this.crop.width = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(this.crop.width - stepSize, 1, this.canvas.width - this.crop.x);\n                    else this.crop.x = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(this.crop.x - stepSize, 0, this.canvas.width - this.crop.width);\n                    doUpdate = true;\n                }\n                if (keyStr === \"right\") {\n                    if (shiftIsPressed) this.crop.width = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(this.crop.width + stepSize, 1, this.canvas.width - this.crop.x);\n                    else this.crop.x = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(this.crop.x + stepSize, 0, this.canvas.width - this.crop.width);\n                    doUpdate = true;\n                }\n                if (keyStr === \"up\") {\n                    if (shiftIsPressed) this.crop.height = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(this.crop.height - stepSize, 1, this.canvas.height - this.crop.y);\n                    else this.crop.y = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(this.crop.y - stepSize, 0, this.canvas.height - this.crop.height);\n                    doUpdate = true;\n                }\n                if (keyStr === \"down\") {\n                    if (shiftIsPressed) this.crop.height = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(this.crop.height + stepSize, 1, this.canvas.height - this.crop.y);\n                    else this.crop.y = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(this.crop.y + stepSize, 0, this.canvas.height - this.crop.height);\n                    doUpdate = true;\n                }\n                if (doUpdate) {\n                    e.preventDefault();\n                    this.updateSelectionRect();\n                    clearTimeout(updateCropTimeout);\n                    updateCropTimeout = setTimeout(()=>this.updateCroppedCanvas(), 100);\n                }\n            }\n        });\n    }\n}\n\n\n\n\n\n\nfunction $5e9fef22bb47992b$export$32b89bc9bb92706a(parent, fullCanvas, cropCallback, output, showCropButton) {\n    let clipboardItemIsSupported = false;\n    try {\n        clipboardItemIsSupported = !!ClipboardItem;\n    } catch (e) {}\n    const div = document.createElement(\"div\");\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\n    const topWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"crop-drag-to-crop\") + (clipboardItemIsSupported ? \"\" : \"<br>\" + (0, $63d0b335c576c718$export$ce37e184d908d785)(\"cropcopy-click-hold\")),\n        css: {\n            textAlign: \"center\"\n        }\n    });\n    div.append(topWrapper);\n    const cropCopy = new (0, $c5a9090dbc3ef918$export$40175a5948a88a57)({\n        width: isSmall ? 340 : 540,\n        height: isSmall ? 300 : 350,\n        canvas: fullCanvas,\n        isNotCopy: false,\n        onChange: ()=>setTimeout(()=>updateBlob())\n    });\n    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(cropCopy.getEl(), {\n        marginTop: \"10px\",\n        marginLeft: \"-20px\"\n    });\n    div.append(cropCopy.getEl());\n    let blob = undefined;\n    // Safari doesn't allow any async operations between user interaction (click) and navigator.clipboard.write.\n    // It throws \"NotAllowedError: the request is not allowed by the user agent or the platform in the current context,\n    // possibly because the user denied permission.\"\n    // So, we try to prepare blob beforehand.\n    let cropTimeout;\n    function updateBlob() {\n        if (!clipboardItemIsSupported) return;\n        clearTimeout(cropTimeout);\n        cropTimeout = setTimeout(()=>{\n            cropCopy.getCroppedCanvas().toBlob((result)=>{\n                blob = result !== null && result !== void 0 ? result : undefined;\n            }, \"image/png\");\n        }, 50);\n    }\n    async function toClipboard() {\n        if (!blob) return;\n        try {\n            await navigator.clipboard.write([\n                new ClipboardItem({\n                    [blob.type]: blob\n                })\n            ]);\n            setTimeout(function() {\n                output.out((0, $63d0b335c576c718$export$ce37e184d908d785)(\"cropcopy-copied\"), true);\n            }, 200);\n        } catch (err) {\n            console.error(err.name, err.message);\n            return;\n        }\n    }\n    const keyListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).KeyListener({\n        onDown: function(keyStr, KeyEvent, comboStr) {\n            if ([\n                \"ctrl+c\",\n                \"cmd+c\"\n            ].includes(comboStr)) {\n                toClipboard();\n                closeFunc && closeFunc();\n            }\n        }\n    });\n    let closeFunc;\n    function blur() {\n        closeFunc && closeFunc();\n    }\n    window.addEventListener(\"blur\", blur);\n    const buttonArr = [];\n    if (clipboardItemIsSupported) buttonArr.push((0, $63d0b335c576c718$export$ce37e184d908d785)(\"cropcopy-btn-copy\"));\n    if (showCropButton) buttonArr.push((0, $63d0b335c576c718$export$ce37e184d908d785)(\"cropcopy-btn-crop\"));\n    buttonArr.push(\"Cancel\");\n    (0, $2016c314bff36ab9$export$d7e8d4d4450c819c)({\n        target: parent,\n        message: \"<b>\" + (showCropButton ? `${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"cropcopy-title-copy\")} / ${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"cropcopy-title-crop\")}` : `${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"cropcopy-title-copy\")}`) + \"</b>\",\n        div: div,\n        style: isSmall ? {} : {\n            width: \"540px\"\n        },\n        buttons: buttonArr,\n        primaries: [\n            (0, $63d0b335c576c718$export$ce37e184d908d785)(\"cropcopy-btn-copy\")\n        ],\n        callback: function(result) {\n            if (result === (0, $63d0b335c576c718$export$ce37e184d908d785)(\"cropcopy-btn-copy\")) toClipboard();\n            else if (result === (0, $63d0b335c576c718$export$ce37e184d908d785)(\"cropcopy-btn-crop\")) {\n                const rectObj = cropCopy.getRect();\n                cropCallback({\n                    left: Math.round(-rectObj.x),\n                    right: Math.round(rectObj.x + rectObj.width - fullCanvas.width),\n                    top: Math.round(-rectObj.y),\n                    bottom: Math.round(rectObj.y + rectObj.height - fullCanvas.height)\n                });\n            }\n            window.removeEventListener(\"blur\", blur);\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).freeCanvas(cropCopy.getCroppedCanvas());\n            cropCopy.destroy();\n            keyListener.destroy();\n        },\n        clickOnEnter: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"cropcopy-btn-copy\"),\n        closeFunc: function(func) {\n            closeFunc = func;\n        }\n    });\n}\n\n\n\n\n\n\n\n/**\n * Flood fill. Tried https://github.com/binarymax/floodfill.js/, but it implemented tolerance wrong, and had bugs.\n * So, my own implementation. can handle tolerance, grow, opacity.\n * Needs to be optimized.\n */ /**\n * Set values in data within rect to 254, unless they're 255\n *\n * @param data Uint8Array\n * @param width int\n * @param x0 int\n * @param y0 int\n * @param x1 int >x0\n * @param y1 int >y0\n */ function $469fa98e1403db53$var$fillRect(data, width, x0, y0, x1, y1) {\n    for(let x = x0; x <= x1; x++)for(let y = y0; y <= y1; y++){\n        if (data[y * width + x] === 255) continue;\n        data[y * width + x] = 254;\n    }\n}\nlet $469fa98e1403db53$var$mx, $469fa98e1403db53$var$my;\n/**\n * Get index i moved by dX, dY. in array with dimensions width height.\n * Returns null if outside bounds.\n *\n * @param width int\n * @param height int\n * @param i int\n * @param dX int\n * @param dY int\n */ function $469fa98e1403db53$var$moveIndex(width, height, i, dX, dY) {\n    $469fa98e1403db53$var$mx = i % width + dX;\n    $469fa98e1403db53$var$my = Math.floor(i / width) + dY;\n    if ($469fa98e1403db53$var$mx < 0 || $469fa98e1403db53$var$my < 0 || $469fa98e1403db53$var$mx >= width || $469fa98e1403db53$var$my >= height) return undefined;\n    return $469fa98e1403db53$var$my * width + $469fa98e1403db53$var$mx;\n}\n/**\n * If pixel can be filled (within tolerance) will be set 255 and returns true.\n * returns false if already filled, or i is null\n *\n * @param srcArr Uint8ClampedArray rgba\n * @param targetArr Uint8Array\n * @param width int\n * @param height int\n * @param initRgba rgba\n * @param tolerance int 0 - 255\n * @param i int - srcArr index\n * @returns {boolean}\n */ function $469fa98e1403db53$var$testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i) {\n    if (i === undefined || targetArr[i] === 255) return false;\n    if (srcArr[i * 4] === initRgba[0] && srcArr[i * 4 + 1] === initRgba[1] && srcArr[i * 4 + 2] === initRgba[2] && srcArr[i * 4 + 3] === initRgba[3]) {\n        targetArr[i] = 255;\n        return true;\n    }\n    if (tolerance > 0 && Math.abs(srcArr[i * 4] - initRgba[0]) <= tolerance && Math.abs(srcArr[i * 4 + 1] - initRgba[1]) <= tolerance && Math.abs(srcArr[i * 4 + 2] - initRgba[2]) <= tolerance && Math.abs(srcArr[i * 4 + 3] - initRgba[3]) <= tolerance) {\n        targetArr[i] = 255;\n        return true;\n    }\n    return false;\n}\n/**\n *\n * @param srcArr Uint8ClampedArray rgba\n * @param targetArr Uint8Array\n * @param width int\n * @param height int\n * @param px int\n * @param py int\n * @param tolerance int 0 - 255\n * @param grow int >= 0\n * @param isContiguous boolean\n */ function $469fa98e1403db53$var$floodFill(srcArr, targetArr, width, height, px, py, tolerance, grow, isContiguous) {\n    const initRgba = [\n        srcArr[(py * width + px) * 4],\n        srcArr[(py * width + px) * 4 + 1],\n        srcArr[(py * width + px) * 4 + 2],\n        srcArr[(py * width + px) * 4 + 3]\n    ];\n    if (isContiguous) {\n        const q = [];\n        q.push(py * width + px);\n        targetArr[py * width + px] = 255;\n        let i, e;\n        while(q.length){\n            i = q.pop(); // a test would slow down the code\n            // queue up unfilled neighbors\n            e = $469fa98e1403db53$var$moveIndex(width, height, i, -1, 0); // left\n            // test will return false if e is undefined -> only numbers will be pushed to q\n            $469fa98e1403db53$var$testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\n            e = $469fa98e1403db53$var$moveIndex(width, height, i, 1, 0); // right\n            $469fa98e1403db53$var$testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\n            e = $469fa98e1403db53$var$moveIndex(width, height, i, 0, -1); // up\n            $469fa98e1403db53$var$testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\n            e = $469fa98e1403db53$var$moveIndex(width, height, i, 0, 1); // bottom\n            $469fa98e1403db53$var$testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e);\n        }\n    } else for(let i = 0; i < width * height; i++)$469fa98e1403db53$var$testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i);\n    // grow\n    if (grow === 0) return;\n    // how does it grow? it finds all pixel at the edge.\n    // then depending on what kind of edge it is, it draws a rectangle into target\n    // the rectangle has the value 254, or else it will mess it all up.\n    // after it's all done, replaces it with 255\n    let x0, x1, y0, y1;\n    let l, tl, t, tr, r, br, b, bl; // left, top left, top, top right, etc.\n    for(let x = 0; x < width; x++)for(let y = 0; y < height; y++){\n        if (targetArr[y * width + x] !== 255) continue;\n        // bounds of rectangle\n        x0 = x;\n        x1 = x;\n        y0 = y;\n        y1 = y;\n        l = targetArr[y * width + x - 1] !== 255;\n        tl = targetArr[(y - 1) * width + x - 1] !== 255;\n        t = targetArr[(y - 1) * width + x] !== 255;\n        tr = targetArr[(y - 1) * width + x + 1] !== 255;\n        r = targetArr[y * width + x + 1] !== 255;\n        br = targetArr[(y + 1) * width + x + 1] !== 255;\n        b = targetArr[(y + 1) * width + x] !== 255;\n        bl = targetArr[(y + 1) * width + x - 1] !== 255;\n        if (l) x0 = x - grow;\n        if (l && tl && t) {\n            x0 = x - grow;\n            y0 = y - grow;\n        }\n        if (t) y0 = Math.min(y0, y - grow);\n        if (t && tr && r) {\n            y0 = Math.min(y0, y - grow);\n            x1 = x + grow;\n        }\n        if (r) x1 = Math.max(x1, x + grow);\n        if (r && br && b) {\n            x1 = Math.max(x1, x + grow);\n            y1 = Math.max(y1, y + grow);\n        }\n        if (b) y1 = Math.max(y1, y + grow);\n        if (b && bl && l) {\n            x0 = Math.min(x0, x - grow);\n            y1 = Math.max(y1, y + grow);\n        }\n        if (!l && !tl && !t && !tr && !r && !br && !b && !bl) continue;\n        $469fa98e1403db53$var$fillRect(targetArr, width, Math.max(0, x0), Math.max(0, y0), Math.min(width - 1, x1), Math.min(height - 1, y1));\n    }\n    for(let i = 0; i < width * height; i++)if (targetArr[i] === 254) targetArr[i] = 255;\n}\nfunction $469fa98e1403db53$export$13d50f258a8034f(rgbaArr, width, height, x, y, tolerance, grow, isContiguous) {\n    x = Math.round(x);\n    y = Math.round(y);\n    const resultArr = new Uint8Array(new ArrayBuffer(width * height));\n    $469fa98e1403db53$var$floodFill(rgbaArr, resultArr, width, height, x, y, tolerance, grow, isContiguous);\n    return {\n        data: resultArr\n    };\n}\n\n\n\nclass $583d130d11db85ad$export$27550cc14d7ae85a {\n    onDown(x, y, angleRad) {\n        this.downX = x;\n        this.downY = y;\n        this.downAngleRad = angleRad;\n    }\n    onMove(x, y) {\n        this.onShape(false, this.downX, this.downY, x, y, this.downAngleRad);\n    }\n    onUp(x, y) {\n        this.onShape(true, this.downX, this.downY, x, y, this.downAngleRad);\n    }\n    // ---- public ----\n    constructor(p){\n        this.downX = 0;\n        this.downY = 0;\n        this.downAngleRad = 0;\n        this.onShape = p.onShape;\n    }\n}\nfunction $583d130d11db85ad$export$71b514a25c47df50(ctx, shapeObj) {\n    shapeObj = {\n        // defaults\n        angleRad: 0,\n        isOutwards: false,\n        opacity: 1,\n        isEraser: false,\n        doLockAlpha: false,\n        ...(0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(shapeObj)\n    };\n    if ([\n        \"rect\",\n        \"ellipse\",\n        \"line\"\n    ].includes(shapeObj.type)) {\n        if (shapeObj.angleRad === undefined) throw new Error(\"angleRad undefined\");\n        const lineWidth = shapeObj.lineWidth === undefined ? -1 : Math.round(shapeObj.lineWidth);\n        const angleDeg = shapeObj.angleRad * 180 / Math.PI;\n        // --- prep color ---\n        if (!shapeObj.isEraser && shapeObj.fillRgb === undefined && shapeObj.strokeRgb === undefined) throw new Error(\"fillRgb and strokeRgb undefined\");\n        const colorRGB = shapeObj.isEraser ? {\n            r: 255,\n            g: 255,\n            b: 255\n        } : shapeObj.fillRgb ? shapeObj.fillRgb : shapeObj.strokeRgb;\n        // --- prep canvas ---\n        ctx.save();\n        if (shapeObj.opacity) ctx.globalAlpha = shapeObj.opacity;\n        if (shapeObj.isEraser) ctx.globalCompositeOperation = \"destination-out\";\n        if (shapeObj.doLockAlpha) ctx.globalCompositeOperation = \"source-atop\";\n        ctx.rotate(-shapeObj.angleRad);\n        if (shapeObj.fillRgb) ctx.fillStyle = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRgbStr(colorRGB);\n        else if (shapeObj.strokeRgb) {\n            ctx.strokeStyle = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRgbStr(colorRGB);\n            ctx.lineWidth = lineWidth;\n        }\n        let x1 = shapeObj.x1;\n        let y1 = shapeObj.y1;\n        let x2 = shapeObj.x2;\n        let y2 = shapeObj.y2;\n        // --- angle snapping ---\n        if (shapeObj.isAngleSnap) {\n            const r1 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\n            const r2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\n            const pAngleDeg = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).pointsToAngleDeg(r1, r2) + 90;\n            const pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\n            const rotated = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotateAround({\n                x: x1,\n                y: y1\n            }, {\n                x: x2,\n                y: y2\n            }, pAngleDegSnapped - pAngleDeg);\n            x2 = rotated.x;\n            y2 = rotated.y;\n            // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\n            if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\n                if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) x2 = x1;\n                else y2 = y1;\n            }\n        }\n        let x = x1;\n        let y = y1;\n        let dX = x2 - x1;\n        let dY = y2 - y1;\n        // --- 1:1 ratio ---\n        if (shapeObj.type !== \"line\" && shapeObj.isFixedRatio) {\n            let r1 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotate(shapeObj.x1, shapeObj.y1, shapeObj.angleRad / Math.PI * 180);\n            let r2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotate(shapeObj.x2, shapeObj.y2, shapeObj.angleRad / Math.PI * 180);\n            const rx = r1.x;\n            const ry = r1.y;\n            let rdX = r2.x - r1.x;\n            let rdY = r2.y - r1.y;\n            if (Math.abs(rdX) < Math.abs(rdY)) rdY = Math.abs(rdX) * (rdY < 0 ? -1 : 1);\n            else rdX = Math.abs(rdY) * (rdX < 0 ? -1 : 1);\n            r2.x = rx + rdX;\n            r2.y = ry + rdY;\n            r1 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotate(r1.x, r1.y, -shapeObj.angleRad / Math.PI * 180);\n            r2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotate(r2.x, r2.y, -shapeObj.angleRad / Math.PI * 180);\n            x1 = r1.x;\n            y1 = r1.y;\n            x2 = r2.x;\n            y2 = r2.y;\n            x = x1;\n            y = y1;\n            dX = x2 - x1;\n            dY = y2 - y1;\n        }\n        // outwards modifier\n        if (shapeObj.isOutwards) {\n            x -= dX;\n            y -= dY;\n            dX *= 2;\n            dY *= 2;\n            x1 = x;\n            y1 = y;\n            x2 = x + dX;\n            y2 = y + dY;\n        }\n        let p1;\n        let p2;\n        if (shapeObj.type === \"line\") {\n            // rounded\n            const x1r = Math.round(x1);\n            const y1r = Math.round(y1);\n            const x2r = Math.round(x2);\n            const y2r = Math.round(y2);\n            // floored\n            const x1f = Math.floor(x1);\n            const y1f = Math.floor(y1);\n            const x2f = Math.floor(x2);\n            const y2f = Math.floor(y2);\n            if (lineWidth % 2 === 0) {\n                if (y1r === y2r) {\n                    p1 = {\n                        x: x1f,\n                        y: y1r\n                    };\n                    p2 = {\n                        x: x2f,\n                        y: y2r\n                    };\n                    if (x1f < x2f) p2.x += 1;\n                    else p1.x += 1;\n                } else if (x1r === x2r) {\n                    p1 = {\n                        x: x1r,\n                        y: y1f\n                    };\n                    p2 = {\n                        x: x2r,\n                        y: y2f\n                    };\n                    if (y1f < y2f) p2.y += 1;\n                    else p1.y += 1;\n                } else {\n                    p1 = {\n                        x: x1,\n                        y: y1\n                    };\n                    p2 = {\n                        x: x2,\n                        y: y2\n                    };\n                }\n            } else {\n                p1 = {\n                    x: x1f,\n                    y: y1f\n                };\n                p2 = {\n                    x: x2f,\n                    y: y2f\n                };\n                if (y1f === y2f) {\n                    if (x1f < x2f) p2.x += 1;\n                    else p1.x += 1;\n                    p1.y += 0.5;\n                    p2.y += 0.5;\n                } else if (x1f === x2f) {\n                    if (y1f < y2f) p2.y += 1;\n                    else p1.y += 1;\n                    p1.x += 0.5;\n                    p2.x += 0.5;\n                } else {\n                    p1.x = x1;\n                    p1.y = y1;\n                    p2.x = x2;\n                    p2.y = y2;\n                }\n            }\n            p1 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\n            p2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\n            ctx.beginPath();\n            ctx.moveTo(p1.x, p1.y);\n            ctx.lineTo(p2.x, p2.y);\n            ctx.stroke();\n        } else if (shapeObj.type === \"rect\") {\n            // floored\n            const x1f = Math.floor(x1);\n            const y1f = Math.floor(y1);\n            const x2f = Math.floor(x2);\n            const y2f = Math.floor(y2);\n            if (angleDeg % 90 === 0) {\n                if (shapeObj.fillRgb) {\n                    if (x1 % 1 === 0) x1 += 1;\n                    if (y1 % 1 === 0) y1 += 1;\n                    if (x2 % 1 === 0) x2 += 1;\n                    if (y2 % 1 === 0) y2 += 1;\n                    p1 = {\n                        x: x1 < x2 ? x1f : x2f,\n                        y: y1 < y2 ? y1f : y2f\n                    };\n                    p2 = {\n                        x: Math.ceil((x1 < x2 ? x2 : x1) - p1.x),\n                        y: Math.ceil((y1 < y2 ? y2 : y1) - p1.y)\n                    };\n                    p2.x = p1.x + p2.x;\n                    p2.y = p1.y + p2.y;\n                } else if (lineWidth % 2 === 0) {\n                    p1 = {\n                        x: x1f,\n                        y: y1f\n                    };\n                    p2 = {\n                        x: x2f,\n                        y: y2f\n                    };\n                } else {\n                    p1 = {\n                        x: x1f + 0.5,\n                        y: y1f + 0.5\n                    };\n                    p2 = {\n                        x: x2f + 0.5,\n                        y: y2f + 0.5\n                    };\n                }\n            } else {\n                p1 = {\n                    x: x1,\n                    y: y1\n                };\n                p2 = {\n                    x: x2,\n                    y: y2\n                };\n            }\n            p1 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\n            p2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\n            p2.x = p2.x - p1.x;\n            p2.y = p2.y - p1.y;\n            if (shapeObj.fillRgb) ctx.fillRect(p1.x, p1.y, p2.x, p2.y);\n            else ctx.strokeRect(p1.x, p1.y, p2.x, p2.y);\n        } else {\n            p1 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\n            p2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\n            x = p1.x;\n            y = p1.y;\n            dX = p2.x - p1.x;\n            dY = p2.y - p1.y;\n            ctx.beginPath();\n            ctx.ellipse(x + dX / 2, y + dY / 2, Math.abs(dX / 2), Math.abs(dY / 2), 0, 0, Math.PI * 2);\n            if (shapeObj.fillRgb) ctx.fill();\n            else ctx.stroke();\n        }\n        ctx.restore();\n    } else throw new Error(\"unknown shape\");\n}\n\n\n\nfunction $67e715fe604c9329$var$textMetricToRect(metrics, align) {\n    var _metrics_fontBoundingBoxAscent;\n    // fallback for older browsers\n    const ascent = (_metrics_fontBoundingBoxAscent = metrics.fontBoundingBoxAscent) !== null && _metrics_fontBoundingBoxAscent !== void 0 ? _metrics_fontBoundingBoxAscent : metrics.actualBoundingBoxAscent;\n    var _metrics_fontBoundingBoxDescent;\n    const descent = (_metrics_fontBoundingBoxDescent = metrics.fontBoundingBoxDescent) !== null && _metrics_fontBoundingBoxDescent !== void 0 ? _metrics_fontBoundingBoxDescent : metrics.actualBoundingBoxDescent;\n    if (align === \"left\") return {\n        x: 0,\n        y: -ascent,\n        width: metrics.width,\n        height: ascent + descent\n    };\n    if (align === \"right\") return {\n        x: -metrics.width,\n        y: -ascent,\n        width: metrics.width,\n        height: ascent + descent\n    };\n    // center\n    return {\n        x: -metrics.width / 2,\n        y: -ascent,\n        width: metrics.width,\n        height: ascent + descent\n    };\n}\nfunction $67e715fe604c9329$export$482c90f94eb9717c(canvas, p) {\n    p = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(p);\n    // setup context\n    const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(canvas);\n    ctx.save();\n    ctx.textAlign = p.align;\n    ctx.letterSpacing = p.letterSpacing ? p.letterSpacing + \"px\" : \"0\";\n    // font\n    const fontArr = [\n        p.size + \"px \" + (p.font ? p.font : \"sans-serif\")\n    ];\n    if (p.isBold) fontArr.unshift(\"bold\");\n    if (p.isItalic) fontArr.unshift(\"italic\");\n    ctx.font = fontArr.join(\" \");\n    // fill\n    ctx.fillStyle = p.fill ? (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRgbaStr(p.fill.color) : \"transparent\";\n    // stroke\n    ctx.strokeStyle = p.stroke ? (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRgbaStr(p.stroke.color) : \"transparent\";\n    if (p.stroke) {\n        ctx.lineWidth = p.stroke.lineWidth;\n        ctx.lineJoin = \"round\";\n    }\n    ctx.translate(p.x, p.y);\n    ctx.rotate(-p.angleRad);\n    const lines = p.text.split(\"\\n\").map((line)=>line.replaceAll(\"\t\", \"    \"));\n    // bounds\n    const bounds = {\n        x1: 0,\n        y1: 0,\n        x2: 0,\n        y2: 0\n    };\n    {\n        let isFirst = true;\n        lines.forEach((line, lineIndex)=>{\n            const metrics = ctx.measureText(line);\n            const x = 0;\n            var _p_lineHeight;\n            const y = p.size * ((_p_lineHeight = p.lineHeight) !== null && _p_lineHeight !== void 0 ? _p_lineHeight : 1) * lineIndex;\n            const mRect = $67e715fe604c9329$var$textMetricToRect(metrics, p.align);\n            if (isFirst) {\n                isFirst = false;\n                bounds.x1 = x + mRect.x;\n                bounds.y1 = y + mRect.y;\n                bounds.x2 = x + mRect.x + mRect.width;\n                bounds.y2 = y + mRect.y + mRect.height;\n            } else {\n                bounds.x1 = Math.min(bounds.x1, x + mRect.x);\n                bounds.y1 = Math.min(bounds.y1, y + mRect.y);\n                bounds.x2 = Math.max(bounds.x2, x + mRect.x + mRect.width);\n                bounds.y2 = Math.max(bounds.y2, y + mRect.y + mRect.height);\n            }\n        });\n    }\n    // draw stroke\n    lines.forEach((line, lineIndex)=>{\n        const x = 0;\n        var _p_lineHeight;\n        const y = p.size * ((_p_lineHeight = p.lineHeight) !== null && _p_lineHeight !== void 0 ? _p_lineHeight : 1) * lineIndex;\n        ctx.strokeText(line, x, y);\n    });\n    // draw fill\n    lines.forEach((line, lineIndex)=>{\n        const x = 0;\n        var _p_lineHeight;\n        const y = p.size * ((_p_lineHeight = p.lineHeight) !== null && _p_lineHeight !== void 0 ? _p_lineHeight : 1) * lineIndex;\n        ctx.fillText(line, x, y);\n    });\n    ctx.restore();\n    return {\n        x: bounds.x1,\n        y: bounds.y1,\n        width: bounds.x2 - bounds.x1,\n        height: bounds.y2 - bounds.y1\n    };\n}\n\n\n\n\nfunction $2b8bf7b32e5ba51f$export$5f63a7b18dc4503a(project, factor) {\n    const resultCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(Math.max(1, Math.round(project.width * factor)), Math.max(1, Math.round(project.height * factor)));\n    const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(resultCanvas);\n    ctx.save();\n    if (factor > 1) ctx.imageSmoothingEnabled = false;\n    for(let i = 0; i < project.layers.length; i++){\n        const layer = project.layers[i];\n        if (!layer.isVisible || layer.opacity === 0) continue;\n        ctx.globalAlpha = layer.opacity;\n        const mixModeStr = layer.mixModeStr;\n        ctx.globalCompositeOperation = mixModeStr !== undefined ? mixModeStr : \"source-over\";\n        ctx.drawImage(layer.image, 0, 0, resultCanvas.width, resultCanvas.height);\n    }\n    ctx.restore();\n    return resultCanvas;\n}\n\n\n\n\nclass $64881aa9f7f8f596$export$74d12f09ff9f1956 {\n    onDown(x, y, angleRad) {\n        this.downX = x;\n        this.downY = y;\n        this.downAngleRad = angleRad;\n    }\n    onMove(x, y) {\n        this.onGradient(false, this.downX, this.downY, x, y, this.downAngleRad);\n    }\n    onUp(x, y) {\n        this.onGradient(true, this.downX, this.downY, x, y, this.downAngleRad);\n    }\n    // ---- public ----\n    constructor(p){\n        this.downX = 0;\n        this.downY = 0;\n        this.downAngleRad = 0;\n        this.onGradient = p.onGradient;\n    }\n}\nfunction $64881aa9f7f8f596$export$b1f70a113e3b5c1b(ctx, gradientObj) {\n    ctx.save();\n    const x1 = gradientObj.x1;\n    const y1 = gradientObj.y1;\n    let x2 = gradientObj.x2;\n    let y2 = gradientObj.y2;\n    if (gradientObj.doSnap) {\n        const angleDeg = gradientObj.angleRad * 180 / Math.PI;\n        const r1 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotate(x1, y1, gradientObj.angleRad / Math.PI * 180);\n        const r2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotate(x2, y2, gradientObj.angleRad / Math.PI * 180);\n        const pAngleDeg = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).pointsToAngleDeg(r1, r2) + 90;\n        const pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\n        const rotated = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotateAround({\n            x: x1,\n            y: y1\n        }, {\n            x: x2,\n            y: y2\n        }, pAngleDegSnapped - pAngleDeg);\n        x2 = rotated.x;\n        y2 = rotated.y;\n        // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\n        if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\n            if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) x2 = x1;\n            else y2 = y1;\n        }\n    }\n    let baseColor = gradientObj.color1;\n    if (gradientObj.isEraser && gradientObj.doLockAlpha) baseColor = {\n        r: 255,\n        g: 255,\n        b: 255\n    };\n    let color1 = {\n        ...baseColor,\n        a: gradientObj.opacity\n    };\n    let color2 = {\n        ...baseColor,\n        a: 0\n    };\n    if (gradientObj.isReversed) {\n        const temp = color1;\n        color1 = color2;\n        color2 = temp;\n    }\n    let gradient;\n    if (gradientObj.type === \"linear\") {\n        gradient = ctx.createLinearGradient(x1, y1, x2, y2);\n        gradient.addColorStop(0, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRgbaStr(color1));\n        gradient.addColorStop(1, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRgbaStr(color2));\n    } else if (gradientObj.type === \"linear-mirror\") {\n        const d = {\n            x: x2 - x1,\n            y: y2 - y1\n        };\n        gradient = ctx.createLinearGradient(x1 - d.x, y1 - d.y, x2, y2);\n        gradient.addColorStop(0, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRgbaStr(color2));\n        gradient.addColorStop(0.5, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRgbaStr(color1));\n        gradient.addColorStop(1, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRgbaStr(color2));\n    } else if (gradientObj.type === \"radial\") {\n        const r = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Vec2.dist({\n            x: x1,\n            y: y1\n        }, {\n            x: x2,\n            y: y2\n        });\n        gradient = ctx.createRadialGradient(x1, y1, 0, x1, y1, r);\n        gradient.addColorStop(0, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRgbaStr(color1));\n        gradient.addColorStop(1, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRgbaStr(color2));\n    }\n    ctx.fillStyle = gradient;\n    if (gradientObj.isEraser) ctx.globalCompositeOperation = \"destination-out\";\n    if (gradientObj.doLockAlpha) ctx.globalCompositeOperation = \"source-atop\";\n    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n    ctx.restore();\n}\n\n\n\n// TODO remove in 2026\n// workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\n// reported 2021-13 (v96), fixed 2022-02 (v99)\n// affects: source-in, source-out, destination-in, destination-atop\nfunction $d26b85e649dca02a$var$workaroundForChromium1281185(ctx) {\n    ctx.save();\n    ctx.fillStyle = \"rgba(0,0,0,0.01)\";\n    ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\n    ctx.restore();\n}\nconst $d26b85e649dca02a$var$allowedMixModes = [\n    \"source-over\",\n    \"darken\",\n    \"multiply\",\n    \"color-burn\",\n    \"lighten\",\n    \"screen\",\n    \"color-dodge\",\n    \"overlay\",\n    \"soft-light\",\n    \"hard-light\",\n    \"difference\",\n    \"exclusion\",\n    \"hue\",\n    \"saturation\",\n    \"color\",\n    \"luminosity\"\n];\nconst $d26b85e649dca02a$export$9f4f73b1bd7c2f26 = 16;\nclass $d26b85e649dca02a$export$4a819bde91671014 {\n    init(w, h) {\n        if (!w || !h || isNaN(w) || isNaN(h) || w < 1 || h < 1) throw new Error(\"init - invalid canvas size: \" + w + \", \" + h);\n        this.width = w;\n        this.height = h;\n    }\n    emitChange() {\n        // some changes don't get captured by the history - e.g. changing opacity as the user drags the slider\n        this.changeListenerArr.forEach((item)=>item());\n    }\n    updateIndices() {\n        this.layerCanvasArr.forEach((item, index)=>{\n            item.index = index;\n        });\n    }\n    setHistory(h) {\n        this.history = h;\n    }\n    /**\n     * Resets canvas -> 1 layer, 100% opacity,\n     * unless layers provided.\n     * @param p\n     */ reset(p) {\n        if (!p.width || !p.height || p.width < 1 || p.height < 1 || isNaN(p.width) || isNaN(p.height)) throw new Error(\"invalid canvas size\");\n        this.history.pause(true);\n        this.width = p.width;\n        this.height = p.height;\n        this.layerCanvasArr.splice(1, Math.max(0, this.layerCanvasArr.length - 1));\n        if (p.layers) for(let i = 0; i < p.layers.length; i++){\n            const item = p.layers[i];\n            if (!this.layerCanvasArr[i]) this.addLayer();\n            this.layerCanvasArr[i].name = item.name;\n            this.layerCanvasArr[i].isVisible = item.isVisible;\n            this.layerCanvasArr[i].width = this.width;\n            this.layerCanvasArr[i].height = this.height;\n            this.layerCanvasArr[i].mixModeStr = item.mixModeStr ? item.mixModeStr : \"source-over\";\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[i]).drawImage(item.image, 0, 0);\n            this.layerOpacity(i, item.opacity);\n        }\n        else {\n            this.layerCanvasArr[0].name = p.layerName ? p.layerName : (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-layer\") + \" 1\";\n            this.layerCanvasArr[0].isVisible = true;\n            this.layerCanvasArr[0].width = this.width;\n            this.layerCanvasArr[0].height = this.height;\n            this.layerCanvasArr[0].mixModeStr = \"source-over\";\n            this.layerOpacity(0, 1);\n            if (p.color) this.layerFill(0, p.color);\n            else if (p.image) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[0]).drawImage(p.image, 0, 0);\n        }\n        this.updateIndices();\n        this.history.pause(false);\n        this.history.push({\n            tool: [\n                \"canvas\"\n            ],\n            action: \"reset\",\n            params: [\n                p\n            ]\n        });\n        return this.layerCanvasArr.length - 1;\n    }\n    isLayerLimitReached() {\n        return this.layerCanvasArr.length >= $d26b85e649dca02a$export$9f4f73b1bd7c2f26;\n    }\n    getWidth() {\n        return this.width;\n    }\n    getHeight() {\n        return this.height;\n    }\n    copy(toCopyCanvas) {\n        if (toCopyCanvas.getWidth() < 1 || toCopyCanvas.getHeight() < 1 || isNaN(toCopyCanvas.getWidth()) || isNaN(toCopyCanvas.getHeight())) throw new Error(\"invalid canvas size\");\n        // keep existing canvases\n        const origLayers = toCopyCanvas.getLayers();\n        while(this.layerCanvasArr.length > origLayers.length)this.removeLayer(this.layerCanvasArr.length - 1);\n        if (toCopyCanvas.getWidth() != this.width || toCopyCanvas.getHeight() != this.height) this.init(toCopyCanvas.getWidth(), toCopyCanvas.getHeight());\n        for(let i = 0; i < origLayers.length; i++){\n            if (i >= this.layerCanvasArr.length) this.addLayer();\n            else {\n                this.layerCanvasArr[i].width = this.width;\n                this.layerCanvasArr[i].height = this.height;\n            }\n            this.layerOpacity(i, origLayers[i].opacity);\n            this.layerCanvasArr[i].name = origLayers[i].name;\n            this.layerCanvasArr[i].isVisible = origLayers[i].isVisible;\n            this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr;\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[i]).drawImage(origLayers[i].context.canvas, 0, 0);\n        }\n        this.updateIndices();\n    }\n    getLayerCount() {\n        return this.layerCanvasArr.length;\n    }\n    resize(w, h, algorithm = \"smooth\") {\n        if (!w || !h || w === this.width && h === this.height || isNaN(w) || isNaN(h) || w < 1 || h < 1) return false;\n        w = Math.max(w, 1);\n        h = Math.max(h, 1);\n        let tmp1, tmp2;\n        if (algorithm === \"pixelated\") {\n            tmp1 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(w, h);\n            const tmp1Ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(tmp1);\n            tmp1Ctx.imageSmoothingEnabled = false;\n            for(let i = 0; i < this.layerCanvasArr.length; i++){\n                if (i > 0) tmp1Ctx.clearRect(0, 0, w, h);\n                const layerCanvas = this.layerCanvasArr[i];\n                tmp1Ctx.drawImage(layerCanvas, 0, 0, w, h);\n                layerCanvas.width = w;\n                layerCanvas.height = h;\n                const layerContext = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(layerCanvas);\n                layerContext.drawImage(tmp1, 0, 0);\n            }\n        } else if (algorithm === \"smooth\") {\n            tmp1 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas();\n            tmp2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas();\n            for(let i = 0; i < this.layerCanvasArr.length; i++)(0, $d9f9f4926aa80a1c$export$921068d8846a1559).resizeCanvas(this.layerCanvasArr[i], w, h, tmp1, tmp2);\n        } else throw new Error(\"unknown resize algorithm\");\n        this.width = w;\n        this.height = h;\n        return true;\n    }\n    /**\n     * crop / extend\n     * @param p\n     */ resizeCanvas(p) {\n        const newW = Math.round(p.left) + this.width + Math.round(p.right);\n        const newH = Math.round(p.top) + this.height + Math.round(p.bottom);\n        const offX = Math.round(p.left);\n        const offY = Math.round(p.top);\n        if (isNaN(newW) || isNaN(newH) || newW < 1 || newH < 1) throw new Error(\"KlCanvas.resizeCanvas - invalid canvas size\");\n        for(let i = 0; i < this.layerCanvasArr.length; i++){\n            const ctemp = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(this.width, this.height);\n            const layerCanvas = this.layerCanvasArr[i];\n            const layerCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[i]);\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(ctemp).drawImage(layerCanvas, 0, 0);\n            this.layerCanvasArr[i].width = newW;\n            this.layerCanvasArr[i].height = newH;\n            layerCtx.save();\n            if (i === 0 && p.fillColor) {\n                layerCtx.fillStyle = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRgbStr(p.fillColor);\n                layerCtx.fillRect(0, 0, newW, newH);\n                layerCtx.clearRect(offX, offY, this.width, this.height);\n            }\n            layerCtx.drawImage(ctemp, offX, offY);\n            layerCtx.restore();\n        }\n        this.width = newW;\n        this.height = newH;\n    }\n    /**\n     * will be inserted on top of selected\n     * @param selected\n     */ addLayer(selected) {\n        if (this.isLayerLimitReached()) return false;\n        const canvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(this.width, this.height);\n        if (!canvas.getContext(\"2d\")) throw new Error(\"kl-create-canvas-error\");\n        canvas.isVisible = true;\n        canvas.mixModeStr = \"source-over\";\n        if (selected === undefined) {\n            this.layerCanvasArr[this.layerCanvasArr.length] = canvas;\n            selected = Math.max(0, this.layerCanvasArr.length - 1);\n        } else {\n            this.layerCanvasArr.splice(selected + 1, 0, canvas);\n            selected++;\n        }\n        canvas.name = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-layer\") + \" \" + (this.layerCanvasArr.length + this.layerNrOffset);\n        this.history.pause(true);\n        this.layerOpacity(selected, 1);\n        this.history.pause(false);\n        this.updateIndices();\n        this.history.push({\n            tool: [\n                \"canvas\"\n            ],\n            action: \"addLayer\",\n            params: [\n                selected - 1\n            ]\n        });\n        return selected;\n    }\n    duplicateLayer(i) {\n        if (!this.layerCanvasArr[i] || this.isLayerLimitReached()) return false;\n        const canvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(this.width, this.height);\n        this.layerCanvasArr.splice(i + 1, 0, canvas);\n        canvas.name = this.layerCanvasArr[i].name + \" \" + (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-copy\");\n        canvas.isVisible = this.layerCanvasArr[i].isVisible;\n        canvas.mixModeStr = this.layerCanvasArr[i].mixModeStr;\n        // 2023-04-30 workaround for https://bugs.webkit.org/show_bug.cgi?id=256151\n        // todo replace with simple drawImage eventually when fixed\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(canvas).putImageData((0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[i]).getImageData(0, 0, this.width, this.height), 0, 0);\n        this.history.pause(true);\n        this.layerOpacity(i + 1, this.layerCanvasArr[i].opacity);\n        this.history.pause(false);\n        this.updateIndices();\n        this.history.push({\n            tool: [\n                \"canvas\"\n            ],\n            action: \"duplicateLayer\",\n            params: [\n                i\n            ]\n        });\n        return i + 1;\n    }\n    getLayerContext(i, doReturnNull) {\n        if (this.layerCanvasArr[i]) return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[i]);\n        if (doReturnNull) return null;\n        throw new Error(\"layer of index \" + i + \" not found (in \" + this.layerCanvasArr.length + \" layers)\");\n    }\n    removeLayer(i) {\n        if (this.layerCanvasArr[i]) {\n            this.layerCanvasArr.splice(i, 1);\n            this.updateIndices();\n        } else return false;\n        this.history.push({\n            tool: [\n                \"canvas\"\n            ],\n            action: \"removeLayer\",\n            params: [\n                i\n            ]\n        });\n        return Math.max(0, i - 1);\n    }\n    renameLayer(i, name) {\n        if (this.layerCanvasArr[i]) this.layerCanvasArr[i].name = name;\n        else return false;\n        this.history.push({\n            tool: [\n                \"canvas\"\n            ],\n            action: \"renameLayer\",\n            params: [\n                i,\n                name\n            ]\n        });\n        return true;\n    }\n    layerOpacity(layerIndex, opacity) {\n        if (!this.layerCanvasArr[layerIndex]) return;\n        opacity = Math.max(0, Math.min(1, opacity));\n        this.layerCanvasArr[layerIndex].opacity = opacity;\n        this.history.push({\n            tool: [\n                \"canvas\"\n            ],\n            action: \"layerOpacity\",\n            params: [\n                layerIndex,\n                opacity\n            ]\n        });\n        this.emitChange();\n    }\n    setLayerIsVisible(layerIndex, isVisible) {\n        if (this.layerCanvasArr[layerIndex]) this.layerCanvasArr[layerIndex].isVisible = isVisible;\n        else throw new Error(`layer ${layerIndex} undefined`);\n        this.history.push({\n            tool: [\n                \"canvas\"\n            ],\n            action: \"setLayerIsVisible\",\n            params: [\n                layerIndex,\n                isVisible\n            ]\n        });\n    }\n    moveLayer(i, d) {\n        if (d === 0) return;\n        if (this.layerCanvasArr[i]) {\n            const temp = this.layerCanvasArr[i];\n            this.layerCanvasArr.splice(i, 1);\n            const targetIndex = Math.max(0, Math.min(i + d, this.layerCanvasArr.length));\n            this.layerCanvasArr.splice(targetIndex, 0, temp);\n            this.updateIndices();\n            this.history.push({\n                tool: [\n                    \"canvas\"\n                ],\n                action: \"moveLayer\",\n                params: [\n                    i,\n                    d\n                ]\n            });\n            return targetIndex;\n        }\n    }\n    mergeLayers(layerBottomIndex, layerTopIndex, mixModeStr) {\n        if (!this.layerCanvasArr[layerBottomIndex] || !this.layerCanvasArr[layerTopIndex] || layerBottomIndex === layerTopIndex) return;\n        //order messed up\n        if (layerBottomIndex > layerTopIndex) {\n            const temp = layerBottomIndex;\n            layerBottomIndex = layerTopIndex;\n            layerTopIndex = temp;\n        }\n        const topOpacity = this.layerCanvasArr[layerTopIndex].opacity;\n        if (topOpacity !== 0 && topOpacity) {\n            const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[layerBottomIndex]);\n            ctx.save();\n            if (mixModeStr === \"as-alpha\") {\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).convertToAlphaChannelCanvas(this.layerCanvasArr[layerTopIndex]);\n                ctx.globalCompositeOperation = \"destination-in\";\n                ctx.globalAlpha = topOpacity;\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[layerBottomIndex]).drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\n            } else {\n                if (mixModeStr) ctx.globalCompositeOperation = mixModeStr;\n                ctx.globalAlpha = topOpacity;\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[layerBottomIndex]).drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\n            }\n            ctx.restore();\n            mixModeStr && $d26b85e649dca02a$var$workaroundForChromium1281185(ctx);\n        }\n        this.updateIndices();\n        this.history.pause(true);\n        this.removeLayer(layerTopIndex);\n        this.history.pause(false);\n        this.history.push({\n            tool: [\n                \"canvas\"\n            ],\n            action: \"mergeLayers\",\n            params: [\n                layerBottomIndex,\n                layerTopIndex,\n                mixModeStr\n            ]\n        });\n        return layerBottomIndex;\n    }\n    mergeAll() {\n        if (this.layerCanvasArr.length === 1) return false;\n        // draw all on bottom layer\n        const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[0]);\n        for(let i = 1; i < this.layerCanvasArr.length; i++){\n            const current = this.layerCanvasArr[i];\n            if (!current.isVisible || current.opacity === 0) continue;\n            ctx.save();\n            ctx.globalCompositeOperation = current.mixModeStr;\n            ctx.globalAlpha = current.opacity;\n            ctx.drawImage(current, 0, 0);\n            ctx.restore();\n        }\n        this.history.pause(true);\n        // remove upper layers\n        for(let i = this.layerCanvasArr.length - 1; i > 0; i--)this.removeLayer(i);\n        // rename first layer to \"layer 1\"\n        this.renameLayer(0, (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-layer\") + \" 1\");\n        this.history.pause(false);\n        this.history.push({\n            tool: [\n                \"canvas\"\n            ],\n            action: \"mergeAll\",\n            params: []\n        });\n        return 0;\n    }\n    rotate(deg) {\n        while(deg < 0)deg += 360;\n        deg %= 360;\n        if (deg % 90 != 0 || deg === 0) return;\n        const temp = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas();\n        if (deg === 0 || deg === 180) {\n            temp.width = this.width;\n            temp.height = this.height;\n        } else if (deg === 90 || deg === 270) {\n            temp.width = this.height;\n            temp.height = this.width;\n        }\n        const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(temp);\n        for(let i = 0; i < this.layerCanvasArr.length; i++){\n            ctx.clearRect(0, 0, temp.width, temp.height);\n            ctx.save();\n            ctx.translate(temp.width / 2, temp.height / 2);\n            ctx.rotate(deg * Math.PI / 180);\n            if (deg === 180) ctx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\n            else if (deg === 90 || deg === 270) ctx.drawImage(this.layerCanvasArr[i], -temp.height / 2, -temp.width / 2);\n            this.layerCanvasArr[i].width = temp.width;\n            this.layerCanvasArr[i].height = temp.height;\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[i]).clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[i]).drawImage(temp, 0, 0);\n            ctx.restore();\n        }\n        this.width = temp.width;\n        this.height = temp.height;\n    }\n    flip(isHorizontal, isVertical, layerIndex) {\n        if (!isHorizontal && !isVertical) return;\n        const temp = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(this.width, this.height);\n        temp.width = this.width;\n        temp.height = this.height;\n        const tempCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(temp);\n        for(let i = 0; i < this.layerCanvasArr.length; i++){\n            if ((layerIndex || layerIndex === 0) && i !== layerIndex) continue;\n            tempCtx.save();\n            tempCtx.clearRect(0, 0, temp.width, temp.height);\n            tempCtx.translate(temp.width / 2, temp.height / 2);\n            tempCtx.scale(isHorizontal ? -1 : 1, isVertical ? -1 : 1);\n            tempCtx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\n            tempCtx.restore();\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[i]).clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[i]).drawImage(temp, 0, 0);\n        }\n    }\n    layerFill(layerIndex, colorObj, compositeOperation) {\n        const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[layerIndex]);\n        ctx.save();\n        if (compositeOperation) ctx.globalCompositeOperation = compositeOperation;\n        ctx.fillStyle = \"rgba(\" + colorObj.r + \",\" + colorObj.g + \",\" + colorObj.b + \",1)\";\n        ctx.fillRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\n        ctx.restore();\n        // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\n        // TODO remove if chrome updated\n        ctx.save();\n        ctx.fillStyle = \"rgba(0,0,0,0.01)\";\n        ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\n        ctx.restore();\n        /*if (!document.getElementById('testocanvas')) {\n            layerCanvasArr[layerIndex].id = 'testocanvas';\n            document.body.append(layerCanvasArr[layerIndex]);\n            BB.css(layerCanvasArr[layerIndex], {\n                position: 'fixed',\n                left: '0',\n                top: '0',\n                zIndex: '1111111',\n                transform: 'scale(0.2)',\n                border: '10px solid red',\n            });\n        }\n        if (!document.getElementById('testocanvas')) {\n            let c = document.createElement('canvas');\n            c.width = 1000;\n            c.height = 1000;\n            let ctx2 = c.getContext('2d');\n            ctx2.drawImage(layerCanvasArr[layerIndex], 0, 0);\n            c.id = 'testocanvas';\n            document.body.append(c);\n            BB.css(c, {\n                position: 'fixed',\n                left: '0',\n                top: '0',\n                zIndex: '1111111',\n                transform: 'scale(0.2)',\n                border: '10px solid red',\n            });\n        }*/ this.history.push({\n            tool: [\n                \"canvas\"\n            ],\n            action: \"layerFill\",\n            params: [\n                layerIndex,\n                colorObj,\n                compositeOperation\n            ]\n        });\n    }\n    floodFill(layerIndex, x, y, rgb, opacity, tolerance, sampleStr, grow, isContiguous) {\n        if (x < 0 || y < 0 || x >= this.width || y >= this.height || opacity === 0) return;\n        tolerance = Math.round(tolerance);\n        if (![\n            \"above\",\n            \"current\",\n            \"all\"\n        ].includes(sampleStr)) throw new Error(\"invalid sampleStr\");\n        let result;\n        let targetCtx;\n        let targetImageData;\n        if (sampleStr === \"all\") {\n            const srcCanvas = this.layerCanvasArr.length === 1 ? this.layerCanvasArr[0] : this.getCompleteCanvas(1);\n            const srcCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(srcCanvas);\n            const srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\n            const srcData = srcImageData.data;\n            result = (0, $469fa98e1403db53$export$13d50f258a8034f)(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\n            targetCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[layerIndex]);\n            targetImageData = targetCtx.getImageData(0, 0, this.width, this.height);\n        } else {\n            const srcIndex = sampleStr === \"above\" ? layerIndex + 1 : layerIndex;\n            if (srcIndex >= this.layerCanvasArr.length) return;\n            const srcCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[srcIndex]);\n            const srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\n            const srcData = srcImageData.data;\n            result = (0, $469fa98e1403db53$export$13d50f258a8034f)(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\n            targetCtx = layerIndex === srcIndex ? srcCtx : (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[layerIndex]);\n            targetImageData = layerIndex === srcIndex ? srcImageData : targetCtx.getImageData(0, 0, this.width, this.height);\n        }\n        const targetData = targetImageData.data;\n        if (rgb) {\n            if (opacity === 1) {\n                for(let i = 0; i < this.width * this.height; i++)if (result.data[i] === 255) {\n                    targetData[i * 4] = rgb.r;\n                    targetData[i * 4 + 1] = rgb.g;\n                    targetData[i * 4 + 2] = rgb.b;\n                    targetData[i * 4 + 3] = 255;\n                }\n            } else {\n                for(let i = 0; i < this.width * this.height; i++)if (result.data[i] === 255) {\n                    targetData[i * 4] = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(targetData[i * 4], rgb.r, opacity);\n                    targetData[i * 4 + 1] = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(targetData[i * 4 + 1], rgb.g, opacity);\n                    targetData[i * 4 + 2] = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(targetData[i * 4 + 2], rgb.b, opacity);\n                    targetData[i * 4 + 3] = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(targetData[i * 4 + 3], 255, opacity);\n                }\n            }\n        } else if (opacity === 1) {\n            for(let i = 0; i < this.width * this.height; i++)if (result.data[i] === 255) targetData[i * 4 + 3] = 0;\n        } else {\n            for(let i = 0; i < this.width * this.height; i++)if (result.data[i] === 255) targetData[i * 4 + 3] = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(targetData[i * 4 + 3], 0, opacity);\n        }\n        targetCtx.putImageData(targetImageData, 0, 0);\n        this.history.push({\n            tool: [\n                \"canvas\"\n            ],\n            action: \"replaceLayer\",\n            params: [\n                layerIndex,\n                targetImageData\n            ]\n        });\n    }\n    /**\n     * draw shape via BB.drawShape\n     * @param layerIndex\n     * @param shapeObj\n     */ drawShape(layerIndex, shapeObj) {\n        if (shapeObj.x1 === shapeObj.x2 && shapeObj.y1 === shapeObj.y2) return;\n        (0, $583d130d11db85ad$export$71b514a25c47df50)((0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[layerIndex]), shapeObj);\n        this.history.push({\n            tool: [\n                \"canvas\"\n            ],\n            action: \"drawShape\",\n            params: [\n                layerIndex,\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(shapeObj)\n            ]\n        });\n    }\n    drawGradient(layerIndex, gradientObj) {\n        (0, $64881aa9f7f8f596$export$b1f70a113e3b5c1b)((0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[layerIndex]), gradientObj);\n        this.history.push({\n            tool: [\n                \"canvas\"\n            ],\n            action: \"drawGradient\",\n            params: [\n                layerIndex,\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(gradientObj)\n            ]\n        });\n    }\n    text(layerIndex, p) {\n        (0, $67e715fe604c9329$export$482c90f94eb9717c)(this.layerCanvasArr[layerIndex], (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(p));\n        this.history.push({\n            tool: [\n                \"canvas\"\n            ],\n            action: \"text\",\n            params: [\n                layerIndex,\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(p)\n            ]\n        });\n    }\n    replaceLayer(layerIndex, imageData) {\n        const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[layerIndex]);\n        ctx.putImageData(imageData, 0, 0);\n        this.history.push({\n            tool: [\n                \"canvas\"\n            ],\n            action: \"replaceLayer\",\n            params: [\n                layerIndex,\n                imageData\n            ]\n        });\n    }\n    clearLayer(layerIndex) {\n        const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[layerIndex]);\n        ctx.save();\n        ctx.clearRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\n        ctx.restore();\n        this.history.push({\n            tool: [\n                \"canvas\"\n            ],\n            action: \"clearLayer\",\n            params: [\n                layerIndex\n            ]\n        });\n    }\n    getLayers() {\n        return this.layerCanvasArr.map((item)=>{\n            return {\n                context: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(item),\n                isVisible: item.isVisible,\n                opacity: item.opacity,\n                name: item.name,\n                mixModeStr: item.mixModeStr\n            };\n        });\n    }\n    getLayersFast() {\n        return this.layerCanvasArr.map((item)=>{\n            return {\n                canvas: item,\n                isVisible: item.isVisible,\n                opacity: item.opacity,\n                name: item.name,\n                mixModeStr: item.mixModeStr\n            };\n        });\n    }\n    getLayerIndex(canvasObj, doReturnNull) {\n        for(let i = 0; i < this.layerCanvasArr.length; i++){\n            if (this.layerCanvasArr[i] === canvasObj) return i;\n        }\n        if (!doReturnNull) throw new Error(\"layer not found (in \" + this.layerCanvasArr.length + \" layers)\");\n        return null;\n    }\n    getLayer(index, doReturnNull) {\n        if (this.layerCanvasArr[index]) return {\n            context: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[index]),\n            isVisible: this.layerCanvasArr[index].isVisible,\n            opacity: this.layerCanvasArr[index].opacity,\n            name: this.layerCanvasArr[index].name,\n            id: index\n        };\n        if (!doReturnNull) throw new Error(\"layer of index \" + index + \" not found (in \" + this.layerCanvasArr.length + \" layers)\");\n        return null;\n    }\n    getColorAt(x, y) {\n        x = Math.floor(x);\n        y = Math.floor(y);\n        const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.pickCanvas);\n        ctx.save();\n        ctx.imageSmoothingEnabled = false;\n        ctx.clearRect(0, 0, 1, 1);\n        for(let i = 0; i < this.layerCanvasArr.length; i++){\n            const layer = this.layerCanvasArr[i];\n            if (!layer.isVisible || layer.opacity === 0) continue;\n            ctx.globalAlpha = layer.opacity;\n            ctx.globalCompositeOperation = layer.mixModeStr;\n            ctx.drawImage(layer, -x, -y);\n        }\n        ctx.restore();\n        const imData = ctx.getImageData(0, 0, 1, 1);\n        return new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).RGB(imData.data[0], imData.data[1], imData.data[2]);\n    }\n    getCompleteCanvas(factor) {\n        return (0, $2b8bf7b32e5ba51f$export$5f63a7b18dc4503a)(this.getProject(), factor);\n    }\n    getProject() {\n        return {\n            width: this.width,\n            height: this.height,\n            layers: this.layerCanvasArr.map((layer)=>{\n                return {\n                    name: layer.name,\n                    isVisible: layer.isVisible,\n                    opacity: layer.opacity,\n                    mixModeStr: layer.mixModeStr,\n                    image: layer\n                };\n            })\n        };\n    }\n    addChangeListener(func) {\n        if (this.changeListenerArr.includes(func)) return;\n        this.changeListenerArr.push(func);\n    }\n    removeChangeListener(func) {\n        for(let i = 0; i < this.changeListenerArr.length; i++)if (this.changeListenerArr[i] === func) {\n            this.changeListenerArr.splice(i, 1);\n            return;\n        }\n    }\n    setMixMode(layerIndex, mixModeStr) {\n        if (!this.layerCanvasArr[layerIndex]) throw new Error(\"invalid layer\");\n        this.layerCanvasArr[layerIndex].mixModeStr = mixModeStr;\n        this.history.push({\n            tool: [\n                \"canvas\"\n            ],\n            action: \"setMixMode\",\n            params: [\n                layerIndex,\n                \"\" + mixModeStr\n            ]\n        });\n    }\n    /**\n     * Set composite drawing step for KlCanvasWorkspace.\n     * To apply temporary manipulations to a layer.\n     *\n     * @param layerIndex\n     * @param compositeObj\n     */ setComposite(layerIndex, compositeObj) {\n        if (!this.layerCanvasArr[layerIndex]) throw new Error(\"invalid layer\");\n        this.layerCanvasArr[layerIndex].compositeObj = (0, $fc4403c8ee6a33dc$export$d802c22d109d9806)(compositeObj);\n    }\n    destroy() {\n        if (this.isDestroyed) return;\n        this.layerCanvasArr.forEach((canvas)=>{\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).freeCanvas(canvas);\n        });\n        this.layerCanvasArr = [];\n        this.isDestroyed = true;\n    }\n    // ---- public ----\n    constructor(params, layerNrOffset = 0){\n        this.layerNrOffset = layerNrOffset;\n        this.isDestroyed = false;\n        this.layerCanvasArr = [];\n        this.pickCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(1, 1);\n        this.history = new (0, $d2dccce11beb16cf$export$2a772a91f059c0f9)();\n        if (\"copy\" in params) {\n            this.width = 1;\n            this.height = 1;\n        } else if (\"width\" in params && \"height\" in params) {\n            this.width = params.width;\n            this.height = params.height;\n        } else {\n            this.width = 1;\n            this.height = 1;\n        }\n        this.init(this.width, this.height);\n        this.changeListenerArr = [];\n        if (\"copy\" in params) try {\n            this.copy(params.copy);\n        } catch (e) {\n            this.destroy();\n            throw e;\n        }\n        else if (\"projectObj\" in params) {\n            const inLayers = [\n                ...params.projectObj.layers\n            ];\n            this.init(params.projectObj.width, params.projectObj.height);\n            if (!inLayers.length) throw new Error(\"project.layers needs at least 1 layer\");\n            for(let i = 0; i < inLayers.length; i++){\n                const mixModeStr = inLayers[i].mixModeStr;\n                if (mixModeStr && !$d26b85e649dca02a$var$allowedMixModes.includes(mixModeStr)) throw new Error(\"unknown mixModeStr \" + inLayers[i].mixModeStr);\n                this.addLayer();\n                this.layerOpacity(i, inLayers[i].opacity);\n                this.layerCanvasArr[i].name = inLayers[i].name;\n                this.layerCanvasArr[i].isVisible = inLayers[i].isVisible;\n                this.layerCanvasArr[i].mixModeStr = mixModeStr || \"source-over\";\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerCanvasArr[i]).drawImage(inLayers[i].image, 0, 0);\n            }\n        }\n        this.updateIndices();\n    }\n}\n\n\n\n\nfunction $326f2f7e3662b29f$export$6e1bedb2a6cdff30(blendMode) {\n    if (!blendMode) return (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-blend-normal\");\n    const codes = {\n        \"source-over\": \"layers-blend-normal\",\n        \"darken\": \"layers-blend-darken\",\n        \"multiply\": \"layers-blend-multiply\",\n        \"color-burn\": \"layers-blend-color-burn\",\n        \"lighten\": \"layers-blend-lighten\",\n        \"screen\": \"layers-blend-screen\",\n        \"color-dodge\": \"layers-blend-color-dodge\",\n        \"overlay\": \"layers-blend-overlay\",\n        \"soft-light\": \"layers-blend-soft-light\",\n        \"hard-light\": \"layers-blend-hard-light\",\n        \"difference\": \"layers-blend-difference\",\n        \"exclusion\": \"layers-blend-exclusion\",\n        \"hue\": \"layers-blend-hue\",\n        \"saturation\": \"layers-blend-saturation\",\n        \"color\": \"layers-blend-color\",\n        \"luminosity\": \"layers-blend-luminosity\"\n    };\n    if (!(blendMode in codes)) throw new Error(\"unknown blend mode\");\n    return (0, $63d0b335c576c718$export$ce37e184d908d785)(codes[blendMode]);\n}\n\n\n\n\n\nvar $4ef8c9863a7c659b$exports = {};\n\n$4ef8c9863a7c659b$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"remove-layer.4e9b2b7d.svg\";\n\n\nfunction $5ad3302d63918e0e$export$28debfc111084e87(parentEl, currentName, callback) {\n    const div = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n    const label = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-rename-name\") + \":\",\n        css: {\n            marginRight: \"5px\"\n        }\n    });\n    const row = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        css: {\n            display: \"flex\"\n        }\n    });\n    const input = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        tagName: \"input\"\n    });\n    input.value = currentName;\n    input.setAttribute(\"data-ignore-focus\", \"true\");\n    const clearBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        tagName: \"button\",\n        content: '<img src=\"' + (0, (/*@__PURE__*/$parcel$interopDefault($4ef8c9863a7c659b$exports))) + '\" height=\"20\"/>',\n        title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-rename-clear\"),\n        css: {\n            marginLeft: \"10px\"\n        },\n        onClick: ()=>{\n            input.value = \"\";\n            input.focus();\n        }\n    });\n    const suggestions = [\n        (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-rename-sketch\"),\n        (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-rename-colors\"),\n        (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-rename-shading\"),\n        (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-rename-lines\"),\n        (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-rename-effects\"),\n        (0, $63d0b335c576c718$export$ce37e184d908d785)(\"background\"),\n        (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-rename-foreground\")\n    ];\n    const suggestionBtns = [];\n    const row2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        css: {\n            display: \"flex\",\n            flexWrap: \"wrap\",\n            marginTop: \"5px\",\n            marginLeft: \"-5px\"\n        }\n    });\n    suggestions.forEach((item)=>{\n        const btn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: row2,\n            tagName: \"button\",\n            content: item,\n            onClick: ()=>{\n                input.value = \"\" + btn.textContent;\n            },\n            css: {\n                margin: \"5px 0 0 5px\"\n            }\n        });\n        suggestionBtns.push(btn);\n    });\n    div.append(label);\n    label.append(row, row2);\n    row.append(input, clearBtn);\n    setTimeout(()=>{\n        input.focus();\n        input.select();\n    }, 10);\n    (0, $2016c314bff36ab9$export$d7e8d4d4450c819c)({\n        target: parentEl,\n        message: `<b>${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-rename-title\")}</b>`,\n        div: div,\n        buttons: [\n            (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-rename\"),\n            \"Cancel\"\n        ],\n        primaries: [\n            (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-rename\")\n        ],\n        callback: (val)=>{\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(clearBtn);\n            suggestionBtns.forEach((item)=>{\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(item);\n            });\n            suggestionBtns.splice(0, suggestionBtns.length);\n            if (val === (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-rename\")) callback(input.value);\n            else callback(undefined);\n        },\n        clickOnEnter: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-rename\")\n    });\n}\n\n\n\n\n\n\n\n\nfunction $462b48dcae88059f$export$ee79aceabae6bb8a(parentEl, p) {\n    const div = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n    div.innerHTML = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-merge-description\");\n    const options = new (0, $1166276dc18d3ea9$export$c019608e5b5bb4cb)({\n        optionArr: [\n            {\n                id: p.mixModeStr,\n                label: (0, $326f2f7e3662b29f$export$6e1bedb2a6cdff30)(p.mixModeStr)\n            },\n            {\n                id: \"source-in\",\n                label: \"source-in\"\n            },\n            {\n                id: \"source-out\",\n                label: \"source-out\"\n            },\n            {\n                id: \"source-atop\",\n                label: \"source-atop\"\n            },\n            {\n                id: \"destination-in\",\n                label: \"destination-in\"\n            },\n            {\n                id: \"destination-out\",\n                label: \"destination-out\"\n            },\n            {\n                id: \"destination-atop\",\n                label: \"destination-atop\"\n            },\n            {\n                id: \"xor\",\n                label: \"xor\"\n            }\n        ],\n        initId: p.mixModeStr,\n        onChange: ()=>{\n            update();\n        },\n        isSmall: true\n    });\n    options.getElement().style.marginTop = \"5px\";\n    div.append(options.getElement());\n    const thumbDimensions = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).fitInto(p.topCanvas.width, p.topCanvas.height, 200, 200, 1);\n    const preview = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(thumbDimensions.width, thumbDimensions.height);\n    preview.title = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"preview\");\n    preview.className = \"kl-merge-preview\";\n    const spacer = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        content: \"<br/>\",\n        css: {\n            clear: \"both\"\n        }\n    });\n    div.append(spacer, preview);\n    function updateCheckerboard() {\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createCheckerDataUrl(4, (url)=>{\n            preview.style.backgroundImage = \"url(\" + url + \")\";\n        }, (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark());\n    }\n    updateCheckerboard();\n    (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).addIsDarkListener(updateCheckerboard);\n    const alphaCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyCanvas(preview);\n    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(alphaCanvas).drawImage(p.topCanvas, 0, 0, alphaCanvas.width, alphaCanvas.height);\n    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).convertToAlphaChannelCanvas(alphaCanvas);\n    const update = ()=>{\n        const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(preview);\n        ctx.save();\n        ctx.clearRect(0, 0, preview.width, preview.height);\n        if (preview.width > p.topCanvas.width) ctx.imageSmoothingEnabled = false;\n        ctx.drawImage(p.bottomCanvas, 0, 0, preview.width, preview.height);\n        if (options.getValue() === \"as-alpha\") {\n            ctx.globalCompositeOperation = \"destination-in\";\n            ctx.globalAlpha = p.topOpacity;\n            ctx.drawImage(alphaCanvas, 0, 0, preview.width, preview.height);\n        } else {\n            ctx.globalCompositeOperation = options.getValue();\n            ctx.globalAlpha = p.topOpacity;\n            ctx.drawImage(p.topCanvas, 0, 0, preview.width, preview.height);\n        }\n        ctx.restore();\n    };\n    update();\n    const keyListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).KeyListener({\n        onDown: (keyStr)=>{\n            if (keyStr === \"right\") options.next();\n            if (keyStr === \"left\") options.previous();\n        }\n    });\n    (0, $2016c314bff36ab9$export$d7e8d4d4450c819c)({\n        target: parentEl,\n        message: `<b>${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-merge-modal-title\")}</b>`,\n        div: div,\n        buttons: [\n            \"Ok\",\n            \"Cancel\"\n        ],\n        clickOnEnter: \"Ok\",\n        callback: (val)=>{\n            keyListener.destroy();\n            options.destroy();\n            (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).removeIsDarkListener(updateCheckerboard);\n            if (val === \"Ok\") p.callback(options.getValue());\n        }\n    });\n}\n\n\n\n\n\n\n\n\nclass $be599a9dc46f5101$export$e44a253a59704894 {\n    getElement() {\n        return this.rootElement;\n    }\n    setEnabled(id, enabled) {\n        this.onSetEnabled(id, enabled);\n    }\n    // ---- public ----\n    constructor(p){\n        this.isExpanded = false;\n        this.onSetEnabled = ()=>0;\n        const button = (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\"button,w-full,h-full\", [\n            p.button\n        ]);\n        button.onclick = ()=>{\n            toggle(!this.isExpanded);\n        };\n        if (p.buttonTitle) button.title = p.buttonTitle;\n        (0, $52ad4d7a7d6372c1$export$6bd63bfceaafae0c)(button);\n        const items = [];\n        const itemMap = {};\n        p.items.forEach((item)=>{\n            const itemButton = (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\"button\", item[1]);\n            (0, $52ad4d7a7d6372c1$export$6bd63bfceaafae0c)(itemButton);\n            itemButton.onclick = ()=>{\n                toggle(false);\n                p.onItemClick(item[0]);\n            };\n            items.push(itemButton);\n            itemMap[item[0]] = itemButton;\n        });\n        this.onSetEnabled = (id, enabled)=>{\n            itemMap[id].disabled = !enabled;\n        };\n        const menu = (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\".kl-dropdown-menu,right-0,top-full,nowrap,hidden\", items);\n        this.rootElement = (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\",pos-relative\", [\n            button,\n            menu\n        ]);\n        const toggle = (force)=>{\n            this.isExpanded = force;\n            menu.style.display = this.isExpanded ? \"block\" : \"none\";\n            if (this.isExpanded) {\n                document.addEventListener(\"pointerdown\", onPointerDown);\n                window.addEventListener(\"blur\", onBlur);\n            } else {\n                document.removeEventListener(\"pointerdown\", onPointerDown);\n                window.removeEventListener(\"blur\", onBlur);\n            }\n        };\n        const onPointerDown = (e)=>{\n            const target = e.target;\n            if (button.contains(target) || menu.contains(target)) return;\n            toggle(false);\n        };\n        const onBlur = ()=>toggle(false);\n    }\n}\n\n\nvar $ba2d502a1716cf71$exports = {};\n\n$ba2d502a1716cf71$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"add-layer.ce1078bb.svg\";\n\n\nvar $354ec009c03792ca$exports = {};\n\n$354ec009c03792ca$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"duplicate-layer.3314e3c7.svg\";\n\n\nvar $11941175d9bc2cc9$exports = {};\n\n$11941175d9bc2cc9$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"merge-layers.19da79a6.svg\";\n\n\n\nvar $26ad1ae4e7165e60$exports = {};\n\n$26ad1ae4e7165e60$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"rename-layer.7c31d4f4.svg\";\n\n\nvar $7a2d968e7fdd2ce9$exports = {};\n\n$7a2d968e7fdd2ce9$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"caret-down.68d4cd16.svg\";\n\n\nconst $7fe81e538d204f0d$var$paddingLeft = 25;\nclass $7fe81e538d204f0d$export$eff87c52915dd7fe {\n    move(oldSpotIndex, newSpotIndex) {\n        if (isNaN(oldSpotIndex) || isNaN(newSpotIndex)) throw \"layermanager - invalid move\";\n        for(let i = 0; i < this.klCanvasLayerArr.length; i++)((i)=>{\n            let posy = this.layerElArr[i].spot; // <- here\n            if (this.layerElArr[i].spot === oldSpotIndex) posy = newSpotIndex;\n            else {\n                if (this.layerElArr[i].spot > oldSpotIndex) posy--;\n                if (posy >= newSpotIndex) posy++;\n            }\n            this.layerElArr[i].spot = posy;\n            this.layerElArr[i].posY = (this.layerHeight + this.layerSpacing) * (this.klCanvasLayerArr.length - posy - 1);\n            this.layerElArr[i].style.top = this.layerElArr[i].posY + \"px\";\n        })(i);\n        if (oldSpotIndex === newSpotIndex) return;\n        this.klCanvas.moveLayer(this.selectedSpotIndex, newSpotIndex - oldSpotIndex);\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\n        this.selectedSpotIndex = newSpotIndex;\n        this.mergeBtn.disabled = this.selectedSpotIndex === 0;\n    }\n    posToSpot(p) {\n        let result = parseInt(\"\" + (p / (this.layerHeight + this.layerSpacing) + 0.5));\n        result = Math.min(this.klCanvasLayerArr.length - 1, Math.max(0, result));\n        result = this.klCanvasLayerArr.length - result - 1;\n        return result;\n    }\n    /**\n     * update css position of all layers that are not being dragged, while dragging\n     */ updateLayersVerticalPosition(id, newspot) {\n        newspot = Math.min(this.klCanvasLayerArr.length - 1, Math.max(0, newspot));\n        if (newspot === this.lastpos) return;\n        for(let i = 0; i < this.klCanvasLayerArr.length; i++){\n            if (this.layerElArr[i].spot === id) continue;\n            let posy = this.layerElArr[i].spot;\n            if (this.layerElArr[i].spot > id) posy--;\n            if (posy >= newspot) posy++;\n            this.layerElArr[i].posY = (this.layerHeight + this.layerSpacing) * (this.klCanvasLayerArr.length - posy - 1);\n            this.layerElArr[i].style.top = this.layerElArr[i].posY + \"px\";\n        }\n        this.lastpos = newspot;\n    }\n    renameLayer(layerSpot) {\n        (0, $5ad3302d63918e0e$export$28debfc111084e87)(this.parentEl, this.klCanvas.getLayer(layerSpot).name, (newName)=>{\n            if (newName === undefined || newName === this.klCanvas.getLayer(layerSpot).name) return;\n            this.klCanvas.renameLayer(layerSpot, newName);\n            this.createLayerList();\n            (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(true);\n            this.onSelect(layerSpot);\n            (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(false);\n        });\n    }\n    updateHeight() {\n        this.layerListEl.style.height = this.layerElArr.length * 35 + \"px\";\n    }\n    createLayerList() {\n        this.oldHistoryState = (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).getState();\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\n        const checkerImUrl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createCheckerDataUrl(4, undefined, (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark());\n        const createLayerEntry = (index)=>{\n            const klLayer = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.klCanvas.getLayer(index));\n            const layerName = klLayer.name;\n            const opacity = this.klCanvasLayerArr[index].opacity;\n            const isVisible = klLayer.isVisible;\n            const layercanvas = this.klCanvasLayerArr[index].context.canvas;\n            const layer = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                className: \"kl-layer\"\n            });\n            this.layerElArr[index] = layer;\n            layer.posY = (this.klCanvasLayerArr.length - 1) * 35 - index * 35;\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(layer, {\n                top: layer.posY + \"px\"\n            });\n            const innerLayer = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(innerLayer, {\n                position: \"relative\"\n            });\n            const container1 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(container1, {\n                width: \"270px\",\n                height: \"34px\"\n            });\n            const container2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n            layer.append(innerLayer);\n            innerLayer.append(container1, container2);\n            layer.spot = index;\n            //checkbox - visibility\n            {\n                const checkWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    tagName: \"label\",\n                    parent: container1,\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-visibility-toggle\"),\n                    css: {\n                        display: \"flex\",\n                        width: \"25px\",\n                        height: \"100%\",\n                        justifyContent: \"right\",\n                        alignItems: \"center\",\n                        cursor: \"pointer\"\n                    }\n                });\n                const check = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    tagName: \"input\",\n                    parent: checkWrapper,\n                    custom: {\n                        type: \"checkbox\",\n                        tabindex: \"-1\"\n                    },\n                    css: {\n                        display: \"block\",\n                        cursor: \"pointer\",\n                        margin: \"0\",\n                        marginRight: \"5px\"\n                    }\n                });\n                check.checked = isVisible;\n                check.onchange = ()=>{\n                    this.klCanvas.setLayerIsVisible(layer.spot, check.checked);\n                    this.createLayerList();\n                    if (layer.spot === this.selectedSpotIndex) {\n                        (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(true);\n                        this.onSelect(this.selectedSpotIndex);\n                        (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(false);\n                    }\n                };\n                // prevent layer getting dragged\n                const preventFunc = (e)=>{\n                    e.preventDefault();\n                    e.stopPropagation();\n                };\n                if (0, $604d9bbf77127967$export$b7b64c480b083ae0) checkWrapper.onpointerdown = preventFunc;\n                else checkWrapper.onmousedown = preventFunc;\n            }\n            //thumb\n            {\n                const thumbDimensions = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).fitInto(layercanvas.width, layercanvas.height, 30, 30, 1);\n                layer.thumb = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(thumbDimensions.width, thumbDimensions.height);\n                const thc = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(layer.thumb);\n                thc.save();\n                if (layer.thumb.width > layercanvas.width) thc.imageSmoothingEnabled = false;\n                thc.drawImage(layercanvas, 0, 0, layer.thumb.width, layer.thumb.height);\n                thc.restore();\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(layer.thumb, {\n                    position: \"absolute\",\n                    left: (32 - layer.thumb.width) / 2 + $7fe81e538d204f0d$var$paddingLeft + \"px\",\n                    top: (32 - layer.thumb.height) / 2 + 1 + \"px\"\n                });\n                layer.thumb.style.backgroundImage = \"url(\" + checkerImUrl + \")\";\n            }\n            layer.label = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                className: \"kl-layer__label\"\n            });\n            layer.layerName = layerName;\n            layer.label.append(layer.layerName);\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(layer.label, {\n                position: \"absolute\",\n                left: 38 + $7fe81e538d204f0d$var$paddingLeft + \"px\",\n                top: \"1px\",\n                fontSize: \"13px\",\n                width: \"170px\",\n                height: \"20px\",\n                overflow: \"hidden\",\n                whiteSpace: \"nowrap\"\n            });\n            layer.label.ondblclick = ()=>{\n                this.renameLayer(layer.spot);\n            };\n            layer.opacityLabel = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                className: \"kl-layer__opacity-label\"\n            });\n            layer.opacity = opacity;\n            layer.opacityLabel.append(parseInt(\"\" + layer.opacity * 100) + \"%\");\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(layer.opacityLabel, {\n                position: \"absolute\",\n                left: 189 + $7fe81e538d204f0d$var$paddingLeft + \"px\",\n                top: \"1px\",\n                fontSize: \"13px\",\n                textAlign: \"right\",\n                width: \"50px\",\n                transition: \"color 0.2s ease-in-out\",\n                textDecoration: isVisible ? undefined : \"line-through\"\n            });\n            let oldOpacity;\n            const opacitySlider = new (0, $867da577d723d824$export$ac00cea56cec3037)({\n                init: layer.opacity,\n                width: 200,\n                pointSize: 14,\n                callback: (sliderValue, isFirst, isLast)=>{\n                    if (isFirst) {\n                        oldOpacity = this.klCanvas.getLayer(layer.spot).opacity;\n                        (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(true);\n                        return;\n                    }\n                    if (isLast) {\n                        (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(false);\n                        if (oldOpacity !== sliderValue) this.klCanvas.layerOpacity(layer.spot, sliderValue);\n                        return;\n                    }\n                    layer.opacityLabel.innerHTML = Math.round(sliderValue * 100) + \"%\";\n                    this.klCanvas.layerOpacity(layer.spot, sliderValue);\n                }\n            });\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(opacitySlider.getEl(), {\n                position: \"absolute\",\n                left: 39 + $7fe81e538d204f0d$var$paddingLeft + \"px\",\n                top: \"17px\"\n            });\n            layer.opacitySlider = opacitySlider;\n            //larger layer preview - hover\n            layer.thumb.onpointerover = (e)=>{\n                if (e.buttons !== 0 && (!e.pointerType || e.pointerType !== \"touch\")) return;\n                const thumbDimensions = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).fitInto(layercanvas.width, layercanvas.height, 250, 250, 1);\n                if (this.largeThumbCanvas.width !== thumbDimensions.width || this.largeThumbCanvas.height !== thumbDimensions.height) {\n                    this.largeThumbCanvas.width = thumbDimensions.width;\n                    this.largeThumbCanvas.height = thumbDimensions.height;\n                }\n                const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.largeThumbCanvas);\n                ctx.save();\n                if (this.largeThumbCanvas.width > layercanvas.width) ctx.imageSmoothingEnabled = false;\n                ctx.imageSmoothingQuality = \"high\";\n                ctx.clearRect(0, 0, this.largeThumbCanvas.width, this.largeThumbCanvas.height);\n                ctx.drawImage(layercanvas, 0, 0, this.largeThumbCanvas.width, this.largeThumbCanvas.height);\n                ctx.restore();\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.largeThumbDiv, {\n                    top: e.clientY - this.largeThumbCanvas.height / 2 + \"px\",\n                    opacity: \"0\"\n                });\n                if (!this.largeThumbInDocument) {\n                    document.body.append(this.largeThumbDiv);\n                    this.largeThumbInDocument = true;\n                }\n                clearTimeout(this.largeThumbInTimeout);\n                this.largeThumbInTimeout = setTimeout(()=>{\n                    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.largeThumbDiv, {\n                        opacity: \"1\"\n                    });\n                }, 20);\n                clearTimeout(this.largeThumbTimeout);\n            };\n            layer.thumb.onpointerout = ()=>{\n                clearTimeout(this.largeThumbInTimeout);\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.largeThumbDiv, {\n                    opacity: \"0\"\n                });\n                clearTimeout(this.largeThumbTimeout);\n                this.largeThumbTimeout = setTimeout(()=>{\n                    if (!this.largeThumbInDocument) return;\n                    this.largeThumbDiv.remove();\n                    this.largeThumbInDocument = false;\n                }, 300);\n            };\n            container1.append(layer.thumb, layer.label, layer.opacityLabel, opacitySlider.getEl());\n            let dragstart = false;\n            let freshSelection = false;\n            //events for moving layers up and down\n            const dragEventHandler = (event)=>{\n                if (event.type === \"pointerdown\" && event.button === \"left\") {\n                    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(layer, {\n                        transition: \"box-shadow 0.3s ease-in-out\"\n                    });\n                    layer.style.zIndex = \"1\";\n                    this.lastpos = layer.spot;\n                    freshSelection = false;\n                    if (!layer.isSelected) {\n                        freshSelection = true;\n                        this.activateLayer(layer.spot);\n                    }\n                    dragstart = true;\n                } else if (event.type === \"pointermove\" && event.button === \"left\") {\n                    if (dragstart) {\n                        dragstart = false;\n                        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(layer, {\n                            boxShadow: \"1px 3px 5px rgba(0,0,0,0.4)\"\n                        });\n                    }\n                    layer.posY += event.dY;\n                    const corrected = Math.max(0, Math.min((this.klCanvasLayerArr.length - 1) * 35, layer.posY));\n                    layer.style.top = corrected + \"px\";\n                    this.updateLayersVerticalPosition(layer.spot, this.posToSpot(layer.posY));\n                }\n                if (event.type === \"pointerup\") {\n                    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(layer, {\n                        transition: \"all 0.1s linear\"\n                    });\n                    setTimeout(()=>{\n                        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(layer, {\n                            boxShadow: \"\"\n                        });\n                    }, 20);\n                    layer.posY = Math.max(0, Math.min((this.klCanvasLayerArr.length - 1) * 35, layer.posY));\n                    layer.style.zIndex = \"\";\n                    const newSpot = this.posToSpot(layer.posY);\n                    const oldSpot = layer.spot;\n                    this.move(layer.spot, newSpot);\n                    if (oldSpot != newSpot) {\n                        (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(true);\n                        this.onSelect(this.selectedSpotIndex);\n                        (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(false);\n                    }\n                    if (oldSpot === newSpot && freshSelection) this.onSelect(this.selectedSpotIndex);\n                    freshSelection = false;\n                }\n            };\n            layer.pointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n                target: container1,\n                onPointer: dragEventHandler\n            });\n            this.layerListEl.append(layer);\n        };\n        this.layerElArr = [];\n        while(this.layerListEl.firstChild){\n            const child = this.layerListEl.firstChild;\n            child.pointerListener.destroy();\n            child.opacitySlider.destroy();\n            child.remove();\n        }\n        for(let i = 0; i < this.klCanvasLayerArr.length; i++)createLayerEntry(i);\n        this.activateLayer(this.selectedSpotIndex);\n        this.updateHeight();\n    }\n    updateButtons() {\n        const maxReached = this.klCanvasLayerArr.length === (0, $d26b85e649dca02a$export$9f4f73b1bd7c2f26);\n        const oneLayer = this.klCanvasLayerArr.length === 1;\n        this.addBtn.disabled = maxReached;\n        this.removeBtn.disabled = oneLayer;\n        this.duplicateBtn.disabled = maxReached;\n        this.mergeBtn.disabled = this.selectedSpotIndex === 0;\n        this.moreDropdown.setEnabled(\"merge-all\", !oneLayer);\n    }\n    // ---- interface ----\n    update(activeLayerSpotIndex) {\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\n        if (activeLayerSpotIndex || activeLayerSpotIndex === 0) this.selectedSpotIndex = activeLayerSpotIndex;\n        this.updateButtons();\n        setTimeout(()=>this.createLayerList(), 1);\n    }\n    getSelected() {\n        return this.selectedSpotIndex;\n    }\n    activateLayer(spotIndex) {\n        if (spotIndex < 0 || spotIndex > this.layerElArr.length - 1) throw \"invalid spotIndex \" + spotIndex + \", layerElArr.length \" + this.layerElArr.length;\n        this.selectedSpotIndex = spotIndex;\n        this.modeSelect.setValue(this.klCanvasLayerArr[this.selectedSpotIndex].mixModeStr);\n        for(let i = 0; i < this.layerElArr.length; i++){\n            const layer = this.layerElArr[i];\n            const isSelected = this.selectedSpotIndex === layer.spot;\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(layer, {\n                boxShadow: \"\"\n            });\n            layer.classList.toggle(\"kl-layer--selected\", isSelected);\n            layer.opacitySlider.setActive(isSelected);\n            layer.isSelected = isSelected;\n        }\n        this.mergeBtn.disabled = this.selectedSpotIndex === 0;\n    }\n    setUiState(stateStr) {\n        this.uiState = stateStr;\n        if (this.uiState === \"left\") (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.largeThumbDiv, {\n            left: \"280px\",\n            right: \"\"\n        });\n        else (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.largeThumbDiv, {\n            left: \"\",\n            right: \"280px\"\n        });\n    }\n    getElement() {\n        return this.rootEl;\n    }\n    // ---- public ----\n    constructor(klCanvas, onSelect, parentEl, uiState){\n        this.lastpos = 0;\n        this.layerHeight = 35;\n        this.layerSpacing = 0;\n        this.parentEl = parentEl;\n        this.klCanvas = klCanvas;\n        this.layerElArr = [];\n        this.layerHeight = 35;\n        this.layerSpacing = 0;\n        const width = 270;\n        this.onSelect = onSelect;\n        this.uiState = uiState;\n        this.largeThumbDiv = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            onClick: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).handleClick,\n            css: {\n                position: \"absolute\",\n                top: \"500px\",\n                background: \"#aaa\",\n                boxShadow: \"1px 1px 3px rgba(0,0,0,0.3)\",\n                pointerEvents: \"none\",\n                padding: \"0\",\n                border: \"1px solid #aaa\",\n                transition: \"opacity 0.3s ease-out\",\n                userSelect: \"none\"\n            }\n        });\n        this.setUiState(uiState);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createCheckerDataUrl(4, (url)=>{\n            this.largeThumbDiv.style.backgroundImage = \"url(\" + url + \")\";\n        }, (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark());\n        this.largeThumbCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(200, 200);\n        this.largeThumbCanvas.style.display = \"block\";\n        this.largeThumbDiv.append(this.largeThumbCanvas);\n        this.largeThumbInDocument = false;\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\n        this.selectedSpotIndex = this.klCanvasLayerArr.length - 1;\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                marginRight: \"10px\",\n                marginBottom: \"10px\",\n                marginLeft: \"10px\",\n                marginTop: \"10px\",\n                cursor: \"default\"\n            }\n        });\n        const listDiv = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                width: width + \"px\",\n                position: \"relative\",\n                margin: \"0 -10px\",\n                zIndex: \"0\"\n            }\n        });\n        this.layerListEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: listDiv\n        });\n        this.addBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"button\"\n        });\n        this.duplicateBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"button\"\n        });\n        this.mergeBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"button\"\n        });\n        this.removeBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"button\"\n        });\n        const renameBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"button\"\n        });\n        this.moreDropdown = new (0, $be599a9dc46f5101$export$e44a253a59704894)({\n            button: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                content: `<img src=\"${(0, (/*@__PURE__*/$parcel$interopDefault($7a2d968e7fdd2ce9$exports)))}\" width=\"13\"/>`,\n                css: {\n                    display: \"flex\",\n                    justifyContent: \"center\",\n                    opacity: \"0.9\"\n                }\n            }),\n            buttonTitle: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"more\"),\n            items: [\n                [\n                    \"merge-all\",\n                    (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-merge-all\")\n                ]\n            ],\n            onItemClick: (id)=>{\n                if (id === \"merge-all\") {\n                    const newIndex = this.klCanvas.mergeAll();\n                    if (newIndex === false) return;\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\n                    this.selectedSpotIndex = newIndex;\n                    this.createLayerList();\n                    (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(true);\n                    this.onSelect(this.selectedSpotIndex);\n                    (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(false);\n                    this.updateButtons();\n                }\n            }\n        });\n        this.updateButtons();\n        const createButtons = ()=>{\n            const div = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n            const async = ()=>{\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).makeUnfocusable(this.addBtn);\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).makeUnfocusable(this.duplicateBtn);\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).makeUnfocusable(this.mergeBtn);\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).makeUnfocusable(this.removeBtn);\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).makeUnfocusable(renameBtn);\n                this.addBtn.style.cssFloat = \"left\";\n                this.duplicateBtn.style.cssFloat = \"left\";\n                this.mergeBtn.style.cssFloat = \"left\";\n                this.removeBtn.style.cssFloat = \"left\";\n                renameBtn.style.cssFloat = \"left\";\n                this.addBtn.title = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-new\");\n                this.duplicateBtn.title = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-duplicate\");\n                this.removeBtn.title = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-remove\");\n                this.mergeBtn.title = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-merge\");\n                renameBtn.title = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-rename-title\");\n                this.addBtn.style.paddingLeft = \"5px\";\n                this.addBtn.style.paddingRight = \"3px\";\n                this.removeBtn.style.paddingLeft = \"5px\";\n                this.removeBtn.style.paddingRight = \"3px\";\n                this.duplicateBtn.style.paddingLeft = \"5px\";\n                this.duplicateBtn.style.paddingRight = \"3px\";\n                this.mergeBtn.style.paddingLeft = \"5px\";\n                this.mergeBtn.style.paddingRight = \"3px\";\n                renameBtn.style.height = \"30px\";\n                renameBtn.style.lineHeight = \"20px\";\n                this.addBtn.innerHTML = \"<img src='\" + (0, (/*@__PURE__*/$parcel$interopDefault($ba2d502a1716cf71$exports))) + \"' height='20'/>\";\n                this.duplicateBtn.innerHTML = \"<img src='\" + (0, (/*@__PURE__*/$parcel$interopDefault($354ec009c03792ca$exports))) + \"' height='20'/>\";\n                this.mergeBtn.innerHTML = \"<img src='\" + (0, (/*@__PURE__*/$parcel$interopDefault($11941175d9bc2cc9$exports))) + \"' height='20'/>\";\n                this.removeBtn.innerHTML = \"<img src='\" + (0, (/*@__PURE__*/$parcel$interopDefault($4ef8c9863a7c659b$exports))) + \"' height='20'/>\";\n                renameBtn.innerHTML = \"<img src='\" + (0, (/*@__PURE__*/$parcel$interopDefault($26ad1ae4e7165e60$exports))) + \"' height='20'/>\";\n                div.append((0, $934e5f47c3374e21$export$db3b6bfb95261072)(\",flex,gap-5,mb-10\", [\n                    this.addBtn,\n                    this.removeBtn,\n                    this.duplicateBtn,\n                    this.mergeBtn,\n                    renameBtn,\n                    (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\",grow-1\"),\n                    this.moreDropdown.getElement()\n                ]));\n                this.addBtn.onclick = ()=>{\n                    if (this.klCanvas.addLayer(this.selectedSpotIndex) === false) return;\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\n                    this.selectedSpotIndex = this.selectedSpotIndex + 1;\n                    this.createLayerList();\n                    (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(true);\n                    this.onSelect(this.selectedSpotIndex);\n                    (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(false);\n                    this.updateButtons();\n                };\n                this.duplicateBtn.onclick = ()=>{\n                    if (this.klCanvas.duplicateLayer(this.selectedSpotIndex) === false) return;\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\n                    this.selectedSpotIndex++;\n                    this.createLayerList();\n                    (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(true);\n                    this.onSelect(this.selectedSpotIndex);\n                    (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(false);\n                    this.updateButtons();\n                };\n                this.removeBtn.onclick = ()=>{\n                    if (this.layerElArr.length <= 1) return;\n                    this.klCanvas.removeLayer(this.selectedSpotIndex);\n                    if (this.selectedSpotIndex > 0) this.selectedSpotIndex--;\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\n                    this.createLayerList();\n                    (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(true);\n                    this.onSelect(this.selectedSpotIndex);\n                    (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(false);\n                    this.updateButtons();\n                };\n                this.mergeBtn.onclick = ()=>{\n                    if (this.selectedSpotIndex <= 0) return;\n                    (0, $462b48dcae88059f$export$ee79aceabae6bb8a)(this.parentEl, {\n                        topCanvas: this.klCanvasLayerArr[this.selectedSpotIndex].context.canvas,\n                        bottomCanvas: this.klCanvasLayerArr[this.selectedSpotIndex - 1].context.canvas,\n                        topOpacity: this.klCanvas.getLayer(this.selectedSpotIndex).opacity,\n                        mixModeStr: this.klCanvasLayerArr[this.selectedSpotIndex].mixModeStr,\n                        callback: (mode)=>{\n                            this.klCanvas.mergeLayers(this.selectedSpotIndex, this.selectedSpotIndex - 1, mode);\n                            this.klCanvasLayerArr = this.klCanvas.getLayers();\n                            this.selectedSpotIndex--;\n                            this.createLayerList();\n                            (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(true);\n                            this.onSelect(this.selectedSpotIndex);\n                            (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(false);\n                            this.updateButtons();\n                        }\n                    });\n                };\n                renameBtn.onclick = ()=>{\n                    this.renameLayer(this.selectedSpotIndex);\n                };\n            };\n            setTimeout(async, 1);\n            return div;\n        };\n        this.rootEl.append(createButtons());\n        let modeWrapper;\n        modeWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-blending\") + \"&nbsp;\",\n            css: {\n                fontSize: \"15px\"\n            }\n        });\n        this.modeSelect = new (0, $b1ef42bd443626ca$export$ef9b1a59e592288f)({\n            optionArr: [\n                \"source-over\",\n                undefined,\n                \"darken\",\n                \"multiply\",\n                \"color-burn\",\n                undefined,\n                \"lighten\",\n                \"screen\",\n                \"color-dodge\",\n                undefined,\n                \"overlay\",\n                \"soft-light\",\n                \"hard-light\",\n                undefined,\n                \"difference\",\n                \"exclusion\",\n                undefined,\n                \"hue\",\n                \"saturation\",\n                \"color\",\n                \"luminosity\"\n            ].map((item)=>{\n                return item ? [\n                    item,\n                    (0, $326f2f7e3662b29f$export$6e1bedb2a6cdff30)(item)\n                ] : undefined;\n            }),\n            onChange: (val)=>{\n                this.klCanvas.setMixMode(this.selectedSpotIndex, val);\n                this.update(this.selectedSpotIndex);\n            },\n            css: {\n                marginBottom: \"10px\"\n            }\n        });\n        modeWrapper.append(this.modeSelect.getElement());\n        this.rootEl.append(modeWrapper);\n        this.rootEl.append(listDiv);\n        //updating the thumbs in interval\n        //don't update when: manager not visible || layer didn't change || is drawing\n        setInterval(()=>{\n            if (this.rootEl.style.display !== \"block\") return;\n            const historyState = (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).getState();\n            if (historyState === this.oldHistoryState) return;\n            this.oldHistoryState = historyState;\n            for(let i = 0; i < this.layerElArr.length; i++)if (this.selectedSpotIndex === this.layerElArr[i].spot && this.klCanvasLayerArr[this.layerElArr[i].spot]) {\n                const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layerElArr[i].thumb);\n                ctx.save();\n                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n                if (this.klCanvasLayerArr[this.layerElArr[i].spot].context.canvas.width < this.layerElArr[i].thumb.width) ctx.imageSmoothingEnabled = false;\n                ctx.drawImage(this.klCanvasLayerArr[this.layerElArr[i].spot].context.canvas, 0, 0, this.layerElArr[i].thumb.width, this.layerElArr[i].thumb.height);\n                ctx.restore();\n            }\n        }, 1);\n        (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).addIsDarkListener(()=>{\n            this.createLayerList();\n        });\n        this.createLayerList();\n    }\n}\n\n\n\nclass $336ce3ce60e7688c$export$6b9252711ea5997f {\n    getElement() {\n        return this.rootElement;\n    }\n    setSize(width, height) {\n        this.rootElement.setAttribute(\"width\", \"\" + width);\n        this.rootElement.setAttribute(\"height\", \"\" + height);\n        this.compass.setAttribute(\"transform\", \"translate(\" + width / 2 + \", \" + height / 2 + \")\");\n    }\n    updateCursor(p) {\n        if (p.x !== undefined) {\n            this.brushCircleOuter.setAttribute(\"cx\", \"\" + p.x);\n            this.brushCircleInner.setAttribute(\"cx\", \"\" + p.x);\n        }\n        if (p.y !== undefined) {\n            this.brushCircleOuter.setAttribute(\"cy\", \"\" + p.y);\n            this.brushCircleInner.setAttribute(\"cy\", \"\" + p.y);\n        }\n        if (p.radius !== undefined) {\n            this.brushCircleOuter.setAttribute(\"r\", \"\" + Math.max(0, p.radius));\n            this.brushCircleInner.setAttribute(\"r\", \"\" + Math.max(0, p.radius - 1));\n        }\n        if (p.isVisible !== undefined) {\n            this.brushCircleOuter.style.opacity = p.isVisible ? \"1\" : \"0\";\n            this.brushCircleInner.style.opacity = p.isVisible ? \"1\" : \"0\";\n        }\n    }\n    updateColorPreview(p) {\n        if (p.x !== undefined) {\n            this.pickerPreviewCol.setAttribute(\"cx\", \"\" + p.x);\n            this.pickerPreviewBorder.setAttribute(\"cx\", \"\" + p.x);\n        }\n        if (p.y !== undefined) {\n            this.pickerPreviewCol.setAttribute(\"cy\", \"\" + p.y);\n            this.pickerPreviewBorder.setAttribute(\"cy\", \"\" + p.y);\n        }\n        if (p.color) {\n            this.pickerPreviewCol.setAttribute(\"stroke\", (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRgbStr(p.color));\n            const borderColor = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).testIsWhiteBestContrast(p.color) ? \"rgba(255,255,255,0.5)\" : \"rgba(0,0,0,0.5)\";\n            this.pickerPreviewBorder.setAttribute(\"stroke\", borderColor);\n        }\n        if (p.isVisible !== undefined) {\n            this.pickerPreviewCol.style.opacity = p.isVisible ? \"1\" : \"0\";\n            this.pickerPreviewBorder.style.opacity = p.isVisible ? \"1\" : \"0\";\n        }\n    }\n    updateCompass(p) {\n        if (p.angleDeg !== undefined) {\n            this.compassInner.setAttribute(\"transform\", \"rotate(\" + p.angleDeg + \")\");\n            this.compassLineCircle.style.opacity = p.angleDeg % 90 === 0 ? \"1\" : \"0\";\n        }\n        if (p.isVisible !== undefined) this.compass.style.opacity = p.isVisible ? \"1\" : \"0\";\n    }\n    // ---- public ----\n    constructor(p){\n        this.rootElement = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n            elementType: \"svg\",\n            width: \"\" + p.width,\n            height: \"\" + p.height\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.rootElement, {\n            position: \"absolute\",\n            left: \"0\",\n            top: \"0\",\n            pointerEvents: \"none\",\n            userSelect: \"none\"\n        });\n        //brush circles\n        this.brushCircleOuter = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n            elementType: \"circle\",\n            r: \"10\",\n            stroke: \"rgba(0,0,0,0.7)\",\n            \"stroke-width\": \"1\",\n            fill: \"none\"\n        });\n        this.brushCircleInner = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n            elementType: \"circle\",\n            r: \"9\",\n            stroke: \"rgba(255,255,255,0.7)\",\n            \"stroke-width\": \"1\",\n            fill: \"none\"\n        });\n        this.rootElement.append(this.brushCircleOuter, this.brushCircleInner);\n        //color picker preview circle\n        this.pickerPreviewBorder = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n            elementType: \"circle\",\n            r: \"47\",\n            stroke: \"black\",\n            \"stroke-width\": \"22\",\n            fill: \"none\"\n        });\n        this.pickerPreviewBorder.style.opacity = \"0\";\n        this.pickerPreviewCol = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n            elementType: \"circle\",\n            r: \"47\",\n            stroke: \"black\",\n            \"stroke-width\": \"20\",\n            fill: \"none\"\n        });\n        this.pickerPreviewCol.style.opacity = \"0\";\n        this.rootElement.append(this.pickerPreviewBorder, this.pickerPreviewCol);\n        //rotation compass\n        this.compassSize = 30;\n        this.compass = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n            elementType: \"g\",\n            transform: \"translate(\" + p.width / 2 + \", \" + p.height / 2 + \")\"\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.compass, {\n            transition: \"opacity 0.25s ease-in-out\",\n            opacity: \"0\"\n        });\n        this.compassInner = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n            elementType: \"g\",\n            transform: \"rotate(45)\"\n        });\n        this.compassBaseCircle = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n            elementType: \"circle\",\n            fill: \"rgba(0,0,0,0.9)\",\n            stroke: \"none\",\n            cx: \"0\",\n            cy: \"0\",\n            r: \"\" + this.compassSize\n        });\n        this.compassLineCircle = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n            elementType: \"circle\",\n            fill: \"none\",\n            stroke: \"rgba(255,255,255,0.75)\",\n            \"stroke-width\": \"1\",\n            cx: \"0\",\n            cy: \"0\",\n            r: \"\" + this.compassSize * 0.9\n        });\n        this.compassUpperTriangle = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n            elementType: \"path\",\n            fill: \"#f00\",\n            stroke: \"none\",\n            d: \"M -\" + this.compassSize * 0.25 + \",0 \" + this.compassSize * 0.25 + \",0 0,-\" + this.compassSize * 0.9 + \" z\"\n        });\n        this.compassLowerTriangle = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n            elementType: \"path\",\n            fill: \"#fff\",\n            stroke: \"none\",\n            d: \"M -\" + this.compassSize * 0.25 + \",0 \" + this.compassSize * 0.25 + \",0 0,\" + this.compassSize * 0.9 + \" z\"\n        });\n        this.compassInner.append(this.compassBaseCircle, this.compassLineCircle, this.compassUpperTriangle, this.compassLowerTriangle);\n        this.compass.append(this.compassInner);\n        this.rootElement.append(this.compass);\n    }\n}\n\n\n\n\n\nvar $6fd92874f57fb7a5$exports = {};\n\n$6fd92874f57fb7a5$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"cursor-picker.dc155349.png\";\n\n\nvar $bbfe35d8993ac0b3$exports = {};\n\n$bbfe35d8993ac0b3$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"cursor-zoom-ew.9ecaf1c2.png\";\n\n\nvar $31fff149ff4d9066$exports = {};\n\n$31fff149ff4d9066$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"cursor-fill.999c4916.png\";\n\n\nvar $49c01d25d090419f$exports = {};\n\n$49c01d25d090419f$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"cursor-text.582bc0db.png\";\n\n\n\n\nconst $c840f4bdaa4c78fa$var$DIR_X = 0;\nconst $c840f4bdaa4c78fa$var$DIR_Y = 1;\nclass $c840f4bdaa4c78fa$export$d429e21f52463d17 {\n    process(event) {\n        if (event.type === \"down\") {\n            this.downEvent = event;\n            this.direction = null;\n            if (event.shiftIsPressed) {\n                this.onDraw({\n                    type: \"line\",\n                    x0: null,\n                    y0: null,\n                    pressure0: null,\n                    x1: event.x,\n                    y1: event.y,\n                    pressure1: event.pressure\n                });\n                this.eventQueue.push(event);\n                return;\n            }\n        }\n        if (event.type === \"move\" && this.downEvent) {\n            if (event.shiftIsPressed) {\n                if (this.direction === null) {\n                    const dX = Math.abs(event.x - this.downEvent.x);\n                    const dY = Math.abs(event.y - this.downEvent.y);\n                    if (dX > 5 || dY > 5) {\n                        this.direction = dX > dY ? $c840f4bdaa4c78fa$var$DIR_X : $c840f4bdaa4c78fa$var$DIR_Y;\n                        for(let i = 0; i < this.eventQueue.length; i++){\n                            const e = this.eventQueue[i];\n                            if (e.type !== \"up\") {\n                                if (this.direction === $c840f4bdaa4c78fa$var$DIR_X) e.y = this.downEvent.y;\n                                else e.x = this.downEvent.x;\n                            }\n                            this.onDraw((0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(e));\n                        }\n                        this.eventQueue = [];\n                    }\n                }\n                if (this.direction === null) {\n                    this.eventQueue.push(event);\n                    return;\n                }\n                if (this.direction === $c840f4bdaa4c78fa$var$DIR_X) event.y = this.downEvent.y;\n                else event.x = this.downEvent.x;\n            } else if (this.eventQueue.length > 0) {\n                for(let i = 0; i < this.eventQueue.length; i++)this.onDraw((0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(this.eventQueue[i]));\n                this.eventQueue = [];\n            }\n        }\n        if (event.type === \"up\") {\n            this.eventQueue = [];\n            this.downEvent = null;\n        }\n        this.onDraw((0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(event));\n    }\n    // --- public ---\n    constructor(p){\n        this.downEvent = null;\n        this.eventQueue = [];\n        this.direction = null;\n        this.onDraw = p.onDraw;\n    }\n}\n\n\n\nconst $5a2f7ed66bdaf6a4$export$4d6077ff8d823dfb = {\n    filenameBase: \"Klecks\"\n};\n\n\nconst $3a2f95de72e4a634$var$MIN_SCALE = 1 / 16;\nconst $3a2f95de72e4a634$var$MAX_SCALE = Math.pow(2, 7);\nvar $3a2f95de72e4a634$var$TMode;\n(function(TMode) {\n    TMode[TMode[\"Draw\"] = 0] = \"Draw\";\n    TMode[TMode[\"Hand\"] = 1] = \"Hand\";\n    TMode[TMode[\"HandGrabbing\"] = 2] = \"HandGrabbing\";\n    TMode[TMode[\"Pick\"] = 3] = \"Pick\";\n    TMode[TMode[\"Zoom\"] = 4] = \"Zoom\";\n    TMode[TMode[\"Rotate\"] = 5] = \"Rotate\";\n    TMode[TMode[\"Rotating\"] = 6] = \"Rotating\";\n    TMode[TMode[\"Fill\"] = 7] = \"Fill\";\n    TMode[TMode[\"Gradient\"] = 8] = \"Gradient\";\n    TMode[TMode[\"Text\"] = 9] = \"Text\";\n    TMode[TMode[\"Shape\"] = 10] = \"Shape\";\n})($3a2f95de72e4a634$var$TMode || ($3a2f95de72e4a634$var$TMode = {}));\nconst $3a2f95de72e4a634$var$ANIMATION_SPEED = 0.3; // rate of transition towards targetTransform\nclass $3a2f95de72e4a634$export$6eaf6f7c0cc177fc {\n    getRenderedTransform() {\n        // rounded x & y so canvas is less blurry.\n        const result = this.renderedTransformObj;\n        result.x = this.highResTransformObj.x;\n        result.y = this.highResTransformObj.y;\n        result.scale = this.highResTransformObj.scale;\n        result.angle = this.highResTransformObj.angle;\n        if (result.angle % (Math.PI / 2) === 0 && result.scale % 1 === 0) {\n            result.x = Math.round(result.x);\n            result.y = Math.round(result.y);\n        }\n        return result;\n    }\n    updateChangeListener() {\n        this.klCanvas.addChangeListener(()=>{\n            this.lastRenderedState = -1;\n            this.reqFrame();\n        });\n    }\n    updateCursor(modeInt, doForce) {\n        if (modeInt === this.currentMode && !doForce) return;\n        const oldMode = this.currentMode;\n        this.currentMode = modeInt;\n        this.lastRenderedState = -1;\n        if (this.currentMode === 0) this.rootEl.style.cursor = \"crosshair\";\n        else if (this.currentMode === 1) this.rootEl.style.cursor = \"grab\";\n        else if (this.currentMode === 2) this.rootEl.style.cursor = \"grabbing\";\n        else if (this.currentMode === 3) this.rootEl.style.cursor = \"url('\" + (0, (/*@__PURE__*/$parcel$interopDefault($6fd92874f57fb7a5$exports))) + \"') 0 15, crosshair\";\n        else if (this.currentMode === 4) this.rootEl.style.cursor = \"url('\" + (0, (/*@__PURE__*/$parcel$interopDefault($bbfe35d8993ac0b3$exports))) + \"') 7 7, zoom-in\";\n        else if (this.currentMode === 5) this.rootEl.style.cursor = \"grab\";\n        else if (this.currentMode === 6) this.rootEl.style.cursor = \"grabbing\";\n        else if (this.currentMode === 7) this.rootEl.style.cursor = \"url('\" + (0, (/*@__PURE__*/$parcel$interopDefault($31fff149ff4d9066$exports))) + \"') 1 12, crosshair\";\n        else if (this.currentMode === 8) this.rootEl.style.cursor = \"crosshair\";\n        else if (this.currentMode === 9) this.rootEl.style.cursor = \"url('\" + (0, (/*@__PURE__*/$parcel$interopDefault($49c01d25d090419f$exports))) + \"') 1 12, crosshair\";\n        else if (this.currentMode === 10) this.rootEl.style.cursor = \"crosshair\";\n        if ([\n            0,\n            3,\n            7,\n            9,\n            10\n        ].includes(this.globalMode)) {\n            const oldIsHand = [\n                1,\n                2\n            ].includes(oldMode);\n            const currentIsHand = [\n                1,\n                2\n            ].includes(this.currentMode);\n            if (!oldIsHand && currentIsHand) this.mainDoubleTapper.setAllowedPointerTypeArr([\n                \"mouse\",\n                \"pen\",\n                \"touch\"\n            ]);\n            if (oldIsHand && !currentIsHand) this.mainDoubleTapper.setAllowedPointerTypeArr([\n                \"touch\"\n            ]);\n        }\n        if (this.currentMode !== 3) this.svgOverlay.updateColorPreview({\n            isVisible: false\n        });\n    }\n    /**\n     * returns false if no change of zoom\n     * @param stepNum\n     * @param centerX\n     * @param centerY\n     * @private\n     */ internalZoomByStep(stepNum, centerX, centerY) {\n        const step = Math.log2(this.targetTransformObj.scale);\n        let newStep = step / Math.abs(stepNum);\n        newStep += stepNum > 0 ? 1 : -1;\n        newStep = Math.round(newStep);\n        newStep *= Math.abs(stepNum);\n        const newScale = Math.max($3a2f95de72e4a634$var$MIN_SCALE, Math.min($3a2f95de72e4a634$var$MAX_SCALE, Math.pow(2, newStep)));\n        //has zoomed?\n        if (newScale === this.targetTransformObj.scale) return false;\n        const effectiveFactor = newScale / this.targetTransformObj.scale;\n        this.targetTransformObj.scale = newScale;\n        let matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.getIdentity();\n        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createTranslationMatrix(centerX, centerY));\n        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createScaleMatrix(effectiveFactor));\n        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createTranslationMatrix(-centerX, -centerY));\n        let origin = [\n            this.targetTransformObj.x,\n            this.targetTransformObj.y,\n            0,\n            1\n        ];\n        origin = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrixAndPoint(matrix, origin);\n        this.targetTransformObj.x = origin[0];\n        this.targetTransformObj.y = origin[1];\n        this.transformIsDirty = true;\n        return true;\n    }\n    /**\n     * mixes two transform objects. modifies A\n     * @param transformA\n     * @param transformB\n     * @param blendFactor 0 -> A, 1 -> B\n     * @private\n     */ mixTransformObj(transformA, transformB, blendFactor) {\n        if (transformA.angle === transformB.angle) {\n            transformA.scale = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(transformA.scale, transformB.scale, blendFactor);\n            transformA.x = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(transformA.x, transformB.x, blendFactor);\n            transformA.y = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(transformA.y, transformB.y, blendFactor);\n            transformA.angle = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(transformA.angle, transformB.angle, blendFactor);\n            return;\n        }\n        const w = this.klCanvas.getWidth();\n        const h = this.klCanvas.getHeight();\n        // --- determine centerPosA, centerPosB ---\n        const centerPosA = this.canvasToWorkspaceCoord({\n            x: w / 2,\n            y: h / 2\n        }, transformA);\n        const centerPosB = this.canvasToWorkspaceCoord({\n            x: w / 2,\n            y: h / 2\n        }, transformB);\n        // --- centerPosMixed ---\n        transformA.x = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(centerPosA.x, centerPosB.x, blendFactor);\n        transformA.y = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(centerPosA.y, centerPosB.y, blendFactor);\n        // --- scale and angle ---\n        transformA.scale = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(transformA.scale, transformB.scale, blendFactor);\n        transformA.angle = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(transformA.angle, transformB.angle, blendFactor);\n        // --- x and y ---\n        const mixedPos = this.canvasToWorkspaceCoord({\n            x: -w / 2,\n            y: -h / 2\n        }, transformA);\n        transformA.x = mixedPos.x;\n        transformA.y = mixedPos.y;\n    }\n    render() {\n        if (this.doResizeCanvas) {\n            this.doResizeCanvas = false;\n            this.renderTargetCanvas.width = this.renderWidth;\n            this.renderTargetCanvas.height = this.renderHeight;\n        }\n        this.renderContext(this.renderTargetCtx);\n    }\n    /**\n     * is the gray background that surrounds canvas visible?\n     * @private\n     */ testBgVisible() {\n        //bring workspace points (corners of workspace) into canvas coordinate system\n        //then check if any corner point is outside of the canvas -> that means the bg is visible\n        const workspacePointArr = [\n            [\n                0,\n                0\n            ],\n            [\n                this.renderWidth,\n                0\n            ],\n            [\n                this.renderWidth,\n                this.renderHeight\n            ],\n            [\n                0,\n                this.renderHeight\n            ]\n        ];\n        const art = this.getRenderedTransform();\n        //setup transformation matrix\n        let matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.getIdentity();\n        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createScaleMatrix(1 / art.scale));\n        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createRotationMatrix(-art.angle));\n        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createTranslationMatrix(-art.x, -art.y));\n        //transform points, then test if outside of canvas\n        for(let i = 0; i < workspacePointArr.length; i++){\n            let coords = [\n                workspacePointArr[i][0],\n                workspacePointArr[i][1],\n                0,\n                1\n            ];\n            coords = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrixAndPoint(matrix, coords);\n            if (!(0 <= coords[0] && coords[0] <= this.klCanvas.getWidth() && 0 <= coords[1] && coords[1] <= this.klCanvas.getHeight())) //if not inside -> bg visible\n            return true;\n        }\n        return false;\n    }\n    renderContext(ctx) {\n        const w = this.klCanvas.getWidth();\n        const h = this.klCanvas.getHeight();\n        const art = this.getRenderedTransform();\n        const isDark = (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark();\n        if (art.scale >= 4 || art.scale === 1 && art.angle === 0) ctx.imageSmoothingEnabled = false;\n        else {\n            ctx.imageSmoothingEnabled = true;\n            ctx.imageSmoothingQuality = \"low\"; // art.scale >= 1 ? 'low' : 'medium';\n        }\n        //ctx.imageSmoothingEnabled = false;\n        //renderTargetCtx.globalCompositeOperation  = 'multiply';\n        ctx.save();\n        {\n            if (this.bgVisible) {\n                ctx.fillStyle = isDark ? \"rgb(33, 33, 33)\" : \"rgb(158,158,158)\"; // 'rgb(185,185,185)';\n                ctx.fillRect(0, 0, this.renderWidth, this.renderHeight);\n            } else ctx.clearRect(0, 0, this.renderWidth, this.renderHeight);\n            if (this.bgVisible) {\n                ctx.save();\n                ctx.translate(art.x, art.y);\n                ctx.scale(art.scale, art.scale);\n                ctx.rotate(art.angle);\n                ctx.imageSmoothingEnabled = false;\n                //outline\n                const borderSize = 1;\n                ctx.globalAlpha = isDark ? 0.25 : 0.2;\n                ctx.drawImage(isDark ? this.emptyLightCanvas : this.emptyCanvas, -borderSize / art.scale, -borderSize / art.scale, w + borderSize * 2 / art.scale, h + borderSize * 2 / art.scale);\n                ctx.globalAlpha = 1;\n                //erase\n                ctx.globalCompositeOperation = \"destination-out\";\n                ctx.drawImage(this.emptyCanvas, 0, 0, w, h);\n                ctx.restore();\n            }\n            /*const region = new Path2D();\n            region.rect(80, 10, 20, 130);\n            ctx.clip(region);*/ ctx.translate(art.x, art.y);\n            ctx.scale(art.scale, art.scale);\n            ctx.rotate(art.angle);\n            const layerArr = this.klCanvas.getLayersFast();\n            for(let i = 0; i < layerArr.length; i++){\n                if (!layerArr[i].isVisible || layerArr[i].opacity === 0) continue;\n                ctx.globalAlpha = layerArr[i].opacity;\n                ctx.globalCompositeOperation = layerArr[i].mixModeStr;\n                const compositeObj = layerArr[i].canvas.compositeObj;\n                if (compositeObj) {\n                    if (this.compositeCanvas.width !== layerArr[i].canvas.width || this.compositeCanvas.height !== layerArr[i].canvas.height) {\n                        this.compositeCanvas.width = layerArr[i].canvas.width;\n                        this.compositeCanvas.height = layerArr[i].canvas.height;\n                    } else this.compositeCtx.clearRect(0, 0, this.compositeCanvas.width, this.compositeCanvas.height);\n                    this.compositeCtx.drawImage(layerArr[i].canvas, 0, 0);\n                    compositeObj.draw(this.compositeCtx);\n                    ctx.drawImage(this.compositeCanvas, 0, 0, w, h);\n                } else ctx.drawImage(layerArr[i].canvas, 0, 0, w, h);\n            }\n            ctx.globalAlpha = 1;\n        }\n        ctx.restore();\n        // rotation hud\n        if (5 === this.currentMode || 6 === this.currentMode) this.svgOverlay.updateCompass({\n            isVisible: true,\n            angleDeg: art.angle / Math.PI * 180\n        });\n        else this.svgOverlay.updateCompass({\n            isVisible: false\n        });\n    }\n    workspaceToCanvasCoord(p) {\n        const art = this.getRenderedTransform();\n        let matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.getIdentity();\n        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createScaleMatrix(1 / art.scale));\n        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createRotationMatrix(-art.angle));\n        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createTranslationMatrix(-art.x, -art.y));\n        let coords = [\n            p.x,\n            p.y,\n            0,\n            1\n        ];\n        coords = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrixAndPoint(matrix, coords);\n        return {\n            x: coords[0],\n            y: coords[1]\n        };\n    }\n    canvasToWorkspaceCoord(p, transformObj) {\n        let matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.getIdentity();\n        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createTranslationMatrix(transformObj.x, transformObj.y));\n        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createRotationMatrix(transformObj.angle));\n        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createScaleMatrix(transformObj.scale));\n        let coords = [\n            p.x,\n            p.y,\n            0,\n            1\n        ];\n        coords = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrixAndPoint(matrix, coords);\n        return {\n            x: coords[0],\n            y: coords[1]\n        };\n    }\n    snapAngleRad(angleRad, snapDegIncrement, maxDistDeg) {\n        let angleDeg = angleRad * 180 / Math.PI;\n        const modDeg = Math.abs(angleDeg % snapDegIncrement);\n        const dist = Math.min(modDeg, snapDegIncrement - modDeg);\n        if (dist <= maxDistDeg) angleDeg = Math.round(angleDeg / snapDegIncrement) * snapDegIncrement;\n        return angleDeg / 180 * Math.PI;\n    }\n    /**\n     * angle always in range [-PI, PI]\n     * @param angleRad\n     * @private\n     */ minimizeAngleRad(angleRad) {\n        angleRad = angleRad % (2 * Math.PI);\n        if (angleRad > Math.PI) angleRad -= 2 * Math.PI;\n        else if (angleRad < -Math.PI) angleRad += 2 * Math.PI;\n        return angleRad;\n    }\n    resetInputProcessor() {\n        this.currentInputProcessor = null;\n        this.updateCursor(this.globalMode);\n        this.reqFrame(true);\n    }\n    reqFrame(doRedrawCanvas) {\n        this.animationFrameRequested = true;\n        if (doRedrawCanvas) this.lastRenderedState = -1;\n    }\n    updateLoop() {\n        window.requestAnimationFrame(()=>this.updateLoop());\n        const newState = (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).getState();\n        const doRender = this.lastRenderedState < newState;\n        //handle variable framerate\n        const nowTime = performance.now();\n        const elapsedFrames = (nowTime - this.lastRenderTime) * 60 / 1000; //how many frames elapsed since last render if fps were 60fps\n        this.lastRenderTime = nowTime;\n        if (this.animationFrameRequested || doRender) {\n            this.animationFrameRequested = false;\n            this.checkChange(elapsedFrames);\n        }\n    }\n    checkChange(elapsedFrames) {\n        const newState = (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).getState();\n        const doRender = this.lastRenderedState < newState || this.highResTransformObj.scale !== this.targetTransformObj.scale || this.highResTransformObj.x !== this.targetTransformObj.x || this.highResTransformObj.y !== this.targetTransformObj.y;\n        //update transform\n        if (!this.doAnimateTranslate && (this.highResTransformObj.scale === this.targetTransformObj.scale || Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale)) {\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\n            this.highResTransformObj.x = this.targetTransformObj.x;\n            this.highResTransformObj.y = this.targetTransformObj.y;\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\n            if (this.transformIsDirty) {\n                this.transformIsDirty = false;\n                this.bgVisible = this.testBgVisible();\n            }\n            this.svgOverlay.updateCursor({\n                radius: this.brushRadius * this.highResTransformObj.scale\n            });\n        } else if ((this.highResTransformObj.x === this.targetTransformObj.x || Math.abs(this.highResTransformObj.x - this.targetTransformObj.x) < 0.5) && (this.highResTransformObj.y === this.targetTransformObj.y || Math.abs(this.highResTransformObj.y - this.targetTransformObj.y) < 0.5) && (this.highResTransformObj.scale === this.targetTransformObj.scale || Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale)) {\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\n            this.highResTransformObj.x = this.targetTransformObj.x;\n            this.highResTransformObj.y = this.targetTransformObj.y;\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\n            this.doAnimateTranslate = false;\n            if (this.transformIsDirty) {\n                this.transformIsDirty = false;\n                this.bgVisible = this.testBgVisible();\n            }\n            this.svgOverlay.updateCursor({\n                radius: this.brushRadius * this.highResTransformObj.scale\n            });\n        } else {\n            this.reqFrame(); //probably needs another frame\n            const blendFactor = Math.min(1, $3a2f95de72e4a634$var$ANIMATION_SPEED * elapsedFrames);\n            this.mixTransformObj(this.highResTransformObj, this.targetTransformObj, blendFactor);\n            this.bgVisible = true; // spare yourself the calculation\n            this.svgOverlay.updateCursor({\n                radius: this.brushRadius * this.highResTransformObj.scale\n            });\n        }\n        if (this.pointer && this.currentMode == 0 && !this.usesCssCursor) this.svgOverlay.updateCursor({\n            x: this.pointer.x,\n            y: this.pointer.y,\n            isVisible: true\n        });\n        else this.svgOverlay.updateCursor({\n            isVisible: false\n        });\n        if (doRender) {\n            //console.log('scale', this.renderedTransform.scale, 'x', this.renderedTransform.x, 'y', this.renderedTransform.y);\n            this.lastRenderedState = newState;\n            const start = performance.now();\n            this.render();\n            this.renderTime = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.renderTime, performance.now() - start, 0.05);\n        }\n        //setTimeout(this.checkChange, 100);\n        doRender;\n    }\n    getElement() {\n        return this.rootEl;\n    }\n    setCanvas(klC) {\n        this.klCanvas = klC;\n        this.lastDrawEvent = null;\n        this.resetView();\n        this.updateChangeListener();\n        this.lastRenderedState = -1;\n        this.reqFrame();\n    }\n    /**\n     * set size of workspace area in pixels\n     * @param width\n     * @param height\n     */ setSize(width, height) {\n        const oldWidth = this.renderWidth;\n        const oldHeight = this.renderHeight;\n        if (width === oldWidth && height === oldHeight) return;\n        this.doResizeCanvas = true;\n        this.renderWidth = width;\n        this.renderHeight = height;\n        this.svgOverlay.setSize(width, height);\n        this.targetTransformObj.x += (width - oldWidth) / 2;\n        this.targetTransformObj.y += (height - oldHeight) / 2;\n        this.highResTransformObj.x = this.targetTransformObj.x;\n        this.highResTransformObj.y = this.targetTransformObj.y;\n        this.bgVisible = this.testBgVisible();\n        this.lastRenderedState = -1;\n        this.reqFrame();\n    }\n    setMode(modeStr) {\n        //only sets the base mode\n        if (modeStr === \"draw\") {\n            this.globalMode = 0;\n            this.mainDoubleTapper.setAllowedPointerTypeArr([\n                \"touch\"\n            ]);\n        }\n        if (modeStr === \"fill\") {\n            this.globalMode = 7;\n            this.mainDoubleTapper.setAllowedPointerTypeArr([\n                \"touch\"\n            ]);\n        }\n        if (modeStr === \"gradient\") {\n            this.globalMode = 8;\n            this.mainDoubleTapper.setAllowedPointerTypeArr([\n                \"touch\"\n            ]);\n        }\n        if (modeStr === \"text\") {\n            this.globalMode = 9;\n            this.mainDoubleTapper.setAllowedPointerTypeArr([\n                \"touch\"\n            ]);\n        }\n        if (modeStr === \"shape\") {\n            this.globalMode = 10;\n            this.mainDoubleTapper.setAllowedPointerTypeArr([\n                \"touch\"\n            ]);\n        }\n        if (modeStr === \"hand\") {\n            this.globalMode = 1;\n            this.mainDoubleTapper.setAllowedPointerTypeArr([\n                \"mouse\",\n                \"pen\",\n                \"touch\"\n            ]);\n        }\n        if (modeStr === \"pick\") {\n            this.globalMode = 3;\n            this.mainDoubleTapper.setAllowedPointerTypeArr([\n                \"touch\"\n            ]);\n        }\n    }\n    getMode() {\n        if (this.globalMode === 0) return \"draw\";\n        if (this.globalMode === 7) return \"fill\";\n        if (this.globalMode === 8) return \"gradient\";\n        if (this.globalMode === 9) return \"text\";\n        if (this.globalMode === 10) return \"shape\";\n        if (this.globalMode === 1) return \"hand\";\n        if (this.globalMode === 3) return \"pick\";\n        throw new Error(\"unknown globalMode\");\n    }\n    setCursorSize(diameter) {\n        this.brushRadius = diameter / 2;\n        this.svgOverlay.updateCursor({\n            radius: this.brushRadius * this.highResTransformObj.scale\n        });\n        if (this.pointer === null) {\n            this.hideBrushCursorTimeout && clearTimeout(this.hideBrushCursorTimeout);\n            this.svgOverlay.updateCursor({\n                x: this.renderWidth / 2,\n                y: this.renderHeight / 2,\n                isVisible: true\n            });\n            this.hideBrushCursorTimeout = setTimeout(()=>{\n                if (this.pointer !== null) return;\n                this.svgOverlay.updateCursor({\n                    isVisible: false\n                });\n            }, 500);\n        }\n    }\n    zoomByStep(stepNum) {\n        if (!this.internalZoomByStep(stepNum, this.renderWidth / 2, this.renderHeight / 2)) return;\n        this.lastRenderedState = -1;\n        this.reqFrame();\n        this.onViewChange({\n            changed: [\n                \"scale\"\n            ],\n            angle: this.targetTransformObj.angle,\n            scale: this.targetTransformObj.scale\n        });\n    }\n    resetView(doAnimate) {\n        this.targetTransformObj.scale = 1;\n        this.targetTransformObj.angle = 0;\n        this.targetTransformObj.x = (this.renderWidth - this.klCanvas.getWidth()) / 2;\n        this.targetTransformObj.y = (this.renderHeight - this.klCanvas.getHeight()) / 2;\n        if (doAnimate) {\n            this.doAnimateTranslate = true;\n            this.transformIsDirty = true;\n        } else this.highResTransformObj = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(this.targetTransformObj);\n        this.bgVisible = this.testBgVisible();\n        this.reqFrame();\n        if (doAnimate) this.onViewChange({\n            changed: [\n                \"scale\",\n                \"angle\"\n            ],\n            scale: this.targetTransformObj.scale,\n            angle: this.targetTransformObj.angle\n        });\n    }\n    /**\n     * fit into view. center. snap angle. padding\n     * returns true if transform changes\n     */ fitView(doAnimate) {\n        // determine new transform\n        const newAngle = this.snapAngleRad(this.targetTransformObj.angle, 90, 90);\n        //calc width and height of bounds\n        const canvasPointsArr = [\n            [\n                0,\n                0\n            ],\n            [\n                this.klCanvas.getWidth(),\n                0\n            ],\n            [\n                this.klCanvas.getWidth(),\n                this.klCanvas.getHeight()\n            ],\n            [\n                0,\n                this.klCanvas.getHeight()\n            ],\n            [\n                this.klCanvas.getWidth() / 2,\n                this.klCanvas.getHeight() / 2\n            ]\n        ];\n        //setup transformation matrix\n        let matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.getIdentity();\n        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createRotationMatrix(newAngle));\n        //rotate points\n        for(let i = 0; i < canvasPointsArr.length; i++){\n            let coords = [\n                canvasPointsArr[i][0],\n                canvasPointsArr[i][1],\n                0,\n                1\n            ];\n            coords = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrixAndPoint(matrix, coords);\n            canvasPointsArr[i][0] = coords[0];\n            canvasPointsArr[i][1] = coords[1];\n        }\n        const boundsObj = {};\n        for(let i = 0; i < canvasPointsArr.length; i++){\n            if (boundsObj.x1 === undefined || canvasPointsArr[i][0] < boundsObj.x1) boundsObj.x1 = canvasPointsArr[i][0];\n            if (boundsObj.y1 === undefined || canvasPointsArr[i][1] < boundsObj.y1) boundsObj.y1 = canvasPointsArr[i][1];\n            if (boundsObj.x2 === undefined || canvasPointsArr[i][0] > boundsObj.x2) boundsObj.x2 = canvasPointsArr[i][0];\n            if (boundsObj.y2 === undefined || canvasPointsArr[i][1] > boundsObj.y2) boundsObj.y2 = canvasPointsArr[i][1];\n        }\n        const boundsWidth = boundsObj.x2 - boundsObj.x1;\n        const boundsHeight = boundsObj.y2 - boundsObj.y1;\n        //fit bounds\n        const padding = 0;\n        const { width: fitWidth } = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).fitInto(boundsWidth, boundsHeight, this.renderWidth - padding, this.renderHeight - padding, 1);\n        //determine scale\n        const factor = Math.min($3a2f95de72e4a634$var$MAX_SCALE, fitWidth / boundsWidth);\n        const newTargetTransformObj = {\n            angle: newAngle,\n            x: this.renderWidth / 2 - (canvasPointsArr[4][0] - canvasPointsArr[0][0]) * factor,\n            y: this.renderHeight / 2 - (canvasPointsArr[4][1] - canvasPointsArr[0][1]) * factor,\n            scale: factor\n        };\n        if (newTargetTransformObj.angle === this.targetTransformObj.angle && Math.abs(newTargetTransformObj.x - this.targetTransformObj.x) < 0.0000000001 && Math.abs(newTargetTransformObj.y - this.targetTransformObj.y) < 0.0000000001 && newTargetTransformObj.scale === this.targetTransformObj.scale) return false;\n        this.targetTransformObj = newTargetTransformObj;\n        if (doAnimate) this.doAnimateTranslate = true;\n        else this.highResTransformObj = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(this.targetTransformObj);\n        this.transformIsDirty = true;\n        this.reqFrame();\n        if (doAnimate) this.onViewChange({\n            changed: [\n                \"scale\",\n                \"angle\"\n            ],\n            scale: this.targetTransformObj.scale,\n            angle: this.targetTransformObj.angle\n        });\n        return true;\n    }\n    /**\n     * let the workspace decide what is best. E.g. if it's pixel art, Fit might be better.\n     */ resetOrFitView() {\n        const threshold = 4; // >= 400% zoom. pixelated, not blurry\n        if (!(0, $5a2f7ed66bdaf6a4$export$4d6077ff8d823dfb).disableAutoFit && this.klCanvas.getWidth() <= this.renderWidth / threshold && this.klCanvas.getHeight() <= this.renderHeight / threshold) this.fitView();\n        else this.resetView();\n    }\n    setAngle(angleDeg, isRelative) {\n        //rotation done around center\n        const centerObj = {\n            x: this.renderWidth / 2,\n            y: this.renderHeight / 2\n        };\n        const oldAngleRad = this.targetTransformObj.angle;\n        const angleRad = angleDeg / 180 * Math.PI;\n        if (isRelative) this.targetTransformObj.angle += angleRad;\n        else this.targetTransformObj.angle = angleRad;\n        this.targetTransformObj.angle = this.minimizeAngleRad(this.snapAngleRad(this.targetTransformObj.angle, 90, 4));\n        //rotate transform.xy\n        let matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.getIdentity();\n        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\n        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createRotationMatrix(this.targetTransformObj.angle - oldAngleRad));\n        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\n        let origin = [\n            this.targetTransformObj.x,\n            this.targetTransformObj.y,\n            0,\n            1\n        ];\n        origin = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrixAndPoint(matrix, origin);\n        this.targetTransformObj.x = origin[0];\n        this.targetTransformObj.y = origin[1];\n        this.highResTransformObj = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(this.targetTransformObj);\n        this.transformIsDirty = true;\n        this.reqFrame(true);\n    }\n    /**\n     * translate canvas by viewport pixels\n     * @param tx\n     * @param ty\n     */ translateView(tx, ty) {\n        const scale = 40;\n        this.targetTransformObj.x += tx * scale;\n        this.targetTransformObj.y += ty * scale;\n        this.transformIsDirty = true;\n        this.doAnimateTranslate = true;\n        this.reqFrame(true);\n    }\n    getIsDrawing() {\n        return this.isDrawing;\n    }\n    getScale() {\n        return this.targetTransformObj.scale;\n    }\n    getAngleDeg() {\n        return this.targetTransformObj.angle * 180 / Math.PI;\n    }\n    getMaxScale() {\n        return $3a2f95de72e4a634$var$MAX_SCALE;\n    }\n    getMinScale() {\n        return $3a2f95de72e4a634$var$MIN_SCALE;\n    }\n    requestFrame() {\n        this.lastRenderedState = -1;\n        this.reqFrame();\n    }\n    setLastDrawEvent(x, y, pressure) {\n        if (x === undefined) {\n            this.lastDrawEvent = null;\n            return;\n        }\n        if (!this.lastDrawEvent) this.lastDrawEvent = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        };\n        this.lastDrawEvent.x = x;\n        this.lastDrawEvent.y = y;\n        this.lastDrawEvent.pressure = pressure;\n    }\n    // ---- public ----\n    constructor(p){\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                position: \"absolute\",\n                left: \"0\",\n                right: \"0\",\n                top: \"0\",\n                bottom: \"0\",\n                cursor: \"crosshair\",\n                userSelect: \"none\"\n            }\n        });\n        this.klCanvas = p.klCanvas;\n        this.onViewChange = p.onViewChange;\n        this.renderTargetCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(p.width, p.height);\n        this.renderTargetCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.renderTargetCanvas);\n        this.renderWidth = p.width;\n        this.renderHeight = p.height;\n        this.compositeCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(1, 1); // for drawing klcanvas layer composite\n        this.compositeCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.compositeCanvas);\n        this.doResizeCanvas = false;\n        this.oldTransformObj = null;\n        this.targetTransformObj = {\n            x: 0,\n            y: 0,\n            scale: 1,\n            angle: 0\n        };\n        this.highResTransformObj = {\n            x: 0,\n            y: 0,\n            scale: 1,\n            angle: 0\n        };\n        this.renderedTransformObj = {};\n        this.cursorPos = {\n            x: 0,\n            y: 0\n        };\n        this.usesCssCursor = false;\n        this.bgVisible = true;\n        this.transformIsDirty = true;\n        this.doAnimateTranslate = true;\n        this.svgOverlay = new (0, $336ce3ce60e7688c$export$6b9252711ea5997f)({\n            width: p.width,\n            height: p.height\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.renderTargetCanvas, {\n            userSelect: \"none\",\n            pointerEvents: \"none\"\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createCheckerDataUrl(8, (url)=>{\n            this.renderTargetCanvas.style.background = \"url(\" + url + \")\";\n        }, (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark());\n        (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).addIsDarkListener(()=>{\n            this.renderTargetCanvas.style.background = \"url(\" + (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createCheckerDataUrl(8, undefined, (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark()) + \")\";\n            this.lastRenderedState = -1;\n            this.reqFrame();\n        });\n        this.rootEl.append(this.renderTargetCanvas, this.svgOverlay.getElement());\n        this.rootEl.addEventListener(\"touchend\", (e)=>{\n            e.preventDefault();\n            return false;\n        });\n        this.rootEl.addEventListener(\"contextmenu\", (e)=>{\n            e.preventDefault();\n            return false;\n        });\n        this.rootEl.addEventListener(\"dragstart\", (e)=>{\n            e.preventDefault();\n            return false;\n        });\n        this.emptyCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(1, 1);\n        this.emptyLightCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(1, 1);\n        {\n            let ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.emptyCanvas);\n            ctx.fillRect(0, 0, 1, 1);\n            ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.emptyLightCanvas);\n            ctx.fillStyle = \"#fff\";\n            ctx.fillRect(0, 0, 1, 1);\n        }\n        this.keyListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).KeyListener({\n            onDown: (keyStr, event, comboStr, isRepeat)=>{\n                if ((0, $49faab2330529a96$export$6e4a713ddcda1e5e).dialogCounter.get() > 0 || (0, $d9f9f4926aa80a1c$export$921068d8846a1559).isInputFocused(true)) return;\n                if (keyStr === \"alt\") event.preventDefault();\n                if (isRepeat) return;\n                if (this.currentInputProcessor) this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                else {\n                    if ([\n                        0,\n                        3,\n                        7,\n                        8,\n                        9,\n                        10\n                    ].includes(this.globalMode) && comboStr === \"space\") {\n                        this.currentInputProcessor = this.inputProcessorObj.spaceHand;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n                    if ([\n                        0,\n                        1,\n                        7,\n                        8,\n                        9,\n                        10\n                    ].includes(this.globalMode) && comboStr === \"alt\") {\n                        this.currentInputProcessor = this.inputProcessorObj.altPicker;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n                    if ([\n                        \"r\",\n                        \"shift+r\"\n                    ].includes(comboStr)) {\n                        this.currentInputProcessor = this.inputProcessorObj.rotate;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n                    if (\"z\" === comboStr) {\n                        this.currentInputProcessor = this.inputProcessorObj.zoom;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n                }\n            },\n            onUp: (keyStr, event, oldComboStr)=>{\n                // prevent menu bar in Firefox\n                if (keyStr === \"alt\") event.preventDefault();\n                if (this.currentInputProcessor) this.currentInputProcessor.onKeyUp(keyStr, event, oldComboStr);\n            }\n        });\n        this.updateChangeListener();\n        this.currentMode = 0;\n        this.globalMode = 0;\n        this.renderTime = 0;\n        this.lastDrawEvent = null;\n        this.linetoolProcessor = new (0, $c840f4bdaa4c78fa$export$d429e21f52463d17)({\n            onDraw: (event)=>{\n                const getMatrix = ()=>{\n                    const art = this.getRenderedTransform();\n                    let matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.getIdentity();\n                    matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createScaleMatrix(1 / art.scale));\n                    matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createRotationMatrix(-art.angle));\n                    matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createTranslationMatrix(-art.x, -art.y));\n                    return matrix;\n                };\n                if (event.type === \"line\" && !this.lastDrawEvent) {\n                    const matrix = getMatrix();\n                    let coords = [\n                        event.x1,\n                        event.y1,\n                        0,\n                        1\n                    ];\n                    coords = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrixAndPoint(matrix, coords);\n                    this.lastDrawEvent = {\n                        x: coords[0],\n                        y: coords[1],\n                        pressure: event.pressure1\n                    };\n                    return;\n                }\n                if (\"x\" in event || \"x0\" in event) {\n                    const matrix = getMatrix();\n                    if (\"x\" in event) {\n                        let coords = [\n                            event.x,\n                            event.y,\n                            0,\n                            1\n                        ];\n                        coords = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrixAndPoint(matrix, coords);\n                        event.x = coords[0];\n                        event.y = coords[1];\n                    }\n                    if (\"x0\" in event) {\n                        event.x0 = this.lastDrawEvent.x;\n                        event.y0 = this.lastDrawEvent.y;\n                        event.pressure0 = this.lastDrawEvent.pressure;\n                        let coords = [\n                            event.x1,\n                            event.y1,\n                            0,\n                            1\n                        ];\n                        coords = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrixAndPoint(matrix, coords);\n                        event.x1 = coords[0];\n                        event.y1 = coords[1];\n                        this.lastDrawEvent = {\n                            x: event.x1,\n                            y: event.y1,\n                            pressure: event.pressure1\n                        };\n                    }\n                }\n                if (event.type === \"down\" || event.type === \"move\") this.lastDrawEvent = {\n                    x: event.x,\n                    y: event.y,\n                    pressure: event.pressure\n                };\n                p.onDraw(event);\n            }\n        });\n        this.pointer = null;\n        this.isDrawing = false;\n        this.inputProcessorObj = {\n            draw: {\n                onPointer: (val)=>{\n                    this.reqFrame();\n                    this.updateCursor(0);\n                    const comboStr = this.keyListener.getComboStr();\n                    const event = {\n                        scale: this.highResTransformObj.scale\n                    };\n                    event.shiftIsPressed = comboStr === \"shift\";\n                    event.pressure = val.pressure;\n                    event.isCoalesced = !!val.isCoalesced;\n                    if (val.type === \"pointerdown\") {\n                        this.isDrawing = true;\n                        event.type = \"down\";\n                    } else if (val.button) event.type = \"move\";\n                    else if (val.type === \"pointerup\") {\n                        this.isDrawing = false;\n                        event.type = \"up\";\n                        this.linetoolProcessor.process(event);\n                        this.resetInputProcessor();\n                        return;\n                    } else return;\n                    event.x = val.relX;\n                    event.y = val.relY;\n                    this.linetoolProcessor.process(event);\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat)=>{},\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr)=>{}\n            },\n            fill: {\n                onPointer: (event)=>{\n                    this.reqFrame();\n                    this.updateCursor(7);\n                    if (event.type === \"pointerdown\") {\n                        const coord = this.workspaceToCanvasCoord({\n                            x: event.relX,\n                            y: event.relY\n                        });\n                        p.onFill(Math.floor(coord.x), Math.floor(coord.y));\n                    } else if (event.type === \"pointerup\") {\n                        this.resetInputProcessor();\n                        return;\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat)=>{},\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr)=>{}\n            },\n            gradient: {\n                onPointer: (event)=>{\n                    this.reqFrame();\n                    this.updateCursor(8);\n                    const coord = this.workspaceToCanvasCoord({\n                        x: event.relX,\n                        y: event.relY\n                    });\n                    if (event.type === \"pointerdown\") {\n                        this.isDrawing = true;\n                        p.onGradient(\"down\", coord.x, coord.y, this.renderedTransformObj.angle);\n                    } else if (event.type === \"pointermove\") p.onGradient(\"move\", coord.x, coord.y, this.renderedTransformObj.angle);\n                    else if (event.type === \"pointerup\") {\n                        this.isDrawing = false;\n                        p.onGradient(\"up\", coord.x, coord.y, this.renderedTransformObj.angle);\n                        this.resetInputProcessor();\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat)=>{},\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr)=>{}\n            },\n            text: {\n                onPointer: (event)=>{\n                    this.reqFrame();\n                    this.updateCursor(9);\n                    if (event.type === \"pointerdown\") {\n                        const coord = this.workspaceToCanvasCoord({\n                            x: event.relX,\n                            y: event.relY\n                        });\n                        p.onText(Math.floor(coord.x), Math.floor(coord.y), this.renderedTransformObj.angle);\n                    } else if (event.type === \"pointerup\") {\n                        this.resetInputProcessor();\n                        return;\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat)=>{},\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr)=>{}\n            },\n            shape: {\n                onPointer: (event)=>{\n                    this.reqFrame();\n                    this.updateCursor(10);\n                    const coord = this.workspaceToCanvasCoord({\n                        x: event.relX,\n                        y: event.relY\n                    });\n                    if (event.type === \"pointerdown\") {\n                        this.isDrawing = true;\n                        p.onShape(\"down\", coord.x, coord.y, this.renderedTransformObj.angle);\n                    } else if (event.type === \"pointermove\") p.onShape(\"move\", coord.x, coord.y, this.renderedTransformObj.angle);\n                    else if (event.type === \"pointerup\") {\n                        this.isDrawing = false;\n                        p.onShape(\"up\", coord.x, coord.y, this.renderedTransformObj.angle);\n                        this.resetInputProcessor();\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat)=>{},\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr)=>{}\n            },\n            hand: {\n                onPointer: (event)=>{\n                    this.updateCursor(1);\n                    if ([\n                        \"left\",\n                        \"middle\"\n                    ].includes(event.button || \"\")) {\n                        this.updateCursor(2);\n                        this.targetTransformObj.x += event.dX;\n                        this.targetTransformObj.y += event.dY;\n                        this.highResTransformObj = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(this.targetTransformObj);\n                        this.doAnimateTranslate = false;\n                        this.transformIsDirty = true;\n                        this.reqFrame(true);\n                    } else if (event.type === \"pointerup\") this.resetInputProcessor();\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat)=>{},\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr)=>{}\n            },\n            spaceHand: {\n                onPointer: (event)=>{\n                    this.updateCursor(1);\n                    if ([\n                        \"left\",\n                        \"middle\"\n                    ].includes(event.button || \"\")) {\n                        this.updateCursor(2);\n                        this.targetTransformObj.x += event.dX;\n                        this.targetTransformObj.y += event.dY;\n                        this.highResTransformObj = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(this.targetTransformObj);\n                        this.doAnimateTranslate = false;\n                        this.transformIsDirty = true;\n                        this.reqFrame(true);\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat)=>{\n                    if (comboStr !== \"space\") this.resetInputProcessor();\n                    else this.updateCursor(1);\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr)=>{\n                    this.resetInputProcessor();\n                }\n            },\n            zoom: {\n                onPointer: (event)=>{\n                    this.updateCursor(4);\n                    if (event.button === \"left\" && !event.isCoalesced && event.dX != 0) {\n                        const offsetX = event.pageX - event.relX;\n                        const offsetY = event.pageY - event.relY;\n                        this.internalZoomByStep(event.dX / 175, event.downPageX - offsetX, event.downPageY - offsetY);\n                        this.highResTransformObj = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(this.targetTransformObj);\n                        this.lastRenderedState = -1;\n                        this.reqFrame();\n                        this.onViewChange({\n                            changed: [\n                                \"scale\"\n                            ],\n                            angle: this.targetTransformObj.angle,\n                            scale: this.targetTransformObj.scale\n                        });\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat)=>{\n                    if (comboStr !== \"z\") this.resetInputProcessor();\n                    else this.updateCursor(4);\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr)=>{\n                    this.resetInputProcessor();\n                }\n            },\n            picker: {\n                onPointer: (event)=>{\n                    this.updateCursor(3);\n                    if ([\n                        \"left\",\n                        \"right\"\n                    ].includes(event.button || \"\") && !event.isCoalesced || event.type === \"pointerup\") {\n                        const coord = this.workspaceToCanvasCoord({\n                            x: event.relX,\n                            y: event.relY\n                        });\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\n                        p.onPick(pickedColor, event.type === \"pointerup\");\n                        this.svgOverlay.updateColorPreview({\n                            x: event.relX,\n                            y: event.relY,\n                            color: pickedColor,\n                            isVisible: event.type !== \"pointerup\"\n                        });\n                        if (event.type === \"pointerup\") this.resetInputProcessor();\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat)=>{},\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr)=>{}\n            },\n            altPicker: {\n                onPointer: (event)=>{\n                    this.updateCursor(3);\n                    if ([\n                        \"left\",\n                        \"right\"\n                    ].includes(event.button || \"\") && !event.isCoalesced || event.type === \"pointerup\") {\n                        const coord = this.workspaceToCanvasCoord({\n                            x: event.relX,\n                            y: event.relY\n                        });\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\n                        p.onPick(pickedColor, event.type === \"pointerup\");\n                        this.svgOverlay.updateColorPreview({\n                            x: event.relX,\n                            y: event.relY,\n                            color: pickedColor,\n                            isVisible: event.type !== \"pointerup\"\n                        });\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat)=>{\n                    if (comboStr !== \"alt\") this.resetInputProcessor();\n                    else this.updateCursor(3);\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr)=>{\n                    this.resetInputProcessor();\n                }\n            },\n            rotate: {\n                onPointer: (event)=>{\n                    this.updateCursor(event.button === \"left\" ? 6 : 5);\n                    if (event.type === \"pointerdown\" && event.button === \"left\") this.oldTransformObj = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(this.targetTransformObj);\n                    else if (event.button === \"left\" && !event.isCoalesced && this.oldTransformObj) {\n                        const offsetX = event.pageX - event.relX;\n                        const offsetY = event.pageY - event.relY;\n                        //rotation done around center\n                        const centerObj = {\n                            x: this.renderWidth / 2,\n                            y: this.renderHeight / 2\n                        };\n                        const startAngleRad = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Vec2.angle(centerObj, {\n                            x: event.downPageX - offsetX,\n                            y: event.downPageY - offsetY\n                        });\n                        const angleRad = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Vec2.angle(centerObj, {\n                            x: event.pageX - offsetX,\n                            y: event.pageY - offsetY\n                        });\n                        let dAngleRad = angleRad - startAngleRad;\n                        //apply angle\n                        this.targetTransformObj = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(this.oldTransformObj);\n                        this.targetTransformObj.angle += dAngleRad;\n                        if (this.keyListener.isPressed(\"shift\")) {\n                            this.targetTransformObj.angle = Math.round(this.targetTransformObj.angle / Math.PI * 8) * Math.PI / 8; //snap the angle to 45/2 degs\n                            dAngleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\n                        }\n                        this.targetTransformObj.angle = this.minimizeAngleRad(this.targetTransformObj.angle);\n                        //rotate transform.xy\n                        let matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.getIdentity();\n                        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\n                        //matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\n                        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createRotationMatrix(dAngleRad));\n                        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\n                        //matrix = multiplyMatrices(matrix, createTranslationMatrix(val.x - val.startX, val.y - val.startY));\n                        let origin = [\n                            this.targetTransformObj.x,\n                            this.targetTransformObj.y,\n                            0,\n                            1\n                        ];\n                        origin = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrixAndPoint(matrix, origin);\n                        this.targetTransformObj.x = origin[0];\n                        this.targetTransformObj.y = origin[1];\n                        this.highResTransformObj = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(this.targetTransformObj);\n                        this.transformIsDirty = true;\n                        this.lastRenderedState = -1;\n                        this.reqFrame();\n                        this.onViewChange({\n                            changed: [\n                                \"angle\"\n                            ],\n                            scale: this.targetTransformObj.scale,\n                            angle: this.targetTransformObj.angle\n                        });\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat)=>{\n                    if ([\n                        \"r\",\n                        \"r+shift\",\n                        \"shift+r\",\n                        \"r+left\",\n                        \"r+right\",\n                        \"r+left+right\",\n                        \"r+right+left\",\n                        \"r+up\"\n                    ].includes(comboStr)) this.updateCursor(5);\n                    else this.resetInputProcessor();\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr)=>{\n                    const comboStr = this.keyListener.getComboStr();\n                    if ([\n                        \"r\",\n                        \"r+shift\",\n                        \"shift+r\",\n                        \"r+left\",\n                        \"r+right\",\n                        \"r+left+right\",\n                        \"r+right+left\",\n                        \"r+up\"\n                    ].includes(comboStr)) this.updateCursor(5);\n                    else this.resetInputProcessor();\n                }\n            }\n        };\n        this.currentInputProcessor = null;\n        this.angleIsExtraSticky = false;\n        this.pinchZoomer = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PinchZoomer({\n            onPinch: (event)=>{\n                if (event.type === \"move\") {\n                    if (!this.oldTransformObj) {\n                        this.oldTransformObj = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(this.targetTransformObj);\n                        this.angleIsExtraSticky = this.targetTransformObj.angle % (Math.PI / 2) === 0;\n                    }\n                    this.targetTransformObj = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(this.oldTransformObj);\n                    event.scale = Math.max($3a2f95de72e4a634$var$MIN_SCALE, Math.min($3a2f95de72e4a634$var$MAX_SCALE, this.targetTransformObj.scale * event.scale)) / this.targetTransformObj.scale;\n                    this.targetTransformObj.scale *= event.scale;\n                    this.targetTransformObj.angle += event.angleRad;\n                    this.targetTransformObj.angle = this.minimizeAngleRad(this.snapAngleRad(this.targetTransformObj.angle, 90, this.angleIsExtraSticky ? 12 : 4));\n                    if (this.targetTransformObj.angle % (Math.PI / 2) !== 0) this.angleIsExtraSticky = false;\n                    //targetTransformObj.angle = minimizeAngleRad(snapAngleRad(targetTransformObj.angle, 90, 7));\n                    event.angleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\n                    //calc translation\n                    {\n                        let matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.getIdentity();\n                        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createTranslationMatrix(event.relX, event.relY));\n                        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createScaleMatrix(event.scale));\n                        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createRotationMatrix(event.angleRad));\n                        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createTranslationMatrix(-event.relX, -event.relY));\n                        matrix = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrices(matrix, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.createTranslationMatrix(event.relX - event.downRelX, event.relY - event.downRelY));\n                        let origin = [\n                            this.targetTransformObj.x,\n                            this.targetTransformObj.y,\n                            0,\n                            1\n                        ];\n                        origin = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Matrix.multiplyMatrixAndPoint(matrix, origin);\n                        this.targetTransformObj.x = origin[0];\n                        this.targetTransformObj.y = origin[1];\n                    }\n                    this.highResTransformObj = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(this.targetTransformObj);\n                    //if (event.scale !== 1) {\n                    this.onViewChange({\n                        changed: [\n                            \"scale\",\n                            \"angle\"\n                        ],\n                        scale: this.targetTransformObj.scale,\n                        angle: this.targetTransformObj.angle\n                    });\n                    //}\n                    this.reqFrame();\n                    this.transformIsDirty = true;\n                    this.lastRenderedState = -1;\n                } else if (event.type === \"end\") this.oldTransformObj = null;\n            }\n        });\n        const onDoubleTap = (event)=>{\n            if (this.fitView(true)) {\n                this.lastRenderedState = -1;\n                this.reqFrame();\n            } else {\n                // zoom 2 steps further\n                const didZoom = this.internalZoomByStep(2, event.relX, event.relY);\n                if (didZoom) this.onViewChange({\n                    changed: [\n                        \"scale\"\n                    ],\n                    angle: this.targetTransformObj.angle,\n                    scale: this.targetTransformObj.scale\n                });\n                //updateCursor(TMode.Draw, true);\n                this.lastRenderedState = -1;\n            }\n        };\n        this.mainDoubleTapper = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).DoubleTapper({\n            onDoubleTap: onDoubleTap\n        });\n        this.middleDoubleTapper = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).DoubleTapper({\n            onDoubleTap: onDoubleTap\n        });\n        this.middleDoubleTapper.setAllowedButtonArr([\n            \"middle\"\n        ]);\n        this.twoFingerTap = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).NFingerTapper({\n            fingers: 2,\n            onTap: ()=>{\n                p.onUndo();\n            }\n        });\n        this.threeFingerTap = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).NFingerTapper({\n            fingers: 3,\n            onTap: ()=>{\n                p.onRedo();\n            }\n        });\n        this.pointerEventChain = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).EventChain({\n            chainArr: [\n                this.twoFingerTap,\n                this.threeFingerTap,\n                this.mainDoubleTapper,\n                this.middleDoubleTapper,\n                this.pinchZoomer,\n                new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).OnePointerLimiter(),\n                new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).CoalescedExploder()\n            ]\n        });\n        this.pointerEventChain.setChainOut((event)=>{\n            this.cursorPos.x = event.relX;\n            this.cursorPos.y = event.relY;\n            if (event.type === \"pointerup\" && event.pointerType === \"touch\") {\n                this.pointer = null;\n                this.lastRenderedState = -1;\n                this.reqFrame();\n            } else {\n                if (!this.pointer) this.pointer = {\n                    x: 0,\n                    y: 0\n                };\n                this.pointer.x = event.relX;\n                this.pointer.y = event.relY;\n            }\n            if (this.currentInputProcessor) this.currentInputProcessor.onPointer(event);\n            else {\n                const comboStr = this.keyListener.getComboStr();\n                if (this.globalMode === 0) {\n                    if ([\n                        \"\",\n                        \"shift\",\n                        \"ctrl\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"left\") {\n                        this.currentInputProcessor = this.inputProcessorObj.draw;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"right\") {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"middle\") {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(0);\n                        this.reqFrame();\n                    }\n                } else if (this.globalMode === 1) {\n                    if (event.type === \"pointerdown\" && [\n                        \"left\",\n                        \"middle\"\n                    ].includes(event.button || \"\")) {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"right\") {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else this.updateCursor(1);\n                } else if (this.globalMode === 3) {\n                    if (event.type === \"pointerdown\" && [\n                        \"left\",\n                        \"right\"\n                    ].includes(event.button || \"\")) {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"middle\") {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else this.updateCursor(3);\n                } else if (this.globalMode === 7) {\n                    if (event.type === \"pointerdown\" && event.button === \"left\") {\n                        this.currentInputProcessor = this.inputProcessorObj.fill;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"right\") {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"middle\") {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(7);\n                        this.reqFrame();\n                    }\n                } else if (this.globalMode === 8) {\n                    if ([\n                        \"\",\n                        \"shift\",\n                        \"ctrl\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"left\") {\n                        this.currentInputProcessor = this.inputProcessorObj.gradient;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"right\") {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"middle\") {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(8);\n                        this.reqFrame();\n                    }\n                } else if (this.globalMode === 9) {\n                    if (event.type === \"pointerdown\" && event.button === \"left\") {\n                        this.currentInputProcessor = this.inputProcessorObj.text;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"right\") {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"middle\") {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(9);\n                        this.reqFrame();\n                    }\n                } else if (this.globalMode === 10) {\n                    if ([\n                        \"\",\n                        \"shift\",\n                        \"ctrl\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"left\") {\n                        this.currentInputProcessor = this.inputProcessorObj.shape;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"right\") {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([\n                        \"\"\n                    ].includes(comboStr) && event.type === \"pointerdown\" && event.button === \"middle\") {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(10);\n                        this.reqFrame();\n                    }\n                }\n            }\n        });\n        //prevent ctrl scroll -> zooming page\n        this.rootEl.addEventListener(\"wheel\", (event)=>{\n            event.preventDefault();\n        });\n        setTimeout(()=>{\n            this.pointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n                target: this.rootEl,\n                fixScribble: true,\n                onPointer: (e)=>{\n                    if (e.type === \"pointerdown\" && e.button === \"middle\") try {\n                        e.eventPreventDefault();\n                    } catch (e) {\n                    /* empty */ }\n                    // prevent manual slider input keeping focus on iPad\n                    if (e.type === \"pointerdown\") (0, $d9f9f4926aa80a1c$export$921068d8846a1559).unfocusAnyInput();\n                    /*if (e.type === 'pointermove') {\n                        BB.throwOut(JSON.stringify(e));\n                    }*/ this.pointerEventChain.chainIn(e);\n                },\n                onWheel: (wheelEvent)=>{\n                    if (this.isDrawing) return;\n                    this.reqFrame();\n                    const didZoom = this.internalZoomByStep(-wheelEvent.deltaY / (this.keyListener.isPressed(\"shift\") ? 8 : 2), wheelEvent.relX, wheelEvent.relY);\n                    if (didZoom) this.onViewChange({\n                        changed: [\n                            \"scale\"\n                        ],\n                        angle: this.targetTransformObj.angle,\n                        scale: this.targetTransformObj.scale\n                    });\n                    //updateCursor(TMode.Draw, true);\n                    this.lastRenderedState = -1;\n                },\n                onEnterLeave: (isOver)=>{\n                    if (!isOver) {\n                        if (!this.isDrawing) {\n                            this.pointer = null;\n                            this.lastRenderedState = -1;\n                        }\n                    }\n                },\n                maxPointers: 4\n            });\n        }, 1);\n        this.brushRadius = 1;\n        this.animationFrameRequested = false;\n        //setup rendering\n        this.lastRenderedState = -2;\n        this.lastRenderTime = performance.now();\n        window.requestAnimationFrame(()=>this.updateLoop());\n        this.resetOrFitView();\n    }\n}\n\n\n\n\nclass $f48eb0413169e026$export$e258ade1648009b7 {\n    getElement() {\n        return this.canvas;\n    }\n    render() {\n        if (!this.ctx) return;\n        this.ctx.save();\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        for(let i = 0; i < this.layers.length; i++){\n            const layer = this.layers[i];\n            if (!layer.isVisible || layer.opacity === 0) continue;\n            this.ctx.globalAlpha = this.layers[i].opacity;\n            this.ctx.globalCompositeOperation = this.layers[i].mixModeStr;\n            if (this.canvas.width > this.layers[i].image.width) this.ctx.imageSmoothingEnabled = false;\n            this.ctx.drawImage(this.layers[i].image, 0, 0, this.canvas.width, this.canvas.height);\n        }\n        this.ctx.restore();\n    }\n    destroy() {\n        (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).removeIsDarkListener(this.updateCheckerboard);\n    }\n    // --- public ---\n    constructor(p){\n        this.layers = p.layers;\n        const scale = p.width / p.layers[0].image.width;\n        const width = scale > 1 ? p.layers[0].image.width : p.width;\n        const height = scale > 1 ? p.layers[0].image.height : p.height;\n        this.canvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(width, height);\n        this.updateCheckerboard = ()=>{\n            this.canvas.style.backgroundImage = \"url(\" + (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createCheckerDataUrl(8, undefined, (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark()) + \")\";\n        };\n        this.updateCheckerboard();\n        this.ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.canvas);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.canvas, {\n            width: \"100%\",\n            height: \"100%\",\n            imageRendering: scale > 1 ? \"pixelated\" : undefined\n        });\n        setTimeout(()=>this.render(), 0);\n        (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).addIsDarkListener(this.updateCheckerboard);\n    }\n}\n\n\n\nvar $0a34fd024ca1cadf$exports = {};\n\n$0a34fd024ca1cadf$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"cursor-rotate.4dea8425.png\";\n\n\n\nfunction $9e052f3767af1736$export$958c2bfe8d7142a9(transform) {\n    if (Math.abs(transform.angleDeg) % 90 !== 0) return;\n    transform.width = Math.round(transform.width);\n    transform.height = Math.round(transform.height);\n    // 0 is original orientation.\n    // At 90 and 270 width and height become swapped due to different orientation.\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\n    transform.x = (whSwapped ? transform.height : transform.width) % 2 === 0 ? Math.round(transform.x) : Math.round(transform.x - 0.5) + 0.5;\n    transform.y = (whSwapped ? transform.width : transform.height) % 2 === 0 ? Math.round(transform.y) : Math.round(transform.y - 0.5) + 0.5;\n}\nfunction $9e052f3767af1736$export$234b1c16dfa57d6a(transform) {\n    return {\n        x: transform.x,\n        y: transform.y,\n        width: transform.width,\n        height: transform.height,\n        angleDeg: transform.angleDeg\n    };\n}\nfunction $9e052f3767af1736$export$6a4549ec4168874a(x, y, transform) {\n    let px, py;\n    px = x - transform.x;\n    py = y - transform.y;\n    const rot = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotateAround({\n        x: 0,\n        y: 0\n    }, {\n        x: px,\n        y: py\n    }, -transform.angleDeg);\n    px = rot.x;\n    py = rot.y;\n    return {\n        x: px,\n        y: py\n    };\n}\nfunction $9e052f3767af1736$export$3fba3b383c654cc6(x, y, transform) {\n    const rot = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotateAround({\n        x: 0,\n        y: 0\n    }, {\n        x: x,\n        y: y\n    }, transform.angleDeg);\n    return {\n        x: rot.x + transform.x,\n        y: rot.y + transform.y\n    };\n}\n\n\nclass $d42d1384577ab84d$export$79a74567acf241b0 {\n    updateScaled() {\n        this.scaled.x = this.value.x * this.viewportTransform.scale;\n        this.scaled.y = this.value.y * this.viewportTransform.scale;\n        this.scaled.width = this.value.width * this.viewportTransform.scale;\n        this.scaled.height = this.value.height * this.viewportTransform.scale;\n        this.scaled.corners = this.corners.map((item)=>{\n            return {\n                x: item.x * this.viewportTransform.scale,\n                y: item.y * this.viewportTransform.scale\n            };\n        });\n    }\n    /**\n     * Returns snapped point, if ix, iy snaps. If no snapping, returns point unchanged.\n     * both in image space\n     *\n     * @param iX - image space\n     * @param iY - image space\n     * @private\n     */ snapCorner(iX, iY) {\n        if (!this.snappingEnabled) return {\n            x: iX,\n            y: iY\n        };\n        let dist;\n        const snap = {\n            x: undefined,\n            y: undefined,\n            dist: {\n                x: undefined,\n                y: undefined\n            }\n        };\n        for(let e = 0; e < this.snapX.length; e++){\n            dist = Math.abs(iX - this.snapX[e]);\n            if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                if (snap.x === undefined || dist < snap.dist.x) {\n                    snap.x = this.snapX[e];\n                    snap.dist.x = dist;\n                }\n            }\n        }\n        for(let e = 0; e < this.snapY.length; e++){\n            dist = Math.abs(iY - this.snapY[e]);\n            if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                if (snap.y === undefined || dist < snap.dist.y) {\n                    snap.y = this.snapY[e];\n                    snap.dist.y = dist;\n                }\n            }\n        }\n        if (snap.x === undefined && snap.y === undefined) return {\n            x: iX,\n            y: iY\n        };\n        var _snap_x, _snap_y;\n        return {\n            x: (_snap_x = snap.x) !== null && _snap_x !== void 0 ? _snap_x : iX,\n            y: (_snap_y = snap.y) !== null && _snap_y !== void 0 ? _snap_y : iY\n        };\n    }\n    /**\n     * If constrained return nearest corner pos that fits aspect ratio\n     *\n     * @param cornerIndex\n     * @param iX\n     * @param iY\n     * @private\n     */ constrainCorner(cornerIndex, iX, iY) {\n        if (!this.isConstrained) return {\n            x: iX,\n            y: iY\n        };\n        const flip = this.value.width * this.value.height < 0 ? -1 : 1;\n        return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).projectPointOnLine({\n            x: this.value.x,\n            y: this.value.y\n        }, (0, $9e052f3767af1736$export$3fba3b383c654cc6)(this.ratio, flip * ([\n            0,\n            2\n        ].includes(cornerIndex) ? 1 : -1), this.value), {\n            x: iX,\n            y: iY\n        });\n    }\n    /**\n     * Update corners according to width height.\n     * Not their DOM.\n     */ updateCornerPositions() {\n        this.corners[0].x = -this.value.width / 2; // top left\n        this.corners[0].y = -this.value.height / 2;\n        this.corners[1].x = this.value.width / 2; // top right\n        this.corners[1].y = -this.value.height / 2;\n        this.corners[2].x = this.value.width / 2; // bottom right\n        this.corners[2].y = this.value.height / 2;\n        this.corners[3].x = -this.value.width / 2; // bottom left\n        this.corners[3].y = this.value.height / 2;\n    }\n    /**\n     * If constrained and dragging an edge, restore aspect ratio\n     * Updates corner positions.\n     *\n     * @param widthChanged\n     * @param heightChanged\n     * @private\n     */ restoreRatio(widthChanged, heightChanged) {\n        if (!this.isConstrained) return;\n        const angle90 = Math.abs(this.value.angleDeg) % 90 === 0;\n        const whSwapped = Math.abs(this.value.angleDeg - 90) % 180 === 0;\n        if (heightChanged && !widthChanged) {\n            const newHeight = Math.abs(this.corners[3].y - this.corners[0].y);\n            let newWidth = this.ratio * newHeight;\n            if (angle90) newWidth = (whSwapped ? this.value.y % 1 : this.value.x % 1) === 0 ? (0, $d9f9f4926aa80a1c$export$921068d8846a1559).roundEven(newWidth) : (0, $d9f9f4926aa80a1c$export$921068d8846a1559).roundUneven(newWidth);\n            if (this.corners[1].x - this.corners[0].x < 0) newWidth *= -1;\n            this.corners[0].x = -newWidth / 2;\n            this.corners[3].x = -newWidth / 2;\n            this.corners[1].x = newWidth / 2;\n            this.corners[2].x = newWidth / 2;\n        }\n        if (!heightChanged && widthChanged) {\n            const newWidth = Math.abs(this.corners[0].x - this.corners[1].x);\n            let newHeight = newWidth / this.ratio;\n            if (angle90) newHeight = (whSwapped ? this.value.x % 1 : this.value.y % 1) === 0 ? (0, $d9f9f4926aa80a1c$export$921068d8846a1559).roundEven(newHeight) : (0, $d9f9f4926aa80a1c$export$921068d8846a1559).roundUneven(newHeight);\n            if (this.corners[3].y - this.corners[0].y < 0) newHeight *= -1;\n            this.corners[0].y = -newHeight / 2;\n            this.corners[1].y = -newHeight / 2;\n            this.corners[2].y = newHeight / 2;\n            this.corners[3].y = newHeight / 2;\n        }\n    }\n    /**\n     * update transform based on corners\n     * @private\n     */ updateTransformViaCorners() {\n        // calc transform center in image space\n        const rot = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotateAround({\n            x: 0,\n            y: 0\n        }, {\n            x: (this.corners[0].x + this.corners[1].x) / 2,\n            y: (this.corners[0].y + this.corners[3].y) / 2\n        }, this.value.angleDeg);\n        this.value.x = rot.x + this.value.x;\n        this.value.y = rot.y + this.value.y;\n        // update size\n        this.value.width = this.corners[1].x - this.corners[0].x;\n        this.value.height = this.corners[3].y - this.corners[0].y;\n        // new center means corners changed their position\n        this.updateCornerPositions();\n        this.updateDOM();\n    }\n    /**\n     * updates DOM according to transform\n     * @param skipCallback\n     */ updateDOM(skipCallback) {\n        this.updateScaled();\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.transEl, {\n            left: this.viewportTransform.x + this.scaled.x + \"px\",\n            top: this.viewportTransform.y + this.scaled.y + \"px\",\n            transformOrigin: \"0 0\",\n            transform: \"rotate(\" + this.value.angleDeg + \"deg)\"\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.boundsEl, {\n            width: Math.abs(this.scaled.width) + \"px\",\n            height: Math.abs(this.scaled.height) + \"px\",\n            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + \"px\",\n            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + \"px\"\n        });\n        this.corners[0].updateDOM();\n        this.corners[1].updateDOM();\n        this.corners[2].updateDOM();\n        this.corners[3].updateDOM();\n        this.edges[0].updateDOM();\n        this.edges[1].updateDOM();\n        this.edges[2].updateDOM();\n        this.edges[3].updateDOM();\n        this.angleGrip.x = 0;\n        this.angleGrip.y = -Math.abs(this.value.height * this.viewportTransform.scale) / 2 - 20;\n        this.angleGrip.updateDOM();\n        if (!skipCallback) {\n            if (this.callback) this.callback((0, $9e052f3767af1736$export$234b1c16dfa57d6a)(this.value));\n        }\n    }\n    getValue() {\n        return (0, $9e052f3767af1736$export$234b1c16dfa57d6a)(this.value);\n    }\n    setIsConstrained(b) {\n        this.isConstrained = b;\n        if (b && this.value.width !== 0 && this.value.height !== 0) this.ratio = Math.abs(this.value.width / this.value.height);\n    }\n    setSnapping(b) {\n        this.snappingEnabled = b;\n    }\n    setPos(p) {\n        this.value.x = p.x;\n        this.value.y = p.y;\n        this.updateDOM(true);\n    }\n    move(dX, dY) {\n        this.value.x += dX;\n        this.value.y += dY;\n        this.updateDOM(false);\n    }\n    setSize(w, h) {\n        this.value.width = w;\n        this.value.height = h;\n        if (Math.abs(this.value.angleDeg) % 90 === 0) (0, $9e052f3767af1736$export$958c2bfe8d7142a9)(this.value);\n        this.updateCornerPositions();\n        this.updateDOM(false);\n    }\n    setAngleDeg(a) {\n        this.value.angleDeg = a;\n        if (Math.abs(this.value.angleDeg) % 90 === 0) {\n            (0, $9e052f3767af1736$export$958c2bfe8d7142a9)(this.value);\n            this.updateCornerPositions();\n        }\n        this.updateDOM(true);\n    }\n    setViewportTransform(transform) {\n        this.viewportTransform = transform;\n        this.updateScaled();\n        this.updateDOM();\n    }\n    getElement() {\n        return this.rootEl;\n    }\n    getRatio() {\n        return this.ratio;\n    }\n    destroy() {\n        this.keyListener.destroy();\n        this.boundsPointerListener.destroy();\n        this.corners.forEach((item)=>item.pointerListener.destroy());\n        this.edges.forEach((item)=>item.pointerListener.destroy());\n        this.anglePointerListener.destroy();\n    }\n    // --- public ---\n    constructor(params){\n        this.scaled = {\n            x: 0,\n            y: 0,\n            width: 0,\n            height: 0,\n            corners: [\n                {\n                    x: 0,\n                    y: 0\n                }\n            ]\n        };\n        this.minSnapDist = 7 // minimal snapping distance in px screen space\n        ;\n        this.cornerCursors = [\n            \"nw\",\n            \"n\",\n            \"ne\",\n            \"e\",\n            \"se\",\n            \"s\",\n            \"sw\",\n            \"w\"\n        ];\n        this.gripSize = 16;\n        this.edgeSize = 10;\n        this.corners = [];\n        this.edges = [];\n        this.viewportTransform = {\n            ...params.viewportTransform\n        };\n        this.value = {\n            x: params.x,\n            y: params.y,\n            width: params.width,\n            height: params.height,\n            angleDeg: params.angleDeg\n        };\n        this.isConstrained = params.isConstrained;\n        this.snapX = params.snapX;\n        this.snapY = params.snapY;\n        this.callback = params.callback;\n        this.snappingEnabled = true;\n        this.ratio = this.value.width / this.value.height;\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-free-transform\",\n            css: {\n                userSelect: \"none\"\n            }\n        });\n        this.transEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            css: {\n                position: \"absolute\"\n            }\n        });\n        this.boundsEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                position: \"absolute\",\n                cursor: \"move\",\n                boxShadow: \"rgba(255, 255, 255, 0.5) 0 0 0 1px inset, rgba(0, 0, 0, 0.5) 0 0 0 1px\"\n            }\n        });\n        const pointerRemainder = {\n            x: 0,\n            y: 0\n        };\n        function resetRemainder() {\n            pointerRemainder.x = 0;\n            pointerRemainder.y = 0;\n        }\n        this.keyListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).KeyListener({});\n        let boundsStartP = {\n            x: 0,\n            y: 0\n        };\n        this.boundsPointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.boundsEl,\n            fixScribble: true,\n            onPointer: (event)=>{\n                event.eventPreventDefault();\n                if (event.type === \"pointerdown\") boundsStartP = {\n                    x: this.value.x,\n                    y: this.value.y\n                };\n                if (event.type === \"pointermove\" && event.button === \"left\") {\n                    this.value.x = boundsStartP.x + (event.pageX - event.downPageX) / this.viewportTransform.scale;\n                    this.value.y = boundsStartP.y + (event.pageY - event.downPageY) / this.viewportTransform.scale;\n                    let dist;\n                    let snap = {\n                        distX: -1,\n                        distY: -1\n                    };\n                    if (this.snappingEnabled) {\n                        let i;\n                        for(i = 0; i < this.snapX.length; i++){\n                            dist = Math.abs(this.value.x - this.snapX[i]);\n                            if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                                if (snap.x === undefined || dist < snap.distX) {\n                                    snap.x = this.snapX[i];\n                                    snap.distX = dist;\n                                }\n                            }\n                        }\n                        for(i = 0; i < this.snapY.length; i++){\n                            dist = Math.abs(this.value.y - this.snapY[i]);\n                            if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                                if (snap.y === undefined || dist < snap.distY) {\n                                    snap.y = this.snapY[i];\n                                    snap.distY = dist;\n                                }\n                            }\n                        }\n                        let iP;\n                        for(i = 0; i < 4; i++){\n                            iP = (0, $9e052f3767af1736$export$3fba3b383c654cc6)(this.corners[i].x, this.corners[i].y, this.value);\n                            let j;\n                            for(j = 0; j < this.snapX.length; j++){\n                                dist = Math.abs(iP.x - this.snapX[j]);\n                                if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                                    if (snap.x === undefined || dist < snap.distX) {\n                                        snap.x = this.snapX[j] - (iP.x - this.value.x);\n                                        snap.distX = dist;\n                                    }\n                                }\n                            }\n                            for(j = 0; j < this.snapY.length; j++){\n                                dist = Math.abs(iP.y - this.snapY[j]);\n                                if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                                    if (snap.y === undefined || dist < snap.distY) {\n                                        snap.y = this.snapY[j] - (iP.y - this.value.y);\n                                        snap.distY = dist;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    if (this.keyListener.getComboStr() === \"shift\") {\n                        let projected = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).projectPointOnLine({\n                            x: 0,\n                            y: boundsStartP.y\n                        }, {\n                            x: 10,\n                            y: boundsStartP.y\n                        }, {\n                            x: this.value.x,\n                            y: this.value.y\n                        });\n                        let dist = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).dist(projected.x, projected.y, this.value.x, this.value.y);\n                        snap = {\n                            x: projected.x,\n                            y: projected.y,\n                            distX: dist,\n                            distY: dist\n                        };\n                        projected = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).projectPointOnLine({\n                            x: boundsStartP.x,\n                            y: 0\n                        }, {\n                            x: boundsStartP.x,\n                            y: 10\n                        }, {\n                            x: this.value.x,\n                            y: this.value.y\n                        });\n                        dist = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).dist(projected.x, projected.y, this.value.x, this.value.y);\n                        if (dist < snap.distX) snap = {\n                            x: projected.x,\n                            y: projected.y,\n                            distX: dist,\n                            distY: dist\n                        };\n                        projected = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).projectPointOnLine({\n                            x: boundsStartP.x,\n                            y: boundsStartP.y\n                        }, {\n                            x: boundsStartP.x + 1,\n                            y: boundsStartP.y + 1\n                        }, {\n                            x: this.value.x,\n                            y: this.value.y\n                        });\n                        dist = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).dist(projected.x, projected.y, this.value.x, this.value.y);\n                        if (dist < snap.distX) snap = {\n                            x: projected.x,\n                            y: projected.y,\n                            distX: dist,\n                            distY: dist\n                        };\n                        projected = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).projectPointOnLine({\n                            x: boundsStartP.x,\n                            y: boundsStartP.y\n                        }, {\n                            x: boundsStartP.x + 1,\n                            y: boundsStartP.y - 1\n                        }, {\n                            x: this.value.x,\n                            y: this.value.y\n                        });\n                        dist = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).dist(projected.x, projected.y, this.value.x, this.value.y);\n                        if (dist < snap.distX) snap = {\n                            x: projected.x,\n                            y: projected.y,\n                            distX: dist,\n                            distY: dist\n                        };\n                    }\n                    if (snap.x != undefined) this.value.x = snap.x;\n                    if (snap.y != undefined) this.value.y = snap.y;\n                    // snap to pixels\n                    if (Math.abs(this.value.angleDeg) % 90 === 0) {\n                        (0, $9e052f3767af1736$export$958c2bfe8d7142a9)(this.value);\n                        this.updateCornerPositions();\n                    }\n                    this.updateDOM();\n                }\n            }\n        });\n        for(let i = 0; i < 4; i++)((i)=>{\n            const g = this.corners[i] = {\n                i: i,\n                el: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    css: {\n                        width: this.gripSize + \"px\",\n                        height: this.gripSize + \"px\",\n                        background: \"#fff\",\n                        /*background: [\n                                '#ff0000',\n                                '#00ff00',\n                                '#0000ff',\n                                '#ff00ff',\n                            ][i],*/ borderRadius: this.gripSize + \"px\",\n                        position: \"absolute\",\n                        border: \"2px solid #000\"\n                    }\n                }),\n                x: 0,\n                y: 0,\n                virtualPos: {\n                    x: 0,\n                    y: 0\n                }\n            };\n            g.updateDOM = ()=>{\n                // grip position\n                // if it gets small: slightly offset grips, so easier to handle\n                const offsetArr = [\n                    [\n                        -1,\n                        -1\n                    ],\n                    [\n                        1,\n                        -1\n                    ],\n                    [\n                        1,\n                        1\n                    ],\n                    [\n                        -1,\n                        1\n                    ]\n                ].map((item)=>{\n                    item[0] *= this.value.width > 0 ? 1 : -1;\n                    item[1] *= this.value.height > 0 ? 1 : -1;\n                    return item;\n                });\n                const tinyOffset = Math.abs(this.scaled.width) < 20 || Math.abs(this.scaled.height) < 20 ? 10 : 0;\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(g.el, {\n                    left: this.scaled.corners[g.i].x - this.gripSize / 2 + offsetArr[i][0] * tinyOffset + \"px\",\n                    top: this.scaled.corners[g.i].y - this.gripSize / 2 + offsetArr[i][1] * tinyOffset + \"px\"\n                });\n                // cursor\n                let angle = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).pointsToAngleDeg({\n                    x: this.value.x,\n                    y: this.value.y\n                }, (0, $9e052f3767af1736$export$3fba3b383c654cc6)(g.x, g.y, this.value)) + 135; // offset so nw is 0\n                while(angle < 0)angle += 360;\n                const index = Math.round(angle / 45) % this.cornerCursors.length;\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(g.el, {\n                    cursor: this.cornerCursors[index] + \"-resize\"\n                });\n            };\n            g.pointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n                target: this.corners[i].el,\n                fixScribble: true,\n                onPointer: (event)=>{\n                    event.eventPreventDefault();\n                    if (event.type === \"pointerdown\" && event.button === \"left\") this.corners[i].virtualPos = (0, $9e052f3767af1736$export$3fba3b383c654cc6)(this.corners[i].x, this.corners[i].y, this.value);\n                    else if (event.type === \"pointermove\" && event.button === \"left\") {\n                        this.corners[i].virtualPos.x += event.dX / this.viewportTransform.scale;\n                        this.corners[i].virtualPos.y += event.dY / this.viewportTransform.scale;\n                        let iP = {\n                            x: this.corners[i].virtualPos.x,\n                            y: this.corners[i].virtualPos.y\n                        };\n                        iP = this.constrainCorner(i, iP.x, iP.y);\n                        if (!this.isConstrained) iP = this.snapCorner(iP.x, iP.y);\n                        if (Math.abs(this.value.angleDeg) % 90 === 0) {\n                            iP.x = Math.round(iP.x);\n                            iP.y = Math.round(iP.y);\n                        }\n                        const tP = (0, $9e052f3767af1736$export$6a4549ec4168874a)(iP.x, iP.y, this.value);\n                        const dX = tP.x - this.corners[i].x;\n                        const dY = tP.y - this.corners[i].y;\n                        this.corners[i].x = tP.x;\n                        this.corners[i].y = tP.y;\n                        let indexes = [];\n                        if (i === 0) indexes = [\n                            3,\n                            1,\n                            2\n                        ];\n                        else if (i === 1) indexes = [\n                            2,\n                            0,\n                            3\n                        ];\n                        else if (i === 2) indexes = [\n                            1,\n                            3,\n                            0\n                        ];\n                        else if (i === 3) indexes = [\n                            0,\n                            2,\n                            1\n                        ];\n                        this.corners[indexes[0]].x = this.corners[i].x;\n                        this.corners[indexes[1]].y = this.corners[i].y;\n                        if (this.keyListener.isPressed(\"shift\")) {\n                            this.corners[indexes[2]].x -= dX;\n                            this.corners[indexes[2]].y -= dY;\n                            this.corners[indexes[1]].x = this.corners[indexes[2]].x;\n                            this.corners[indexes[0]].y = this.corners[indexes[2]].y;\n                        }\n                        this.updateTransformViaCorners();\n                    }\n                }\n            });\n        })(i);\n        this.updateCornerPositions();\n        this.updateScaled();\n        let isInverted;\n        for(let i = 0; i < 4; i++)((i)=>{\n            this.edges[i] = {\n                el: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    css: {\n                        width: this.edgeSize + \"px\",\n                        height: this.edgeSize + \"px\",\n                        /*background: [\n                                '#ff000044',\n                                '#00ff0044',\n                                '#0000ff44',\n                                '#ff00ff44',\n                            ][i],*/ position: \"absolute\"\n                    }\n                })\n            };\n            const g = this.edges[i];\n            g.updateDOM = ()=>{\n                if (i === 0) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(g.el, {\n                    left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + \"px\",\n                    top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) - this.edgeSize + \"px\",\n                    width: Math.abs(this.scaled.width) + \"px\",\n                    height: this.edgeSize + \"px\"\n                });\n                else if (i === 1) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(g.el, {\n                    left: Math.max(this.scaled.corners[0].x, this.scaled.corners[1].x) + \"px\",\n                    top: Math.min(this.scaled.corners[1].y, this.scaled.corners[2].y) + \"px\",\n                    width: this.edgeSize + \"px\",\n                    height: Math.abs(this.scaled.height) + \"px\"\n                });\n                else if (i === 2) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(g.el, {\n                    left: Math.min(this.scaled.corners[3].x, this.scaled.corners[2].x) + \"px\",\n                    top: Math.max(this.scaled.corners[0].y, this.scaled.corners[3].y) + \"px\",\n                    width: Math.abs(this.scaled.width) + \"px\",\n                    height: this.edgeSize + \"px\"\n                });\n                else if (i === 3) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(g.el, {\n                    left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) - this.edgeSize + \"px\",\n                    top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + \"px\",\n                    width: this.edgeSize + \"px\",\n                    height: Math.abs(this.scaled.height) + \"px\"\n                });\n                let angleOffset = Math.round(this.value.angleDeg / 45);\n                while(angleOffset < 0)angleOffset += 8;\n                angleOffset = (i * 2 + 1 + angleOffset) % this.cornerCursors.length;\n                g.el.style.cursor = this.cornerCursors[angleOffset] + \"-resize\";\n            };\n            const isVertical = [\n                0,\n                2\n            ].includes(i);\n            g.pointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n                target: this.edges[i].el,\n                fixScribble: true,\n                onPointer: (event)=>{\n                    event.eventPreventDefault();\n                    if (event.type === \"pointerdown\" && event.button === \"left\") {\n                        if (isVertical) isInverted = this.corners[0].y >= this.corners[3].y;\n                        else isInverted = this.corners[0].x >= this.corners[1].x;\n                        resetRemainder();\n                    }\n                    if (event.type === \"pointermove\" && event.button === \"left\") {\n                        const tfD = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotateAround({\n                            x: 0,\n                            y: 0\n                        }, {\n                            x: event.dX / this.viewportTransform.scale,\n                            y: event.dY / this.viewportTransform.scale\n                        }, -this.value.angleDeg);\n                        let ti = {\n                            dX: tfD.x,\n                            dY: tfD.y\n                        };\n                        if (Math.abs(this.value.angleDeg) % 90 === 0) ti = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).intDxy(pointerRemainder, tfD.x, tfD.y);\n                        let indexes = [];\n                        if (i === 0) indexes = [\n                            2,\n                            3,\n                            0,\n                            1\n                        ];\n                        else if (i === 1) indexes = [\n                            0,\n                            3,\n                            1,\n                            2\n                        ];\n                        else if (i === 2) indexes = [\n                            0,\n                            1,\n                            2,\n                            3\n                        ];\n                        else if (i === 3) indexes = [\n                            1,\n                            2,\n                            0,\n                            3\n                        ];\n                        const dimension = isVertical ? \"y\" : \"x\";\n                        const d = isVertical ? ti.dY : ti.dX;\n                        if (isInverted) {\n                            this.corners[indexes[0]][dimension] += d;\n                            this.corners[indexes[1]][dimension] += d;\n                        } else {\n                            this.corners[indexes[2]][dimension] += d;\n                            this.corners[indexes[3]][dimension] += d;\n                        }\n                        if (this.keyListener.isPressed(\"shift\")) {\n                            if (isInverted) {\n                                this.corners[indexes[2]][dimension] -= d;\n                                this.corners[indexes[3]][dimension] -= d;\n                            } else {\n                                this.corners[indexes[0]][dimension] -= d;\n                                this.corners[indexes[1]][dimension] -= d;\n                            }\n                        }\n                        if (isVertical) this.restoreRatio(false, true);\n                        else this.restoreRatio(true, false);\n                        this.updateTransformViaCorners();\n                    }\n                }\n            });\n        })(i);\n        this.angleGrip = {\n            el: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                css: {\n                    cursor: \"url(\" + (0, (/*@__PURE__*/$parcel$interopDefault($0a34fd024ca1cadf$exports))) + \") 10 10, move\",\n                    width: this.gripSize + \"px\",\n                    height: this.gripSize + \"px\",\n                    background: \"#0ff\",\n                    borderRadius: this.gripSize + \"px\",\n                    position: \"absolute\",\n                    boxShadow: \"inset 0 0 0 2px #000\"\n                }\n            }),\n            x: 0,\n            y: 0,\n            snap: false,\n            updateDOM: ()=>{\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.angleGrip.el, {\n                    left: this.angleGrip.x - this.gripSize / 2 + \"px\",\n                    top: this.angleGrip.y - this.gripSize / 2 + \"px\"\n                });\n            }\n        };\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.angleGrip.el,\n            css: {\n                width: \"2px\",\n                height: \"13px\",\n                left: this.gripSize / 2 - 1 + \"px\",\n                top: this.gripSize + \"px\",\n                background: \"#0ff\",\n                position: \"absolute\"\n            }\n        });\n        this.anglePointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.angleGrip.el,\n            fixScribble: true,\n            onPointer: (event)=>{\n                event.eventPreventDefault();\n                if (event.type === \"pointermove\" && event.button === \"left\") {\n                    const bounds = this.rootEl.getBoundingClientRect();\n                    const offset = {\n                        x: bounds.left - this.rootEl.scrollLeft + this.viewportTransform.x,\n                        y: bounds.top - this.rootEl.scrollTop + this.viewportTransform.y\n                    };\n                    const iP = {\n                        x: (event.clientX - offset.x) / this.viewportTransform.scale,\n                        y: (event.clientY - offset.y) / this.viewportTransform.scale\n                    };\n                    const a = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).pointsToAngleDeg({\n                        x: this.value.x,\n                        y: this.value.y\n                    }, iP) + 90;\n                    this.value.angleDeg = a;\n                    const snapDeg = Math.round(a / 360 * 8) * 45;\n                    if (this.keyListener.getComboStr() === \"shift\") this.value.angleDeg = snapDeg;\n                    else if (this.snappingEnabled && Math.abs(snapDeg - a) < 8) this.value.angleDeg = snapDeg;\n                    this.updateDOM();\n                }\n                if (event.type === \"pointerup\") {\n                    if (Math.abs(this.value.angleDeg) % 90 === 0) {\n                        (0, $9e052f3767af1736$export$958c2bfe8d7142a9)(this.value);\n                        this.updateCornerPositions();\n                        this.updateDOM();\n                    }\n                }\n            }\n        });\n        (0, $9e052f3767af1736$export$958c2bfe8d7142a9)(this.value);\n        this.updateDOM(true);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).append(this.transEl, [\n            this.boundsEl,\n            this.edges[0].el,\n            this.edges[1].el,\n            this.edges[2].el,\n            this.edges[3].el,\n            this.corners[0].el,\n            this.corners[1].el,\n            this.corners[2].el,\n            this.corners[3].el,\n            this.angleGrip.el\n        ]);\n    }\n}\n\n\n\n\n\nvar $03ec3d6a52165003$exports = {};\n\"use strict\";\n\n$03ec3d6a52165003$exports = (parcelRequire(\"6KItP\"));\n\n\n\n\nclass $1fee4e0c7c231d15$export$205c2dd29f8a66b5 {\n    updatePreview() {\n        const transform = this.freeTransform.getValue();\n        const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.previewCanvas);\n        ctx.save();\n        ctx.clearRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).drawTransformedImageWithBounds(ctx, this.layers[this.transformIndex].image, transform, undefined, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).testShouldPixelate(transform, transform.width / this.initTransform.width, transform.height / this.initTransform.height));\n        ctx.restore();\n        this.preview.render();\n    }\n    // ---- interface ----\n    move(dX, dY) {\n        this.freeTransform.move(dX, dY);\n    }\n    reset() {\n        const w = this.layers[this.transformIndex].image.width;\n        const h = this.layers[this.transformIndex].image.height;\n        this.freeTransform.setSize(w, h);\n        this.freeTransform.setPos({\n            x: w / 2,\n            y: h / 2\n        });\n        this.freeTransform.setAngleDeg(0);\n        this.updatePreview();\n    }\n    setTransformFit() {\n        const fit = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).fitInto(this.layers[this.transformIndex].image.width, this.layers[this.transformIndex].image.height, this.imageWidth, this.imageHeight, 1);\n        this.freeTransform.setSize(fit.width, fit.height);\n        this.freeTransform.setPos({\n            x: fit.width / 2,\n            y: fit.height / 2\n        });\n        this.freeTransform.setAngleDeg(0);\n        this.updatePreview();\n    }\n    setTransformCenter() {\n        this.freeTransform.setPos({\n            x: this.imageWidth / 2,\n            y: this.imageHeight / 2\n        });\n        this.freeTransform.setAngleDeg(0);\n        this.updatePreview();\n    }\n    /**\n     * gives you the transformation in the original scale\n     */ getTransformation() {\n        return this.freeTransform.getValue();\n    }\n    getIsPixelated() {\n        const transform = this.freeTransform.getValue();\n        return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).testShouldPixelate(transform, transform.width / this.initTransform.width, transform.height / this.initTransform.height);\n    }\n    getElement() {\n        return this.rootEl;\n    }\n    destroy() {\n        this.freeTransform.destroy();\n        this.preview.destroy();\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).freeCanvas(this.previewCanvas);\n    }\n    // ---- public ----\n    constructor(p){\n        this.imageWidth = p.imageWidth;\n        this.imageHeight = p.imageHeight;\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-preview-wrapper\",\n            css: {\n                width: p.elementWidth + \"px\",\n                height: p.elementHeight + \"px\"\n            }\n        });\n        this.rootEl.oncontextmenu = ()=>{\n            return false;\n        };\n        this.layers = p.layers;\n        this.transformIndex = p.transformIndex;\n        this.previewLayerArr = this.layers.map((item)=>{\n            var _item_mixModeStr;\n            return {\n                image: item.image,\n                isVisible: item.isVisible,\n                mixModeStr: (_item_mixModeStr = item.mixModeStr) !== null && _item_mixModeStr !== void 0 ? _item_mixModeStr : \"source-over\",\n                opacity: item.opacity,\n                hasClipping: false\n            };\n        });\n        this.previewCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(this.imageWidth, this.imageHeight);\n        this.previewLayerArr[this.previewLayerArr.length - 1].image = this.previewCanvas;\n        this.preview = new (0, $324add89932145ee$export$133773870222880f)({\n            width: p.elementWidth,\n            height: p.elementHeight,\n            project: {\n                width: p.imageWidth,\n                height: p.imageHeight,\n                layers: this.previewLayerArr\n            },\n            hasEditMode: true,\n            onModeChange: (m)=>{\n                this.freeTransform.getElement().style.pointerEvents = m === \"edit\" ? \"\" : \"none\";\n                this.freeTransform.getElement().style.opacity = m === \"edit\" ? \"\" : \"0.5\";\n            },\n            onTransformChange: (transform)=>{\n                this.freeTransform.setViewportTransform(transform);\n            },\n            padding: 30\n        });\n        this.preview.getElement().classList.add((0, $03ec3d6a52165003$exports.css)({\n            overflow: \"hidden\",\n            marginLeft: \"-20px\",\n            marginRight: \"-20px\"\n        }));\n        this.rootEl.append(this.preview.getElement());\n        this.initTransform = {\n            x: this.imageWidth / 2,\n            y: this.imageHeight / 2,\n            width: this.layers[this.transformIndex].image.width,\n            height: this.layers[this.transformIndex].image.height\n        };\n        this.freeTransform = new (0, $d42d1384577ab84d$export$79a74567acf241b0)({\n            x: this.initTransform.x,\n            y: this.initTransform.y,\n            width: this.initTransform.width,\n            height: this.initTransform.height,\n            angleDeg: 0,\n            isConstrained: true,\n            snapX: [\n                0,\n                this.imageWidth\n            ],\n            snapY: [\n                0,\n                this.imageHeight\n            ],\n            viewportTransform: this.preview.getTransform(),\n            callback: ()=>{\n                this.updatePreview();\n            }\n        });\n        this.preview.getElement().append(this.freeTransform.getElement());\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.freeTransform.getElement(), {\n            position: \"absolute\",\n            left: \"0\",\n            top: \"0\"\n        });\n        setTimeout(()=>this.updatePreview(), 0);\n    }\n}\n\n\n\nclass $c4e8a5b20c195c16$export$71ed2b85d4ca43d3 {\n    update() {\n        this.edges[0].update();\n        this.edges[1].update();\n        this.edges[2].update();\n        this.edges[3].update();\n        this.cornerElArr[0].update();\n        this.cornerElArr[1].update();\n        this.cornerElArr[2].update();\n        this.cornerElArr[3].update();\n        this.darken[0].update();\n        this.darken[1].update();\n        this.darken[2].update();\n        this.darken[3].update();\n        this.outline.update();\n        this.thirdsHorizontal.update();\n        this.thirdsVertical.update();\n    }\n    commit() {\n        this.pointerRemainder.x = 0;\n        this.pointerRemainder.y = 0;\n        this.callback(this.getTransform());\n    }\n    // ---- interface ----\n    getTransform() {\n        this.grips[1].x -= this.grips[0].x;\n        this.grips[1].y -= this.grips[0].y;\n        this.grips[2].x -= this.grips[0].x;\n        this.grips[2].y -= this.grips[0].y;\n        this.grips[3].x -= this.grips[0].x;\n        this.grips[3].y -= this.grips[0].y;\n        this.x += this.grips[0].x;\n        this.y += this.grips[0].y;\n        this.grips[0].x = 0;\n        this.grips[0].y = 0;\n        return {\n            x: this.x,\n            y: this.y,\n            width: this.grips[1].x,\n            height: this.grips[2].y\n        };\n    }\n    setTransform(p) {\n        this.x = p.x;\n        this.y = p.y;\n        this.width = p.width;\n        this.height = p.height;\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.rootEl, {\n            left: this.x * this.scale + \"px\",\n            top: this.y * this.scale + \"px\"\n        });\n        this.grips[0].x = 0;\n        this.grips[0].y = 0;\n        this.grips[1].x = this.width;\n        this.grips[1].y = 0;\n        this.grips[2].x = this.width;\n        this.grips[2].y = this.height;\n        this.grips[3].x = 0;\n        this.grips[3].y = this.height;\n        this.update();\n        this.commit();\n    }\n    setScale(s) {\n        this.scale = s;\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.rootEl, {\n            left: this.x * this.scale + \"px\",\n            top: this.y * this.scale + \"px\"\n        });\n        this.update();\n    }\n    showThirds(b) {\n        this.thirdsHorizontal.el.style.display = b ? \"block\" : \"none\";\n        this.thirdsVertical.el.style.display = b ? \"block\" : \"none\";\n    }\n    getElement() {\n        return this.rootEl;\n    }\n    destroy() {\n        this.keyListener.destroy();\n        this.outlinePointerListener.destroy();\n        this.corner0PointerListener.destroy();\n        this.corner1PointerListener.destroy();\n        this.corner2PointerListener.destroy();\n        this.corner3PointerListener.destroy();\n        this.edge0PointerListener.destroy();\n        this.edge1PointerListener.destroy();\n        this.edge2PointerListener.destroy();\n        this.edge3PointerListener.destroy();\n    }\n    // ---- public ----\n    constructor(params){\n        this.x = params.x;\n        this.y = params.y;\n        this.width = params.width;\n        this.height = params.height;\n        this.scale = params.scale;\n        this.callback = params.callback;\n        const maxW = params.maxW;\n        const maxH = params.maxW;\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const gripCursors = [\n            \"nw\",\n            \"n\",\n            \"ne\",\n            \"e\",\n            \"se\",\n            \"s\",\n            \"sw\",\n            \"w\"\n        ];\n        this.keyListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).KeyListener({});\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.rootEl, {\n            position: \"absolute\",\n            left: this.x * this.scale + \"px\",\n            top: this.y * this.scale + \"px\"\n        });\n        this.outline = {\n            el: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                css: {\n                    position: \"absolute\",\n                    border: \"1px dashed #fff\",\n                    cursor: \"move\"\n                }\n            }),\n            update: ()=>{\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.outline.el, {\n                    left: this.grips[0].x * this.scale - 1 + \"px\",\n                    top: this.grips[0].y * this.scale - 1 + \"px\",\n                    width: (this.grips[2].x - this.grips[0].x) * this.scale + \"px\",\n                    height: (this.grips[2].y - this.grips[0].y) * this.scale + \"px\"\n                });\n            }\n        };\n        this.pointerRemainder = {\n            x: 0,\n            y: 0\n        };\n        this.outlinePointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.outline.el,\n            onPointer: (event)=>{\n                event.eventPreventDefault();\n                if (event.type === \"pointermove\" && event.button === \"left\") {\n                    const { dX: dX, dY: dY } = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    this.grips[0].x += dX;\n                    this.grips[0].y += dY;\n                    this.grips[1].x += dX;\n                    this.grips[1].y += dY;\n                    this.grips[2].x += dX;\n                    this.grips[2].y += dY;\n                    this.grips[3].x += dX;\n                    this.grips[3].y += dY;\n                    this.update();\n                }\n                if (event.type === \"pointerup\") this.commit();\n            }\n        });\n        this.thirdsHorizontal = {\n            el: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                css: {\n                    position: \"absolute\",\n                    borderTop: \"1px solid #0ff\",\n                    borderBottom: \"1px solid #0ff\"\n                }\n            }),\n            update: ()=>{\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.thirdsHorizontal.el, {\n                    left: this.grips[0].x * this.scale + \"px\",\n                    top: (this.grips[0].y + (this.grips[2].y - this.grips[0].y) / 3) * this.scale + \"px\",\n                    width: (this.grips[2].x - this.grips[0].x) * this.scale + \"px\",\n                    height: (this.grips[2].y - this.grips[0].y) / 3 * this.scale + \"px\"\n                });\n            }\n        };\n        this.thirdsVertical = {\n            el: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                css: {\n                    position: \"absolute\",\n                    borderLeft: \"1px solid #0ff\",\n                    borderRight: \"1px solid #0ff\"\n                }\n            }),\n            update: ()=>{\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.thirdsVertical.el, {\n                    left: (this.grips[0].x + (this.grips[2].x - this.grips[0].x) / 3) * this.scale + \"px\",\n                    top: this.grips[0].y * this.scale + \"px\",\n                    width: (this.grips[2].x - this.grips[0].x) / 3 * this.scale + \"px\",\n                    height: (this.grips[2].y - this.grips[0].y) * this.scale + \"px\"\n                });\n            }\n        };\n        const gripSize = 40;\n        const gripOverlay = 10;\n        this.grips = [\n            {\n                x: 0,\n                y: 0\n            },\n            {\n                x: this.width,\n                y: 0\n            },\n            {\n                x: this.width,\n                y: this.height\n            },\n            {\n                x: 0,\n                y: this.height\n            }\n        ];\n        const transformTop = (dY)=>{\n            this.grips[0].y += dY;\n            this.grips[0].y = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(this.grips[0].y, this.grips[3].y - maxH, this.grips[3].y - 1);\n            this.grips[1].y = this.grips[0].y;\n        };\n        const transformRight = (dX)=>{\n            this.grips[1].x += dX;\n            this.grips[1].x = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(this.grips[1].x, this.grips[0].x + 1, this.grips[0].x + maxW);\n            this.grips[2].x = this.grips[1].x;\n        };\n        const transformBottom = (dY)=>{\n            this.grips[2].y += dY;\n            this.grips[2].y = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(this.grips[2].y, this.grips[1].y + 1, this.grips[1].y + maxH);\n            this.grips[3].y = this.grips[2].y;\n        };\n        const transformLeft = (dX)=>{\n            this.grips[0].x += dX;\n            this.grips[0].x = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(this.grips[0].x, this.grips[1].x - maxW, this.grips[1].x - 1);\n            this.grips[3].x = this.grips[0].x;\n        };\n        this.edges = [];\n        for(let i = 0; i < 4; i++)((i)=>{\n            const el = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                css: {\n                    width: gripSize + \"px\",\n                    height: gripSize + \"px\",\n                    //background: '#0f0',\n                    position: \"absolute\"\n                }\n            });\n            const update = ()=>{\n                if (i === 0) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(el, {\n                    left: this.grips[0].x * this.scale + gripOverlay + \"px\",\n                    top: this.grips[0].y * this.scale - gripSize * 2 + gripOverlay + \"px\",\n                    width: (this.grips[1].x - this.grips[0].x) * this.scale - gripOverlay * 2 + \"px\",\n                    height: gripSize * 2 + \"px\"\n                });\n                else if (i === 1) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(el, {\n                    left: this.grips[1].x * this.scale - gripOverlay + \"px\",\n                    top: this.grips[1].y * this.scale + gripOverlay + \"px\",\n                    width: gripSize * 2 + \"px\",\n                    height: (this.grips[2].y - this.grips[1].y) * this.scale - gripOverlay * 2 + \"px\"\n                });\n                else if (i === 2) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(el, {\n                    left: this.grips[3].x * this.scale + gripOverlay + \"px\",\n                    top: this.grips[3].y * this.scale - gripOverlay + \"px\",\n                    width: (this.grips[2].x - this.grips[3].x) * this.scale - gripOverlay * 2 + \"px\",\n                    height: gripSize * 2 + \"px\"\n                });\n                else if (i === 3) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(el, {\n                    left: this.grips[0].x * this.scale - gripSize * 2 + gripOverlay + \"px\",\n                    top: this.grips[0].y * this.scale + gripOverlay + \"px\",\n                    width: gripSize * 2 + \"px\",\n                    height: (this.grips[3].y - this.grips[0].y) * this.scale - gripOverlay * 2 + \"px\"\n                });\n                const angleOffset = i * 2 + 1;\n                el.style.cursor = gripCursors[angleOffset] + \"-resize\";\n            };\n            this.edges[i] = {\n                el: el,\n                update: update\n            };\n        })(i);\n        this.darken = [];\n        for(let i = 0; i < 4; i++)((i)=>{\n            const g = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                css: {\n                    position: \"absolute\",\n                    background: \"#000\",\n                    opacity: \"0.5\"\n                }\n            });\n            const update = ()=>{\n                if (i === 0) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(g, {\n                    left: this.grips[0].x * this.scale + \"px\",\n                    top: this.grips[0].y * this.scale - 8000 + \"px\",\n                    width: (this.grips[1].x - this.grips[0].x) * this.scale + \"px\",\n                    height: \"8000px\"\n                });\n                else if (i === 1) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(g, {\n                    left: this.grips[1].x * this.scale + \"px\",\n                    top: this.grips[1].y * this.scale - 8000 + \"px\",\n                    width: \"8000px\",\n                    height: \"16000px\"\n                });\n                else if (i === 2) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(g, {\n                    left: this.grips[3].x * this.scale + \"px\",\n                    top: this.grips[3].y * this.scale + \"px\",\n                    width: (this.grips[2].x - this.grips[3].x) * this.scale + \"px\",\n                    height: \"8000px\"\n                });\n                else if (i === 3) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(g, {\n                    left: this.grips[0].x * this.scale - 8000 + \"px\",\n                    top: this.grips[0].y * this.scale - 8000 + \"px\",\n                    width: \"8000px\",\n                    height: \"16000px\"\n                });\n            };\n            this.darken[i] = {\n                el: g,\n                update: update\n            };\n        })(i);\n        this.edge0PointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.edges[0].el,\n            fixScribble: true,\n            onPointer: (event)=>{\n                event.eventPreventDefault();\n                if (event.type === \"pointermove\" && event.button === \"left\") {\n                    const { dY: dY } = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformTop(dY);\n                    if (this.keyListener.isPressed(\"shift\")) transformBottom(-dY);\n                    this.update();\n                }\n                if (event.type === \"pointerup\") this.commit();\n            }\n        });\n        this.edge1PointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.edges[1].el,\n            fixScribble: true,\n            onPointer: (event)=>{\n                event.eventPreventDefault();\n                if (event.type === \"pointermove\" && event.button === \"left\") {\n                    const { dX: dX, dY: dY } = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformRight(dX);\n                    if (this.keyListener.isPressed(\"shift\")) transformLeft(-dX);\n                    this.update();\n                }\n                if (event.type === \"pointerup\") this.commit();\n            }\n        });\n        this.edge2PointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.edges[2].el,\n            fixScribble: true,\n            onPointer: (event)=>{\n                event.eventPreventDefault();\n                if (event.type === \"pointermove\" && event.button === \"left\") {\n                    const { dX: dX, dY: dY } = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformBottom(dY);\n                    if (this.keyListener.isPressed(\"shift\")) transformTop(-dY);\n                    this.update();\n                }\n                if (event.type === \"pointerup\") this.commit();\n            }\n        });\n        this.edge3PointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.edges[3].el,\n            fixScribble: true,\n            onPointer: (event)=>{\n                event.eventPreventDefault();\n                if (event.type === \"pointermove\" && event.button === \"left\") {\n                    const { dX: dX, dY: dY } = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformLeft(dX);\n                    if (this.keyListener.isPressed(\"shift\")) transformRight(-dX);\n                    this.update();\n                }\n                if (event.type === \"pointerup\") this.commit();\n            }\n        });\n        this.cornerElArr = [];\n        (()=>{\n            for(let i = 0; i < 4; i++)((i)=>{\n                const g = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    css: {\n                        //background: '#f00',\n                        width: gripSize * 2 + \"px\",\n                        height: gripSize * 2 + \"px\",\n                        position: \"absolute\",\n                        cursor: [\n                            \"nwse-resize\",\n                            \"nesw-resize\"\n                        ][i % 2]\n                    }\n                });\n                const update = ()=>{\n                    if (i === 0) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(g, {\n                        left: this.grips[0].x * this.scale - gripSize * 2 + gripOverlay + \"px\",\n                        top: this.grips[0].y * this.scale - gripSize * 2 + gripOverlay + \"px\"\n                    });\n                    else if (i === 1) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(g, {\n                        left: this.grips[1].x * this.scale - gripOverlay + \"px\",\n                        top: this.grips[1].y * this.scale - gripSize * 2 + gripOverlay + \"px\"\n                    });\n                    else if (i === 2) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(g, {\n                        left: this.grips[1].x * this.scale - gripOverlay + \"px\",\n                        top: this.grips[2].y * this.scale - gripOverlay + \"px\"\n                    });\n                    else if (i === 3) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(g, {\n                        left: this.grips[0].x * this.scale - gripSize * 2 + gripOverlay + \"px\",\n                        top: this.grips[2].y * this.scale - gripOverlay + \"px\"\n                    });\n                };\n                this.cornerElArr[i] = {\n                    el: g,\n                    update: update\n                };\n            })(i);\n        })();\n        //top left\n        this.corner0PointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.cornerElArr[0].el,\n            fixScribble: true,\n            onPointer: (event)=>{\n                event.eventPreventDefault();\n                if (event.type === \"pointermove\" && event.button === \"left\") {\n                    const { dX: dX, dY: dY } = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformLeft(dX);\n                    transformTop(dY);\n                    if (this.keyListener.isPressed(\"shift\")) {\n                        transformRight(-dX);\n                        transformBottom(-dY);\n                    }\n                    this.update();\n                }\n                if (event.type === \"pointerup\") this.commit();\n            }\n        });\n        //top right\n        this.corner1PointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.cornerElArr[1].el,\n            fixScribble: true,\n            onPointer: (event)=>{\n                event.eventPreventDefault();\n                if (event.type === \"pointermove\" && event.button === \"left\") {\n                    const { dX: dX, dY: dY } = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformRight(dX);\n                    transformTop(dY);\n                    if (this.keyListener.isPressed(\"shift\")) {\n                        transformLeft(-dX);\n                        transformBottom(-dY);\n                    }\n                    this.update();\n                }\n                if (event.type === \"pointerup\") this.commit();\n            }\n        });\n        //bottom right\n        this.corner2PointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.cornerElArr[2].el,\n            fixScribble: true,\n            onPointer: (event)=>{\n                event.eventPreventDefault();\n                if (event.type === \"pointermove\" && event.button === \"left\") {\n                    const { dX: dX, dY: dY } = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformRight(dX);\n                    transformBottom(dY);\n                    if (this.keyListener.isPressed(\"shift\")) {\n                        transformLeft(-dX);\n                        transformTop(-dY);\n                    }\n                    this.update();\n                }\n                if (event.type === \"pointerup\") this.commit();\n            }\n        });\n        //bottom left\n        this.corner3PointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.cornerElArr[3].el,\n            fixScribble: true,\n            onPointer: (event)=>{\n                event.eventPreventDefault();\n                if (event.type === \"pointermove\" && event.button === \"left\") {\n                    const { dX: dX, dY: dY } = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformLeft(dX);\n                    transformBottom(dY);\n                    if (this.keyListener.isPressed(\"shift\")) {\n                        transformRight(-dX);\n                        transformTop(-dY);\n                    }\n                    this.update();\n                }\n                if (event.type === \"pointerup\") this.commit();\n            }\n        });\n        this.rootEl.append(this.darken[1].el, this.darken[0].el, this.darken[2].el, this.darken[3].el, this.thirdsHorizontal.el, this.thirdsVertical.el, this.outline.el, this.edges[1].el, this.edges[0].el, this.edges[2].el, this.edges[3].el, this.cornerElArr[0].el, this.cornerElArr[1].el, this.cornerElArr[2].el, this.cornerElArr[3].el);\n        this.update();\n    }\n}\n\n\n\n\n\n\n\nclass $6f827bc527014b7f$export$d25420b53e16716f {\n    updateCheckerPatterns() {\n        const checker = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createCheckerCanvas(4, (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark());\n        this.animationCanvasCheckerPattern = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.animationCanvasCtx.createPattern(checker, \"repeat\"));\n        this.largeCanvasCheckerPattern = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.canvasCtx.createPattern(checker, \"repeat\"));\n    }\n    animate() {\n        if (this.animationCount === 0) return;\n        this.animationCount--;\n        this.canvasCtx.save();\n        this.canvasCtx.globalAlpha = Math.pow((this.animationLength - this.animationCount) / this.animationLength, 2);\n        this.canvasCtx.drawImage(this.animationCanvas, 0, 0);\n        this.canvasCtx.restore();\n        if (this.animationCount > 0) requestAnimationFrame(()=>this.animate());\n    }\n    /**\n     * is always instant\n     */ drawLargeCanvas() {\n        if (!this.largeCanvasIsVisible || !this.layerObj) return;\n        const layerCanvas = this.layerObj.context.canvas;\n        const canvasDimensions = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).fitInto(layerCanvas.width, layerCanvas.height, this.largeCanvasSize, this.largeCanvasSize, 1);\n        this.largeCanvas.width = Math.round(canvasDimensions.width);\n        this.largeCanvas.height = Math.round(canvasDimensions.height);\n        this.largeCanvasCtx.save();\n        if (this.largeCanvas.width > layerCanvas.width) this.largeCanvasCtx.imageSmoothingEnabled = false;\n        else {\n            this.largeCanvasCtx.imageSmoothingEnabled = true;\n            this.largeCanvasCtx.imageSmoothingQuality = \"high\";\n        }\n        this.largeCanvasCtx.fillStyle = this.largeCanvasCheckerPattern;\n        this.largeCanvasCtx.fillRect(0, 0, this.largeCanvas.width, this.largeCanvas.height);\n        this.largeCanvasCtx.drawImage(layerCanvas, 0, 0, this.largeCanvas.width, this.largeCanvas.height);\n        this.largeCanvasCtx.restore();\n        const bounds = this.rootEl.getBoundingClientRect();\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.largeCanvasWrapper, {\n            top: Math.max(10, bounds.top + this.height / 2 - this.largeCanvas.height / 2) + \"px\"\n        });\n    }\n    draw(isInstant) {\n        if (!this.isVisible || !this.layerObj) return;\n        const layerIsVisible = this.layerObj.isVisible;\n        this.checkEl.parentElement.title = layerIsVisible ? (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-active-layer-visible\") : (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-active-layer-hidden\");\n        this.checkEl.checked = layerIsVisible;\n        this.checkEl.style.boxShadow = layerIsVisible ? \"\" : \"0 0 0 1px red\";\n        this.nameLabelEl.textContent = this.layerObj.name;\n        if (this.layerObj.isVisible) this.opacityEl.innerHTML = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"opacity\") + \"<br>\" + Math.round(this.layerObj.opacity * 100) + \"%\";\n        else this.opacityEl.innerHTML = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"opacity\") + \"<br><s>\" + Math.round(this.layerObj.opacity * 100) + \"%</s>\";\n        const layerCanvas = this.layerObj.context.canvas;\n        if (layerCanvas.width !== this.lastDrawnSize.width || layerCanvas.height !== this.lastDrawnSize.height) {\n            const canvasDimensions = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).fitInto(layerCanvas.width, layerCanvas.height, this.canvasSize, this.canvasSize, 1);\n            this.canvas.width = Math.round(canvasDimensions.width);\n            this.canvas.height = Math.round(canvasDimensions.height);\n            isInstant = true;\n        }\n        this.animationCanvas.width = this.canvas.width;\n        this.animationCanvas.height = this.canvas.height;\n        this.animationCanvasCtx.save();\n        this.animationCanvasCtx.imageSmoothingEnabled = false;\n        this.animationCanvasCtx.fillStyle = this.animationCanvasCheckerPattern;\n        this.animationCanvasCtx.fillRect(0, 0, this.animationCanvas.width, this.animationCanvas.height);\n        this.animationCanvasCtx.drawImage(layerCanvas, 0, 0, this.animationCanvas.width, this.animationCanvas.height);\n        this.animationCanvasCtx.restore();\n        if (isInstant) {\n            this.animationCount = 0;\n            this.canvasCtx.save();\n            this.canvasCtx.drawImage(this.animationCanvas, 0, 0);\n            this.canvasCtx.restore();\n        } else {\n            this.animationCount = this.animationLength;\n            this.animate();\n        }\n        this.drawLargeCanvas();\n        this.lastDrawnState = (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).getState();\n        this.lastDrawnSize.width = layerCanvas.width;\n        this.lastDrawnSize.height = layerCanvas.height;\n    }\n    // ---- interface ----\n    getElement() {\n        return this.rootEl;\n    }\n    setIsVisible(b) {\n        if (this.isVisible === b) return;\n        this.isVisible = b;\n        this.contentWrapperEl.style.display = this.isVisible ? \"flex\" : \"none\";\n        this.rootEl.style.marginBottom = this.isVisible ? \"\" : \"10px\";\n        const currentState = (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).getState();\n        if (b && this.lastDrawnState !== currentState) this.draw(true);\n    }\n    //when the layer might have changed\n    setLayer(klCanvasLayerObj) {\n        this.layerObj = klCanvasLayerObj;\n        this.draw(true);\n    }\n    setUiState(stateStr) {\n        this.uiState = stateStr;\n        if (this.uiState === \"left\") (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.largeCanvasWrapper, {\n            left: \"280px\",\n            right: \"\"\n        });\n        else (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.largeCanvasWrapper, {\n            left: \"\",\n            right: \"280px\"\n        });\n    }\n    // ---- public ----\n    constructor(p){\n        this.animationCanvasCheckerPattern = {};\n        this.largeCanvasCheckerPattern = {};\n        // internally redraws with in an interval. checks history is something changed\n        // this update will be animated\n        // it will not be animated if the resolution changed\n        // also redraws when you call updateLayer - not animated\n        // syncs via updateLayer, and internally updates layer opacity via a hack\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-layer-preview\"\n        });\n        this.isVisible = true;\n        this.height = 40;\n        this.canvasSize = this.height - 10;\n        this.largeCanvasSize = 300;\n        this.lastDrawnState = -2;\n        this.lastDrawnSize = {\n            width: 0,\n            height: 0\n        };\n        this.animationCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(); // to help animate the transition\n        this.animationCanvasCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.animationCanvas);\n        this.animationLength = 30;\n        this.animationCount = 0;\n        this.largeCanvasIsVisible = false;\n        let largeCanvasAnimationTimeout;\n        const largeCanvasAnimationDurationMs = 300;\n        this.uiState = p.uiState;\n        // --- setup dom ---\n        this.contentWrapperEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                display: \"flex\",\n                alignItems: \"center\",\n                height: this.height + \"px\"\n            }\n        });\n        const checkWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                display: \"flex\",\n                justifyContent: \"flex-end\",\n                alignItems: \"center\",\n                width: \"23px\",\n                flexShrink: \"0\"\n            }\n        });\n        this.checkEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: checkWrapper,\n            tagName: \"input\",\n            css: {\n                pointerEvents: \"none\"\n            },\n            custom: {\n                type: \"checkbox\",\n                disabled: \"true\"\n            }\n        });\n        const canvasWrapperEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                //background: '#f00',\n                minWidth: this.height + \"px\",\n                height: this.height + \"px\",\n                display: \"flex\",\n                justifyContent: \"center\",\n                alignItems: \"center\"\n            }\n        });\n        this.canvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(this.canvasSize, this.canvasSize);\n        this.canvasCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.canvas);\n        this.canvas.title = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-active-layer\");\n        const nameWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                //background: '#ff0',\n                flexGrow: \"1\",\n                paddingLeft: \"10px\",\n                fontSize: \"13px\",\n                overflow: \"hidden\",\n                position: \"relative\"\n            }\n        });\n        this.nameLabelEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: \"\",\n            css: {\n                cssFloat: \"left\",\n                whiteSpace: \"nowrap\"\n            }\n        });\n        const clickableEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                // background: 'rgba(0,255,0,0.6)',\n                position: \"absolute\",\n                left: \"10px\",\n                top: \"0\",\n                width: \"90px\",\n                height: \"100%\"\n            }\n        });\n        if (p.onClick) {\n            clickableEl.addEventListener(\"click\", ()=>p.onClick());\n            this.canvas.addEventListener(\"click\", ()=>p.onClick());\n            checkWrapper.addEventListener(\"click\", ()=>p.onClick());\n        }\n        this.opacityEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"opacity\") + \"<br>100%\",\n            css: {\n                minWidth: \"60px\",\n                fontSize: \"12px\",\n                textAlign: \"center\"\n            }\n        });\n        this.largeCanvasWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            onClick: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).handleClick,\n            css: {\n                pointerEvents: \"none\",\n                background: \"#fff\",\n                position: \"absolute\",\n                right: \"280px\",\n                top: \"10px\",\n                border: \"1px solid #aaa\",\n                boxShadow: \"1px 1px 3px rgba(0,0,0,0.3)\",\n                transition: \"opacity \" + largeCanvasAnimationDurationMs + \"ms ease-in-out\",\n                userSelect: \"none\",\n                display: \"block\",\n                webkitTouchCallout: \"none\"\n            }\n        });\n        this.largeCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(this.largeCanvasSize, this.largeCanvasSize);\n        this.largeCanvasWrapper.append(this.largeCanvas);\n        this.largeCanvasCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.largeCanvas);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.largeCanvas, {\n            display: \"block\"\n        });\n        canvasWrapperEl.append(this.canvas);\n        nameWrapper.append(this.nameLabelEl, clickableEl);\n        this.contentWrapperEl.append(checkWrapper, canvasWrapperEl, nameWrapper, this.opacityEl);\n        this.rootEl.append(this.contentWrapperEl);\n        this.updateCheckerPatterns();\n        (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).addIsDarkListener(()=>{\n            this.updateCheckerPatterns();\n            this.draw(true);\n        });\n        // --- update logic ---\n        // cross-fade done via 2 canvases (old and new state)\n        // both have checkerboard background drawn on them, both fully opaque\n        // -> no \"lighter\" is needed for accurate cross-fading\n        setInterval(()=>{\n            if (!this.layerObj) return;\n            const currentState = (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).getState();\n            if (currentState === this.lastDrawnState) return;\n            //update opacity w hack\n            this.layerObj.opacity = this.layerObj.context.canvas.opacity;\n            this.draw(false);\n        }, 2000);\n        const removeLargeCanvas = ()=>{\n            this.largeCanvasWrapper.remove();\n        };\n        const showLargeCanvas = (b)=>{\n            if (this.largeCanvasIsVisible === b) return;\n            clearTimeout(largeCanvasAnimationTimeout);\n            this.largeCanvasIsVisible = b;\n            if (b) largeCanvasAnimationTimeout = setTimeout(()=>{\n                this.drawLargeCanvas();\n                this.largeCanvasWrapper.style.opacity = \"0\";\n                p.klRootEl.append(this.largeCanvasWrapper);\n                setTimeout(()=>{\n                    this.largeCanvasWrapper.style.opacity = \"1\";\n                }, 20);\n            }, 250);\n            else {\n                this.largeCanvasWrapper.style.opacity = \"0\";\n                largeCanvasAnimationTimeout = setTimeout(removeLargeCanvas, largeCanvasAnimationDurationMs + 20);\n            }\n        };\n        const pointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.canvas,\n            onEnterLeave: (b)=>{\n                showLargeCanvas(b);\n            }\n        });\n    }\n}\n\n\n\n\n\n\nfunction $8522c24dbe0f81fc$export$8f6817a932bf45cd() {\n    return window.innerWidth < 550;\n}\n\n\nconst $3ec5d4ed5944260f$export$d9bc74bec37df668 = {\n    width: 340,\n    height: 220\n};\nconst $3ec5d4ed5944260f$export$858e9cb22b0cda44 = {\n    width: 540,\n    height: 300\n};\nfunction $3ec5d4ed5944260f$export$8b9199c1f5e4be8(isSmall) {\n    return isSmall ? $3ec5d4ed5944260f$export$d9bc74bec37df668.width : $3ec5d4ed5944260f$export$858e9cb22b0cda44.width;\n}\nfunction $3ec5d4ed5944260f$export$94cffdbcf128864a(isSmall) {\n    return isSmall ? $3ec5d4ed5944260f$export$d9bc74bec37df668.height : $3ec5d4ed5944260f$export$858e9cb22b0cda44.height;\n}\n\n\nfunction $6be05b3a68464314$export$962af7e240721d88(params) {\n    const div = document.createElement(\"div\");\n    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).appendTextDiv(div, (0, $63d0b335c576c718$export$ce37e184d908d785)(\"import-as-layer-description\"));\n    if (params.klCanvas.isLayerLimitReached()) {\n        const noteEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"import-as-layer-limit-reached\"),\n            css: {\n                background: \"#ff0\",\n                padding: \"10px\",\n                marginTop: \"5px\",\n                marginBottom: \"5px\",\n                border: \"1px solid #e7d321\",\n                borderRadius: \"5px\"\n            }\n        });\n        div.append(noteEl);\n    }\n    const isSmall = (0, $8522c24dbe0f81fc$export$8f6817a932bf45cd)();\n    const buttonRowEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        css: {\n            display: \"flex\"\n        }\n    });\n    const originalSizeBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        tagName: \"button\",\n        content: \"1:1\",\n        css: {\n            marginRight: \"10px\"\n        },\n        onClick: function() {\n            freeTransformCanvas.reset();\n        }\n    });\n    const fitSizeBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        tagName: \"button\",\n        content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"import-as-layer-fit\"),\n        css: {\n            marginRight: \"10px\"\n        },\n        onClick: function() {\n            freeTransformCanvas.setTransformFit();\n        }\n    });\n    const centerBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        tagName: \"button\",\n        content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"center\"),\n        css: {\n            marginRight: \"10px\"\n        },\n        onClick: function() {\n            freeTransformCanvas.setTransformCenter();\n        }\n    });\n    buttonRowEl.append(originalSizeBtn, fitSizeBtn, centerBtn);\n    div.append(buttonRowEl);\n    const layers = [];\n    {\n        const klCanvasLayerArr = params.klCanvas.getLayers();\n        for(let i = 0; i < klCanvasLayerArr.length; i++)layers.push({\n            image: klCanvasLayerArr[i].context.canvas,\n            isVisible: klCanvasLayerArr[i].isVisible,\n            opacity: klCanvasLayerArr[i].opacity,\n            mixModeStr: klCanvasLayerArr[i].mixModeStr\n        });\n    }\n    layers.push({\n        image: params.importImage,\n        isVisible: true,\n        opacity: 1,\n        mixModeStr: \"source-over\"\n    });\n    const freeTransformCanvas = new (0, $1fee4e0c7c231d15$export$205c2dd29f8a66b5)({\n        elementWidth: (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall),\n        elementHeight: (0, $3ec5d4ed5944260f$export$94cffdbcf128864a)(isSmall) + 50,\n        imageWidth: params.klCanvas.getLayerContext(0).canvas.width,\n        imageHeight: params.klCanvas.getLayerContext(0).canvas.height,\n        layers: layers,\n        transformIndex: layers.length - 1\n    });\n    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(freeTransformCanvas.getElement(), {\n        marginTop: \"10px\",\n        marginLeft: \"-20px\"\n    });\n    div.append(freeTransformCanvas.getElement());\n    function move(x, y) {\n        freeTransformCanvas.move(x, y);\n    }\n    const keyListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).KeyListener({\n        onDown: function(keyStr) {\n            if (keyStr === \"left\") move(-1, 0);\n            if (keyStr === \"right\") move(1, 0);\n            if (keyStr === \"up\") move(0, -1);\n            if (keyStr === \"down\") move(0, 1);\n        }\n    });\n    (0, $2016c314bff36ab9$export$d7e8d4d4450c819c)({\n        target: params.target,\n        message: `<b>${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"import-as-layer-title\")}</b>`,\n        div: div,\n        style: isSmall ? undefined : {\n            width: \"540px\"\n        },\n        buttons: [\n            \"Ok\",\n            \"Cancel\"\n        ],\n        clickOnEnter: \"Ok\",\n        callback: function(buttonStr) {\n            keyListener.destroy();\n            freeTransformCanvas.destroy();\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(originalSizeBtn);\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(fitSizeBtn);\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(centerBtn);\n            if (buttonStr === \"Ok\") params.callback(freeTransformCanvas.getTransformation(), freeTransformCanvas.getIsPixelated());\n            else params.callback();\n        }\n    });\n}\n\n\n\nclass $71c20b9a25b8f899$export$e789742143ba5b1 {\n    // ---- public ----\n    constructor(p){\n        //set up DOM\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: \"Drop to import\",\n            css: {\n                paddingTop: \"100px\",\n                position: \"fixed\",\n                left: \"0\",\n                top: \"0\",\n                width: \"100%\",\n                height: \"100%\",\n                background: \"rgba(50, 50, 50, 0.7)\",\n                color: \"#fff\",\n                textShadow: \"2px 2px #000\",\n                textAlign: \"center\",\n                fontSize: \"25px\"\n            }\n        });\n        const wrapperEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                \"marginTop\": \"50px\",\n                \"display\": \"flex\",\n                \"justifyContent\": \"center\"\n            }\n        });\n        const optionStyle = {\n            width: \"200px\",\n            padding: \"50px\",\n            margin: \"10px\",\n            //opacity: 0.5,\n            borderRadius: \"20px\",\n            border: \"1px dashed #fff\",\n            background: \"#00aefe\",\n            fontWeight: \"bold\"\n        };\n        const optionLayerEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: \"As Layer\",\n            css: optionStyle\n        });\n        const optionImageEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: \"As New Image\",\n            css: optionStyle\n        });\n        this.rootEl.append(wrapperEl);\n        wrapperEl.append(optionLayerEl, optionImageEl);\n        let rootCounter = 0;\n        let optionLayerCounter = 0;\n        let optionImageCounter = 0;\n        const destroy = ()=>{\n            rootCounter = 0;\n            optionLayerCounter = 0;\n            optionImageCounter = 0;\n            this.rootEl.remove();\n        };\n        /**\n         * check, can drop content be imported\n         */ const testAcceptType = (event)=>{\n            return !!event.dataTransfer && !event.dataTransfer.types.includes(\"text/plain\");\n        };\n        const updateOptions = ()=>{\n            const boxShadow = \"0 0 20px 4px #fff\";\n            if (optionLayerCounter > 0) {\n                optionLayerEl.style.boxShadow = boxShadow;\n                optionImageEl.style.boxShadow = \"\";\n            } else if (optionImageCounter > 0) {\n                optionLayerEl.style.boxShadow = \"\";\n                optionImageEl.style.boxShadow = boxShadow;\n            } else {\n                optionLayerEl.style.boxShadow = \"\";\n                optionImageEl.style.boxShadow = \"\";\n            }\n        };\n        optionLayerEl.addEventListener(\"dragenter\", ()=>{\n            optionLayerCounter++;\n            updateOptions();\n        });\n        optionLayerEl.addEventListener(\"dragleave\", ()=>{\n            optionLayerCounter--;\n            updateOptions();\n        });\n        optionImageEl.addEventListener(\"dragenter\", ()=>{\n            optionImageCounter++;\n            updateOptions();\n        });\n        optionImageEl.addEventListener(\"dragleave\", ()=>{\n            optionImageCounter--;\n            updateOptions();\n        });\n        const rootDragOver = (event)=>{\n            if (!testAcceptType(event)) return;\n            event.stopPropagation();\n            event.preventDefault();\n        };\n        const rootDragEnter = (event)=>{\n            if (!p.enabledTest() || !testAcceptType(event)) return;\n            if (rootCounter === 0) p.target.append(this.rootEl);\n            rootCounter++;\n        };\n        const rootDragLeave = (event)=>{\n            if (!testAcceptType(event) || rootCounter === 0) return;\n            rootCounter = Math.max(0, rootCounter - 1);\n            if (rootCounter === 0) this.rootEl.remove();\n        };\n        const rootDrop = (event)=>{\n            if (!testAcceptType(event) || !event.dataTransfer || event.dataTransfer.files.length === 0) {\n                destroy();\n                return;\n            }\n            event.stopPropagation();\n            event.preventDefault();\n            let optionStr = \"default\";\n            if (optionLayerCounter > 0) optionStr = \"layer\";\n            else if (optionImageCounter > 0) optionStr = \"image\";\n            p.onDrop(event.dataTransfer.files, optionStr);\n            if (rootCounter > 0) this.rootEl.remove();\n            rootCounter = 0;\n            optionLayerCounter = 0;\n            optionImageCounter = 0;\n            updateOptions();\n        };\n        window.addEventListener(\"dragover\", rootDragOver, false);\n        window.addEventListener(\"dragenter\", rootDragEnter, false);\n        window.addEventListener(\"dragleave\", rootDragLeave, false);\n        window.addEventListener(\"drop\", rootDrop, false);\n        // if something goes wrong and you're stuck with overlay\n        this.rootEl.addEventListener(\"pointerdown\", ()=>{\n            destroy();\n        });\n        const keyListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).KeyListener({\n            onDown: (keyStr)=>{\n                if (rootCounter > 0 && keyStr === \"esc\") destroy();\n            }\n        });\n    }\n}\n\n\n\n\n\n\nclass $b80d451cabaa19d2$export$9f0da9b942594e99 {\n    // ---- interface ----\n    getElement() {\n        return this.rootEl;\n    }\n    // ---- public ----\n    constructor(p){\n        const sizeObj = {\n            width: 150,\n            svHeight: 90,\n            hHeight: 20,\n            sliderHeight: 25\n        };\n        let isVisible = false;\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-overlay-toolspace\"\n        });\n        const queuedObj = {\n            color: null,\n            size: null,\n            opacity: null\n        };\n        // --- inputs ---\n        //color selection\n        const colorEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            className: \"kl-overlay-toolspace__color\"\n        });\n        const colorSlider = new (0, $8f768338795db7a0$export$66306bf21a9ff39e)({\n            width: sizeObj.width,\n            heightSV: sizeObj.svHeight,\n            heightH: sizeObj.hHeight,\n            color: p.brushSettingService.getColor(),\n            callback: (rgbObj)=>{\n                selectedColorEl.style.backgroundColor = \"rgb(\" + rgbObj.r + \",\" + rgbObj.g + \",\" + rgbObj.b + \")\";\n                p.brushSettingService.setColor(rgbObj, subscriptionFunc);\n            }\n        });\n        const selectedColorEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                width: sizeObj.width + \"px\",\n                height: sizeObj.hHeight + \"px\",\n                pointerEvents: \"none\"\n            }\n        });\n        {\n            const initialColor = p.brushSettingService.getColor();\n            selectedColorEl.style.backgroundColor = \"rgb(\" + initialColor.r + \",\" + initialColor.g + \",\" + initialColor.b + \")\";\n        }\n        colorEl.append(selectedColorEl, colorSlider.getElement());\n        const updateColor = (rgbObj)=>{\n            colorSlider.setColor(rgbObj);\n            selectedColorEl.style.backgroundColor = \"rgb(\" + rgbObj.r + \",\" + rgbObj.g + \",\" + rgbObj.b + \")\";\n        };\n        //brushsize slider\n        const sizeSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-size\"),\n            width: sizeObj.width,\n            height: sizeObj.sliderHeight,\n            min: 0,\n            max: 500,\n            value: 50,\n            resolution: 225,\n            eventResMs: 1000 / 30,\n            toDisplayValue: (val)=>val * 2,\n            toValue: (displayValue)=>displayValue / 2,\n            onChange: (v)=>{\n                p.brushSettingService.setSize(v);\n            },\n            formatFunc: (displayValue)=>{\n                if (displayValue < 10) return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).round(displayValue, 1);\n                else return Math.round(displayValue);\n            }\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(sizeSlider.getElement(), {\n            marginTop: \"2px\"\n        });\n        const opacitySlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"opacity\"),\n            width: sizeObj.width,\n            height: sizeObj.sliderHeight,\n            min: 0,\n            max: 1,\n            value: 1,\n            resolution: 225,\n            eventResMs: 1000 / 30,\n            toDisplayValue: (val)=>val * 100,\n            toValue: (displayValue)=>displayValue / 100,\n            onChange: (v)=>{\n                p.brushSettingService.setOpacity(v);\n            }\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(opacitySlider.getElement(), {\n            margin: \"2px 0\"\n        });\n        this.rootEl.append(sizeSlider.getElement(), opacitySlider.getElement());\n        // --- general setup ---\n        const subscriptionFunc = (event)=>{\n            if (event.type === \"color\") {\n                if (!isVisible) queuedObj.color = event.value;\n                else updateColor(event.value);\n            }\n            if (event.type === \"size\") {\n                if (!isVisible) queuedObj.size = event.value;\n                else sizeSlider.setValue(event.value);\n            }\n            if (event.type === \"opacity\") {\n                if (!isVisible) queuedObj.opacity = event.value;\n                else opacitySlider.setValue(event.value);\n            }\n            if (event.type === \"sliderConfig\") {\n                sizeSlider.update(event.value.sizeSlider);\n                opacitySlider.update(event.value.opacitySlider);\n            }\n        };\n        p.brushSettingService.subscribe(subscriptionFunc);\n        {\n            const sliderConfig = p.brushSettingService.getSliderConfig();\n            sizeSlider.update(sliderConfig.sizeSlider);\n            opacitySlider.update(sliderConfig.opacitySlider);\n            sizeSlider.setValue(p.brushSettingService.getSize());\n            opacitySlider.setValue(p.brushSettingService.getOpacity());\n        }\n        const updateUI = ()=>{\n            // unfocus manual slider input\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).unfocusAnyInput();\n            this.rootEl.style.display = isVisible ? \"block\" : \"none\";\n            if (isVisible && mousePos) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.rootEl, {\n                left: mousePos.x - Math.round(sizeObj.width / 2) + \"px\",\n                top: mousePos.y - Math.round(sizeObj.svHeight + sizeObj.hHeight * 3 / 2) + \"px\"\n            });\n        };\n        let mousePos = null;\n        document.addEventListener(\"pointermove\", (event)=>{\n            mousePos = {\n                x: event.pageX,\n                y: event.pageY\n            };\n        });\n        const keyListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).KeyListener({\n            onDown: (keyStr, event, comboStr, isRepeat)=>{\n                if (isRepeat) return;\n                if (isVisible) {\n                    isVisible = false;\n                    updateUI();\n                    return;\n                }\n                if (!p.enabledTest() || !mousePos) return;\n                if ([\n                    \"ctrl+alt\",\n                    \"cmd+alt\",\n                    \"alt+ctrl\",\n                    \"alt+cmd\"\n                ].includes(comboStr)) {\n                    event.preventDefault();\n                    isVisible = true;\n                    if (queuedObj.color !== null) {\n                        updateColor(queuedObj.color);\n                        queuedObj.color = null;\n                    }\n                    if (queuedObj.size !== null) {\n                        sizeSlider.setValue(queuedObj.size);\n                        queuedObj.size = null;\n                    }\n                    if (queuedObj.opacity !== null) {\n                        opacitySlider.setValue(queuedObj.opacity);\n                        queuedObj.opacity = null;\n                    }\n                    updateUI();\n                }\n            },\n            onUp: (keyStr, event, oldComboStr)=>{\n                if ([\n                    \"ctrl+alt\",\n                    \"cmd+alt\",\n                    \"alt+ctrl\",\n                    \"alt+cmd\"\n                ].includes(oldComboStr) && isVisible) {\n                    isVisible = false;\n                    colorSlider.end();\n                    updateUI();\n                }\n            },\n            onBlur: ()=>{\n                if (isVisible) {\n                    isVisible = false;\n                    colorSlider.end();\n                    updateUI();\n                }\n            }\n        });\n    }\n}\n\n\n\nvar $3d723e4f59a76a82$exports = {};\n\n$3d723e4f59a76a82$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"klecks-logo.2dcce02e.png\";\n\n\nvar $731c195c2658f60e$exports = {};\n\n$731c195c2658f60e$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"new-image.2d692480.svg\";\n\n\nvar $080ff6c52dc9a16e$exports = {};\n\n$080ff6c52dc9a16e$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"import.7a68c844.svg\";\n\n\nvar $2612ca0d980e3a29$exports = {};\n\n$2612ca0d980e3a29$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"export.2deb9ff8.svg\";\n\n\nvar $942db5a6ac0c3c49$exports = {};\n\n$942db5a6ac0c3c49$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"share.454898d1.svg\";\n\n\nvar $2959e7daff7bd0dd$exports = {};\n\n$2959e7daff7bd0dd$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"help.208e9032.svg\";\n\n\n\nclass $50947f5db7d72ab3$export$665d2c76b1eb8459 {\n    getElement() {\n        return this.rootEl;\n    }\n    // ---- public ----\n    constructor(p){\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-toolspace-row\",\n            css: {\n                height: \"36px\",\n                display: \"flex\"\n            }\n        });\n        function createButton(p) {\n            const padding = 6 + (p.extraPadding ? p.extraPadding : 0);\n            const el = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                className: \"toolspace-row-button nohighlight\",\n                title: p.title,\n                onClick: p.onClick,\n                css: {\n                    padding: p.contain ? padding + \"px 0\" : \"\"\n                }\n            });\n            const im = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                className: p.darkInvert ? \"dark-invert\" : undefined,\n                css: {\n                    backgroundImage: \"url('\" + p.image + \"')\",\n                    backgroundRepeat: \"no-repeat\",\n                    backgroundPosition: \"center\",\n                    backgroundSize: p.contain ? \"contain\" : \"\",\n                    //filter: 'grayscale(1)',\n                    height: \"100%\"\n                }\n            });\n            im.style.pointerEvents = \"none\";\n            el.append(im);\n            const pointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n                target: el,\n                onEnterLeave: function(isOver) {\n                    el.classList.toggle(\"toolspace-row-button-hover\", isOver);\n                }\n            });\n            return {\n                el: el,\n                pointerListener: pointerListener\n            };\n        }\n        const logoButton = createButton({\n            onClick: p.onLogo,\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"home\"),\n            image: p.logoImg ? p.logoImg : (0, (/*@__PURE__*/$parcel$interopDefault($3d723e4f59a76a82$exports))),\n            contain: true,\n            darkInvert: true\n        });\n        logoButton.el.classList.add(\"kl-tool-row-border-right\");\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(logoButton.el, {\n            width: \"46px\"\n        });\n        const newButton = createButton({\n            onClick: p.onNew,\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-new\"),\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($731c195c2658f60e$exports))),\n            extraPadding: 1,\n            contain: true\n        });\n        const importButton = createButton({\n            onClick: p.onImport,\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-import\"),\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($080ff6c52dc9a16e$exports))),\n            extraPadding: 1,\n            contain: true\n        });\n        const saveButton = createButton({\n            onClick: p.onSave,\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-save\"),\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($2612ca0d980e3a29$exports))),\n            extraPadding: 1,\n            contain: true\n        });\n        let shareButton = null;\n        if ((0, $d9f9f4926aa80a1c$export$921068d8846a1559).canShareFiles()) shareButton = createButton({\n            onClick: p.onShare,\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-share\"),\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($942db5a6ac0c3c49$exports))),\n            contain: true,\n            darkInvert: true\n        });\n        const helpButton = createButton({\n            onClick: p.onHelp,\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"help\"),\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($2959e7daff7bd0dd$exports))),\n            contain: true,\n            darkInvert: true\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).append(this.rootEl, [\n            logoButton.el,\n            newButton.el,\n            importButton.el,\n            saveButton.el,\n            shareButton ? shareButton.el : undefined,\n            helpButton.el\n        ]);\n    }\n}\n\n\n\n\nvar $213fe7f980258b46$exports = {};\n\n$213fe7f980258b46$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"tool-paint.f73a8943.svg\";\n\n\nvar $b4e2f077fc10d34e$exports = {};\n\n$b4e2f077fc10d34e$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"tool-fill.3358320a.svg\";\n\n\nvar $7b6a173d3ec8bb59$exports = {};\n\n$7b6a173d3ec8bb59$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"tool-gradient.64486254.svg\";\n\n\nvar $fc02e0eba0126db4$exports = {};\n\n$fc02e0eba0126db4$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"tool-text.1cbd0325.svg\";\n\n\nvar $b210eded9e92d550$exports = {};\n\n$b210eded9e92d550$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"tool-shape.3de78c3f.svg\";\n\n\n\n\nclass $d199831ecec4fae4$export$a0a40f8a0b8fee15 {\n    updateButton() {\n        this.activeButton.title = this.titleArr[this.currentActiveIndex];\n        this.activeButtonIm.style.backgroundImage = \"url('\" + this.imArr[this.currentActiveIndex] + \"')\";\n    }\n    // ---- interface ----\n    setIsSmall(b) {\n        this.activeButton.style.padding = b ? this.smallMargin : \"10px 0\";\n        for(let i = 0; i < this.optionArr.length; i++)this.dropdownBtnArr[i].setIsSmall(b);\n        if (b) {\n            this.arrowButton.style.width = \"14px\";\n            this.arrowButton.style.height = \"14px\";\n        } else {\n            this.arrowButton.style.width = \"18px\";\n            this.arrowButton.style.height = \"18px\";\n        }\n    }\n    setActive(activeStr) {\n        if (this.optionArr.includes(activeStr)) {\n            this.isActive = true;\n            for(let i = 0; i < this.optionArr.length; i++)if (this.optionArr[i] === activeStr) {\n                this.currentActiveIndex = i;\n                break;\n            }\n            this.activeButton.classList.add(\"toolspace-row-button-activated\");\n            this.updateButton();\n        } else {\n            this.isActive = false;\n            this.activeButton.classList.remove(\"toolspace-row-button-activated\");\n        }\n    }\n    getActive() {\n        return this.optionArr[this.currentActiveIndex];\n    }\n    getElement() {\n        return this.rootEl;\n    }\n    // ---- public ----\n    constructor(p){\n        this.smallMargin = \"6px 0\";\n        this.optionArr = [\n            \"draw\",\n            \"fill\",\n            \"gradient\",\n            \"text\",\n            \"shape\"\n        ];\n        this.imArr = [\n            (0, (/*@__PURE__*/$parcel$interopDefault($213fe7f980258b46$exports))),\n            (0, (/*@__PURE__*/$parcel$interopDefault($b4e2f077fc10d34e$exports))),\n            (0, (/*@__PURE__*/$parcel$interopDefault($7b6a173d3ec8bb59$exports))),\n            (0, (/*@__PURE__*/$parcel$interopDefault($fc02e0eba0126db4$exports))),\n            (0, (/*@__PURE__*/$parcel$interopDefault($b210eded9e92d550$exports)))\n        ];\n        this.titleArr = [\n            `${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"tool-brush\")} [B]`,\n            `${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"tool-paint-bucket\")} [G]`,\n            `${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"tool-gradient\")} [G]`,\n            `${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"tool-text\")} [T]`,\n            `${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"tool-shape\")} [U]`\n        ];\n        this.currentActiveIndex = 0;\n        this.isActive = true;\n        let isOpen = false;\n        //preload images\n        setTimeout(()=>{\n            for(let i = 1; i < this.imArr.length; i++){\n                const im = new Image();\n                im.src = this.imArr[i];\n            }\n        }, 100);\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                position: \"relative\",\n                flexGrow: \"1\"\n            }\n        });\n        let openTimeout;\n        let isDragging = false;\n        let startX;\n        let startY;\n        let pointerListener;\n        if ((0, $d9f9f4926aa80a1c$export$921068d8846a1559).hasPointerEvents) pointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.rootEl,\n            onPointer: (event)=>{\n                if (event.type === \"pointerdown\") {\n                    if (isOpen) return;\n                    openTimeout = setTimeout(()=>{\n                        showDropdown();\n                    }, 400);\n                    isDragging = true;\n                    startX = event.pageX;\n                    startY = event.pageY;\n                } else if (event.type === \"pointermove\") {\n                    if (isDragging && !isOpen && (0, $d9f9f4926aa80a1c$export$921068d8846a1559).dist(startX, startY, event.pageX, event.pageY) > 5) {\n                        clearTimeout(openTimeout);\n                        showDropdown();\n                    }\n                } else if (event.type === \"pointerup\") {\n                    clearTimeout(openTimeout);\n                    if (isOpen && isDragging) {\n                        const target = document.elementFromPoint(event.pageX, event.pageY);\n                        for(let i = 0; i < this.dropdownBtnArr.length; i++)if (target === this.dropdownBtnArr[i].wrapper) {\n                            closeDropdown();\n                            this.isActive = true;\n                            this.currentActiveIndex = i;\n                            this.updateButton();\n                            p.onChange(this.optionArr[this.currentActiveIndex]);\n                            break;\n                        }\n                    }\n                    isDragging = false;\n                }\n            }\n        });\n        this.activeButton = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            className: \"toolspace-row-button nohighlight toolspace-row-button-activated\",\n            title: this.titleArr[this.currentActiveIndex],\n            onClick: (e)=>{\n                if (this.isActive && !isOpen) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    showDropdown();\n                    return;\n                }\n                this.isActive = true;\n                p.onChange(this.optionArr[this.currentActiveIndex]);\n                if (isOpen) closeDropdown();\n            },\n            css: {\n                padding: \"10px 0\",\n                pointerEvents: \"auto\",\n                height: \"100%\",\n                boxSizing: \"border-box\"\n            }\n        });\n        this.activeButtonIm = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.activeButton,\n            className: \"dark-invert\",\n            css: {\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"center\",\n                backgroundSize: \"contain\",\n                width: \"calc(100% - 7px)\",\n                height: \"100%\",\n                pointerEvents: \"none\",\n                opacity: \"0.75\"\n            }\n        });\n        this.arrowButton = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.activeButton,\n            className: \"dark-invert\",\n            css: {\n                position: \"absolute\",\n                right: \"1px\",\n                bottom: \"1px\",\n                width: \"18px\",\n                height: \"18px\",\n                //background: '#aaa',\n                //borderRadius: '2px',\n                cursor: \"pointer\",\n                backgroundImage: \"url('\" + (0, (/*@__PURE__*/$parcel$interopDefault($7a2d968e7fdd2ce9$exports))) + \"')\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"center\",\n                backgroundSize: \"60%\"\n            },\n            title: \"More Tools\",\n            onClick: (e)=>{\n                e.preventDefault();\n                e.stopPropagation();\n                showDropdown();\n            }\n        });\n        const overlay = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                position: \"absolute\",\n                //background: 'rgba(255,0,0,0.5)',\n                left: \"0\",\n                top: \"0\",\n                right: \"0\",\n                bottom: \"0\"\n            }\n        });\n        const overlayPointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: overlay,\n            onPointer: (e)=>{\n                if (e.type === \"pointerdown\") {\n                    e.eventPreventDefault();\n                    closeDropdown();\n                }\n            }\n        });\n        const dropdownWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"tool-dropdown-wrapper\",\n            css: {\n                position: \"absolute\",\n                width: \"100%\",\n                height: 100 * (this.optionArr.length - 1) + \"%\",\n                top: \"100%\",\n                left: \"0\",\n                zIndex: \"1\",\n                boxSizing: \"border-box\",\n                cursor: \"pointer\",\n                transition: \"height 0.1s ease-in-out, opacity 0.1s ease-in-out\",\n                borderBottomLeftRadius: \"5px\",\n                borderBottomRightRadius: \"5px\",\n                overflow: \"hidden\"\n            }\n        });\n        this.dropdownBtnArr = [];\n        const createDropdownButton = (p)=>{\n            const wrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                parent: dropdownWrapper,\n                className: \"tool-dropdown-button\",\n                title: p.title,\n                css: {\n                    padding: \"10px 0\",\n                    height: 100 / (this.optionArr.length - 1) + \"%\",\n                    boxSizing: \"border-box\"\n                },\n                onClick: (e)=>{\n                    e.preventDefault();\n                    e.stopPropagation();\n                    p.onClick(p.index);\n                }\n            });\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                parent: wrapper,\n                className: \"dark-invert\",\n                css: {\n                    backgroundImage: \"url('\" + p.image + \"')\",\n                    backgroundRepeat: \"no-repeat\",\n                    backgroundPosition: \"center\",\n                    backgroundSize: \"contain\",\n                    height: \"100%\",\n                    pointerEvents: \"none\",\n                    opacity: \"0.75\"\n                }\n            });\n            // --- interface ---\n            const show = (b)=>{\n                wrapper.style.display = b ? \"block\" : \"none\";\n            };\n            const setIsSmall = (b)=>{\n                wrapper.style.padding = b ? this.smallMargin : \"10px 0\";\n            };\n            return {\n                wrapper: wrapper,\n                show: show,\n                setIsSmall: setIsSmall\n            };\n        };\n        const onClickDropdownBtn = (index)=>{\n            closeDropdown();\n            this.isActive = true;\n            this.currentActiveIndex = index;\n            this.updateButton();\n            p.onChange(this.optionArr[this.currentActiveIndex]);\n        };\n        for(let i = 0; i < this.optionArr.length; i++)this.dropdownBtnArr.push(createDropdownButton({\n            index: i,\n            id: this.optionArr[i],\n            image: this.imArr[i],\n            title: this.titleArr[i],\n            onClick: onClickDropdownBtn\n        }));\n        const showDropdown = ()=>{\n            (0, $6b37b427615ca1fa$export$17eb8275e0c4cab8).increase(0.5);\n            isOpen = true;\n            for(let i = 0; i < this.optionArr.length; i++)this.dropdownBtnArr[i].show(this.currentActiveIndex !== i);\n            this.arrowButton.style.display = \"none\";\n            this.rootEl.style.zIndex = \"1\";\n            document.body.append(overlay);\n            this.rootEl.append(dropdownWrapper);\n        };\n        const closeDropdown = ()=>{\n            (0, $6b37b427615ca1fa$export$17eb8275e0c4cab8).decrease(0.5);\n            isOpen = false;\n            this.arrowButton.style.removeProperty(\"display\");\n            this.rootEl.style.removeProperty(\"z-index\");\n            overlay.remove();\n            dropdownWrapper.remove();\n        };\n        this.updateButton();\n    }\n}\n\n\n\n\n\n\n\nvar $b91422aab73859a6$exports = {};\n\n$b91422aab73859a6$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"tool-undo.540bf765.svg\";\n\n\n\nclass $79297c17befec587$export$c744a22bef9e0b97 {\n    // ---- interface ----\n    getElement() {\n        return this.rootEl;\n    }\n    setIsSmall(b) {\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.rootEl, {\n            height: b ? \"36px\" : \"54px\"\n        });\n        this.toolDropdown.setIsSmall(b);\n        this.handButton.setIsSmall(b);\n        this.zoomInButton.setIsSmall(b);\n        this.zoomOutButton.setIsSmall(b);\n        this.undoButton.setIsSmall(b);\n        this.redoButton.setIsSmall(b);\n        if (b) {\n            this.zoomInNOutButton.el.style.display = \"none\";\n            this.undoNRedoButton.el.style.display = \"none\";\n            this.zoomInButton.el.style.display = \"block\";\n            this.zoomOutButton.el.style.display = \"block\";\n            this.undoButton.el.style.display = \"block\";\n            this.redoButton.el.style.display = \"block\";\n        } else {\n            this.zoomInNOutButton.el.style.display = \"block\";\n            this.undoNRedoButton.el.style.display = \"block\";\n            this.zoomInButton.el.style.display = \"none\";\n            this.zoomOutButton.el.style.display = \"none\";\n            this.undoButton.el.style.display = \"none\";\n            this.redoButton.el.style.display = \"none\";\n        }\n    }\n    setEnableZoomIn(b) {\n        this.zoomInButton.el.classList.toggle(\"toolspace-row-button-disabled\", !b);\n        this.zoomInNOutButton.setIsEnabledLeft(b);\n    }\n    setEnableZoomOut(b) {\n        this.zoomOutButton.el.classList.toggle(\"toolspace-row-button-disabled\", !b);\n        this.zoomInNOutButton.setIsEnabledRight(b);\n    }\n    setEnableUndo(b) {\n        this.undoButton.el.classList.toggle(\"toolspace-row-button-disabled\", !b);\n        this.undoNRedoButton.setIsEnabledLeft(b);\n    }\n    setEnableRedo(b) {\n        this.redoButton.el.classList.toggle(\"toolspace-row-button-disabled\", !b);\n        this.undoNRedoButton.setIsEnabledRight(b);\n    }\n    setActive(activeStr, doEmit) {\n        if (this.currentActiveStr === activeStr) return;\n        this.currentActiveStr = activeStr;\n        this.toolDropdown.setActive(this.currentActiveStr);\n        this.handButton.el.classList.toggle(\"toolspace-row-button-activated\", this.currentActiveStr === \"hand\");\n        if (doEmit) this.onActivate(this.currentActiveStr);\n    }\n    getActive() {\n        return this.currentActiveStr;\n    }\n    // ---- public ----\n    constructor(p){\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-toolspace-row\",\n            css: {\n                height: \"54px\",\n                display: \"flex\"\n            }\n        });\n        this.onActivate = p.onActivate;\n        this.currentActiveStr = \"draw\"; // 'draw' | 'hand' | 'fill'\n        const createButton = (p)=>{\n            const smallMargin = p.doLighten ? \"6px 0\" : \"8px 0\";\n            const el = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                className: \"toolspace-row-button nohighlight\",\n                //title: p.title,\n                onClick: p.onClick,\n                css: {\n                    padding: p.contain ? \"10px 0\" : \"\"\n                }\n            });\n            const im = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                className: \"dark-invert\",\n                css: {\n                    backgroundImage: \"url('\" + p.image + \"')\",\n                    backgroundRepeat: \"no-repeat\",\n                    backgroundPosition: \"center\",\n                    backgroundSize: p.contain ? \"contain\" : \"\",\n                    //filter: 'grayscale(1)',\n                    height: \"100%\",\n                    transform: p.doMirror ? \"scale(-1, 1)\" : \"\",\n                    pointerEvents: \"none\",\n                    opacity: p.doLighten ? \"0.75\" : \"1\"\n                }\n            });\n            el.append(im);\n            const pointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n                target: el,\n                onEnterLeave: (isOver)=>{\n                    el.classList.toggle(\"toolspace-row-button-hover\", isOver);\n                }\n            });\n            const setIsSmall = (b)=>{\n                el.style.padding = p.contain ? b ? smallMargin : \"10px 0\" : \"\";\n            };\n            return {\n                el: el,\n                pointerListener: pointerListener,\n                setIsSmall: setIsSmall\n            };\n        };\n        const createTriangleButton = (p)=>{\n            const result = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                css: {\n                    flexGrow: \"1\",\n                    position: \"relative\"\n                }\n            });\n            const svg = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n                elementType: \"svg\",\n                width: \"67px\",\n                height: \"54px\",\n                viewBox: \"0 0 100 100\",\n                preserveAspectRatio: \"none\"\n            });\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(svg, {\n                position: \"absolute\",\n                left: \"0\",\n                top: \"0\"\n            });\n            const blurRadius = 10;\n            const blurOffsetX = 2;\n            const blurOffsetY = 2;\n            const defs = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n                elementType: \"defs\",\n                childrenArr: [\n                    {\n                        elementType: \"filter\",\n                        id: \"innershadow\",\n                        x0: \"-50%\",\n                        y0: \"-50%\",\n                        width: \"200%\",\n                        height: \"200%\",\n                        childrenArr: [\n                            {\n                                elementType: \"feGaussianBlur\",\n                                in: \"SourceAlpha\",\n                                stdDeviation: \"\" + blurRadius,\n                                result: \"blur\"\n                            },\n                            {\n                                elementType: \"feOffset\",\n                                dx: \"\" + blurOffsetX,\n                                dy: \"\" + blurOffsetY\n                            },\n                            {\n                                elementType: \"feComposite\",\n                                in2: \"SourceAlpha\",\n                                operator: \"arithmetic\",\n                                k2: \"-1\",\n                                k3: \"1\",\n                                result: \"shadowDiff\"\n                            },\n                            {\n                                elementType: \"feFlood\",\n                                \"flood-color\": \"#000\",\n                                \"flood-opacity\": \"0.2\"\n                            },\n                            {\n                                elementType: \"feComposite\",\n                                in2: \"shadowDiff\",\n                                operator: \"in\"\n                            },\n                            {\n                                elementType: \"feComposite\",\n                                in2: \"SourceGraphic\",\n                                operator: \"over\",\n                                result: \"firstfilter\"\n                            },\n                            {\n                                elementType: \"feGaussianBlur\",\n                                in: \"firstfilter\",\n                                stdDeviation: \"\" + blurRadius,\n                                result: \"blur2\"\n                            },\n                            {\n                                elementType: \"feOffset\",\n                                dx: \"\" + blurOffsetX,\n                                dy: \"\" + blurOffsetY\n                            },\n                            {\n                                elementType: \"feComposite\",\n                                in2: \"firstfilter\",\n                                operator: \"arithmetic\",\n                                k2: \"-1\",\n                                k3: \"1\",\n                                result: \"shadowDiff\"\n                            },\n                            {\n                                elementType: \"feFlood\",\n                                \"flood-color\": \"#000\",\n                                \"flood-opacity\": \"0.2\"\n                            },\n                            {\n                                elementType: \"feComposite\",\n                                in2: \"shadowDiff\",\n                                operator: \"in\"\n                            },\n                            {\n                                elementType: \"feComposite\",\n                                in2: \"firstfilter\",\n                                operator: \"over\"\n                            }\n                        ]\n                    }\n                ]\n            });\n            const svgTriangleLeft = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n                elementType: \"path\",\n                \"vector-effect\": \"non-scaling-stroke\",\n                d: \"M0,0 L 100,0 0,100 z\",\n                fill: \"rgba(0,0,0,0)\",\n                class: \"toolspace-svg-triangle-button\"\n            });\n            svgTriangleLeft.onclick = ()=>{\n                p.onLeft();\n                svgTriangleLeft.classList.remove(\"toolspace-svg-triangle-button-hover\");\n            };\n            const svgTriangleRight = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n                elementType: \"path\",\n                \"vector-effect\": \"non-scaling-stroke\",\n                d: \"M100,100 L 100,0 0,100 z\",\n                fill: \"rgba(0,0,0,0)\",\n                class: \"toolspace-svg-triangle-button\"\n            });\n            svgTriangleRight.onclick = ()=>{\n                p.onRight();\n                svgTriangleRight.classList.remove(\"toolspace-svg-triangle-button-hover\");\n            };\n            // because :hover causes problems w touch\n            const leftPointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n                target: svgTriangleLeft,\n                onEnterLeave: (isOver)=>{\n                    svgTriangleLeft.classList.toggle(\"toolspace-svg-triangle-button-hover\", isOver);\n                }\n            });\n            const rightPointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n                target: svgTriangleRight,\n                onEnterLeave: (isOver)=>{\n                    svgTriangleRight.classList.toggle(\"toolspace-svg-triangle-button-hover\", isOver);\n                }\n            });\n            svg.append(defs, svgTriangleLeft, svgTriangleRight);\n            result.append(svg);\n            const leftIm = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                parent: result,\n                className: \"dark-invert\",\n                css: {\n                    backgroundImage: \"url('\" + p.leftImage + \"')\",\n                    backgroundRepeat: \"no-repeat\",\n                    backgroundSize: \"contain\",\n                    width: \"20px\",\n                    height: \"20px\",\n                    position: \"absolute\",\n                    left: \"10px\",\n                    top: \"8px\",\n                    //transform: p.doMirror ? 'scale(-1, 1)' : '',\n                    pointerEvents: \"none\"\n                }\n            });\n            result.append(leftIm);\n            const rightIm = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                parent: result,\n                className: \"dark-invert\",\n                css: {\n                    backgroundImage: \"url('\" + (p.rightImage ? p.rightImage : p.leftImage) + \"')\",\n                    backgroundRepeat: \"no-repeat\",\n                    backgroundSize: \"contain\",\n                    width: \"20px\",\n                    height: \"20px\",\n                    position: \"absolute\",\n                    right: \"10px\",\n                    bottom: \"8px\",\n                    transform: p.rightImage ? \"\" : \"scale(-1, 1)\",\n                    pointerEvents: \"none\"\n                }\n            });\n            const setIsEnabledLeft = (b)=>{\n                svgTriangleLeft.classList.toggle(\"toolspace-row-button-disabled\", !b);\n                leftIm.classList.toggle(\"toolspace-row-button-disabled\", !b);\n            };\n            const setIsEnabledRight = (b)=>{\n                svgTriangleRight.classList.toggle(\"toolspace-row-button-disabled\", !b);\n                rightIm.classList.toggle(\"toolspace-row-button-disabled\", !b);\n            };\n            return {\n                el: result,\n                setIsEnabledLeft: setIsEnabledLeft,\n                setIsEnabledRight: setIsEnabledRight,\n                leftPointerListener: leftPointerListener,\n                rightPointerListener: rightPointerListener\n            };\n        };\n        this.toolDropdown = new (0, $d199831ecec4fae4$export$a0a40f8a0b8fee15)({\n            onChange: (activeStr)=>{\n                this.setActive(activeStr, true);\n            }\n        });\n        this.rootEl.append(this.toolDropdown.getElement());\n        this.handButton = createButton({\n            onClick: ()=>{\n                this.setActive(\"hand\", true);\n            },\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($acb9aa66d548f601$exports))),\n            contain: true,\n            doLighten: true\n        });\n        this.handButton.el.classList.add(\"kl-tool-row-border-right\");\n        this.handButton.el.title = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"tool-hand\");\n        this.rootEl.append(this.handButton.el);\n        this.zoomInNOutButton = createTriangleButton({\n            onLeft: p.onZoomIn,\n            onRight: p.onZoomOut,\n            leftImage: (0, (/*@__PURE__*/$parcel$interopDefault($28619fc623d210a6$exports))),\n            rightImage: (0, (/*@__PURE__*/$parcel$interopDefault($eb15d36c7e085410$exports)))\n        });\n        this.zoomInNOutButton.el.title = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"tool-zoom\");\n        this.rootEl.append(this.zoomInNOutButton.el);\n        this.zoomInButton = createButton({\n            onClick: p.onZoomIn,\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($28619fc623d210a6$exports))),\n            contain: true\n        });\n        this.zoomInButton.el.title = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"zoom-in\");\n        this.rootEl.append(this.zoomInButton.el);\n        this.zoomOutButton = createButton({\n            onClick: p.onZoomOut,\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($eb15d36c7e085410$exports))),\n            contain: true\n        });\n        this.zoomOutButton.el.title = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"zoom-out\");\n        this.rootEl.append(this.zoomOutButton.el);\n        this.undoNRedoButton = createTriangleButton({\n            onLeft: p.onUndo,\n            onRight: p.onRedo,\n            leftImage: (0, (/*@__PURE__*/$parcel$interopDefault($b91422aab73859a6$exports))),\n            rightImage: null\n        });\n        this.undoNRedoButton.el.title = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"undo\") + \"/\" + (0, $63d0b335c576c718$export$ce37e184d908d785)(\"redo\");\n        this.undoNRedoButton.setIsEnabledLeft(false);\n        this.undoNRedoButton.setIsEnabledRight(false);\n        this.rootEl.append(this.undoNRedoButton.el);\n        this.undoButton = createButton({\n            onClick: p.onUndo,\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($b91422aab73859a6$exports))),\n            contain: true\n        });\n        this.undoButton.el.title = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"undo\");\n        this.undoButton.el.classList.add(\"toolspace-row-button-disabled\");\n        this.rootEl.append(this.undoButton.el);\n        this.redoButton = createButton({\n            onClick: p.onRedo,\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($b91422aab73859a6$exports))),\n            contain: true,\n            doMirror: true\n        });\n        this.redoButton.el.title = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"redo\");\n        this.redoButton.el.classList.add(\"toolspace-row-button-disabled\");\n        this.rootEl.append(this.redoButton.el);\n        this.zoomInButton.el.style.display = \"none\";\n        this.zoomOutButton.el.style.display = \"none\";\n        this.undoButton.el.style.display = \"none\";\n        this.redoButton.el.style.display = \"none\";\n    }\n}\n\n\n\n\n\nclass $6ae4f2a30e17169a$export$8162a66cd18867a7 {\n    getElement() {\n        return this.rootEl;\n    }\n    // ---- public ----\n    constructor(p){\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"label\",\n            className: \"kl-stabilizer\",\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"stabilizer\") + \"&nbsp;\",\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"stabilizer-title\")\n        });\n        const strengthSelect = new (0, $b1ef42bd443626ca$export$ef9b1a59e592288f)({\n            optionArr: [\n                [\n                    \"0\",\n                    \"0\"\n                ],\n                [\n                    \"1\",\n                    \"1\"\n                ],\n                [\n                    \"2\",\n                    \"2\"\n                ],\n                [\n                    \"3\",\n                    \"3\"\n                ],\n                [\n                    \"4\",\n                    \"4\"\n                ],\n                [\n                    \"5\",\n                    \"5\"\n                ]\n            ],\n            initValue: \"\" + p.smoothing,\n            onChange: function(val) {\n                p.onSelect(parseInt(val));\n            }\n        });\n        this.rootEl.append(strengthSelect.getElement());\n        this.pointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.rootEl,\n            onWheel: function(e) {\n                strengthSelect.setDeltaValue(e.deltaY);\n            }\n        });\n    }\n}\n\n\n\nvar $21e002c0f7a05108$exports = {};\n\n$21e002c0f7a05108$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"inverted-border.3353c7f3.svg\";\n\n\nclass $ae064bc6cfaee2ee$export$3c6d17ed0106bfb9 {\n    // update\n    update() {\n        for(let i = 0; i < this.tabArr.length; i++)this.tabArr[i].update(this.activeTab);\n    }\n    // ---- interface ----\n    getElement() {\n        return this.rootEl;\n    }\n    open(tabId) {\n        for(let i = 0; i < this.tabArr.length; i++)if (this.tabArr[i].id === tabId) {\n            if (this.activeTab === this.tabArr[i]) return;\n            this.activeTab.onClose();\n            this.activeTab = this.tabArr[i];\n            this.activeTab.onOpen();\n            this.activeTab.el.append(this.roundRight, this.roundLeft);\n            this.update();\n            return;\n        }\n        throw \"TabRow.open - invalid tabId\";\n    }\n    getOpenedTabId() {\n        return \"\" + this.activeTab.id;\n    }\n    setIsVisible(tabId, isVisible) {\n        for(let i = 0; i < this.tabArr.length; i++)if (this.tabArr[i].id === tabId) {\n            this.tabArr[i].isVisible = isVisible;\n            this.update();\n            return;\n        }\n        throw \"TabRow.setIsVisible - invalid tabId\";\n    }\n    destroy() {\n        this.tabArr.forEach((item)=>{\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(item.el);\n            item.pointerListener.destroy();\n        });\n    }\n    // ---- public ----\n    constructor(p){\n        var _p_height;\n        const height = (_p_height = p.height) !== null && _p_height !== void 0 ? _p_height : 35;\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"tabrow\",\n            css: {\n                height: height + 1 + \"px\"\n            }\n        });\n        this.tabArr = []; //creates its own internal arr\n        const roundSize = 10;\n        this.roundRight = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                width: roundSize + \"px\",\n                height: roundSize + \"px\",\n                backgroundImage: `url('${(0, (/*@__PURE__*/$parcel$interopDefault($21e002c0f7a05108$exports)))}')`,\n                backgroundSize: \"cover\",\n                position: \"absolute\",\n                right: -roundSize + \"px\",\n                bottom: \"0\",\n                pointerEvents: \"none\"\n            }\n        });\n        this.roundLeft = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                width: roundSize + \"px\",\n                height: roundSize + \"px\",\n                backgroundImage: `url('${(0, (/*@__PURE__*/$parcel$interopDefault($21e002c0f7a05108$exports)))}')`,\n                backgroundSize: \"cover\",\n                position: \"absolute\",\n                left: -roundSize + \"px\",\n                bottom: \"0\",\n                transform: \"scale(-1,1)\",\n                pointerEvents: \"none\"\n            }\n        });\n        const createTab = (pTabObj, initialId, useAccent)=>{\n            const isVisible = \"isVisible\" in pTabObj && pTabObj.isVisible !== undefined ? pTabObj.isVisible : true;\n            const result = {\n                id: pTabObj.id,\n                isVisible: isVisible,\n                onOpen: pTabObj.onOpen,\n                onClose: pTabObj.onClose,\n                update: (openedTabObj)=>{\n                    result.el.className = openedTabObj === result ? useAccent ? \"tabrow__tab tabrow__tab--opened-accented\" : \"tabrow__tab tabrow__tab--opened\" : \"tabrow__tab\";\n                    result.el.style.display = result.isVisible ? \"block\" : \"none\";\n                },\n                el: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    parent: this.rootEl,\n                    content: \"label\" in pTabObj ? pTabObj.label : \"\",\n                    title: \"title\" in pTabObj ? pTabObj.title : undefined,\n                    className: initialId === pTabObj.id ? useAccent ? \"tabrow__tab tabrow__tab--opened-accented\" : \"tabrow__tab tabrow__tab--opened\" : \"tabrow__tab\",\n                    css: {\n                        lineHeight: height + \"px\",\n                        display: isVisible ? \"block\" : \"none\",\n                        zIndex: \"0\"\n                    },\n                    onClick: ()=>{\n                        if (this.activeTab === result) return;\n                        this.open(result.id);\n                    }\n                }),\n                pointerListener: {}\n            };\n            if (\"image\" in pTabObj) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                tagName: \"span\",\n                parent: result.el,\n                className: \"dark-invert\",\n                css: {\n                    backgroundImage: `url(\"${pTabObj.image}\")`,\n                    backgroundSize: \"contain\",\n                    backgroundPosition: \"center\",\n                    backgroundRepeat: \"no-repeat\",\n                    display: \"flex\",\n                    height: height - 7 + \"px\",\n                    justifyContent: \"center\",\n                    margin: \"4px auto\"\n                }\n            });\n            if (\"css\" in pTabObj && pTabObj.css !== undefined) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(result.el, pTabObj.css);\n            result.pointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n                target: result.el,\n                onEnterLeave: (isOver)=>{\n                    result.el.classList.toggle(\"tabrow__tab-hover\", isOver);\n                }\n            });\n            if (initialId === result.id) {\n                result.onOpen();\n                result.el.append(this.roundRight, this.roundLeft);\n            } else result.onClose();\n            return result;\n        };\n        let initTabObj = null;\n        for(let i = 0; i < p.tabArr.length; i++){\n            const tab = createTab(p.tabArr[i], p.initialId, p.useAccent || false);\n            if (tab.id === p.initialId) initTabObj = tab;\n            this.tabArr.push(tab);\n        }\n        if (!initTabObj) throw \"invalid initialId\";\n        this.activeTab = initTabObj;\n    }\n}\n\n\n\n\nvar $49efe074a761be4a$exports = {};\n\n$49efe074a761be4a$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"edit-rotate.fd0e572a.svg\";\n\n\n\nclass $d4c26c4eab3ed9b4$export$cf20160367bae46c {\n    updateUi() {\n        this.scaleEl.innerHTML = Math.round(this.scale * 100) + \"%\";\n        this.angleEl.innerHTML = Math.round(this.angleDeg) + \"\\xb0\";\n        this.angleIm.style.transform = \"rotate(\" + this.angleDeg + \"deg)\";\n        if (this.angleDeg % 90 === 0) this.angleIm.style.boxShadow = \"inset 0 0 0 1px rgba(255,255,255, 1), 0 0 0 1px rgba(0, 0, 0, 0.3)\";\n        else this.angleIm.style.boxShadow = \"\";\n    }\n    getElement() {\n        return this.rootEl;\n    }\n    setIsVisible(pIsVisible) {\n        this.isVisible = !!pIsVisible;\n        this.rootEl.style.display = this.isVisible ? \"block\" : \"none\";\n        if (this.isVisible) this.updateUi();\n    }\n    update(pScale, pAngleDeg) {\n        this.scale = pScale;\n        this.angleDeg = pAngleDeg;\n        if (this.isVisible) this.updateUi();\n    }\n    // ---- public ----\n    constructor(p){\n        this.isVisible = true;\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                margin: \"10px\"\n            }\n        });\n        this.scale = p.scale;\n        this.angleDeg = p.angleDeg;\n        this.onAngleChange = p.onAngleChange;\n        const row1 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                marginBottom: \"10px\",\n                display: \"flex\"\n            }\n        });\n        const row2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                display: \"flex\",\n                marginBottom: \"10px\"\n            }\n        });\n        const row3 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                display: \"flex\"\n            }\n        });\n        this.rootEl.append(row1, row2, row3);\n        this.scaleEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                width: \"55px\",\n                userSelect: \"none\"\n            }\n        });\n        row1.append(this.scaleEl);\n        this.angleIm = new Image();\n        this.angleIm.src = (0, (/*@__PURE__*/$parcel$interopDefault($ae5de6f4526dc7dd$exports)));\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.angleIm, {\n            verticalAlign: \"bottom\",\n            width: \"20px\",\n            height: \"20px\",\n            marginRight: \"5px\",\n            borderRadius: \"10px\",\n            background: \"rgba(0,0,0,0.2)\",\n            userSelect: \"none\"\n        });\n        row1.append(this.angleIm);\n        this.angleEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: row1,\n            css: {\n                userSelect: \"none\"\n            }\n        });\n        this.updateUi();\n        const resetButton = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"button\",\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"hand-reset\"),\n            onClick: p.onReset\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).makeUnfocusable(resetButton);\n        const fitButton = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"button\",\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"hand-fit\"),\n            css: {\n                marginLeft: \"10px\"\n            },\n            onClick: p.onFit\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).makeUnfocusable(fitButton);\n        row2.append(resetButton, fitButton);\n        const leftRotateButton = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"button\",\n            content: '<img height=\"20\" src=\"' + (0, (/*@__PURE__*/$parcel$interopDefault($49efe074a761be4a$exports))) + '\" alt=\"Rotate\" style=\"transform: scale(-1, 1)\"/>',\n            onClick: function() {\n                p.onAngleChange(-15, true);\n            }\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).makeUnfocusable(leftRotateButton);\n        const resetAngleButton = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"button\",\n            content: \"0\\xb0\",\n            css: {\n                marginLeft: \"10px\"\n            },\n            onClick: function() {\n                p.onAngleChange(0);\n            }\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).makeUnfocusable(resetAngleButton);\n        const rightRotateButton = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"button\",\n            content: '<img height=\"20\" src=\"' + (0, (/*@__PURE__*/$parcel$interopDefault($49efe074a761be4a$exports))) + '\" alt=\"Rotate\"/>',\n            css: {\n                marginLeft: \"10px\"\n            },\n            onClick: function() {\n                p.onAngleChange(15, true);\n            }\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).makeUnfocusable(rightRotateButton);\n        row3.append(leftRotateButton, resetAngleButton, rightRotateButton);\n    }\n}\n\n\n\n\n\n\n\nclass $274b5c24f0b5af79$export$1e63e3b0645421a2 {\n    getElement() {\n        return this.rootEl;\n    }\n    setIsVisible(pIsVisible) {\n        this.isVisible = !!pIsVisible;\n        this.rootEl.style.display = this.isVisible ? \"block\" : \"none\";\n        if (this.isVisible) this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\n    }\n    /**\n     * [0, 1]\n     */ getTolerance() {\n        return this.toleranceSlider.getValue();\n    }\n    getOpacity() {\n        return this.opacitySlider.getValue();\n    }\n    getSample() {\n        return this.modeSelect.getValue();\n    }\n    getGrow() {\n        return parseInt(this.growSelect.getValue(), 10);\n    }\n    getContiguous() {\n        return this.isContiguous;\n    }\n    getIsEraser() {\n        return this.eraserToggle.getValue();\n    }\n    // ---- public ----\n    constructor(p){\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                margin: \"10px\"\n            }\n        });\n        this.isVisible = true;\n        this.colorDiv = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            css: {\n                marginBottom: \"10px\"\n            }\n        });\n        this.colorSlider = p.colorSlider;\n        this.opacitySlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"opacity\"),\n            width: 250,\n            height: 30,\n            min: 0.01,\n            max: 1,\n            value: 1,\n            toValue: (displayValue)=>displayValue / 100,\n            toDisplayValue: (value)=>value * 100\n        });\n        this.rootEl.append(this.opacitySlider.getElement());\n        this.toleranceSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"bucket-tolerance\"),\n            width: 250,\n            height: 30,\n            min: 0,\n            max: 255,\n            value: 51,\n            toValue: (displayValue)=>displayValue * 2.55,\n            toDisplayValue: (value)=>value / 2.55\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.toleranceSlider.getElement(), {\n            marginTop: \"10px\"\n        });\n        this.rootEl.append(this.toleranceSlider.getElement());\n        const selectRow = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            css: {\n                display: \"flex\",\n                marginTop: \"10px\"\n            }\n        });\n        const modeWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"bucket-sample\") + \"&nbsp;\",\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"bucket-sample-title\"),\n            css: {\n                fontSize: \"15px\"\n            }\n        });\n        this.modeSelect = new (0, $b1ef42bd443626ca$export$ef9b1a59e592288f)({\n            optionArr: [\n                [\n                    \"all\",\n                    (0, $63d0b335c576c718$export$ce37e184d908d785)(\"bucket-sample-all\")\n                ],\n                [\n                    \"current\",\n                    (0, $63d0b335c576c718$export$ce37e184d908d785)(\"bucket-sample-active\")\n                ],\n                [\n                    \"above\",\n                    (0, $63d0b335c576c718$export$ce37e184d908d785)(\"bucket-sample-above\")\n                ]\n            ],\n            initValue: \"all\"\n        });\n        const modePointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.modeSelect.getElement(),\n            onWheel: (e)=>{\n                this.modeSelect.setDeltaValue(e.deltaY);\n            }\n        });\n        modeWrapper.append(this.modeSelect.getElement());\n        selectRow.append(modeWrapper);\n        const growWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"bucket-grow\") + \"&nbsp;\",\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"bucket-grow-title\"),\n            css: {\n                fontSize: \"15px\",\n                marginLeft: \"10px\"\n            }\n        });\n        this.growSelect = new (0, $b1ef42bd443626ca$export$ef9b1a59e592288f)({\n            optionArr: [\n                [\n                    \"0\",\n                    \"0\"\n                ],\n                [\n                    \"1\",\n                    \"1\"\n                ],\n                [\n                    \"2\",\n                    \"2\"\n                ],\n                [\n                    \"3\",\n                    \"3\"\n                ],\n                [\n                    \"4\",\n                    \"4\"\n                ],\n                [\n                    \"5\",\n                    \"5\"\n                ],\n                [\n                    \"6\",\n                    \"6\"\n                ],\n                [\n                    \"7\",\n                    \"7\"\n                ]\n            ],\n            initValue: \"0\"\n        });\n        const growPointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.growSelect.getElement(),\n            onWheel: (e)=>{\n                this.growSelect.setDeltaValue(e.deltaY);\n            }\n        });\n        growWrapper.append(this.growSelect.getElement());\n        selectRow.append(growWrapper);\n        this.isContiguous = true;\n        const contiguousToggle = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: true,\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"bucket-contiguous\"),\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"bucket-contiguous-title\"),\n            callback: (b)=>{\n                this.isContiguous = b;\n            },\n            css: {\n                paddingRight: \"5px\",\n                display: \"inline-block\",\n                width: \"50%\"\n            }\n        });\n        this.eraserToggle = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: false,\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"eraser\"),\n            css: {\n                paddingRight: \"5px\",\n                display: \"inline-block\",\n                width: \"50%\"\n            }\n        });\n        this.rootEl.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: [\n                contiguousToggle.getElement(),\n                this.eraserToggle.getElement()\n            ],\n            css: {\n                display: \"flex\",\n                marginTop: \"10px\"\n            }\n        }));\n    }\n}\n\n\n\n\nclass $a6bad5d4783f8133$export$32a22540e4b2f123 {\n    getElement() {\n        return this.rootEl;\n    }\n    setIsVisible(pIsVisible) {\n        this.isVisible = !!pIsVisible;\n        this.rootEl.style.display = this.isVisible ? \"block\" : \"none\";\n        if (this.isVisible) this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\n    }\n    // ---- public ----\n    constructor(p){\n        this.isVisible = true;\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                margin: \"10px\"\n            }\n        });\n        this.colorSlider = p.colorSlider;\n        this.colorDiv = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            css: {\n                marginBottom: \"10px\"\n            }\n        });\n        const hint = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"text-instruction\")\n        });\n    }\n}\n\n\n\n\n\n\n\nclass $f0a35036bcb542fb$export$a9387b1d4260d39c {\n    getElement() {\n        return this.rootEl;\n    }\n    setIsVisible(pIsVisible) {\n        this.isVisible = !!pIsVisible;\n        this.rootEl.style.display = this.isVisible ? \"block\" : \"none\";\n        if (this.isVisible) {\n            this.colorDiv.append(this.colorSlider.getElement());\n            this.colorDiv.append(this.colorSlider.getOutputElement());\n        //update();\n        }\n    }\n    getShape() {\n        return this.shape;\n    }\n    getMode() {\n        return this.mode;\n    }\n    getIsEraser() {\n        return this.eraserToggle.getValue();\n    }\n    getOpacity() {\n        return this.opacitySlider.getValue();\n    }\n    getLineWidth() {\n        return this.lineWidthSlider.getValue();\n    }\n    getIsOutwards() {\n        return this.outwardsToggle.getValue();\n    }\n    getIsFixed() {\n        return this.fixedToggle.getValue();\n    }\n    getIsSnap() {\n        return this.snapToggle.getValue();\n    }\n    getDoLockAlpha() {\n        return this.lockAlphaToggle.getValue();\n    }\n    // ---- public ----\n    constructor(p){\n        this.shape = \"rect\";\n        this.mode = \"stroke\";\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                margin: \"10px\"\n            }\n        });\n        this.isVisible = true;\n        this.colorDiv = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            css: {\n                marginBottom: \"10px\"\n            }\n        });\n        this.colorSlider = p.colorSlider;\n        const previewSize = 35;\n        const previewPadding = 8;\n        const rectStrokeSvgRect = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n            elementType: \"rect\",\n            x: \"\" + previewPadding,\n            width: \"\" + (previewSize - previewPadding * 2)\n        });\n        const rectStrokeSvg = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n            elementType: \"svg\",\n            width: \"\" + previewSize,\n            height: \"\" + previewSize\n        });\n        rectStrokeSvg.classList.add(\"dark-invert\");\n        rectStrokeSvg.append(rectStrokeSvgRect);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(rectStrokeSvg, {\n            display: \"block\"\n        });\n        const rectFilledSvgRect = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n            elementType: \"rect\",\n            x: \"\" + previewPadding,\n            width: \"\" + (previewSize - previewPadding * 2)\n        });\n        const rectFilledSvg = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n            elementType: \"svg\",\n            width: \"\" + previewSize,\n            height: \"\" + previewSize\n        });\n        rectFilledSvg.classList.add(\"dark-invert\");\n        rectFilledSvg.append(rectFilledSvgRect);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(rectFilledSvg, {\n            display: \"block\"\n        });\n        const ellipseStrokeSvgEllipse = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n            elementType: \"ellipse\",\n            cx: \"\" + previewSize / 2,\n            cy: \"\" + previewSize / 2,\n            rx: \"\" + (previewSize / 2 - previewPadding)\n        });\n        const ellipseStrokeSvg = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n            elementType: \"svg\",\n            width: \"\" + previewSize,\n            height: \"\" + previewSize\n        });\n        ellipseStrokeSvg.classList.add(\"dark-invert\");\n        ellipseStrokeSvg.append(ellipseStrokeSvgEllipse);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(ellipseStrokeSvg, {\n            display: \"block\"\n        });\n        const ellipseFilledSvgEllipse = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n            elementType: \"ellipse\",\n            cx: \"\" + previewSize / 2,\n            cy: \"\" + previewSize / 2,\n            rx: \"\" + (previewSize / 2 - previewPadding)\n        });\n        const ellipseFilledSvg = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n            elementType: \"svg\",\n            width: \"\" + previewSize,\n            height: \"\" + previewSize\n        });\n        ellipseFilledSvg.classList.add(\"dark-invert\");\n        ellipseFilledSvg.append(ellipseFilledSvgEllipse);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(ellipseFilledSvg, {\n            display: \"block\"\n        });\n        const lineSvgLine = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n            elementType: \"line\",\n            x1: \"\" + previewPadding,\n            x2: \"\" + (previewSize - previewPadding)\n        });\n        const lineSvg = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n            elementType: \"svg\",\n            width: \"\" + previewSize,\n            height: \"\" + previewSize\n        });\n        lineSvg.classList.add(\"dark-invert\");\n        lineSvg.append(lineSvgLine);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(lineSvg, {\n            display: \"block\"\n        });\n        const updatePreviews = ()=>{\n            const strokeWidth = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(Math.round(this.lineWidthSlider.getValue() / 10), 1, 10) + \"px\";\n            const squish = 1.35;\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(rectStrokeSvgRect, {\n                fill: \"none\",\n                stroke: \"black\",\n                strokeWidth: strokeWidth\n            });\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(rectFilledSvgRect, {\n                fill: \"black\",\n                stroke: \"none\"\n            });\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(ellipseStrokeSvgEllipse, {\n                fill: \"none\",\n                stroke: \"black\",\n                strokeWidth: strokeWidth\n            });\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(ellipseFilledSvgEllipse, {\n                fill: \"black\",\n                stroke: \"none\"\n            });\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(lineSvgLine, {\n                fill: \"none\",\n                stroke: \"black\",\n                strokeWidth: strokeWidth\n            });\n            if (this.fixedToggle.getValue()) {\n                rectStrokeSvgRect.setAttribute(\"y\", \"\" + previewPadding);\n                rectStrokeSvgRect.setAttribute(\"height\", \"\" + (previewSize - previewPadding * 2));\n                rectFilledSvgRect.setAttribute(\"y\", \"\" + previewPadding);\n                rectFilledSvgRect.setAttribute(\"height\", \"\" + (previewSize - previewPadding * 2));\n                ellipseStrokeSvgEllipse.setAttribute(\"ry\", \"\" + (previewSize / 2 - previewPadding));\n                ellipseFilledSvgEllipse.setAttribute(\"ry\", \"\" + (previewSize / 2 - previewPadding));\n            } else {\n                rectStrokeSvgRect.setAttribute(\"y\", \"\" + previewPadding * squish);\n                rectStrokeSvgRect.setAttribute(\"height\", \"\" + (previewSize - previewPadding * squish * 2));\n                rectFilledSvgRect.setAttribute(\"y\", \"\" + previewPadding * squish);\n                rectFilledSvgRect.setAttribute(\"height\", \"\" + (previewSize - previewPadding * squish * 2));\n                ellipseStrokeSvgEllipse.setAttribute(\"ry\", \"\" + (previewSize / 2 - previewPadding * squish));\n                ellipseFilledSvgEllipse.setAttribute(\"ry\", \"\" + (previewSize / 2 - previewPadding * squish));\n            }\n            if (this.snapToggle.getValue()) {\n                lineSvgLine.setAttribute(\"y1\", \"\" + (previewSize - previewPadding));\n                lineSvgLine.setAttribute(\"y2\", \"\" + previewPadding);\n            } else {\n                lineSvgLine.setAttribute(\"y1\", \"\" + (previewSize - previewPadding * squish));\n                lineSvgLine.setAttribute(\"y2\", \"\" + previewPadding * squish);\n            }\n        };\n        const row1 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            css: {\n                display: \"flex\",\n                justifyContent: \"space-between\",\n                alignItems: \"start\"\n            }\n        });\n        const shapeOptions = new (0, $1166276dc18d3ea9$export$c019608e5b5bb4cb)({\n            optionArr: [\n                {\n                    id: \"rect-stroke\",\n                    label: rectStrokeSvg,\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"shape-rect\") + \" \" + (0, $63d0b335c576c718$export$ce37e184d908d785)(\"shape-stroke\")\n                },\n                {\n                    id: \"ellipse-stroke\",\n                    label: ellipseStrokeSvg,\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"shape-ellipse\") + \" \" + (0, $63d0b335c576c718$export$ce37e184d908d785)(\"shape-stroke\")\n                },\n                {\n                    id: \"line\",\n                    label: lineSvg,\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"shape-line\")\n                },\n                {\n                    id: \"rect-fill\",\n                    label: rectFilledSvg,\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"shape-rect\") + \" \" + (0, $63d0b335c576c718$export$ce37e184d908d785)(\"shape-fill\")\n                },\n                {\n                    id: \"ellipse-fill\",\n                    label: ellipseFilledSvg,\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"shape-ellipse\") + \" \" + (0, $63d0b335c576c718$export$ce37e184d908d785)(\"shape-fill\")\n                }\n            ],\n            initId: this.shape + \" \" + this.mode,\n            onChange: (id)=>{\n                const split = id.split(\"-\");\n                this.shape = split[0];\n                this.mode = split[1];\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.fixedToggle.getElement(), {\n                    display: this.shape === \"line\" ? \"none\" : \"\"\n                });\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.snapToggle.getElement(), {\n                    display: this.shape === \"line\" ? \"\" : \"none\"\n                });\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.lineWidthSlider.getElement(), {\n                    display: this.shape !== \"line\" && this.mode === \"fill\" ? \"none\" : \"\"\n                });\n            },\n            changeOnInit: true\n        });\n        shapeOptions.getElement().style.width = \"120px\";\n        row1.append(shapeOptions.getElement());\n        this.eraserToggle = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: false,\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"eraser\"),\n            callback: ()=>{\n                updatePreviews();\n            }\n        });\n        this.lockAlphaToggle = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: false,\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"lock-alpha\"),\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"lock-alpha-title\"),\n            doHighlight: true\n        });\n        this.lockAlphaToggle.getElement().style.marginTop = \"10px\";\n        row1.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: [\n                this.eraserToggle.getElement(),\n                this.lockAlphaToggle.getElement()\n            ]\n        }));\n        this.lineWidthSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"shape-line-width\"),\n            width: 250,\n            height: 30,\n            min: 1,\n            max: 200,\n            value: 4,\n            curve: \"quadratic\",\n            onChange: ()=>{\n                updatePreviews();\n            }\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.lineWidthSlider.getElement(), {\n            marginTop: \"10px\"\n        });\n        this.rootEl.append(this.lineWidthSlider.getElement());\n        this.opacitySlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"opacity\"),\n            width: 250,\n            height: 30,\n            min: 0.01,\n            max: 1,\n            value: 1,\n            toValue: (displayValue)=>displayValue / 100,\n            toDisplayValue: (value)=>value * 100\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.opacitySlider.getElement(), {\n            marginTop: \"10px\"\n        });\n        this.rootEl.append(this.opacitySlider.getElement());\n        const row2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            css: {\n                display: \"flex\",\n                alignItems: \"center\",\n                marginTop: \"10px\"\n            }\n        });\n        this.outwardsToggle = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: false,\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"shape-outwards\"),\n            css: {\n                width: \"50%\",\n                marginRight: \"10px\"\n            }\n        });\n        row2.append(this.outwardsToggle.getElement());\n        this.fixedToggle = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: false,\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"shape-fixed\"),\n            callback: ()=>{\n                updatePreviews();\n            },\n            css: {\n                flexGrow: \"1\"\n            }\n        });\n        row2.append(this.fixedToggle.getElement());\n        this.snapToggle = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: false,\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"angle-snap\"),\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"angle-snap-title\"),\n            callback: ()=>{\n                updatePreviews();\n            },\n            css: {\n                flexGrow: \"1\"\n            }\n        });\n        row2.append(this.snapToggle.getElement());\n        updatePreviews();\n    }\n}\n\n\n\n\n\n\n\n\nfunction $1b372d80cb7a52ec$export$9852986a3ec5f6a0(data, cellProps) {\n    const result = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        tagName: \"table\",\n        className: \"kl-table\"\n    });\n    data.forEach((row, rowIndex)=>{\n        const rowEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"tr\"\n        });\n        rowEl.append(...row.map((el, colIndex)=>{\n            const cellEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                tagName: \"td\",\n                content: el\n            });\n            const key = rowIndex + \".\" + colIndex;\n            if (cellProps !== undefined && key in cellProps) cellEl.rowSpan = cellProps[key].rowspan;\n            return cellEl;\n        }));\n        result.append(rowEl);\n    });\n    return result;\n}\n\n\n\n\nfunction $d43dc22de82019e6$export$f77a89101d7d6586(p) {\n    const currentColor = p.currentColor;\n    const secondaryColor = p.secondaryColor;\n    const maxCanvasSize = p.maxCanvasSize;\n    const canvasWidth = p.canvasWidth;\n    const canvasHeight = p.canvasHeight;\n    const workspaceWidth = p.workspaceWidth;\n    const workspaceHeight = p.workspaceHeight;\n    const onConfirm = p.onConfirm;\n    const onCancel = p.onCancel;\n    function createRatioSize(ratioX, ratioY, width, height, padding) {\n        return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).fitInto(ratioX, ratioY, Math.min(maxCanvasSize, width - padding), Math.min(maxCanvasSize, height - padding), 1);\n    }\n    const newImDiv = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n    const widthInput = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        tagName: \"input\"\n    });\n    const unitStyle = {\n        color: \"#888\",\n        fontSize: \"12px\",\n        marginLeft: \"5px\"\n    };\n    const widthUnit = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        textContent: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"new-px\"),\n        css: unitStyle\n    });\n    const heightInput = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        tagName: \"input\"\n    });\n    const heightUnit = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        textContent: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"new-px\"),\n        css: unitStyle\n    });\n    widthInput.setAttribute(\"data-ignore-focus\", \"true\");\n    heightInput.setAttribute(\"data-ignore-focus\", \"true\");\n    widthInput.type = \"number\";\n    widthInput.min = \"1\";\n    widthInput.max = \"\" + maxCanvasSize;\n    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(widthInput, {\n        width: \"70px\"\n    });\n    heightInput.type = \"number\";\n    heightInput.min = \"1\";\n    heightInput.max = \"\" + maxCanvasSize;\n    heightInput.style.width = \"70px\";\n    widthInput.value = \"\" + canvasWidth;\n    heightInput.value = \"\" + canvasHeight;\n    widthInput.onclick = ()=>{\n        widthInput.focus();\n        updateRatio();\n    };\n    heightInput.onclick = ()=>{\n        heightInput.focus();\n        updateRatio();\n    };\n    const sizeTable = (0, $1b372d80cb7a52ec$export$9852986a3ec5f6a0)([\n        [\n            (0, $63d0b335c576c718$export$ce37e184d908d785)(\"width\") + \":&nbsp;\",\n            widthInput,\n            widthUnit\n        ],\n        [\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                css: {\n                    height: \"5px\"\n                }\n            }),\n            \"\",\n            \"\"\n        ],\n        [\n            (0, $63d0b335c576c718$export$ce37e184d908d785)(\"height\") + \":&nbsp;\",\n            heightInput,\n            heightUnit\n        ]\n    ]);\n    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(sizeTable, {\n        marginBottom: \"10px\"\n    });\n    const ratioWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        css: {\n            marginTop: \"5px\",\n            color: \"#888\"\n        }\n    });\n    const templateWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n    //BB.appendTextDiv(templateWrapper, \"Preset Resolutions: <br />\");\n    const presetFitBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        tagName: \"button\"\n    });\n    templateWrapper.style.marginBottom = \"10px\";\n    const presetCurrentBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        tagName: \"button\"\n    });\n    const presetSquareBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        tagName: \"button\"\n    });\n    const presetLandscapeBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        tagName: \"button\"\n    });\n    const presetPortraitBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        tagName: \"button\"\n    });\n    const presetOversizeBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        tagName: \"button\"\n    });\n    presetCurrentBtn.textContent = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"new-current\");\n    presetFitBtn.textContent = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"new-fit\");\n    presetOversizeBtn.textContent = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"new-oversize\");\n    presetLandscapeBtn.textContent = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"new-landscape\");\n    presetPortraitBtn.textContent = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"new-portrait\");\n    presetSquareBtn.textContent = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"new-square\");\n    presetCurrentBtn.style.marginRight = \"5px\";\n    presetFitBtn.style.marginRight = \"5px\";\n    presetOversizeBtn.style.marginRight = \"5px\";\n    presetLandscapeBtn.style.marginTop = \"5px\";\n    presetLandscapeBtn.style.marginRight = \"5px\";\n    presetPortraitBtn.style.marginTop = \"5px\";\n    presetPortraitBtn.style.marginRight = \"5px\";\n    templateWrapper.append(presetCurrentBtn, presetFitBtn, presetOversizeBtn, presetSquareBtn, presetLandscapeBtn, presetPortraitBtn);\n    const templatePadding = 0;\n    presetCurrentBtn.onclick = function() {\n        widthInput.value = \"\" + canvasWidth;\n        heightInput.value = \"\" + canvasHeight;\n        updateRatio();\n    };\n    presetFitBtn.onclick = function() {\n        widthInput.value = \"\" + workspaceWidth;\n        heightInput.value = \"\" + workspaceHeight;\n        updateRatio();\n    };\n    presetOversizeBtn.onclick = function() {\n        widthInput.value = \"\" + (workspaceWidth + 500);\n        heightInput.value = \"\" + (workspaceHeight + 500);\n        updateRatio();\n    };\n    presetSquareBtn.onclick = function() {\n        const sizeObj = createRatioSize(1, 1, workspaceWidth, workspaceHeight, templatePadding);\n        widthInput.value = \"\" + Math.round(sizeObj.width);\n        heightInput.value = \"\" + Math.round(sizeObj.height);\n        updateRatio();\n    };\n    presetLandscapeBtn.onclick = function() {\n        const sizeObj = createRatioSize(4, 3, workspaceWidth, workspaceHeight, templatePadding);\n        widthInput.value = \"\" + Math.round(sizeObj.width);\n        heightInput.value = \"\" + Math.round(sizeObj.height);\n        updateRatio();\n    };\n    presetPortraitBtn.onclick = function() {\n        const sizeObj = createRatioSize(3, 4, workspaceWidth, workspaceHeight, templatePadding);\n        widthInput.value = \"\" + Math.round(sizeObj.width);\n        heightInput.value = \"\" + Math.round(sizeObj.height);\n        updateRatio();\n    };\n    const select = new (0, $b1ef42bd443626ca$export$ef9b1a59e592288f)({\n        isFocusable: true,\n        optionArr: [\n            [\n                \"screen\",\n                (0, $63d0b335c576c718$export$ce37e184d908d785)(\"new-screen\")\n            ],\n            [\n                \"16 9\",\n                (0, $63d0b335c576c718$export$ce37e184d908d785)(\"new-video\") + \" 16:9\"\n            ],\n            [\n                \"3 2\",\n                \"3:2\"\n            ],\n            [\n                \"5 3\",\n                \"5:3\"\n            ],\n            [\n                \"2 1\",\n                \"2:1\"\n            ],\n            [\n                \"paper\",\n                (0, $63d0b335c576c718$export$ce37e184d908d785)(\"new-din-paper\") + \" \\u221A2:1\"\n            ],\n            [\n                \"9 16\",\n                \"9:16\"\n            ],\n            [\n                \"2 3\",\n                \"2:3\"\n            ],\n            [\n                \"3 5\",\n                \"3:5\"\n            ],\n            [\n                \"1 2\",\n                \"1:2\"\n            ],\n            [\n                \"1 1.4142135623730951\",\n                \"1:\\u221A2\"\n            ]\n        ],\n        onChange: function(val) {\n            if (val === \"screen\") {\n                widthInput.value = \"\" + window.screen.width;\n                heightInput.value = \"\" + window.screen.height;\n            } else if (val === \"paper\") {\n                const sizeObj = createRatioSize(Math.sqrt(2), 1, workspaceWidth, workspaceHeight, templatePadding);\n                widthInput.value = \"\" + Math.round(sizeObj.width);\n                heightInput.value = \"\" + Math.round(sizeObj.height);\n            } else {\n                const split = val.split(\" \");\n                const sizeObj = createRatioSize(parseFloat(split[0]), parseFloat(split[1]), workspaceWidth, workspaceHeight, templatePadding);\n                widthInput.value = \"\" + Math.round(sizeObj.width);\n                heightInput.value = \"\" + Math.round(sizeObj.height);\n            }\n            updateRatio();\n            select.setValue(undefined);\n        }\n    });\n    setTimeout(()=>{\n        // safari: not empty without also setting it to null via timeout\n        select.setValue(undefined);\n    }, 0);\n    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(select.getElement(), {\n        width: \"80px\"\n    });\n    templateWrapper.append(select.getElement());\n    let backgroundRGBA = {\n        r: 255,\n        g: 255,\n        b: 255,\n        a: 1\n    };\n    const colorOptionsArr = [\n        {\n            r: 255,\n            g: 255,\n            b: 255,\n            a: 1\n        },\n        {\n            r: 0,\n            g: 0,\n            b: 0,\n            a: 1\n        },\n        {\n            r: 0,\n            g: 0,\n            b: 0,\n            a: 0\n        },\n        {\n            r: currentColor.r,\n            g: currentColor.g,\n            b: currentColor.b,\n            a: 1\n        },\n        {\n            r: secondaryColor.r,\n            g: secondaryColor.g,\n            b: secondaryColor.b,\n            a: 1\n        }\n    ];\n    let initColorIndex = 0;\n    if ((0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark()) colorOptionsArr.forEach((item, index)=>{\n        if (item.r === (0, $7a2aeb795d64bafc$export$e4203cb02d5e5b28) && item.g === (0, $7a2aeb795d64bafc$export$e4203cb02d5e5b28) && item.b === (0, $7a2aeb795d64bafc$export$e4203cb02d5e5b28)) {\n            initColorIndex = index;\n            backgroundRGBA = item;\n        }\n    });\n    const colorOptions = new (0, $3032e23fa8f3a9e5$export$24ba9b81662d4366)({\n        colorArr: colorOptionsArr,\n        initialIndex: initColorIndex,\n        onChange: function(rgbaObj) {\n            backgroundRGBA = rgbaObj;\n            preview.style.backgroundColor = \"rgba(\" + rgbaObj.r + \",\" + rgbaObj.g + \",\" + rgbaObj.b + \", \" + rgbaObj.a + \")\";\n        }\n    });\n    const previewWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        className: \"kl-transparent-preview\",\n        css: {\n            boxSizing: \"border-box\",\n            width: \"340px\",\n            height: \"140px\",\n            display: \"table\",\n            padding: \"10px\",\n            marginTop: \"10px\",\n            marginLeft: \"-20px\"\n        }\n    });\n    const preview = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        className: \"kl-transparent-preview__canvas\",\n        css: {\n            width: \"200px\",\n            height: \"100px\",\n            backgroundColor: \"rgba(\" + backgroundRGBA.r + \",\" + backgroundRGBA.g + \",\" + backgroundRGBA.b + \", \" + backgroundRGBA.a + \")\",\n            marginLeft: \"auto\",\n            marginRight: \"auto\",\n            color: \"#aaa\",\n            fontSize: \"16px\",\n            fontWeight: \"bold\",\n            textAlign: \"center\",\n            verticalAlign: \"center\",\n            display: \"table\",\n            overflow: \"hidden\"\n        }\n    });\n    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        parent: previewWrapper,\n        content: preview,\n        css: {\n            display: \"table-cell\",\n            verticalAlign: \"middle\"\n        }\n    });\n    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        parent: preview,\n        css: {\n            display: \"table-cell\",\n            verticalAlign: \"middle\"\n        }\n    });\n    function updateRatio() {\n        widthInput.value = \"\" + Math.min(maxCanvasSize, parseInt(widthInput.value));\n        heightInput.value = \"\" + Math.min(maxCanvasSize, parseInt(heightInput.value));\n        function hcf(u, v) {\n            let U = u, V = v;\n            // eslint-disable-next-line no-constant-condition\n            while(true){\n                if (!(U %= V)) return V;\n                if (!(V %= U)) return U;\n            }\n        }\n        let w = parseInt(widthInput.value);\n        let h = parseInt(heightInput.value);\n        if (w < 1 || w > maxCanvasSize || h < 1 || h > maxCanvasSize) {\n            if (w > maxCanvasSize) w = maxCanvasSize;\n            else if (h > maxCanvasSize) h = maxCanvasSize;\n            widthInput.value = \"\" + w;\n            heightInput.value = \"\" + h;\n        }\n        //generated canvas size doesn't always match ratio. so check if a common ratio is very close\n        const commonRatios = [\n            [\n                1,\n                2\n            ],\n            [\n                2,\n                1\n            ],\n            [\n                2,\n                3\n            ],\n            [\n                3,\n                2\n            ],\n            [\n                3,\n                4\n            ],\n            [\n                4,\n                3\n            ],\n            [\n                4,\n                5\n            ],\n            [\n                5,\n                4\n            ],\n            [\n                16,\n                9\n            ],\n            [\n                9,\n                16\n            ],\n            [\n                3,\n                2\n            ],\n            [\n                2,\n                3\n            ],\n            [\n                5,\n                3\n            ],\n            [\n                3,\n                5\n            ],\n            [\n                2,\n                1\n            ],\n            [\n                1,\n                2\n            ],\n            [\n                1.414,\n                1\n            ],\n            [\n                1,\n                1.414\n            ]\n        ];\n        const reducedArr = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).reduce(w, h);\n        let closestRatio = commonRatios[0];\n        let closestDistance = Math.abs(commonRatios[0][0] / commonRatios[0][1] - reducedArr[0] / reducedArr[1]);\n        for(let i = 0; i < commonRatios.length; i++)if (Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]) < closestDistance) {\n            closestRatio = commonRatios[i];\n            closestDistance = Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]);\n        }\n        //display ratio\n        if (closestDistance > 0 && closestDistance < 0.005) ratioWrapper.innerText = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"new-ratio\") + \": ~\" + closestRatio[0] + \":\" + closestRatio[1];\n        else ratioWrapper.innerText = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"new-ratio\") + \": \" + reducedArr[0] + \":\" + reducedArr[1];\n        const realw = w;\n        const T = hcf(w, h);\n        w /= T;\n        h /= T;\n        w *= 260;\n        h *= 260;\n        if (w > 260) {\n            h = 260 / w * h;\n            w = 260;\n        }\n        if (h > 100) {\n            w = 100 / h * w;\n            h = 100;\n        }\n        preview.style.width = w + \"px\";\n        preview.style.height = h + \"px\";\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createCheckerDataUrl(parseInt(\"\" + 30 * (w / realw)), function(url) {\n            previewWrapper.style.background = \"url(\" + url + \")\";\n        }, (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark());\n    }\n    (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).addIsDarkListener(updateRatio);\n    widthInput.onchange = ()=>{\n        if (widthInput.value === \"\" || parseInt(widthInput.value) < 0) widthInput.value = \"1\";\n        updateRatio();\n    };\n    widthInput.onkeyup = ()=>{\n        updateRatio();\n    };\n    heightInput.onchange = ()=>{\n        if (heightInput.value === \"\" || parseFloat(heightInput.value) < 0) heightInput.value = \"1\";\n        updateRatio();\n    };\n    heightInput.onkeyup = ()=>{\n        updateRatio();\n    };\n    updateRatio();\n    newImDiv.append(templateWrapper);\n    const secondRow = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        parent: newImDiv,\n        css: {\n            display: \"flex\",\n            justifyContent: \"space-between\",\n            alignItems: \"flex-end\"\n        }\n    });\n    const secondRowLeft = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        parent: secondRow\n    });\n    secondRowLeft.append(sizeTable, ratioWrapper);\n    secondRow.append(colorOptions.getElement());\n    newImDiv.append(previewWrapper);\n    (0, $2016c314bff36ab9$export$d7e8d4d4450c819c)({\n        target: document.body,\n        message: `<b>${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"new-title\")}</b>`,\n        div: newImDiv,\n        buttons: [\n            \"Ok\",\n            \"Cancel\"\n        ],\n        callback: function(result) {\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).unsetEventHandler(widthInput, \"onclick\", \"onchange\", \"onkeyup\");\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).unsetEventHandler(widthInput, \"onclick\", \"onchange\", \"onkeyup\");\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).unsetEventHandler(presetCurrentBtn, \"onclick\");\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).unsetEventHandler(presetFitBtn, \"onclick\");\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).unsetEventHandler(presetOversizeBtn, \"onclick\");\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).unsetEventHandler(presetSquareBtn, \"onclick\");\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).unsetEventHandler(presetLandscapeBtn, \"onclick\");\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).unsetEventHandler(presetPortraitBtn, \"onclick\");\n            select.destroy();\n            colorOptions.destroy();\n            (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).removeIsDarkListener(updateRatio);\n            if (result === \"Cancel\" || parseInt(widthInput.value) <= 0 || parseInt(heightInput.value) <= 0 || isNaN(parseInt(widthInput.value)) || isNaN(parseInt(heightInput.value))) {\n                onCancel();\n                return;\n            }\n            onConfirm(parseInt(widthInput.value), parseInt(heightInput.value), backgroundRGBA);\n        },\n        clickOnEnter: \"Ok\"\n    });\n}\n\n\n\nvar $eb0faa9ee2fc3d88$exports = {};\n\n$eb0faa9ee2fc3d88$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"ui-collapse.2b5dfc6a.svg\";\n\n\n\nclass $dcbaf52c129d701b$export$5b91f641162972fc {\n    update() {\n        if (this.directionStr === \"left\") this.icon.style.transform = this.stateIsOpen ? \"rotate(180deg)\" : \"\";\n        else this.icon.style.transform = this.stateIsOpen ? \"\" : \"rotate(180deg)\";\n    }\n    // ---- interface ----\n    isOpen() {\n        return this.stateIsOpen;\n    }\n    setDirection(dirStr) {\n        this.directionStr = dirStr;\n        this.update();\n    }\n    getElement() {\n        return this.rootEl;\n    }\n    // ---- public ----\n    constructor(p){\n        this.stateIsOpen = true;\n        this.directionStr = \"right\";\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-toolspace-toggle\",\n            css: {\n                width: \"36px\",\n                height: \"36px\",\n                background: \"rgba(100, 100, 100, 0.9)\",\n                color: \"#fff\",\n                position: \"absolute\",\n                top: \"0\",\n                textAlign: \"center\",\n                lineHeight: \"36px\",\n                cursor: \"pointer\",\n                userSelect: \"none\",\n                padding: \"6px\",\n                boxSizing: \"border-box\"\n            },\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"toggle-show-tools\"),\n            onClick: (e)=>{\n                e.preventDefault();\n                this.stateIsOpen = !this.stateIsOpen;\n                this.update();\n                p.onChange();\n            }\n        });\n        this.icon = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            css: {\n                backgroundImage: `url(${(0, (/*@__PURE__*/$parcel$interopDefault($eb0faa9ee2fc3d88$exports)))})`,\n                width: \"100%\",\n                height: \"100%\",\n                backgroundSize: \"contain\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"center\",\n                userSelect: \"none\"\n            }\n        });\n        this.rootEl.oncontextmenu = ()=>{\n            return false;\n        };\n    }\n}\n\n\n\n\n\n\n\n\n\n\n\nclass $5b663384e3b198ee$export$5cdfb22682d2a5dd {\n    getElement() {\n        return this.rootEl;\n    }\n    getValues() {\n        const c = this.colorOptions.getValue();\n        if (c === null || (c === null || c === void 0 ? void 0 : c.a) === 0) return {\n            fill: undefined\n        };\n        const color = {\n            ...c,\n            a: this.opacitySlider.getValue()\n        };\n        return {\n            fill: {\n                color: color\n            }\n        };\n    }\n    destroy() {\n        this.colorOptions.destroy();\n        this.opacitySlider.destroy();\n    }\n    // ---- public ----\n    constructor(p){\n        const emit = ()=>{\n            p.onUpdate(this.getValues());\n        };\n        const colorOptionsArr = [\n            null,\n            p.fill ? {\n                ...p.fill.color,\n                a: 1\n            } : null,\n            {\n                ...p.primaryColor,\n                a: 1\n            },\n            {\n                ...p.secondaryColor,\n                a: 1\n            },\n            {\n                r: 0,\n                g: 0,\n                b: 0,\n                a: 1\n            },\n            {\n                r: 255,\n                g: 255,\n                b: 255,\n                a: 1\n            }\n        ];\n        this.colorOptions = new (0, $3032e23fa8f3a9e5$export$24ba9b81662d4366)({\n            colorArr: colorOptionsArr,\n            initialIndex: p.fill ? 1 : 0,\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"shape-fill\"),\n            onChange: (c)=>{\n                this.opacitySlider.getElement().style.display = c !== null ? \"\" : \"none\";\n                emit();\n            }\n        });\n        this.opacitySlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"opacity\"),\n            width: 150,\n            height: 30,\n            min: 0.01,\n            max: 1,\n            value: p.fill ? p.fill.color.a : 1,\n            resolution: 225,\n            eventResMs: 1000 / 30,\n            toValue: (displayValue)=>displayValue / 100,\n            toDisplayValue: (value)=>value * 100,\n            onChange: ()=>emit()\n        });\n        this.opacitySlider.getElement().style.display = p.fill ? \"\" : \"none\";\n        const svg = (0, $fc4403c8ee6a33dc$export$c54fe3b9ecaa84cf)({\n            elementType: \"svg\",\n            class: \"dark-invert\",\n            width: \"25px\",\n            height: \"25px\",\n            viewBox: \"0 0 30 30\",\n            childrenArr: [\n                {\n                    elementType: \"polyline\",\n                    points: \"0,0 30,0 30,8 19,8 19,30 11,30 11,8 0,8 0,0 1,0\",\n                    \"transform-origin\": \"15px 15px\",\n                    transform: \"scale(0.8)\",\n                    fill: \"#000c\"\n                }\n            ]\n        });\n        this.rootEl = (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\",flex,gap-10,items-center,flexWrap,minh-30\", [\n            svg,\n            this.colorOptions.getElement(),\n            this.opacitySlider.getElement()\n        ]);\n    }\n}\n\n\n\n\n\n\nvar $522d9ab1067712c4$exports = {};\n\n$522d9ab1067712c4$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"align-left.4876a845.svg\";\n\n\nvar $e49bc9b550fae0b8$exports = {};\n\n$e49bc9b550fae0b8$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"align-center.6f56d4bd.svg\";\n\n\nvar $cffa7645bde262ed$exports = {};\n\n$cffa7645bde262ed$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"align-right.1521d61c.svg\";\n\n\nvar $59cebb3a23fccb55$exports = {};\n\n$59cebb3a23fccb55$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"typo-italic.7ab32910.svg\";\n\n\nvar $b64406475c6f0850$exports = {};\n\n$b64406475c6f0850$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"typo-bold.5c790c89.svg\";\n\n\n\n\n\nvar $1363e91d0ff2319d$exports = {};\n\n$1363e91d0ff2319d$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"Caveat-Regular.2fe80bbd.woff2\";\n\n\nvar $2ae282efbf4a82b0$exports = {};\n\n$2ae282efbf4a82b0$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"ClimateCrisis-Regular-VariableFont_YEAR.3ad02523.woff2\";\n\n\nvar $1c6e8e1187fd527a$exports = {};\n\n$1c6e8e1187fd527a$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"CorrectionBrush.a69973aa.woff2\";\n\n\nvar $420d435aedfcbcaf$exports = {};\n\n$420d435aedfcbcaf$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"DancingScript-Regular.ef2fe647.woff2\";\n\n\nvar $7ecf019a8305bae0$exports = {};\n\n$7ecf019a8305bae0$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"Diabolik-Regular-VF.f4eeb79e.woff2\";\n\n\nvar $cd209a85e47d47d8$exports = {};\n\n$cd209a85e47d47d8$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"FreckleFace-Regular.05946539.woff2\";\n\n\nvar $99a6c57c852271ab$exports = {};\n\n$99a6c57c852271ab$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"Gloock-Regular.60f8f765.woff2\";\n\n\nvar $d5c2f2536a6b106c$exports = {};\n\n$d5c2f2536a6b106c$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"Pacha.08c8457a.woff2\";\n\n\nvar $e510888715a1a128$exports = {};\n\n$e510888715a1a128$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"GochiHand-Regular.c45792b0.woff2\";\n\n\nvar $707db6a2345e41f4$exports = {};\n\n$707db6a2345e41f4$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"PassionOne-Bold.9e08b0dc.woff2\";\n\n\nvar $28be07e609531d97$exports = {};\n\n$28be07e609531d97$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"PixeloidSans.bc292131.woff2\";\n\n\nvar $bc9d3745edcd36ae$exports = {};\n\n$bc9d3745edcd36ae$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"PlaypenSans-Thin.314b29a4.woff2\";\n\n\nvar $0f0fc84a91258816$exports = {};\n\n$0f0fc84a91258816$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"Quicksand-Light.1f0c44a2.woff2\";\n\n\nvar $ff342a99ee3ddda9$exports = {};\n\n$ff342a99ee3ddda9$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"Silkscreen-Regular.cef2b4cb.woff2\";\n\n\nvar $e21e0b9213031611$exports = {};\n\n$e21e0b9213031611$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"Tehroc-Regular.4540047b.woff2\";\n\n\nvar $87708897e681fd5f$exports = {};\n\n$87708897e681fd5f$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"YUNGA-Display.30c04a15.woff2\";\n\n\nconst $8e39776a1261b902$export$f45fbea8fe20ca8a = [\n    {\n        name: \"Caveat\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($1363e91d0ff2319d$exports)))\n    },\n    {\n        name: \"ClimateCrisis\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($2ae282efbf4a82b0$exports)))\n    },\n    {\n        name: \"CorrectionBrush\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($1c6e8e1187fd527a$exports)))\n    },\n    {\n        name: \"DancingScript\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($420d435aedfcbcaf$exports)))\n    },\n    {\n        name: \"Diabolik\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($7ecf019a8305bae0$exports)))\n    },\n    {\n        name: \"FreckleFace\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($cd209a85e47d47d8$exports)))\n    },\n    {\n        name: \"Gloock\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($99a6c57c852271ab$exports)))\n    },\n    {\n        name: \"GochiHand\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($e510888715a1a128$exports)))\n    },\n    {\n        name: \"Pacha\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($d5c2f2536a6b106c$exports)))\n    },\n    {\n        name: \"PassionOne\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($707db6a2345e41f4$exports)))\n    },\n    {\n        name: \"PixeloidSans\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($28be07e609531d97$exports)))\n    },\n    {\n        name: \"PlaypenSans\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($bc9d3745edcd36ae$exports)))\n    },\n    {\n        name: \"Quicksand\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($0f0fc84a91258816$exports)))\n    },\n    {\n        name: \"Silkscreen\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($ff342a99ee3ddda9$exports)))\n    },\n    {\n        name: \"Tehroc\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($e21e0b9213031611$exports)))\n    },\n    {\n        name: \"YUNGA\",\n        url: (0, (/*@__PURE__*/$parcel$interopDefault($87708897e681fd5f$exports)))\n    }\n];\n\n\nconst $0d66a3ca6c18ec8d$var$importedFonts = [\n    {\n        fontFamily: \"sans-serif\",\n        fontName: \"Sans-serif\"\n    },\n    {\n        fontFamily: \"serif\",\n        fontName: \"Serif\"\n    },\n    {\n        fontFamily: \"monospace\",\n        fontName: \"Monospace\"\n    },\n    {\n        fontFamily: \"cursive\",\n        fontName: \"Cursive\"\n    },\n    {\n        fontFamily: \"fantasy\",\n        fontName: \"Fantasy\"\n    },\n    ...(0, $8e39776a1261b902$export$f45fbea8fe20ca8a).map((item)=>{\n        return {\n            fontFamily: item.name,\n            fontName: item.name\n        };\n    })\n];\nlet $0d66a3ca6c18ec8d$var$didLoadBundledFonts = false;\nasync function $0d66a3ca6c18ec8d$var$loadBundledFonts() {\n    if ($0d66a3ca6c18ec8d$var$didLoadBundledFonts) return;\n    $0d66a3ca6c18ec8d$var$didLoadBundledFonts = true;\n    const promises = [];\n    for(let i = 0; i < (0, $8e39776a1261b902$export$f45fbea8fe20ca8a).length; i++)promises.push((async ()=>{\n        const item = (0, $8e39776a1261b902$export$f45fbea8fe20ca8a)[i];\n        const response = await fetch(item.url);\n        const buffer = await response.arrayBuffer();\n        const font = new FontFace(item.name, buffer);\n        document.fonts.add(font);\n    })());\n    await Promise.all(promises);\n}\nclass $0d66a3ca6c18ec8d$export$2e7faedafda1fc85 {\n    // only load fonts when interacting with the font input\n    loadBundledFonts() {\n        !$0d66a3ca6c18ec8d$var$didLoadBundledFonts && $0d66a3ca6c18ec8d$var$loadBundledFonts().then(()=>{\n            this.onUpdate({\n                font: this.fontSelect.getValue()\n            });\n        });\n    }\n    importFont() {\n        const input = document.createElement(\"input\");\n        input.type = \"file\";\n        input.multiple = true;\n        input.accept = \".ttf, .otf, .woff, .woff2, .eot\";\n        input.focus();\n        input.click();\n        input.onchange = async ()=>{\n            if (!input.files || input.files.length === 0) return;\n            let toSelect = undefined;\n            const fontFamilies = $0d66a3ca6c18ec8d$var$importedFonts.map((i)=>i.fontFamily);\n            for(let i = 0; i < input.files.length; i++){\n                const file = input.files[i];\n                const fontName = \"kl-\" + $0d66a3ca6c18ec8d$var$importedFonts.length;\n                if (fontFamilies.includes(fontName)) continue;\n                if (!toSelect) {\n                    toSelect = fontName;\n                    this.importButton.disabled = true;\n                    this.importButton.innerText = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"loading\");\n                }\n                const split = file.name.split(\".\");\n                split.pop();\n                $0d66a3ca6c18ec8d$var$importedFonts.push({\n                    fontFamily: fontName,\n                    fontName: split.join(\".\")\n                });\n                const font = new FontFace(fontName, await file.arrayBuffer());\n                document.fonts.add(font);\n            }\n            // update font selection\n            setTimeout(()=>{\n                this.fontSelect.setOptionArr($0d66a3ca6c18ec8d$var$importedFonts.map((i)=>{\n                    return [\n                        i.fontFamily,\n                        i.fontName,\n                        {\n                            css: {\n                                fontFamily: i.fontFamily,\n                                fontSize: \"1.2em\"\n                            }\n                        }\n                    ];\n                }));\n                this.fontSelect.setValue(toSelect);\n                this.onUpdate({\n                    font: toSelect\n                });\n                this.importButton.disabled = false;\n                this.importButton.innerText = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-import\");\n            });\n        };\n    }\n    getElement() {\n        return this.rootEl;\n    }\n    getValues() {\n        return {\n            font: this.fontSelect.getValue(),\n            size: +this.sizeInput.getValue(),\n            letterSpacing: +this.letterSpacingInput.getValue(),\n            lineHeight: +this.lineHeightInput.getValue(),\n            align: this.alignRadioList.getValue(),\n            isItalic: this.italicToggle.getValue(),\n            isBold: this.boldToggle.getValue()\n        };\n    }\n    destroy() {\n        this.fontPointerListener.destroy();\n        this.fontSelect.getElement().removeEventListener(\"focus\", this.onFocus);\n        this.fontSelect.destroy();\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(this.importButton);\n        this.sizeInput.destroy();\n        this.lineHeightInput.destroy();\n        this.letterSpacingInput.destroy();\n        this.alignRadioList.destroy();\n        this.italicToggle.destroy();\n        this.boldToggle.destroy();\n    }\n    // ---- public ----\n    constructor(p){\n        this.onUpdate = p.onUpdate;\n        this.fontSelect = new (0, $b1ef42bd443626ca$export$ef9b1a59e592288f)({\n            initValue: p.font,\n            optionArr: $0d66a3ca6c18ec8d$var$importedFonts.map((i)=>{\n                return [\n                    i.fontFamily,\n                    i.fontName,\n                    {\n                        css: {\n                            fontFamily: i.fontFamily,\n                            fontSize: \"1.2em\"\n                        }\n                    }\n                ];\n            }),\n            isFocusable: true,\n            css: {\n                width: \"180px\"\n            },\n            onChange: (v)=>{\n                this.loadBundledFonts();\n                p.onUpdate({\n                    font: v\n                });\n            }\n        });\n        this.onFocus = ()=>this.loadBundledFonts();\n        this.fontSelect.getElement().addEventListener(\"focus\", this.onFocus);\n        this.fontPointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.fontSelect.getElement(),\n            onWheel: (e)=>this.fontSelect.setDeltaValue(e.deltaY)\n        });\n        this.importButton = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"button\",\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-import\"),\n            onClick: ()=>{\n                this.importFont();\n            }\n        });\n        const sizeLabel = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: '<div><span style=\"font-size: 0.6em; margin-right: -1px\">A</span>A</div>',\n            css: {\n                width: \"25px\",\n                height: \"25px\",\n                display: \"flex\",\n                justifyContent: \"center\",\n                alignItems: \"center\",\n                fontSize: \"1.2em\",\n                userSelect: \"none\"\n            }\n        });\n        this.sizeInput = new (0, $760dd90d44275661$export$f5b8910cec6cf069)({\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"text-size\"),\n            type: \"number\",\n            min: 0,\n            max: 1000,\n            init: p.size,\n            onChange: (v)=>{\n                p.onUpdate({\n                    size: parseFloat(v)\n                });\n            },\n            doResetIfInvalid: true,\n            doScrollWithoutFocus: true,\n            css: {\n                width: \"70px\"\n            }\n        });\n        var _p_lineHeight;\n        this.lineHeightInput = new (0, $760dd90d44275661$export$f5b8910cec6cf069)({\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"text-line-height\"),\n            type: \"number\",\n            min: 0,\n            max: 10,\n            step: 0.1,\n            init: (_p_lineHeight = p.lineHeight) !== null && _p_lineHeight !== void 0 ? _p_lineHeight : 1,\n            onChange: (v)=>{\n                p.onUpdate({\n                    lineHeight: parseFloat(v)\n                });\n            },\n            doResetIfInvalid: true,\n            doScrollWithoutFocus: true,\n            css: {\n                width: \"60px\"\n            }\n        });\n        var _p_letterSpacing;\n        this.letterSpacingInput = new (0, $760dd90d44275661$export$f5b8910cec6cf069)({\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"text-letter-spacing\"),\n            type: \"number\",\n            min: -100,\n            max: 100,\n            init: (_p_letterSpacing = p.letterSpacing) !== null && _p_letterSpacing !== void 0 ? _p_letterSpacing : 0,\n            onChange: (v)=>{\n                p.onUpdate({\n                    letterSpacing: parseFloat(v)\n                });\n            },\n            doResetIfInvalid: true,\n            doScrollWithoutFocus: true,\n            css: {\n                width: \"60px\"\n            }\n        });\n        this.alignRadioList = new (0, $fa6faa989b2cc6b2$export$7cc1012a658e6ad8)({\n            optionArr: [\n                {\n                    id: \"left\",\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"text-left\"),\n                    image: (0, (/*@__PURE__*/$parcel$interopDefault($522d9ab1067712c4$exports))),\n                    darkInvert: true\n                },\n                {\n                    id: \"center\",\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"text-center\"),\n                    image: (0, (/*@__PURE__*/$parcel$interopDefault($e49bc9b550fae0b8$exports))),\n                    darkInvert: true\n                },\n                {\n                    id: \"right\",\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"text-right\"),\n                    image: (0, (/*@__PURE__*/$parcel$interopDefault($cffa7645bde262ed$exports))),\n                    darkInvert: true\n                }\n            ],\n            initId: p.align,\n            onChange: (v)=>p.onUpdate({\n                    align: v\n                })\n        });\n        this.italicToggle = new (0, $a14a8e8cf8cc5885$export$b6d053cded550773)({\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($59cebb3a23fccb55$exports))),\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"text-italic\"),\n            initValue: p.isItalic,\n            onChange: (v)=>p.onUpdate({\n                    isItalic: v\n                }),\n            darkInvert: true\n        });\n        this.boldToggle = new (0, $a14a8e8cf8cc5885$export$b6d053cded550773)({\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($b64406475c6f0850$exports))),\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"text-bold\"),\n            initValue: p.isBold,\n            onChange: (v)=>p.onUpdate({\n                    isBold: v\n                }),\n            darkInvert: true\n        });\n        this.rootEl = (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\",flex,flexWrap,gap-10-15,items-center\", [\n            (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\",flex,gap-5,items-center\", [\n                sizeLabel,\n                this.sizeInput.getElement()\n            ]),\n            (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\",flex,gap-5\", [\n                this.fontSelect.getElement(),\n                this.importButton\n            ]),\n            (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\",flex,gap-7\", [\n                this.alignRadioList.getElement(),\n                this.italicToggle.getElement(),\n                this.boldToggle.getElement()\n            ]),\n            this.letterSpacingInput.getElement(),\n            this.lineHeightInput.getElement()\n        ]);\n    }\n}\n\n\n\n\n\n\n\n\nclass $c73fdb6c21e3a26a$export$42bb0e3b48d549f6 {\n    getElement() {\n        return this.rootEl;\n    }\n    getValues() {\n        const c = this.colorOptions.getValue();\n        if (c === null || (c === null || c === void 0 ? void 0 : c.a) === 0) return {\n            stroke: undefined\n        };\n        const color = {\n            ...c,\n            a: this.opacitySlider.getValue()\n        };\n        return {\n            stroke: {\n                color: color,\n                lineWidth: this.lineWidthSlider.getValue()\n            }\n        };\n    }\n    destroy() {\n        this.colorOptions.destroy();\n        this.opacitySlider.destroy();\n        this.lineWidthSlider.destroy();\n    }\n    // ---- public ----\n    constructor(p){\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                boxShadow: \"0 0 0 1px #aaa\"\n            }\n        });\n        const emit = ()=>{\n            p.onUpdate(this.getValues());\n        };\n        const colorOptionsArr = [\n            null,\n            p.stroke ? {\n                ...p.stroke.color,\n                a: 1\n            } : null,\n            {\n                ...p.secondaryColor,\n                a: 1\n            },\n            {\n                ...p.primaryColor,\n                a: 1\n            },\n            {\n                r: 255,\n                g: 255,\n                b: 255,\n                a: 1\n            },\n            {\n                r: 0,\n                g: 0,\n                b: 0,\n                a: 1\n            }\n        ];\n        this.colorOptions = new (0, $3032e23fa8f3a9e5$export$24ba9b81662d4366)({\n            colorArr: colorOptionsArr,\n            initialIndex: p.stroke ? 1 : 0,\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"shape-stroke\"),\n            onChange: (c)=>{\n                this.opacitySlider.getElement().style.display = c !== null ? \"\" : \"none\";\n                this.lineWidthSlider.getElement().style.display = c !== null ? \"\" : \"none\";\n                emit();\n            }\n        });\n        this.opacitySlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"opacity\"),\n            width: 150,\n            height: 30,\n            min: 0.01,\n            max: 1,\n            value: p.stroke ? p.stroke.color.a : 1,\n            resolution: 225,\n            eventResMs: 1000 / 30,\n            toValue: (displayValue)=>displayValue / 100,\n            toDisplayValue: (value)=>value * 100,\n            onChange: ()=>emit()\n        });\n        this.lineWidthSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"shape-line-width\"),\n            width: 150,\n            height: 30,\n            min: 0.5,\n            max: 100,\n            value: p.stroke ? p.stroke.lineWidth : 2,\n            eventResMs: 1000 / 30,\n            curve: \"quadratic\",\n            onChange: ()=>emit()\n        });\n        this.opacitySlider.getElement().style.display = p.stroke ? \"\" : \"none\";\n        this.lineWidthSlider.getElement().style.display = p.stroke ? \"\" : \"none\";\n        const svg = (0, $fc4403c8ee6a33dc$export$c54fe3b9ecaa84cf)({\n            elementType: \"svg\",\n            class: \"dark-invert\",\n            width: \"25px\",\n            height: \"25px\",\n            viewBox: \"0 0 30 30\",\n            childrenArr: [\n                {\n                    elementType: \"polyline\",\n                    points: \"0,0 30,0 30,8 19,8 19,30 11,30 11,8 0,8 0,0 1,0\",\n                    fill: \"none\",\n                    stroke: \"#000c\",\n                    \"stroke-width\": \"3\",\n                    \"transform-origin\": \"15px 15px\",\n                    transform: \"scale(0.8)\"\n                }\n            ]\n        });\n        this.rootEl = (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\",flex,gap-10,items-center,flexWrap,minh-30\", [\n            svg,\n            this.colorOptions.getElement(),\n            this.opacitySlider.getElement(),\n            this.lineWidthSlider.getElement()\n        ]);\n    }\n}\n\n\n\n\n\nclass $be275a032c52a6ed$export$c6656360602b35c2 {\n    emit() {\n        const text = this.textInput.value;\n        if (text === this.lastEmittedText) return;\n        this.lastEmittedText = text;\n        this.onUpdate({\n            text: text\n        });\n    }\n    getElement() {\n        return this.rootEl;\n    }\n    getValues() {\n        return {\n            text: this.textInput.value\n        };\n    }\n    focus() {\n        this.textInput.focus();\n    }\n    destroy() {\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(this.textInput);\n        this.textInput.removeEventListener(\"input\", this.onInput);\n    }\n    // ---- public ----\n    constructor(p){\n        this.onInput = ()=>{\n            this.emit();\n        };\n        this.lastEmittedText = p.text;\n        this.onUpdate = p.onUpdate;\n        this.rootEl = (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\"\");\n        this.textInput = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"textarea\",\n            parent: this.rootEl,\n            content: p.text,\n            custom: {\n                placeholder: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"text-placeholder\")\n            },\n            css: {\n                whiteSpace: \"pre\",\n                overflow: \"auto\",\n                width: \"100%\",\n                height: \"70px\",\n                resize: \"vertical\"\n            },\n            onChange: ()=>{\n                this.emit();\n            }\n        });\n        this.textInput.addEventListener(\"input\", this.onInput);\n    }\n}\n\n\n\n\n\n\n\n\n\n\n\nclass $4ada09c4693c46d4$export$1d311696e0fb2158 {\n    canZoom(d) {\n        return this.zoomFac !== Math.min(2, Math.max(-2, this.zoomFac + d));\n    }\n    changeZoomFac(d) {\n        this.zoomFac = Math.min(2, Math.max(-2, this.zoomFac + d));\n        this.render();\n        this.zoomInBtn.disabled = !this.canZoom(1);\n        this.zoomOutBtn.disabled = !this.canZoom(-1);\n    }\n    /** Move text by x y **/ move(x, y) {\n        const rotated = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotate(x, y, -this.rotationSlider.getValue() / Math.PI * 180);\n        this.text.x += rotated.x / this.scale;\n        this.text.y += rotated.y / this.scale;\n        this.render();\n    }\n    render() {\n        // try to draw very much like klCanvasWorkspace\n        const angleRad = this.rotationSlider.getValue();\n        // --- draw text ---\n        this.textCtx.clearRect(0, 0, this.textCanvas.width, this.textCanvas.height);\n        const bounds = (0, $67e715fe604c9329$export$482c90f94eb9717c)(this.textCanvas, {\n            ...this.text,\n            x: this.text.x,\n            y: this.text.y,\n            angleRad: this.rotationSlider.getValue()\n        });\n        // transform offset\n        const transformedOffset = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Vec2.mul((0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotate(this.offset.x, this.offset.y, -angleRad / Math.PI * 180), 1 / this.scale);\n        // --- determine transformation of viewport ---\n        // text should always be visible\n        bounds.width = Math.max(bounds.width, 1);\n        bounds.height = Math.max(bounds.height, 1);\n        const rotatedXY = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotate(bounds.x, bounds.y, -angleRad / Math.PI * 180);\n        const rotatedWH = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotate(bounds.width, bounds.height, -angleRad / Math.PI * 180);\n        const centerX = this.text.x + rotatedXY.x + rotatedWH.x / 2 + transformedOffset.x;\n        const centerY = this.text.y + rotatedXY.y + rotatedWH.y / 2 + transformedOffset.y;\n        const padding = 100;\n        const fitBounds = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).fitInto(bounds.width, bounds.height, this.width - padding, this.height - padding);\n        this.scale = Math.min(1, fitBounds.width / bounds.width);\n        this.scale = Math.min(4, this.scale * Math.pow(2, this.zoomFac));\n        // --- compose text and target layer ---\n        this.targetCtx.save();\n        if (this.scale >= 4) this.targetCtx.imageSmoothingEnabled = false;\n        else {\n            this.targetCtx.imageSmoothingEnabled = true;\n            this.targetCtx.imageSmoothingQuality = this.scale >= 1 ? \"low\" : \"medium\";\n        }\n        this.targetCtx.clearRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n        this.targetCtx.translate(this.width / 2, this.height / 2);\n        this.targetCtx.scale(this.scale, this.scale);\n        this.targetCtx.rotate(angleRad);\n        this.targetCtx.drawImage(this.layerArr[this.layerIndex].canvas, -centerX, -centerY);\n        this.targetCtx.drawImage(this.textCanvas, -centerX, -centerY);\n        this.targetCtx.restore();\n        const isDark = (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark();\n        // --- layers ---\n        this.layersCtx.save();\n        this.layersCtx.fillStyle = isDark ? \"rgb(33,33,33)\" : \"rgb(158,158,158)\";\n        this.layersCtx.fillRect(0, 0, this.width, this.height);\n        {\n            this.layersCtx.save();\n            this.layersCtx.translate(this.width / 2, this.height / 2);\n            this.layersCtx.scale(this.scale, this.scale);\n            this.layersCtx.rotate(angleRad);\n            this.layersCtx.imageSmoothingEnabled = false;\n            //outline\n            const borderSize = 1 / this.scale;\n            this.layersCtx.globalAlpha = isDark ? 0.25 : 0.2;\n            this.layersCtx.drawImage(isDark ? this.emptyCanvasLight : this.emptyCanvas, -centerX - borderSize, -centerY - borderSize, this.textCanvas.width + borderSize * 2, this.textCanvas.height + borderSize * 2);\n            this.layersCtx.globalAlpha = 1;\n            //erase\n            this.layersCtx.globalCompositeOperation = \"destination-out\";\n            this.layersCtx.drawImage(this.emptyCanvas, -centerX, -centerY, this.textCanvas.width, this.textCanvas.height);\n            this.layersCtx.restore();\n        }\n        if (this.scale >= 4) this.layersCtx.imageSmoothingEnabled = false;\n        else {\n            this.layersCtx.imageSmoothingEnabled = true;\n            this.layersCtx.imageSmoothingQuality = this.scale >= 1 ? \"low\" : \"medium\";\n        }\n        // layers below\n        this.layersCtx.save();\n        this.layersCtx.translate(this.width / 2, this.height / 2);\n        this.layersCtx.scale(this.scale, this.scale);\n        this.layersCtx.rotate(angleRad);\n        for(let i = 0; i < this.layerIndex; i++)if (this.layerArr[i].isVisible && this.layerArr[i].opacity > 0) {\n            this.layersCtx.globalAlpha = this.layerArr[i].opacity;\n            this.layersCtx.globalCompositeOperation = this.layerArr[i].mixModeStr;\n            this.layersCtx.drawImage(this.layerArr[i].canvas, -centerX, -centerY);\n        }\n        this.layersCtx.restore();\n        // target layer\n        this.layersCtx.globalAlpha = this.layerArr[this.layerIndex].opacity * (this.layerArr[this.layerIndex].isVisible ? 1 : 0);\n        this.layersCtx.globalCompositeOperation = this.layerArr[this.layerIndex].mixModeStr;\n        this.layersCtx.drawImage(this.targetCanvas, 0, 0);\n        // layers above\n        this.layersCtx.save();\n        this.layersCtx.translate(this.width / 2, this.height / 2);\n        this.layersCtx.scale(this.scale, this.scale);\n        this.layersCtx.rotate(angleRad);\n        for(let i = this.layerIndex + 1; i < this.layerArr.length; i++)if (this.layerArr[i].isVisible && this.layerArr[i].opacity > 0) {\n            this.layersCtx.globalAlpha = this.layerArr[i].opacity;\n            this.layersCtx.globalCompositeOperation = this.layerArr[i].mixModeStr;\n            this.layersCtx.drawImage(this.layerArr[i].canvas, -centerX, -centerY);\n        }\n        this.layersCtx.restore();\n        this.layersCtx.restore();\n        // --- final composite ---\n        this.previewCtx.save();\n        this.previewCtx.fillStyle = this.checkerPattern;\n        this.previewCtx.fillRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n        this.previewCtx.drawImage(this.layersCanvas, 0, 0);\n        this.previewCtx.restore();\n        // bounds\n        this.previewCtx.save();\n        this.previewCtx.globalCompositeOperation = \"difference\";\n        this.previewCtx.strokeStyle = \"#fff\";\n        this.previewCtx.lineWidth = 0.5;\n        this.previewCtx.translate(-this.offset.x, -this.offset.y);\n        this.previewCtx.strokeRect(Math.round(this.width / 2 - bounds.width / 2 * this.scale) + 0.5, Math.round(this.height / 2 - bounds.height / 2 * this.scale) + 0.5, Math.round(bounds.width * this.scale), Math.round(bounds.height * this.scale));\n        this.previewCtx.restore();\n    }\n    getElement() {\n        return this.rootEl;\n    }\n    getInputsElement() {\n        return this.inputsRootEl;\n    }\n    getValues() {\n        return {\n            x: this.text.x,\n            y: this.text.y,\n            angleRad: this.rotationSlider.getValue()\n        };\n    }\n    setText(text) {\n        const x = this.text.x;\n        const y = this.text.y;\n        const angleRad = this.text.angleRad;\n        this.text = {\n            ...text,\n            x: x,\n            y: y,\n            angleRad: angleRad\n        };\n        this.render();\n    }\n    setSize(width, height) {\n        if (width === this.width && height === this.height) return;\n        this.width = width;\n        this.height = height;\n        this.targetCanvas.width = this.width;\n        this.targetCanvas.height = this.height;\n        this.layersCanvas.width = this.width;\n        this.layersCanvas.height = this.height;\n        this.previewCanvas.width = this.width;\n        this.previewCanvas.height = this.height;\n        this.previewWrapper.style.width = this.width + \"px\";\n        this.render();\n    }\n    destroy() {\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(this.rootEl);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(this.inputsRootEl);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(this.previewWrapper);\n        clearInterval(this.interval);\n        this.rotationSlider.destroy();\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(this.zoomInBtn);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(this.zoomOutBtn);\n        this.eventCapture.remove();\n        this.previewPointerListener.destroy();\n        this.keyListener.destroy();\n        (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).removeIsDarkListener(this.onDarkChange);\n    }\n    // ---- public ----\n    constructor(p){\n        this.offset = {\n            x: 0,\n            y: 0\n        };\n        this.zoomFac = 0;\n        this.scale = 1;\n        this.layerArr = [];\n        this.onDarkChange = ()=>{\n            this.checkerPattern = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.previewCtx.createPattern((0, $d9f9f4926aa80a1c$export$921068d8846a1559).createCheckerCanvas(8, (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark()), \"repeat\"));\n            this.render();\n        };\n        this.rootEl = (0, $934e5f47c3374e21$export$db3b6bfb95261072)();\n        this.text = p.text;\n        this.layerIndex = p.layerIndex;\n        const isSmallWidth = window.innerWidth < 550;\n        const isSmallHeight = window.innerHeight < 630;\n        // --- preview ---\n        // Text drawn on klCanvas-sized canvas: textCanvas\n        // LayerArr[target].canvas & textCanvas then drawn on targetCanvas\n        //      they are transformed. canvas size of final preview\n        // All layers and targetCanvas drawn on layersCanvas. transformed and size of final preview\n        // Checkerboard, layersCanvas, and outline then drawn on previewCanvas\n        this.width = isSmallWidth ? 340 : 540;\n        this.height = isSmallWidth ? isSmallHeight ? 210 : 260 : isSmallHeight ? 230 : 350;\n        this.layerArr = p.klCanvas.getLayersFast();\n        this.textCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(p.klCanvas.getWidth(), p.klCanvas.getHeight());\n        this.textCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.textCanvas);\n        this.targetCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(this.width, this.height);\n        this.targetCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.targetCanvas);\n        this.layersCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(this.width, this.height);\n        this.layersCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.layersCanvas);\n        this.previewCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(this.width, this.height); // the one that is visible\n        this.previewCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.previewCanvas);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.previewCanvas, {\n            display: \"block\"\n        });\n        this.previewWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            css: {\n                position: \"relative\",\n                width: this.width + \"px\",\n                cursor: \"move\",\n                touchAction: \"none\"\n            }\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.previewWrapper,\n            className: \"kl-text-preview-wrapper\"\n        });\n        this.previewWrapper.append(this.previewCanvas);\n        this.checkerPattern = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.previewCtx.createPattern((0, $d9f9f4926aa80a1c$export$921068d8846a1559).createCheckerCanvas(8, (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark()), \"repeat\"));\n        this.emptyCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(1, 1);\n        this.emptyCanvasLight = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(1, 1);\n        {\n            let ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.emptyCanvas);\n            ctx.fillRect(0, 0, 1, 1);\n            ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.emptyCanvasLight);\n            ctx.fillStyle = \"#fff\";\n            ctx.fillRect(0, 0, 1, 1);\n        }\n        (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).addIsDarkListener(this.onDarkChange);\n        this.previewCanvas.oncontextmenu = (e)=>e.preventDefault();\n        let dragged = false;\n        let isDown = false;\n        let offsetDragged = false;\n        this.previewPointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.previewCanvas,\n            onPointer: (e)=>{\n                // drag detect\n                if (e.type === \"pointerdown\") {\n                    dragged = false;\n                    isDown = true;\n                }\n                if (e.type === \"pointermove\" && isDown) dragged = true;\n                if (e.type === \"pointerup\") {\n                    if (isDown && dragged && e.pointerType === \"mouse\") // With touch/pen it would be annoying to focus again,\n                    // because it probably pops out the keyboard.\n                    p.onDragEnd();\n                    dragged = false;\n                    isDown = false;\n                }\n                if (e.type === \"pointermove\" && e.button === \"left\") {\n                    e.eventPreventDefault();\n                    this.offset = {\n                        x: 0,\n                        y: 0\n                    };\n                    this.move(-e.dX, -e.dY);\n                }\n                if (e.type === \"pointerdown\" && e.button === \"right\") document.body.append(this.eventCapture);\n                if (e.type === \"pointerup\") setTimeout(()=>this.eventCapture.remove(), 20);\n                if (e.type === \"pointermove\" && e.button === \"right\") {\n                    offsetDragged = true;\n                    e.eventPreventDefault();\n                    this.offset.x -= e.dX;\n                    this.offset.y -= e.dY;\n                    this.render();\n                }\n                if (e.type === \"pointerup\" && offsetDragged) {\n                    let count = 0;\n                    this.interval = setInterval(()=>{\n                        if (count > 8) {\n                            clearInterval(this.interval);\n                            this.offset = {\n                                x: 0,\n                                y: 0\n                            };\n                            this.render();\n                        }\n                        this.offset = {\n                            x: this.offset.x * 0.6,\n                            y: this.offset.y * 0.6\n                        };\n                        this.render();\n                        count++;\n                    }, 10);\n                    this.offset = {\n                        x: this.offset.x * 0.6,\n                        y: this.offset.y * 0.6\n                    };\n                    this.render();\n                }\n            },\n            onWheel: (e)=>{\n                this.changeZoomFac(-e.deltaY);\n            }\n        });\n        const wheelPrevent = (event)=>event.preventDefault();\n        this.previewCanvas.addEventListener(\"wheel\", wheelPrevent);\n        this.rotationSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-transform-rotation\"),\n            width: 150,\n            height: 30,\n            min: -Math.PI,\n            max: Math.PI,\n            value: p.text.angleRad,\n            resolution: 225,\n            // eventResMs: 1000 / 30,\n            toValue: (deg)=>deg * Math.PI / 180,\n            toDisplayValue: (rad)=>rad / Math.PI * 180,\n            onChange: ()=>{\n                this.offset = {\n                    x: 0,\n                    y: 0\n                };\n                this.render();\n            },\n            unit: \"\\xb0\"\n        });\n        this.zoomInBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"button\",\n            content: `<img height=\"20\" src=\"${(0, (/*@__PURE__*/$parcel$interopDefault($28619fc623d210a6$exports)))}\">`,\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"zoom-in\"),\n            onClick: ()=>this.changeZoomFac(1),\n            css: {\n                fontWeight: \"bold\"\n            }\n        });\n        this.zoomOutBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"button\",\n            content: `<img height=\"20\" src=\"${(0, (/*@__PURE__*/$parcel$interopDefault($eb15d36c7e085410$exports)))}\">`,\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"zoom-out\"),\n            onClick: ()=>this.changeZoomFac(-1),\n            css: {\n                fontWeight: \"bold\"\n            }\n        });\n        this.eventCapture = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                position: \"absolute\",\n                left: \"0\",\n                top: \"0\",\n                right: \"0\",\n                bottom: \"0\",\n                zIndex: \"999\",\n                cursor: \"move\"\n            }\n        });\n        this.eventCapture.oncontextmenu = (e)=>e.preventDefault();\n        this.keyListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).KeyListener({\n            onDown: (keyStr)=>{\n                if ((0, $d9f9f4926aa80a1c$export$921068d8846a1559).isInputFocused(true)) return;\n                const factor = this.keyListener.isPressed(\"shift\") ? 4 : 1;\n                if (keyStr === \"left\") this.move(-factor, 0);\n                if (keyStr === \"right\") this.move(factor, 0);\n                if (keyStr === \"up\") this.move(0, -factor);\n                if (keyStr === \"down\") this.move(0, factor);\n            }\n        });\n        this.inputsRootEl = (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\",flex,gap-5\", [\n            this.rotationSlider.getElement(),\n            (0, $934e5f47c3374e21$export$db3b6bfb95261072)(),\n            this.zoomInBtn,\n            this.zoomOutBtn\n        ]);\n    }\n}\n\n\nvar $d9aa3b7905088459$export$e114d13b1a258938;\n$d9aa3b7905088459$export$e114d13b1a258938 = `_5vlQAW_viewportWrapper`;\n\n\n\n\n\nfunction $3217004ef102ca9c$export$e263e067d6140649(p) {\n    const rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({});\n    let text = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(p.text);\n    const viewportWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        className: $d9aa3b7905088459$export$e114d13b1a258938\n    });\n    const viewportUI = new (0, $4ada09c4693c46d4$export$1d311696e0fb2158)({\n        text: text,\n        klCanvas: p.klCanvas,\n        layerIndex: p.layerIndex,\n        onDragEnd: ()=>tabs.getOpenedTabId() === \"text\" ? textUI.focus() : 0\n    });\n    viewportUI.render();\n    function onUpdate(p) {\n        text = {\n            ...text,\n            ...p\n        };\n        viewportUI.setText(text);\n    }\n    const fontUI = new (0, $0d66a3ca6c18ec8d$export$2e7faedafda1fc85)({\n        ...text,\n        onUpdate: (p)=>{\n            onUpdate(p);\n        }\n    });\n    const colorWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        css: {\n            display: \"flex\",\n            gap: \"10px\",\n            flexDirection: \"column\"\n        }\n    });\n    const fillUI = new (0, $5b663384e3b198ee$export$5cdfb22682d2a5dd)({\n        fill: text.fill,\n        primaryColor: p.primaryColor,\n        secondaryColor: p.secondaryColor,\n        onUpdate: (p)=>{\n            onUpdate(p);\n        }\n    });\n    const strokeUI = new (0, $c73fdb6c21e3a26a$export$42bb0e3b48d549f6)({\n        stroke: text.stroke,\n        primaryColor: p.primaryColor,\n        secondaryColor: p.secondaryColor,\n        onUpdate: (p)=>{\n            onUpdate(p);\n        }\n    });\n    const textUI = new (0, $be275a032c52a6ed$export$c6656360602b35c2)({\n        text: text.text,\n        onUpdate: (p)=>{\n            p.text !== undefined && modal.setIgnoreBackground(p.text.length > 0);\n            onUpdate(p);\n        }\n    });\n    const tabs = new (0, $ae064bc6cfaee2ee$export$3c6d17ed0106bfb9)({\n        initialId: \"text\",\n        height: 40,\n        tabArr: [\n            {\n                id: \"text\",\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"text-text\"),\n                onOpen: ()=>{\n                    textUI.getElement().style.display = \"\";\n                    textUI.focus();\n                },\n                onClose: ()=>{\n                    textUI.getElement().style.display = \"none\";\n                }\n            },\n            {\n                id: \"font\",\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"text-font\"),\n                onOpen: ()=>{\n                    fontUI.getElement().style.display = \"flex\";\n                },\n                onClose: ()=>{\n                    fontUI.getElement().style.display = \"none\";\n                }\n            },\n            {\n                id: \"color\",\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"text-color\"),\n                onOpen: ()=>{\n                    colorWrapper.style.display = \"flex\";\n                },\n                onClose: ()=>{\n                    colorWrapper.style.display = \"none\";\n                }\n            }\n        ]\n    });\n    tabs.getElement().classList.add((0, $c072f29bb0ad2433$export$dbf350e5966cf602)({\n        minWidth: \"200px\",\n        maxWidth: \"500px\",\n        flexGrow: \"1\",\n        borderBottom: \"none !important\"\n    }));\n    const viewportInputsCss = (0, $c072f29bb0ad2433$export$dbf350e5966cf602)({\n        position: \"relative\",\n        \">*\": {\n            position: \"absolute\",\n            right: 0,\n            top: 10\n        }\n    });\n    const tabWrapperCss = (0, $c072f29bb0ad2433$export$dbf350e5966cf602)({\n        display: \"flex\",\n        justifyContent: \"space-between\",\n        flexDirection: \"row-reverse\",\n        flexWrap: \"wrap\",\n        marginTop: \"10px\",\n        marginLeft: \"-20px\",\n        marginRight: \"-20px\",\n        padding: \"0 20px\",\n        \"@media (min-width: 700px) and (min-height: 700px)\": {\n            display: \"none !important\"\n        }\n    });\n    const inputsCss = (0, $c072f29bb0ad2433$export$dbf350e5966cf602)({\n        minHeight: 72,\n        marginTop: \"10px\",\n        \"@media (min-width: 700px) and (min-height: 700px)\": {\n            display: \"flex\",\n            flexDirection: \"column\",\n            gap: \"10px\",\n            \">*\": {\n                display: \"flex !important\"\n            }\n        }\n    });\n    rootEl.append((0, $934e5f47c3374e21$export$db3b6bfb95261072)(\"\", [\n        (0, $934e5f47c3374e21$export$db3b6bfb95261072)(viewportWrapper, [\n            viewportUI.getElement()\n        ]),\n        (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\".\" + viewportInputsCss, [\n            viewportUI.getInputsElement()\n        ]),\n        (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\".tabrow.\" + tabWrapperCss, [\n            (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\",w-240,h-40\"),\n            tabs.getElement()\n        ]),\n        (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\".\" + inputsCss, [\n            (0, $934e5f47c3374e21$export$db3b6bfb95261072)(colorWrapper, [\n                fillUI.getElement(),\n                strokeUI.getElement()\n            ]),\n            fontUI.getElement(),\n            textUI.getElement()\n        ])\n    ]));\n    const onResize = ()=>{\n        const b = viewportWrapper.getBoundingClientRect();\n        const w = Math.ceil(b.width);\n        const h = Math.ceil(b.height);\n        viewportUI.setSize(w, h);\n    };\n    window.addEventListener(\"resize\", onResize);\n    setTimeout(()=>{\n        onResize();\n    });\n    setTimeout(()=>{\n        textUI.focus();\n    }, 100);\n    // prevent mobile keyboards scrolling page\n    function onScroll() {\n        window.scrollTo(0, 0);\n    }\n    window.addEventListener(\"scroll\", onScroll);\n    const onModalExit = (val)=>{\n        window.removeEventListener(\"resize\", onResize);\n        window.removeEventListener(\"scroll\", onScroll);\n        viewportUI.destroy();\n        fontUI.destroy();\n        fillUI.destroy();\n        strokeUI.destroy();\n        textUI.destroy();\n        tabs.destroy();\n        if (val === \"Ok\") p.onConfirm({\n            ...viewportUI.getValues(),\n            ...fontUI.getValues(),\n            ...fillUI.getValues(),\n            ...strokeUI.getValues(),\n            ...textUI.getValues()\n        });\n    };\n    const modal = (0, $2016c314bff36ab9$export$d7e8d4d4450c819c)({\n        target: document.body,\n        message: `<b>${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"text-title\")}</b>`,\n        div: rootEl,\n        buttons: [\n            \"Ok\",\n            \"Cancel\"\n        ],\n        ignoreBackground: p.text.text.length > 0,\n        callback: onModalExit,\n        style: {\n            width: \"calc(100% - 50px)\",\n            maxWidth: \"1000px\",\n            minWidth: \"300px\",\n            boxSizing: \"border-box\"\n        },\n        clickOnEnter: \"Ok\"\n    });\n}\n\n\n\n\n\n\n\nfunction $aa951ef8a5f9de6d$export$1bf16d9bd59fd8f9(p) {\n    const rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\n    const style = isSmall ? {} : {\n        width: \"540px\"\n    };\n    const resolutionEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        css: {\n            marginTop: \"10px\",\n            textAlign: \"center\",\n            color: \"#888\",\n            lineHeight: \"20px\"\n        }\n    });\n    const cropCopy = new (0, $c5a9090dbc3ef918$export$40175a5948a88a57)({\n        width: isSmall ? 340 : 540,\n        height: isSmall ? 300 : 400,\n        canvas: p.image.canvas,\n        isNotCopy: true,\n        onChange: (width, height)=>{\n            if (!resolutionEl) return;\n            updateResolution(width, height);\n        }\n    });\n    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(cropCopy.getEl(), {\n        marginLeft: \"-20px\"\n    });\n    cropCopy.getEl().title = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"crop-drag-to-crop\");\n    rootEl.append(cropCopy.getEl(), resolutionEl);\n    function updateResolution(w, h) {\n        const fit = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).fitInto(w, h, p.maxSize, p.maxSize);\n        if (fit.width < w) {\n            resolutionEl.innerHTML = `<span class=\"kl-text-error\">${w} X ${h}</span> \\u{27F6} ${Math.round(fit.width)} X ${Math.round(fit.height)}`;\n            resolutionEl.title = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"import-too-large\");\n        } else {\n            resolutionEl.innerHTML = `${w} X ${h}`;\n            resolutionEl.title = \"\";\n        }\n    }\n    updateResolution(p.image.width, p.image.height);\n    let doFlatten = false;\n    function showWarnings(psdWarningArr) {\n        const contentArr = [];\n        const warningMap = {\n            \"mask\": \"Masks not supported. Mask was applied.\",\n            \"clipping\": \"Clipping not supported. Clipping layers were merged.\",\n            \"group\": \"Groups not supported. Layers were ungrouped.\",\n            \"adjustment\": \"Adjustment layers not supported.\",\n            \"layer-effect\": \"Layer effects not supported.\",\n            \"smart-object\": \"Smart objects not supported.\",\n            \"blend-mode\": \"Unsupported layer blend mode.\",\n            \"bits-per-channel\": \"Unsupported color depth. Only 8bit per channel supported.\"\n        };\n        for(let i = 0; i < psdWarningArr.length; i++)contentArr.push(\"- \" + warningMap[psdWarningArr[i]]);\n        alert(contentArr.join(\"\\n\"));\n    }\n    let flattenCheckbox;\n    let warningsEl;\n    if (p.image.type === \"psd\") {\n        if (p.image.layers) {\n            flattenCheckbox = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n                init: doFlatten,\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"import-flatten\"),\n                callback: (b)=>{\n                    doFlatten = b;\n                }\n            });\n            rootEl.append(flattenCheckbox.getElement());\n            if (p.image.warningArr) {\n                const noteEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    className: \"kl-import-note\",\n                    content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"import-psd-limited-support\")\n                });\n                const warnings = p.image.warningArr;\n                warningsEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    parent: noteEl,\n                    tagName: \"a\",\n                    content: \"Details\",\n                    css: {\n                        marginLeft: \"5px\"\n                    },\n                    onClick: ()=>showWarnings(warnings)\n                });\n                rootEl.append(noteEl);\n            }\n        } else {\n            const noteEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                className: \"kl-import-note\",\n                content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"import-psd-unsupported\")\n            });\n            rootEl.append(noteEl);\n        }\n    }\n    function callback(result) {\n        const croppedImage = cropCopy.getCroppedCanvas();\n        const cropRect = cropCopy.getRect();\n        const isCropped = p.image.width !== cropRect.width && p.image.height !== cropRect.height;\n        cropCopy.destroy();\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(warningsEl);\n        if (flattenCheckbox) flattenCheckbox.destroy();\n        if (result === (0, $63d0b335c576c718$export$ce37e184d908d785)(\"import-btn-as-layer\")) {\n            p.callback({\n                type: \"as-layer\",\n                image: isCropped ? croppedImage : p.image.canvas\n            });\n            if (!isCropped) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).freeCanvas(croppedImage);\n        } else if (result === (0, $63d0b335c576c718$export$ce37e184d908d785)(\"import-btn-as-image\")) {\n            if (p.image.type === \"psd\") {\n                if (doFlatten) delete p.image.layers;\n                p.callback({\n                    type: \"as-image-psd\",\n                    image: p.image,\n                    cropObj: cropRect\n                });\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).freeCanvas(croppedImage);\n            } else if (p.image.type === \"image\") p.callback({\n                type: \"as-image\",\n                image: croppedImage\n            });\n        } else {\n            p.callback({\n                type: \"cancel\"\n            });\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).freeCanvas(croppedImage);\n        }\n    }\n    (0, $2016c314bff36ab9$export$d7e8d4d4450c819c)({\n        target: p.target,\n        message: `<b>${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"import-title\")}</b>`,\n        div: rootEl,\n        style: style,\n        buttons: [\n            (0, $63d0b335c576c718$export$ce37e184d908d785)(\"import-btn-as-layer\"),\n            (0, $63d0b335c576c718$export$ce37e184d908d785)(\"import-btn-as-image\"),\n            \"Cancel\"\n        ],\n        primaries: [\n            (0, $63d0b335c576c718$export$ce37e184d908d785)(\"import-btn-as-layer\"),\n            (0, $63d0b335c576c718$export$ce37e184d908d785)(\"import-btn-as-image\")\n        ],\n        callback: callback,\n        autoFocus: \"As Image\"\n    });\n}\n\n\n\nvar $e9d04a247aa46c18$exports = {};\n\n$parcel$export($e9d04a247aa46c18$exports, \"blendPsdToKl\", function () { return $e9d04a247aa46c18$export$6df36f0c42d2440f; });\n$parcel$export($e9d04a247aa46c18$exports, \"blendKlToPsd\", function () { return $e9d04a247aa46c18$export$4e3b1f7d3ad623b4; });\n$parcel$export($e9d04a247aa46c18$exports, \"readPsd\", function () { return $e9d04a247aa46c18$export$3d649861c4b13fa2; });\n$parcel$export($e9d04a247aa46c18$exports, \"klPsdToKlProject\", function () { return $e9d04a247aa46c18$export$56493bf279c387b3; });\n\n\n\n\n\nlet $e9d04a247aa46c18$var$kl2PsdMap;\nlet $e9d04a247aa46c18$var$psd2KlMap;\nfunction $e9d04a247aa46c18$var$init() {\n    if ($e9d04a247aa46c18$var$kl2PsdMap) return;\n    $e9d04a247aa46c18$var$kl2PsdMap = {\n        \"source-over\": \"normal\",\n        \"darken\": \"darken\",\n        \"multiply\": \"multiply\",\n        \"color-burn\": \"color burn\",\n        \"lighten\": \"lighten\",\n        \"screen\": \"screen\",\n        \"color-dodge\": \"color dodge\",\n        \"overlay\": \"overlay\",\n        \"soft-light\": \"soft light\",\n        \"hard-light\": \"hard light\",\n        \"difference\": \"difference\",\n        \"exclusion\": \"exclusion\",\n        \"hue\": \"hue\",\n        \"saturation\": \"saturation\",\n        \"color\": \"color\",\n        \"luminosity\": \"luminosity\"\n    };\n    $e9d04a247aa46c18$var$psd2KlMap = Object.fromEntries(Object.entries($e9d04a247aa46c18$var$kl2PsdMap).map((a)=>a.reverse()));\n}\nfunction $e9d04a247aa46c18$export$6df36f0c42d2440f(str) {\n    $e9d04a247aa46c18$var$init();\n    return $e9d04a247aa46c18$var$psd2KlMap[str];\n}\nfunction $e9d04a247aa46c18$export$4e3b1f7d3ad623b4(str) {\n    $e9d04a247aa46c18$var$init();\n    return $e9d04a247aa46c18$var$kl2PsdMap[str];\n}\nfunction $e9d04a247aa46c18$export$3d649861c4b13fa2(psdObj) {\n    if (!psdObj.canvas) throw new Error(\"psdObj.canvas undefined\");\n    const result = {\n        type: \"psd\",\n        canvas: psdObj.canvas,\n        width: psdObj.width,\n        height: psdObj.height\n    };\n    function addWarning(warningStr) {\n        if (!result.warningArr) result.warningArr = [];\n        if (result.warningArr.includes(warningStr)) return;\n        result.warningArr.push(warningStr);\n    }\n    function getMixModeStr(blendMode) {\n        let mixModeStr = $e9d04a247aa46c18$export$6df36f0c42d2440f(blendMode);\n        if (!mixModeStr) {\n            addWarning(\"blend-mode\");\n            mixModeStr = \"source-over\";\n        }\n        return mixModeStr;\n    }\n    if (psdObj.bitsPerChannel !== 8) addWarning(\"bits-per-channel\");\n    if (!psdObj.children) {\n        result.error = true;\n        return result;\n    }\n    // count resulting layers\n    const maxLayers = (0, $d26b85e649dca02a$export$9f4f73b1bd7c2f26);\n    let layerCount = 0;\n    function countWithinGroup(groupObj) {\n        let result = 0;\n        if (groupObj.blendMode) {\n            const mixModeStr = $e9d04a247aa46c18$export$6df36f0c42d2440f(groupObj.blendMode);\n            if (mixModeStr && mixModeStr !== \"source-over\") return 1;\n        }\n        if (groupObj.children) for(let i = 0; i < groupObj.children.length; i++){\n            const item = groupObj.children[i];\n            if (item.clipping || item.adjustment) continue;\n            if (item.children) {\n                addWarning(\"group\");\n                result += countWithinGroup(item);\n            } else result++;\n        }\n        return result;\n    }\n    layerCount += countWithinGroup(psdObj);\n    if (layerCount > maxLayers) {\n        result.error = true;\n        return result;\n    }\n    result.layers = [];\n    function prepareMask(maskCanvas, defaultColor) {\n        const groupMaskCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(maskCanvas);\n        const imData = groupMaskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\n        if (defaultColor === 0) for(let i = 0; i < imData.data.length; i += 4)imData.data[i + 3] = imData.data[i];\n        else for(let i = 0; i < imData.data.length; i += 4)imData.data[i + 3] = 255 - imData.data[i];\n        groupMaskCtx.putImageData(imData, 0, 0);\n    }\n    function convertGroup(psdGroupObj) {\n        let resultArr = [];\n        const groupIsVisible = !psdGroupObj.hidden;\n        const groupOpacity = (0, $fc4403c8ee6a33dc$export$5c097f720de072a2)(psdGroupObj.opacity, \"groupOpacity is undefined\");\n        const groupMixModeStr = getMixModeStr(psdGroupObj.blendMode);\n        let groupCanvas;\n        let groupCtx;\n        if (groupMixModeStr !== \"source-over\") {\n            groupCanvas = (0, $9f64dcf89d8f9132$export$cd3d1f114b139967)(result.width, result.height);\n            groupCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(groupCanvas);\n        }\n        // prepare group mask\n        if (psdGroupObj.mask) {\n            addWarning(\"mask\");\n            prepareMask(psdGroupObj.mask.canvas, psdGroupObj.mask.defaultColor);\n        }\n        if (psdGroupObj.children) for(let i = 0; i < psdGroupObj.children.length; i++){\n            const item = psdGroupObj.children[i];\n            if (item.clipping) continue;\n            if (item.adjustment) {\n                addWarning(\"adjustment\");\n                continue;\n            }\n            const hasClipping = (item.children || item.canvas) && psdGroupObj.children[i + 1] && psdGroupObj.children[i + 1].clipping;\n            if (hasClipping) addWarning(\"clipping\");\n            if (item.children) {\n                const convertedChildGroupItems = convertGroup(item);\n                for(let e = 0; e < convertedChildGroupItems.length; e++){\n                    const innerItem = convertedChildGroupItems[e];\n                    const innerCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(innerItem.image);\n                    // clipping\n                    if (hasClipping) {\n                        const clippingCanvas = (0, $9f64dcf89d8f9132$export$cd3d1f114b139967)(result.width, result.height);\n                        const clippingCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(clippingCanvas);\n                        clippingCtx.drawImage(innerItem.image, 0, 0);\n                        for(let f = i + 1; f < psdGroupObj.children.length && psdGroupObj.children[f].clipping; f++){\n                            const clippingItem = psdGroupObj.children[f];\n                            if (clippingItem.opacity === 0 || clippingItem.hidden) continue;\n                            if (clippingItem.blendMode === undefined) throw new Error(\"clippingItem.blendMode undefined\");\n                            if (clippingItem.opacity === undefined) throw new Error(\"clippingItem.opacity undefined\");\n                            if (clippingItem.canvas === undefined) throw new Error(\"clippingItem.canvas undefined\");\n                            if (clippingItem.left === undefined) throw new Error(\"clippingItem.left undefined\");\n                            if (clippingItem.top === undefined) throw new Error(\"clippingItem.top undefined\");\n                            clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\n                            clippingCtx.globalAlpha = clippingItem.opacity;\n                            clippingCtx.drawImage(clippingItem.canvas, clippingItem.left, clippingItem.top);\n                        }\n                        innerCtx.globalCompositeOperation = \"source-atop\";\n                        innerCtx.drawImage(clippingCanvas, 0, 0);\n                    }\n                    // group mask\n                    if (psdGroupObj.mask) {\n                        innerCtx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? \"destination-in\" : \"destination-out\";\n                        if (psdGroupObj.mask.canvas === undefined) throw new Error(\"psdGroupObj.mask.canvas undefined\");\n                        if (psdGroupObj.mask.left === undefined) throw new Error(\"psdGroupObj.mask.left undefined\");\n                        if (psdGroupObj.mask.top === undefined) throw new Error(\"psdGroupObj.mask.top undefined\");\n                        innerCtx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\n                    }\n                    if (groupCanvas) {\n                        if (groupCtx === undefined) throw new Error(\"groupCtx undefined\");\n                        groupCtx.globalCompositeOperation = innerItem.mixModeStr;\n                        groupCtx.globalAlpha = innerItem.opacity;\n                        groupCtx.drawImage(innerItem.image, 0, 0);\n                    } else {\n                        innerItem.opacity = innerItem.opacity * groupOpacity;\n                        resultArr.push(innerItem);\n                    }\n                }\n                continue;\n            }\n            const canvas = (0, $9f64dcf89d8f9132$export$cd3d1f114b139967)(result.width, result.height);\n            const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(canvas);\n            if (item.canvas) {\n                if (item.top === undefined) throw new Error(\"item.top undefined\");\n                if (item.left === undefined) throw new Error(\"item.left undefined\");\n                ctx.drawImage(item.canvas, item.left, item.top);\n            }\n            // effects\n            if (item.effects) addWarning(\"layer-effect\");\n            // mask\n            if (item.mask) {\n                addWarning(\"mask\");\n                if (item.mask.canvas === undefined) throw new Error(\"item.mask.canvas undefined\");\n                if (item.mask.defaultColor === undefined) throw new Error(\"item.mask.defaultColor undefined\");\n                if (item.mask.left === undefined) throw new Error(\"item.mask.left undefined\");\n                if (item.mask.top === undefined) throw new Error(\"item.mask.top undefined\");\n                prepareMask(item.mask.canvas, item.mask.defaultColor);\n                ctx.globalCompositeOperation = item.mask.defaultColor === 0 ? \"destination-in\" : \"destination-out\";\n                ctx.drawImage(item.mask.canvas, item.mask.left, item.mask.top);\n            }\n            // clipping\n            if (hasClipping) {\n                if (item.right === undefined) throw new Error(\"item.right undefined\");\n                if (item.left === undefined) throw new Error(\"item.left undefined\");\n                if (item.bottom === undefined) throw new Error(\"item.bottom undefined\");\n                if (item.top === undefined) throw new Error(\"item.top undefined\");\n                if (item.canvas === undefined) throw new Error(\"item.canvas undefined\");\n                const clippingCanvas = (0, $9f64dcf89d8f9132$export$cd3d1f114b139967)(item.right - item.left, item.bottom - item.top);\n                const clippingCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(clippingCanvas);\n                clippingCtx.drawImage(item.canvas, 0, 0);\n                for(let e = i + 1; e < psdGroupObj.children.length && psdGroupObj.children[e].clipping; e++){\n                    const clippingItem = psdGroupObj.children[e];\n                    if (clippingItem.opacity === 0 || clippingItem.hidden) continue;\n                    if (clippingItem.blendMode === undefined) throw new Error(\"clippingItem.blendMode undefined\");\n                    if (clippingItem.opacity === undefined) throw new Error(\"clippingItem.opacity undefined\");\n                    if (clippingItem.canvas === undefined) throw new Error(\"clippingItem.canvas undefined\");\n                    if (clippingItem.left === undefined) throw new Error(\"clippingItem.left undefined\");\n                    if (clippingItem.top === undefined) throw new Error(\"clippingItem.top undefined\");\n                    clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\n                    clippingCtx.globalAlpha = clippingItem.opacity;\n                    clippingCtx.drawImage(clippingItem.canvas, clippingItem.left - item.left, clippingItem.top - item.top);\n                }\n                ctx.globalCompositeOperation = \"source-atop\";\n                ctx.drawImage(clippingCanvas, item.left, item.top);\n            }\n            // group mask\n            if (psdGroupObj.mask) {\n                ctx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? \"destination-in\" : \"destination-out\";\n                if (psdGroupObj.mask.canvas === undefined) throw new Error(\"psdGroupObj.mask.canvas undefined\");\n                if (psdGroupObj.mask.left === undefined) throw new Error(\"psdGroupObj.mask.left undefined\");\n                if (psdGroupObj.mask.top === undefined) throw new Error(\"psdGroupObj.mask.top undefined\");\n                ctx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\n            }\n            if (item.blendMode === undefined) throw new Error(\"item.blendMode undefined\");\n            if (item.hidden === undefined) throw new Error(\"item.hidden  undefined\");\n            if (item.opacity === undefined) throw new Error(\"item.opacity undefined\");\n            if (groupCanvas && groupCtx) {\n                if (groupOpacity > 0) {\n                    groupCtx.globalCompositeOperation = getMixModeStr(item.blendMode);\n                    groupCtx.globalAlpha = item.hidden ? 0 : item.opacity;\n                    groupCtx.drawImage(canvas, 0, 0);\n                }\n            } else {\n                if (item.name === undefined) throw new Error(\"item.name undefined\");\n                resultArr.push({\n                    name: item.name,\n                    isVisible: !item.hidden && groupIsVisible,\n                    opacity: item.opacity * groupOpacity,\n                    mixModeStr: getMixModeStr(item.blendMode),\n                    image: canvas\n                });\n            }\n        }\n        if (groupCanvas) {\n            if (psdGroupObj.name === undefined) throw new Error(\"psdGroupObj.name undefined\");\n            resultArr = [\n                {\n                    name: psdGroupObj.name,\n                    isVisible: groupIsVisible,\n                    opacity: groupOpacity,\n                    mixModeStr: groupMixModeStr,\n                    image: groupCanvas\n                }\n            ];\n        }\n        return resultArr;\n    }\n    result.layers = convertGroup({\n        name: \"root\",\n        opacity: 1,\n        blendMode: \"normal\",\n        children: psdObj.children\n    });\n    return result;\n}\nfunction $e9d04a247aa46c18$export$56493bf279c387b3(klPsd) {\n    // only share references to Canvas elements\n    const result = {\n        width: klPsd.width,\n        height: klPsd.height,\n        layers: []\n    };\n    if (klPsd.layers) result.layers = klPsd.layers.map((item)=>{\n        return {\n            name: item.name,\n            isVisible: item.isVisible,\n            opacity: item.opacity,\n            mixModeStr: item.mixModeStr,\n            image: item.image\n        };\n    });\n    else // flattened\n    result.layers = [\n        {\n            name: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"background\"),\n            isVisible: true,\n            opacity: 1,\n            mixModeStr: \"source-over\",\n            image: klPsd.canvas\n        }\n    ];\n    return result;\n}\n\n\n\n\nvar $c122457b67184bc9$exports = {};\n\n$parcel$export($c122457b67184bc9$exports, \"setDbName\", function () { return $c122457b67184bc9$export$1347f8be1f25c479; });\n$parcel$export($c122457b67184bc9$exports, \"getKlProjectObj\", function () { return $c122457b67184bc9$export$1448a0dd0d3fde8e; });\n$parcel$export($c122457b67184bc9$exports, \"storeKlProjectObj\", function () { return $c122457b67184bc9$export$21ade4eb935254aa; });\n$parcel$export($c122457b67184bc9$exports, \"clear\", function () { return $c122457b67184bc9$export$42ffd38884aecdac; });\nconst $c122457b67184bc9$var$indexedDbIsSupported = !!window.indexedDB;\nlet $c122457b67184bc9$var$dbNameStr = \"Klecks\";\nconst $c122457b67184bc9$var$storageNameStr = \"ProjectStore\";\nfunction $c122457b67184bc9$export$1347f8be1f25c479(name) {\n    $c122457b67184bc9$var$dbNameStr = \"\" + name;\n}\n/**\n * connects to db dbNameStr, then executes transaction on storageNameStr storage\n * with index 'id'\n *\n * @param actionFunction what to execute during transaction\n * @param successCallback on successful transaction\n * @param errorCallback on error\n */ function $c122457b67184bc9$var$execIndexedDBTransaction(actionFunction, successCallback, errorCallback) {\n    let hasFinished = false;\n    function onSuccess() {\n        if (hasFinished) return;\n        hasFinished = true;\n        successCallback();\n    }\n    function onError(errorStr) {\n        if (hasFinished) return;\n        hasFinished = true;\n        errorCallback(errorStr);\n    }\n    if (!$c122457b67184bc9$var$indexedDbIsSupported) {\n        setTimeout(function() {\n            onError(\"no indexed db available\");\n        }, 0);\n        return;\n    }\n    let requestObj;\n    try {\n        requestObj = window.indexedDB.open($c122457b67184bc9$var$dbNameStr, 1);\n    } catch (e) {\n        onError(e.message);\n        return;\n    }\n    requestObj.onupgradeneeded = function() {\n        try {\n            const db = requestObj.result;\n            const store = db.createObjectStore($c122457b67184bc9$var$storageNameStr, {\n                keyPath: \"id\"\n            });\n            store.createIndex(\"id\", \"id\", {\n                unique: true\n            });\n        } catch (e) {\n            onError(e.message);\n        }\n    };\n    requestObj.onerror = function() {\n        onError(\"indexedDB.open failed, \" + requestObj.error);\n    };\n    requestObj.onsuccess = function() {\n        let databaseObj;\n        let transactionObj;\n        let storeObj;\n        try {\n            databaseObj = requestObj.result;\n            if (!databaseObj.objectStoreNames.contains($c122457b67184bc9$var$storageNameStr)) {\n                //someone maybe messed with the db, or creation failed earlier\n                //it's broken -> destroy\n                window.indexedDB.deleteDatabase($c122457b67184bc9$var$dbNameStr);\n                onError(\"object store \" + $c122457b67184bc9$var$storageNameStr + \" missing. destroying db\");\n                return;\n            }\n            transactionObj = databaseObj.transaction($c122457b67184bc9$var$storageNameStr, \"readwrite\");\n            storeObj = transactionObj.objectStore($c122457b67184bc9$var$storageNameStr);\n            storeObj.index(\"id\");\n        } catch (e) {\n            onError(e.message);\n            return;\n        }\n        databaseObj.onerror = function() {\n            onError(\"database error, \" + databaseObj.error);\n        };\n        try {\n            actionFunction(storeObj);\n        } catch (e) {\n            onError(e.message);\n            return;\n        }\n        transactionObj.oncomplete = function() {\n            onSuccess();\n            databaseObj.close();\n        };\n        transactionObj.onerror = function() {\n            onError(\"transaction error, \" + transactionObj.error);\n        };\n    };\n}\nfunction $c122457b67184bc9$export$1448a0dd0d3fde8e(successCallback, errorCallback) {\n    if ($c122457b67184bc9$var$indexedDbIsSupported) {\n        let query;\n        $c122457b67184bc9$var$execIndexedDBTransaction(function(storeObj) {\n            query = storeObj.get(1);\n        }, function() {\n            successCallback(query.result);\n        }, function(errorStr) {\n            errorCallback(\"execIndexedDBTransaction error, \" + errorStr);\n        });\n    } else successCallback(undefined);\n}\nfunction $c122457b67184bc9$export$21ade4eb935254aa(storageProject, successCallback, errorCallback) {\n    $c122457b67184bc9$var$execIndexedDBTransaction(function(storeObj) {\n        storeObj.put(storageProject);\n    }, function() {\n        successCallback();\n    }, function(errorStr) {\n        errorCallback(errorStr);\n    });\n}\nfunction $c122457b67184bc9$export$42ffd38884aecdac(successCallback, errorCallback) {\n    $c122457b67184bc9$var$execIndexedDBTransaction(function(storeObj) {\n        storeObj.delete(1);\n    }, function() {\n        successCallback();\n    }, function(error) {\n        errorCallback(error);\n    });\n}\n\n\nvar $f698b2728458c67c$exports = {};\n\n$f698b2728458c67c$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"edit-brightness-contrast.8430cb26.svg\";\n\n\n\nvar $40d2759ce9a63d61$exports = {};\n\n$40d2759ce9a63d61$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"edit-curves.bbdb97b2.svg\";\n\n\nvar $ce8cff2073e0dbd0$exports = {};\n\n$ce8cff2073e0dbd0$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"edit-flip.00fd2c6b.svg\";\n\n\nvar $ac0aca426899243b$exports = {};\n\n$ac0aca426899243b$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"edit-hue-saturation.6e36cf05.svg\";\n\n\nvar $b10b50b35445327f$exports = {};\n\n$b10b50b35445327f$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"edit-invert.f5d05ba3.png\";\n\n\nvar $2b9d4bef1fb7a247$exports = {};\n\n$2b9d4bef1fb7a247$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"edit-perspective.e23100db.svg\";\n\n\nvar $593ff3f236561579$exports = {};\n\n$593ff3f236561579$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"edit-resize.56391e2b.svg\";\n\n\n\nvar $d8f018e35a94ad80$exports = {};\n\n$d8f018e35a94ad80$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"edit-tilt-shift.f8ae88b3.png\";\n\n\nvar $08a9274b2d3ddb77$exports = {};\n\n$08a9274b2d3ddb77$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"edit-to-alpha.f7a2065a.svg\";\n\n\nvar $4cf8ddf6b6b87b44$exports = {};\n\n$4cf8ddf6b6b87b44$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"edit-transform.c8795430.svg\";\n\n\nvar $a1a23269f02c60e3$exports = {};\n\n$a1a23269f02c60e3$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"edit-triangle-blur.d2c20f1d.png\";\n\n\nvar $f6c5ea2c2b7b2ebc$exports = {};\n\n$f6c5ea2c2b7b2ebc$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"edit-unsharp-mask.f1520547.png\";\n\n\nvar $527aa9d5f9dc6831$exports = {};\n\n$527aa9d5f9dc6831$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"edit-grid.e900ce7b.svg\";\n\n\nvar $6d8eb0c4a83eec4b$exports = {};\n\n$6d8eb0c4a83eec4b$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"edit-noise.51bd751c.svg\";\n\n\nvar $848d8b186ce3b8b1$exports = {};\n\n$848d8b186ce3b8b1$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"edit-pattern.1a06e094.svg\";\n\n\nvar $27475547fcd62d76$exports = {};\n\n$27475547fcd62d76$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"edit-vanish-point.fc5858e4.svg\";\n\n\nvar $e034fd153bdc6206$exports = {};\n\n$e034fd153bdc6206$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"edit-distort.bdb643f2.svg\";\n\n\nconst $aa2ca71db1de8ae6$export$7a4e0b62a5d854bc = {\n    isLoaded: false\n};\nconst $aa2ca71db1de8ae6$export$395d33c8e06b92c9 = {\n    brightnessContrast: {\n        lang: {\n            name: \"filter-bright-contrast-title\",\n            button: \"filter-bright-contrast\",\n            description: \"filter-bright-contrast-description\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($f698b2728458c67c$exports))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true\n    },\n    cropExtend: {\n        lang: {\n            name: \"filter-crop-title\",\n            button: \"filter-crop-extend\",\n            description: \"filter-crop-description\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($15f04c4a93604cc0$exports))),\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false\n    },\n    curves: {\n        lang: {\n            name: \"filter-curves-title\",\n            button: \"filter-curves\",\n            description: \"filter-curves-description\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($40d2759ce9a63d61$exports))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true\n    },\n    distort: {\n        lang: {\n            name: \"filter-distort\",\n            button: \"filter-distort\",\n            description: \"filter-distort-description\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($e034fd153bdc6206$exports))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true\n    },\n    flip: {\n        lang: {\n            name: \"filter-flip-title\",\n            button: \"filter-flip\",\n            description: \"filter-flip-description\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($ce8cff2073e0dbd0$exports))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true\n    },\n    hueSaturation: {\n        lang: {\n            name: \"filter-hue-sat-title\",\n            button: \"filter-hue-sat\",\n            description: \"filter-hue-sat-description\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($ac0aca426899243b$exports))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true\n    },\n    invert: {\n        lang: {\n            name: \"filter-invert\",\n            button: \"filter-invert\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($b10b50b35445327f$exports))),\n        updatePos: false,\n        isInstant: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true\n    },\n    perspective: {\n        lang: {\n            name: \"filter-perspective-title\",\n            button: \"filter-perspective\",\n            description: \"filter-perspective-description\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($2b9d4bef1fb7a247$exports))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true\n    },\n    resize: {\n        lang: {\n            name: \"filter-resize-title\",\n            button: \"filter-resize\",\n            description: \"filter-resize-description\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($593ff3f236561579$exports))),\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false\n    },\n    rotate: {\n        lang: {\n            name: \"filter-rotate-title\",\n            button: \"filter-rotate\",\n            description: \"filter-rotate-description\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($49efe074a761be4a$exports))),\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false\n    },\n    tiltShift: {\n        lang: {\n            name: \"filter-tilt-shift-title\",\n            button: \"filter-tilt-shift\",\n            description: \"filter-tilt-shift-description\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($d8f018e35a94ad80$exports))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true\n    },\n    toAlpha: {\n        lang: {\n            name: \"filter-to-alpha-title\",\n            button: \"filter-to-alpha\",\n            description: \"filter-to-alpha-description\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($08a9274b2d3ddb77$exports))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true\n    },\n    transform: {\n        lang: {\n            name: \"filter-transform-title\",\n            button: \"filter-transform\",\n            description: \"filter-transform-description\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($4cf8ddf6b6b87b44$exports))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true\n    },\n    blur: {\n        lang: {\n            name: \"filter-triangle-blur-title\",\n            button: \"filter-triangle-blur\",\n            description: \"filter-triangle-blur-description\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($a1a23269f02c60e3$exports))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true\n    },\n    unsharpMask: {\n        lang: {\n            name: \"filter-unsharp-mask-title\",\n            button: \"filter-unsharp-mask\",\n            description: \"filter-unsharp-mask-description\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($f6c5ea2c2b7b2ebc$exports))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true\n    },\n    grid: {\n        lang: {\n            name: \"filter-grid\",\n            button: \"filter-grid\",\n            description: \"filter-grid-description\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($527aa9d5f9dc6831$exports))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true\n    },\n    noise: {\n        lang: {\n            name: \"filter-noise\",\n            button: \"filter-noise\",\n            description: \"filter-noise-description\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($6d8eb0c4a83eec4b$exports))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true\n    },\n    pattern: {\n        lang: {\n            name: \"filter-pattern\",\n            button: \"filter-pattern\",\n            description: \"filter-pattern-description\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($848d8b186ce3b8b1$exports))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true\n    },\n    vanishPoint: {\n        lang: {\n            name: \"filter-vanish-point-title\",\n            button: \"filter-vanish-point\",\n            description: \"filter-vanish-point-description\"\n        },\n        icon: (0, (/*@__PURE__*/$parcel$interopDefault($27475547fcd62d76$exports))),\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true\n    }\n};\n\n\n\n\n/*\n * A speed-improved perlin and simplex noise algorithms for 2D.\n *\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\n * Better rank ordering method by Stefan Gustavson in 2012.\n * Converted to Javascript by Joseph Gentle.\n *\n * Version 2012-03-09\n *\n * This code was placed in the public domain by its original author,\n * Stefan Gustavson. You may use it as you see fit, but\n * attribution is appreciated.\n *\n */ const $f49636f27554dab5$var$myModule = {};\nclass $f49636f27554dab5$var$Grad {\n    dot2(x, y) {\n        return this.x * x + this.y * y;\n    }\n    constructor(x, y, z){\n        this.x = x;\n        this.y = y;\n        this.z = z;\n    }\n}\n/*\nGrad.prototype.dot3 = function(x, y, z) {\n    return this.x*x + this.y*y + this.z*z;\n};*/ const $f49636f27554dab5$var$grad3 = [\n    new $f49636f27554dab5$var$Grad(1, 1, 0),\n    new $f49636f27554dab5$var$Grad(-1, 1, 0),\n    new $f49636f27554dab5$var$Grad(1, -1, 0),\n    new $f49636f27554dab5$var$Grad(-1, -1, 0),\n    new $f49636f27554dab5$var$Grad(1, 0, 1),\n    new $f49636f27554dab5$var$Grad(-1, 0, 1),\n    new $f49636f27554dab5$var$Grad(1, 0, -1),\n    new $f49636f27554dab5$var$Grad(-1, 0, -1),\n    new $f49636f27554dab5$var$Grad(0, 1, 1),\n    new $f49636f27554dab5$var$Grad(0, -1, 1),\n    new $f49636f27554dab5$var$Grad(0, 1, -1),\n    new $f49636f27554dab5$var$Grad(0, -1, -1)\n];\nconst $f49636f27554dab5$var$p = [\n    151,\n    160,\n    137,\n    91,\n    90,\n    15,\n    131,\n    13,\n    201,\n    95,\n    96,\n    53,\n    194,\n    233,\n    7,\n    225,\n    140,\n    36,\n    103,\n    30,\n    69,\n    142,\n    8,\n    99,\n    37,\n    240,\n    21,\n    10,\n    23,\n    190,\n    6,\n    148,\n    247,\n    120,\n    234,\n    75,\n    0,\n    26,\n    197,\n    62,\n    94,\n    252,\n    219,\n    203,\n    117,\n    35,\n    11,\n    32,\n    57,\n    177,\n    33,\n    88,\n    237,\n    149,\n    56,\n    87,\n    174,\n    20,\n    125,\n    136,\n    171,\n    168,\n    68,\n    175,\n    74,\n    165,\n    71,\n    134,\n    139,\n    48,\n    27,\n    166,\n    77,\n    146,\n    158,\n    231,\n    83,\n    111,\n    229,\n    122,\n    60,\n    211,\n    133,\n    230,\n    220,\n    105,\n    92,\n    41,\n    55,\n    46,\n    245,\n    40,\n    244,\n    102,\n    143,\n    54,\n    65,\n    25,\n    63,\n    161,\n    1,\n    216,\n    80,\n    73,\n    209,\n    76,\n    132,\n    187,\n    208,\n    89,\n    18,\n    169,\n    200,\n    196,\n    135,\n    130,\n    116,\n    188,\n    159,\n    86,\n    164,\n    100,\n    109,\n    198,\n    173,\n    186,\n    3,\n    64,\n    52,\n    217,\n    226,\n    250,\n    124,\n    123,\n    5,\n    202,\n    38,\n    147,\n    118,\n    126,\n    255,\n    82,\n    85,\n    212,\n    207,\n    206,\n    59,\n    227,\n    47,\n    16,\n    58,\n    17,\n    182,\n    189,\n    28,\n    42,\n    223,\n    183,\n    170,\n    213,\n    119,\n    248,\n    152,\n    2,\n    44,\n    154,\n    163,\n    70,\n    221,\n    153,\n    101,\n    155,\n    167,\n    43,\n    172,\n    9,\n    129,\n    22,\n    39,\n    253,\n    19,\n    98,\n    108,\n    110,\n    79,\n    113,\n    224,\n    232,\n    178,\n    185,\n    112,\n    104,\n    218,\n    246,\n    97,\n    228,\n    251,\n    34,\n    242,\n    193,\n    238,\n    210,\n    144,\n    12,\n    191,\n    179,\n    162,\n    241,\n    81,\n    51,\n    145,\n    235,\n    249,\n    14,\n    239,\n    107,\n    49,\n    192,\n    214,\n    31,\n    181,\n    199,\n    106,\n    157,\n    184,\n    84,\n    204,\n    176,\n    115,\n    121,\n    50,\n    45,\n    127,\n    4,\n    150,\n    254,\n    138,\n    236,\n    205,\n    93,\n    222,\n    114,\n    67,\n    29,\n    24,\n    72,\n    243,\n    141,\n    128,\n    195,\n    78,\n    66,\n    215,\n    61,\n    156,\n    180\n];\n// To remove the need for index wrapping, double the permutation table length\nconst $f49636f27554dab5$var$perm = new Array(512);\nconst $f49636f27554dab5$var$gradP = new Array(512);\n// This isn't a very good seeding function, but it works ok. It supports 2^16\n// different seed values. Write something better if you need more seeds.\n$f49636f27554dab5$var$myModule.seed = function(seed) {\n    if (seed > 0 && seed < 1) // Scale the seed out\n    seed *= 65536;\n    seed = Math.floor(seed);\n    if (seed < 256) seed |= seed << 8;\n    for(let i = 0; i < 256; i++){\n        let v;\n        if (i & 1) v = $f49636f27554dab5$var$p[i] ^ seed & 255;\n        else v = $f49636f27554dab5$var$p[i] ^ seed >> 8 & 255;\n        $f49636f27554dab5$var$perm[i] = $f49636f27554dab5$var$perm[i + 256] = v;\n        $f49636f27554dab5$var$gradP[i] = $f49636f27554dab5$var$gradP[i + 256] = $f49636f27554dab5$var$grad3[v % 12];\n    }\n};\n$f49636f27554dab5$var$myModule.seed(0);\n/*\nfor (let i=0; i<256; i++) {\n  perm[i] = perm[i + 256] = p[i];\n  gradP[i] = gradP[i + 256] = grad3[perm[i] % 12];\n}*/ // Skewing and unskewing factors for 2, 3, and 4 dimensions\nconst $f49636f27554dab5$var$F2 = 0.5 * (Math.sqrt(3) - 1);\nconst $f49636f27554dab5$var$G2 = (3 - Math.sqrt(3)) / 6;\n/*let F3 = 1/3;\nlet G3 = 1/6;*/ // 2D simplex noise\n$f49636f27554dab5$var$myModule.simplex2 = function(xin, yin) {\n    let n0, n1, n2; // Noise contributions from the three corners\n    // Skew the input space to determine which simplex cell we're in\n    const s = (xin + yin) * $f49636f27554dab5$var$F2; // Hairy factor for 2D\n    let i = Math.floor(xin + s);\n    let j = Math.floor(yin + s);\n    const t = (i + j) * $f49636f27554dab5$var$G2;\n    const x0 = xin - i + t; // The x,y distances from the cell origin, unskewed.\n    const y0 = yin - j + t;\n    // For the 2D case, the simplex shape is an equilateral triangle.\n    // Determine which simplex we are in.\n    let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\n    if (x0 > y0) {\n        i1 = 1;\n        j1 = 0;\n    } else {\n        i1 = 0;\n        j1 = 1;\n    }\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\n    // c = (3-sqrt(3))/6\n    const x1 = x0 - i1 + $f49636f27554dab5$var$G2; // Offsets for middle corner in (x,y) unskewed coords\n    const y1 = y0 - j1 + $f49636f27554dab5$var$G2;\n    const x2 = x0 - 1 + 2 * $f49636f27554dab5$var$G2; // Offsets for last corner in (x,y) unskewed coords\n    const y2 = y0 - 1 + 2 * $f49636f27554dab5$var$G2;\n    // Work out the hashed gradient indices of the three simplex corners\n    i &= 255;\n    j &= 255;\n    const gi0 = $f49636f27554dab5$var$gradP[i + $f49636f27554dab5$var$perm[j]];\n    const gi1 = $f49636f27554dab5$var$gradP[i + i1 + $f49636f27554dab5$var$perm[j + j1]];\n    const gi2 = $f49636f27554dab5$var$gradP[i + 1 + $f49636f27554dab5$var$perm[j + 1]];\n    // Calculate the contribution from the three corners\n    let t0 = 0.5 - x0 * x0 - y0 * y0;\n    if (t0 < 0) n0 = 0;\n    else {\n        t0 *= t0;\n        n0 = t0 * t0 * gi0.dot2(x0, y0); // (x,y) of grad3 used for 2D gradient\n    }\n    let t1 = 0.5 - x1 * x1 - y1 * y1;\n    if (t1 < 0) n1 = 0;\n    else {\n        t1 *= t1;\n        n1 = t1 * t1 * gi1.dot2(x1, y1);\n    }\n    let t2 = 0.5 - x2 * x2 - y2 * y2;\n    if (t2 < 0) n2 = 0;\n    else {\n        t2 *= t2;\n        n2 = t2 * t2 * gi2.dot2(x2, y2);\n    }\n    // Add contributions from each corner to get the final noise value.\n    // The result is scaled to return values in the interval [-1,1].\n    return 70 * (n0 + n1 + n2);\n};\nconst $f49636f27554dab5$export$d3022aad56692482 = $f49636f27554dab5$var$myModule;\n\n\nfunction $be08c7e8caa49ffa$export$74a44bbc21d06a28(w) {\n    const scaleFac = w / 500;\n    const h = w;\n    const canvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(w, h);\n    const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(canvas);\n    const imData = ctx.createImageData(w, h);\n    for(let x = 0; x < w; x++)for(let y = 0; y < h; y++){\n        const i = (y * w + x) * 4;\n        // base noise\n        const sFac2 = scaleFac + (0, $f49636f27554dab5$export$d3022aad56692482).simplex2(x / 50 / scaleFac, y / 50 / scaleFac) * 0.04;\n        let noisePattern = 100 + ((0, $f49636f27554dab5$export$d3022aad56692482).simplex2(x / 50 / sFac2, y / 50 / sFac2) + 1) / 2 * 100;\n        noisePattern -= ((0, $f49636f27554dab5$export$d3022aad56692482).simplex2(x / 10 / scaleFac, y / 10 / scaleFac) + 1) / 2 * 100;\n        // fade out in circular shape\n        const centerDist = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).dist(w / 2, h / 2, x, y);\n        const falloff = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(1 - ((centerDist - w / 2.5) / (w / 14) + (0, $f49636f27554dab5$export$d3022aad56692482).simplex2(x / 22 / sFac2, y / 22 / sFac2)), 0, 1);\n        noisePattern = noisePattern * falloff;\n        // make the middle darker\n        const falloff2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(1 - centerDist / w, 0, 1) * 2;\n        noisePattern = noisePattern * falloff2;\n        imData.data[i] = 0;\n        imData.data[i + 1] = 0;\n        imData.data[i + 2] = 0;\n        imData.data[i + 3] = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(noisePattern, 0, 255);\n    }\n    ctx.putImageData(imData, 0, 0);\n    return canvas;\n}\n// https://www.shadertoy.com/view/3tdSDj\nfunction $be08c7e8caa49ffa$var$udSegment(p, a, b) {\n    const ba = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Vec2.sub(b, a);\n    const pa = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Vec2.sub(p, a);\n    const h = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp((0, $d9f9f4926aa80a1c$export$921068d8846a1559).Vec2.dot(pa, ba) / (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Vec2.dot(ba, ba), 0.0, 1.0);\n    return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Vec2.len((0, $d9f9f4926aa80a1c$export$921068d8846a1559).Vec2.sub(pa, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Vec2.mul(ba, h)));\n}\nfunction $be08c7e8caa49ffa$export$eaa218d5d17c8f1c(w) {\n    const pDist = 1 / 4;\n    let centerSize = 2 / 3;\n    let transitionSize = 1 / 3;\n    centerSize *= pDist;\n    transitionSize *= pDist;\n    const p1 = {\n        x: pDist * w,\n        y: w - w * pDist\n    };\n    const p2 = {\n        x: w - w * pDist,\n        y: pDist * w\n    };\n    const h = w;\n    const canvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(w, h);\n    const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(canvas);\n    const imData = ctx.createImageData(w, h);\n    for(let x = 0; x < w; x++)for(let y = 0; y < h; y++){\n        const i = (y * w + x) * 4;\n        let col = $be08c7e8caa49ffa$var$udSegment({\n            x: x,\n            y: y\n        }, p1, p2);\n        col = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(255 - (col - w * centerSize) / (w * transitionSize) * 255, 0, 255);\n        imData.data[i] = 0;\n        imData.data[i + 1] = 0;\n        imData.data[i + 2] = 0;\n        imData.data[i + 3] = col;\n    }\n    ctx.putImageData(imData, 0, 0);\n    return canvas;\n}\n\n\nconst $f1a560137f603778$export$d116ae91f77f1f19 = []; //used by default brush\n$f1a560137f603778$export$d116ae91f77f1f19[1] = (0, $be08c7e8caa49ffa$export$74a44bbc21d06a28)(128);\n$f1a560137f603778$export$d116ae91f77f1f19[2] = (0, $be08c7e8caa49ffa$export$eaa218d5d17c8f1c)(128);\n\n\n\nconst $ab3d0b0688f50842$var$ALPHA_CIRCLE = 0;\nconst $ab3d0b0688f50842$var$ALPHA_CHALK = 1;\nconst $ab3d0b0688f50842$var$ALPHA_CAL = 2; // calligraphy\nconst $ab3d0b0688f50842$var$ALPHA_SQUARE = 3;\nconst $ab3d0b0688f50842$var$TWO_PI = 2 * Math.PI;\nclass $ab3d0b0688f50842$export$6f96c8f9e6ae7341 {\n    updateAlphaCanvas() {\n        if (this.settingAlphaId === $ab3d0b0688f50842$var$ALPHA_CIRCLE || this.settingAlphaId === $ab3d0b0688f50842$var$ALPHA_SQUARE) return;\n        const instructionArr = [\n            [\n                this.alphaCanvas128,\n                128\n            ],\n            [\n                this.alphaCanvas64,\n                64\n            ],\n            [\n                this.alphaCanvas32,\n                32\n            ]\n        ];\n        let ctx;\n        for(let i = 0; i < instructionArr.length; i++){\n            ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(instructionArr[i][0]);\n            ctx.save();\n            ctx.clearRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\n            ctx.fillStyle = \"rgba(\" + this.settingColor.r + \", \" + this.settingColor.g + \", \" + this.settingColor.b + \", \" + this.alphaOpacityArr[this.settingAlphaId] + \")\";\n            ctx.fillRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\n            ctx.globalCompositeOperation = \"destination-in\";\n            ctx.imageSmoothingQuality = \"high\";\n            ctx.drawImage((0, $f1a560137f603778$export$d116ae91f77f1f19)[this.settingAlphaId], 0, 0, instructionArr[i][1], instructionArr[i][1]);\n            ctx.restore();\n        }\n    }\n    calcOpacity(pressure) {\n        return this.settingOpacity * (this.settingHasOpacityPressure ? pressure * pressure : 1);\n    }\n    /**\n     * @param x\n     * @param y\n     * @param size\n     * @param opacity\n     * @param angle\n     * @param before - [x, y, size, opacity, angle] the drawDot call before\n     */ drawDot(x, y, size, opacity, angle, before) {\n        if (size <= 0) return;\n        if (this.settingLockLayerAlpha) this.context.globalCompositeOperation = \"source-atop\";\n        if (!before || before[3] !== opacity) this.context.globalAlpha = opacity;\n        if (!before && (this.settingAlphaId === $ab3d0b0688f50842$var$ALPHA_CIRCLE || this.settingAlphaId === $ab3d0b0688f50842$var$ALPHA_SQUARE)) this.context.fillStyle = this.settingColorStr;\n        if (this.settingAlphaId === $ab3d0b0688f50842$var$ALPHA_CIRCLE) {\n            this.context.beginPath();\n            this.context.arc(x, y, size, 0, $ab3d0b0688f50842$var$TWO_PI);\n            this.context.closePath();\n            this.context.fill();\n            this.hasDrawnDot = true;\n        } else if (this.settingAlphaId === $ab3d0b0688f50842$var$ALPHA_SQUARE) {\n            if (angle !== undefined) {\n                this.context.save();\n                this.context.translate(x, y);\n                this.context.rotate(angle / 180 * Math.PI);\n                this.context.fillRect(-size, -size, size * 2, size * 2);\n                this.context.restore();\n                this.hasDrawnDot = true;\n            }\n        } else {\n            this.context.save();\n            this.context.translate(x, y);\n            let targetMipmap = this.alphaCanvas128;\n            if (size <= 32 && size > 16) targetMipmap = this.alphaCanvas64;\n            else if (size <= 16) targetMipmap = this.alphaCanvas32;\n            this.context.scale(size, size);\n            if (this.settingAlphaId === $ab3d0b0688f50842$var$ALPHA_CHALK) this.context.rotate((x + y) * 53123 % $ab3d0b0688f50842$var$TWO_PI); // without mod it sometimes looks different\n            this.context.drawImage(targetMipmap, -1, -1, 2, 2);\n            this.context.restore();\n            this.hasDrawnDot = true;\n        }\n    }\n    // continueLine\n    continueLine(x, y, size, pressure) {\n        if (this.bezierLine === null) {\n            this.bezierLine = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).BezierLine();\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, ()=>{});\n        }\n        const drawArr = []; //draw instructions. will be all drawn at once\n        const dotCallback = (val)=>{\n            const localPressure = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.lastInput2.pressure, pressure, val.t);\n            const localOpacity = this.calcOpacity(localPressure);\n            const localSize = Math.max(0.1, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\n            drawArr.push([\n                val.x,\n                val.y,\n                localSize,\n                localOpacity,\n                val.angle\n            ]);\n        };\n        const localSpacing = size * this.settingSpacing;\n        if (x === null || y === null) this.bezierLine.addFinal(localSpacing, dotCallback);\n        else this.bezierLine.add(x, y, localSpacing, dotCallback);\n        // execute draw instructions\n        this.context.save();\n        let before = undefined;\n        for(let i = 0; i < drawArr.length; i++){\n            const item = drawArr[i];\n            this.drawDot(item[0], item[1], item[2], item[3], item[4], before);\n            before = item;\n        }\n        this.context.restore();\n    }\n    // ---- interface ----\n    startLine(x, y, p) {\n        this.historyEntry = {\n            tool: [\n                \"brush\",\n                \"PenBrush\"\n            ],\n            actions: [\n                {\n                    action: \"opacityPressure\",\n                    params: [\n                        this.settingHasOpacityPressure\n                    ]\n                },\n                {\n                    action: \"sizePressure\",\n                    params: [\n                        this.settingHasSizePressure\n                    ]\n                },\n                {\n                    action: \"setSize\",\n                    params: [\n                        this.settingSize\n                    ]\n                },\n                {\n                    action: \"setSpacing\",\n                    params: [\n                        this.settingSpacing\n                    ]\n                },\n                {\n                    action: \"setOpacity\",\n                    params: [\n                        this.settingOpacity\n                    ]\n                },\n                {\n                    action: \"setColor\",\n                    params: [\n                        this.settingColor\n                    ]\n                },\n                {\n                    action: \"setAlpha\",\n                    params: [\n                        this.settingAlphaId\n                    ]\n                },\n                {\n                    action: \"setLockAlpha\",\n                    params: [\n                        this.settingLockLayerAlpha\n                    ]\n                }\n            ]\n        };\n        p = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(p, 0, 1);\n        const localOpacity = this.calcOpacity(p);\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\n        this.hasDrawnDot = false;\n        this.inputIsDrawing = true;\n        this.context.save();\n        this.drawDot(x, y, localSize, localOpacity);\n        this.context.restore();\n        this.lineToolLastDot = localSize * this.settingSpacing;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2.pressure = p;\n        this.inputArr = [\n            {\n                x: x,\n                y: y,\n                pressure: p\n            }\n        ];\n        this.historyEntry.actions.push({\n            action: \"startLine\",\n            params: [\n                x,\n                y,\n                p\n            ]\n        });\n    }\n    goLine(x, y, p) {\n        if (!this.inputIsDrawing) return;\n        this.historyEntry.actions.push({\n            action: \"goLine\",\n            params: [\n                x,\n                y,\n                p\n            ]\n        });\n        const pressure = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(p, 0, 1);\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n        this.context.save();\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\n        /*context.fillStyle = 'red';\n        context.fillRect(Math.floor(x), Math.floor(y - 10), 1, 20);\n        context.fillRect(Math.floor(x - 10), Math.floor(y), 20, 1);*/ this.context.restore();\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput2.pressure = this.lastInput.pressure;\n        this.lastInput.pressure = pressure;\n        this.inputArr.push({\n            x: x,\n            y: y,\n            pressure: p\n        });\n    }\n    endLine(x, y) {\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n        this.context.save();\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\n        this.context.restore();\n        this.inputIsDrawing = false;\n        if (this.settingAlphaId === $ab3d0b0688f50842$var$ALPHA_SQUARE && !this.hasDrawnDot) {\n            // find max pressure input, use that one\n            let maxInput = this.inputArr[0];\n            this.inputArr.forEach((item)=>{\n                if (item.pressure > maxInput.pressure) maxInput = item;\n            });\n            this.context.save();\n            const p = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(maxInput.pressure, 0, 1);\n            const localOpacity = this.calcOpacity(p);\n            this.drawDot(maxInput.x, maxInput.y, localSize, localOpacity, 0);\n            this.context.restore();\n        }\n        this.bezierLine = null;\n        if (this.historyEntry) {\n            this.historyEntry.actions.push({\n                action: \"endLine\",\n                params: [\n                    x,\n                    y\n                ]\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n        this.hasDrawnDot = false;\n        this.inputArr = [];\n    }\n    drawLineSegment(x1, y1, x2, y2) {\n        this.lastInput.x = x2;\n        this.lastInput.y = y2;\n        this.lastInput.pressure = 1;\n        if (this.inputIsDrawing || x1 === undefined) return;\n        const angle = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).pointsToAngleDeg({\n            x: x1,\n            y: y1\n        }, {\n            x: x2,\n            y: y2\n        });\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        const eX = (x2 - x1) / mouseDist;\n        const eY = (y2 - y1) / mouseDist;\n        let loopDist;\n        const bdist = this.settingSize * this.settingSpacing;\n        this.lineToolLastDot = this.settingSize * this.settingSpacing;\n        this.context.save();\n        for(loopDist = this.lineToolLastDot; loopDist <= mouseDist; loopDist += bdist)this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.settingSize, this.settingOpacity, angle);\n        this.context.restore();\n        const historyEntry = {\n            tool: [\n                \"brush\",\n                \"PenBrush\"\n            ],\n            actions: [\n                {\n                    action: \"opacityPressure\",\n                    params: [\n                        this.settingHasOpacityPressure\n                    ]\n                },\n                {\n                    action: \"sizePressure\",\n                    params: [\n                        this.settingHasSizePressure\n                    ]\n                },\n                {\n                    action: \"setSize\",\n                    params: [\n                        this.settingSize\n                    ]\n                },\n                {\n                    action: \"setSpacing\",\n                    params: [\n                        this.settingSpacing\n                    ]\n                },\n                {\n                    action: \"setOpacity\",\n                    params: [\n                        this.settingOpacity\n                    ]\n                },\n                {\n                    action: \"setColor\",\n                    params: [\n                        this.settingColor\n                    ]\n                },\n                {\n                    action: \"setAlpha\",\n                    params: [\n                        this.settingAlphaId\n                    ]\n                },\n                {\n                    action: \"setLockAlpha\",\n                    params: [\n                        this.settingLockLayerAlpha\n                    ]\n                },\n                {\n                    action: \"drawLineSegment\",\n                    params: [\n                        x1,\n                        y1,\n                        x2,\n                        y2\n                    ]\n                }\n            ]\n        };\n        this.history.push(historyEntry);\n    }\n    //IS\n    isDrawing() {\n        return this.inputIsDrawing;\n    }\n    //SET\n    setAlpha(a) {\n        if (this.settingAlphaId === a) return;\n        this.settingAlphaId = a;\n        this.updateAlphaCanvas();\n    }\n    setColor(c) {\n        if (this.settingColor === c) return;\n        this.settingColor = {\n            r: c.r,\n            g: c.g,\n            b: c.b\n        };\n        this.settingColorStr = \"rgb(\" + this.settingColor.r + \",\" + this.settingColor.g + \",\" + this.settingColor.b + \")\";\n        this.updateAlphaCanvas();\n    }\n    setContext(c) {\n        this.context = c;\n    }\n    setHistory(l) {\n        this.history = l;\n    }\n    setSize(s) {\n        this.settingSize = s;\n    }\n    setOpacity(o) {\n        this.settingOpacity = o;\n    }\n    setSpacing(s) {\n        this.settingSpacing = s;\n    }\n    sizePressure(b) {\n        this.settingHasSizePressure = b;\n    }\n    opacityPressure(b) {\n        this.settingHasOpacityPressure = b;\n    }\n    setLockAlpha(b) {\n        this.settingLockLayerAlpha = b;\n    }\n    //GET\n    getSpacing() {\n        return this.settingSpacing;\n    }\n    getSize() {\n        return this.settingSize;\n    }\n    getOpacity() {\n        return this.settingOpacity;\n    }\n    getLockAlpha() {\n        return this.settingLockLayerAlpha;\n    }\n    // ---- public ----\n    constructor(){\n        this.context = {};\n        this.history = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).DecoyKlHistory();\n        this.settingHasOpacityPressure = false;\n        this.settingHasSizePressure = true;\n        this.settingSize = 2;\n        this.settingSpacing = 0.8489;\n        this.settingOpacity = 1;\n        this.settingColor = {};\n        this.settingColorStr = \"\";\n        this.settingAlphaId = $ab3d0b0688f50842$var$ALPHA_CIRCLE;\n        this.settingLockLayerAlpha = false;\n        this.hasDrawnDot = false;\n        this.lineToolLastDot = 0;\n        this.lastInput = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        };\n        this.lastInput2 = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        };\n        this.inputArr = [];\n        this.inputIsDrawing = false;\n        this.bezierLine = null;\n        // mipmapping\n        this.alphaCanvas128 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(128, 128);\n        this.alphaCanvas64 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(64, 64);\n        this.alphaCanvas32 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(32, 32);\n        this.alphaOpacityArr = [\n            1,\n            0.9,\n            1,\n            1\n        ];\n    }\n}\n\n\n\n\nconst $2beac24702a6836b$var$cellSize = 256;\nclass $2beac24702a6836b$export$9659db8d01dd5313 {\n    updateRedrawBounds(bounds) {\n        this.redrawBounds = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).updateBounds(this.redrawBounds, bounds);\n    }\n    getCellsWidth() {\n        return Math.ceil(this.context.canvas.width / $2beac24702a6836b$var$cellSize);\n    }\n    /**\n     * draw changed cells (changed by brushstroke) onto context\n     * @private\n     */ drawChangedCells() {\n        if (!this.redrawBounds) return;\n        const cells = this.cells.map(()=>undefined);\n        const touchedCells = this.getTouchedCells(this.redrawBounds);\n        touchedCells.forEach((isTouched, index)=>{\n            if (isTouched) cells[index] = this.cells[index];\n        });\n        this.drawCells(cells);\n        this.redrawBounds = undefined;\n    }\n    getTouchedCells(bounds) {\n        const touchedCells = this.cells.map(()=>false);\n        const cellsW = this.getCellsWidth();\n        bounds = {\n            x1: Math.floor(bounds.x1 / $2beac24702a6836b$var$cellSize),\n            y1: Math.floor(bounds.y1 / $2beac24702a6836b$var$cellSize),\n            x2: Math.floor(bounds.x2 / $2beac24702a6836b$var$cellSize),\n            y2: Math.floor(bounds.y2 / $2beac24702a6836b$var$cellSize)\n        };\n        for(let i = bounds.x1; i <= bounds.x2; i++)for(let e = bounds.y1; e <= bounds.y2; e++)touchedCells[e * cellsW + i] = true;\n        return touchedCells;\n    }\n    /**\n     * Slice up bounds according to cells\n     * @param bounds\n     * @private\n     */ sliceBounds(bounds) {\n        const cellsW = this.getCellsWidth();\n        const result = [];\n        const touchedCells = this.getTouchedCells(bounds);\n        touchedCells.forEach((cell, i)=>{\n            if (!cell) return;\n            const cellOffsetX = i % cellsW * $2beac24702a6836b$var$cellSize;\n            const cellOffsetY = Math.floor(i / cellsW) * $2beac24702a6836b$var$cellSize;\n            const cellWidth = this.cells[i].width;\n            const cellHeight = this.cells[i].height;\n            const inCellBounds = {\n                x1: Math.max(0, bounds.x1 - cellOffsetX),\n                y1: Math.max(0, bounds.y1 - cellOffsetY),\n                x2: Math.min(cellWidth - 1, bounds.x2 - cellOffsetX),\n                y2: Math.min(cellHeight - 1, bounds.y2 - cellOffsetY)\n            };\n            if (inCellBounds.x1 > inCellBounds.x2 || inCellBounds.y1 > inCellBounds.y2) return;\n            result.push({\n                index: i,\n                bounds: inCellBounds\n            });\n        });\n        return result;\n    }\n    /**\n     * update copyImageData. copy over new regions if needed\n     */ copyFromCanvas(bounds) {\n        if (!bounds) return;\n        const touchedCells = this.getTouchedCells(bounds);\n        const cellsW = this.getCellsWidth();\n        touchedCells.forEach((item, i)=>{\n            if (!item || this.cells[i]) // not touched, or already copied\n            return;\n            const x = i % cellsW;\n            const y = Math.floor(i / cellsW);\n            const w = (Math.min(x * $2beac24702a6836b$var$cellSize + $2beac24702a6836b$var$cellSize, this.context.canvas.width) - 1) % $2beac24702a6836b$var$cellSize + 1;\n            const h = (Math.min(y * $2beac24702a6836b$var$cellSize + $2beac24702a6836b$var$cellSize, this.context.canvas.height) - 1) % $2beac24702a6836b$var$cellSize + 1;\n            // temp canvas to prevent main canvas from getting slowed down in chrome\n            const tmpCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(w, h);\n            const tmpCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(tmpCanvas);\n            tmpCtx.drawImage(this.context.canvas, -x * $2beac24702a6836b$var$cellSize, -y * $2beac24702a6836b$var$cellSize);\n            this.cells[i] = tmpCtx.getImageData(0, 0, w, h);\n        });\n    }\n    getAverage(x, y, size) {\n        size = Math.max(0.5, size * 0.75);\n        const x1 = Math.max(0, Math.floor(x - size));\n        const y1 = Math.max(0, Math.floor(y - size));\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\n        if (x1 > x2 || y1 > y2) return {\n            r: 0,\n            g: 0,\n            b: 0,\n            a: 0\n        };\n        let ar = 0, ag = 0, ab = 0, aa = 0, alpha;\n        const slicedBounds = this.sliceBounds({\n            x1: x1,\n            y1: y1,\n            x2: x2,\n            y2: y2\n        });\n        slicedBounds.forEach((slice)=>{\n            const width = this.cells[slice.index].width;\n            const data = this.cells[slice.index].data;\n            const bounds = slice.bounds;\n            for(let i = bounds.y1; i <= bounds.y2; i += 4)for(let e = bounds.x1, e2 = i * width * 4 + bounds.x1 * 4; e <= bounds.x2; e += 4, e2 += 16){\n                alpha = data[e2 + 3];\n                ar += data[e2] * alpha;\n                ag += data[e2 + 1] * alpha;\n                ab += data[e2 + 2] * alpha;\n                aa += alpha;\n            }\n        });\n        if (aa !== 0) {\n            ar /= aa;\n            ag /= aa;\n            ab /= aa;\n            aa = Math.min(1, aa);\n        }\n        return {\n            r: ar,\n            g: ag,\n            b: ab,\n            a: aa\n        };\n    }\n    prepDot(x, y, size) {\n        size = Math.max(0.5, size);\n        const x1 = Math.max(0, Math.floor(x - size));\n        const y1 = Math.max(0, Math.floor(y - size));\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\n        if (x1 > x2 || y1 > y2) return undefined;\n        return {\n            x1: x1,\n            y1: y1,\n            x2: x2,\n            y2: y2\n        };\n    }\n    drawDot(params) {\n        // array with random numbers. faster than Math.random()\n        let randI = 0;\n        const randLen = params.size > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\n        const randArr = [];\n        for(let i = 0; i < randLen; i++)randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\n        // thin lines take more than just 1 sample\n        const sampleArr = [\n            8,\n            4,\n            4,\n            4,\n            2,\n            2,\n            2,\n            2,\n            2,\n            2\n        ]; // <0.5, 0.5, 1, 1.5, etc.\n        const samples = sampleArr[Math.floor(params.size * 2)];\n        const samplesSquared = samples ? samples * samples : 0;\n        const sampleOffsets = [];\n        if (samples) {\n            let i = 0;\n            for(let n = 0; n < samples; n++)for(let m = 0; m < samples; m++, i += 2){\n                sampleOffsets[i] = (n + 1) / samples; // x offset\n                sampleOffsets[i + 1] = (m + 1) / samples; // y offset\n            }\n        }\n        const sharpness = Math.pow(params.opacity, 2) * 0.8;\n        // to optimize calculations\n        const invSharpness = 1 - sharpness;\n        const sharpnessSubtrahend = sharpness / invSharpness;\n        const sizeSquared = params.size * params.size;\n        const distDivisor = sizeSquared * invSharpness / params.opacity;\n        const alphaMinuend = (1 + sharpnessSubtrahend) * params.opacity;\n        const slicedBounds = this.sliceBounds({\n            x1: params.x1,\n            y1: params.y1,\n            x2: params.x2,\n            y2: params.y2\n        });\n        const cellsW = this.getCellsWidth();\n        slicedBounds.forEach((slice)=>{\n            const cellOffsetX = slice.index % cellsW * $2beac24702a6836b$var$cellSize;\n            const cellOffsetY = Math.floor(slice.index / cellsW) * $2beac24702a6836b$var$cellSize;\n            const cellWidth = this.cells[slice.index].width;\n            const data = this.cells[slice.index].data;\n            // i - y index within cell\n            // e - x index within cell\n            // e2 - index in image data\n            // ri - y index within image relative to dot-center\n            // re - x index within image relative to dot-center\n            for(let i = slice.bounds.y1, ri = i + cellOffsetY - params.y; i <= slice.bounds.y2; i++, ri++)for(let e = slice.bounds.x1, e2 = i * cellWidth * 4 + slice.bounds.x1 * 4, re = e + cellOffsetX - params.x; e <= slice.bounds.x2; e++, e2 += 4, re++){\n                // O = over -> brush-dot\n                // U = under -> image\n                let alphaO = 0;\n                if (samplesSquared) {\n                    for(let f = 0; f < sampleOffsets.length; f += 2){\n                        const dist = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).lenSquared(re + sampleOffsets[f], ri + sampleOffsets[f + 1]);\n                        if (dist >= sizeSquared) continue;\n                        alphaO += (0, $9414f5ea41e9cf25$export$7d15b64cf5a3a4c4)(alphaMinuend - dist / distDivisor, 0, params.opacity);\n                    }\n                    if (!alphaO) continue;\n                    alphaO /= samplesSquared;\n                } else {\n                    // technically needs + 0.5 offset, but not noticeable with large brush\n                    const dist = Math.pow(re, 2) + Math.pow(ri, 2);\n                    if (dist >= sizeSquared) continue;\n                    alphaO = (0, $9414f5ea41e9cf25$export$7d15b64cf5a3a4c4)(alphaMinuend - dist / distDivisor, 0, params.opacity);\n                }\n                const invAlphaO = 1 - alphaO;\n                const alphaU = data[e2 + 3] / 255;\n                if (this.settingLockLayerAlpha) {\n                    const underR = params.r * alphaO + data[e2] * invAlphaO;\n                    const underG = params.g * alphaO + data[e2 + 1] * invAlphaO;\n                    const underB = params.b * alphaO + data[e2 + 2] * invAlphaO;\n                    if (alphaU) {\n                        data[e2] = Math.floor(underR + randArr[randI]);\n                        data[e2 + 1] = Math.floor(underG + randArr[randI]);\n                        data[e2 + 2] = Math.floor(underB + randArr[randI]);\n                    }\n                } else {\n                    const underR = params.r * alphaO + data[e2] * alphaU * invAlphaO;\n                    const underG = params.g * alphaO + data[e2 + 1] * alphaU * invAlphaO;\n                    const underB = params.b * alphaO + data[e2 + 2] * alphaU * invAlphaO;\n                    const newAlpha = 1 - invAlphaO * (1 - alphaU);\n                    data[e2 + 3] = Math.floor(Math.min(255, newAlpha * 255) + 0.5);\n                    if (newAlpha) {\n                        data[e2] = Math.floor(underR / newAlpha + randArr[randI]);\n                        data[e2 + 1] = Math.floor(underG / newAlpha + randArr[randI]);\n                        data[e2 + 2] = Math.floor(underB / newAlpha + randArr[randI]);\n                    }\n                }\n                randI = (randI + 1) % randLen;\n            }\n        });\n    }\n    calcSpacing(size) {\n        return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(size * 2 / 2, size * 2 / 9, (0, $9414f5ea41e9cf25$export$7d15b64cf5a3a4c4)((size - 2.7) / 9.3, 0, 1));\n    }\n    continueLine(x, y, p, isCoalesced) {\n        this.drawBuffer = [];\n        let localPressure;\n        let localOpacity;\n        let localSize = this.settingSizePressure ? Math.max(1, p * this.size) : Math.max(1, this.size);\n        const bDist = this.calcSpacing(localSize);\n        const avgX = x === undefined ? this.lastInput.x : x;\n        const avgY = y === undefined ? this.lastInput.y : y;\n        let localColNew;\n        if (this.blending === 0) {\n            this.mixCol.r = this.color.r;\n            this.mixCol.g = this.color.g;\n            this.mixCol.b = this.color.b;\n        } else {\n            let average;\n            if (isCoalesced) average = {\n                r: this.localColOld.r,\n                g: this.localColOld.g,\n                b: this.localColOld.b,\n                a: 0\n            };\n            else {\n                const avgParams = [\n                    avgX,\n                    avgY,\n                    this.settingSizePressure ? Math.max(0.5, p * this.size) : Math.max(0.5, this.size)\n                ];\n                const bounds = this.prepDot(avgParams[0], avgParams[1], avgParams[2]);\n                if (bounds) this.copyFromCanvas(bounds);\n                average = this.getAverage(avgParams[0], avgParams[1], avgParams[2]);\n            }\n            localColNew = {\n                r: 0,\n                g: 0,\n                b: 0,\n                a: 0\n            };\n            if (average.a > 0 && this.blendCol.a === 0) {\n                this.blendCol.r = average.r;\n                this.blendCol.g = average.g;\n                this.blendCol.b = average.b;\n                this.blendCol.a = average.a;\n                localColNew.r = this.blendCol.r;\n                localColNew.g = this.blendCol.g;\n                localColNew.b = this.blendCol.b;\n                localColNew.a = this.blendCol.a;\n            } else {\n                if (average.a === 0) {\n                    average.r = this.color.r;\n                    average.g = this.color.g;\n                    average.b = this.color.b;\n                    average.a = 1 - this.blending;\n                }\n                this.blendCol.r = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.blendCol.r, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.blendCol.r, average.r, this.blendMix), average.a);\n                this.blendCol.g = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.blendCol.g, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.blendCol.g, average.g, this.blendMix), average.a);\n                this.blendCol.b = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.blendCol.b, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.blendCol.b, average.b, this.blendMix), average.a);\n                this.blendCol.a = Math.min(1, this.blendCol.a + average.a);\n                localColNew.r = this.blendCol.r;\n                localColNew.g = this.blendCol.g;\n                localColNew.b = this.blendCol.b;\n                localColNew.a = this.blendCol.a;\n            }\n        }\n        const bezierCallback = (val)=>{\n            if (this.blending >= 1 && this.blendCol.a <= 0) return;\n            const factor = val.t;\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\n            localOpacity = this.settingOpacityPressure ? this.opacity * localPressure * localPressure : this.opacity;\n            localSize = this.settingSizePressure ? Math.max(0.1, localPressure * this.size) : Math.max(0.1, this.size);\n            if (this.blending != 0) {\n                this.mixCol.r = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.localColOld.r, localColNew.r, factor);\n                this.mixCol.g = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.localColOld.g, localColNew.g, factor);\n                this.mixCol.b = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.localColOld.b, localColNew.b, factor);\n            }\n            if (this.blending === 1 && this.localColOld.a === 0) {\n                this.mixCol.r = localColNew.r;\n                this.mixCol.g = localColNew.g;\n                this.mixCol.b = localColNew.b;\n            }\n            const bounds = this.prepDot(val.x, val.y, localSize);\n            if (bounds) {\n                this.updateRedrawBounds(bounds);\n                this.drawBuffer.push({\n                    x: val.x,\n                    y: val.y,\n                    size: localSize,\n                    opacity: localOpacity,\n                    x1: bounds.x1,\n                    y1: bounds.y1,\n                    x2: bounds.x2,\n                    y2: bounds.y2,\n                    r: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.color.r, this.mixCol.r, this.blending),\n                    g: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.color.g, this.mixCol.g, this.blending),\n                    b: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.color.b, this.mixCol.b, this.blending)\n                });\n            }\n        };\n        if (x === undefined || y === undefined) this.bezierLine.addFinal(bDist, bezierCallback);\n        else this.bezierLine.add(x, y, bDist, bezierCallback);\n        this.copyFromCanvas(this.redrawBounds);\n        this.drawBuffer.forEach((item)=>{\n            this.drawDot(item);\n        });\n        this.drawBuffer = [];\n        this.localColOld = localColNew;\n    }\n    setHistory(h) {\n        this.history = h;\n    }\n    getSize() {\n        return this.size;\n    }\n    setSize(s) {\n        this.size = s;\n    }\n    getOpacity() {\n        return this.opacity;\n    }\n    setOpacity(o) {\n        this.opacity = o;\n    }\n    getBlending() {\n        return this.blending;\n    }\n    setBlending(b) {\n        this.blending = b;\n    }\n    setColor(c) {\n        this.color = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(c);\n    }\n    setContext(c) {\n        this.context = c;\n    }\n    setSizePressure(b) {\n        this.settingSizePressure = b;\n    }\n    setOpacityPressure(b) {\n        this.settingOpacityPressure = b;\n    }\n    getLockAlpha() {\n        return this.settingLockLayerAlpha;\n    }\n    setLockAlpha(b) {\n        this.settingLockLayerAlpha = b;\n    }\n    getIsDrawing() {\n        return this.isDrawing;\n    }\n    setIsTesting(b) {\n        this.isTesting = b;\n    }\n    startLine(x, y, p) {\n        this.historyEntry = {\n            tool: [\n                \"brush\",\n                \"BlendBrush\"\n            ],\n            actions: []\n        };\n        const totalCells = Math.ceil(this.context.canvas.width / $2beac24702a6836b$var$cellSize) * Math.ceil(this.context.canvas.height / $2beac24702a6836b$var$cellSize);\n        this.cells = \"0\".repeat(totalCells).split(\"\").map(()=>undefined);\n        this.isDrawing = true;\n        p = Math.max(0, Math.min(1, p));\n        const localOpacity = this.settingOpacityPressure ? this.opacity * p * p : this.opacity;\n        const localSize = this.settingSizePressure ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\n        if (this.blending === 0) {\n            this.mixCol.r = this.color.r;\n            this.mixCol.g = this.color.g;\n            this.mixCol.b = this.color.b;\n        } else {\n            this.copyFromCanvas(this.prepDot(x, y, localSize));\n            const average = this.getAverage(x, y, this.settingSizePressure ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size));\n            if (average.a === 0) this.blendCol = {\n                r: this.color.r,\n                g: this.color.g,\n                b: this.color.b,\n                a: 1 - this.blending\n            };\n            else this.blendCol = {\n                r: average.r,\n                g: average.g,\n                b: average.b,\n                a: average.a\n            };\n            this.mixCol.r = this.blendCol.r;\n            this.mixCol.g = this.blendCol.g;\n            this.mixCol.b = this.blendCol.b;\n        }\n        this.localColOld = {\n            r: this.mixCol.r,\n            g: this.mixCol.g,\n            b: this.mixCol.b,\n            a: this.blendCol.a\n        };\n        this.redrawBounds = undefined;\n        this.drawBuffer = [];\n        if (this.blending < 1 || this.blendCol.a > 0) {\n            const bounds = this.prepDot(x, y, localSize);\n            if (bounds) {\n                this.updateRedrawBounds(bounds);\n                this.drawBuffer.push({\n                    x: x,\n                    y: y,\n                    size: localSize,\n                    opacity: localOpacity,\n                    x1: bounds.x1,\n                    y1: bounds.y1,\n                    x2: bounds.x2,\n                    y2: bounds.y2,\n                    r: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.color.r, this.mixCol.r, this.blending),\n                    g: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.color.g, this.mixCol.g, this.blending),\n                    b: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.color.b, this.mixCol.b, this.blending)\n                });\n            }\n        }\n        this.copyFromCanvas(this.redrawBounds);\n        this.drawBuffer.forEach((item)=>{\n            this.drawDot(item);\n        });\n        this.drawBuffer = [];\n        this.bezierLine = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).BezierLine();\n        this.bezierLine.add(x, y, 0, function() {});\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(this.lastInput);\n        if (!this.isTesting) this.drawChangedCells();\n    }\n    goLine(x, y, p, isCoalesced) {\n        if (!this.isDrawing) return;\n        this.continueLine(x, y, this.lastInput.pressure, isCoalesced);\n        this.lastInput2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(this.lastInput);\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        if (!this.isTesting) this.drawChangedCells();\n    }\n    endLine() {\n        if (this.bezierLine) this.continueLine(undefined, undefined, this.lastInput.pressure, false);\n        this.isDrawing = false;\n        this.bezierLine = undefined;\n        this.drawChangedCells();\n        if (this.historyEntry && this.history && this.cells.find((item)=>!!item)) {\n            this.historyEntry.actions.push({\n                action: \"drawCells\",\n                params: [\n                    this.cells\n                ]\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n        this.cells = [];\n    }\n    /**\n     * draw cells onto context\n     * @param cells\n     */ drawCells(cells) {\n        const cellsW = this.getCellsWidth();\n        cells.forEach((imageData, index)=>{\n            if (!imageData) return;\n            const cellOffsetX = index % cellsW * $2beac24702a6836b$var$cellSize;\n            const cellOffsetY = Math.floor(index / cellsW) * $2beac24702a6836b$var$cellSize;\n            this.context.putImageData(imageData, cellOffsetX, cellOffsetY);\n        });\n    }\n    drawLineSegment(x1, y1, x2, y2) {\n        this.lastInput.x = x2;\n        this.lastInput.y = y2;\n        if (this.isDrawing || x1 === undefined) return;\n        const totalCells = Math.ceil(this.context.canvas.width / $2beac24702a6836b$var$cellSize) * Math.ceil(this.context.canvas.height / $2beac24702a6836b$var$cellSize);\n        this.cells = \"0\".repeat(totalCells).split(\"\").map(()=>undefined);\n        this.redrawBounds = undefined;\n        this.drawBuffer = [];\n        this.copyFromCanvas(this.prepDot(x1, y1, Math.max(0.1, this.size)));\n        const average = this.getAverage(x1, y1, Math.max(0.1, this.size));\n        if (average.a === 0) this.blendCol = {\n            r: this.color.r,\n            g: this.color.g,\n            b: this.color.b,\n            a: 1 - this.blending\n        };\n        else this.blendCol = {\n            r: average.r,\n            g: average.g,\n            b: average.b,\n            a: average.a\n        };\n        this.mixCol.r = this.color.r * (1 - this.blendCol.a) + (this.blending * this.blendCol.r + this.color.r * (1 - this.blending)) * this.blendCol.a;\n        this.mixCol.g = this.color.g * (1 - this.blendCol.a) + (this.blending * this.blendCol.g + this.color.g * (1 - this.blending)) * this.blendCol.a;\n        this.mixCol.b = this.color.b * (1 - this.blendCol.a) + (this.blending * this.blendCol.b + this.color.b * (1 - this.blending)) * this.blendCol.a;\n        const p = 1;\n        const localOpacity = this.settingOpacityPressure ? this.opacity * p * p : this.opacity;\n        const localSize = this.settingSizePressure ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        const eX = (x2 - x1) / mouseDist;\n        const eY = (y2 - y1) / mouseDist;\n        const bDist = this.calcSpacing(localSize);\n        for(let loopDist = 0; loopDist <= mouseDist; loopDist += bDist){\n            const bounds = this.prepDot(x1 + eX * loopDist, y1 + eY * loopDist, localSize);\n            if (bounds) {\n                this.copyFromCanvas(bounds);\n                this.drawBuffer.push({\n                    x: x1 + eX * loopDist,\n                    y: y1 + eY * loopDist,\n                    size: localSize,\n                    opacity: localOpacity,\n                    x1: bounds.x1,\n                    y1: bounds.y1,\n                    x2: bounds.x2,\n                    y2: bounds.y2,\n                    r: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.color.r, this.mixCol.r, this.blending),\n                    g: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.color.g, this.mixCol.g, this.blending),\n                    b: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.color.b, this.mixCol.b, this.blending)\n                });\n            }\n        }\n        this.drawBuffer.forEach((item)=>{\n            this.drawDot(item);\n        });\n        this.drawBuffer = [];\n        if (this.history && this.cells.find((item)=>!!item)) {\n            this.drawCells(this.cells);\n            this.historyEntry = {\n                tool: [\n                    \"brush\",\n                    \"BlendBrush\"\n                ],\n                actions: [\n                    {\n                        action: \"drawCells\",\n                        params: [\n                            this.cells\n                        ]\n                    }\n                ]\n            };\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n        this.cells = [];\n    }\n    // --- public ----\n    constructor(){\n        this.isTesting = false // testing mode - context only gets updated when line is finished\n        ;\n        this.context = {};\n        this.color = {};\n        this.size = 29 // radius - 0.5 - 99999\n        ;\n        this.opacity = 0.6 // 0-1\n        ;\n        this.blending = 0.65 // 0-1\n        ;\n        this.settingLockLayerAlpha = false;\n        this.settingSizePressure = true;\n        this.settingOpacityPressure = false;\n        this.blendCol = {\n            r: 0,\n            g: 0,\n            b: 0,\n            a: 1\n        } // todo docs\n        ;\n        this.blendMix = 0.45 // todo docs\n        ;\n        this.mixCol = {\n            r: 0,\n            g: 0,\n            b: 0\n        } // todo docs\n        ;\n        this.localColOld = {} // todo docs\n        ;\n        this.isDrawing = false;\n        this.lastInput = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        } // todo docs\n        ;\n        this.lastInput2 = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        } // todo docs\n        ;\n        this.cells = [];\n        this.drawBuffer = [];\n    }\n}\n\n\n\n\nconst $ec1ed8bc550ccd88$var$sampleCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(32, 32);\nconst $ec1ed8bc550ccd88$var$sampleCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx($ec1ed8bc550ccd88$var$sampleCanvas);\nclass $ec1ed8bc550ccd88$export$566f9061f0f5ba33 {\n    rand() {\n        this.sketchySeed++;\n        return Math.sin(6324634.2345 * Math.cos(this.sketchySeed * 5342.3423)) * 0.5 + 0.5;\n    }\n    // ---- interface ----\n    setHistory(l) {\n        this.history = l;\n    }\n    setSeed(s) {\n        this.sketchySeed = parseInt(\"\" + s);\n    }\n    getSeed() {\n        return parseInt(\"\" + this.sketchySeed);\n    }\n    getSize() {\n        return this.settingSize / 2;\n    }\n    setColor(c) {\n        this.settingColor = c;\n    }\n    getOpacity() {\n        return this.settingOpacity;\n    }\n    setOpacity(o) {\n        this.settingOpacity = o;\n    }\n    getBlending() {\n        return this.settingBlending;\n    }\n    setBlending(b) {\n        this.settingBlending = b;\n    }\n    setSize(s) {\n        this.settingSize = s * 2;\n    }\n    getScale() {\n        return this.settingScale;\n    }\n    setScale(s) {\n        this.settingScale = s;\n    }\n    setContext(c) {\n        this.context = c;\n    }\n    startLine(x, y, pressure, shift) {\n        if (shift && this.lastInput.x) {\n            this.inputIsDrawing = true;\n            this.endLine();\n        } else {\n            this.inputIsDrawing = true;\n            this.lastX = x;\n            this.lastY = y;\n            this.lastInput.x = x;\n            this.lastInput.y = y;\n            this.historyEntry = {\n                tool: [\n                    \"brush\",\n                    \"SketchyBrush\"\n                ],\n                actions: [\n                    {\n                        action: \"setScale\",\n                        params: [\n                            this.settingScale\n                        ]\n                    },\n                    {\n                        action: \"setSize\",\n                        params: [\n                            this.settingSize / 2\n                        ]\n                    },\n                    {\n                        action: \"setOpacity\",\n                        params: [\n                            this.settingOpacity\n                        ]\n                    },\n                    {\n                        action: \"setColor\",\n                        params: [\n                            this.settingColor\n                        ]\n                    },\n                    {\n                        action: \"setBlending\",\n                        params: [\n                            this.settingBlending\n                        ]\n                    },\n                    {\n                        action: \"startLine\",\n                        params: [\n                            x,\n                            y,\n                            pressure\n                        ]\n                    }\n                ]\n            };\n        }\n    }\n    goLine(p_x, p_y, pressure, preMixedColor) {\n        if (!this.inputIsDrawing || p_x === this.lastInput.x && p_y === this.lastInput.y) return;\n        let e, b, a, g;\n        const x = parseInt(\"\" + p_x);\n        const y = parseInt(\"\" + p_y);\n        this.points.push([\n            x,\n            y\n        ]);\n        let mixr = this.settingColor.r;\n        let mixg = this.settingColor.g;\n        let mixb = this.settingColor.b;\n        if (preMixedColor) {\n            mixr = preMixedColor.r;\n            mixg = preMixedColor.g;\n            mixb = preMixedColor.b;\n        } else {\n            if (this.settingBlending !== 0) {\n                if (x + 5 >= 0 && y + 5 >= 0 && x - 5 < this.context.canvas.width - 1 && y - 5 < this.context.canvas.height - 1) {\n                    mixr = 0;\n                    mixg = 0;\n                    mixb = 0;\n                    const mixX = Math.min(this.context.canvas.width - 1, Math.max(0, x - 5));\n                    const mixY = Math.min(this.context.canvas.height - 1, Math.max(0, y - 5));\n                    let mixW = Math.min(this.context.canvas.width - 1, Math.max(0, x + 5));\n                    let mixH = Math.min(this.context.canvas.height - 1, Math.max(0, y + 5));\n                    mixW -= mixX;\n                    mixH -= mixY;\n                    if (mixW > 0 && mixH > 0) {\n                        const imDat = this.context.getImageData(mixX, mixY, mixW, mixH);\n                        let countMix = 0;\n                        for(let i = 0; i < imDat.data.length; i += 4){\n                            mixr += imDat.data[i + 0];\n                            mixg += imDat.data[i + 1];\n                            mixb += imDat.data[i + 2];\n                            countMix++;\n                        }\n                        mixr /= countMix;\n                        mixg /= countMix;\n                        mixb /= countMix;\n                    }\n                    const mixed = this.mixMode[0](new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).RGB(mixr, mixg, mixb), this.settingColor);\n                    mixr = parseInt(\"\" + (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.settingColor.r, mixed.r, this.settingBlending));\n                    mixg = parseInt(\"\" + (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.settingColor.g, mixed.g, this.settingBlending));\n                    mixb = parseInt(\"\" + (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.settingColor.b, mixed.b, this.settingBlending));\n                }\n            }\n        }\n        this.context.save();\n        this.context.strokeStyle = \"rgba(\" + mixr + \", \" + mixg + \", \" + mixb + \", \" + this.settingOpacity + \")\";\n        this.context.lineWidth = this.settingSize;\n        this.context.beginPath();\n        this.context.moveTo(this.lastX, this.lastY);\n        this.context.lineTo(x, y);\n        for(e = 0; e < this.points.length; e++){\n            b = this.points[e][0] - this.points[this.count][0];\n            a = this.points[e][1] - this.points[this.count][1];\n            g = b * b + a * a;\n            if (g < 4000 * this.settingScale * this.settingScale && this.rand() > g / 2000 / this.settingScale / this.settingScale) {\n                this.context.moveTo(this.points[this.count][0] + b * 0.3, this.points[this.count][1] + a * 0.3);\n                this.context.lineTo(this.points[e][0] - b * 0.3, this.points[e][1] - a * 0.3);\n            }\n        }\n        this.context.stroke();\n        this.context.restore();\n        this.count++;\n        this.lastX = x;\n        this.lastY = y;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.historyEntry.actions.push({\n            action: \"goLine\",\n            params: [\n                p_x,\n                p_y,\n                pressure,\n                {\n                    r: mixr,\n                    g: mixg,\n                    b: mixb\n                }\n            ]\n        });\n    }\n    endLine() {\n        this.inputIsDrawing = false;\n        this.count = 0;\n        this.points = [];\n        if (this.historyEntry) {\n            this.historyEntry.actions.push({\n                action: \"endLine\",\n                params: []\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n    }\n    //cheap 'n' ugly\n    drawLineSegment(x1, y1, x2, y2) {\n        this.lastInput.x = x2;\n        this.lastInput.y = y2;\n        if (this.inputIsDrawing || x1 === undefined) return;\n        this.context.save();\n        this.context.lineWidth = this.settingSize;\n        const mixCol = {\n            r: this.settingColor.r,\n            g: this.settingColor.g,\n            b: this.settingColor.b\n        };\n        if (x1 + 5 >= 0 && y1 + 5 >= 0 && x1 - 5 < this.context.canvas.width - 1 && y1 - 5 < this.context.canvas.height - 1) {\n            mixCol.r = 0;\n            mixCol.g = 0;\n            mixCol.b = 0;\n            const mixX = Math.min(this.context.canvas.width - 1, Math.max(0, x1 - 5));\n            const mixY = Math.min(this.context.canvas.height - 1, Math.max(0, y1 - 5));\n            let mixW = Math.min(this.context.canvas.width - 1, Math.max(0, x1 + 5));\n            let mixH = Math.min(this.context.canvas.height - 1, Math.max(0, y1 + 5));\n            mixW -= mixX;\n            mixH -= mixY;\n            if (mixW > 0 && mixH > 0) {\n                const w = Math.min($ec1ed8bc550ccd88$var$sampleCanvas.width, mixW);\n                const h = Math.min($ec1ed8bc550ccd88$var$sampleCanvas.height, mixH);\n                $ec1ed8bc550ccd88$var$sampleCtx.save();\n                $ec1ed8bc550ccd88$var$sampleCtx.globalCompositeOperation = \"copy\";\n                $ec1ed8bc550ccd88$var$sampleCtx.drawImage(this.context.canvas, mixX, mixY, mixW, mixH, 0, 0, w, h);\n                $ec1ed8bc550ccd88$var$sampleCtx.restore();\n                const imDat = $ec1ed8bc550ccd88$var$sampleCtx.getImageData(mixX, mixY, mixW, mixH);\n                let countMix = 0;\n                for(let i = 0; i < imDat.data.length; i += 4){\n                    mixCol.r += imDat.data[i + 0];\n                    mixCol.g += imDat.data[i + 1];\n                    mixCol.b += imDat.data[i + 2];\n                    countMix++;\n                }\n                mixCol.r /= countMix;\n                mixCol.g /= countMix;\n                mixCol.b /= countMix;\n            }\n        }\n        const mixed = this.mixMode[0](new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).RGB(mixCol.r, mixCol.g, mixCol.b), this.settingColor);\n        mixCol.r = parseInt(\"\" + (this.settingBlending * mixed.r + this.settingColor.r * (1 - this.settingBlending)));\n        mixCol.g = parseInt(\"\" + (this.settingBlending * mixed.g + this.settingColor.g * (1 - this.settingBlending)));\n        mixCol.b = parseInt(\"\" + (this.settingBlending * mixed.b + this.settingColor.b * (1 - this.settingBlending)));\n        this.context.strokeStyle = \"rgba(\" + mixCol.r + \", \" + mixCol.g + \", \" + mixCol.b + \", \" + this.settingOpacity + \")\";\n        this.context.beginPath();\n        this.context.moveTo(x1, y1);\n        this.context.lineTo(x2, y2);\n        this.context.stroke();\n        this.context.strokeStyle = \"rgba(\" + mixCol.r + \", \" + mixCol.g + \", \" + mixCol.b + \", \" + this.settingOpacity + \")\";\n        this.context.restore();\n        const historyEntry = {\n            tool: [\n                \"brush\",\n                \"SketchyBrush\"\n            ],\n            actions: [\n                {\n                    action: \"setScale\",\n                    params: [\n                        this.settingScale\n                    ]\n                },\n                {\n                    action: \"setSize\",\n                    params: [\n                        this.settingSize / 2\n                    ]\n                },\n                {\n                    action: \"setOpacity\",\n                    params: [\n                        this.settingOpacity\n                    ]\n                },\n                {\n                    action: \"setColor\",\n                    params: [\n                        this.settingColor\n                    ]\n                },\n                {\n                    action: \"setBlending\",\n                    params: [\n                        this.settingBlending\n                    ]\n                },\n                {\n                    action: \"drawLineSegment\",\n                    params: [\n                        x1,\n                        y1,\n                        x2,\n                        y2\n                    ]\n                }\n            ]\n        };\n        this.history.push(historyEntry);\n    }\n    isDrawing() {\n        return this.inputIsDrawing;\n    }\n    // ---- public ----\n    constructor(){\n        this.context = {};\n        this.settingColor = {};\n        this.settingSize = 1;\n        this.settingOpacity = 0.2;\n        this.settingBlending = 0.5;\n        this.settingScale = 1;\n        this.lastX = 0;\n        this.lastY = 0;\n        this.inputIsDrawing = false;\n        this.lastInput = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        };\n        this.history = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).DecoyKlHistory();\n        this.sketchySeed = 0;\n        this.points = [] // x y\n        ;\n        this.count = 0;\n        this.mixMode = [\n            (c1)=>{\n                return c1;\n            },\n            (c1, c2)=>{\n                const result = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).RGB(c1.r, c1.g, c1.b);\n                result.r *= c2.r / 255;\n                result.g *= c2.g / 255;\n                result.b *= c2.b / 255;\n                return result;\n            }\n        ];\n    }\n}\n\n\n\n\n\n\nclass $f01b5e3bd1be2f34$export$4de5ef8eecde6f12 {\n    updateDither() {\n        this.ditherCtx.clearRect(0, 0, 4, 4);\n        this.ditherCtx.fillStyle = this.settingIsEraser ? `rgb(${0, $7a2aeb795d64bafc$export$e4203cb02d5e5b28},${0, $7a2aeb795d64bafc$export$e4203cb02d5e5b28},${0, $7a2aeb795d64bafc$export$e4203cb02d5e5b28})` : this.settingColorStr;\n        for(let i = 0; i < Math.max(1, Math.round(this.settingOpacity * this.ditherArr.length)); i++)this.ditherCtx.fillRect(this.ditherArr[i][0], this.ditherArr[i][1], 1, 1);\n        this.ditherPattern = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.context.createPattern(this.ditherCanvas, \"repeat\"));\n    }\n    /**\n     * Tests p1->p2 or p3->p4 deviate in their direction more than max, compared to p1->p4\n     */ cubicCurveOverThreshold(p1, p2, p3, p4, maxAngleRad) {\n        const d = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Vec2.nor({\n            x: p4.x - p1.x,\n            y: p4.y - p1.y\n        });\n        const d2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Vec2.nor({\n            x: p2.x - p1.x,\n            y: p2.y - p1.y\n        });\n        const d3 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Vec2.nor({\n            x: p4.x - p3.x,\n            y: p4.y - p3.y\n        });\n        // const a2 = Math.abs(BB.Vec2.angle(d, d2) % Math.PI) / Math.PI * 180;\n        // const a3 = Math.abs(BB.Vec2.angle(d, d3) % Math.PI) / Math.PI * 180;\n        return Math.max((0, $d9f9f4926aa80a1c$export$921068d8846a1559).Vec2.dist(d, d2), (0, $d9f9f4926aa80a1c$export$921068d8846a1559).Vec2.dist(d, d3)) > maxAngleRad;\n    }\n    plotCubicBezierLine(p1, p2, p3, p4) {\n        const isOverThreshold = this.cubicCurveOverThreshold(p1, p2, p3, p4, 0.1);\n        p1.x = Math.floor(p1.x);\n        p1.y = Math.floor(p1.y);\n        p4.x = Math.floor(p4.x);\n        p4.y = Math.floor(p4.y);\n        const dist = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).dist(p1.x, p1.y, p4.x, p4.y);\n        if (!isOverThreshold || dist < 7) {\n            this.plotLine(p1.x, p1.y, p4.x, p4.y, true);\n            return;\n        }\n        const n = Math.max(2, Math.round(dist / 4));\n        const pointArr = [];\n        for(let i = 0; i <= n; i++){\n            const t = i / n;\n            const a = Math.pow(1 - t, 3);\n            const b = 3 * t * Math.pow(1 - t, 2);\n            const c = 3 * Math.pow(t, 2) * (1 - t);\n            const d = Math.pow(t, 3);\n            pointArr.push({\n                x: a * p1.x + b * p2.x + c * p3.x + d * p4.x,\n                y: a * p1.y + b * p2.y + c * p3.y + d * p4.y\n            });\n        }\n        for(let i = 0; i < n; i++)this.plotLine(Math.round(pointArr[i].x), Math.round(pointArr[i].y), Math.round(pointArr[i + 1].x), Math.round(pointArr[i + 1].y), true);\n    }\n    drawDot(x, y, size, opacity) {\n        this.context.save();\n        if (this.settingIsEraser) {\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : \"#fff\";\n            if (this.settingLockLayerAlpha) this.context.globalCompositeOperation = \"source-atop\";\n            else this.context.globalCompositeOperation = \"destination-out\";\n        } else {\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : this.settingColorStr;\n            if (this.settingLockLayerAlpha) this.context.globalCompositeOperation = \"source-atop\";\n        }\n        this.context.globalAlpha = this.settingUseDither ? 1 : opacity;\n        this.context.fillRect(Math.round(x + -size), Math.round(y + -size), Math.round(size * 2), Math.round(size * 2));\n        this.context.restore();\n    }\n    continueLine(x, y, size, pressure) {\n        if (this.bezierLine === null) {\n            this.bezierLine = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).BezierLine();\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, ()=>{});\n        }\n        this.context.save();\n        const dotCallback = (val)=>{\n            const localPressure = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.lastInput2.pressure, pressure, val.t);\n            const localOpacity = this.settingOpacity * (this.settingHasOpacityPressure ? localPressure * localPressure : 1);\n            const localSize = Math.max(0.5, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\n            this.drawDot(val.x, val.y, localSize, localOpacity);\n        };\n        const controlCallback = (controlObj)=>{\n            this.plotCubicBezierLine(controlObj.p1, controlObj.p2, controlObj.p3, controlObj.p4);\n        };\n        if (Math.round(this.settingSize * 2) === 1) {\n            if (x === null || y === null) this.bezierLine.addFinal(4, undefined, controlCallback);\n            else this.bezierLine.add(x, y, 4, undefined, controlCallback);\n        } else {\n            const localSpacing = size * this.settingSpacing;\n            if (x === null || y === null) this.bezierLine.addFinal(localSpacing, dotCallback);\n            else this.bezierLine.add(x, y, localSpacing, dotCallback);\n        }\n        this.context.restore();\n    }\n    /**\n     * bresenheim line drawing\n     */ plotLine(x0, y0, x1, y1, skipFirst) {\n        this.context.save();\n        if (this.settingIsEraser) {\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : \"#fff\";\n            if (this.settingLockLayerAlpha) this.context.globalCompositeOperation = \"source-atop\";\n            else this.context.globalCompositeOperation = \"destination-out\";\n        } else {\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : this.settingColorStr;\n            if (this.settingLockLayerAlpha) this.context.globalCompositeOperation = \"source-atop\";\n        }\n        this.context.globalAlpha = this.settingUseDither ? 1 : this.settingOpacity;\n        x0 = Math.floor(x0);\n        y0 = Math.floor(y0);\n        x1 = Math.floor(x1);\n        y1 = Math.floor(y1);\n        const dX = Math.abs(x1 - x0);\n        const sX = x0 < x1 ? 1 : -1;\n        const dY = -Math.abs(y1 - y0);\n        const sY = y0 < y1 ? 1 : -1;\n        let err = dX + dY;\n        // eslint-disable-next-line no-constant-condition\n        while(true){\n            if (skipFirst) skipFirst = false;\n            else this.context.fillRect(x0, y0, 1, 1);\n            if (x0 === x1 && y0 === y1) break;\n            const e2 = 2 * err;\n            if (e2 >= dY) {\n                err += dY;\n                x0 += sX;\n            }\n            if (e2 <= dX) {\n                err += dX;\n                y0 += sY;\n            }\n        }\n        this.context.restore();\n    }\n    // ---- interface ----\n    startLine(x, y, p) {\n        this.historyEntry = {\n            tool: [\n                \"brush\",\n                \"PixelBrush\"\n            ],\n            actions: [\n                {\n                    action: \"sizePressure\",\n                    params: [\n                        this.settingHasSizePressure\n                    ]\n                },\n                {\n                    action: \"opacityPressure\",\n                    params: [\n                        this.settingHasOpacityPressure\n                    ]\n                },\n                {\n                    action: \"setSize\",\n                    params: [\n                        this.settingSize\n                    ]\n                },\n                {\n                    action: \"setSpacing\",\n                    params: [\n                        this.settingSpacing\n                    ]\n                },\n                {\n                    action: \"setOpacity\",\n                    params: [\n                        this.settingOpacity\n                    ]\n                },\n                {\n                    action: \"setColor\",\n                    params: [\n                        this.settingColor\n                    ]\n                },\n                {\n                    action: \"setLockAlpha\",\n                    params: [\n                        this.settingLockLayerAlpha\n                    ]\n                },\n                {\n                    action: \"setIsEraser\",\n                    params: [\n                        this.settingIsEraser\n                    ]\n                },\n                {\n                    action: \"setUseDither\",\n                    params: [\n                        this.settingUseDither\n                    ]\n                }\n            ]\n        };\n        if (this.settingUseDither) this.updateDither();\n        p = Math.max(0, Math.min(1, p));\n        const localOpacity = this.settingHasOpacityPressure ? this.settingOpacity * p * p : this.settingOpacity;\n        const localSize = this.settingHasSizePressure ? Math.max(0.5, p * this.settingSize) : Math.max(0.5, this.settingSize);\n        this.inputIsDrawing = true;\n        this.drawDot(x, y, localSize, localOpacity);\n        this.lineToolLastDot = localSize * this.settingSpacing;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(this.lastInput);\n        this.historyEntry.actions.push({\n            action: \"startLine\",\n            params: [\n                x,\n                y,\n                p\n            ]\n        });\n    }\n    goLine(x, y, p) {\n        if (!this.inputIsDrawing) return;\n        this.historyEntry.actions.push({\n            action: \"goLine\",\n            params: [\n                x,\n                y,\n                p\n            ]\n        });\n        //debug\n        //drawDot(x, y, 1, 0.5);\n        const pressure = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(p, 0, 1);\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\n        this.lastInput2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(this.lastInput);\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = pressure;\n    }\n    endLine(x, y) {\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\n        //debug\n        //drawDot(lastInput.x, lastInput.y, 3, 1);\n        //drawDot(x, y, 10, 0.1);\n        this.inputIsDrawing = false;\n        this.bezierLine = null;\n        if (this.historyEntry) {\n            this.historyEntry.actions.push({\n                action: \"endLine\",\n                params: [\n                    x,\n                    y\n                ]\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n    }\n    //cheap n' ugly\n    drawLineSegment(x1, y1, x2, y2) {\n        this.lastInput.x = x2;\n        this.lastInput.y = y2;\n        this.lastInput.pressure = 1;\n        if (this.inputIsDrawing || x1 === undefined) return;\n        if (this.settingUseDither) this.updateDither();\n        if (Math.round(this.settingSize * 2) === 1) this.plotLine(x1, y1, x2, y2, true);\n        else {\n            // const angle = BB.pointsToAngleDeg({x: x1, y: y1}, {x: x2, y: y2});\n            const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n            const eX = (x2 - x1) / mouseDist;\n            const eY = (y2 - y1) / mouseDist;\n            let loopDist;\n            const bdist = this.settingSize * this.settingSpacing;\n            this.lineToolLastDot = this.settingSize * this.settingSpacing;\n            for(loopDist = this.lineToolLastDot; loopDist <= mouseDist; loopDist += bdist)this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.settingSize, this.settingOpacity);\n        }\n        const historyEntry = {\n            tool: [\n                \"brush\",\n                \"PixelBrush\"\n            ],\n            actions: [\n                {\n                    action: \"sizePressure\",\n                    params: [\n                        this.settingHasSizePressure\n                    ]\n                },\n                {\n                    action: \"opacityPressure\",\n                    params: [\n                        this.settingHasOpacityPressure\n                    ]\n                },\n                {\n                    action: \"setSize\",\n                    params: [\n                        this.settingSize\n                    ]\n                },\n                {\n                    action: \"setSpacing\",\n                    params: [\n                        this.settingSpacing\n                    ]\n                },\n                {\n                    action: \"setOpacity\",\n                    params: [\n                        this.settingOpacity\n                    ]\n                },\n                {\n                    action: \"setColor\",\n                    params: [\n                        this.settingColor\n                    ]\n                },\n                {\n                    action: \"setLockAlpha\",\n                    params: [\n                        this.settingLockLayerAlpha\n                    ]\n                },\n                {\n                    action: \"setIsEraser\",\n                    params: [\n                        this.settingIsEraser\n                    ]\n                },\n                {\n                    action: \"setUseDither\",\n                    params: [\n                        this.settingUseDither\n                    ]\n                },\n                {\n                    action: \"drawLineSegment\",\n                    params: [\n                        x1,\n                        y1,\n                        x2,\n                        y2\n                    ]\n                }\n            ]\n        };\n        this.history.push(historyEntry);\n    }\n    //IS\n    isDrawing() {\n        return this.inputIsDrawing;\n    }\n    //SET\n    setColor(c) {\n        if (this.settingColor === c) return;\n        this.settingColor = c;\n        this.settingColorStr = \"rgb(\" + this.settingColor.r + \",\" + this.settingColor.g + \",\" + this.settingColor.b + \")\";\n    }\n    setContext(c) {\n        this.context = c;\n    }\n    setHistory(l) {\n        this.history = l;\n    }\n    setSize(s) {\n        this.settingSize = Math.round(s * 2) / 2;\n    }\n    setOpacity(o) {\n        this.settingOpacity = o;\n    }\n    setSpacing(s) {\n        this.settingSpacing = s;\n    }\n    sizePressure(b) {\n        this.settingHasSizePressure = b;\n    }\n    opacityPressure(b) {\n        this.settingHasOpacityPressure = b;\n    }\n    setLockAlpha(b) {\n        this.settingLockLayerAlpha = b;\n    }\n    setIsEraser(b) {\n        this.settingIsEraser = b;\n    }\n    setUseDither(b) {\n        this.settingUseDither = b;\n    }\n    //GET\n    getSpacing() {\n        return this.settingSpacing;\n    }\n    getSize() {\n        return this.settingSize;\n    }\n    getOpacity() {\n        return this.settingOpacity;\n    }\n    getLockAlpha() {\n        return this.settingLockLayerAlpha;\n    }\n    getIsEraser() {\n        return this.settingIsEraser;\n    }\n    getUseDither() {\n        return this.settingUseDither;\n    }\n    // ---- public ----\n    constructor(){\n        this.history = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).DecoyKlHistory();\n        this.context = {};\n        this.settingHasSizePressure = true;\n        this.settingHasOpacityPressure = false;\n        this.settingSize = 0.5;\n        this.settingSpacing = 0.9;\n        this.settingOpacity = 1;\n        this.settingColor = {};\n        this.settingColorStr = \"\";\n        this.settingLockLayerAlpha = false;\n        this.settingIsEraser = false;\n        this.settingUseDither = true;\n        this.inputIsDrawing = false;\n        this.lineToolLastDot = 0;\n        this.lastInput = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        };\n        this.lastInput2 = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        };\n        this.bezierLine = null;\n        this.ditherArr = [\n            [\n                3,\n                2\n            ],\n            [\n                1,\n                0\n            ],\n            [\n                3,\n                0\n            ],\n            [\n                1,\n                2\n            ],\n            [\n                2,\n                1\n            ],\n            [\n                0,\n                3\n            ],\n            [\n                0,\n                1\n            ],\n            [\n                2,\n                3\n            ],\n            [\n                2,\n                0\n            ],\n            [\n                0,\n                2\n            ],\n            [\n                0,\n                0\n            ],\n            [\n                2,\n                2\n            ],\n            [\n                1,\n                1\n            ],\n            [\n                3,\n                3\n            ],\n            [\n                3,\n                1\n            ],\n            [\n                1,\n                3\n            ]\n        ];\n        this.ditherPattern = {};\n        this.ditherCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(4, 4);\n        this.ditherCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.ditherCanvas);\n    }\n}\n\n\n\n\n\nclass $6debbe598e970932$export$fe52c90afd1cf5ba {\n    drawDot(x, y, size, opacity) {\n        this.context.save();\n        if (this.isBaseLayer) {\n            if (this.isTransparentBG) this.context.globalCompositeOperation = \"destination-out\";\n            else this.context.globalCompositeOperation = \"source-atop\";\n        } else this.context.globalCompositeOperation = \"destination-out\";\n        const radgrad = this.context.createRadialGradient(size, size, 0, size, size, size);\n        let sharpness = Math.pow(opacity, 2);\n        sharpness = Math.max(0, Math.min((size - 1) / size, sharpness));\n        const oFac = Math.max(0, Math.min(1, opacity));\n        const localOpacity = 2 * oFac - oFac * oFac;\n        radgrad.addColorStop(sharpness, `rgba(${(0, $7a2aeb795d64bafc$export$e4203cb02d5e5b28)}, ${(0, $7a2aeb795d64bafc$export$e4203cb02d5e5b28)}, ${(0, $7a2aeb795d64bafc$export$e4203cb02d5e5b28)}, ` + localOpacity + \")\");\n        radgrad.addColorStop(1, `rgba(${(0, $7a2aeb795d64bafc$export$e4203cb02d5e5b28)}, ${(0, $7a2aeb795d64bafc$export$e4203cb02d5e5b28)}, ${(0, $7a2aeb795d64bafc$export$e4203cb02d5e5b28)}, 0)`);\n        this.context.fillStyle = radgrad;\n        this.context.translate(x - size, y - size);\n        this.context.fillRect(0, 0, size * 2, size * 2);\n        this.context.restore();\n    }\n    continueLine(x, y, p) {\n        p = Math.max(0, Math.min(1, p));\n        let localPressure;\n        let localOpacity;\n        let localSize = this.useSizePressure ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\n        const bdist = Math.max(1, Math.max(0.5, 1 - this.opacity) * localSize * this.spacing);\n        const bezierCallback = (val)=>{\n            const factor = val.t;\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\n            localOpacity = this.useOpacityPressure ? this.opacity * localPressure * localPressure : this.opacity;\n            localSize = this.useSizePressure ? Math.max(0.1, localPressure * this.size) : Math.max(0.1, this.size);\n            this.drawDot(val.x, val.y, localSize, localOpacity);\n        };\n        if (x === undefined || y === undefined) this.bezierLine.addFinal(bdist, bezierCallback);\n        else this.bezierLine.add(x, y, bdist, bezierCallback);\n    }\n    // ---- interface ----\n    startLine(x, y, p) {\n        this.historyEntry = {\n            tool: [\n                \"brush\",\n                \"EraserBrush\"\n            ],\n            actions: [\n                {\n                    action: \"opacityPressure\",\n                    params: [\n                        this.useOpacityPressure\n                    ]\n                },\n                {\n                    action: \"sizePressure\",\n                    params: [\n                        this.useSizePressure\n                    ]\n                },\n                {\n                    action: \"setSize\",\n                    params: [\n                        this.size\n                    ]\n                },\n                {\n                    action: \"setOpacity\",\n                    params: [\n                        this.opacity\n                    ]\n                },\n                {\n                    action: \"setTransparentBG\",\n                    params: [\n                        this.isTransparentBG\n                    ]\n                },\n                {\n                    action: \"startLine\",\n                    params: [\n                        x,\n                        y,\n                        p\n                    ]\n                }\n            ]\n        };\n        this.isBaseLayer = 0 === this.context.canvas.index;\n        p = Math.max(0, Math.min(1, p));\n        const localOpacity = this.useOpacityPressure ? this.opacity * p * p : this.opacity;\n        const localSize = this.useSizePressure ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\n        this.started = true;\n        if (localSize > 1) this.drawDot(x, y, localSize, localOpacity);\n        this.lastDot = localSize * this.spacing;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(this.lastInput);\n        this.bezierLine = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).BezierLine();\n        this.bezierLine.add(x, y, 0, ()=>undefined);\n    }\n    goLine(x, y, p) {\n        var _this_historyEntry_actions;\n        if (!this.started || !this.historyEntry) return;\n        (_this_historyEntry_actions = this.historyEntry.actions) === null || _this_historyEntry_actions === void 0 ? void 0 : _this_historyEntry_actions.push({\n            action: \"goLine\",\n            params: [\n                x,\n                y,\n                p\n            ]\n        });\n        this.continueLine(x, y, this.lastInput.pressure);\n        this.lastInput2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(this.lastInput);\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n    }\n    endLine() {\n        if (this.bezierLine) this.continueLine(undefined, undefined, this.lastInput.pressure);\n        this.started = false;\n        this.bezierLine = undefined;\n        if (this.historyEntry) {\n            var _this_historyEntry_actions;\n            (_this_historyEntry_actions = this.historyEntry.actions) === null || _this_historyEntry_actions === void 0 ? void 0 : _this_historyEntry_actions.push({\n                action: \"endLine\",\n                params: []\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n    }\n    drawLineSegment(x1, y1, x2, y2) {\n        this.isBaseLayer = 0 === this.context.canvas.index;\n        this.lastInput.x = x2;\n        this.lastInput.y = y2;\n        if (this.started || x1 === undefined) return;\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        const eX = (x2 - x1) / mouseDist;\n        const eY = (y2 - y1) / mouseDist;\n        let loopDist;\n        const bdist = Math.max(1, Math.max(0.5, 1 - this.opacity) * this.size * this.spacing);\n        this.lastDot = 0;\n        for(loopDist = this.lastDot; loopDist <= mouseDist; loopDist += bdist)this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.size, this.opacity);\n        const historyEntry = {\n            tool: [\n                \"brush\",\n                \"EraserBrush\"\n            ],\n            actions: [\n                {\n                    action: \"opacityPressure\",\n                    params: [\n                        this.useOpacityPressure\n                    ]\n                },\n                {\n                    action: \"sizePressure\",\n                    params: [\n                        this.useSizePressure\n                    ]\n                },\n                {\n                    action: \"setSize\",\n                    params: [\n                        this.size\n                    ]\n                },\n                {\n                    action: \"setOpacity\",\n                    params: [\n                        this.opacity\n                    ]\n                },\n                {\n                    action: \"setTransparentBG\",\n                    params: [\n                        this.isTransparentBG\n                    ]\n                },\n                {\n                    action: \"drawLineSegment\",\n                    params: [\n                        x1,\n                        y1,\n                        x2,\n                        y2\n                    ]\n                }\n            ]\n        };\n        this.history.push(historyEntry);\n    }\n    //IS\n    isDrawing() {\n        return this.started;\n    }\n    //SET\n    setContext(c) {\n        this.context = c;\n    }\n    setHistory(l) {\n        this.history = l;\n    }\n    setSize(s) {\n        this.size = s;\n    }\n    setOpacity(o) {\n        this.opacity = o;\n    }\n    sizePressure(b) {\n        this.useSizePressure = b;\n    }\n    opacityPressure(b) {\n        this.useOpacityPressure = b;\n    }\n    setTransparentBG(b) {\n        this.isTransparentBG = b;\n    }\n    //GET\n    getSize() {\n        return this.size;\n    }\n    getOpacity() {\n        return this.opacity;\n    }\n    // ---- public -----\n    constructor(){\n        this.size = 30;\n        this.spacing = 0.4;\n        this.opacity = 1;\n        this.useSizePressure = true;\n        this.useOpacityPressure = false;\n        this.isTransparentBG = false;\n        this.history = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).DecoyKlHistory();\n        this.isBaseLayer = false;\n        this.context = {};\n        this.started = false;\n        this.lastInput = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        };\n        this.lastInput2 = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        };\n    }\n}\n\n\n\n\n\n// let statCount = 1;\n// let statAcc = 0;\n// stats on win10, chrome, size 100, opacity 80, smudge()\n// unoptimized: 1 ms\n// minimal: 0.09 ms\n// minimal + circle: 0.5ms\n// minimal + circle + ix, iy: 0.23ms\n// unoptimized + ix, iy: 0.64 ms\n// unoptimized + ix, iy + sans rounding: 0.61 ms\n// ix, iy + sans rounding + sans random: 0.32ms\n// ix, iy + sans rounding + fast random: 0.46 ms\n// ix, iy + sans rounding + fast random + offset const: 0.48 ms\nconst $baef4a032d46c3b8$var$CELL_SIZE = 256;\n/**\n * determine bounds of smudge\n * @param imWidth\n * @param imHeight\n * @param aP\n * @param bP\n * @param size\n */ function $baef4a032d46c3b8$var$prepSmudge(imWidth, imHeight, aP, bP, size) {\n    if (aP.x === bP.x && aP.y === bP.y) return null;\n    aP = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(aP);\n    bP = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(bP);\n    size = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(size);\n    // corner behavior\n    // cut down rectangles, if a or b go outside\n    // i.e. if user drags partially or fully outside the canvas\n    {\n        let top = 0;\n        let right = 0;\n        let bottom = 0;\n        let left = 0;\n        if (aP.x < 0) left = -aP.x;\n        if (aP.y < 0) top = -aP.y;\n        if (bP.x < 0) left = Math.max(left, -bP.x);\n        if (bP.y < 0) top = Math.max(top, -bP.y);\n        if (aP.x + size.w > imWidth) right = aP.x + size.w - imWidth;\n        if (aP.y + size.h > imHeight) bottom = aP.y + size.h - imHeight;\n        if (bP.x + size.w > imWidth) right = Math.max(right, bP.x + size.w - imWidth);\n        if (bP.y + size.h > imHeight) bottom = Math.max(bottom, bP.y + size.h - imHeight);\n        aP.x += left;\n        bP.x += left;\n        aP.y += top;\n        bP.y += top;\n        size.w = size.w - left - right;\n        size.h = size.h - top - bottom;\n        if (size.w <= 0 || size.h <= 0) return null;\n    }\n    return {\n        aP: {\n            x: aP.x,\n            y: aP.y\n        },\n        bP: {\n            x: bP.x,\n            y: bP.y\n        },\n        size: {\n            w: size.w,\n            h: size.h\n        }\n    };\n}\n/**\n * Pixel operations that do the smudging via ImageData\n * @param imageData\n * @param p\n */ function $baef4a032d46c3b8$var$smudge(imageData, p) {\n    p = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(p);\n    const cSize = p.brush.size;\n    const cX = p.brush.center.x;\n    const cY = p.brush.center.y;\n    /*if (statCount % 1000 === 0) {\n        console.log(statAcc / 1000);\n        statAcc = 0;\n    }\n    let start = performance.now();*/ // determine offset\n    const aIndex = p.aP.y * imageData.width + p.aP.x;\n    const bIndex = p.bP.y * imageData.width + p.bP.x;\n    const offset = (bIndex - aIndex) * 4;\n    // array with random numbers. faster than Math.random()\n    let randI = 0;\n    const randLen = cSize > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\n    const randArr = [];\n    for(let i = 0; i < randLen; i++)randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\n    const softnessPx = Math.max(3, Math.min(8, p.brush.size - 8));\n    const pixel = (ai, bi, ix, iy)=>{\n        const dist = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).dist(cX, cY, ix, iy);\n        const fac = 1 - p.brush.opacity * (1 - (0, $9414f5ea41e9cf25$export$7d15b64cf5a3a4c4)((dist - (cSize - softnessPx)) / softnessPx, 0, 1));\n        if (fac === 1) return;\n        if (!imageData.data[ai + 3]) ;\n        else if (!imageData.data[bi + 3]) {\n            imageData.data[bi] = imageData.data[ai];\n            imageData.data[bi + 1] = imageData.data[ai + 1];\n            imageData.data[bi + 2] = imageData.data[ai + 2];\n        } else {\n            // consider alpha ratio. If a has lower alpha than b, then b should be stronger, and vice versa\n            // not totally accurate. TODO same compositing as blend brush\n            let fac2;\n            if (imageData.data[ai + 3] < imageData.data[bi + 3]) fac2 = 1 - imageData.data[ai + 3] / imageData.data[bi + 3] * (1 - fac);\n            else fac2 = imageData.data[bi + 3] / imageData.data[ai + 3] * fac;\n            // ImageData's Uint8ClampedArray rounds -> 0.5 becomes 1. But not in Safari, so needs to be done manually\n            // Offset mixed color by random number noise (-0.5, 0.5), so it doesn't get stuck while mixing.\n            // No +0.5, because it cancels out with rand.\n            imageData.data[bi] = Math.floor((0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(imageData.data[ai], imageData.data[bi + 0], fac2) + randArr[randI]);\n            imageData.data[bi + 1] = Math.floor((0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(imageData.data[ai + 1], imageData.data[bi + 1], fac2) + randArr[randI]);\n            imageData.data[bi + 2] = Math.floor((0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(imageData.data[ai + 2], imageData.data[bi + 2], fac2) + randArr[randI]);\n            randI = (randI + 1) % randLen;\n        }\n        // Always mix alpha. unless alpha lock\n        if (!p.brush.alphaLock) imageData.data[bi + 3] = Math.floor((0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(imageData.data[ai + 3], imageData.data[bi + 3], fac) + 0.5);\n    };\n    const bx1 = p.bP.x * 4;\n    const bx2 = bx1 + (p.size.w - 1) * 4;\n    // transfer of pixels depends on direction of smudging if there is overlap\n    if (p.aP.y < p.bP.y) for(let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--){\n        const yStart = (y + p.bP.y) * imageData.width * 4;\n        for(let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--)pixel(x2, x, ix, iy);\n    }\n    else if (p.aP.y > p.bP.y) for(let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++){\n        const yStart = (y + p.bP.y) * imageData.width * 4;\n        for(let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--)pixel(x2, x, ix, iy);\n    }\n    else {\n        if (p.aP.x < p.bP.x) for(let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--){\n            const yStart = (y + p.bP.y) * imageData.width * 4;\n            for(let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--)pixel(x2, x, ix, iy);\n        }\n        else for(let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++){\n            const yStart = (y + p.bP.y) * imageData.width * 4;\n            for(let x = bx1 + yStart, x2 = bx1 + yStart - offset, ix = p.bP.x; x < bx2 + yStart; x += 4, x2 += 4, ix++)pixel(x2, x, ix, iy);\n        }\n    }\n//statCount++;\n//statAcc += performance.now() - start;\n}\nclass $baef4a032d46c3b8$export$c9f800961903deab {\n    // workaround for https://github.com/microsoft/TypeScript/issues/41654\n    resetRedrawBounds() {\n        this.redrawBounds = undefined;\n    }\n    updateRedrawBounds(bounds) {\n        this.redrawBounds = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).updateBounds(this.redrawBounds, bounds);\n    }\n    updateCompleteRedrawBounds(x1, y1, x2, y2) {\n        this.completeRedrawBounds = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).updateBounds(this.completeRedrawBounds, {\n            x1: x1,\n            y1: y1,\n            x2: x2,\n            y2: y2\n        });\n    }\n    /**\n     * update copyImageData. copy over new regions if needed\n     */ copyFromCanvas() {\n        const touchedCells = this.copiedCells.map(()=>false);\n        const bounds = [];\n        const cellsW = Math.ceil(this.copyImageData.width / $baef4a032d46c3b8$var$CELL_SIZE);\n        if (!this.redrawBounds) return;\n        bounds.push({\n            x1: Math.floor(this.redrawBounds.x1 / $baef4a032d46c3b8$var$CELL_SIZE),\n            y1: Math.floor(this.redrawBounds.y1 / $baef4a032d46c3b8$var$CELL_SIZE),\n            x2: Math.floor(this.redrawBounds.x2 / $baef4a032d46c3b8$var$CELL_SIZE),\n            y2: Math.floor(this.redrawBounds.y2 / $baef4a032d46c3b8$var$CELL_SIZE)\n        });\n        bounds.forEach((item)=>{\n            for(let i = item.x1; i <= item.x2; i++)for(let e = item.y1; e <= item.y2; e++)touchedCells[e * cellsW + i] = true;\n        });\n        touchedCells.forEach((item, i)=>{\n            if (!item || this.copiedCells[i]) // not touched, or already copied\n            return;\n            this.copiedCells[i] = true;\n            const x = i % cellsW;\n            const y = Math.floor(i / cellsW);\n            const w = (Math.min(x * $baef4a032d46c3b8$var$CELL_SIZE + $baef4a032d46c3b8$var$CELL_SIZE, this.copyImageData.width) - 1) % $baef4a032d46c3b8$var$CELL_SIZE + 1;\n            const h = (Math.min(y * $baef4a032d46c3b8$var$CELL_SIZE + $baef4a032d46c3b8$var$CELL_SIZE, this.copyImageData.height) - 1) % $baef4a032d46c3b8$var$CELL_SIZE + 1;\n            // temp canvas to prevent main canvas from getting slowed down in chrome\n            const tmpCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(w, h);\n            const tmpCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(tmpCanvas);\n            tmpCtx.drawImage(this.context.canvas, -x * $baef4a032d46c3b8$var$CELL_SIZE, -y * $baef4a032d46c3b8$var$CELL_SIZE);\n            const data = tmpCtx.getImageData(0, 0, w, h);\n            for(let i = 0; i < h; i++)for(let e = 0, e2 = i * w * 4, e3 = ((y * $baef4a032d46c3b8$var$CELL_SIZE + i) * this.copyImageData.width + x * $baef4a032d46c3b8$var$CELL_SIZE) * 4; e < w; e++, e2 += 4, e3 += 4){\n                this.copyImageData.data[e3] = data.data[e2];\n                this.copyImageData.data[e3 + 1] = data.data[e2 + 1];\n                this.copyImageData.data[e3 + 2] = data.data[e2 + 2];\n                this.copyImageData.data[e3 + 3] = data.data[e2 + 3];\n            }\n        });\n    }\n    /**\n     * fill drawBuffer with params about to be drawn\n     * @param x\n     * @param y\n     * @param size\n     * @param opacity\n     */ prepDot(x, y, size, opacity) {\n        if (!this.lastDot) {\n            this.lastDot = {\n                x: x,\n                y: y\n            };\n            return;\n        }\n        size = Math.round(size);\n        const w = Math.round(size * 2);\n        const h = Math.round(size * 2);\n        const bounds = $baef4a032d46c3b8$var$prepSmudge(this.copyImageData.width, this.copyImageData.height, {\n            x: Math.round(this.lastDot.x - size),\n            y: Math.round(this.lastDot.y - size)\n        }, {\n            x: Math.round(x - size),\n            y: Math.round(y - size)\n        }, {\n            w: w,\n            h: h\n        });\n        if (bounds) {\n            const params = {\n                aP: bounds.aP,\n                bP: bounds.bP,\n                size: bounds.size,\n                brush: {\n                    center: {\n                        x: x,\n                        y: y\n                    },\n                    size: size,\n                    opacity: opacity,\n                    alphaLock: this.settingLockLayerAlpha\n                }\n            };\n            this.updateRedrawBounds({\n                x1: params.bP.x,\n                y1: params.bP.y,\n                x2: params.bP.x + params.brush.size * 2,\n                y2: params.bP.y + params.brush.size * 2\n            });\n            this.drawBuffer.push(params);\n        }\n        this.lastDot = {\n            x: x,\n            y: y\n        };\n    }\n    continueLine(x, y, size, pressure) {\n        this.drawBuffer = [];\n        if (!this.bezierLine) {\n            this.bezierLine = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).BezierLine();\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, function() {});\n        }\n        const drawArr = []; //draw instructions. will be all drawn at once\n        const dotCallback = (val)=>{\n            const localPressure = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(this.lastInput2.pressure, pressure, val.t);\n            const localOpacity = this.settingOpacity * (this.settingHasOpacityPressure ? localPressure * localPressure : 1);\n            const localSize = Math.max(0.1, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\n            drawArr.push([\n                val.x,\n                val.y,\n                localSize,\n                localOpacity\n            ]); //, val.angle]);\n        };\n        const localSpacing = size * this.settingSpacing / 3;\n        if (x === undefined || y === undefined) this.bezierLine.addFinal(localSpacing, dotCallback);\n        else this.bezierLine.add(x, y, localSpacing, dotCallback);\n        // execute draw instructions\n        for(let i = 0; i < drawArr.length; i++){\n            const item = drawArr[i];\n            this.prepDot(item[0], item[1], item[2], item[3]);\n        }\n        this.copyFromCanvas();\n        for(let i = 0; i < this.drawBuffer.length; i++)$baef4a032d46c3b8$var$smudge(this.copyImageData, this.drawBuffer[i]);\n    }\n    startLine(x, y, p) {\n        this.historyEntry = {\n            tool: [\n                \"brush\",\n                \"SmudgeBrush\"\n            ],\n            actions: []\n        };\n        p = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(p, 0, 1);\n        const localOpacity = this.settingHasOpacityPressure ? this.settingOpacity * p * p : this.settingOpacity;\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\n        this.lastDot = undefined;\n        this.isDrawing = true;\n        this.copyImageData = new ImageData(this.context.canvas.width, this.context.canvas.height);\n        const totalCells = Math.ceil(this.context.canvas.width / $baef4a032d46c3b8$var$CELL_SIZE) * Math.ceil(this.context.canvas.height / $baef4a032d46c3b8$var$CELL_SIZE);\n        this.copiedCells = \"0\".repeat(totalCells).split(\"\").map(()=>false);\n        this.prepDot(x, y, localSize, localOpacity);\n        this.lineToolLastDot = localSize * this.settingSpacing;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2.pressure = p;\n        this.completeRedrawBounds = undefined;\n    }\n    goLine(x, y, p) {\n        if (!this.isDrawing) return;\n        this.resetRedrawBounds();\n        const pressure = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(p, 0, 1);\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\n        if (this.redrawBounds) {\n            this.context.putImageData(this.copyImageData, 0, 0, this.redrawBounds.x1, this.redrawBounds.y1, this.redrawBounds.x2 - this.redrawBounds.x1 - 1, this.redrawBounds.y2 - this.redrawBounds.y1 - 1);\n            this.updateCompleteRedrawBounds(this.redrawBounds.x1, this.redrawBounds.y1, this.redrawBounds.x2, this.redrawBounds.y2);\n        }\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput2.pressure = this.lastInput.pressure;\n        this.lastInput.pressure = pressure;\n    }\n    endLine() {\n        this.resetRedrawBounds();\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n        this.context.save();\n        this.continueLine(undefined, undefined, localSize, this.lastInput.pressure);\n        this.context.restore();\n        this.isDrawing = false;\n        this.bezierLine = undefined;\n        if (this.redrawBounds) {\n            this.context.putImageData(this.copyImageData, 0, 0, this.redrawBounds.x1, this.redrawBounds.y1, this.redrawBounds.x2 - this.redrawBounds.x1 - 1, this.redrawBounds.y2 - this.redrawBounds.y1 - 1);\n            this.updateCompleteRedrawBounds(this.redrawBounds.x1, this.redrawBounds.y1, this.redrawBounds.x2, this.redrawBounds.y2);\n        }\n        if (this.historyEntry && this.completeRedrawBounds) {\n            let historyIm = this.copyImageData;\n            if (!(this.completeRedrawBounds.x1 === 0 && this.completeRedrawBounds.y1 === 0 && this.completeRedrawBounds.x2 >= this.context.canvas.width - 1 && this.completeRedrawBounds.y2 >= this.context.canvas.height - 1)) {\n                // temp canvas to prevent main canvas from getting slowed down in chrome\n                const tmpCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1, this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1);\n                const tmpCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(tmpCanvas);\n                tmpCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\n                historyIm = tmpCanvas; // faster than getting image data (measured on 2018 lenovo chromebook)\n            }\n            this.historyEntry.actions.push({\n                action: \"drawImage\",\n                params: [\n                    historyIm,\n                    this.completeRedrawBounds.x1,\n                    this.completeRedrawBounds.y1\n                ]\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n        this.copyImageData = {};\n    }\n    drawImage(im, x, y) {\n        if (im instanceof ImageData) this.context.putImageData(im, x, y);\n        else {\n            this.context.clearRect(x, y, im.width, im.height);\n            this.context.drawImage(im, x, y);\n        }\n    }\n    drawLineSegment(x1, y1, x2, y2) {\n        return;\n    /*\n        // todo\n        lastInput.x = x2;\n        lastInput.y = y2;\n        lastInput.pressure = 1;\n\n        if (isDrawing || x1 === undefined) {\n            return;\n        }\n\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        let eX = (x2 - x1) / mouseDist;\n        let eY = (y2 - y1) / mouseDist;\n        let loopDist;\n        let bdist = settingSize * settingSpacing;\n        lineToolLastDot = settingSize * settingSpacing;\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity);\n        }\n\n\n        let historyEntry = {\n            tool: [\"brush\", \"SmudgeBrush\"],\n            actions: []\n        };\n        // todo\n        history.add(historyEntry);*/ }\n    getIsDrawing() {\n        return this.isDrawing;\n    }\n    setColor(c) {\n        if (this.settingColor.r === c.r && this.settingColor.g === c.g && this.settingColor.b === c.b) return;\n        this.settingColor = {\n            r: c.r,\n            g: c.g,\n            b: c.b\n        };\n    }\n    setContext(c) {\n        this.context = c;\n    }\n    setHistory(h) {\n        this.history = h;\n    }\n    setSize(s) {\n        this.settingSize = s;\n    }\n    setOpacity(o) {\n        this.settingOpacity = o;\n    }\n    setSpacing(s) {\n        this.settingSpacing = s;\n    }\n    sizePressure(b) {\n        this.settingHasSizePressure = b;\n    }\n    opacityPressure(b) {\n        this.settingHasOpacityPressure = b;\n    }\n    setLockAlpha(b) {\n        this.settingLockLayerAlpha = b;\n    }\n    getSpacing() {\n        return this.settingSpacing;\n    }\n    getSize() {\n        return this.settingSize;\n    }\n    getOpacity() {\n        return this.settingOpacity;\n    }\n    getLockAlpha() {\n        return this.settingLockLayerAlpha;\n    }\n    // ---- public ----\n    constructor(){\n        this.context = {};\n        this.history = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).DecoyKlHistory();\n        this.settingColor = {\n            r: 0,\n            g: 0,\n            b: 0\n        };\n        this.settingSize = 35;\n        this.settingSpacing = 0.20446882736951905;\n        this.settingOpacity = 0.8;\n        this.settingHasSizePressure = false;\n        this.settingHasOpacityPressure = false;\n        this.settingLockLayerAlpha = false;\n        this.lineToolLastDot = 0;\n        this.lastInput = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        };\n        this.lastInput2 = {\n            x: 0,\n            y: 0,\n            pressure: 0\n        };\n        this.isDrawing = false;\n        this.copyImageData = {};\n        this.drawBuffer = [];\n        this.copiedCells = [];\n    }\n}\n\n\n\n\n\nclass $458de7145dc8d2d0$export$38b08aa4ea8f61c6 {\n    updateCompleteRedrawBounds(x, y) {\n        let bounds = {\n            x1: x,\n            y1: y,\n            x2: x,\n            y2: y\n        };\n        if (this.settingXSymmetry) bounds = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).updateBounds(bounds, {\n            x1: -x + this.copyCanvas.width,\n            y1: y,\n            x2: -x + this.copyCanvas.width,\n            y2: y\n        });\n        if (this.settingYSymmetry) bounds = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).updateBounds(bounds, {\n            x1: x,\n            y1: -y + this.copyCanvas.height,\n            x2: x,\n            y2: -y + this.copyCanvas.height\n        });\n        const buffer = this.settingMode === \"stroke\" ? this.settingSize + 1 : 1;\n        bounds.x1 = Math.floor(bounds.x1 - buffer);\n        bounds.y1 = Math.floor(bounds.y1 - buffer);\n        bounds.x2 = Math.ceil(bounds.x2 + buffer);\n        bounds.y2 = Math.ceil(bounds.y2 + buffer);\n        this.completeRedrawBounds = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).updateBounds(this.completeRedrawBounds, bounds);\n    }\n    drawShape() {\n        this.context.save();\n        this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\n        this.context.drawImage(this.copyCanvas, 0, 0);\n        const color = {\n            ...this.settingColor\n        };\n        if (this.settingIsEraser) {\n            color.r = (0, $7a2aeb795d64bafc$export$e4203cb02d5e5b28);\n            color.g = (0, $7a2aeb795d64bafc$export$e4203cb02d5e5b28);\n            color.b = (0, $7a2aeb795d64bafc$export$e4203cb02d5e5b28);\n            if (this.settingLockLayerAlpha) this.context.globalCompositeOperation = \"source-atop\";\n            else this.context.globalCompositeOperation = \"destination-out\";\n        } else if (this.settingLockLayerAlpha) this.context.globalCompositeOperation = \"source-atop\";\n        if (this.path.length > 1) {\n            // path\n            const path = new Path2D();\n            this.path.forEach((item, index)=>{\n                if (index === 0) path.moveTo(item.x, item.y);\n                else path.lineTo(item.x, item.y);\n            });\n            let style = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRgbaStr({\n                r: color.r,\n                g: color.g,\n                b: color.b,\n                a: this.settingOpacity\n            });\n            if (this.settingGradient) {\n                const startAtTop = this.path[0].x > this.path[this.path.length - 1].x;\n                const gradient = this.context.createLinearGradient(0, startAtTop ? this.minY : this.maxY, 0, startAtTop ? this.maxY : this.minY);\n                gradient.addColorStop(0, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRgbaStr({\n                    r: color.r,\n                    g: color.g,\n                    b: color.b,\n                    a: this.settingOpacity\n                }));\n                gradient.addColorStop(1, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRgbaStr({\n                    r: color.r,\n                    g: color.g,\n                    b: color.b,\n                    a: 0\n                }));\n                style = gradient;\n            }\n            // setup params\n            if (this.settingMode === \"fill\") this.context.fillStyle = style;\n            else {\n                this.context.lineWidth = this.settingSize * 2;\n                this.context.lineJoin = \"bevel\";\n                this.context.strokeStyle = style;\n            }\n            // draw\n            const draw = ()=>{\n                if (this.settingMode === \"fill\") this.context.fill(path);\n                else this.context.stroke(path);\n            };\n            draw();\n            if (this.settingXSymmetry) {\n                this.context.save();\n                this.context.translate(this.context.canvas.width / 2, 0);\n                this.context.scale(-1, 1);\n                this.context.translate(-this.context.canvas.width / 2, 0);\n                draw();\n                this.context.restore();\n            }\n            if (this.settingYSymmetry) {\n                this.context.save();\n                this.context.translate(0, this.context.canvas.height / 2);\n                this.context.scale(1, -1);\n                this.context.translate(0, -this.context.canvas.height / 2);\n                draw();\n                this.context.restore();\n                if (this.settingXSymmetry) {\n                    this.context.save();\n                    this.context.translate(this.context.canvas.width / 2, this.context.canvas.height / 2);\n                    this.context.scale(-1, -1);\n                    this.context.translate(-this.context.canvas.width / 2, -this.context.canvas.height / 2);\n                    draw();\n                    this.context.restore();\n                }\n            }\n        }\n        this.context.restore();\n    }\n    setHistory(h) {\n        this.history = h;\n    }\n    getSize() {\n        return this.settingMode === \"stroke\" ? this.settingSize : 0;\n    }\n    setSize(s) {\n        this.settingSize = s;\n    }\n    getOpacity() {\n        return this.settingOpacity;\n    }\n    setOpacity(o) {\n        this.settingOpacity = o;\n    }\n    setColor(c) {\n        this.settingColor = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(c);\n    }\n    setContext(c) {\n        this.context = c;\n    }\n    setMode(mode) {\n        this.settingMode = mode;\n    }\n    getMode() {\n        return this.settingMode;\n    }\n    setDistort(distort) {\n        this.settingDistort = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(distort, 0, 1);\n    }\n    getDistort() {\n        return this.settingDistort;\n    }\n    setXSymmetry(b) {\n        this.settingXSymmetry = b;\n    }\n    getXSymmetry() {\n        return this.settingXSymmetry;\n    }\n    setYSymmetry(b) {\n        this.settingYSymmetry = b;\n    }\n    getYSymmetry() {\n        return this.settingYSymmetry;\n    }\n    setGradient(b) {\n        this.settingGradient = b;\n    }\n    getGradient() {\n        return this.settingGradient;\n    }\n    getLockAlpha() {\n        return this.settingLockLayerAlpha;\n    }\n    setLockAlpha(b) {\n        this.settingLockLayerAlpha = b;\n    }\n    getIsEraser() {\n        return this.settingIsEraser;\n    }\n    setIsEraser(b) {\n        this.settingIsEraser = b;\n    }\n    getIsDrawing() {\n        return this.isDrawing;\n    }\n    startLine(x, y) {\n        this.isDrawing = true;\n        this.path = [\n            {\n                x: x,\n                y: y\n            }\n        ];\n        this.minY = y;\n        this.maxY = y;\n        this.copyCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(this.context.canvas.width, this.context.canvas.height);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.copyCanvas).drawImage(this.context.canvas, 0, 0);\n        this.completeRedrawBounds = undefined;\n        this.updateCompleteRedrawBounds(x, y);\n    }\n    goLine(x, y) {\n        if (!this.isDrawing) return;\n        const pos = {\n            x: x,\n            y: y\n        };\n        if (this.settingDistort > 0) {\n            pos.x += (Math.random() - 0.5) * this.settingDistort * 80;\n            pos.y += (Math.random() - 0.5) * this.settingDistort * 80;\n        }\n        this.minY = Math.min(this.minY, pos.y);\n        this.maxY = Math.max(this.maxY, pos.y);\n        this.path.push(pos);\n        this.updateCompleteRedrawBounds(x, y);\n        this.drawShape();\n    }\n    endLine() {\n        this.isDrawing = false;\n        this.completeRedrawBounds = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).boundsInArea(this.completeRedrawBounds, this.copyCanvas.width, this.copyCanvas.height);\n        if (this.path.length > 1 && this.completeRedrawBounds) {\n            const historyCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1, this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1);\n            const historyCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(historyCanvas);\n            historyCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\n            this.history.push({\n                tool: [\n                    \"brush\",\n                    \"ChemyBrush\"\n                ],\n                actions: [\n                    {\n                        action: \"drawImage\",\n                        params: [\n                            historyCanvas,\n                            this.completeRedrawBounds.x1,\n                            this.completeRedrawBounds.y1\n                        ]\n                    }\n                ]\n            });\n        }\n        this.path = [];\n        this.copyCanvas = {};\n    }\n    drawImage(im, x, y) {\n        this.context.save();\n        this.context.clearRect(x, y, im.width, im.height);\n        this.context.drawImage(im, x, y);\n        this.context.restore();\n    }\n    drawLineSegment(x1, y1, x2, y2) {\n    // might make sense for stroke\n    }\n    // --- public ----\n    constructor(){\n        this.context = {};\n        this.settingColor = {};\n        this.settingSize = 0.25 // radius - 0.5 - 99999\n        ;\n        this.settingOpacity = 1 // 0-1\n        ;\n        this.settingLockLayerAlpha = false;\n        this.settingIsEraser = false;\n        this.settingMode = \"fill\";\n        this.settingDistort = 0 // 0 - 1\n        ;\n        this.settingXSymmetry = false;\n        this.settingYSymmetry = false;\n        this.settingGradient = false;\n        this.isDrawing = false;\n        this.history = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).DecoyKlHistory();\n        this.copyCanvas = {};\n        this.path = [];\n        this.minY = 0;\n        this.maxY = 0;\n    }\n}\n\n\nconst $8baf89d70f3487eb$export$7d68cd8857639377 = {\n    PenBrush: $ab3d0b0688f50842$export$6f96c8f9e6ae7341,\n    BlendBrush: $2beac24702a6836b$export$9659db8d01dd5313,\n    SketchyBrush: $ec1ed8bc550ccd88$export$566f9061f0f5ba33,\n    PixelBrush: $f01b5e3bd1be2f34$export$4de5ef8eecde6f12,\n    ChemyBrush: $458de7145dc8d2d0$export$38b08aa4ea8f61c6,\n    SmudgeBrush: $baef4a032d46c3b8$export$c9f800961903deab,\n    EraserBrush: $6debbe598e970932$export$fe52c90afd1cf5ba\n};\n\n\n\n\nconst $718ed62694aada15$export$5ec472fd0ce20d84 = 20;\n\n\n\n\n\n\nvar $4d613c579dce68ed$exports = {};\n\n$4d613c579dce68ed$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"brush-pen.49a7b91e.svg\";\n\n\n\n\n\nconst $74487dc42eb45244$export$a0d4983f3b0b5c8e = function() {\n    const brushInterface = {\n        image: (0, (/*@__PURE__*/$parcel$interopDefault($4d613c579dce68ed$exports))),\n        tooltip: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-pen\"),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).quadraticSplineInput(0.5, 100, 0.1)\n        },\n        opacitySlider: {\n            min: 0.01,\n            max: 1,\n            curve: [\n                [\n                    0,\n                    0.01\n                ],\n                [\n                    0.5,\n                    0.3\n                ],\n                [\n                    1,\n                    1\n                ]\n            ]\n        }\n    };\n    let alphaNames = [\n        (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-pen-circle\"),\n        (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-pen-chalk\"),\n        (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-pen-calligraphy\"),\n        (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-pen-square\")\n    ];\n    (0, $63d0b335c576c718$export$ea44c9eff2c31da6).subscribe(()=>{\n        brushInterface.tooltip = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-pen\");\n        alphaNames = [\n            (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-pen-circle\"),\n            (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-pen-chalk\"),\n            (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-pen-calligraphy\"),\n            (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-pen-square\")\n        ];\n    });\n    brushInterface.Ui = function(p) {\n        const div = document.createElement(\"div\"); // the gui\n        const brush = new (0, $8baf89d70f3487eb$export$7d68cd8857639377).PenBrush();\n        brush.setHistory((0, $d2dccce11beb16cf$export$28b6f4d98dde9845));\n        p.onSizeChange(brush.getSize());\n        let sizeSlider;\n        let opacitySlider;\n        const alphaOptions = new (0, $1166276dc18d3ea9$export$c019608e5b5bb4cb)({\n            optionArr: [\n                0,\n                1,\n                2,\n                3\n            ].map((id)=>{\n                const alpha = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    className: \"dark-invert\",\n                    css: {\n                        width: \"31px\",\n                        height: \"31px\",\n                        backgroundSize: \"contain\",\n                        margin: \"2px\"\n                    }\n                });\n                const canvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(70, 70);\n                const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(canvas);\n                if (id === 0 || id === 3) {\n                    if (id === 0) {\n                        ctx.beginPath();\n                        ctx.arc(35, 35, 30, 0, 2 * Math.PI);\n                        ctx.closePath();\n                        ctx.fill();\n                    } else ctx.fillRect(5, 5, 60, 60);\n                } else if (id === 1) ctx.drawImage((0, $be08c7e8caa49ffa$export$74a44bbc21d06a28)(60), 5, 5);\n                else if (id === 2) ctx.drawImage((0, $be08c7e8caa49ffa$export$eaa218d5d17c8f1c)(60), 5, 5);\n                alpha.style.backgroundImage = \"url(\" + canvas.toDataURL(\"image/png\") + \")\";\n                return {\n                    id: id,\n                    label: alpha,\n                    title: alphaNames[id]\n                };\n            }),\n            initId: 0,\n            onChange: (id)=>{\n                brush.setAlpha(id);\n            }\n        });\n        const lockAlphaToggle = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: brush.getLockAlpha(),\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"lock-alpha\"),\n            callback: function(b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"lock-alpha-title\"),\n            css: {\n                display: \"inline-block\"\n            }\n        });\n        const spacingSpline = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).SplineInterpolator([\n            [\n                0,\n                15\n            ],\n            [\n                8,\n                7\n            ],\n            [\n                14,\n                4\n            ],\n            [\n                30,\n                3\n            ],\n            [\n                50,\n                2.7\n            ],\n            [\n                100,\n                2\n            ]\n        ]);\n        function setSize(size) {\n            brush.setSize(size);\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\n        }\n        function init() {\n            sizeSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-size\"),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: (0, $718ed62694aada15$export$5ec472fd0ce20d84),\n                toDisplayValue: (val)=>val * 2,\n                toValue: (displayValue)=>displayValue / 2,\n                onChange: (val)=>{\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue)=>{\n                    if (displayValue < 10) return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).round(displayValue, 1);\n                    else return Math.round(displayValue);\n                },\n                manualInputRoundDigits: 1\n            });\n            opacitySlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"opacity\"),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brushInterface.opacitySlider.max,\n                curve: brushInterface.opacitySlider.curve,\n                eventResMs: (0, $718ed62694aada15$export$5ec472fd0ce20d84),\n                toDisplayValue: (val)=>val * 100,\n                toValue: (displayValue)=>displayValue / 100,\n                onChange: (val)=>{\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                }\n            });\n            const pressureSizeToggle = (0, $218f70778c2bf652$export$9da2e8821e6cbb57)(true, function(b) {\n                brush.sizePressure(b);\n            });\n            const pressureOpacityToggle = (0, $218f70778c2bf652$export$9da2e8821e6cbb57)(false, function(b) {\n                brush.opacityPressure(b);\n            });\n            div.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                content: [\n                    sizeSlider.getElement(),\n                    pressureSizeToggle\n                ],\n                css: {\n                    display: \"flex\",\n                    justifyContent: \"space-between\",\n                    alignItems: \"center\",\n                    marginBottom: \"10px\"\n                }\n            }), (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                content: [\n                    opacitySlider.getElement(),\n                    pressureOpacityToggle\n                ],\n                css: {\n                    display: \"flex\",\n                    justifyContent: \"space-between\",\n                    alignItems: \"center\"\n                }\n            }), (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                content: alphaOptions.getElement(),\n                css: {\n                    marginTop: \"10px\"\n                }\n            }), (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                content: lockAlphaToggle.getElement(),\n                css: {\n                    marginTop: \"10px\"\n                }\n            }));\n        }\n        init();\n        this.increaseSize = function(f) {\n            if (!brush.isDrawing()) sizeSlider.changeSliderValue(f);\n        };\n        this.decreaseSize = function(f) {\n            if (!brush.isDrawing()) sizeSlider.changeSliderValue(-f);\n        };\n        this.getSize = function() {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function() {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function(c) {\n            brush.setColor(c);\n        };\n        this.setContext = function(c) {\n            brush.setContext(c);\n        };\n        this.startLine = function(x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function(x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function(x, y) {\n            brush.endLine(x, y);\n        };\n        this.getBrush = function() {\n            return brush;\n        };\n        this.isDrawing = function() {\n            return brush.isDrawing();\n        };\n        this.getElement = function() {\n            return div;\n        };\n    };\n    return brushInterface;\n}();\n\n\n\n\n\n\n\n\n\nvar $d0b3741389f08f3c$exports = {};\n\n$d0b3741389f08f3c$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"brush-blend.3706e8a1.svg\";\n\n\n\nconst $389b24b4f03b3a27$export$156bb4fe8f4bcb4b = function() {\n    const brushInterface = {\n        image: (0, (/*@__PURE__*/$parcel$interopDefault($d0b3741389f08f3c$exports))),\n        tooltip: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-blend\"),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).quadraticSplineInput(0.5, 100, 0.1)\n        },\n        opacitySlider: {\n            min: 0.01,\n            max: 1\n        }\n    };\n    (0, $63d0b335c576c718$export$ea44c9eff2c31da6).subscribe(()=>{\n        brushInterface.tooltip = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-blend\");\n    });\n    brushInterface.Ui = function(p) {\n        const div = document.createElement(\"div\"); // the gui\n        const brush = new (0, $8baf89d70f3487eb$export$7d68cd8857639377).BlendBrush();\n        brush.setHistory((0, $d2dccce11beb16cf$export$28b6f4d98dde9845));\n        p.onSizeChange(brush.getSize());\n        let sizeSlider;\n        let opacitySlider;\n        function setSize(size) {\n            brush.setSize(size);\n        }\n        function init() {\n            sizeSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-size\"),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: 58,\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: (0, $718ed62694aada15$export$5ec472fd0ce20d84),\n                toDisplayValue: (val)=>val * 2,\n                toValue: (displayValue)=>displayValue / 2,\n                onChange: (val)=>{\n                    setSize(val);\n                    p.onSizeChange(val);\n                }\n            });\n            opacitySlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"opacity\"),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                curve: brushInterface.opacitySlider.curve,\n                eventResMs: (0, $718ed62694aada15$export$5ec472fd0ce20d84),\n                toDisplayValue: (val)=>val * 100,\n                toValue: (displayValue)=>displayValue / 100,\n                onChange: (val)=>{\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                }\n            });\n            const blendingSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-blending\"),\n                width: 225,\n                height: 30,\n                min: 0,\n                max: 1,\n                value: brush.getBlending(),\n                eventResMs: (0, $718ed62694aada15$export$5ec472fd0ce20d84),\n                toDisplayValue: (val)=>val * 100,\n                toValue: (displayValue)=>displayValue / 100,\n                onChange: function(val) {\n                    brush.setBlending(val);\n                }\n            });\n            blendingSlider.getElement().style.marginTop = \"10px\";\n            const pressureSizeToggle = (0, $218f70778c2bf652$export$9da2e8821e6cbb57)(true, function(b) {\n                brush.setSizePressure(b);\n            });\n            const pressureOpacityToggle = (0, $218f70778c2bf652$export$9da2e8821e6cbb57)(false, function(b) {\n                brush.setOpacityPressure(b);\n            });\n            const lockAlphaToggle = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n                init: brush.getLockAlpha(),\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"lock-alpha\"),\n                callback: function(b) {\n                    brush.setLockAlpha(b);\n                },\n                doHighlight: true,\n                title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"lock-alpha-title\"),\n                css: {\n                    marginTop: \"10px\",\n                    display: \"inline-block\"\n                }\n            });\n            div.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                content: [\n                    sizeSlider.getElement(),\n                    pressureSizeToggle\n                ],\n                css: {\n                    display: \"flex\",\n                    justifyContent: \"space-between\",\n                    alignItems: \"center\",\n                    marginBottom: \"10px\"\n                }\n            }), (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                content: [\n                    opacitySlider.getElement(),\n                    pressureOpacityToggle\n                ],\n                css: {\n                    display: \"flex\",\n                    justifyContent: \"space-between\",\n                    alignItems: \"center\"\n                }\n            }), blendingSlider.getElement(), lockAlphaToggle.getElement());\n        }\n        init();\n        this.increaseSize = function(f) {\n            if (!brush.getIsDrawing()) sizeSlider.changeSliderValue(f);\n        };\n        this.decreaseSize = function(f) {\n            if (!brush.getIsDrawing()) sizeSlider.changeSliderValue(-f);\n        };\n        this.getSize = function() {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function() {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function(c) {\n            brush.setColor(c);\n        };\n        this.setContext = function(c) {\n            brush.setContext(c);\n        };\n        this.startLine = function(x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function(x, y, p, isCoalesced) {\n            brush.goLine(x, y, p, isCoalesced);\n        };\n        this.endLine = function() {\n            brush.endLine();\n        };\n        this.getBrush = function() {\n            return brush;\n        };\n        this.isDrawing = function() {\n            return brush.getIsDrawing();\n        };\n        this.getElement = function() {\n            return div;\n        };\n    };\n    return brushInterface;\n}();\n\n\n\n\n\n\nvar $04232cea90849ea3$exports = {};\n\n$04232cea90849ea3$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"brush-sketchy.4c477c01.png\";\n\n\n\n\nconst $ed2b11ff6c0e7481$export$ffae56164d1bde68 = function() {\n    const brushInterface = {\n        image: (0, (/*@__PURE__*/$parcel$interopDefault($04232cea90849ea3$exports))),\n        tooltip: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-sketchy\"),\n        sizeSlider: {\n            min: 0.5,\n            max: 10\n        },\n        opacitySlider: {\n            min: 0.01,\n            max: 1\n        }\n    };\n    (0, $63d0b335c576c718$export$ea44c9eff2c31da6).subscribe(()=>{\n        brushInterface.tooltip = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-sketchy\");\n    });\n    brushInterface.Ui = function(p) {\n        const div = document.createElement(\"div\"); // the gui\n        const brush = new (0, $8baf89d70f3487eb$export$7d68cd8857639377).SketchyBrush();\n        brush.setHistory((0, $d2dccce11beb16cf$export$28b6f4d98dde9845));\n        p.onSizeChange(brush.getSize());\n        let sizeSlider;\n        let opacitySlider;\n        function setSize(size) {\n            brush.setSize(size);\n        }\n        function init() {\n            sizeSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-size\"),\n                width: 250,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize() * 2,\n                eventResMs: (0, $718ed62694aada15$export$5ec472fd0ce20d84),\n                toDisplayValue: (val)=>val * 2,\n                toValue: (displayValue)=>displayValue / 2,\n                onChange: function(val) {\n                    brush.setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue)=>{\n                    if (displayValue < 10) return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).round(displayValue, 1);\n                    else return Math.round(displayValue);\n                },\n                manualInputRoundDigits: 1\n            });\n            opacitySlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"opacity\"),\n                width: 250,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                eventResMs: (0, $718ed62694aada15$export$5ec472fd0ce20d84),\n                toDisplayValue: (val)=>val * 100,\n                toValue: (displayValue)=>displayValue / 100,\n                onChange: (val)=>{\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                }\n            });\n            const blendSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-blending\"),\n                width: 250,\n                height: 30,\n                min: 0,\n                max: 1,\n                value: brush.getBlending(),\n                eventResMs: (0, $718ed62694aada15$export$5ec472fd0ce20d84),\n                toDisplayValue: (val)=>val * 100,\n                toValue: (displayValue)=>displayValue / 100,\n                onChange: function(val) {\n                    brush.setBlending(val);\n                }\n            });\n            const scaleSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-sketchy-scale\"),\n                width: 250,\n                height: 30,\n                min: 1,\n                max: 20,\n                value: brush.getScale(),\n                eventResMs: (0, $718ed62694aada15$export$5ec472fd0ce20d84),\n                onChange: function(val) {\n                    brush.setScale(val);\n                }\n            });\n            opacitySlider.getElement().style.marginTop = \"10px\";\n            blendSlider.getElement().style.marginTop = \"10px\";\n            scaleSlider.getElement().style.marginTop = \"10px\";\n            div.append(sizeSlider.getElement(), opacitySlider.getElement(), blendSlider.getElement(), scaleSlider.getElement());\n        }\n        init();\n        this.increaseSize = function(f) {\n            if (!brush.isDrawing()) sizeSlider.changeSliderValue(f);\n        };\n        this.decreaseSize = function(f) {\n            if (!brush.isDrawing()) sizeSlider.changeSliderValue(-f);\n        };\n        this.getSize = function() {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function() {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function(c) {\n            brush.setColor(c);\n        };\n        this.setContext = function(c) {\n            brush.setContext(c);\n        };\n        this.startLine = function(x, y, pressure) {\n            brush.startLine(x, y, pressure);\n        };\n        this.goLine = function(x, y, pressure) {\n            brush.goLine(x, y, pressure, undefined);\n        };\n        this.endLine = function() {\n            brush.endLine();\n        };\n        this.getSeed = function() {\n            return parseInt(\"\" + brush.getSeed());\n        };\n        this.setSeed = function(s) {\n            brush.setSeed(parseInt(\"\" + s));\n        };\n        this.getBrush = function() {\n            return brush;\n        };\n        this.isDrawing = function() {\n            return brush.isDrawing();\n        };\n        this.getElement = function() {\n            return div;\n        };\n    };\n    return brushInterface;\n}();\n\n\n\n\n\n\n\n\n\nvar $dea88774f907e549$exports = {};\n\n$dea88774f907e549$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"brush-pixel.673f3e4c.svg\";\n\n\n\nconst $c8f3acddc3f49bc0$export$d001f3406562d07 = function() {\n    const brushInterface = {\n        image: (0, (/*@__PURE__*/$parcel$interopDefault($dea88774f907e549$exports))),\n        tooltip: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-pixel\"),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).quadraticSplineInput(0.5, 100, 0.1)\n        },\n        opacitySlider: {\n            min: 0.01,\n            max: 1,\n            curve: [\n                [\n                    0,\n                    0.01\n                ],\n                [\n                    0.5,\n                    0.3\n                ],\n                [\n                    1,\n                    1\n                ]\n            ]\n        }\n    };\n    (0, $63d0b335c576c718$export$ea44c9eff2c31da6).subscribe(()=>{\n        brushInterface.tooltip = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-pixel\");\n    });\n    brushInterface.Ui = function(p) {\n        const div = document.createElement(\"div\"); // the gui\n        const brush = new (0, $8baf89d70f3487eb$export$7d68cd8857639377).PixelBrush();\n        brush.setHistory((0, $d2dccce11beb16cf$export$28b6f4d98dde9845));\n        p.onSizeChange(brush.getSize());\n        let sizeSlider;\n        let opacitySlider;\n        const lockAlphaToggle = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: brush.getLockAlpha(),\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"lock-alpha\"),\n            callback: function(b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"lock-alpha-title\"),\n            css: {\n                marginRight: \"10px\"\n            }\n        });\n        const eraserToggle = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: brush.getIsEraser(),\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"eraser\"),\n            callback: function(b) {\n                brush.setIsEraser(b);\n            },\n            css: {\n                marginRight: \"10px\"\n            }\n        });\n        const ditherToggle = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: brush.getUseDither(),\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-pixel-dither\"),\n            callback: function(b) {\n                brush.setUseDither(b);\n            }\n        });\n        const spacingSpline = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).SplineInterpolator([\n            [\n                0.5,\n                0.45\n            ],\n            [\n                100,\n                4\n            ]\n        ]);\n        function setSize(size) {\n            brush.setSize(size);\n            brush.setSpacing(spacingSpline.interpolate(size) / size);\n        }\n        function init() {\n            sizeSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-size\"),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: (0, $718ed62694aada15$export$5ec472fd0ce20d84),\n                toDisplayValue: (val)=>val * 2,\n                toValue: (displayValue)=>displayValue / 2,\n                onChange: (val)=>{\n                    setSize(val);\n                    p.onSizeChange(val);\n                }\n            });\n            opacitySlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"opacity\"),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brushInterface.opacitySlider.max,\n                eventResMs: (0, $718ed62694aada15$export$5ec472fd0ce20d84),\n                toDisplayValue: (val)=>val * 100,\n                toValue: (displayValue)=>displayValue / 100,\n                onChange: (val)=>{\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                }\n            });\n            const pressureSizeToggle = (0, $218f70778c2bf652$export$9da2e8821e6cbb57)(true, function(b) {\n                brush.sizePressure(b);\n            });\n            div.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                content: [\n                    sizeSlider.getElement(),\n                    pressureSizeToggle\n                ],\n                css: {\n                    display: \"flex\",\n                    justifyContent: \"space-between\",\n                    alignItems: \"center\",\n                    marginBottom: \"10px\"\n                }\n            }), opacitySlider.getElement());\n            const toggleRow = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                parent: div,\n                css: {\n                    display: \"flex\",\n                    marginTop: \"10px\"\n                }\n            });\n            toggleRow.append(lockAlphaToggle.getElement(), eraserToggle.getElement(), ditherToggle.getElement());\n        }\n        init();\n        this.increaseSize = function(f) {\n            if (!brush.isDrawing()) sizeSlider.changeSliderValue(f);\n        };\n        this.decreaseSize = function(f) {\n            if (!brush.isDrawing()) sizeSlider.changeSliderValue(-f);\n        };\n        this.getSize = function() {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size * 2);\n        };\n        this.getOpacity = function() {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity * 100);\n        };\n        this.setColor = function(c) {\n            brush.setColor(c);\n        };\n        this.setContext = function(c) {\n            brush.setContext(c);\n        };\n        this.startLine = function(x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function(x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function(x, y) {\n            brush.endLine(x, y);\n        };\n        this.getBrush = function() {\n            return brush;\n        };\n        this.isDrawing = function() {\n            return brush.isDrawing();\n        };\n        this.toggleEraser = ()=>{\n            eraserToggle.setValue(!eraserToggle.getValue());\n            brush.setIsEraser(eraserToggle.getValue());\n        };\n        this.getElement = function() {\n            return div;\n        };\n    };\n    return brushInterface;\n}();\n\n\n\n\n\n\n\n\n\nvar $901bf8c8c32809dc$exports = {};\n\n$901bf8c8c32809dc$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"brush-eraser.a9e10dce.svg\";\n\n\n\nconst $411f23605301883c$export$cf481ecf227135a8 = function() {\n    const brushInterface = {\n        image: (0, (/*@__PURE__*/$parcel$interopDefault($901bf8c8c32809dc$exports))),\n        tooltip: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"eraser\") + \" [E]\",\n        sizeSlider: {\n            min: 0.5,\n            max: 200,\n            curve: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).quadraticSplineInput(0.5, 200, 0.1)\n        },\n        opacitySlider: {\n            min: 0.01,\n            max: 1\n        }\n    };\n    (0, $63d0b335c576c718$export$ea44c9eff2c31da6).subscribe(()=>{\n        brushInterface.tooltip = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"eraser\") + \" [E]\";\n    });\n    brushInterface.Ui = function(p) {\n        const div = document.createElement(\"div\"); // the gui\n        const brush = new (0, $8baf89d70f3487eb$export$7d68cd8857639377).EraserBrush();\n        brush.setHistory((0, $d2dccce11beb16cf$export$28b6f4d98dde9845));\n        p.onSizeChange(brush.getSize());\n        let sizeSlider;\n        let opacitySlider;\n        let isTransparentBg = false;\n        function setSize(size) {\n            brush.setSize(size);\n        }\n        function init() {\n            sizeSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-size\"),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: 30,\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: (0, $718ed62694aada15$export$5ec472fd0ce20d84),\n                toDisplayValue: (val)=>val * 2,\n                toValue: (displayValue)=>displayValue / 2,\n                onChange: (val)=>{\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue)=>{\n                    if (displayValue < 10) return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).round(displayValue, 1);\n                    else return Math.round(displayValue);\n                },\n                manualInputRoundDigits: 1\n            });\n            opacitySlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"opacity\"),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brushInterface.opacitySlider.max,\n                eventResMs: (0, $718ed62694aada15$export$5ec472fd0ce20d84),\n                toDisplayValue: (val)=>val * 100,\n                toValue: (displayValue)=>displayValue / 100,\n                onChange: (val)=>{\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                }\n            });\n            const pressureSizeToggle = (0, $218f70778c2bf652$export$9da2e8821e6cbb57)(true, function(b) {\n                brush.sizePressure(b);\n            });\n            const pressureOpacityToggle = (0, $218f70778c2bf652$export$9da2e8821e6cbb57)(false, function(b) {\n                brush.opacityPressure(b);\n            });\n            div.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                content: [\n                    sizeSlider.getElement(),\n                    pressureSizeToggle\n                ],\n                css: {\n                    display: \"flex\",\n                    justifyContent: \"space-between\",\n                    alignItems: \"center\",\n                    marginBottom: \"10px\"\n                }\n            }), (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                content: [\n                    opacitySlider.getElement(),\n                    pressureOpacityToggle\n                ],\n                css: {\n                    display: \"flex\",\n                    justifyContent: \"space-between\",\n                    alignItems: \"center\"\n                }\n            }));\n            const transparencyToggle = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n                init: false,\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-eraser-transparent-bg\"),\n                callback: function(b) {\n                    isTransparentBg = b;\n                    brush.setTransparentBG(b);\n                },\n                css: {\n                    marginTop: \"10px\"\n                }\n            });\n            div.append(transparencyToggle.getElement());\n        }\n        init();\n        this.increaseSize = function(f) {\n            if (!brush.isDrawing()) sizeSlider.changeSliderValue(f);\n        };\n        this.decreaseSize = function(f) {\n            if (!brush.isDrawing()) sizeSlider.changeSliderValue(-f);\n        };\n        this.getSize = function() {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function() {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function() {};\n        this.setContext = function(c) {\n            brush.setContext(c);\n        };\n        this.startLine = function(x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function(x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function() {\n            brush.endLine();\n        };\n        this.getBrush = function() {\n            return brush;\n        };\n        this.getIsTransparentBg = function() {\n            return isTransparentBg;\n        };\n        this.isDrawing = function() {\n            return brush.isDrawing();\n        };\n        this.getElement = function() {\n            return div;\n        };\n    };\n    return brushInterface;\n}();\n\n\n\n\n\n\n\n\n\nvar $ac5f262f132efcf8$exports = {};\n\n$ac5f262f132efcf8$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"brush-smudge.45852bcd.svg\";\n\n\n\nconst $4218d17c2806f1f8$export$84831662ba707e7a = function() {\n    const brushInterface = {\n        image: (0, (/*@__PURE__*/$parcel$interopDefault($ac5f262f132efcf8$exports))),\n        tooltip: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-smudge\"),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).quadraticSplineInput(0.5, 100, 0.1)\n        },\n        opacitySlider: {\n            min: 0.01,\n            max: 1,\n            curve: [\n                [\n                    0,\n                    0.01\n                ],\n                [\n                    0.5,\n                    0.3\n                ],\n                [\n                    1,\n                    1\n                ]\n            ]\n        }\n    };\n    (0, $63d0b335c576c718$export$ea44c9eff2c31da6).subscribe(()=>{\n        brushInterface.tooltip = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-smudge\");\n    });\n    brushInterface.Ui = function(p) {\n        const div = document.createElement(\"div\"); // the gui\n        const brush = new (0, $8baf89d70f3487eb$export$7d68cd8857639377).SmudgeBrush();\n        brush.setHistory((0, $d2dccce11beb16cf$export$28b6f4d98dde9845));\n        p.onSizeChange(brush.getSize());\n        let sizeSlider;\n        let opacitySlider;\n        const lockAlphaToggle = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: brush.getLockAlpha(),\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"lock-alpha\"),\n            callback: function(b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"lock-alpha-title\")\n        });\n        const spacingSpline = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).SplineInterpolator([\n            [\n                0,\n                15\n            ],\n            [\n                8,\n                7\n            ],\n            [\n                14,\n                4\n            ],\n            [\n                30,\n                3\n            ],\n            [\n                50,\n                2.7\n            ],\n            [\n                100,\n                2\n            ]\n        ]);\n        function setSize(size) {\n            brush.setSize(size);\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\n        }\n        function init() {\n            sizeSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-size\"),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: (0, $718ed62694aada15$export$5ec472fd0ce20d84),\n                toDisplayValue: (val)=>val * 2,\n                toValue: (displayValue)=>displayValue / 2,\n                onChange: (val)=>{\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue)=>{\n                    if (displayValue < 10) return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).round(displayValue, 1);\n                    else return Math.round(displayValue);\n                },\n                manualInputRoundDigits: 1\n            });\n            opacitySlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"opacity\"),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                curve: brushInterface.opacitySlider.curve,\n                eventResMs: (0, $718ed62694aada15$export$5ec472fd0ce20d84),\n                toDisplayValue: (val)=>val * 100,\n                toValue: (displayValue)=>displayValue / 100,\n                onChange: (val)=>{\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                }\n            });\n            const pressureSizeToggle = (0, $218f70778c2bf652$export$9da2e8821e6cbb57)(false, function(b) {\n                brush.sizePressure(b);\n            });\n            const pressureOpacityToggle = (0, $218f70778c2bf652$export$9da2e8821e6cbb57)(false, function(b) {\n                brush.opacityPressure(b);\n            });\n            div.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                content: [\n                    sizeSlider.getElement(),\n                    pressureSizeToggle\n                ],\n                css: {\n                    display: \"flex\",\n                    justifyContent: \"space-between\",\n                    alignItems: \"center\",\n                    marginBottom: \"10px\"\n                }\n            }), (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                content: [\n                    opacitySlider.getElement(),\n                    pressureOpacityToggle\n                ],\n                css: {\n                    display: \"flex\",\n                    justifyContent: \"space-between\",\n                    alignItems: \"center\"\n                }\n            }));\n            const bottomRow = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                parent: div,\n                css: {\n                    marginTop: \"10px\"\n                }\n            });\n            bottomRow.append(lockAlphaToggle.getElement());\n        }\n        init();\n        this.increaseSize = function(f) {\n            if (!brush.getIsDrawing()) sizeSlider.changeSliderValue(f);\n        };\n        this.decreaseSize = function(f) {\n            if (!brush.getIsDrawing()) sizeSlider.changeSliderValue(-f);\n        };\n        this.getSize = function() {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function() {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function(c) {\n            brush.setColor(c);\n        };\n        this.setContext = function(c) {\n            brush.setContext(c);\n        };\n        this.startLine = function(x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function(x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function() {\n            brush.endLine();\n        };\n        this.getBrush = function() {\n            return brush;\n        };\n        this.isDrawing = function() {\n            return brush.getIsDrawing();\n        };\n        this.getElement = function() {\n            return div;\n        };\n    };\n    return brushInterface;\n}();\n\n\n\n\n\n\n\n\nvar $6f76f2b9c1cc7b0f$exports = {};\n\n$6f76f2b9c1cc7b0f$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"brush-chemy.a5a188f6.svg\";\n\n\n\n\n\nconst $720edf36b0105568$export$80819a93636ebb04 = function() {\n    const brushInterface = {\n        image: (0, (/*@__PURE__*/$parcel$interopDefault($6f76f2b9c1cc7b0f$exports))),\n        tooltip: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-chemy\"),\n        sizeSlider: {\n            min: 0.25,\n            max: 25,\n            curve: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).quadraticSplineInput(0.25, 25, 0.1),\n            isDisabled: true\n        },\n        opacitySlider: {\n            min: 0.01,\n            max: 1\n        }\n    };\n    (0, $63d0b335c576c718$export$ea44c9eff2c31da6).subscribe(()=>{\n        brushInterface.tooltip = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-chemy\");\n    });\n    brushInterface.Ui = function(p) {\n        const div = document.createElement(\"div\"); // the gui\n        const brush = new (0, $8baf89d70f3487eb$export$7d68cd8857639377).ChemyBrush();\n        brush.setHistory((0, $d2dccce11beb16cf$export$28b6f4d98dde9845));\n        p.onSizeChange(brush.getSize());\n        let sizeSlider;\n        let opacitySlider;\n        function setSize(size) {\n            brush.setSize(size);\n        }\n        let eraserToggle;\n        function init() {\n            sizeSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-size\"),\n                width: 250,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: (0, $718ed62694aada15$export$5ec472fd0ce20d84),\n                isEnabled: brush.getMode() === \"stroke\",\n                toDisplayValue: (val)=>val * 2,\n                toValue: (displayValue)=>displayValue / 2,\n                onChange: (val)=>{\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue)=>{\n                    if (displayValue < 5) return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).round(displayValue, 1);\n                    else return Math.round(displayValue);\n                },\n                manualInputRoundDigits: 1\n            });\n            opacitySlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"opacity\"),\n                width: 250,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                eventResMs: (0, $718ed62694aada15$export$5ec472fd0ce20d84),\n                toDisplayValue: (val)=>val * 100,\n                toValue: (displayValue)=>displayValue / 100,\n                onChange: (val)=>{\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                }\n            });\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(opacitySlider.getElement(), {\n                marginTop: \"10px\"\n            });\n            eraserToggle = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n                init: brush.getIsEraser(),\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"eraser\"),\n                callback: function(b) {\n                    brush.setIsEraser(b);\n                },\n                css: {\n                    marginTop: \"10px\",\n                    marginLeft: \"10px\"\n                }\n            });\n            const lockAlphaToggle = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n                init: brush.getLockAlpha(),\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"lock-alpha\"),\n                callback: function(b) {\n                    brush.setLockAlpha(b);\n                },\n                doHighlight: true,\n                title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"lock-alpha-title\"),\n                css: {\n                    marginTop: \"10px\"\n                }\n            });\n            const toggleRow = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                css: {\n                    display: \"flex\",\n                    marginTop: \"10px\"\n                }\n            });\n            const iconSize = 35;\n            const padding = 8;\n            const actualIconSize = iconSize - padding * 2;\n            const halfSize = actualIconSize / 2;\n            const modeOptions = new (0, $1166276dc18d3ea9$export$c019608e5b5bb4cb)({\n                optionArr: [\n                    {\n                        id: \"fill\",\n                        label: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n                            class: \"dark-invert\",\n                            elementType: \"svg\",\n                            width: iconSize + \"\",\n                            height: iconSize + \"\",\n                            childrenArr: [\n                                {\n                                    elementType: \"path\",\n                                    fill: \"#000\",\n                                    style: `transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\n                                    d: \"M 0,0 C 1.5,0 -0.5,1 1,1\"\n                                }\n                            ]\n                        }),\n                        title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-chemy-fill\")\n                    },\n                    {\n                        id: \"stroke\",\n                        label: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n                            class: \"dark-invert\",\n                            elementType: \"svg\",\n                            width: iconSize + \"\",\n                            height: iconSize + \"\",\n                            childrenArr: [\n                                {\n                                    elementType: \"path\",\n                                    fill: \"none\",\n                                    stroke: \"#000\",\n                                    style: `stroke-width: 0.12px; transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\n                                    d: \"M 0,0 C 1.5,0 -0.5,1 1,1\"\n                                }\n                            ]\n                        }),\n                        title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-chemy-stroke\")\n                    }\n                ],\n                initId: brush.getMode(),\n                onChange: (id)=>{\n                    brush.setMode(id);\n                    brushInterface.sizeSlider.isDisabled = brush.getMode() === \"fill\";\n                    sizeSlider.setIsEnabled(!brushInterface.sizeSlider.isDisabled);\n                    const brushSize = brush.getSize();\n                    sizeSlider.setValue(brushSize);\n                    p.onSizeChange(brushSize);\n                    p.onConfigChange();\n                }\n            });\n            const mirrorXToggle = new (0, $8d99bd5fadaac7f9$export$2358c75ad3c15b2d)({\n                label: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n                    class: \"dark-invert\",\n                    elementType: \"svg\",\n                    width: iconSize + \"\",\n                    height: iconSize + \"\",\n                    childrenArr: [\n                        {\n                            elementType: \"path\",\n                            fill: \"none\",\n                            stroke: \"#000\",\n                            style: \"stroke-width: 1px\",\n                            d: `M ${halfSize + padding},${padding} ${halfSize + padding},${actualIconSize + padding}`\n                        }\n                    ]\n                }),\n                title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-chemy-mirror-x\"),\n                init: brush.getXSymmetry(),\n                onChange: (b)=>{\n                    brush.setXSymmetry(b);\n                }\n            });\n            const mirrorYToggle = new (0, $8d99bd5fadaac7f9$export$2358c75ad3c15b2d)({\n                label: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n                    class: \"dark-invert\",\n                    elementType: \"svg\",\n                    width: iconSize + \"\",\n                    height: iconSize + \"\",\n                    childrenArr: [\n                        {\n                            elementType: \"path\",\n                            fill: \"none\",\n                            stroke: \"#000\",\n                            style: \"stroke-width: 1px\",\n                            d: `M ${padding},${halfSize + padding} ${actualIconSize + padding},${halfSize + padding}`\n                        }\n                    ]\n                }),\n                title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-chemy-mirror-y\"),\n                init: brush.getYSymmetry(),\n                onChange: (b)=>{\n                    brush.setYSymmetry(b);\n                }\n            });\n            const gradientToggle = new (0, $8d99bd5fadaac7f9$export$2358c75ad3c15b2d)({\n                label: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createSvg({\n                    class: \"dark-invert\",\n                    elementType: \"svg\",\n                    width: iconSize + \"\",\n                    height: iconSize + \"\",\n                    childrenArr: [\n                        {\n                            elementType: \"defs\",\n                            childrenArr: [\n                                {\n                                    elementType: \"linearGradient\",\n                                    id: \"gradient\",\n                                    x1: \"0\",\n                                    y1: \"0\",\n                                    x2: \"0\",\n                                    y2: \"1\",\n                                    childrenArr: [\n                                        {\n                                            elementType: \"stop\",\n                                            offset: \"0%\",\n                                            \"stop-color\": \"rgba(0,0,0,0)\"\n                                        },\n                                        {\n                                            elementType: \"stop\",\n                                            offset: \"100%\",\n                                            \"stop-color\": \"rgba(0,0,0,1)\"\n                                        }\n                                    ]\n                                }\n                            ]\n                        },\n                        {\n                            elementType: \"rect\",\n                            fill: \"url('#gradient')\",\n                            x: \"\" + padding,\n                            y: \"\" + padding,\n                            width: \"\" + actualIconSize,\n                            height: \"\" + actualIconSize\n                        }\n                    ]\n                }),\n                title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-chemy-gradient\"),\n                init: brush.getGradient(),\n                onChange: (b)=>{\n                    brush.setGradient(b);\n                }\n            });\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(mirrorXToggle.getElement(), {\n                marginLeft: \"10px\"\n            });\n            {\n                const margin = {\n                    marginLeft: \"4px\"\n                };\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(mirrorYToggle.getElement(), margin);\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(gradientToggle.getElement(), margin);\n            }\n            toggleRow.append(modeOptions.getElement(), mirrorXToggle.getElement(), mirrorYToggle.getElement(), gradientToggle.getElement());\n            div.append(sizeSlider.getElement(), opacitySlider.getElement(), toggleRow, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                content: [\n                    lockAlphaToggle.getElement(),\n                    eraserToggle.getElement()\n                ],\n                css: {\n                    display: \"flex\"\n                }\n            }));\n        }\n        init();\n        this.increaseSize = function(f) {\n            if (!brush.getIsDrawing() && brush.getMode() === \"stroke\") sizeSlider.changeSliderValue(f);\n        };\n        this.decreaseSize = function(f) {\n            if (!brush.getIsDrawing() && brush.getMode() === \"stroke\") sizeSlider.changeSliderValue(-f);\n        };\n        this.getSize = function() {\n            return brush.getSize();\n        };\n        this.setSize = function(size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function() {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function(opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function(c) {\n            brush.setColor(c);\n        };\n        this.setContext = function(c) {\n            brush.setContext(c);\n        };\n        this.startLine = function(x, y, p) {\n            brush.startLine(x, y);\n        };\n        this.goLine = function(x, y, p, isCoalesced) {\n            brush.goLine(x, y);\n        };\n        this.endLine = function() {\n            brush.endLine();\n        };\n        this.getBrush = function() {\n            return brush;\n        };\n        this.isDrawing = function() {\n            return brush.getIsDrawing();\n        };\n        this.toggleEraser = ()=>{\n            eraserToggle.setValue(!eraserToggle.getValue());\n            brush.setIsEraser(eraserToggle.getValue());\n        };\n        this.getElement = function() {\n            return div;\n        };\n    };\n    return brushInterface;\n}();\n\n\nconst $b2f1ee6bcab52d93$export$f1561c72be54c6a7 = {\n    penBrush: (0, $74487dc42eb45244$export$a0d4983f3b0b5c8e),\n    blendBrush: (0, $389b24b4f03b3a27$export$156bb4fe8f4bcb4b),\n    sketchyBrush: (0, $ed2b11ff6c0e7481$export$ffae56164d1bde68),\n    pixelBrush: (0, $c8f3acddc3f49bc0$export$d001f3406562d07),\n    chemyBrush: (0, $720edf36b0105568$export$80819a93636ebb04),\n    smudgeBrush: (0, $4218d17c2806f1f8$export$84831662ba707e7a),\n    eraserBrush: (0, $411f23605301883c$export$cf481ecf227135a8)\n};\n\n\n\n\n\nfunction $165d2995997b2f9b$export$35fa34e5af64bd4a(url, isEmbed) {\n    // window very small, modal might look bad\n    if (!isEmbed && (window.innerHeight < 500 || window.innerWidth < 700)) {\n        window.open(url);\n        return;\n    }\n    const iframe = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        tagName: \"iframe\",\n        custom: {\n            src: url\n        },\n        css: {\n            width: \"100%\",\n            height: \"100%\",\n            opacity: \"0\"\n        }\n    });\n    setTimeout(()=>{\n        iframe.style.opacity = \"\"; // fallback\n    }, 500);\n    const titleEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n    let linkEl;\n    if (!isEmbed) {\n        linkEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"a\",\n            parent: titleEl,\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"modal-new-tab\"),\n            custom: {\n                href: \"help\",\n                target: \"_blank\"\n            },\n            onClick: function() {\n                popup.close();\n            }\n        });\n        iframe.onload = ()=>{\n            if (linkEl && iframe.contentWindow) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).setAttributes(linkEl, {\n                href: \"\" + iframe.contentWindow.location\n            });\n            iframe.style.opacity = \"\";\n        };\n    }\n    const popup = new (0, $18361e3f5d6257e8$export$185108a9b725b68)({\n        title: titleEl,\n        content: iframe,\n        width: 880,\n        isMaxHeight: true,\n        onClose: ()=>{\n            if (linkEl) {\n                iframe.src = \"about:blank\";\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(linkEl);\n                linkEl = undefined;\n            }\n        }\n    });\n}\n\n\n\nclass $f734cb8286217c3c$export$3dff5655255b5729 {\n    getValue() {\n        for(let i = 0; i < this.inputs.length; i++){\n            if (this.inputs[i].checked) return this.inputs[i].value;\n        }\n        return null;\n    }\n    getElement() {\n        return this.el;\n    }\n    constructor({ name: name, init: init, items: items, ignoreFocus: ignoreFocus }){\n        this.inputs = [];\n        this.el = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-radio\"\n        });\n        items.forEach((item)=>{\n            const label = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                tagName: \"label\"\n            });\n            const input = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                tagName: \"input\",\n                parent: label,\n                custom: {\n                    name: name,\n                    value: item.value,\n                    type: \"radio\"\n                }\n            });\n            if (ignoreFocus) input.setAttribute(\"data-ignore-focus\", \"true\");\n            if (init === item.value) input.checked = true;\n            label.append(item.label);\n            this.el.append(label);\n            this.inputs.push(input);\n        });\n    }\n}\n\n\n\n\n\n\n\n\nclass $1a83f3b0ed28fe18$export$9c72cf485ef46673 {\n    updateAge() {\n        if (!this.timestamp) return;\n        let age = new Date().getTime() - this.timestamp;\n        let ageStr;\n        age = Math.floor(age / 1000 / 60);\n        ageStr = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-storage-min-ago\").replace(\"{x}\", \"\" + age);\n        if (age > 60) {\n            age = Math.floor(age / 60);\n            ageStr = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-storage-hours-ago\").replace(\"{x}\", \"\" + age);\n            if (age > 24) {\n                age = Math.floor(age / 24);\n                ageStr = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-storage-days-ago\").replace(\"{x}\", \"\" + age);\n                if (age > 31) ageStr = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-storage-month-ago\");\n            }\n        }\n        this.ageEl.textContent = ageStr;\n    }\n    resetButtons() {\n        if (this.timestamp) {\n            this.storeButtonEl.textContent = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-storage-overwrite\");\n            this.storeButtonEl.disabled = false;\n            this.clearButtonEl.disabled = false;\n        } else {\n            this.storeButtonEl.textContent = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-storage-store\");\n            this.storeButtonEl.disabled = false;\n            this.clearButtonEl.disabled = true;\n        }\n    }\n    updateThumb(timestamp, thumbnail) {\n        this.timestamp = timestamp;\n        this.thumbnail = thumbnail;\n        if (this.timestamp && thumbnail) {\n            thumbnail.classList.add(\"kl-storage-preview__im\");\n            this.previewEl.innerHTML = \"\";\n            this.updateAge();\n            this.previewEl.append(thumbnail, this.ageEl);\n        } else this.previewEl.innerHTML = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-storage-empty\");\n        this.resetButtons();\n    }\n    async store() {\n        this.storeButtonEl.textContent = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-storage-storing\");\n        this.storeButtonEl.disabled = true;\n        this.clearButtonEl.disabled = true;\n        await new Promise((resolve)=>{\n            setTimeout(()=>resolve(null), 20);\n        });\n        try {\n            await this.projectStore.store(this.getProject());\n            this.saveReminder.reset();\n        } catch (e) {\n            this.resetButtons();\n            (0, $49faab2330529a96$export$6e4a713ddcda1e5e).popup({\n                target: this.klRootEl,\n                type: \"error\",\n                message: [\n                    `${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-storage-failed-1\")}<ul>`,\n                    `<li>${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-storage-failed-2\")}</li>`,\n                    `<li>${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-storage-failed-3\")}</li>`,\n                    `<li>${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-storage-failed-4\")}</li>`,\n                    \"</ul>\"\n                ].join(\"\"),\n                buttons: [\n                    \"Ok\"\n                ]\n            });\n            setTimeout(()=>{\n                throw new Error(\"storage-ui: failed to store browser storage, \" + e);\n            }, 0);\n        }\n    }\n    async clear() {\n        this.storeButtonEl.disabled = true;\n        this.clearButtonEl.disabled = true;\n        try {\n            await this.projectStore.clear();\n        } catch (e) {\n            this.resetButtons();\n            (0, $49faab2330529a96$export$6e4a713ddcda1e5e).popup({\n                target: this.klRootEl,\n                type: \"error\",\n                message: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-storage-failed-clear\"),\n                buttons: [\n                    \"Ok\"\n                ]\n            });\n            setTimeout(()=>{\n                throw new Error(\"storage-ui: failed to clear browser storage, \" + e);\n            }, 0);\n        }\n    }\n    getElement() {\n        return this.element;\n    }\n    show() {\n    // todo\n    }\n    hide() {\n    // todo\n    }\n    destroy() {\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(this.infoEl);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(this.storeButtonEl);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(this.clearButtonEl);\n        (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).removeIsDarkListener(this.updateCheckerboard);\n        this.projectStore.unsubscribe(this.storeListener);\n    }\n    constructor(projectStore, getProject, saveReminder, klRootEl, options){\n        var _this_options;\n        this.projectStore = projectStore;\n        this.getProject = getProject;\n        this.saveReminder = saveReminder;\n        this.klRootEl = klRootEl;\n        this.options = options;\n        this.previewEl = {};\n        this.infoEl = {};\n        this.ageEl = {};\n        this.storeButtonEl = {};\n        this.clearButtonEl = {};\n        this.storeListener = {};\n        this.updateCheckerboard = ()=>{};\n        this.element = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                display: \"grid\",\n                gridTemplateColumns: \"1fr 0fr\",\n                gridTemplateRows: \"0fr 0fr 0fr\",\n                gap: \"0 0\",\n                gridTemplateAreas: '\"title title\" \"preview store\" \"preview clear\"'\n            }\n        });\n        const title = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.element,\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-storage\"),\n            css: {\n                gridArea: \"title\",\n                display: \"flex\",\n                margin: \"-5px 0\",\n                gap: \"5px\"\n            }\n        });\n        this.infoEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: title,\n            content: \"?\",\n            className: \"kl-info-btn\",\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-storage-about\"),\n            onClick: ()=>{\n                (0, $165d2995997b2f9b$export$35fa34e5af64bd4a)(\"./help/#help-browser-storage\", false);\n            }\n        });\n        if (this.projectStore.isBroken()) {\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                parent: this.element,\n                content: \"\\uD83D\\uDD34 \" + (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-storage-cant-access\"),\n                css: {\n                    marginTop: \"10px\"\n                }\n            });\n            return;\n        }\n        this.previewEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.element,\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-storage-thumb-title\"),\n            className: \"kl-storage-preview\"\n        });\n        this.ageEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                position: \"absolute\",\n                right: \"1px\",\n                bottom: \"1px\",\n                width: \"calc(100% - 2px)\",\n                textAlign: \"center\",\n                background: \"rgba(0,0,0,0.7)\",\n                color: \"#fff\",\n                textSize: \"13px\"\n            }\n        });\n        const btnCustom = (options === null || options === void 0 ? void 0 : options.isFocusable) ? {} : {\n            tabIndex: \"-1\"\n        };\n        this.storeButtonEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.element,\n            tagName: \"button\",\n            className: \"grid-button\",\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-storage-store\"),\n            css: {\n                gridArea: \"store\"\n            },\n            custom: btnCustom,\n            onClick: ()=>this.store()\n        });\n        this.clearButtonEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.element,\n            tagName: \"button\",\n            className: \"grid-button\",\n            content: '<img src=\"' + (0, (/*@__PURE__*/$parcel$interopDefault($4ef8c9863a7c659b$exports))) + '\" height=\"20\"/> ' + (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-storage-clear\"),\n            css: {\n                gridArea: \"clear\"\n            },\n            custom: btnCustom,\n            onClick: ()=>this.clear()\n        });\n        if ((_this_options = this.options) === null || _this_options === void 0 ? void 0 : _this_options.hideClearButton) this.clearButtonEl.style.visibility = \"hidden\";\n        this.storeListener = {\n            onUpdate: (timestamp, thumbnail)=>{\n                this.updateThumb(timestamp, thumbnail);\n            }\n        };\n        this.projectStore.subscribe(this.storeListener);\n        this.updateCheckerboard = ()=>{\n            if (!this.thumbnail) return;\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.thumbnail, {\n                background: \"url('\" + (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createCheckerCanvas(4, (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark()).toDataURL(\"image/png\") + \"')\"\n            });\n        };\n        (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).addIsDarkListener(this.updateCheckerboard);\n        setInterval(()=>this.updateAge(), 60000);\n        (async ()=>{\n            try {\n                const readResult = await this.projectStore.read();\n                if (readResult) this.updateThumb(readResult.timestamp, readResult.thumbnail);\n                else this.updateThumb();\n            } catch (e) {\n                setTimeout(()=>{\n                    throw new Error(\"storage-ui: failed initial read browser storage, \" + e);\n                }, 0);\n            }\n        })();\n    }\n}\n\n\n\n\n\nfunction $dda762a0c02e643a$export$b3fb17ae4345ac8f(base64Str) {\n    const parts = base64Str.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\n    const binStr = atob(parts[3]);\n    const buf = new ArrayBuffer(binStr.length);\n    const view = new Uint8Array(buf);\n    for(let i = 0; i < view.length; i++)view[i] = binStr.charCodeAt(i);\n    return new Blob([\n        view\n    ], {\n        \"type\": parts[1]\n    });\n}\n\n\nconst $c39dea662ab37110$var$thumbSize = 240;\nfunction $c39dea662ab37110$var$loadImage(blob) {\n    return new Promise((resolve, reject)=>{\n        const im = new Image();\n        try {\n            im.src = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).imageBlobToUrl(blob);\n        } catch (e) {\n            reject(\"imageBlobToUrl, \" + (e instanceof Error ? e.message : \"\"));\n            return;\n        }\n        im.onload = ()=>{\n            URL.revokeObjectURL(im.src);\n            resolve(im);\n        };\n        im.onabort = ()=>{\n            reject(\"layer image failed loading\");\n        };\n        im.onerror = ()=>{\n            reject(\"layer image failed loading\");\n        };\n    });\n}\nclass $c39dea662ab37110$export$f3c1ac6650038646 {\n    static createThumbnail(project) {\n        const size = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).fitInto(project.width, project.height, $c39dea662ab37110$var$thumbSize, $c39dea662ab37110$var$thumbSize);\n        const factor = size.width / project.width;\n        return (0, $2b8bf7b32e5ba51f$export$5f63a7b18dc4503a)(project, factor);\n    }\n    static createStorageProject(project) {\n        return {\n            id: 1,\n            timestamp: new Date().getTime(),\n            thumbnail: (0, $dda762a0c02e643a$export$b3fb17ae4345ac8f)($c39dea662ab37110$export$f3c1ac6650038646.createThumbnail(project).toDataURL(\"image/png\")),\n            width: project.width,\n            height: project.height,\n            layers: project.layers.map((item)=>{\n                let blob;\n                if (item.image instanceof HTMLCanvasElement) blob = (0, $dda762a0c02e643a$export$b3fb17ae4345ac8f)(item.image.toDataURL(\"image/png\"));\n                else // todo image\n                throw new Error(\"Not implemented\");\n                return {\n                    name: item.name,\n                    isVisible: item.isVisible,\n                    opacity: item.opacity,\n                    mixModeStr: item.mixModeStr,\n                    blob: blob\n                };\n            })\n        };\n    }\n    static async readStorageProject(storageProject) {\n        if (!storageProject.width || !storageProject.height || isNaN(storageProject.width) || isNaN(storageProject.height) || storageProject.width < 1 || storageProject.height < 1) throw new Error(\"readStorageProject invalid canvas size: \" + storageProject.width + \", \" + storageProject.height);\n        const project = {\n            width: storageProject.width,\n            height: storageProject.height,\n            layers: (await Promise.all(storageProject.layers.map((layer)=>$c39dea662ab37110$var$loadImage(layer.blob)))).map((image, i)=>{\n                const storageLayer = storageProject.layers[i];\n                return {\n                    name: storageLayer.name,\n                    isVisible: \"isVisible\" in storageLayer ? storageLayer.isVisible : true,\n                    opacity: storageLayer.opacity,\n                    mixModeStr: storageLayer.mixModeStr,\n                    image: image\n                };\n            })\n        };\n        let thumbnail;\n        if (storageProject.thumbnail) thumbnail = await $c39dea662ab37110$var$loadImage(storageProject.thumbnail);\n        else thumbnail = $c39dea662ab37110$export$f3c1ac6650038646.createThumbnail(project);\n        return {\n            project: project,\n            timestamp: storageProject.timestamp,\n            thumbnail: thumbnail\n        };\n    }\n}\n\n\n\n\nfunction $e42d359db0fc5c76$var$makeAsync(nonAsyncFunc) {\n    return new Promise((resolve, reject)=>{\n        nonAsyncFunc(resolve, reject);\n    });\n}\nclass $e42d359db0fc5c76$export$93d91060b9af7e2a {\n    async lowLevelStore(project) {\n        await new Promise((resolve, reject)=>{\n            (0, $c122457b67184bc9$export$21ade4eb935254aa)(project, resolve, reject);\n        });\n    }\n    async lowLevelRead() {\n        return await $e42d359db0fc5c76$var$makeAsync((0, $c122457b67184bc9$export$1448a0dd0d3fde8e));\n    }\n    async lowLevelClear() {\n        await $e42d359db0fc5c76$var$makeAsync((0, $c122457b67184bc9$export$42ffd38884aecdac));\n    }\n    emit(timestamp, thumbnail) {\n        this.listeners.forEach((item)=>{\n            item.onUpdate(timestamp, thumbnail);\n        });\n    }\n    updateTimestamp() {\n        (0, $0ecef66681b62a8c$export$19fffca37ef3e106).setItem(\"indexedDbUpdatedAt\", \"\" + new Date().getTime());\n    }\n    async read() {\n        let storageProject;\n        try {\n            storageProject = await this.lowLevelRead();\n        } catch (e) {\n            this.accessHasFailed = true;\n            throw new Error(\"db-error: \" + e);\n        }\n        if (!storageProject) return undefined;\n        let result;\n        try {\n            result = await (0, $c39dea662ab37110$export$f3c1ac6650038646).readStorageProject(storageProject);\n        } catch (e) {\n            throw new Error(\"format-error: \" + e);\n        }\n        return result;\n    }\n    async store(project) {\n        try {\n            const storageProject = (0, $c39dea662ab37110$export$f3c1ac6650038646).createStorageProject(project);\n            await this.lowLevelStore(storageProject);\n        } catch (e) {\n            this.accessHasFailed = true;\n            throw new Error(\"db-error: \" + e);\n        }\n        {\n            // immediately test if it can be read\n            const storageProject = await this.lowLevelRead();\n            let readResult;\n            try {\n                readResult = await (0, $c39dea662ab37110$export$f3c1ac6650038646).readStorageProject(storageProject);\n            } catch (e) {\n                await this.lowLevelClear();\n                this.updateTimestamp();\n                setTimeout(()=>this.emit(), 0);\n                throw new Error(\"format-error: \" + e);\n            }\n            this.updateTimestamp();\n            setTimeout(()=>this.emit(readResult.timestamp, readResult.thumbnail), 0);\n        }\n    }\n    async clear() {\n        await this.lowLevelClear();\n        this.updateTimestamp();\n        setTimeout(()=>this.emit(), 0);\n    }\n    subscribe(listener) {\n        if (this.listeners.includes(listener)) return;\n        this.listeners.push(listener);\n    }\n    unsubscribe(listener) {\n        for(let i = 0; i < this.listeners.length; i++)if (listener === this.listeners[i]) {\n            this.listeners.splice(i, 1);\n            return;\n        }\n    }\n    isBroken() {\n        return this.accessHasFailed;\n    }\n    // --- public ---\n    constructor(){\n        this.listeners = [];\n        this.accessHasFailed = false;\n        window.addEventListener(\"storage\", (e)=>{\n            if (e.key !== \"indexedDbUpdatedAt\" || this.listeners.length === 0) return;\n            try {\n                (async ()=>{\n                    const readResult = await this.read();\n                    if (readResult) this.emit(readResult.timestamp, readResult.thumbnail);\n                    else this.emit();\n                })();\n            } catch (e) {\n                if (e instanceof Error && e.message.indexOf(\"db-error\") === 0) this.accessHasFailed = true;\n            }\n        });\n    }\n}\n\n\n\n\n\n\n\n\n\nvar $ace2472bd08b6811$exports = {};\n\n$ace2472bd08b6811$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"upload.5289e924.svg\";\n\n\n\n\nclass $d75fb2183accd137$export$a2647fbf5f056b0a {\n    refresh() {}\n    getElement() {\n        return this.rootEl;\n    }\n    setIsVisible(isVisible) {\n        if (isVisible) this.refresh();\n    }\n    triggerImport() {\n        this.importButton && this.importButton.click();\n    }\n    constructor(klRootEl, projectStore, getProject, exportType, onExportTypeChange, onFileSelect, onSaveImageToComputer, onNewImage, onShareImage, onUpload, onCopyToClipboard, saveReminder){\n        this.exportType = exportType;\n        this.rootEl = document.createElement(\"div\");\n        const asyncCreation = ()=>{\n            const fileMenu = document.createElement(\"div\");\n            const newButton = document.createElement(\"button\");\n            const saveButton = document.createElement(\"button\");\n            const shareButton = document.createElement(\"button\");\n            const uploadImgurButton = document.createElement(\"button\");\n            const clipboardButton = document.createElement(\"button\");\n            newButton.style.cssFloat = \"left\";\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(saveButton, {\n                cssFloat: \"left\",\n                clear: \"both\",\n                flexGrow: \"1\"\n            });\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(clipboardButton, {\n                cssFloat: \"left\",\n                clear: \"both\"\n            });\n            newButton.tabIndex = -1;\n            saveButton.tabIndex = -1;\n            shareButton.tabIndex = -1;\n            uploadImgurButton.tabIndex = -1;\n            clipboardButton.tabIndex = -1;\n            newButton.innerHTML = `<img class=\"dark-no-invert\" src='${0, (/*@__PURE__*/$parcel$interopDefault($731c195c2658f60e$exports))}' alt='icon' height='20'/>${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-new\")}`;\n            saveButton.innerHTML = `<img src='${0, (/*@__PURE__*/$parcel$interopDefault($2612ca0d980e3a29$exports))}' alt='icon' height='20'/>${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-save\")}`;\n            shareButton.innerHTML = `<img src='${0, (/*@__PURE__*/$parcel$interopDefault($942db5a6ac0c3c49$exports))}' alt='icon' height='20'/>${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-share\")}`;\n            uploadImgurButton.innerHTML = `<img style='float:left' src='${0, (/*@__PURE__*/$parcel$interopDefault($ace2472bd08b6811$exports))}' height='20' alt='icon'/>${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-upload\")}`;\n            clipboardButton.innerHTML = `<img src='${0, (/*@__PURE__*/$parcel$interopDefault($832ede4dddff27fa$exports))}' alt='icon' height='20'/>${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-copy\")}`;\n            clipboardButton.title = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-copy-title\");\n            newButton.className = \"grid-button\";\n            saveButton.className = \"grid-button\";\n            shareButton.className = \"grid-button\";\n            uploadImgurButton.className = \"grid-button\";\n            clipboardButton.className = \"grid-button\";\n            const importWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                className: \"grid-button\",\n                css: {\n                    position: \"relative\",\n                    cursor: \"pointer\",\n                    cssFloat: \"left\"\n                }\n            });\n            const innerMask = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                parent: importWrapper,\n                css: {\n                    width: \"120px\",\n                    height: \"28px\",\n                    overflow: \"hidden\",\n                    cursor: \"pointer\",\n                    position: \"relative\"\n                }\n            });\n            this.importButton = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                tagName: \"input\",\n                parent: innerMask,\n                css: {\n                    display: \"none\"\n                }\n            });\n            this.importButton.tabIndex = -1;\n            this.importButton.type = \"file\";\n            this.importButton.multiple = true;\n            this.importButton.accept = \"image\";\n            this.importButton.size = 71;\n            this.importButton.onchange = ()=>{\n                if (!this.importButton) return;\n                this.importButton.files && onFileSelect(this.importButton.files, \"default\");\n                this.importButton.value = \"\";\n            };\n            const importFakeButton = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                tagName: \"button\",\n                parent: importWrapper,\n                content: \"<img class=\\\"dark-no-invert\\\" style='float:left' height='20' src='\" + (0, (/*@__PURE__*/$parcel$interopDefault($080ff6c52dc9a16e$exports))) + \"' alt='icon'/>\" + (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-import\"),\n                css: {\n                    width: \"120px\",\n                    display: \"box\",\n                    position: \"absolute\",\n                    left: \"0\",\n                    top: \"0\",\n                    cursor: \"pointer\"\n                }\n            });\n            importFakeButton.tabIndex = -1;\n            importFakeButton.onclick = ()=>this.importButton && this.importButton.click();\n            // --- export filetype dropdown ---\n            const exportTypeSelect = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).Select({\n                optionArr: [\n                    [\n                        \"png\",\n                        \"PNG\"\n                    ],\n                    [\n                        \"psd\",\n                        \"PSD\"\n                    ],\n                    [\n                        \"layers\",\n                        (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers\") + \" (PNG)\"\n                    ]\n                ],\n                initValue: this.exportType,\n                onChange: (val)=>{\n                    this.exportType = val;\n                    onExportTypeChange(this.exportType);\n                    onSaveImageToComputer();\n                },\n                title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-format\")\n            });\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(exportTypeSelect.getElement(), {\n                width: \"50%\",\n                height: \"30px\",\n                marginTop: \"10px\",\n                marginLeft: \"10px\"\n            });\n            newButton.onclick = onNewImage;\n            saveButton.onclick = ()=>{\n                onSaveImageToComputer();\n            };\n            shareButton.onclick = ()=>{\n                shareButton.disabled = true;\n                onShareImage(()=>{\n                    shareButton.disabled = false;\n                });\n            };\n            uploadImgurButton.onclick = ()=>onUpload();\n            clipboardButton.onclick = ()=>{\n                clipboardButton.blur();\n                onCopyToClipboard();\n            };\n            const saveNote = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                className: \"kl-toolspace-note\",\n                textContent: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-no-autosave\"),\n                css: {\n                    margin: \"10px 10px 0 10px\"\n                }\n            });\n            const createSpacer = ()=>{\n                const el = document.createElement(\"div\");\n                const clearer = document.createElement(\"div\");\n                const line = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    className: \"grid-hr\"\n                });\n                el.append(clearer, line);\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(clearer, {\n                    clear: \"both\"\n                });\n                return el;\n            };\n            this.fileBrowserStorage = new (0, $1a83f3b0ed28fe18$export$9c72cf485ef46673)(projectStore, getProject, saveReminder, klRootEl);\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.fileBrowserStorage.getElement(), {\n                //background: 'red',\n                margin: \"10px\"\n            });\n            const saveRow = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                content: [\n                    saveButton,\n                    exportTypeSelect.getElement()\n                ],\n                className: \"kl-file-save-row\"\n            });\n            //actual structure\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).append(fileMenu, [\n                saveNote,\n                newButton,\n                importWrapper,\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    css: {\n                        clear: \"both\"\n                    }\n                }),\n                saveRow,\n                clipboardButton,\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canShareFiles() ? shareButton : undefined,\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    css: {\n                        clear: \"both\"\n                    }\n                }),\n                createSpacer(),\n                this.fileBrowserStorage.getElement(),\n                createSpacer(),\n                uploadImgurButton\n            ]);\n            this.rootEl.append(fileMenu);\n        };\n        setTimeout(asyncCreation, 1);\n    }\n}\n\n\n\n\n\n\n\nfunction $ed5eddfb5f6912a0$export$d731e22ecd0c25d3(shader, uniforms, textureIn, textureOut) {\n    (textureIn || this._.texture).use();\n    this._.spareTexture.drawTo(function() {\n        shader.uniforms(uniforms).drawRect();\n    });\n    this._.spareTexture.swapWith(textureOut || this._.texture);\n}\n\n\nlet $ca843f6dd01906cb$export$5822a9d0880a5d82;\nfunction $ca843f6dd01906cb$export$b59c6427db8463f4(newGl) {\n    // more problems setting type to null\n    $ca843f6dd01906cb$export$5822a9d0880a5d82 = newGl;\n}\n\n\n\nconst $ba022370a1e95297$var$defaultVertexSource = \"    attribute vec2 vertex;    attribute vec2 _texCoord;    varying vec2 texCoord;    void main() {        texCoord = _texCoord;        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);    }\";\nconst $ba022370a1e95297$var$defaultFragmentSource = \"    uniform sampler2D texture;    varying vec2 texCoord;    void main() {        gl_FragColor = texture2D(texture, texCoord);    }\";\nfunction $ba022370a1e95297$var$isArray(obj) {\n    return Object.prototype.toString.call(obj) == \"[object Array]\";\n}\nfunction $ba022370a1e95297$var$isNumber(obj) {\n    return Object.prototype.toString.call(obj) == \"[object Number]\";\n}\nlet $ba022370a1e95297$var$floatPrecision;\nclass $ba022370a1e95297$export$7d9b0d118d0c4108 {\n    // ---- static ----\n    static getDefaultShader() {\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).defaultShader = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).defaultShader || new $ba022370a1e95297$export$7d9b0d118d0c4108();\n        return (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).defaultShader;\n    }\n    // ---- private ----\n    compileSource(type, source, nameStr) {\n        const shader = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).throwIfNull((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).createShader(type));\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).shaderSource(shader, source.replace(/#define.*/, \"\")); // glslify adds a line add the beginning that breaks it\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).compileShader(shader);\n        if (!(0, $ca843f6dd01906cb$export$5822a9d0880a5d82).getShaderParameter(shader, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).COMPILE_STATUS)) throw \"compile error: \" + nameStr + \" - \" + (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).getShaderInfoLog(shader);\n        return shader;\n    }\n    /**\n     * HIGH_FLOAT | MEDIUM_FLOAT\n     */ testPrecisionSupport(precisionType) {\n        const format = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).getShaderPrecisionFormat((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).FRAGMENT_SHADER, precisionType);\n        return format !== null && format.precision !== 0;\n    }\n    destroy() {\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).deleteProgram(this.program);\n        this.program = null;\n    }\n    uniforms(uniforms) {\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).useProgram(this.program);\n        Object.entries(uniforms).forEach(([name, value])=>{\n            const location = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).getUniformLocation(this.program, name);\n            if (location === null) // will be null if the uniform isn't used in the shader\n            return;\n            if ($ba022370a1e95297$var$isArray(value)) switch(value.length){\n                case 1:\n                    (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).uniform1fv(location, new Float32Array(value));\n                    break;\n                case 2:\n                    (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).uniform2fv(location, new Float32Array(value));\n                    break;\n                case 3:\n                    (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).uniform3fv(location, new Float32Array(value));\n                    break;\n                case 4:\n                    (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).uniform4fv(location, new Float32Array(value));\n                    break;\n                case 9:\n                    (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).uniformMatrix3fv(location, false, new Float32Array(value));\n                    break;\n                case 16:\n                    (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).uniformMatrix4fv(location, false, new Float32Array(value));\n                    break;\n                default:\n                    throw \"dont't know how to load uniform \\\"\" + name + '\" of length ' + value.length;\n            }\n            else if ($ba022370a1e95297$var$isNumber(value)) (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).uniform1f(location, value);\n            else throw 'attempted to set uniform \"' + name + '\" to invalid value ' + (value || \"undefined\").toString();\n        });\n        // allow chaining\n        return this;\n    }\n    //\n    /**\n     * textures are uniforms too but for some reason can't be specified by gl.uniform1f,\n     * even though floating point numbers represent the integers 0 through 7 exactly\n     */ textures(textures) {\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).useProgram(this.program);\n        Object.entries(textures).forEach(([name, value])=>{\n            (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).uniform1i((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).getUniformLocation(this.program, name), value);\n        });\n        // allow chaining\n        return this;\n    }\n    drawRect(left, top, right, bottom) {\n        let undefined;\n        const viewport = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).getParameter((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).VIEWPORT);\n        top = top !== undefined ? (top - viewport[1]) / viewport[3] : 0;\n        left = left !== undefined ? (left - viewport[0]) / viewport[2] : 0;\n        right = right !== undefined ? (right - viewport[0]) / viewport[2] : 1;\n        bottom = bottom !== undefined ? (bottom - viewport[1]) / viewport[3] : 1;\n        if ((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).vertexBuffer === undefined || (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).vertexBuffer === null) (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).vertexBuffer = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).throwIfNull((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).createBuffer());\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).bindBuffer((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).ARRAY_BUFFER, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).vertexBuffer);\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).bufferData((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).ARRAY_BUFFER, new Float32Array([\n            left,\n            top,\n            left,\n            bottom,\n            right,\n            top,\n            right,\n            bottom\n        ]), (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).STATIC_DRAW);\n        if ((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).texCoordBuffer == null) {\n            (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).texCoordBuffer = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).throwIfNull((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).createBuffer());\n            (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).bindBuffer((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).ARRAY_BUFFER, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).texCoordBuffer);\n            (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).bufferData((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).ARRAY_BUFFER, new Float32Array([\n                0,\n                0,\n                0,\n                1,\n                1,\n                0,\n                1,\n                1\n            ]), (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).STATIC_DRAW);\n        }\n        if (this.vertexAttribute == null) {\n            this.vertexAttribute = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).getAttribLocation(this.program, \"vertex\");\n            (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).enableVertexAttribArray(this.vertexAttribute);\n        }\n        if (this.texCoordAttribute == null) {\n            this.texCoordAttribute = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).getAttribLocation(this.program, \"_texCoord\");\n            (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).enableVertexAttribArray(this.texCoordAttribute);\n        }\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).useProgram(this.program);\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).bindBuffer((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).ARRAY_BUFFER, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).vertexBuffer);\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).vertexAttribPointer(this.vertexAttribute, 2, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).FLOAT, false, 0, 0);\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).bindBuffer((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).ARRAY_BUFFER, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).texCoordBuffer);\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).vertexAttribPointer(this.texCoordAttribute, 2, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).FLOAT, false, 0, 0);\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).drawArrays((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).TRIANGLE_STRIP, 0, 4);\n    }\n    // ---- public ----\n    constructor(vertexSource, fragmentSource, nameStr){\n        this.vertexAttribute = null;\n        this.texCoordAttribute = null;\n        this.program = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).throwIfNull((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).createProgram());\n        vertexSource = vertexSource || $ba022370a1e95297$var$defaultVertexSource;\n        fragmentSource = fragmentSource || $ba022370a1e95297$var$defaultFragmentSource;\n        if (!$ba022370a1e95297$var$floatPrecision) $ba022370a1e95297$var$floatPrecision = this.testPrecisionSupport((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).HIGH_FLOAT) ? \"highp\" : this.testPrecisionSupport((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).MEDIUM_FLOAT) ? \"mediump\" : \"lowp\";\n        fragmentSource = \"precision \" + $ba022370a1e95297$var$floatPrecision + \" float;\" + fragmentSource; // annoying requirement is annoying\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).attachShader(this.program, this.compileSource((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).VERTEX_SHADER, vertexSource, nameStr + \"(vertex)\"));\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).attachShader(this.program, this.compileSource((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).FRAGMENT_SHADER, fragmentSource, nameStr + \"(fragment)\"));\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).linkProgram(this.program);\n        if (!(0, $ca843f6dd01906cb$export$5822a9d0880a5d82).getProgramParameter(this.program, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).LINK_STATUS)) throw \"link error: \" + (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).getProgramInfoLog(this.program);\n    }\n}\n\n\n\nconst $7aae3f183f304a55$export$6408eeb1703e74b8 = function(brightness, contrast) {\n    (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).brightnessContrast = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).brightnessContrast || new (0, $ba022370a1e95297$export$7d9b0d118d0c4108)(null, \"        uniform sampler2D texture;        uniform float brightness;        uniform float contrast;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            color.rgb += brightness;            if (contrast > 0.0) {                color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;            } else {                color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;            }            gl_FragColor = color;        }    \", \"brightnessContrast\");\n    (0, $ed5eddfb5f6912a0$export$d731e22ecd0c25d3).call(this, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).brightnessContrast, {\n        brightness: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(brightness, -1, 1),\n        contrast: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(contrast, -1, 1)\n    });\n    return this;\n};\n\n\n\n\n\n\nclass $4f7270b6400c73d7$export$7e6fd232cff50dd1 {\n    // ---- static ----\n    static fromElement(element) {\n        const texture = new $4f7270b6400c73d7$export$7e6fd232cff50dd1(0, 0, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).RGBA, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).UNSIGNED_BYTE);\n        texture.loadContentsOf(element);\n        return texture;\n    }\n    loadContentsOf(element) {\n        this.width = element.width || element.videoWidth;\n        this.height = element.height || element.videoHeight;\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).bindTexture((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).TEXTURE_2D, this.id);\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).texImage2D((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).TEXTURE_2D, 0, this.format, this.format, this.type, element);\n    }\n    initFromBytes(width, height, data) {\n        this.width = width;\n        this.height = height;\n        this.format = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).RGBA;\n        this.type = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).UNSIGNED_BYTE;\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).bindTexture((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).TEXTURE_2D, this.id);\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).texImage2D((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).TEXTURE_2D, 0, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).RGBA, width, height, 0, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).RGBA, this.type, new Uint8Array(data));\n    }\n    destroy() {\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).deleteTexture(this.id);\n        this.id = null;\n    }\n    use(unit) {\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).activeTexture((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).TEXTURE0 + (unit || 0));\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).bindTexture((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).TEXTURE_2D, this.id);\n    }\n    unuse(unit) {\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).activeTexture((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).TEXTURE0 + (unit || 0));\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).bindTexture((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).TEXTURE_2D, null);\n    }\n    ensureFormat(width, height, format, type) {\n        // change the format only if required\n        if (width != this.width || height != this.height || format != this.format || type != this.type) {\n            this.width = width;\n            this.height = height;\n            this.format = format;\n            this.type = type;\n            (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).bindTexture((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).TEXTURE_2D, this.id);\n            (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).texImage2D((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\n        }\n    }\n    ensureFormatViaTexture(texture) {\n        this.ensureFormat(texture.width, texture.height, texture.format, texture.type);\n    }\n    drawTo(callback) {\n        // start rendering to this texture\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).framebuffer = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).framebuffer || (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).createFramebuffer();\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).bindFramebuffer((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).FRAMEBUFFER, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).framebuffer);\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).framebufferTexture2D((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).FRAMEBUFFER, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).COLOR_ATTACHMENT0, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).TEXTURE_2D, this.id, 0);\n        if ((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).checkFramebufferStatus((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).FRAMEBUFFER) !== (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).FRAMEBUFFER_COMPLETE) throw new Error(\"incomplete framebuffer\");\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).viewport(0, 0, this.width, this.height);\n        // do the drawing\n        callback();\n        // stop rendering to this texture\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).bindFramebuffer((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).FRAMEBUFFER, null);\n    }\n    /*\n    // never seen this being used\n    fillUsingCanvas (callback: (canvas: CanvasRenderingContext2D) => void): Texture {\n        callback(this.getCanvas(this));\n        this.format = gl.RGBA;\n        this.type = gl.UNSIGNED_BYTE;\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.canvas);\n        return this;\n    }\n\n    // never seen this being used\n    toImage (image: HTMLImageElement): void {\n        this.use();\n        Shader.getDefaultShader().drawRect();\n        const size = this.width * this.height * 4;\n        const pixels = new Uint8Array(size);\n        const c = this.getCanvas(this);\n        const data = c.createImageData(this.width, this.height);\n        gl.readPixels(0, 0, this.width, this.height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\n        for (let i = 0; i < size; i++) {\n            data.data[i] = pixels[i];\n        }\n        c.putImageData(data, 0, 0);\n        image.src = this.canvas.toDataURL();\n    }\n     */ swapWith(other) {\n        let temp;\n        temp = other.id;\n        other.id = this.id;\n        this.id = temp;\n        temp = other.width;\n        other.width = this.width;\n        this.width = temp;\n        temp = other.height;\n        other.height = this.height;\n        this.height = temp;\n        temp = other.format;\n        other.format = this.format;\n        this.format = temp;\n    // type?\n    }\n    /*\n    // never seen this being used\n    private getCanvas(texture: Texture): CanvasRenderingContext2D {\n        if (this.canvas == null) {\n            this.canvas = BB.canvas(texture.width, texture.height);\n        }\n        this.canvas.width = texture.width;\n        this.canvas.height = texture.height;\n        const c = BB.ctx(this.canvas);\n        c.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        return c;\n    }*/ // ---- public ----\n    constructor(width, height, format, type){\n        this.gl = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82);\n        this.id = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).throwIfNull((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).createTexture());\n        this.width = width;\n        this.height = height;\n        this.format = format;\n        this.type = type;\n        this.canvas = null;\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).bindTexture((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).TEXTURE_2D, this.id);\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).texParameteri((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).TEXTURE_2D, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).TEXTURE_MAG_FILTER, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).LINEAR);\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).texParameteri((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).TEXTURE_2D, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).TEXTURE_MIN_FILTER, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).LINEAR);\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).texParameteri((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).TEXTURE_2D, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).TEXTURE_WRAP_S, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).CLAMP_TO_EDGE);\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).texParameteri((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).TEXTURE_2D, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).TEXTURE_WRAP_T, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).CLAMP_TO_EDGE);\n        if (width && height) (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).texImage2D((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\n    }\n}\n\n\n\nfunction $6d7ade6aa4027844$export$4f237735eca1f248(points) {\n    const interpolator = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).SplineInterpolator(points);\n    const array = [];\n    for(let i = 0; i < 256; i++)array.push((0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(Math.floor(interpolator.interpolate(i / 255) * 256), 0, 255));\n    return array;\n}\n\n\n\n\n\nconst $38704cd148486d5a$export$6894093bf294bea5 = function(red, green, blue) {\n    // Create the ramp texture\n    const redRamp = (0, $6d7ade6aa4027844$export$4f237735eca1f248)(red);\n    const greenRamp = (0, $6d7ade6aa4027844$export$4f237735eca1f248)(green);\n    const blueRamp = (0, $6d7ade6aa4027844$export$4f237735eca1f248)(blue);\n    const array = [];\n    for(let i = 0; i < 256; i++)array.splice(array.length, 0, redRamp[i], greenRamp[i], blueRamp[i], 255);\n    this._.extraTexture.initFromBytes(256, 1, array);\n    this._.extraTexture.use(1);\n    (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).curves = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).curves || new (0, $ba022370a1e95297$export$7d9b0d118d0c4108)(null, \"        uniform sampler2D texture;        uniform sampler2D map;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);            color.r = texture2D(map, vec2(color.r)).r;            color.g = texture2D(map, vec2(color.g)).g;            color.b = texture2D(map, vec2(color.b)).b;            gl_FragColor = color;        }    \", \"curves\");\n    (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).curves.textures({\n        map: 1\n    });\n    (0, $ed5eddfb5f6912a0$export$d731e22ecd0c25d3).call(this, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).curves, {});\n    return this;\n};\n\n\n\n\n\n\nconst $f13b1fa3c138ed02$export$ef28bbbd731e79bf = function(hue, saturation) {\n    (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).hueSaturation = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).hueSaturation || new (0, $ba022370a1e95297$export$7d9b0d118d0c4108)(null, \"        uniform sampler2D texture;        uniform float hue;        uniform float saturation;        varying vec2 texCoord;        void main() {            vec4 color = texture2D(texture, texCoord);                        /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */            float angle = hue * 3.14159265;            float s = sin(angle), c = cos(angle);            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;            float len = length(color.rgb);            color.rgb = vec3(                dot(color.rgb, weights.xyz),                dot(color.rgb, weights.zxy),                dot(color.rgb, weights.yzx)            );                        /* saturation adjustment */            float average = (color.r + color.g + color.b) / 3.0;            if (saturation > 0.0) {                color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));            } else {                color.rgb += (average - color.rgb) * (-saturation);            }                        gl_FragColor = color;        }    \", \"hueSaturation\");\n    (0, $ed5eddfb5f6912a0$export$d731e22ecd0c25d3).call(this, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).hueSaturation, {\n        hue: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(hue, -1, 1),\n        saturation: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(saturation, -1, 1)\n    });\n    return this;\n};\n\n\n\n\n\nvar $c0f1e1206ce9bdf1$exports = {};\n$c0f1e1206ce9bdf1$exports = \"#define GLSLIFY 1\\nuniform sampler2D texture;\\nvarying vec2 texCoord;\\nuniform vec2 texSize;\\n\\nuniform float seed;\\nuniform float type;\\nuniform vec2 scale;\\nuniform vec2 offset;\\nuniform float octaves;\\nuniform float samples;\\n\\nuniform float peaks;\\nuniform float contrast;\\nuniform float brightness;\\nuniform float isReversed;\\n\\nuniform vec3 colA;\\nuniform vec3 colB;\\n\\nuniform float channels; // 0 - rgb, 1 - alpha\\n\\n// fbm, cellular_noise based on\\n// https://github.com/Gonkee/Gonkees-Shaders\\n// MIT, Copyright \\xa9 Gonkee\\n\\n// hash & simplex based on\\n// https://www.shadertoy.com/view/Msf3WH\\n// MIT, Copyright \\xa9 2013 Inigo Quilez\\n// https://www.youtube.com/c/InigoQuilez\\n// https://iquilezles.org\\n\\nfloat rand(vec2 co) {\\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\\n}\\n\\nfloat value_noise(vec2 coord){\\n    return rand(floor(coord) / 100.0);\\n}\\n\\nfloat cellular_noise(vec2 coord) {\\n    vec2 i = floor(coord);\\n    vec2 f = fract(coord);\\n\\n    float min_dist = 99999.0;\\n    for (float x = -1.0; x <= 1.0; x++) {\\n        for (float y = -1.0; y <= 1.0; y++) {\\n            vec2 node = rand(i + vec2(x, y)) + vec2(x, y);\\n            float dist = sqrt((f - node).x * (f - node).x + (f - node).y * (f - node).y);\\n            min_dist = min(min_dist, dist);\\n        }\\n    }\\n    return min_dist;\\n}\\n\\n// ---------- Simplex Alternative ---------------------\\n\\nvec3 hash(vec3 p)\\n{ p=vec3(dot(p, vec3(127.1, 311.7, 74.7))\\n, dot(p, vec3(269.5, 183.3, 246.1))\\n, dot(p, vec3(113.5, 271.9, 124.6)))\\n;return fract(sin(p)*43758.5453123)*2.-1.; }\\n\\nmat3 hash(mat3 p)\\n{ return mat3(hash(p[0]), hash(p[1]), hash(p[2])); }\\n\\nvec3 dots(mat3 a, vec3 w, mat3 b){ return vec3\\n(dot(a[0], w-b[0]), dot(a[1], w-b[1]), dot(a[2], w-b[2])); }\\n\\n//return noiseGra13dx as .x, and its derivatives as .yzw\\n// https://www.shadertoy.com/view/llByD1\\nvec3 noiseGra13dx(in vec3 x) {\\n    vec3 p=floor(x), w=fract(x)\\n    #if 1\\n    , u=w*w*w*(w*(w*6.-15.)+10.), v=30.*w*w*(w*(w-2.)+1.)//quintic hermite\\n    #else\\n    , u=w*w*(3.-2.*w), v=6.*w*(1.-w)//cubic hermite\\n    #endif\\n    //gradients\\n    , G=hash(p+vec3(0)), F=hash(p+vec3(1))\\n    ;mat3 D=hash(mat3(p, p, p)+mat3(1)), E=hash(mat3(p, p, p)+1.-mat3(1));\\n    //projections\\n    vec3 d=dots(D, w, mat3(1)), e=dots(E, w, 1.-mat3(1));\\n    //interpolations\\n    float g=dot(G, w), f=dot(F, w-vec3(1));\\n    vec3 h=u.yzx*(g-d.xyx-d.yzz+e.zxy)+d-g, U=u*h, a=d-e;\\n    mat3 S=D-mat3(G, G, G), W=D-E;\\n    a.x=(a.x+a.y+a.z)+f-g;\\n    ;float b=u.x*u.y*u.z;\\n\\n    vec4 result = vec4(g+U.x+U.y+U.z+a.x*b// value\\n    , G*(1.-b)+b*(W[0]+W[1]+W[2]+F)//https://www.shadertoy.com/view/llByD1\\n    +u.x*(S[0]+u.y*(G-D[0]-D[1]+E[2]))// derivatives\\n    +u.y*(S[1]+u.z*(G-D[1]-D[2]+E[0]))\\n    +u.z*(S[2]+u.x*(G-D[0]-D[2]+E[1]))\\n    +v*(u.zxy*(g-d.xxy-d.zyz+e.yzx)+h+u.yzx*u.zxy*a.x));\\n    return 0.5 + 0.5 * result.xxx;\\n}\\n\\nfloat fbm(vec2 coord) {\\n    float normalize_factor = 0.0;\\n    float value = 0.0;\\n    float scale = 0.5;\\n\\n    for (float i = 0.0; i < 7.0; i++){\\n        if (i < octaves) {\\n            if (type == 0.0) {\\n                value += value_noise(coord) * scale;\\n            } else if (type == 1.0) {\\n                value += noiseGra13dx(vec3(coord.x, coord.y, 0.0)).r * scale;\\n            } else if (type == 2.0) {\\n                value += cellular_noise(coord) * scale;\\n            }\\n            normalize_factor += scale;\\n            coord *= 2.0;\\n            scale *= 0.5;\\n        }\\n    }\\n    return value / normalize_factor;\\n}\\n\\nfloat render (vec2 pos) {\\n    float result = fbm(pos);\\n    //\\n\\n    if (peaks > 0.0) {\\n        result = abs(mod(result * peaks - 0.5, 1.0) - 0.5) * 2.0;// triangle\\n        //result = mod(result * (peaks + 1.0), 1.0); // sawtooth\\n    }\\n\\n    result += brightness;\\n    if (contrast > 0.0) {\\n        result = clamp((result - 0.5) / (1.0 - contrast) + 0.5, 0.0, 1.0);\\n    } else if (contrast < 0.0) {\\n        result = clamp((result - 0.5) * (1.0 + contrast) + 0.5, 0.0, 1.0);\\n    }\\n\\n    if (isReversed == 1.0) {\\n        result = 1.0 - result;\\n    }\\n    return result;\\n}\\n\\nvoid main() {\\n    vec4 color;\\n\\n    vec2 seedOffset;\\n    seedOffset.x = (rand(vec2(seed, 0.0)) * 100.0 - 50.0);\\n    seedOffset.y = (rand(vec2(0.0, seed)) * 100.0 - 50.0);\\n\\n    float val = 0.0;\\n    vec2 basePos = texCoord * texSize / scale - offset / scale + seedOffset;\\n\\n    if (samples == 1.0) {\\n        val = render(basePos);\\n\\n    }/* else if (samples == 4.0) {\\n        for (float i = 0.0; i < 2.0; i++) {\\n            for (float e = 0.0; e < 2.0; e++) {\\n                val += render(basePos + (vec2(i, e) - 0.5) * 0.5 / scale);\\n            }\\n        }\\n        val /= 4.0;\\n\\n    }*/ else if (samples == 16.0) {\\n        for (float i = 0.0; i < 4.0; i++) {\\n            for (float e = 0.0; e < 4.0; e++) {\\n                val += render(basePos + (vec2(i, e) - 0.25) * 0.25 / scale);\\n            }\\n        }\\n        val /= 16.0;\\n    }\\n\\n    if (channels == 0.0) {\\n        gl_FragColor = vec4(vec3(mix(colA, colB, val)), 1.0);\\n    } else {\\n        gl_FragColor = vec4(vec3(1.0), val);\\n    }\\n}\";\n\n\nconst $615309a02e3c3ec4$export$d3022aad56692482 = function(seed, type, scale, offset, octaves, samples, peaks, brightness, contrast, isReversed, colA, colB, channels) {\n    (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).noise = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).noise || new (0, $ba022370a1e95297$export$7d9b0d118d0c4108)(null, (0, (/*@__PURE__*/$parcel$interopDefault($c0f1e1206ce9bdf1$exports))).replace(/#define.*/, \"\"), \"noise\");\n    (0, $ed5eddfb5f6912a0$export$d731e22ecd0c25d3).call(this, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).noise, {\n        seed: seed || 0,\n        type: type,\n        scale: [\n            scale[0],\n            scale[1]\n        ],\n        offset: offset,\n        octaves: octaves,\n        samples: samples,\n        texSize: [\n            this.width,\n            this.height\n        ],\n        peaks: peaks,\n        brightness: brightness,\n        contrast: contrast,\n        isReversed: isReversed ? 1.0 : 0.0,\n        colA: colA ? [\n            colA.r / 255,\n            colA.g / 255,\n            colA.b / 255\n        ] : [\n            0,\n            0,\n            0\n        ],\n        colB: colB ? [\n            colB.r / 255,\n            colB.g / 255,\n            colB.b / 255\n        ] : [\n            1,\n            1,\n            1\n        ],\n        channels: channels === \"rgb\" ? 0 : 1\n    });\n    return this;\n};\n\n\n\n\n// returns a random number between 0 and 1\nconst $aec050322e5cb9b9$export$af69f7ca07da04c9 = \"    float random(vec3 scale, float seed) {        /* use the fragment position for a different seed per-pixel */        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);    }\";\n\n\n\nconst $c794506a27d0c6d6$export$6e852234f1597a14 = function(radius) {\n    (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).triangleBlur = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).triangleBlur || new (0, $ba022370a1e95297$export$7d9b0d118d0c4108)(null, \"        uniform sampler2D texture;        uniform vec2 delta;        varying vec2 texCoord;        \" + (0, $aec050322e5cb9b9$export$af69f7ca07da04c9) + \"        void main() {            vec4 color = vec4(0.0);            float total = 0.0;                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        for (float t = -30.0; t <= 30.0; t++) {                float percent = (t + offset - 0.5) / 30.0;                float weight = 1.0 - abs(percent);                vec4 sample = texture2D(texture, texCoord + delta * percent);                                color += sample * weight;                total += weight;            }                        gl_FragColor = color / total;        }    \", \"triangleBlur\");\n    (0, $ed5eddfb5f6912a0$export$d731e22ecd0c25d3).call(this, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).triangleBlur, {\n        delta: [\n            radius / this.width,\n            0\n        ]\n    });\n    (0, $ed5eddfb5f6912a0$export$d731e22ecd0c25d3).call(this, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).triangleBlur, {\n        delta: [\n            0,\n            radius / this.height\n        ]\n    });\n    return this;\n};\n\n\n\n\n\n\nconst $caa405d6896c91bf$export$4545acb2b6bb8f22 = function(startX, startY, endX, endY, blurRadius, gradientRadius) {\n    (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).tiltShift = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).tiltShift || new (0, $ba022370a1e95297$export$7d9b0d118d0c4108)(null, \"        uniform sampler2D texture;        uniform float blurRadius;        uniform float gradientRadius;        uniform vec2 start;        uniform vec2 end;        uniform vec2 delta;        uniform vec2 texSize;        varying vec2 texCoord;        \" + (0, $aec050322e5cb9b9$export$af69f7ca07da04c9) + \"        void main() {            vec4 color = vec4(0.0);            float total = 0.0;                        /* randomize the lookup values to hide the fixed number of samples */            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);                        vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));            float radius = smoothstep(0.0, 1.0, abs(dot(texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;            for (float t = -30.0; t <= 30.0; t++) {                float percent = (t + offset - 0.5) / 30.0;                float weight = 1.0 - abs(percent);                vec4 sample = texture2D(texture, texCoord + delta / texSize * percent * radius);                                color += sample * weight;                total += weight;            }                        gl_FragColor = color / total;        }    \", \"tiltShift\");\n    const dx = endX - startX;\n    const dy = endY - startY;\n    const d = Math.sqrt(dx * dx + dy * dy);\n    (0, $ed5eddfb5f6912a0$export$d731e22ecd0c25d3).call(this, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).tiltShift, {\n        blurRadius: blurRadius,\n        gradientRadius: gradientRadius,\n        start: [\n            startX,\n            startY\n        ],\n        end: [\n            endX,\n            endY\n        ],\n        delta: [\n            dx / d,\n            dy / d\n        ],\n        texSize: [\n            this.width,\n            this.height\n        ]\n    });\n    (0, $ed5eddfb5f6912a0$export$d731e22ecd0c25d3).call(this, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).tiltShift, {\n        blurRadius: blurRadius,\n        gradientRadius: gradientRadius,\n        start: [\n            startX,\n            startY\n        ],\n        end: [\n            endX,\n            endY\n        ],\n        delta: [\n            -dy / d,\n            dx / d\n        ],\n        texSize: [\n            this.width,\n            this.height\n        ]\n    });\n    return this;\n};\n\n\n\n\nfunction $83fc0aef7d823507$export$820b3a44cb7b2b21(uniformsStr, warpStr) {\n    return new (0, $ba022370a1e95297$export$7d9b0d118d0c4108)(null, uniformsStr + \"    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;    void main() {        vec2 coord = texCoord * texSize;        \" + warpStr + \"        gl_FragColor = texture2D(texture, coord / texSize);        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);        if (coord != clampedCoord) {            /* fade to transparent if we are outside the image */            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));        }    }\", \"warp\");\n}\n\n\n\nfunction $a7bdfb25622fe8b9$export$1c447127d27d7be4(x0, y0, x1, y1, x2, y2, x3, y3) {\n    const dx1 = x1 - x2;\n    const dy1 = y1 - y2;\n    const dx2 = x3 - x2;\n    const dy2 = y3 - y2;\n    const dx3 = x0 - x1 + x2 - x3;\n    const dy3 = y0 - y1 + y2 - y3;\n    const det = dx1 * dy2 - dx2 * dy1;\n    const a = (dx3 * dy2 - dx2 * dy3) / det;\n    const b = (dx1 * dy3 - dx3 * dy1) / det;\n    return [\n        x1 - x0 + a * x1,\n        y1 - y0 + a * y1,\n        a,\n        x3 - x0 + b * x3,\n        y3 - y0 + b * y3,\n        b,\n        x0,\n        y0,\n        1\n    ];\n}\nfunction $a7bdfb25622fe8b9$export$68b3343017e80691(m) {\n    const a = m[0], b = m[1], c = m[2];\n    const d = m[3], e = m[4], f = m[5];\n    const g = m[6], h = m[7], i = m[8];\n    const det = a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\n    return [\n        (e * i - f * h) / det,\n        (c * h - b * i) / det,\n        (b * f - c * e) / det,\n        (f * g - d * i) / det,\n        (a * i - c * g) / det,\n        (c * d - a * f) / det,\n        (d * h - e * g) / det,\n        (b * g - a * h) / det,\n        (a * e - b * d) / det\n    ];\n}\nfunction $a7bdfb25622fe8b9$export$2060d2db72cce88f(a, b) {\n    return [\n        a[0] * b[0] + a[1] * b[3] + a[2] * b[6],\n        a[0] * b[1] + a[1] * b[4] + a[2] * b[7],\n        a[0] * b[2] + a[1] * b[5] + a[2] * b[8],\n        a[3] * b[0] + a[4] * b[3] + a[5] * b[6],\n        a[3] * b[1] + a[4] * b[4] + a[5] * b[7],\n        a[3] * b[2] + a[4] * b[5] + a[5] * b[8],\n        a[6] * b[0] + a[7] * b[3] + a[8] * b[6],\n        a[6] * b[1] + a[7] * b[4] + a[8] * b[7],\n        a[6] * b[2] + a[7] * b[5] + a[8] * b[8]\n    ];\n}\n\n\nconst $4f209890e041e7d6$export$a93b0222aeadc54b = function(matrix, inverse, useTextureSpace) {\n    (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).matrixWarp = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).matrixWarp || (0, $83fc0aef7d823507$export$820b3a44cb7b2b21)(\"        uniform mat3 matrix;        uniform bool useTextureSpace;    \", \"        if (useTextureSpace) coord = coord / texSize * 2.0 - 1.0;        vec3 warp = matrix * vec3(coord, 1.0);        coord = warp.xy / warp.z;        if (useTextureSpace) coord = (coord * 0.5 + 0.5) * texSize;    \");\n    // Flatten all members of matrix into one big list\n    matrix = matrix.flat();\n    // Extract a 3x3 matrix out of the arguments\n    if (matrix.length == 4) matrix = [\n        matrix[0],\n        matrix[1],\n        0,\n        matrix[2],\n        matrix[3],\n        0,\n        0,\n        0,\n        1\n    ];\n    else if (matrix.length != 9) throw \"can only warp with 2x2 or 3x3 matrix\";\n    (0, $ed5eddfb5f6912a0$export$d731e22ecd0c25d3).call(this, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).matrixWarp, {\n        matrix: inverse ? (0, $a7bdfb25622fe8b9$export$68b3343017e80691)(matrix) : matrix,\n        texSize: [\n            this.width,\n            this.height\n        ],\n        useTextureSpace: useTextureSpace ? 1 : 0\n    });\n    return this;\n};\n\n\n\n\n\nconst $41fe2bf18cc268d3$export$915fb7313c578ba2 = function(radius, strength) {\n    (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).unsharpMask = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).unsharpMask || new (0, $ba022370a1e95297$export$7d9b0d118d0c4108)(null, \"        uniform sampler2D blurredTexture;        uniform sampler2D originalTexture;        uniform float strength;        uniform float threshold;        varying vec2 texCoord;        void main() {            vec4 blurred = texture2D(blurredTexture, texCoord);            vec4 original = texture2D(originalTexture, texCoord);            gl_FragColor = mix(blurred, original, 1.0 + strength);        }    \", \"unsharpMask\");\n    // Store a copy of the current texture in the second texture unit\n    this._.extraTexture.ensureFormatViaTexture(this._.texture);\n    this._.texture.use();\n    this._.extraTexture.drawTo(function() {\n        (0, $ba022370a1e95297$export$7d9b0d118d0c4108).getDefaultShader().drawRect();\n    });\n    // Blur the current texture, then use the stored texture to detect edges\n    this._.extraTexture.use(1);\n    this.triangleBlur(radius);\n    (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).unsharpMask.textures({\n        originalTexture: 1\n    });\n    (0, $ed5eddfb5f6912a0$export$d731e22ecd0c25d3).call(this, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).unsharpMask, {\n        strength: strength\n    });\n    this._.extraTexture.unuse(1);\n    return this;\n};\n\n\n\n\n\nconst $12b73c4d8c20eb5a$export$be1ee5ea42904fdc = function(isInverted, replaceRGBA) {\n    (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).toAlpha = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).toAlpha || new (0, $ba022370a1e95297$export$7d9b0d118d0c4108)(null, \"    uniform bool isInverted;    uniform vec4 replace;    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;        void main() {        vec4 color = texture2D(texture, texCoord);        float alpha = (color.r + color.g + color.b) / 3.0;        if (isInverted) alpha = 1.0 - alpha;        alpha = min(color.a, alpha);        if (replace.a > 0.0) color = replace;        gl_FragColor = vec4(color.r, color.g, color.b, alpha);    }\", \"toAlpha\");\n    (0, $ed5eddfb5f6912a0$export$d731e22ecd0c25d3).call(this, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).toAlpha, {\n        isInverted: isInverted ? 1 : 0,\n        replace: replaceRGBA ? [\n            replaceRGBA.r / 255,\n            replaceRGBA.g / 255,\n            replaceRGBA.b / 255,\n            replaceRGBA.a\n        ] : [\n            0,\n            0,\n            0,\n            0\n        ],\n        texSize: [\n            this.width,\n            this.height\n        ]\n    });\n    return this;\n};\n\n\n\n\n\nconst $6109e928236947f2$export$6897c284b6f9f4dc = function() {\n    (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).invert = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).invert || new (0, $ba022370a1e95297$export$7d9b0d118d0c4108)(null, \"    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;        void main() {        vec4 color = texture2D(texture, texCoord);        color.rgb = 1.0 - color.rgb;        gl_FragColor = color;    }\", \"invert\");\n    (0, $ed5eddfb5f6912a0$export$d731e22ecd0c25d3).call(this, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).invert, {\n        texSize: [\n            this.width,\n            this.height\n        ]\n    });\n    return this;\n};\n\n\n\nconst $7d03762724365e43$export$541149539f3a4684 = function(before, after) {\n    const a = (0, $a7bdfb25622fe8b9$export$1c447127d27d7be4)(...after);\n    const b = (0, $a7bdfb25622fe8b9$export$1c447127d27d7be4)(...before);\n    const c = (0, $a7bdfb25622fe8b9$export$2060d2db72cce88f)((0, $a7bdfb25622fe8b9$export$68b3343017e80691)(a), b);\n    return this.matrixWarp(c);\n};\n\n\n\n\n\nconst $1b7199a5e15fe4d8$export$b324c80262feb891 = function() {\n    (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).unmultiplyAlpha = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).unmultiplyAlpha || new (0, $ba022370a1e95297$export$7d9b0d118d0c4108)(null, \"    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;        void main() {        vec4 color = texture2D(texture, texCoord);        if(color.a > 0.0) {            color.rgb /= color.a;        }        gl_FragColor = color;    }\", \"unmultiplyAlpha\");\n    (0, $ed5eddfb5f6912a0$export$d731e22ecd0c25d3).call(this, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).unmultiplyAlpha, {\n        texSize: [\n            this.width,\n            this.height\n        ]\n    });\n    return this;\n};\n\n\n\n\n\nconst $8f4949fd56b66485$export$7c9b924528782480 = function(settings) {\n    (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).distort = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).distort || (0, $83fc0aef7d823507$export$820b3a44cb7b2b21)(`\n    uniform float stepSize;\n    uniform vec2 scale;\n    uniform vec2 strength;\n    uniform vec2 phase;\n    uniform float type;\n    uniform vec2 offset;\n`, `\n    const float PI = 3.14159265;\n    float x = coord.x + offset.x;\n    float y = coord.y + offset.y;\n    if (stepSize > 1.0) {\n        x = floor(x / stepSize) * stepSize;\n        y = floor(y / stepSize) * stepSize;\n    }\n    float distortX = sin((x/scale.x + phase.x) * PI * 2.0) * strength.x;\n    float distortY = sin((y/scale.y + phase.y) * PI * 2.0) * strength.y;\n    if (type == 0.0) {\n        coord.y += distortX;\n        coord.x += distortY;\n    } else if (type == 1.0) {\n        coord.x += distortX;\n        coord.y += distortY;\n    } else if (type == 2.0) {\n        x -= offset.x;\n        y -= offset.y;\n        gl_FragColor = texture2D(texture, vec2(x, y) / texSize);\n        coord.y += sin(gl_FragColor.r/scale.x*200.0 + phase.x * PI * 2.0) * strength.x;\n        coord.x += cos(gl_FragColor.g/scale.y*200.0 + phase.y * PI * 2.0) * strength.y;\n    }\n    coord.x = mod(coord.x, texSize.x);\n    coord.y = mod(coord.y, texSize.y);\n`);\n    (0, $ed5eddfb5f6912a0$export$d731e22ecd0c25d3).call(this, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).distort, {\n        stepSize: settings.stepSize,\n        type: settings.distortType,\n        scale: [\n            settings.scale.x,\n            settings.scale.y\n        ],\n        strength: [\n            settings.strength.x,\n            settings.strength.y\n        ],\n        phase: [\n            settings.phase.x,\n            settings.phase.y\n        ],\n        offset: [\n            settings.offset.x,\n            settings.offset.y\n        ],\n        texSize: [\n            this.width,\n            this.height\n        ]\n    });\n    return this;\n};\n\n\n\n\n\nconst $7b72315ed3e98576$export$57b05c961ff98d6a = function() {\n    (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).multiplyAlpha = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).multiplyAlpha || new (0, $ba022370a1e95297$export$7d9b0d118d0c4108)(null, \"    uniform sampler2D texture;    uniform vec2 texSize;    varying vec2 texCoord;        void main() {        vec4 color = texture2D(texture, texCoord);        color.rgb *= color.a;        gl_FragColor = color;    }\", \"multiplyAlpha\");\n    (0, $ed5eddfb5f6912a0$export$d731e22ecd0c25d3).call(this, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).multiplyAlpha, {\n        texSize: [\n            this.width,\n            this.height\n        ]\n    });\n    return this;\n};\n\n\n\nconst $03f71ba115904ed2$export$a04cfca62fd2892f = function() {\n    function wrapTexture(texture) {\n        return {\n            _: texture,\n            loadContentsOf: function(element) {\n                // Make sure that we're using the correct global WebGL context\n                (0, $ca843f6dd01906cb$export$b59c6427db8463f4)(this._.gl);\n                this._.loadContentsOf(element);\n            },\n            destroy: function() {\n                // Make sure that we're using the correct global WebGL context\n                (0, $ca843f6dd01906cb$export$b59c6427db8463f4)(this._.gl);\n                this._.destroy();\n            }\n        };\n    }\n    function texture(element) {\n        return wrapTexture((0, $4f7270b6400c73d7$export$7e6fd232cff50dd1).fromElement(element));\n    }\n    function getTextureType() {\n        let textureType = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).UNSIGNED_BYTE;\n        // Go for floating point buffer textures if we can, it'll make the bokeh\n        // filter look a lot better. Note that on Windows, ANGLE does not let you\n        // render to a floating-point texture when linear filtering is enabled.\n        // See http://crbug.com/172278 for more information.\n        if ((0, $ca843f6dd01906cb$export$5822a9d0880a5d82).getExtension(\"WEBGL_color_buffer_float\") && // firefox shows warning without this line\n        (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).getExtension(\"OES_texture_float\") && (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).getExtension(\"OES_texture_float_linear\")) {\n            const testTexture = new (0, $4f7270b6400c73d7$export$7e6fd232cff50dd1)(100, 100, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).RGBA, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).FLOAT);\n            try {\n                // Only use gl.FLOAT if we can render to it\n                testTexture.drawTo(function() {\n                    textureType = (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).FLOAT;\n                });\n            } catch (e) {\n            /* empty */ }\n            testTexture.destroy();\n        }\n        return textureType;\n    }\n    function initialize(width, height) {\n        const textureType = getTextureType();\n        if (this._.texture) this._.texture.destroy();\n        if (this._.spareTexture) this._.spareTexture.destroy();\n        this.width = width;\n        this.height = height;\n        this._.texture = new (0, $4f7270b6400c73d7$export$7e6fd232cff50dd1)(width, height, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).RGBA, textureType);\n        this._.spareTexture = new (0, $4f7270b6400c73d7$export$7e6fd232cff50dd1)(width, height, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).RGBA, textureType);\n        this._.extraTexture = this._.extraTexture || new (0, $4f7270b6400c73d7$export$7e6fd232cff50dd1)(0, 0, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).RGBA, textureType);\n        this._.flippedShader = this._.flippedShader || new (0, $ba022370a1e95297$export$7d9b0d118d0c4108)(null, `\nuniform sampler2D texture;\nvarying vec2 texCoord;\nvoid main() {\n    gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));\n}\n        `, \"flippedShader\");\n        this._.isInitialized = true;\n    }\n    function draw(texture, width, height) {\n        if (!this._.isInitialized || texture._.width != this.width || texture._.height != this.height) initialize.call(this, width ? width : texture._.width, height ? height : texture._.height);\n        texture._.use();\n        this._.texture.drawTo(function() {\n            (0, $ba022370a1e95297$export$7d9b0d118d0c4108).getDefaultShader().drawRect();\n        });\n        return this;\n    }\n    function update() {\n        this._.texture.use();\n        this._.flippedShader.drawRect();\n        return this;\n    }\n    function contents() {\n        const texture = new (0, $4f7270b6400c73d7$export$7e6fd232cff50dd1)(this._.texture.width, this._.texture.height, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).RGBA, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).UNSIGNED_BYTE);\n        this._.texture.use();\n        texture.drawTo(function() {\n            (0, $ba022370a1e95297$export$7d9b0d118d0c4108).getDefaultShader().drawRect();\n        });\n        return wrapTexture(texture);\n    }\n    /*\n       Get a Uint8 array of pixel values: [r, g, b, a, r, g, b, a, ...]\n       Length of the array will be width * height * 4.\n    */ function getPixelArray() {\n        const w = this._.texture.width;\n        const h = this._.texture.height;\n        const array = new Uint8Array(w * h * 4);\n        this._.texture.drawTo(function() {\n            (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).readPixels(0, 0, w, h, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).RGBA, (0, $ca843f6dd01906cb$export$5822a9d0880a5d82).UNSIGNED_BYTE, array);\n        });\n        return array;\n    }\n    function wrap(fn) {\n        return function(...args) {\n            // Make sure that we're using the correct global WebGL context\n            (0, $ca843f6dd01906cb$export$b59c6427db8463f4)(this._.gl);\n            // Now that the context has been switched, we can call the wrapped function\n            return fn.apply(this, args);\n        };\n    }\n    function getWebGlContext(canvas, options) {\n        const contextNames = [\n            \"webgl\",\n            \"experimental-webgl\",\n            \"webgl2\"\n        ];\n        let context = null;\n        contextNames.forEach((name)=>{\n            if (context) return;\n            // get.webgl.org does a try-catch\n            try {\n                context = canvas.getContext(name, options);\n            } catch (e) {\n            /* empty */ }\n        });\n        return context;\n    }\n    return ()=>{\n        if (!window.WebGLRenderingContext) throw \"WebGLRenderingContext not set. Browser does not support WebGL.\";\n        const canvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(1, 1);\n        const context = getWebGlContext(canvas, {\n            premultipliedAlpha: false\n        });\n        if (!context) throw \"This browser does not support WebGL\";\n        (0, $ca843f6dd01906cb$export$b59c6427db8463f4)(context);\n        canvas._ = {\n            gl: $ca843f6dd01906cb$export$5822a9d0880a5d82,\n            isInitialized: false,\n            texture: null,\n            spareTexture: null,\n            flippedShader: null\n        };\n        // Core methods\n        canvas.texture = wrap(texture);\n        canvas.draw = wrap(draw);\n        canvas.update = wrap(update);\n        canvas.contents = wrap(contents);\n        canvas.getPixelArray = wrap(getPixelArray);\n        // Filter methods\n        canvas.brightnessContrast = wrap((0, $7aae3f183f304a55$export$6408eeb1703e74b8));\n        canvas.hueSaturation = wrap((0, $f13b1fa3c138ed02$export$ef28bbbd731e79bf));\n        canvas.triangleBlur = wrap((0, $c794506a27d0c6d6$export$6e852234f1597a14));\n        canvas.unsharpMask = wrap((0, $41fe2bf18cc268d3$export$915fb7313c578ba2));\n        canvas.perspective = wrap((0, $7d03762724365e43$export$541149539f3a4684));\n        canvas.matrixWarp = wrap((0, $4f209890e041e7d6$export$a93b0222aeadc54b));\n        canvas.tiltShift = wrap((0, $caa405d6896c91bf$export$4545acb2b6bb8f22));\n        canvas.noise = wrap((0, $615309a02e3c3ec4$export$d3022aad56692482));\n        canvas.curves = wrap((0, $38704cd148486d5a$export$6894093bf294bea5));\n        canvas.invert = wrap((0, $6109e928236947f2$export$6897c284b6f9f4dc));\n        canvas.multiplyAlpha = wrap((0, $7b72315ed3e98576$export$57b05c961ff98d6a));\n        canvas.unmultiplyAlpha = wrap((0, $1b7199a5e15fe4d8$export$b324c80262feb891));\n        canvas.toAlpha = wrap((0, $12b73c4d8c20eb5a$export$be1ee5ea42904fdc));\n        canvas.distort = wrap((0, $8f4949fd56b66485$export$7c9b924528782480));\n        return canvas;\n    };\n}();\n\n\nlet $5caaf17bca0749c7$var$failed = false;\nlet $5caaf17bca0749c7$var$fx = null;\nfunction $5caaf17bca0749c7$export$8c4423af32b21158() {\n    // failed previously, don't need to try again.\n    if ($5caaf17bca0749c7$var$failed) return $5caaf17bca0749c7$var$fx;\n    if (!$5caaf17bca0749c7$var$fx || $5caaf17bca0749c7$var$fx._.gl.isContextLost()) try {\n        $5caaf17bca0749c7$var$fx = (0, $03f71ba115904ed2$export$a04cfca62fd2892f)();\n    } catch (e) {\n        $5caaf17bca0749c7$var$failed = true;\n        $5caaf17bca0749c7$var$fx = null;\n        setTimeout(()=>{\n            throw e;\n        });\n    }\n    return $5caaf17bca0749c7$var$fx;\n}\n\n\n\nclass $755328ebbc58db18$export$3f17d740ad471e50 {\n    testHasWebGL() {\n        return !!(0, $5caaf17bca0749c7$export$8c4423af32b21158)();\n    }\n    init() {\n        const filters = (0, $49faab2330529a96$export$6e4a713ddcda1e5e).filterLib;\n        const buttons = [];\n        if (!(0, $49faab2330529a96$export$6e4a713ddcda1e5e).filterLibStatus.isLoaded) throw new Error(\"filters not loaded\");\n        const hasWebGL = this.testHasWebGL();\n        if (!hasWebGL) {\n            const note = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                parent: this.rootEl,\n                className: \"kl-toolspace-note\",\n                content: \"Features disabled because WebGL is failing.\",\n                css: {\n                    margin: \"10px\",\n                    marginBottom: \"0\"\n                }\n            });\n            const noteButton = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                parent: note,\n                tagName: \"button\",\n                textContent: \"Learn More\",\n                css: {\n                    marginLeft: \"5px\"\n                }\n            });\n            noteButton.onclick = ()=>{\n                (0, $49faab2330529a96$export$6e4a713ddcda1e5e).popup({\n                    target: this.klRootEl,\n                    message: \"<b>WebGL is not working</b>\",\n                    div: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                        content: `\nSee if your browser supports WebGL and has it enabled: <a href=\"https://get.webgl.org\" target=\"_blank\" rel=\"noopener noreferrer\">get.webgl.org</a><br>\n<br>\nRecently (2023-05) a number of Chrome users on Chrome OS reported that WebGL fails, although it is enabled & supported.\nThis has been reported to Google.\n`\n                    }),\n                    buttons: [\n                        \"Ok\"\n                    ],\n                    clickOnEnter: \"Ok\"\n                });\n            };\n        }\n        const createButton = (filterKey)=>{\n            const filter = filters[filterKey];\n            const button = document.createElement(\"button\");\n            const buttonLabel = (0, $63d0b335c576c718$export$ce37e184d908d785)(filter.lang.button);\n            const imClass = filter.darkNoInvert ? 'class=\"dark-no-invert\"' : \"\";\n            const im = \"<img \" + imClass + ' height=\"20\" width=\"18\" src=\"' + filter.icon + '\" style=\"margin-right: 3px\" alt=\"icon\" />';\n            button.innerHTML = im + buttonLabel;\n            button.className = \"grid-button grid-button--filter\";\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(button, {\n                lineHeight: \"20px\",\n                fontSize: \"12px\"\n            });\n            button.tabIndex = -1;\n            const filterName = (0, $63d0b335c576c718$export$ce37e184d908d785)(filter.lang.name);\n            let isEnabled = true;\n            if (filter.webGL && !hasWebGL) isEnabled = false;\n            if (isEnabled) button.onclick = ()=>{\n                const dialogButtons = [\n                    \"Ok\",\n                    \"Cancel\"\n                ];\n                const finishedDialog = (result, filterDialog)=>{\n                    if (\"error\" in filterDialog) return;\n                    if (result == \"Cancel\") {\n                        if (filterDialog.destroy) filterDialog.destroy();\n                        return;\n                    }\n                    let input;\n                    try {\n                        input = filterDialog.getInput(); // also destroys\n                    } catch (e) {\n                        if (e.message.indexOf(\".getInput is not a function\") !== -1) throw \"filterDialog.getInput is not a function, filter: \" + filterName;\n                        else throw e;\n                    }\n                    applyFilter(input);\n                };\n                if (!(\"apply\" in filters[filterKey])) {\n                    (0, $49faab2330529a96$export$6e4a713ddcda1e5e).popup({\n                        target: this.klRootEl,\n                        message: \"Application not fully loaded\",\n                        type: \"error\"\n                    });\n                    return;\n                }\n                const applyFilter = (input)=>{\n                    const filterResult = filters[filterKey].apply({\n                        context: this.getCurrentLayerCtx(),\n                        klCanvas: this.getKlCanvas(),\n                        history: (0, $d2dccce11beb16cf$export$28b6f4d98dde9845),\n                        input: input\n                    });\n                    if (filterResult === false) (0, $49faab2330529a96$export$6e4a713ddcda1e5e).popup({\n                        target: this.klRootEl,\n                        message: \"Couldn't apply the edit action\",\n                        type: \"error\"\n                    });\n                    if (filters[filterKey].updatePos === true) {\n                        this.klCanvasWorkspace.resetOrFitView();\n                        this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n                    }\n                    this.layerManager.update();\n                };\n                if (filters[filterKey].isInstant) {\n                    button.blur();\n                    applyFilter(null);\n                    this.statusOverlay.out('\"' + filterName + '\" ' + (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-applied\"), true);\n                } else {\n                    const secondaryColorRGB = this.klColorSlider.getSecondaryRGB();\n                    let filterDialog = undefined;\n                    try {\n                        filterDialog = filters[filterKey].getDialog({\n                            context: this.getCurrentLayerCtx(),\n                            klCanvas: this.getKlCanvas(),\n                            maxWidth: this.getKlMaxCanvasSize(),\n                            maxHeight: this.getKlMaxCanvasSize(),\n                            currentColorRgb: {\n                                r: this.getCurrentColor().r,\n                                g: this.getCurrentColor().g,\n                                b: this.getCurrentColor().b\n                            },\n                            secondaryColorRgb: {\n                                r: secondaryColorRGB.r,\n                                g: secondaryColorRGB.g,\n                                b: secondaryColorRGB.b\n                            }\n                        });\n                    } catch (e) {\n                        setTimeout(()=>{\n                            throw e;\n                        });\n                    }\n                    if (!filterDialog || \"error\" in filterDialog) {\n                        (0, $49faab2330529a96$export$6e4a713ddcda1e5e).popup({\n                            target: this.klRootEl,\n                            message: filterDialog ? filterDialog.error : \"Error: Could not perform action.\",\n                            type: \"error\"\n                        });\n                        return;\n                    }\n                    let closeFunc;\n                    // Todo should move into getDialogParams\n                    filterDialog.errorCallback = (e)=>{\n                        (0, $49faab2330529a96$export$6e4a713ddcda1e5e).popup({\n                            target: this.klRootEl,\n                            message: \"Error: Could not perform action.\",\n                            type: \"error\"\n                        });\n                        setTimeout(()=>{\n                            throw e;\n                        }, 0);\n                        closeFunc();\n                    };\n                    const style = {};\n                    if (\"width\" in filterDialog) style.width = filterDialog.width + \"px\";\n                    let title;\n                    {\n                        const els = [\n                            (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\"b\", filterName)\n                        ];\n                        if (filter.lang.description !== undefined) els.push((0, $934e5f47c3374e21$export$db3b6bfb95261072)({\n                            className: \"kl-info-btn\",\n                            onClick: ()=>{\n                                (0, $49faab2330529a96$export$6e4a713ddcda1e5e).popup({\n                                    target: this.klRootEl,\n                                    message: (0, $63d0b335c576c718$export$ce37e184d908d785)(filter.lang.description)\n                                });\n                            },\n                            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(filter.lang.description),\n                            noRef: true\n                        }, \"?\"));\n                        title = (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\",flex,gap-5\", els);\n                    }\n                    (0, $49faab2330529a96$export$6e4a713ddcda1e5e).popup({\n                        target: this.klRootEl,\n                        message: title,\n                        div: filterDialog.element,\n                        style: style,\n                        buttons: dialogButtons,\n                        clickOnEnter: \"Ok\",\n                        callback: (result)=>{\n                            finishedDialog(result, filterDialog);\n                        },\n                        closeFunc: (func)=>{\n                            closeFunc = func;\n                        }\n                    });\n                }\n            };\n            else button.disabled = true;\n            buttons.push(button);\n            return button;\n        };\n        const addGroup = (groupArr)=>{\n            Object.entries(filters).forEach(([filterKey, filter])=>{\n                if (!groupArr.includes(filterKey)) return;\n                if (this.isEmbed && !filter.inEmbed) return;\n                this.rootEl.append(createButton(filterKey));\n            });\n        };\n        const groupA = [\n            \"cropExtend\",\n            \"flip\",\n            \"perspective\",\n            \"resize\",\n            \"rotate\",\n            \"transform\"\n        ];\n        const groupB = [\n            \"brightnessContrast\",\n            \"curves\",\n            \"distort\",\n            \"hueSaturation\",\n            \"invert\",\n            \"tiltShift\",\n            \"toAlpha\",\n            \"blur\",\n            \"unsharpMask\"\n        ];\n        const groupC = [\n            \"grid\",\n            \"noise\",\n            \"pattern\",\n            \"vanishPoint\"\n        ];\n        addGroup(groupA);\n        this.rootEl.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"grid-hr\"\n        }));\n        addGroup(groupB);\n        this.rootEl.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"grid-hr\"\n        }));\n        addGroup(groupC);\n        this.isInit = true;\n    }\n    getElement() {\n        return this.rootEl;\n    }\n    show() {\n        if (!this.isInit) this.init();\n        this.rootEl.style.display = \"block\";\n    }\n    hide() {\n        this.rootEl.style.display = \"none\";\n    }\n    constructor(klRootEl, klColorSlider, layerManager, klCanvasWorkspace, handUi, getCurrentColor, getKlMaxCanvasSize, getKlCanvas, getCurrentLayerCtx, isEmbed, statusOverlay){\n        this.klRootEl = klRootEl;\n        this.klColorSlider = klColorSlider;\n        this.layerManager = layerManager;\n        this.klCanvasWorkspace = klCanvasWorkspace;\n        this.handUi = handUi;\n        this.getCurrentColor = getCurrentColor;\n        this.getKlMaxCanvasSize = getKlMaxCanvasSize;\n        this.getKlCanvas = getKlCanvas;\n        this.getCurrentLayerCtx = getCurrentLayerCtx;\n        this.isEmbed = isEmbed;\n        this.statusOverlay = statusOverlay;\n        this.isInit = false;\n        this.rootEl = document.createElement(\"div\");\n    }\n}\n\n\n\n\n\n\nvar $9add721614c7ca2f$exports = {};\n\n$9add721614c7ca2f$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"loading.7ff8a2ac.gif\";\n\n\n/**\n * uploads canvas, opens new tab with the upload progress & then opens the image page.\n */ async function $1acd53d54391923e$var$upload(canvas, title, description, type, imgurKey) {\n    const img = (0, $dda762a0c02e643a$export$b3fb17ae4345ac8f)(canvas.toDataURL(\"image/\" + type));\n    const w = window.open();\n    if (!w) throw new Error(\"could not create new tab\");\n    const label = w.document.createElement(\"div\");\n    const gif = w.document.createElement(\"img\");\n    gif.src = (0, (/*@__PURE__*/$parcel$interopDefault($9add721614c7ca2f$exports)));\n    label.append(gif);\n    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(gif, {\n        filter: \"invert(1)\"\n    });\n    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(w.document.body, {\n        backgroundColor: \"#121211\",\n        backgroundImage: \"linear-gradient(#2b2b2b 0%, #121211 50%)\",\n        backgroundRepeat: \"no-repeat\"\n    });\n    const labelText = w.document.createElement(\"div\");\n    labelText.style.marginTop = \"10px\";\n    label.append(labelText);\n    labelText.textContent = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"upload-uploading\");\n    w.document.body.append(label);\n    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(label, {\n        marginLeft: \"auto\",\n        marginRight: \"auto\",\n        marginTop: \"100px\",\n        fontFamily: \"system-ui, sans-serif\",\n        fontSize: \"20px\",\n        textAlign: \"center\",\n        transition: \"opacity 0.3s ease-in-out\",\n        opacity: \"0\",\n        color: \"#ccc\"\n    });\n    setTimeout(function() {\n        label.style.opacity = \"1\";\n    }, 20);\n    let response;\n    try {\n        const formData = new FormData();\n        formData.append(\"title\", title);\n        formData.append(\"description\", description);\n        formData.append(\"image\", img);\n        response = await fetch(\"https://api.imgur.com/3/image\", {\n            method: \"POST\",\n            headers: {\n                Authorization: \"Client-ID \" + imgurKey\n            },\n            body: formData\n        });\n    } catch (e) {\n        w.close();\n        throw e;\n    }\n    if (!response.ok) {\n        w.close();\n        throw new Error();\n    }\n    const data = (await response.json()).data;\n    w.location.href = data.link.replace(/\\.(jpg|png)/, \"\");\n    return data;\n}\nfunction $1acd53d54391923e$export$b1dd62fa0b5f32f5(klCanvas, klRootEl, saveReminder, imgurKey) {\n    if (!imgurKey) throw new Error(\"imgur key missing\");\n    const inputTitle = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        tagName: \"input\"\n    });\n    inputTitle.type = \"text\";\n    inputTitle.value = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"upload-title-untitled\");\n    const inputDescription = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        tagName: \"textarea\",\n        custom: {\n            rows: \"2\"\n        },\n        css: {\n            width: \"100%\",\n            maxWidth: \"100%\"\n        }\n    });\n    const labelTitle = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        textContent: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"upload-name\") + \":\"\n    });\n    const labelDescription = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        textContent: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"upload-caption\") + \":\",\n        css: {\n            marginTop: \"10px\"\n        }\n    });\n    const tos = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        content: `<br/><a href=\"https://imgur.com/tos\" target=\"_blank\" rel=\"noopener noreferrer\">${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"terms-of-service\")}</a>`\n    });\n    const typeRadio = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).RadioList({\n        name: \"filetype\",\n        init: \"jpeg\",\n        items: [\n            {\n                label: \"JPG\",\n                value: \"jpeg\"\n            },\n            {\n                label: \"PNG\",\n                value: \"png\"\n            }\n        ],\n        ignoreFocus: true\n    });\n    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(typeRadio.getElement(), {\n        marginBottom: \"10px\"\n    });\n    const outDiv = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n    const infoHint = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n        className: \"info-hint\",\n        textContent: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"upload-link-notice\")\n    });\n    outDiv.append(infoHint, typeRadio.getElement(), labelTitle, inputTitle, labelDescription, inputDescription, tos);\n    (0, $49faab2330529a96$export$6e4a713ddcda1e5e).popup({\n        target: klRootEl,\n        message: `<b>${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"upload-title\")}</b>`,\n        type: \"upload\",\n        div: outDiv,\n        buttons: [\n            (0, $63d0b335c576c718$export$ce37e184d908d785)(\"upload-submit\"),\n            \"Cancel\"\n        ],\n        clickOnEnter: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"upload-submit\"),\n        primaries: [\n            (0, $63d0b335c576c718$export$ce37e184d908d785)(\"upload-submit\")\n        ],\n        autoFocus: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"upload-submit\"),\n        callback: async function(val) {\n            if (val === (0, $63d0b335c576c718$export$ce37e184d908d785)(\"upload-submit\") || val === \"Yes\" || val === \"Ok\") try {\n                const result = await $1acd53d54391923e$var$upload(klCanvas.getCompleteCanvas(1), inputTitle.value, inputDescription.value, typeRadio.getValue(), imgurKey);\n                (0, $49faab2330529a96$export$6e4a713ddcda1e5e).popup({\n                    target: klRootEl,\n                    type: \"ok\",\n                    message: `<h3>${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"upload-success\")}</h3><br>${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"upload-delete\")}<br><a target='_blank' rel=\"noopener noreferrer\" href='https://imgur.com/delete/${result.deletehash}'>imgur.com/delete/${result.deletehash}</a><br><br>`,\n                    buttons: [\n                        \"Ok\"\n                    ]\n                });\n                saveReminder.reset();\n            } catch (e) {\n                (0, $49faab2330529a96$export$6e4a713ddcda1e5e).popup({\n                    target: klRootEl,\n                    type: \"error\",\n                    message: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"upload-failed\"),\n                    buttons: [\n                        \"Ok\"\n                    ]\n                });\n            }\n        }\n    });\n}\n\n\nlet $e4b3248b4ce95ea5$var$agPsdLazy;\n\nasync function $e4b3248b4ce95ea5$export$ab3d838b1d336b38() {\n    if (!$e4b3248b4ce95ea5$var$agPsdLazy) $e4b3248b4ce95ea5$var$agPsdLazy = await (parcelRequire(\"k6Jw8\"));\n    return $e4b3248b4ce95ea5$var$agPsdLazy;\n}\n\n\n\n\n\n\nconst $5ecc5a61dcd332b6$var$unsavedActionsLimit = 100; // number of actions user did since last save\nconst $5ecc5a61dcd332b6$var$LS_REMINDER_KEY = \"kl-save-reminder\";\nclass $5ecc5a61dcd332b6$export$befc6437ad34b28a {\n    showPopup() {\n        if (!this.projectStore || !this.getProject) throw new Error(\"projectStore and getProject need to be set\");\n        const min = Math.round((performance.now() - this.lastSavedAt) / 1000 / 60);\n        const contentEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        contentEl.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"save-reminder-text\", {\n                a: \"<strong>\" + min,\n                b: \"</strong>\"\n            }),\n            css: {\n                marginBottom: \"20px\"\n            }\n        }));\n        const psdWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                borderTop: \"1px solid #aaa\",\n                margin: \"0 -20px\",\n                padding: \"20px\"\n            }\n        });\n        const storageWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                borderTop: \"1px solid #aaa\",\n                margin: \"0 -20px\",\n                padding: \"20px\",\n                paddingBottom: \"0\"\n            }\n        });\n        contentEl.append(psdWrapper, storageWrapper);\n        const psdBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"button\",\n            className: \"kl-button\",\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"save-reminder-save-psd\"),\n            onClick: ()=>this.onSaveAsPsd()\n        });\n        psdWrapper.append(psdBtn, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"save-reminder-psd-layers\"),\n            css: {\n                marginTop: \"10px\"\n            }\n        }));\n        const storageUi = new (0, $1a83f3b0ed28fe18$export$9c72cf485ef46673)(this.projectStore, this.getProject, this, document.body, {\n            hideClearButton: true,\n            isFocusable: true\n        });\n        storageWrapper.append(storageUi.getElement());\n        (0, $49faab2330529a96$export$6e4a713ddcda1e5e).popup({\n            target: document.body,\n            message: `<b>${(0, $63d0b335c576c718$export$ce37e184d908d785)(\"save-reminder-title\")}</b>`,\n            div: contentEl,\n            ignoreBackground: true,\n            callback: ()=>{\n                storageUi.destroy();\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(psdBtn);\n                this.closeFunc = undefined;\n                this.lastReminderShownAt = performance.now();\n            },\n            closeFunc: (f)=>{\n                this.closeFunc = f;\n            }\n        });\n        setTimeout(()=>{\n            psdBtn.focus();\n        }, 40);\n    }\n    init() {\n        if (this.lastSavedActionNumber !== undefined) return;\n        this.lastSavedActionNumber = this.history.getActionNumber();\n        this.lastReminderShownAt = performance.now();\n        this.lastSavedAt = performance.now();\n        if (this.showReminder) setInterval(()=>{\n            if (document.visibilityState !== \"visible\") return;\n            const unsavedActions = Math.abs(this.history.getActionNumber() - this.lastSavedActionNumber);\n            const timeLimitMs = 60000 * ({\n                \"20min\": 20,\n                \"40min\": 40,\n                \"disabled\": 0\n            })[this.setting];\n            if (timeLimitMs > 0 && (0, $49faab2330529a96$export$6e4a713ddcda1e5e).dialogCounter.get() === 0 && !this.isDrawing() && this.lastReminderShownAt + timeLimitMs < performance.now() && unsavedActions >= $5ecc5a61dcd332b6$var$unsavedActionsLimit) this.showPopup();\n        }, 5000);\n        // confirmation dialog when closing tab\n        function onBeforeUnload(e) {\n            e.preventDefault();\n            e.returnValue = \"\";\n        }\n        this.history.addListener(()=>{\n            const actionNumber = this.history.getActionNumber();\n            if (this.lastSavedActionNumber !== actionNumber) window.onbeforeunload = onBeforeUnload;\n            else window.onbeforeunload = null;\n        });\n        if (this.changeTitle) document.addEventListener(\"visibilitychange\", ()=>{\n            if (document.visibilityState === \"visible\") {\n                document.title = this.title;\n                clearInterval(this.unsavedInterval);\n            } else {\n                const actionNumber = this.history.getActionNumber();\n                if (this.lastSavedActionNumber !== actionNumber) {\n                    document.title = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"unsaved\") + \" - \" + this.title;\n                    let state = 0;\n                    this.unsavedInterval = setInterval(()=>{\n                        state = (state + 1) % 2;\n                        if (state === 1) document.title = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"unsaved\") + \" \\xb7 \" + this.title;\n                        else document.title = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"unsaved\") + \" - \" + this.title;\n                    }, 180000);\n                }\n            }\n        });\n    }\n    reset() {\n        if (this.lastSavedActionNumber === undefined) return;\n        this.lastSavedActionNumber = this.history.getActionNumber();\n        this.lastReminderShownAt = performance.now();\n        this.lastSavedAt = performance.now();\n        window.onbeforeunload = null;\n        if (this.closeFunc) this.closeFunc();\n    }\n    getSetting() {\n        return this.setting;\n    }\n    setSetting(setting) {\n        this.setting = setting;\n        localStorage.setItem($5ecc5a61dcd332b6$var$LS_REMINDER_KEY, this.setting);\n    }\n    constructor(history, showReminder, changeTitle, onSaveAsPsd, isDrawing, projectStore, getProject, title = \"Klecks\"){\n        this.history = history;\n        this.showReminder = showReminder;\n        this.changeTitle = changeTitle;\n        this.onSaveAsPsd = onSaveAsPsd;\n        this.isDrawing = isDrawing;\n        this.projectStore = projectStore;\n        this.getProject = getProject;\n        this.title = title;\n        this.lastSavedAt = 0;\n        this.lastReminderShownAt = 0;\n        var _localStorage_getItem;\n        this.setting = (_localStorage_getItem = localStorage.getItem($5ecc5a61dcd332b6$var$LS_REMINDER_KEY)) !== null && _localStorage_getItem !== void 0 ? _localStorage_getItem : \"20min\";\n    }\n}\n\n\n\n\n// https://github.com/eligrey/FileSaver.js/issues/774\n// stripped down version of https://github.com/eligrey/FileSaver.js/blob/master/src/FileSaver.js#L81-L108\nfunction $39ab97e4ee30a834$export$2bc2a80e311129ac(blob, name) {\n    // Namespace is used to prevent conflict w/ Chrome Poper Blocker extension (Issue https://github.com/eligrey/FileSaver.js/issues/561)\n    const a = document.createElementNS(\"http://www.w3.org/1999/xhtml\", \"a\");\n    a.download = name;\n    a.rel = \"noopener\";\n    a.href = URL.createObjectURL(blob);\n    setTimeout(()=>URL.revokeObjectURL(a.href), 40000);\n    setTimeout(()=>a.click(), 0);\n}\n\n\n\nclass $f853515918de2fdb$export$75e7b60500bb415b {\n    /**\n     * Using old code, because saving somehow doesn't work for ipad before ios 13,\n     * and it doesn't even throw an exception.\n     */ saveImage(canvas, filename, mimeType) {\n        const parts = canvas.toDataURL(mimeType).match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\n        if (!parts) throw new Error(\"saveImage: empty parts\");\n        //assume base64 encoding\n        const binStr = atob(parts[3]);\n        //convert to binary in ArrayBuffer\n        const buf = new ArrayBuffer(binStr.length);\n        const view = new Uint8Array(buf);\n        for(let i = 0; i < view.length; i++)view[i] = binStr.charCodeAt(i);\n        const blob = new Blob([\n            view\n        ], {\n            \"type\": parts[1]\n        });\n        (0, $39ab97e4ee30a834$export$2bc2a80e311129ac)(blob, filename);\n    }\n    save(format) {\n        this.saveReminder.reset();\n        if (!format) format = this.getExportType();\n        if (format === \"png\") {\n            const extension = \"png\";\n            const mimeType = \"image/png\";\n            const filename = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).getDate() + (0, $5a2f7ed66bdaf6a4$export$4d6077ff8d823dfb).filenameBase + \".\" + extension;\n            const fullCanvas = this.getKlCanvas().getCompleteCanvas(1);\n            try {\n                this.saveImage(fullCanvas, filename, mimeType);\n            } catch (error) {\n                alert(\"could not save\");\n                throw new Error(\"failed png export\");\n            }\n        } else if (format === \"layers\") {\n            const extension = \"png\";\n            const mimeType = \"image/png\";\n            const fileBase = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).getDate() + (0, $5a2f7ed66bdaf6a4$export$4d6077ff8d823dfb).filenameBase;\n            const layerArr = this.getKlCanvas().getLayersFast();\n            for(let i = 0; i < layerArr.length; i++){\n                const item = layerArr[i];\n                const fnameArr = [\n                    fileBase,\n                    \"_\",\n                    (\"\" + (i + 1)).padStart(2, \"0\"),\n                    \"_\",\n                    item.name,\n                    \".\",\n                    extension\n                ];\n                this.saveImage(item.canvas, fnameArr.join(\"\"), mimeType);\n            }\n        } else if (format === \"psd\") {\n            const layerArr = this.getKlCanvas().getLayersFast();\n            const psdConfig = {\n                width: this.getKlCanvas().getWidth(),\n                height: this.getKlCanvas().getHeight(),\n                children: [],\n                canvas: this.getKlCanvas().getCompleteCanvas(1)\n            };\n            for(let i = 0; i < layerArr.length; i++){\n                const item = layerArr[i];\n                psdConfig.children.push({\n                    name: item.name,\n                    hidden: !item.isVisible,\n                    opacity: item.opacity,\n                    canvas: item.canvas,\n                    blendMode: (0, $49faab2330529a96$export$6e4a713ddcda1e5e).PSD.blendKlToPsd(item.mixModeStr),\n                    left: 0,\n                    top: 0\n                });\n            }\n            (0, $49faab2330529a96$export$6e4a713ddcda1e5e).loadAgPsd().then((agPsdLazy)=>{\n                const buffer = agPsdLazy.writePsdBuffer(psdConfig);\n                const blob = new Blob([\n                    buffer\n                ], {\n                    type: \"application/octet-stream\"\n                });\n                (0, $39ab97e4ee30a834$export$2bc2a80e311129ac)(blob, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).getDate() + (0, $5a2f7ed66bdaf6a4$export$4d6077ff8d823dfb).filenameBase + \".psd\");\n            }).catch(()=>{\n                alert(\"Error: failed to load PSD library\");\n            });\n        }\n    }\n    constructor(saveReminder, getExportType, getKlCanvas){\n        this.saveReminder = saveReminder;\n        this.getExportType = getExportType;\n        this.getKlCanvas = getKlCanvas;\n    }\n}\n\n\n\n\n\nfunction $0eb1f8ad6bbf0528$var$execHistoryEntry(historyEntry, layerIndex, klCanvas, brushes, setCurrentLayerCtx, getCurrentLayerCtx) {\n    if (historyEntry.tool[0] === \"brush\") {\n        const b = brushes[historyEntry.tool[1]];\n        historyEntry.actions.forEach((action)=>{\n            b[action.action](...action.params);\n        });\n    } else if (historyEntry.tool[0] === \"canvas\") {\n        const p = historyEntry.params;\n        const id = klCanvas[historyEntry.action](...p);\n        if (typeof id === \"number\") {\n            layerIndex = id;\n            const ctx = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(klCanvas.getLayerContext(layerIndex));\n            setCurrentLayerCtx(ctx);\n            Object.entries(brushes).forEach(([, brush])=>brush.setContext(ctx));\n        }\n    } else if (historyEntry.tool[0] === \"filter\") {\n        const p = [\n            {\n                context: getCurrentLayerCtx(),\n                klCanvas: klCanvas,\n                input: historyEntry.params[0].input,\n                history: new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).DecoyKlHistory()\n            }\n        ];\n        (0, $49faab2330529a96$export$6e4a713ddcda1e5e).filterLib[historyEntry.tool[1]][historyEntry.action](...p);\n    } else if (historyEntry.tool[0] === \"misc\" && historyEntry.action === \"focusLayer\") {\n        layerIndex = historyEntry.params[0];\n        const ctx = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(klCanvas.getLayerContext(layerIndex));\n        setCurrentLayerCtx(ctx);\n        Object.entries(brushes).forEach(([, brush])=>brush.setContext(ctx));\n    } else if (historyEntry.tool[0] === \"misc\" && historyEntry.action === \"importImage\") {\n        const id = klCanvas.addLayer();\n        if (typeof id === \"number\") {\n            layerIndex = id;\n            if (historyEntry.params[1]) klCanvas.renameLayer(layerIndex, historyEntry.params[1]);\n            const ctx = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(klCanvas.getLayerContext(layerIndex));\n            setCurrentLayerCtx(ctx);\n            Object.entries(brushes).forEach(([, brush])=>brush.setContext(ctx));\n        }\n        getCurrentLayerCtx().drawImage(historyEntry.params[0], 0, 0);\n    }\n    return layerIndex;\n}\nclass $0eb1f8ad6bbf0528$export$5cebd3bb2d68229a {\n    /**\n     * Prevent multiple undo / redo getting triggered at once if UI is frozen.\n     * true -> ignore, don't undo / redo\n     */ shouldIgnoreTest() {\n        if (this.doIgnore) return true;\n        this.doIgnore = true;\n        setTimeout(()=>{\n            this.doIgnore = false;\n        }, 0);\n        return false;\n    }\n    undo() {\n        if (this.shouldIgnoreTest() || !(0, $d2dccce11beb16cf$export$28b6f4d98dde9845).canUndo()) return false;\n        const entries = (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).undo();\n        const klCanvas = this.getKlCanvas();\n        (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(true);\n        const initState = this.getInitState();\n        const oldSize = {\n            w: klCanvas.getWidth(),\n            h: klCanvas.getHeight()\n        };\n        klCanvas.copy(initState.canvas);\n        let layerIndex = initState.focus;\n        this.setCurrentLayerCtx((0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(klCanvas.getLayerContext(layerIndex)));\n        const brushes = {};\n        Object.entries((0, $49faab2330529a96$export$6e4a713ddcda1e5e).brushes).forEach(([b, brush])=>{\n            brushes[b] = new brush();\n            brushes[b].setContext(this.getCurrentLayerCtx());\n        });\n        brushes.SketchyBrush.setSeed(initState.brushes.SketchyBrush.getSeed());\n        entries.forEach((entry)=>{\n            layerIndex = $0eb1f8ad6bbf0528$var$execHistoryEntry(entry, layerIndex, klCanvas, brushes, (ctx)=>this.setCurrentLayerCtx(ctx), ()=>(0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.getCurrentLayerCtx()));\n        });\n        if (oldSize.w !== klCanvas.getWidth() || oldSize.h !== klCanvas.getHeight()) {\n            this.klCanvasWorkspace.resetOrFitView();\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n        }\n        this.layerManager.update(layerIndex);\n        this.layerPreview.setLayer((0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(klCanvas.getLayer(layerIndex)));\n        this.brushUiMap.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\n        this.klCanvasWorkspace.setLastDrawEvent();\n        (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(false);\n        return true;\n    }\n    redo() {\n        if (this.shouldIgnoreTest() || !(0, $d2dccce11beb16cf$export$28b6f4d98dde9845).canRedo()) return false;\n        const entry = (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).redo();\n        if (!entry) {\n            setTimeout(()=>{\n                throw new Error(\"redo failed. redo entry undefined\");\n            });\n            return false;\n        }\n        const klCanvas = this.getKlCanvas();\n        (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(true);\n        const oldSize = {\n            w: klCanvas.getWidth(),\n            h: klCanvas.getHeight()\n        };\n        const brushes = {};\n        Object.entries((0, $49faab2330529a96$export$6e4a713ddcda1e5e).brushes).forEach(([b, brush])=>{\n            brushes[b] = new brush();\n            brushes[b].setContext(this.getCurrentLayerCtx());\n        });\n        brushes.SketchyBrush.setSeed(this.brushUiMap.sketchyBrush.getSeed());\n        $0eb1f8ad6bbf0528$var$execHistoryEntry(entry, 0, klCanvas, brushes, (ctx)=>this.setCurrentLayerCtx(ctx), ()=>(0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.getCurrentLayerCtx()));\n        if (oldSize.w !== klCanvas.getWidth() || oldSize.h !== klCanvas.getHeight()) {\n            this.klCanvasWorkspace.resetOrFitView();\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n        }\n        const currentLayerIndex = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(klCanvas.getLayerIndex(this.getCurrentLayerCtx().canvas));\n        this.layerManager.update(currentLayerIndex);\n        this.layerPreview.setLayer(klCanvas.getLayer(currentLayerIndex));\n        this.brushUiMap.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx());\n        this.klCanvasWorkspace.setLastDrawEvent();\n        (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(false);\n        return true;\n    }\n    catchup(logParam) {\n        // const start = performance.now();\n        //play catch up (the version that is a few steps behind)\n        if (!logParam || !logParam.bufferUpdate) return;\n        const initState = this.getInitState();\n        let localCurrentLayerCtx = initState.canvas.getLayerContext(initState.focus);\n        initState.focus = $0eb1f8ad6bbf0528$var$execHistoryEntry(logParam.bufferUpdate, initState.focus, initState.canvas, initState.brushes, (ctx)=>{\n            localCurrentLayerCtx = ctx;\n        }, ()=>(0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(localCurrentLayerCtx));\n    // console.log('catchup', performance.now() - start);\n    }\n    // ---- public ----\n    constructor(brushUiMap, layerPreview, layerManager, handUi, klCanvasWorkspace, getInitState, getKlCanvas, getCurrentLayerCtx, setCurrentLayerCtx, getCurrentBrush){\n        this.brushUiMap = brushUiMap;\n        this.layerPreview = layerPreview;\n        this.layerManager = layerManager;\n        this.handUi = handUi;\n        this.klCanvasWorkspace = klCanvasWorkspace;\n        this.getInitState = getInitState;\n        this.getKlCanvas = getKlCanvas;\n        this.getCurrentLayerCtx = getCurrentLayerCtx;\n        this.setCurrentLayerCtx = setCurrentLayerCtx;\n        this.getCurrentBrush = getCurrentBrush;\n        this.doIgnore = false;\n    }\n}\n\n\nclass $2cc9052c3f36f7f1$export$272bfd3ef9ef2f48 {\n    emit(obj, skipSubscriber) {\n        for(let i = 0; i < this.subscriberArr.length; i++){\n            if (this.subscriberArr[i] === skipSubscriber) continue;\n            this.subscriberArr[i](obj);\n        }\n    }\n    emitColor(color, skipSubscriber) {\n        this.emit({\n            type: \"color\",\n            value: color\n        }, skipSubscriber);\n    }\n    emitSize(size, skipSubscriber) {\n        this.emit({\n            type: \"size\",\n            value: size\n        }, skipSubscriber);\n    }\n    emitOpacity(opacity, skipSubscriber) {\n        this.emit({\n            type: \"opacity\",\n            value: opacity\n        }, skipSubscriber);\n    }\n    emitSliderConfig(sliderConfig, skipSubscriber) {\n        this.emit({\n            type: \"sliderConfig\",\n            value: sliderConfig\n        }, skipSubscriber);\n    }\n    /**\n     * set current brush color\n     * @param color\n     * @param skipSubscriber\n     */ setColor(color, skipSubscriber) {\n        this.onSetColor(color);\n        this.emitColor(color, skipSubscriber);\n    }\n    /**\n     * set current brush size\n     * @param size\n     * @param skipSubscriber\n     */ setSize(size, skipSubscriber) {\n        this.onSetSize(size);\n    // why not emitting?\n    }\n    /**\n     * set current opacity\n     * @param opacity\n     * @param skipSubscriber\n     */ setOpacity(opacity, skipSubscriber) {\n        this.onSetOpacity(opacity);\n    // why not emitting?\n    }\n    /**\n     * get current brush color\n     */ getColor() {\n        return this.onGetColor();\n    }\n    getSize() {\n        return this.onGetSize();\n    }\n    getOpacity() {\n        return this.onGetOpacity();\n    }\n    getSliderConfig() {\n        return this.onGetSliderConfig();\n    }\n    /**\n     * subscribe to changes\n     * @param func\n     */ subscribe(func) {\n        if (this.subscriberArr.includes(func)) return;\n        this.subscriberArr.push(func);\n    }\n    unsubscribe(func) {\n        for(let i = 0; i < this.subscriberArr.length; i++)if (func === this.subscriberArr[i]) {\n            this.subscriberArr.splice(i, 1);\n            i--;\n        }\n    }\n    // --- public ---\n    constructor(onSetColor, onSetSize, onSetOpacity, onGetColor, onGetSize, onGetOpacity, onGetSliderConfig){\n        this.onSetColor = onSetColor;\n        this.onSetSize = onSetSize;\n        this.onSetOpacity = onSetOpacity;\n        this.onGetColor = onGetColor;\n        this.onGetSize = onGetSize;\n        this.onGetOpacity = onGetOpacity;\n        this.onGetSliderConfig = onGetSliderConfig;\n        this.subscriberArr = [];\n        if ($2cc9052c3f36f7f1$export$272bfd3ef9ef2f48.instance) throw new Error(\"BrushSettingService already instantiated\");\n        $2cc9052c3f36f7f1$export$272bfd3ef9ef2f48.instance = this;\n    }\n}\n\n\n\n\n\n\n\nvar $324b66e6d8cad1f5$exports = {};\n\n$324b66e6d8cad1f5$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"bitbof-logo.bc5e3ed5.svg\";\n\n\n\nvar $bd9eeb1157230cb2$exports = {};\n\n$bd9eeb1157230cb2$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"ui-swap-lr.7f474f51.svg\";\n\n\n\n\n\n\n\n\n\n\n\n\nfunction $385afea81bc7341b$export$d3fe39c7bff44f23() {\n    const licensesCss = (0, $c072f29bb0ad2433$export$dbf350e5966cf602)({\n        display: \"flex\",\n        flexDirection: \"column\",\n        gap: \"10px\",\n        \"details > div\": {\n            padding: \"10px\",\n            boxShadow: \"0 0 0 1px\",\n            marginTop: \"5px\",\n            fontFamily: \"monospace\",\n            background: \"#aaa2\",\n            overflow: \"hidden\"\n        },\n        \"summary\": {\n            cursor: \"pointer\",\n            userSelect: \"none\"\n        }\n    });\n    const libraries = (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\".\" + licensesCss, (0, $63d0b335c576c718$export$ce37e184d908d785)(\"loading\"));\n    const fonts = (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\".\" + licensesCss, (0, $63d0b335c576c718$export$ce37e184d908d785)(\"loading\"));\n    const content = (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\",flex,flexCol,gap-10\", [\n        libraries,\n        fonts\n    ]);\n    new (0, $18361e3f5d6257e8$export$185108a9b725b68)({\n        title: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"licenses\")\n        }),\n        content: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: content,\n            css: {\n                height: \"100%\",\n                overflowY: \"auto\",\n                padding: \"10px\",\n                boxSizing: \"border-box\"\n            }\n        }),\n        width: 800,\n        isMaxHeight: true,\n        onClose: ()=>{\n            if (window.location.hash === \"#licenses\") history.replaceState(\"\", document.title, window.location.pathname + window.location.search);\n        }\n    });\n    (parcelRequire(\"cMiRD\")).then((result)=>{\n        libraries.innerHTML = \"\";\n        result.licenses.forEach((item)=>{\n            libraries.append((0, $934e5f47c3374e21$export$db3b6bfb95261072)(\"details\", [\n                (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\"summary\", item.title),\n                (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\"\", item.full.replace(/\\n/g, \"<br>\"))\n            ]));\n        });\n    });\n    (parcelRequire(\"5goSP\")).then((result)=>{\n        fonts.innerHTML = \"\";\n        result.fontLicenses.forEach((item)=>{\n            fonts.append((0, $934e5f47c3374e21$export$db3b6bfb95261072)(\"details\", [\n                (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\"summary\", \"Font: \" + item.title),\n                (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\"\", item.full.replace(/\\n/g, \"<br>\"))\n            ]));\n        });\n    });\n}\n\n\n\n\nclass $3d76b9452a5b8907$export$5d396b237bd33221 {\n    getElement() {\n        return this.rootEl;\n    }\n    // --- public ---\n    constructor(onLeftRight, saveReminder, customAbout){\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                margin: \"10px\"\n            }\n        });\n        // ---- language ----\n        const autoLanguage = (0, $63d0b335c576c718$export$ea44c9eff2c31da6).getAutoLanguage();\n        const langWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            content: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"settings-language\") + \":\",\n                css: {\n                    marginRight: \"5px\",\n                    marginBottom: \"2px\"\n                }\n            }),\n            css: {\n                display: \"flex\",\n                alignItems: \"center\",\n                flexWrap: \"wrap\"\n            }\n        });\n        const options = [\n            [\n                \"auto\",\n                (0, $63d0b335c576c718$export$ce37e184d908d785)(\"auto\") + ` \\u{2192} ${autoLanguage.name} (${autoLanguage.code})`\n            ],\n            ...(0, $970d7af44d8b8038$export$d0d68bb9ed2c643d).map((item)=>{\n                return [\n                    item.code,\n                    item.name + ` (${item.code})`\n                ];\n            })\n        ];\n        const languageSelect = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).Select({\n            initValue: (0, $fc4403c8ee6a33dc$export$d802c22d109d9806)((0, $0ecef66681b62a8c$export$19fffca37ef3e106).getItem((0, $63d0b335c576c718$export$991796128b2ca217)) ? (0, $0ecef66681b62a8c$export$19fffca37ef3e106).getItem((0, $63d0b335c576c718$export$991796128b2ca217)) : \"auto\"),\n            optionArr: options,\n            onChange: (val)=>{\n                if (val === \"auto\") (0, $0ecef66681b62a8c$export$19fffca37ef3e106).removeItem((0, $63d0b335c576c718$export$991796128b2ca217));\n                else (0, $0ecef66681b62a8c$export$19fffca37ef3e106).setItem((0, $63d0b335c576c718$export$991796128b2ca217), val);\n                languageHint.style.display = \"block\";\n            }\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(languageSelect.getElement(), {\n            flexGrow: \"1\"\n        });\n        const languageHint = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-toolspace-note\",\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"settings-language-reload\"),\n            css: {\n                display: \"none\",\n                marginTop: \"5px\",\n                flexGrow: \"1\"\n            }\n        });\n        langWrapper.append(languageSelect.getElement(), languageHint);\n        // ---- theme ----\n        function themeToLabel(theme) {\n            return theme === \"dark\" ? \"\\u2B1B \" + (0, $63d0b335c576c718$export$ce37e184d908d785)(\"theme-dark\") : \"\\u2B1C \" + (0, $63d0b335c576c718$export$ce37e184d908d785)(\"theme-light\");\n        }\n        const themeSelect = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).Select({\n            optionArr: [\n                [\n                    \"auto\",\n                    (0, $63d0b335c576c718$export$ce37e184d908d785)(\"auto\") + \" \\u2192 \" + themeToLabel((0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).getMediaQueryTheme())\n                ],\n                [\n                    \"light\",\n                    themeToLabel(\"light\")\n                ],\n                [\n                    \"dark\",\n                    themeToLabel(\"dark\")\n                ]\n            ],\n            initValue: (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).getStoredTheme() || \"auto\",\n            onChange: (val)=>{\n                (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).setStoredTheme(val === \"auto\" ? undefined : val);\n            }\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(themeSelect.getElement(), {\n            flexGrow: \"1\"\n        });\n        (0, $fc4403c8ee6a33dc$export$a9dfd81f95a8a526)(()=>{\n            themeSelect.updateLabel(\"auto\", (0, $63d0b335c576c718$export$ce37e184d908d785)(\"auto\") + \" \\u2192 \" + themeToLabel((0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).getMediaQueryTheme()));\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            content: [\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"settings-theme\") + \":\",\n                    css: {\n                        marginRight: \"5px\",\n                        marginBottom: \"2px\"\n                    }\n                }),\n                themeSelect.getElement()\n            ],\n            css: {\n                marginTop: \"15px\",\n                display: \"flex\",\n                alignItems: \"center\",\n                flexWrap: \"wrap\"\n            }\n        });\n        // ---- save reminder ----\n        if (saveReminder) {\n            const reminderSelect = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).Select({\n                optionArr: [\n                    [\n                        \"20min\",\n                        (0, $63d0b335c576c718$export$ce37e184d908d785)(\"x-minutes\", {\n                            x: \"20\"\n                        })\n                    ],\n                    [\n                        \"40min\",\n                        (0, $63d0b335c576c718$export$ce37e184d908d785)(\"x-minutes\", {\n                            x: \"40\"\n                        })\n                    ],\n                    [\n                        \"disabled\",\n                        \"\\u26A0\\uFE0F \" + (0, $63d0b335c576c718$export$ce37e184d908d785)(\"settings-save-reminder-disabled\")\n                    ]\n                ],\n                initValue: saveReminder.getSetting(),\n                onChange: (val)=>{\n                    if (val !== \"disabled\") {\n                        saveReminder.setSetting(val);\n                        return;\n                    }\n                    const disableStr = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"settings-save-reminder-confirm-disable\");\n                    (0, $2016c314bff36ab9$export$d7e8d4d4450c819c)({\n                        target: document.body,\n                        message: \"\\u26A0\\uFE0F\" + (0, $63d0b335c576c718$export$ce37e184d908d785)(\"settings-save-reminder-confirm-title\"),\n                        div: (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\"\", [\n                            (0, $934e5f47c3374e21$export$db3b6bfb95261072)(\".info-hint\", (0, $63d0b335c576c718$export$ce37e184d908d785)(\"settings-save-reminder-confirm-a\")),\n                            (0, $63d0b335c576c718$export$ce37e184d908d785)(\"settings-save-reminder-confirm-b\")\n                        ]),\n                        buttons: [\n                            disableStr,\n                            \"Cancel\"\n                        ],\n                        callback: (result)=>{\n                            if (result === disableStr) saveReminder.setSetting(val);\n                            else reminderSelect.setValue(saveReminder.getSetting());\n                        }\n                    });\n                }\n            });\n            reminderSelect.getElement().style.flexGrow = \"1\";\n            this.rootEl.append((0, $934e5f47c3374e21$export$db3b6bfb95261072)(\",flex,items-center,gap-5,mt-15,flexWrap\", [\n                (0, $63d0b335c576c718$export$ce37e184d908d785)(\"settings-save-reminder-label\") + \":\",\n                reminderSelect.getElement()\n            ]));\n        }\n        // ---- flip ui ----\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"button\",\n            parent: this.rootEl,\n            content: '<img height=\"20\" width=\"18\" src=\"' + (0, (/*@__PURE__*/$parcel$interopDefault($bd9eeb1157230cb2$exports))) + '\" alt=\"icon\" style=\"margin-right: 5px\"/>' + (0, $63d0b335c576c718$export$ce37e184d908d785)(\"switch-ui-left-right\"),\n            onClick: ()=>onLeftRight(),\n            css: {\n                marginTop: \"15px\"\n            },\n            custom: {\n                tabIndex: \"-1\"\n            }\n        });\n        // ---- about ----\n        this.rootEl.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"grid-hr\",\n            css: {\n                margin: \"10px 0\"\n            }\n        }));\n        function makeLicenses() {\n            return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                tagName: \"a\",\n                content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"licenses\"),\n                onClick: ()=>(0, $385afea81bc7341b$export$d3fe39c7bff44f23)()\n            });\n        }\n        if (customAbout) {\n            this.rootEl.append(customAbout);\n            if (!customAbout.innerHTML) {\n                const minimalAbout = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    parent: customAbout,\n                    css: {\n                        textAlign: \"center\"\n                    }\n                });\n                minimalAbout.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    content: `<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${(0, (/*@__PURE__*/$parcel$interopDefault($324b66e6d8cad1f5$exports)))}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a> \\xa9 2023<br>`\n                }), makeLicenses());\n            }\n        } else {\n            const versionEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                parent: this.rootEl,\n                css: {\n                    textAlign: \"center\"\n                },\n                content: `\n<img alt=\"Klecks\" class=\"dark-invert\" height=\"25\" src=\"${(0, (/*@__PURE__*/$parcel$interopDefault($3d723e4f59a76a82$exports)))}\"><br>\n<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${(0, (/*@__PURE__*/$parcel$interopDefault($324b66e6d8cad1f5$exports)))}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a> \\xa9 2023<br>`\n            });\n            versionEl.append(makeLicenses(), document.createTextNode(\" | \"), (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                tagName: \"a\",\n                content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"donate\"),\n                custom: {\n                    href: \"https://kleki.com/donate/\",\n                    target: \"_blank\"\n                }\n            }), document.createTextNode(\" | \"), (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                tagName: \"a\",\n                content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"source-code\"),\n                custom: {\n                    href: \"https://klecks.org\",\n                    target: \"_blank\"\n                }\n            }));\n        }\n        window.addEventListener(\"storage\", (e)=>{\n            if (e.key !== (0, $63d0b335c576c718$export$991796128b2ca217)) return;\n            languageSelect.setValue((0, $fc4403c8ee6a33dc$export$d802c22d109d9806)((0, $0ecef66681b62a8c$export$19fffca37ef3e106).getItem((0, $63d0b335c576c718$export$991796128b2ca217)) ? (0, $0ecef66681b62a8c$export$19fffca37ef3e106).getItem((0, $63d0b335c576c718$export$991796128b2ca217)) : \"auto\"));\n        });\n    }\n}\n\n\n\n\n\nclass $6395dd91f6160304$export$42a534af7eb650e8 {\n    update() {\n        let newUpDisplay = this.upBtn.style.display;\n        let newDownDisplay = this.downBtn.style.display;\n        if (this.toolspace.scrollHeight > this.toolspace.offsetHeight + 3) {\n            if (!this.upInterval) newUpDisplay = this.toolspace.scrollTop === 0 ? \"none\" : \"block\";\n            if (!this.downInterval) newDownDisplay = this.toolspace.scrollTop + this.toolspace.offsetHeight + 1 >= this.toolspace.scrollHeight ? \"none\" : \"block\";\n        } else {\n            newUpDisplay = \"none\";\n            newDownDisplay = \"none\";\n        }\n        // check to prevent infinite MutationObserver loop in Pale Moon\n        if (newUpDisplay !== this.upBtn.style.display) this.upBtn.style.display = newUpDisplay;\n        if (newDownDisplay !== this.downBtn.style.display) this.downBtn.style.display = newDownDisplay;\n    }\n    updateUiState(uiState) {\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.upBtn, {\n            left: uiState === \"left\" ? \"0\" : \"\",\n            right: uiState === \"right\" ? \"0\" : \"\"\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.downBtn, {\n            left: uiState === \"left\" ? \"0\" : \"\",\n            right: uiState === \"right\" ? \"0\" : \"\"\n        });\n    }\n    // --- public ---\n    constructor(p){\n        this.toolspace = p.toolspace;\n        this.upBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.toolspace,\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"scroll\"),\n            className: \"kl-scroller\",\n            css: {\n                top: \"0\",\n                transform: \"rotate(180deg)\"\n            }\n        });\n        this.downBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.toolspace,\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"scroll\"),\n            className: \"kl-scroller\",\n            css: {\n                bottom: \"0\"\n            }\n        });\n        this.updateUiState(p.uiState);\n        const upListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.upBtn,\n            onPointer: (e)=>{\n                if (e.type === \"pointerdown\") this.upInterval = setInterval(()=>{\n                    this.toolspace.scrollBy(0, -13);\n                    this.update();\n                }, 20);\n                if (e.type === \"pointerup\") {\n                    clearInterval(this.upInterval);\n                    setTimeout(()=>{\n                        this.upInterval = null;\n                        this.update();\n                    }, 50);\n                }\n            }\n        });\n        const downListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.downBtn,\n            onPointer: (e)=>{\n                if (e.type === \"pointerdown\") this.downInterval = setInterval(()=>{\n                    this.toolspace.scrollBy(0, 13);\n                    this.update();\n                }, 20);\n                if (e.type === \"pointerup\") {\n                    clearInterval(this.downInterval);\n                    setTimeout(()=>{\n                        this.downInterval = null;\n                        this.update();\n                    }, 50);\n                }\n            }\n        });\n        const wheelListener = (e)=>{\n            this.toolspace.scrollBy(0, Math.round(0.7 * e.deltaY));\n            this.update();\n        };\n        this.upBtn.addEventListener(\"wheel\", wheelListener);\n        this.downBtn.addEventListener(\"wheel\", wheelListener);\n        this.update();\n        const observer = new MutationObserver(()=>this.update());\n        observer.observe(this.toolspace, {\n            attributes: true,\n            childList: true,\n            subtree: true\n        });\n        window.addEventListener(\"resize\", ()=>this.update());\n        // hide if in dialog because that can have its own scrollbar\n        (0, $6b37b427615ca1fa$export$17eb8275e0c4cab8).subscribe((v)=>{\n            // ignores the 0.5 by tool dropdown\n            this.upBtn.style.opacity = v >= 1 ? \"0\" : \"\";\n            this.downBtn.style.opacity = v >= 1 ? \"0\" : \"\";\n        });\n    }\n}\n\n\n\n\n\n\n\nclass $2ae4a5af5e108b3d$export$7fa03d1ef9d3489e {\n    updateIcons() {\n        const col1 = this.settings.isReversed ? \"#0000\" : \"#000\";\n        const col2 = this.settings.isReversed ? \"#000\" : \"#0000\";\n        this.iconArr[0].style.background = `linear-gradient(${col1}, ${col2})`;\n        this.iconArr[1].style.background = `linear-gradient(${col2}, ${col1}, ${col2})`;\n        this.iconArr[2].style.background = `radial-gradient(${col1}, ${col2})`;\n    }\n    getElement() {\n        return this.rootEl;\n    }\n    setIsVisible(isVisible) {\n        this.isVisible = !!isVisible;\n        this.rootEl.style.display = isVisible ? \"block\" : \"none\";\n        if (isVisible) this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\n    }\n    getSettings() {\n        return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(this.settings);\n    }\n    // ----- public -------\n    constructor(p){\n        this.settings = {\n            opacity: 1,\n            type: \"linear\",\n            doLockAlpha: false,\n            doSnap: false,\n            isReversed: false,\n            isEraser: false\n        };\n        this.colorSlider = p.colorSlider;\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                margin: \"10px\"\n            }\n        });\n        this.isVisible = true;\n        this.colorDiv = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            css: {\n                marginBottom: \"10px\"\n            }\n        });\n        this.iconArr = [];\n        {\n            const size = 33;\n            [\n                0,\n                1,\n                2\n            ].forEach(()=>{\n                const el = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    className: \"dark-invert\",\n                    css: {\n                        width: size + \"px\",\n                        height: size + \"px\",\n                        borderRadius: \"3px\",\n                        margin: \"1px\"\n                    }\n                });\n                this.iconArr.push(el);\n            });\n        }\n        this.updateIcons();\n        const typeOptions = new (0, $1166276dc18d3ea9$export$c019608e5b5bb4cb)({\n            optionArr: [\n                {\n                    id: \"linear\",\n                    label: this.iconArr[0],\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"gradient-linear\")\n                },\n                {\n                    id: \"linear-mirror\",\n                    label: this.iconArr[1],\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"gradient-linear-mirror\")\n                },\n                {\n                    id: \"radial\",\n                    label: this.iconArr[2],\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"gradient-radial\")\n                }\n            ],\n            initId: \"linear\",\n            onChange: (id)=>{\n                this.settings.type = id;\n            }\n        });\n        this.rootEl.append(typeOptions.getElement());\n        const opacitySlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"opacity\"),\n            width: 250,\n            height: 30,\n            min: 0.01,\n            max: 1,\n            value: this.settings.opacity,\n            toValue: (displayValue)=>displayValue / 100,\n            toDisplayValue: (value)=>value * 100,\n            onChange: (val)=>{\n                this.settings.opacity = val;\n            }\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(opacitySlider.getElement(), {\n            marginTop: \"10px\"\n        });\n        this.rootEl.append(opacitySlider.getElement());\n        const row1 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            css: {\n                display: \"flex\",\n                alignItems: \"center\",\n                marginTop: \"10px\"\n            }\n        });\n        const reverseToggle = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: false,\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"reverse\"),\n            callback: (b)=>{\n                this.settings.isReversed = b;\n                this.updateIcons();\n            },\n            css: {\n                width: \"50%\"\n            }\n        });\n        const doSnapToggle = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: false,\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"angle-snap\"),\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"angle-snap-title\"),\n            callback: (b)=>{\n                this.settings.doSnap = b;\n            },\n            css: {\n                width: \"50%\"\n            }\n        });\n        row1.append(reverseToggle.getElement(), doSnapToggle.getElement());\n        const row2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            css: {\n                display: \"flex\",\n                alignItems: \"center\",\n                marginTop: \"10px\"\n            }\n        });\n        const eraserToggle = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: this.settings.isEraser,\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"eraser\"),\n            callback: (b)=>{\n                this.settings.isEraser = b;\n            },\n            css: {\n                width: \"50%\"\n            }\n        });\n        const lockAlphaToggle = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: false,\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"lock-alpha\"),\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"lock-alpha-title\"),\n            callback: (b)=>{\n                this.settings.doLockAlpha = b;\n            },\n            doHighlight: true,\n            css: {\n                width: \"50%\"\n            }\n        });\n        row2.append(eraserToggle.getElement(), lockAlphaToggle.getElement());\n    }\n}\n\n\n\nconst $49faab2330529a96$export$6e4a713ddcda1e5e = {\n    brushes: // --- brushes ---\n    $8baf89d70f3487eb$export$7d68cd8857639377,\n    brushesUI: $b2f1ee6bcab52d93$export$f1561c72be54c6a7,\n    BrushSettingService: $2cc9052c3f36f7f1$export$272bfd3ef9ef2f48,\n    KlCanvas: // --- canvas ---\n    $d26b85e649dca02a$export$4a819bde91671014,\n    drawProject: $2b8bf7b32e5ba51f$export$5f63a7b18dc4503a,\n    WorkspaceSvgOverlay: // --- canvas ui ---\n    $336ce3ce60e7688c$export$6b9252711ea5997f,\n    KlCanvasWorkspace: $3a2f95de72e4a634$export$6eaf6f7c0cc177fc,\n    KlCanvasPreview: $f48eb0413169e026$export$e258ade1648009b7,\n    filterLibStatus: // --- filters ---\n    $aa2ca71db1de8ae6$export$7a4e0b62a5d854bc,\n    filterLib: $aa2ca71db1de8ae6$export$395d33c8e06b92c9,\n    UndoRedoCatchup: // --- history ---\n    $0eb1f8ad6bbf0528$export$5cebd3bb2d68229a,\n    renderText: // --- image operations ---\n    $67e715fe604c9329$export$482c90f94eb9717c,\n    floodFillBits: $469fa98e1403db53$export$13d50f258a8034f,\n    ShapeTool: $583d130d11db85ad$export$27550cc14d7ae85a,\n    drawShape: $583d130d11db85ad$export$71b514a25c47df50,\n    GradientTool: $64881aa9f7f8f596$export$74d12f09ff9f1956,\n    drawGradient: $64881aa9f7f8f596$export$b1f70a113e3b5c1b,\n    PSD: // --- storage ---\n    $e9d04a247aa46c18$exports,\n    setDbName: $c122457b67184bc9$export$1347f8be1f25c479,\n    indexedDb: $c122457b67184bc9$exports,\n    ProjectStore: $e42d359db0fc5c76$export$93d91060b9af7e2a,\n    loadAgPsd: $e4b3248b4ce95ea5$export$ab3d838b1d336b38,\n    SaveToComputer: $f853515918de2fdb$export$75e7b60500bb415b,\n    calcSliderFalloffFactor: // --- ui - components ---\n    $6e485eb0c82960d0$export$f8e41e222e32615d,\n    Checkbox: $213947897b67ec3a$export$48513f6b9f8ce62d,\n    input: $760dd90d44275661$export$b7e3ae3d7c15e42e,\n    Select: $b1ef42bd443626ca$export$ef9b1a59e592288f,\n    ImageToggle: $a14a8e8cf8cc5885$export$b6d053cded550773,\n    ImageRadioList: $fa6faa989b2cc6b2$export$7cc1012a658e6ad8,\n    RadioList: $f734cb8286217c3c$export$3dff5655255b5729,\n    createPenPressureToggle: $218f70778c2bf652$export$9da2e8821e6cbb57,\n    KlSlider: $cd73d123a4560ac3$export$a1855b925e534de7,\n    HexColorDialog: $49ce344532144fcf$export$cc42e119007cb939,\n    KlColorSlider: $90a88670cfc900e0$export$4e5102252876c5d7,\n    KlColorSliderSmall: $8f768338795db7a0$export$66306bf21a9ff39e,\n    PointSlider: $867da577d723d824$export$ac00cea56cec3037,\n    ColorOptions: $3032e23fa8f3a9e5$export$24ba9b81662d4366,\n    Options: $1166276dc18d3ea9$export$c019608e5b5bb4cb,\n    BoxToggle: $8d99bd5fadaac7f9$export$2358c75ad3c15b2d,\n    StatusOverlay: $7ed35ae008fa6be6$export$5ee0af1d5c87e856,\n    CropCopy: $c5a9090dbc3ef918$export$40175a5948a88a57,\n    FreeTransform: $d42d1384577ab84d$export$79a74567acf241b0,\n    FreeTransformCanvas: $1fee4e0c7c231d15$export$205c2dd29f8a66b5,\n    Cropper: $c4e8a5b20c195c16$export$71ed2b85d4ca43d3,\n    LayerPreview: $6f827bc527014b7f$export$d25420b53e16716f,\n    KlImageDropper: $71c20b9a25b8f899$export$e789742143ba5b1,\n    OverlayToolspace: $b80d451cabaa19d2$export$9f0da9b942594e99,\n    ToolspaceTopRow: $50947f5db7d72ab3$export$665d2c76b1eb8459,\n    ToolDropdown: $d199831ecec4fae4$export$a0a40f8a0b8fee15,\n    ToolspaceToolRow: $79297c17befec587$export$c744a22bef9e0b97,\n    ToolspaceStabilizerRow: $6ae4f2a30e17169a$export$8162a66cd18867a7,\n    TabRow: $ae064bc6cfaee2ee$export$3c6d17ed0106bfb9,\n    ToolspaceCollapser: $dcbaf52c129d701b$export$5b91f641162972fc,\n    BrowserStorageUi: $1a83f3b0ed28fe18$export$9c72cf485ef46673,\n    SaveReminder: $5ecc5a61dcd332b6$export$befc6437ad34b28a,\n    ToolspaceScroller: $6395dd91f6160304$export$42a534af7eb650e8,\n    dialogCounter: // --- ui - modals ---\n    $6b37b427615ca1fa$export$17eb8275e0c4cab8,\n    popup: (0, $2016c314bff36ab9$export$d7e8d4d4450c819c),\n    Popup: (0, $18361e3f5d6257e8$export$185108a9b725b68),\n    clipboardDialog: $5e9fef22bb47992b$export$32b89bc9bb92706a,\n    showImportAsLayerDialog: $6be05b3a68464314$export$962af7e240721d88,\n    newImageDialog: $d43dc22de82019e6$export$f77a89101d7d6586,\n    textToolDialog: $3217004ef102ca9c$export$e263e067d6140649,\n    showImportImageDialog: $aa951ef8a5f9de6d$export$1bf16d9bd59fd8f9,\n    showIframePopup: (0, $165d2995997b2f9b$export$35fa34e5af64bd4a),\n    imgurUpload: $1acd53d54391923e$export$b1dd62fa0b5f32f5,\n    HandUi: // --- ui - tool tabs ---\n    $d4c26c4eab3ed9b4$export$cf20160367bae46c,\n    FillUi: $274b5c24f0b5af79$export$1e63e3b0645421a2,\n    GradientUi: $2ae4a5af5e108b3d$export$7fa03d1ef9d3489e,\n    TextUi: $a6bad5d4783f8133$export$32a22540e4b2f123,\n    ShapeUi: $f0a35036bcb542fb$export$a9387b1d4260d39c,\n    FileTab: $d75fb2183accd137$export$a2647fbf5f056b0a,\n    FilterTab: $755328ebbc58db18$export$3f17d740ad471e50,\n    SettingsTab: $3d76b9452a5b8907$export$5d396b237bd33221,\n    LayerManager: $7fe81e538d204f0d$export$eff87c52915dd7fe,\n    klHistory: $d2dccce11beb16cf$export$28b6f4d98dde9845,\n    DecoyKlHistory: $d2dccce11beb16cf$export$2a772a91f059c0f9\n};\nObject.keys($49faab2330529a96$export$6e4a713ddcda1e5e); // without this, parcel build may break this object\n\n\n\n\n\n\n\n\n\n\n\nclass $db287580a54bd175$export$ce26cd3db18613a3 {\n    getElement() {\n        return this.rootEl;\n    }\n    // ---- public ----\n    constructor(p){\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-toolspace-row\",\n            css: {\n                height: \"36px\",\n                display: \"flex\"\n            }\n        });\n        function createButton(p) {\n            const padding = 6 + (p.extraPadding ? p.extraPadding : 0);\n            const el = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                className: \"toolspace-row-button nohighlight\",\n                title: p.title,\n                onClick: p.onClick,\n                css: {\n                    padding: p.content ? \"\" : p.contain ? padding + \"px 0\" : \"\"\n                }\n            });\n            if (p.content) el.append(p.content);\n            else {\n                const im = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    className: \"dark-invert\",\n                    css: {\n                        backgroundImage: \"url('\" + p.image + \"')\",\n                        backgroundRepeat: \"no-repeat\",\n                        backgroundPosition: \"center\",\n                        backgroundSize: p.contain ? \"contain\" : \"\",\n                        //filter: 'grayscale(1)',\n                        height: \"100%\"\n                    }\n                });\n                im.style.pointerEvents = \"none\";\n                el.append(im);\n            }\n            const pointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n                target: el,\n                onEnterLeave: function(isOver) {\n                    el.classList.toggle(\"toolspace-row-button-hover\", isOver);\n                }\n            });\n            return {\n                el: el,\n                pointerListener: pointerListener\n            };\n        }\n        const submitButton = createButton({\n            onClick: p.onSubmit,\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"submit-title\"),\n            content: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"submit\"),\n                className: \"toolspace-row-button__submit\",\n                css: {\n                    display: \"flex\",\n                    alignItems: \"center\",\n                    justifyContent: \"center\",\n                    width: \"100%\",\n                    height: \"100%\"\n                }\n            }),\n            contain: true\n        });\n        submitButton.el.style.width = \"45px\";\n        const helpButton = createButton({\n            onClick: p.onHelp,\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"help\"),\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($2959e7daff7bd0dd$exports))),\n            contain: true\n        });\n        const leftRightButton = createButton({\n            onClick: p.onLeftRight,\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"switch-ui-left-right\"),\n            image: (0, (/*@__PURE__*/$parcel$interopDefault($bd9eeb1157230cb2$exports))),\n            contain: true\n        });\n        this.rootEl.append(submitButton.el, leftRightButton.el, helpButton.el);\n    }\n}\n\n\n\n\nconst $21a9e2eeab18749b$export$5ec472fd0ce20d84 = 60;\n\n\n\n\n\n\n\n\n\nclass $7f838dbc615d3028$export$94ec999f33a691e3 {\n    setPostMix(postMix) {\n        this.postMix = postMix;\n    }\n    destroy() {\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).freeCanvas(this.textureSource);\n        if (this.texture) {\n            this.texture = this.fxCanvas.texture(this.textureSource);\n            this.fxCanvas.draw(this.texture).update();\n            this.texture && this.texture.destroy();\n        }\n    }\n    // --- public ---\n    constructor(p){\n        this.texture = undefined;\n        this.oldOnUpdateProps = {\n            textureWidth: 0,\n            textureHeight: 0,\n            transform: {\n                scaleX: 0,\n                scaleY: 0,\n                angleDeg: 0,\n                x: 0,\n                y: 0\n            }\n        };\n        this.render = (viewportTransform, viewportWidth, viewportHeight)=>{\n            const viewportMat = (0, $a8ca0a6a49a8f94f$export$d562d1c5145f86d0)(viewportTransform);\n            const padding = 0; // render more than visible with padding < 0\n            let clippedViewportRect; // rect in viewport coordinates which contains the canvas\n            {\n                const topLeft = (0, $855520c81dfcb96a$export$9b20165a36586806)(viewportMat, {\n                    x: 0,\n                    y: 0\n                });\n                const bottomRight = (0, $855520c81dfcb96a$export$9b20165a36586806)(viewportMat, {\n                    x: this.original.width,\n                    y: this.original.height\n                });\n                bottomRight.x = Math.round(bottomRight.x);\n                bottomRight.y = Math.round(bottomRight.y);\n                const clippedTL = {\n                    x: Math.max(padding, topLeft.x),\n                    y: Math.max(padding, topLeft.y)\n                };\n                const clippedBR = {\n                    x: Math.min(viewportWidth - padding, bottomRight.x),\n                    y: Math.min(viewportHeight - padding, bottomRight.y)\n                };\n                clippedViewportRect = {\n                    x: clippedTL.x,\n                    y: clippedTL.y,\n                    width: clippedBR.x - clippedTL.x,\n                    height: clippedBR.y - clippedTL.y\n                };\n                if (clippedViewportRect.width <= 0 || clippedViewportRect.height <= 0) {\n                    this.textureSource.width = 1;\n                    this.textureSource.height = 1;\n                    return this.textureSource;\n                }\n            }\n            let resultTransform = (0, $611d5fdbbcda65d9$export$f672e0b6f7222cd7)((0, $077740f52fe6870e$export$70ae2c07e401031b)(viewportMat), (0, $cf0617f9860dc277$export$d73ee8ef04f5226a)(padding, padding), (0, $cf0617f9860dc277$export$d73ee8ef04f5226a)(clippedViewportRect.x - padding, clippedViewportRect.y - padding));\n            const onUpdateProps = {\n                textureWidth: Math.ceil(clippedViewportRect.width),\n                textureHeight: Math.ceil(clippedViewportRect.height),\n                transform: {\n                    scaleX: viewportTransform.scaleX,\n                    scaleY: viewportTransform.scaleY,\n                    angleDeg: viewportTransform.angleDeg,\n                    x: viewportTransform.x - clippedViewportRect.x,\n                    y: viewportTransform.y - clippedViewportRect.y\n                }\n            };\n            let tlOffsetX = 0;\n            let tlOffsetY = 0;\n            if (viewportTransform.scaleX > 1) {\n                // what pixels of original canvas are actually visible\n                const canvasTopLeft = (0, $855520c81dfcb96a$export$9b20165a36586806)(resultTransform, {\n                    x: 0,\n                    y: 0\n                });\n                tlOffsetX = -canvasTopLeft.x;\n                tlOffsetY = -canvasTopLeft.y;\n                canvasTopLeft.x = Math.max(0, Math.floor(canvasTopLeft.x));\n                canvasTopLeft.y = Math.max(0, Math.floor(canvasTopLeft.y));\n                tlOffsetX += canvasTopLeft.x;\n                tlOffsetY += canvasTopLeft.y;\n                const canvasBottomRight = (0, $855520c81dfcb96a$export$9b20165a36586806)(resultTransform, {\n                    x: clippedViewportRect.width,\n                    y: clippedViewportRect.height\n                });\n                canvasBottomRight.x = Math.min(this.original.width, Math.ceil(canvasBottomRight.x));\n                canvasBottomRight.y = Math.min(this.original.height, Math.ceil(canvasBottomRight.y));\n                const cw = canvasBottomRight.x - canvasTopLeft.x;\n                const ch = canvasBottomRight.y - canvasTopLeft.y;\n                onUpdateProps.textureWidth = cw;\n                onUpdateProps.textureHeight = ch;\n                onUpdateProps.transform = {\n                    scaleX: 1,\n                    scaleY: 1,\n                    angleDeg: 0,\n                    x: -canvasTopLeft.x,\n                    y: -canvasTopLeft.y\n                };\n                resultTransform = (0, $611d5fdbbcda65d9$export$f672e0b6f7222cd7)(resultTransform, (0, $a78c550eaaca7cca$export$dcdf75081b88279d)(viewportTransform.scaleX, viewportTransform.scaleY), (0, $cf0617f9860dc277$export$d73ee8ef04f5226a)(tlOffsetX, tlOffsetY));\n            }\n            if (!this.texture || JSON.stringify(onUpdateProps) !== JSON.stringify(this.oldOnUpdateProps) || this.postMix) {\n                // update texture\n                this.textureSource.width = onUpdateProps.textureWidth;\n                this.textureSource.height = onUpdateProps.textureHeight;\n                // draw original canvas into temp\n                this.ctx.save();\n                this.ctx.imageSmoothingEnabled = false;\n                if (viewportTransform.scaleX > 1) this.ctx.setTransform((0, $a8ca0a6a49a8f94f$export$d562d1c5145f86d0)(onUpdateProps.transform));\n                else this.ctx.setTransform((0, $077740f52fe6870e$export$70ae2c07e401031b)(resultTransform));\n                this.ctx.drawImage(this.original, 0, 0);\n                this.ctx.restore();\n                // debug\n                /*BB.css(this.canvas, {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                zIndex: '1000',\n                boxShadow: '0 0 0 1px #f00',\n            });\n            document.body.append(this.canvas);*/ if (!this.texture || JSON.stringify(onUpdateProps) !== JSON.stringify(this.oldOnUpdateProps)) {\n                    this.texture && this.texture.destroy();\n                    this.texture = this.fxCanvas.texture(this.textureSource);\n                }\n                if (!this.postMix) {\n                    this.textureSource.width = 1;\n                    this.textureSource.height = 1;\n                }\n            }\n            this.oldOnUpdateProps = onUpdateProps;\n            const resultFx = this.onUpdate(this.fxCanvas.draw(this.texture), onUpdateProps.transform).update();\n            if (this.postMix) {\n                this.ctx.save();\n                this.ctx.globalAlpha = this.postMix.opacity;\n                this.ctx.globalCompositeOperation = this.postMix.operation;\n                this.ctx.drawImage(resultFx, 0, 0);\n                this.ctx.restore();\n                return {\n                    image: this.textureSource,\n                    transform: resultTransform\n                };\n            }\n            return {\n                image: resultFx,\n                transform: resultTransform\n            };\n        };\n        this.original = p.original;\n        this.onUpdate = p.onUpdate;\n        this.textureSource = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(1, 1);\n        this.ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(this.textureSource);\n        this.fxCanvas = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)((0, $5caaf17bca0749c7$export$8c4423af32b21158)());\n        this.postMix = p.postMix;\n    }\n}\n\n\n\n\n\n\n\nconst $257cfc293f7e7cb2$export$af433fb90aa90a38 = {\n    getDialog (params) {\n        const rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const result = {\n            element: rootEl\n        };\n        const isSmall = (0, $8522c24dbe0f81fc$export$8f6817a932bf45cd)();\n        if (!isSmall) result.width = (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall);\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n        let brightness = 0, contrast = 0;\n        const fxPreviewRenderer = new (0, $7f838dbc615d3028$export$94ec999f33a691e3)({\n            original: context.canvas,\n            onUpdate: (fxCanvas)=>{\n                return fxCanvas.brightnessContrast(brightness, contrast);\n            }\n        });\n        function finishInit() {\n            const brightnessSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-bright-contrast-brightness\"),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 100,\n                value: (brightness + 1) * 50,\n                eventResMs: (0, $21a9e2eeab18749b$export$5ec472fd0ce20d84),\n                onChange: function(val) {\n                    brightness = val / 50 - 1;\n                    preview.render();\n                }\n            });\n            const contrastSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-bright-contrast-contrast\"),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 100,\n                value: (contrast + 1) * 50,\n                eventResMs: (0, $21a9e2eeab18749b$export$5ec472fd0ce20d84),\n                onChange: function(val) {\n                    contrast = val / 50 - 1;\n                    preview.render();\n                }\n            });\n            brightnessSlider.getElement().style.marginBottom = \"10px\";\n            contrastSlider.getElement().style.marginBottom = \"10px\";\n            rootEl.append(brightnessSlider.getElement(), contrastSlider.getElement());\n            const previewLayerArr = [];\n            for(let i = 0; i < layers.length; i++)previewLayerArr.push({\n                image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                isVisible: layers[i].isVisible,\n                opacity: layers[i].opacity,\n                mixModeStr: layers[i].mixModeStr,\n                hasClipping: false\n            });\n            const preview = new (0, $324add89932145ee$export$133773870222880f)({\n                width: (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall),\n                height: (0, $3ec5d4ed5944260f$export$94cffdbcf128864a)(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr\n                }\n            });\n            preview.render();\n            preview.getElement().classList.add((0, $03ec3d6a52165003$exports.css)({\n                marginLeft: \"-20px\",\n                marginRight: \"-20px\"\n            }));\n            rootEl.append(preview.getElement());\n            result.destroy = ()=>{\n                brightnessSlider.destroy();\n                contrastSlider.destroy();\n                fxPreviewRenderer.destroy();\n                preview.destroy();\n            };\n            result.getInput = function() {\n                result.destroy();\n                return {\n                    brightness: brightness,\n                    contrast: contrast\n                };\n            };\n        }\n        setTimeout(finishInit, 1); // the canvas isn't ready for some reason\n        return result;\n    },\n    apply (params) {\n        const context = params.context;\n        const brightness = params.input.brightness;\n        const contrast = params.input.contrast;\n        const history = params.history;\n        if (!context || !history) return false;\n        history.pause(true);\n        const fxCanvas = (0, $5caaf17bca0749c7$export$8c4423af32b21158)();\n        if (!fxCanvas) return false; // todo more specific error?\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"brightnessContrast\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n\n\n\n\n\n\n\n\n\nconst $979e97880c50429e$export$e5937df51b9e1d86 = {\n    getDialog (params) {\n        const klCanvas = params.klCanvas;\n        if (!klCanvas) return false;\n        const tempCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas();\n        {\n            const fit = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 560, 400, 1);\n            const w = parseInt(\"\" + fit.width), h = parseInt(\"\" + fit.height);\n            const previewFactor = w / klCanvas.getWidth();\n            tempCanvas.width = w;\n            tempCanvas.height = h;\n            tempCanvas.style.display = \"block\";\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(tempCanvas).drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\n        }\n        const rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const result = {\n            element: rootEl\n        };\n        let left = 0, right = 0, top = 0, bottom = 0;\n        let leftChanged = false, rightChanged = false, topChanged = false, bottomChanged = false;\n        const maxWidth = params.maxWidth, maxHeight = params.maxHeight;\n        let scale = 1;\n        // --- input elements ---\n        const lrWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                lineHeight: \"30px\",\n                height: \"35px\"\n            }\n        });\n        const tbWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                lineHeight: \"30px\",\n                height: \"35px\"\n            }\n        });\n        rootEl.append(lrWrapper, tbWrapper);\n        const leftInput = (0, $760dd90d44275661$export$b7e3ae3d7c15e42e)({\n            init: 0,\n            type: \"number\",\n            min: -klCanvas.getWidth(),\n            max: maxWidth,\n            css: {\n                width: \"75px\",\n                marginRight: \"20px\"\n            },\n            callback: function() {\n                leftChanged = true;\n                updateInput();\n            }\n        });\n        const rightInput = (0, $760dd90d44275661$export$b7e3ae3d7c15e42e)({\n            init: 0,\n            type: \"number\",\n            min: -klCanvas.getWidth(),\n            max: maxWidth,\n            css: {\n                width: \"75px\"\n            },\n            callback: function() {\n                rightChanged = true;\n                updateInput();\n            }\n        });\n        const topInput = (0, $760dd90d44275661$export$b7e3ae3d7c15e42e)({\n            init: 0,\n            type: \"number\",\n            min: -klCanvas.getHeight(),\n            max: maxHeight,\n            css: {\n                width: \"75px\",\n                marginRight: \"20px\"\n            },\n            callback: function() {\n                topChanged = true;\n                updateInput();\n            }\n        });\n        const bottomInput = (0, $760dd90d44275661$export$b7e3ae3d7c15e42e)({\n            init: 0,\n            type: \"number\",\n            min: -klCanvas.getHeight(),\n            max: maxHeight,\n            css: {\n                width: \"75px\"\n            },\n            callback: function() {\n                bottomChanged = true;\n                updateInput();\n            }\n        });\n        const labelStyle = {\n            display: \"inline-block\",\n            width: \"60px\"\n        };\n        lrWrapper.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-crop-left\") + \":\",\n            css: labelStyle\n        }), leftInput, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-crop-right\") + \":\",\n            css: labelStyle\n        }), rightInput);\n        tbWrapper.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-crop-top\") + \":\",\n            css: labelStyle\n        }), topInput, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-crop-bottom\") + \":\",\n            css: labelStyle\n        }), bottomInput);\n        function updateInput() {\n            left = parseInt(leftInput.value);\n            right = parseInt(rightInput.value);\n            top = parseInt(topInput.value);\n            bottom = parseInt(bottomInput.value);\n            let newWidth = klCanvas.getWidth() + left + right;\n            let newHeight = klCanvas.getHeight() + top + bottom;\n            if (newWidth <= 0) {\n                if (leftChanged) {\n                    left = -klCanvas.getWidth() - right + 1;\n                    leftInput.value = \"\" + left;\n                }\n                if (rightChanged) {\n                    right = -klCanvas.getWidth() - left + 1;\n                    rightInput.value = \"\" + right;\n                }\n                newWidth = 1;\n            }\n            if (newWidth > maxWidth) {\n                if (leftChanged) {\n                    left = -klCanvas.getWidth() - right + maxWidth;\n                    leftInput.value = \"\" + left;\n                }\n                if (rightChanged) {\n                    right = -klCanvas.getWidth() - left + maxWidth;\n                    rightInput.value = \"\" + right;\n                }\n                newWidth = maxWidth;\n            }\n            if (newHeight <= 0) {\n                if (topChanged) {\n                    top = -klCanvas.getHeight() - bottom + 1;\n                    topInput.value = \"\" + top;\n                }\n                if (bottomChanged) {\n                    bottom = -klCanvas.getHeight() - top + 1;\n                    bottomInput.value = \"\" + bottom;\n                }\n                newHeight = 1;\n            }\n            if (newHeight > maxHeight) {\n                if (topChanged) {\n                    top = -klCanvas.getHeight() - bottom + maxHeight;\n                    topInput.value = \"\" + top;\n                }\n                if (bottomChanged) {\n                    bottom = -klCanvas.getHeight() - top + maxHeight;\n                    bottomInput.value = \"\" + bottom;\n                }\n                newHeight = maxHeight;\n            }\n            cropper.setTransform({\n                x: -left,\n                y: -top,\n                width: newWidth,\n                height: newHeight\n            });\n            leftChanged = false;\n            rightChanged = false;\n            topChanged = false;\n            bottomChanged = false;\n        }\n        let useRuleOfThirds = true;\n        const ruleOThirdsCheckbox = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: true,\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-crop-rule-thirds\"),\n            allowTab: true,\n            callback: function(b) {\n                useRuleOfThirds = b;\n                cropper.showThirds(useRuleOfThirds);\n            }\n        });\n        rootEl.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                clear: \"both\"\n            }\n        }));\n        let selectedRgbaObj = {\n            r: 0,\n            g: 0,\n            b: 0,\n            a: 0\n        };\n        const colorOptionsArr = [\n            {\n                r: 0,\n                g: 0,\n                b: 0,\n                a: 0\n            },\n            {\n                r: 255,\n                g: 255,\n                b: 255,\n                a: 1\n            },\n            {\n                r: 0,\n                g: 0,\n                b: 0,\n                a: 1\n            }\n        ];\n        colorOptionsArr.push({\n            r: params.currentColorRgb.r,\n            g: params.currentColorRgb.g,\n            b: params.currentColorRgb.b,\n            a: 1\n        });\n        colorOptionsArr.push({\n            r: params.secondaryColorRgb.r,\n            g: params.secondaryColorRgb.g,\n            b: params.secondaryColorRgb.b,\n            a: 1\n        });\n        const colorOptions = new (0, $3032e23fa8f3a9e5$export$24ba9b81662d4366)({\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-crop-fill\"),\n            colorArr: colorOptionsArr,\n            onChange: function(rgbaObj) {\n                selectedRgbaObj = rgbaObj;\n                updateBg();\n            }\n        });\n        const flexRow = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                display: \"flex\",\n                justifyContent: \"space-between\",\n                alignItems: \"center\",\n                marginTop: \"10px\"\n            }\n        });\n        rootEl.append(flexRow);\n        flexRow.append(ruleOThirdsCheckbox.getElement(), colorOptions.getElement());\n        // when input field changed, or dragging in preview finished\n        // adjusts the zoom\n        function update(transform) {\n            const fit = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).fitInto(transform.width, transform.height, 260, 180, 1);\n            scale = fit.width / transform.width;\n            const offset = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).centerWithin((0, $3ec5d4ed5944260f$export$d9bc74bec37df668).width, previewHeight, fit.width, fit.height);\n            tempCanvas.style.width = klCanvas.getWidth() * scale + \"px\";\n            tempCanvas.style.height = klCanvas.getHeight() * scale + \"px\";\n            offsetWrapper.style.left = offset.x - transform.x * scale + \"px\";\n            offsetWrapper.style.top = offset.y - transform.y * scale + \"px\";\n            left = parseInt(\"\" + -transform.x);\n            top = parseInt(\"\" + -transform.y);\n            right = parseInt(\"\" + (transform.x + transform.width - klCanvas.getWidth()));\n            bottom = parseInt(\"\" + (transform.y + transform.height - klCanvas.getHeight()));\n            leftInput.value = \"\" + left;\n            topInput.value = \"\" + top;\n            rightInput.value = \"\" + right;\n            bottomInput.value = \"\" + bottom;\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createCheckerDataUrl(parseInt(\"\" + 50 * scale), function(url) {\n                previewWrapper.style.background = \"url(\" + url + \")\";\n                if (selectedRgbaObj.a !== 0) tempCanvas.style.background = \"url(\" + url + \")\";\n            }, (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark());\n            previewWrapper.style.backgroundPosition = offset.x + \"px \" + offset.y + \"px\";\n            cropper.setScale(scale);\n        }\n        const previewHeight = (0, $3ec5d4ed5944260f$export$d9bc74bec37df668).height - 2; // two less because of border\n        const previewWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-edit-crop-preview\",\n            css: {\n                width: (0, $3ec5d4ed5944260f$export$d9bc74bec37df668).width + \"px\",\n                marginTop: \"10px\",\n                marginLeft: \"-20px\",\n                height: previewHeight + \"px\",\n                backgroundColor: \"#9e9e9e\",\n                position: \"relative\",\n                borderTop: \"1px solid rgb(144,144,144)\",\n                borderBottom: \"1px solid rgb(144,144,144)\",\n                overflow: \"hidden\",\n                userSelect: \"none\",\n                touchAction: \"none\"\n            }\n        });\n        previewWrapper.oncontextmenu = function() {\n            return false;\n        };\n        const bgColorOverlay = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                position: \"absolute\",\n                left: \"0\",\n                top: \"0\",\n                bottom: \"0\",\n                right: \"0\"\n            }\n        });\n        previewWrapper.append(bgColorOverlay);\n        const offsetWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: previewWrapper,\n            css: {\n                position: \"absolute\",\n                left: \"0\",\n                top: \"0\"\n            }\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: offsetWrapper,\n            content: tempCanvas,\n            css: {\n                boxShadow: \"0 0 0px 1px rgb(130,130,130)\",\n                position: \"absolute\",\n                left: \"0px\",\n                top: \"0px\"\n            }\n        });\n        rootEl.append(previewWrapper);\n        const cropper = new (0, $c4e8a5b20c195c16$export$71ed2b85d4ca43d3)({\n            x: 0,\n            y: 0,\n            width: klCanvas.getWidth(),\n            height: klCanvas.getHeight(),\n            scale: scale,\n            callback: update,\n            maxW: maxWidth,\n            maxH: maxHeight\n        });\n        update(cropper.getTransform());\n        offsetWrapper.append(cropper.getElement());\n        function updateBg() {\n            if (selectedRgbaObj.a === 0) {\n                bgColorOverlay.style.background = \"\";\n                tempCanvas.style.background = \"\";\n            } else {\n                bgColorOverlay.style.background = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRgbStr(selectedRgbaObj);\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createCheckerDataUrl(parseInt(\"\" + 50 * scale), function(url) {\n                    tempCanvas.style.background = \"url(\" + url + \")\";\n                }, (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark());\n            }\n        }\n        function updateIsDark() {\n            updateInput();\n        }\n        (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).addIsDarkListener(updateIsDark);\n        result.destroy = ()=>{\n            cropper.destroy();\n            ruleOThirdsCheckbox.destroy();\n            (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).removeIsDarkListener(updateIsDark);\n            colorOptions.destroy();\n        };\n        result.getInput = function() {\n            result.destroy();\n            return {\n                left: left,\n                right: right,\n                top: top,\n                bottom: bottom,\n                fillColor: selectedRgbaObj.a === 0 ? undefined : selectedRgbaObj\n            };\n        };\n        return result;\n    },\n    apply (params) {\n        const klCanvas = params.klCanvas;\n        const history = params.history;\n        if (!klCanvas || !history || isNaN(params.input.left) || isNaN(params.input.right) || isNaN(params.input.top) || isNaN(params.input.bottom)) return false;\n        history.pause(true);\n        klCanvas.resizeCanvas(params.input);\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"cropExtend\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(params.input)\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n\n\n\n\n\n\nfunction $160131d78cb8ea88$export$4300cf0a0df418a6() {\n    return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj({\n        r: [\n            [\n                0,\n                0\n            ],\n            [\n                1 / 3,\n                1 / 3\n            ],\n            [\n                2 / 3,\n                2 / 3\n            ],\n            [\n                1,\n                1\n            ]\n        ],\n        g: [\n            [\n                0,\n                0\n            ],\n            [\n                1 / 3,\n                1 / 3\n            ],\n            [\n                2 / 3,\n                2 / 3\n            ],\n            [\n                1,\n                1\n            ]\n        ],\n        b: [\n            [\n                0,\n                0\n            ],\n            [\n                1 / 3,\n                1 / 3\n            ],\n            [\n                2 / 3,\n                2 / 3\n            ],\n            [\n                1,\n                1\n            ]\n        ]\n    });\n}\nclass $160131d78cb8ea88$export$1c43bf66c2a2e4da {\n    // ---- interface ----\n    getElement() {\n        return this.rootEl;\n    }\n    destroy() {\n        this.p0.pointerListener.destroy();\n        this.p1.pointerListener.destroy();\n        this.p2.pointerListener.destroy();\n        this.p3.pointerListener.destroy();\n    }\n    getModeButtons() {\n        return this.modeButtons;\n    }\n    // ---- public ----\n    constructor(p){\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                position: \"relative\",\n                marginBottom: \"10px\"\n            }\n        });\n        this.rootEl.oncontextmenu = ()=>false;\n        let mode = \"All\";\n        let curves = p.curves;\n        this.modeButtons = new (0, $1166276dc18d3ea9$export$c019608e5b5bb4cb)({\n            optionArr: [\n                {\n                    id: \"All\",\n                    label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-curves-all\")\n                },\n                {\n                    id: \"Red\",\n                    label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"red\")\n                },\n                {\n                    id: \"Green\",\n                    label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"green\")\n                },\n                {\n                    id: \"Blue\",\n                    label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"blue\")\n                }\n            ],\n            initId: \"All\",\n            onChange: (id)=>{\n                mode = id;\n                if (mode === \"All\") curves = $160131d78cb8ea88$export$4300cf0a0df418a6();\n                let curve = curves.r;\n                if (mode === \"Green\") curve = curves.g;\n                if (mode === \"Blue\") curve = curves.b;\n                this.p0.setPos(0, areaH - curve[0][1] * areaH);\n                this.p1.setPos(curve[1][0] * areaW, areaH - curve[1][1] * areaH);\n                this.p2.setPos(curve[2][0] * areaW, areaH - curve[2][1] * areaH);\n                this.p3.setPos(areaW, areaH - curve[3][1] * areaH);\n                update();\n            }\n        });\n        this.rootEl.append(this.modeButtons.getElement());\n        const curveArea = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            className: \"kl-curves-graph\",\n            css: {\n                position: \"relative\",\n                marginTop: \"10px\"\n            }\n        });\n        const areaW = 300, areaH = 100;\n        const canvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(areaW, areaH);\n        let ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(canvas);\n        curveArea.append(canvas);\n        const fit = (v)=>{\n            return Math.max(0, Math.min(1, v));\n        };\n        const createPoint = (x, y, callback, lock)=>{\n            const gripSize = 14;\n            let internalY = y, internalX = x;\n            const pointEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                className: \"kl-curves-graph__grip\",\n                css: {\n                    left: x - gripSize / 2 + \"px\",\n                    top: y - gripSize / 2 + \"px\",\n                    width: gripSize + \"px\",\n                    height: gripSize + \"px\",\n                    borderRadius: gripSize + \"px\"\n                }\n            });\n            const update = ()=>{\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(pointEl, {\n                    left: x - gripSize / 2 + \"px\",\n                    top: y - gripSize / 2 + \"px\"\n                });\n            };\n            const pointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n                target: pointEl,\n                onPointer: (event)=>{\n                    event.eventPreventDefault();\n                    if (event.type === \"pointerdown\") {\n                        internalX = x;\n                        internalY = y;\n                    }\n                    if (event.button === \"left\" && event.type === \"pointermove\") {\n                        if (!lock) internalX += event.dX;\n                        x = Math.max(0, Math.min(areaW, internalX));\n                        internalY += event.dY;\n                        y = Math.max(0, Math.min(areaH, internalY));\n                        update();\n                        callback({\n                            x: x,\n                            y: y\n                        });\n                    }\n                }\n            });\n            curveArea.append(pointEl);\n            const setPos = (newX, newY)=>{\n                x = newX;\n                y = newY;\n                internalY = y;\n                internalX = x;\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(pointEl, {\n                    left: x - gripSize / 2 + \"px\",\n                    top: y - gripSize / 2 + \"px\"\n                });\n            };\n            return {\n                el: pointEl,\n                setPos: setPos,\n                pointerListener: pointerListener\n            };\n        };\n        const updateControl = (i, x, y)=>{\n            if (mode === \"All\") {\n                curves.r[i] = [\n                    fit(x / areaW),\n                    fit(1 - y / areaH)\n                ];\n                curves.g[i] = [\n                    fit(x / areaW),\n                    fit(1 - y / areaH)\n                ];\n                curves.b[i] = [\n                    fit(x / areaW),\n                    fit(1 - y / areaH)\n                ];\n            }\n            if (mode === \"Red\") curves.r[i] = [\n                fit(x / areaW),\n                fit(1 - y / areaH)\n            ];\n            if (mode === \"Green\") curves.g[i] = [\n                fit(x / areaW),\n                fit(1 - y / areaH)\n            ];\n            if (mode === \"Blue\") curves.b[i] = [\n                fit(x / areaW),\n                fit(1 - y / areaH)\n            ];\n        };\n        this.p0 = createPoint(0, areaH, (val)=>{\n            updateControl(0, val.x, val.y);\n            update();\n        }, true);\n        this.p1 = createPoint(areaW / 3, areaH / 3 * 2, (val)=>{\n            updateControl(1, val.x, val.y);\n            update();\n        });\n        this.p2 = createPoint(areaW / 3 * 2, areaH / 3, (val)=>{\n            updateControl(2, val.x, val.y);\n            update();\n        });\n        this.p3 = createPoint(areaW, 0, (val)=>{\n            updateControl(3, val.x, val.y);\n            update();\n        }, true);\n        const update = ()=>{\n            ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(canvas);\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n            const outCurves = {\n                r: [],\n                g: [],\n                b: []\n            };\n            for(let i = 0; i < curves.r.length; i++){\n                outCurves.r.push(curves.r[i]);\n                outCurves.g.push(curves.g[i]);\n                outCurves.b.push(curves.b[i]);\n            }\n            const drawCurve = (curve)=>{\n                ctx.beginPath();\n                const spline = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).SplineInterpolator(curve);\n                for(let i = 0; i < 100; i++){\n                    let y = spline.interpolate(i / 100);\n                    y = Math.max(0, Math.min(1, y));\n                    if (i === 0) ctx.moveTo(i / 100 * areaW, areaH - y * areaH);\n                    else ctx.lineTo(i / 100 * areaW, areaH - y * areaH);\n                }\n                ctx.stroke();\n            };\n            ctx.save();\n            if (mode === \"All\") {\n                ctx.strokeStyle = \"black\";\n                drawCurve(outCurves.r);\n            } else {\n                ctx.globalAlpha = 0.5;\n                ctx.strokeStyle = \"red\";\n                drawCurve(outCurves.r);\n                ctx.strokeStyle = \"green\";\n                drawCurve(outCurves.g);\n                ctx.strokeStyle = \"blue\";\n                drawCurve(outCurves.b);\n            }\n            ctx.restore();\n            p.callback(outCurves);\n        };\n        update();\n    }\n}\n\n\n\n\n\n\n\nconst $eafcde4f99931bb4$export$309483fcb6d5c7ca = {\n    getDialog (params) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n        const rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const result = {\n            element: rootEl\n        };\n        const isSmall = (0, $8522c24dbe0f81fc$export$8f6817a932bf45cd)();\n        if (!isSmall) result.width = (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall);\n        let curves = (0, $160131d78cb8ea88$export$4300cf0a0df418a6)();\n        const fxPreviewRenderer = new (0, $7f838dbc615d3028$export$94ec999f33a691e3)({\n            original: context.canvas,\n            onUpdate: (fxCanvas)=>{\n                return fxCanvas.curves(curves.r, curves.g, curves.b);\n            }\n        });\n        function finishInit() {\n            const previewLayerArr = [];\n            for(let i = 0; i < layers.length; i++)previewLayerArr.push({\n                image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                isVisible: layers[i].isVisible,\n                opacity: layers[i].opacity,\n                mixModeStr: layers[i].mixModeStr,\n                hasClipping: false\n            });\n            const preview = new (0, $324add89932145ee$export$133773870222880f)({\n                width: (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall),\n                height: (0, $3ec5d4ed5944260f$export$94cffdbcf128864a)(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr\n                }\n            });\n            preview.getElement().classList.add((0, $03ec3d6a52165003$exports.css)({\n                marginLeft: \"-20px\",\n                marginRight: \"-20px\"\n            }));\n            const input = new (0, $160131d78cb8ea88$export$1c43bf66c2a2e4da)({\n                curves: curves,\n                callback: function(val) {\n                    curves = val;\n                    preview.render();\n                }\n            });\n            const modeButtons = input.getModeButtons();\n            rootEl.append(input.getElement(), preview.getElement());\n            result.destroy = ()=>{\n                input.destroy();\n                modeButtons.destroy();\n                fxPreviewRenderer.destroy();\n                preview.destroy();\n            };\n            result.getInput = function() {\n                result.destroy();\n                return {\n                    curves: curves\n                };\n            };\n        }\n        setTimeout(finishInit, 1);\n        return result;\n    },\n    apply (params) {\n        const context = params.context;\n        const curves = params.input.curves;\n        const history = params.history;\n        if (!context || !history) return false;\n        history.pause(true);\n        const fxCanvas = (0, $5caaf17bca0749c7$export$8c4423af32b21158)();\n        if (!fxCanvas) return false; // todo more specific error?\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"curves\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n\n\n\n\n\n\n\n\nconst $ca7e2a3c6a0e8777$export$9b1b7b3985b9625a = {\n    getDialog (params) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n        const fit = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        const w = parseInt(\"\" + fit.width), h = parseInt(\"\" + fit.height);\n        const rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const result = {\n            element: rootEl\n        };\n        let isHorizontal = true;\n        let isVertical = false;\n        let doFlipCanvas = true;\n        const horizontalCheckbox = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: isHorizontal,\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-flip-horizontal\") + \" \\u27F7\",\n            allowTab: true,\n            callback: function(v) {\n                isHorizontal = v;\n                updatePreview();\n            },\n            css: {\n                marginBottom: \"10px\"\n            }\n        });\n        const verticalCheckbox = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: isVertical,\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-flip-vertical\") + \" \\u2195\",\n            allowTab: true,\n            callback: function(v) {\n                isVertical = v;\n                updatePreview();\n            },\n            css: {\n                marginBottom: \"10px\"\n            }\n        });\n        rootEl.append(horizontalCheckbox.getElement());\n        rootEl.append(verticalCheckbox.getElement());\n        const targetOptions = new (0, $1166276dc18d3ea9$export$c019608e5b5bb4cb)({\n            optionArr: [\n                {\n                    id: true,\n                    label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-flip-image\")\n                },\n                {\n                    id: false,\n                    label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-flip-layer\")\n                }\n            ],\n            onChange: (val)=>{\n                doFlipCanvas = val;\n                updatePreview();\n            }\n        });\n        rootEl.append(targetOptions.getElement());\n        const previewWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-preview-wrapper\",\n            css: {\n                width: (0, $3ec5d4ed5944260f$export$d9bc74bec37df668).width + \"px\",\n                height: (0, $3ec5d4ed5944260f$export$d9bc74bec37df668).height + \"px\"\n            }\n        });\n        const previewLayer = {\n            image: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(Math.round(w), Math.round(h)),\n            isVisible: true,\n            opacity: 1,\n            mixModeStr: \"source-over\"\n        };\n        const klCanvasPreview = new (0, $f48eb0413169e026$export$e258ade1648009b7)({\n            width: Math.round(w),\n            height: Math.round(h),\n            layers: [\n                previewLayer\n            ]\n        });\n        const previewInnerWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-preview-wrapper__canvas\",\n            css: {\n                width: parseInt(\"\" + w) + \"px\",\n                height: parseInt(\"\" + h) + \"px\"\n            }\n        });\n        previewInnerWrapper.append(klCanvasPreview.getElement());\n        previewWrapper.append(previewInnerWrapper);\n        function updatePreview() {\n            const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(previewLayer.image);\n            ctx.save();\n            ctx.clearRect(0, 0, previewLayer.image.width, previewLayer.image.height);\n            if (doFlipCanvas) {\n                if (isHorizontal) {\n                    ctx.translate(previewLayer.image.width, 0);\n                    ctx.scale(-1, 1);\n                }\n                if (isVertical) {\n                    ctx.translate(0, previewLayer.image.height);\n                    ctx.scale(1, -1);\n                }\n            }\n            for(let i = 0; i < layers.length; i++){\n                if (!layers[i].isVisible) continue;\n                ctx.save();\n                if (!doFlipCanvas && selectedLayerIndex === i) {\n                    if (isHorizontal) {\n                        ctx.translate(previewLayer.image.width, 0);\n                        ctx.scale(-1, 1);\n                    }\n                    if (isVertical) {\n                        ctx.translate(0, previewLayer.image.height);\n                        ctx.scale(1, -1);\n                    }\n                }\n                if (ctx.canvas.width > layers[i].context.canvas.width) ctx.imageSmoothingEnabled = false;\n                ctx.globalAlpha = layers[i].opacity;\n                ctx.globalCompositeOperation = layers[i].mixModeStr;\n                ctx.drawImage(layers[i].context.canvas, 0, 0, previewLayer.image.width, previewLayer.image.height);\n                ctx.restore();\n            }\n            klCanvasPreview.render();\n            ctx.restore();\n        }\n        setTimeout(updatePreview, 0);\n        rootEl.append(previewWrapper);\n        result.destroy = ()=>{\n            horizontalCheckbox.destroy();\n            verticalCheckbox.destroy();\n            targetOptions.destroy();\n            klCanvasPreview.destroy();\n        };\n        result.getInput = function() {\n            result.destroy();\n            return {\n                horizontal: isHorizontal,\n                vertical: isVertical,\n                flipCanvas: doFlipCanvas\n            };\n        };\n        return result;\n    },\n    apply (params) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        const history = params.history;\n        const horizontal = params.input.horizontal;\n        const vertical = params.input.vertical;\n        const flipCanvas = params.input.flipCanvas;\n        if (!context || !klCanvas || !history) return false;\n        history.pause(true);\n        klCanvas.flip(horizontal, vertical, flipCanvas ? undefined : (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(klCanvas.getLayerIndex(context.canvas)));\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"flip\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n\n\n\n\n\n\n\n\n\n\n\nconst $345ea86e35fe44da$export$2aa46bd5587f0eb = {\n    getDialog (params) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n        const rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const result = {\n            element: rootEl\n        };\n        const isSmall = (0, $8522c24dbe0f81fc$export$8f6817a932bf45cd)();\n        if (!isSmall) result.width = (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall);\n        let hue = 0, saturation = 0;\n        const fxPreviewRenderer = new (0, $7f838dbc615d3028$export$94ec999f33a691e3)({\n            original: context.canvas,\n            onUpdate: (fxCanvas)=>{\n                return fxCanvas.hueSaturation(hue, saturation);\n            }\n        });\n        function finishInit() {\n            const hueSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-hue-sat-hue\"),\n                width: 300,\n                height: 30,\n                min: -100,\n                max: 100,\n                value: hue * 100,\n                eventResMs: (0, $21a9e2eeab18749b$export$5ec472fd0ce20d84),\n                onChange: function(val) {\n                    hue = val / 100;\n                    preview.render();\n                }\n            });\n            const saturationSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-hue-sat-saturation\"),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 100,\n                value: (saturation + 1) * 50,\n                eventResMs: (0, $21a9e2eeab18749b$export$5ec472fd0ce20d84),\n                onChange: function(val) {\n                    saturation = val / 50 - 1;\n                    preview.render();\n                }\n            });\n            hueSlider.getElement().style.marginBottom = \"10px\";\n            saturationSlider.getElement().style.marginBottom = \"10px\";\n            rootEl.append(hueSlider.getElement(), saturationSlider.getElement());\n            const previewLayerArr = [];\n            for(let i = 0; i < layers.length; i++)previewLayerArr.push({\n                image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                isVisible: layers[i].isVisible,\n                opacity: layers[i].opacity,\n                mixModeStr: layers[i].mixModeStr,\n                hasClipping: false\n            });\n            const preview = new (0, $324add89932145ee$export$133773870222880f)({\n                width: (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall),\n                height: (0, $3ec5d4ed5944260f$export$94cffdbcf128864a)(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr\n                }\n            });\n            preview.render();\n            preview.getElement().classList.add((0, $03ec3d6a52165003$exports.css)({\n                marginLeft: \"-20px\",\n                marginRight: \"-20px\"\n            }));\n            rootEl.append(preview.getElement());\n            result.destroy = ()=>{\n                hueSlider.destroy();\n                saturationSlider.destroy();\n                fxPreviewRenderer.destroy();\n                preview.destroy();\n            };\n            result.getInput = function() {\n                result.destroy();\n                return {\n                    hue: hue,\n                    saturation: saturation\n                };\n            };\n        }\n        setTimeout(finishInit, 1);\n        return result;\n    },\n    apply (params) {\n        const context = params.context;\n        const hue = params.input.hue;\n        const history = params.history;\n        const saturation = params.input.saturation;\n        if (!context || hue === null || saturation === null || !history) return false;\n        history.pause(true);\n        const fxCanvas = (0, $5caaf17bca0749c7$export$8c4423af32b21158)();\n        if (!fxCanvas) return false; // todo more specific error?\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"hueSaturation\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n\n\nconst $19cea8caa4f1f54e$export$b7ebcfbdc840ef76 = {\n    apply (params) {\n        const context = params.context;\n        const history = params.history;\n        if (!context || !history) return false;\n        const fxCanvas = (0, $5caaf17bca0749c7$export$8c4423af32b21158)();\n        if (!fxCanvas) return false;\n        history.pause(true);\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).invert().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"invert\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n\n\n\n\n\nclass $db258f044f5ffd5c$export$b1241e74876d9bbe {\n    update() {\n        this.leftTab.classList.toggle(\"kl-2-tabs--active\", this.value === 0);\n        this.rightTab.classList.toggle(\"kl-2-tabs--active\", this.value === 1);\n    }\n    getElement() {\n        return this.rootEl;\n    }\n    // ---- public ----\n    constructor(params){\n        this.value = params.init;\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-2-tabs\"\n        });\n        this.leftTab = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            content: params.left,\n            className: \"kl-2-tabs__left\"\n        });\n        this.leftTab.onpointerdown = ()=>false;\n        this.rightTab = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.rootEl,\n            content: params.right,\n            className: \"kl-2-tabs__right\"\n        });\n        this.rightTab.onpointerdown = ()=>false;\n        this.update();\n        this.leftTab.onclick = ()=>{\n            if (this.value === 0) return;\n            this.value = 0;\n            this.update();\n            params.onChange(this.value);\n        };\n        this.rightTab.onclick = ()=>{\n            if (this.value === 1) return;\n            this.value = 1;\n            this.update();\n            params.onChange(this.value);\n        };\n    }\n}\n\n\n\n\n\n\n\n\nconst $d90200485e14eee7$var$SIZE = 16;\nclass $d90200485e14eee7$export$87247fc399965417 {\n    update() {\n        const p = (0, $855520c81dfcb96a$export$9b20165a36586806)((0, $a8ca0a6a49a8f94f$export$d562d1c5145f86d0)(this.transform), this.value);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.rootEl, {\n            left: p.x - $d90200485e14eee7$var$SIZE / 2 + \"px\",\n            top: p.y - $d90200485e14eee7$var$SIZE / 2 + \"px\"\n        });\n    }\n    setTransform(transform) {\n        if (JSON.stringify(this.transform) === JSON.stringify(transform)) return;\n        this.transform = transform;\n        this.update();\n    }\n    getValue() {\n        return this.value;\n    }\n    setValue(p) {\n        this.value = {\n            ...p\n        };\n        this.update();\n    }\n    getElement() {\n        return this.rootEl;\n    }\n    destroy() {\n        this.rootEl.remove();\n        this.pointerListener.destroy();\n    }\n    // ------ public ------\n    constructor(p){\n        this.value = {\n            ...p.value\n        };\n        this.transform = {\n            x: 0,\n            y: 0,\n            scale: 1,\n            angleDeg: 0\n        };\n        this.rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                width: $d90200485e14eee7$var$SIZE + \"px\",\n                height: $d90200485e14eee7$var$SIZE + \"px\",\n                backgroundColor: \"#fff\",\n                border: \"2px solid #000\",\n                borderRadius: $d90200485e14eee7$var$SIZE + \"px\",\n                position: \"absolute\",\n                cursor: \"move\",\n                userSelect: \"none\",\n                touchAction: \"none\"\n            }\n        });\n        this.pointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: this.rootEl,\n            onPointer: (event)=>{\n                event.eventPreventDefault();\n                if (event.button === \"left\" && event.type === \"pointermove\") {\n                    this.value.x += event.dX / this.transform.scale;\n                    this.value.y += event.dY / this.transform.scale;\n                    this.update();\n                    p.onChange(this.value);\n                }\n            }\n        });\n    }\n}\n\n\n\n\nconst $68cd0c4958325f46$export$a76d798fa7d85e4e = {\n    getDialog (params) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        const isSmall = (0, $8522c24dbe0f81fc$export$8f6817a932bf45cd)();\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n        const rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const result = {\n            element: rootEl\n        };\n        if (!isSmall) result.width = (0, $3ec5d4ed5944260f$export$858e9cb22b0cda44).width;\n        function finishInit() {\n            const fxCanvas = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)((0, $5caaf17bca0749c7$export$8c4423af32b21158)());\n            const texture = (0, $fc4403c8ee6a33dc$export$5c097f720de072a2)(fxCanvas === null || fxCanvas === void 0 ? void 0 : fxCanvas.texture(context.canvas));\n            function update() {\n                if (isBefore) fxCanvas.draw(texture).update();\n                else fxCanvas.draw(texture).perspective(getFlatArr(beforeInputs), getFlatArr(afterInputs)).update();\n                preview.render();\n            }\n            const rectPoints = [\n                {\n                    x: 0,\n                    y: 0\n                },\n                {\n                    x: context.canvas.width,\n                    y: 0\n                },\n                {\n                    x: context.canvas.width,\n                    y: context.canvas.height\n                },\n                {\n                    x: 0,\n                    y: context.canvas.height\n                }\n            ];\n            const beforeInputs = rectPoints.map((point)=>{\n                return new (0, $d90200485e14eee7$export$87247fc399965417)({\n                    value: point,\n                    onChange: ()=>{\n                        update();\n                    }\n                });\n            });\n            beforeInputs.forEach((item)=>item.getElement().style.display = \"none\");\n            const afterInputs = rectPoints.map((point)=>{\n                return new (0, $d90200485e14eee7$export$87247fc399965417)({\n                    value: point,\n                    onChange: ()=>{\n                        update();\n                    }\n                });\n            });\n            function getFlatArr(inputs, matrix) {\n                return inputs.flatMap((item)=>{\n                    let value = item.getValue();\n                    if (matrix) value = (0, $855520c81dfcb96a$export$9b20165a36586806)(matrix, value);\n                    return [\n                        value.x,\n                        value.y\n                    ];\n                });\n            }\n            let isBefore = false;\n            const beforeAfterTabs = new (0, $db258f044f5ffd5c$export$b1241e74876d9bbe)({\n                left: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"compare-before\"),\n                right: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"compare-after\"),\n                init: 1,\n                onChange: (val)=>{\n                    isBefore = val === 0;\n                    if (isBefore) {\n                        beforeInputs.forEach((item)=>item.getElement().style.display = \"block\");\n                        afterInputs.forEach((item)=>item.getElement().style.display = \"none\");\n                    } else {\n                        beforeInputs.forEach((item, index)=>{\n                            afterInputs[index].setValue(item.getValue());\n                        });\n                        beforeInputs.forEach((item)=>item.getElement().style.display = \"none\");\n                        afterInputs.forEach((item)=>item.getElement().style.display = \"block\");\n                    }\n                    update();\n                }\n            });\n            rootEl.append(beforeAfterTabs.getElement());\n            const previewLayerArr = [];\n            for(let i = 0; i < layers.length; i++)previewLayerArr.push({\n                image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\n                isVisible: layers[i].isVisible,\n                opacity: layers[i].opacity,\n                mixModeStr: layers[i].mixModeStr,\n                hasClipping: false\n            });\n            const preview = new (0, $324add89932145ee$export$133773870222880f)({\n                width: (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall),\n                height: (0, $3ec5d4ed5944260f$export$94cffdbcf128864a)(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr\n                },\n                onTransformChange: (transform)=>{\n                    beforeInputs.forEach((item)=>item.setTransform(transform));\n                    afterInputs.forEach((item)=>item.setTransform(transform));\n                }\n            });\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(preview.getElement(), {\n                overflow: \"hidden\",\n                marginLeft: \"-20px\",\n                marginRight: \"-20px\"\n            });\n            preview.getElement().append(...beforeInputs.map((item)=>item.getElement()), ...afterInputs.map((item)=>item.getElement()));\n            rootEl.append(preview.getElement());\n            update();\n            result.destroy = ()=>{\n                preview.destroy();\n                texture.destroy;\n                beforeInputs.forEach((item)=>item.destroy());\n                afterInputs.forEach((item)=>item.destroy());\n            };\n            result.getInput = ()=>{\n                result.destroy();\n                return {\n                    before: getFlatArr(beforeInputs),\n                    after: getFlatArr(afterInputs)\n                };\n            };\n        }\n        setTimeout(finishInit, 1);\n        return result;\n    },\n    apply (params) {\n        const context = params.context;\n        const history = params.history;\n        const before = params.input.before;\n        const after = params.input.after;\n        if (!context || !before || !after || !history) return false;\n        history.pause(true);\n        const fxCanvas = (0, $5caaf17bca0749c7$export$8c4423af32b21158)();\n        if (!fxCanvas) return false; // todo more specific error?\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).multiplyAlpha().perspective(before, after).unmultiplyAlpha().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"perspective\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n\n\n\n\nvar $2f1731fd923717a5$exports = {};\n\n$2f1731fd923717a5$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"constrain.62f04e45.svg\";\n\n\n\n\n\n\nconst $7bec11dd1272a23d$export$5705240d31427a82 = {\n    getDialog (params) {\n        //BB.centerWithin\n        const klCanvas = params.klCanvas;\n        if (!klCanvas) return false;\n        const fit = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 280, 200, 1);\n        const w = parseInt(\"\" + fit.width), h = parseInt(\"\" + fit.height);\n        let previewFactor = w / klCanvas.getWidth();\n        const tempCanvas = klCanvas.getCompleteCanvas(1);\n        const rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const result = {\n            element: rootEl\n        };\n        let newWidth = klCanvas.getWidth(), newHeight = klCanvas.getHeight();\n        const maxWidth = params.maxWidth, maxHeight = params.maxHeight;\n        const widthWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                width: \"150px\",\n                height: \"35px\",\n                lineHeight: \"30px\"\n            }\n        });\n        const heightWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                width: \"150px\",\n                height: \"35px\",\n                lineHeight: \"30px\"\n            }\n        });\n        const widthInput = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"input\",\n            css: {\n                cssFloat: \"right\",\n                width: \"90px\"\n            },\n            custom: {\n                type: \"number\",\n                min: \"1\",\n                max: \"\" + maxWidth,\n                value: \"\" + klCanvas.getWidth()\n            }\n        });\n        const heightInput = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"input\",\n            css: {\n                cssFloat: \"right\",\n                width: \"90px\"\n            },\n            custom: {\n                type: \"number\",\n                min: \"1\",\n                max: \"\" + maxHeight,\n                value: \"\" + klCanvas.getHeight()\n            }\n        });\n        widthInput.onclick = function() {\n            this.focus();\n            widthChanged = true;\n            update();\n        };\n        heightInput.onclick = function() {\n            this.focus();\n            heightChanged = true;\n            update();\n        };\n        widthInput.onchange = function() {\n            widthChanged = true;\n            update();\n        };\n        heightInput.onchange = function() {\n            heightChanged = true;\n            update();\n        };\n        widthWrapper.append((0, $63d0b335c576c718$export$ce37e184d908d785)(\"width\") + \": \", widthInput);\n        heightWrapper.append((0, $63d0b335c576c718$export$ce37e184d908d785)(\"height\") + \": \", heightInput);\n        const inputWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                background: \"url(\" + (0, (/*@__PURE__*/$parcel$interopDefault($2f1731fd923717a5$exports))) + \") no-repeat 140px 5px\",\n                backgroundSize: \"50px 52px\"\n            }\n        });\n        inputWrapper.append(widthWrapper, heightWrapper);\n        const constrainIm = new Image();\n        constrainIm.src = (0, (/*@__PURE__*/$parcel$interopDefault($2f1731fd923717a5$exports)));\n        constrainIm.height = 40;\n        const sizeTable = (0, $1b372d80cb7a52ec$export$9852986a3ec5f6a0)([\n            [\n                (0, $63d0b335c576c718$export$ce37e184d908d785)(\"width\") + \":&nbsp;\",\n                widthInput,\n                constrainIm\n            ],\n            [\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    css: {\n                        height: \"5px\"\n                    }\n                }),\n                \"\",\n                \"\"\n            ],\n            [\n                (0, $63d0b335c576c718$export$ce37e184d908d785)(\"height\") + \":&nbsp;\",\n                heightInput\n            ]\n        ], {\n            \"0.2\": {\n                rowspan: 3\n            }\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(sizeTable, {\n            marginBottom: \"10px\"\n        });\n        rootEl.append(sizeTable);\n        //contrain checkbox\n        let heightChanged = false, widthChanged = false;\n        const ratio = klCanvas.getWidth() / klCanvas.getHeight();\n        function updateConstrain() {\n            constrainIm.style.display = isConstrained ? \"\" : \"none\";\n            if (isConstrained) {\n                widthInput.value = \"\" + klCanvas.getWidth();\n                heightInput.value = \"\" + klCanvas.getHeight();\n                update();\n            }\n        }\n        let isConstrained = true;\n        const constrainCheckbox = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: true,\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"constrain-proportions\"),\n            allowTab: true,\n            callback: function(b) {\n                isConstrained = b;\n                updateConstrain();\n            }\n        });\n        rootEl.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                clear: \"both\"\n            }\n        }));\n        const algorithmSelect = new (0, $b1ef42bd443626ca$export$ef9b1a59e592288f)({\n            isFocusable: true,\n            optionArr: [\n                [\n                    \"smooth\",\n                    (0, $63d0b335c576c718$export$ce37e184d908d785)(\"algorithm-smooth\")\n                ],\n                [\n                    \"pixelated\",\n                    (0, $63d0b335c576c718$export$ce37e184d908d785)(\"algorithm-pixelated\")\n                ]\n            ],\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"scaling-algorithm\"),\n            initValue: \"smooth\",\n            onChange: ()=>{\n                update();\n            }\n        });\n        const secondRowElement = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: rootEl,\n            css: {\n                display: \"flex\",\n                justifyContent: \"space-between\",\n                \"alignItems\": \"center\"\n            }\n        });\n        secondRowElement.append(constrainCheckbox.getElement(), algorithmSelect.getElement());\n        const previewCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(w, h);\n        previewCanvas.style.imageRendering = \"pixelated\";\n        const previewCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(previewCanvas);\n        function draw() {\n            if (algorithmSelect.getValue() === \"smooth\") {\n                previewCanvas.style.imageRendering = previewFactor > 1 ? \"pixelated\" : \"\";\n                previewCanvas.width = klCanvas.getWidth();\n                previewCanvas.height = klCanvas.getHeight();\n                previewCtx.save();\n                previewCtx.imageSmoothingQuality = \"high\";\n                previewCtx.drawImage(tempCanvas, 0, 0);\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).resizeCanvas(previewCanvas, newWidth, newHeight);\n                previewCtx.restore();\n            } else {\n                previewCanvas.style.imageRendering = \"pixelated\";\n                previewCanvas.width = newWidth;\n                previewCanvas.height = newHeight;\n                previewCtx.save();\n                previewCtx.imageSmoothingEnabled = false;\n                previewCtx.drawImage(tempCanvas, 0, 0, previewCanvas.width, previewCanvas.height);\n                previewCtx.restore();\n            }\n        }\n        function update() {\n            if (widthInput.value.length === 0 && widthChanged || heightInput.value.length === 0 && heightChanged) {\n                heightChanged = false;\n                widthChanged = false;\n                return;\n            }\n            widthInput.value = \"\" + Math.max(1, parseInt(widthInput.value));\n            heightInput.value = \"\" + Math.max(1, parseInt(heightInput.value));\n            if (isConstrained) {\n                if (heightChanged) widthInput.value = \"\" + parseInt(\"\" + parseInt(heightInput.value) * ratio);\n                if (widthChanged) heightInput.value = \"\" + parseInt(\"\" + parseInt(widthInput.value) / ratio);\n                if (parseInt(widthInput.value) > maxWidth || parseInt(heightInput.value) > maxHeight) {\n                    const fit = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).fitInto(parseInt(widthInput.value), parseInt(heightInput.value), maxWidth, maxHeight, 1);\n                    widthInput.value = \"\" + parseInt(\"\" + fit.width);\n                    heightInput.value = \"\" + parseInt(\"\" + fit.height);\n                }\n            }\n            if (parseInt(widthInput.value) > maxWidth) widthInput.value = \"\" + maxWidth;\n            if (parseInt(heightInput.value) > maxHeight) heightInput.value = \"\" + maxHeight;\n            heightChanged = false;\n            widthChanged = false;\n            newWidth = parseInt(widthInput.value);\n            newHeight = parseInt(heightInput.value);\n            const preview = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).fitInto(newWidth, newHeight, 280, 200, 1);\n            const previewW = parseInt(\"\" + preview.width), previewH = parseInt(\"\" + preview.height);\n            previewFactor = previewW / newWidth;\n            const offset = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).centerWithin((0, $3ec5d4ed5944260f$export$d9bc74bec37df668).width, (0, $3ec5d4ed5944260f$export$d9bc74bec37df668).height, previewW, previewH);\n            draw();\n            previewCanvas.style.width = Math.max(1, previewW) + \"px\";\n            previewCanvas.style.height = Math.max(1, previewH) + \"px\";\n            canvasWrapper.style.left = offset.x + \"px\";\n            canvasWrapper.style.top = offset.y + \"px\";\n            canvasWrapper.style.width = Math.max(1, previewW) + \"px\";\n            canvasWrapper.style.height = Math.max(1, previewH) + \"px\";\n        }\n        const previewWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-transparent-preview\",\n            css: {\n                width: (0, $3ec5d4ed5944260f$export$d9bc74bec37df668).width + \"px\",\n                height: (0, $3ec5d4ed5944260f$export$d9bc74bec37df668).height + \"px\",\n                marginLeft: \"-20px\",\n                display: \"table\",\n                marginTop: \"10px\",\n                position: \"relative\",\n                userSelect: \"none\"\n            }\n        });\n        const canvasWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: previewWrapper,\n            content: previewCanvas,\n            className: \"kl-transparent-preview__canvas\",\n            css: {\n                width: w + \"px\",\n                height: h + \"px\",\n                position: \"absolute\",\n                overflow: \"hidden\"\n            }\n        });\n        function updateCheckerboard() {\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createCheckerDataUrl(8, function(url) {\n                previewWrapper.style.background = \"url(\" + url + \")\";\n            }, (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark());\n        }\n        (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).addIsDarkListener(updateCheckerboard);\n        updateCheckerboard();\n        rootEl.append(previewWrapper);\n        update();\n        result.destroy = ()=>{\n            constrainCheckbox.destroy();\n            (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).removeIsDarkListener(updateCheckerboard);\n        };\n        result.getInput = function() {\n            result.destroy();\n            return {\n                width: newWidth,\n                height: newHeight,\n                algorithm: algorithmSelect.getValue()\n            };\n        };\n        return result;\n    },\n    apply (params) {\n        const klCanvas = params.klCanvas;\n        const history = params.history;\n        const width = params.input.width;\n        const height = params.input.height;\n        const algorithm = params.input.algorithm;\n        if (!klCanvas || !history) return false;\n        history.pause(true);\n        klCanvas.resize(width, height, algorithm);\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"resize\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n\n\n\n\nconst $4e52484ae64ee478$export$ac7e9efc751d5791 = {\n    getDialog (params) {\n        const klCanvas = params.klCanvas;\n        if (!klCanvas) return false;\n        const fit = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 280, 200, 1);\n        const w = parseInt(\"\" + fit.width), h = parseInt(\"\" + fit.height);\n        const previewFactor = w / klCanvas.getWidth();\n        const tempCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(w, h);\n        tempCanvas.style.display = \"block\";\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(tempCanvas).drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\n        const rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const result = {\n            element: rootEl\n        };\n        let deg = 0;\n        function update() {\n            canvasWrapper.style.transform = \"rotate(\" + deg + \"deg)\";\n            if (Math.abs(deg % 180) === 90) {\n                //height has to fit width because of rotation\n                const fit = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).fitInto(h, w, 280, 200, 1);\n                const scale = parseInt(\"\" + fit.height) / w;\n                canvasWrapper.style.transform = \"rotate(\" + deg + \"deg) scale(\" + scale + \")\";\n            }\n        }\n        const btnPlus = document.createElement(\"button\");\n        btnPlus.innerHTML = \"<span style='font-size: 1.3em'>\\u27F3</span> 90\\xb0\";\n        const btnMinus = document.createElement(\"button\");\n        btnMinus.innerHTML = \"<span style='font-size: 1.3em'>\\u27F2</span> 90\\xb0\";\n        btnMinus.style.marginRight = \"5px\";\n        btnPlus.onclick = function() {\n            deg += 90;\n            update();\n        };\n        btnMinus.onclick = function() {\n            deg -= 90;\n            update();\n        };\n        rootEl.append(btnMinus, btnPlus);\n        const previewWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-preview-wrapper\",\n            css: {\n                width: (0, $3ec5d4ed5944260f$export$d9bc74bec37df668).width + \"px\",\n                height: (0, $3ec5d4ed5944260f$export$d9bc74bec37df668).height + \"px\",\n                display: \"table\"\n            }\n        });\n        const previewcell = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: previewWrapper,\n            css: {\n                display: \"table-cell\",\n                verticalAlign: \"middle\"\n            }\n        });\n        const canvasWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: previewcell,\n            content: tempCanvas,\n            className: \"kl-preview-wrapper__canvas\",\n            css: {\n                width: w + \"px\",\n                height: h + \"px\",\n                marginLeft: \"auto\",\n                marginRight: \"auto\",\n                overflow: \"hidden\"\n            }\n        });\n        function updateCheckerboard() {\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).createCheckerDataUrl(8, function(url) {\n                canvasWrapper.style.background = \"url(\" + url + \")\";\n            }, (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).isDark());\n        }\n        (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).addIsDarkListener(updateCheckerboard);\n        updateCheckerboard();\n        canvasWrapper.style.transition = \"all 0.2s ease-out\";\n        rootEl.append(previewWrapper);\n        update();\n        result.destroy = ()=>{\n            (0, $74a507c74cfe9692$export$bca14c5b3b88a9c9).removeIsDarkListener(updateCheckerboard);\n        };\n        result.getInput = function() {\n            result.destroy();\n            return {\n                deg: deg\n            };\n        };\n        return result;\n    },\n    apply (params) {\n        const klCanvas = params.klCanvas;\n        const history = params.history;\n        if (!klCanvas || !history) return false;\n        history.pause(true);\n        klCanvas.rotate(params.input.deg);\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"rotate\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst $5aa2347b5ccd9148$export$1b8796b18b7c19ed = {\n    getDialog (params) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n        const rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const result = {\n            element: rootEl\n        };\n        const isSmall = (0, $8522c24dbe0f81fc$export$8f6817a932bf45cd)();\n        if (!isSmall) result.width = (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall);\n        let blur = 20, gradient = 200;\n        let fxPreviewRenderer = {\n            destroy: ()=>{}\n        };\n        function finishInit() {\n            fxPreviewRenderer = new (0, $7f838dbc615d3028$export$94ec999f33a691e3)({\n                original: context.canvas,\n                onUpdate: (fxCanvas, transform)=>{\n                    fa.setTransform(preview.getTransform());\n                    fb.setTransform(preview.getTransform());\n                    const m = (0, $a8ca0a6a49a8f94f$export$d562d1c5145f86d0)(transform);\n                    const a = (0, $855520c81dfcb96a$export$9b20165a36586806)(m, fa.getValue());\n                    const b = (0, $855520c81dfcb96a$export$9b20165a36586806)(m, fb.getValue());\n                    return fxCanvas.multiplyAlpha().tiltShift(a.x, a.y, b.x, b.y, blur * transform.scaleX, gradient * transform.scaleX).unmultiplyAlpha();\n                }\n            });\n            function update() {\n                preview.render();\n            }\n            // focus line control points\n            const fa = new (0, $d90200485e14eee7$export$87247fc399965417)({\n                value: {\n                    x: context.canvas.width / 4,\n                    y: context.canvas.height / 2\n                },\n                onChange: ()=>{\n                    update();\n                }\n            });\n            const fb = new (0, $d90200485e14eee7$export$87247fc399965417)({\n                value: {\n                    x: 3 * context.canvas.width / 4,\n                    y: context.canvas.height / 2\n                },\n                onChange: ()=>{\n                    update();\n                }\n            });\n            const gradientSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-tilt-shift-gradient\"),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 1000,\n                value: gradient,\n                eventResMs: (0, $21a9e2eeab18749b$export$5ec472fd0ce20d84),\n                onChange: function(val) {\n                    gradient = val;\n                    update();\n                }\n            });\n            gradientSlider.getElement().style.marginBottom = \"10px\";\n            rootEl.append(gradientSlider.getElement());\n            const blurSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-tilt-shift-blur\"),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 200,\n                value: blur,\n                eventResMs: (0, $21a9e2eeab18749b$export$5ec472fd0ce20d84),\n                onChange: function(val) {\n                    blur = val;\n                    update();\n                }\n            });\n            blurSlider.getElement().style.marginBottom = \"10px\";\n            rootEl.append(blurSlider.getElement());\n            const previewLayerArr = [];\n            for(let i = 0; i < layers.length; i++)previewLayerArr.push({\n                image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                isVisible: layers[i].isVisible,\n                opacity: layers[i].opacity,\n                mixModeStr: layers[i].mixModeStr,\n                hasClipping: false\n            });\n            const preview = new (0, $324add89932145ee$export$133773870222880f)({\n                width: (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall),\n                height: (0, $3ec5d4ed5944260f$export$94cffdbcf128864a)(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr\n                }\n            });\n            preview.render();\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(preview.getElement(), {\n                overflow: \"hidden\",\n                marginLeft: \"-20px\",\n                marginRight: \"-20px\"\n            });\n            preview.getElement().append(fa.getElement(), fb.getElement());\n            rootEl.append(preview.getElement());\n            result.destroy = ()=>{\n                blurSlider.destroy();\n                gradientSlider.destroy();\n                fa.destroy();\n                fb.destroy();\n                fxPreviewRenderer.destroy();\n                preview.destroy();\n            };\n            result.getInput = function() {\n                result.destroy();\n                return {\n                    a: fa.getValue(),\n                    b: fb.getValue(),\n                    blur: blur,\n                    gradient: gradient\n                };\n            };\n        }\n        setTimeout(finishInit, 1);\n        return result;\n    },\n    apply (params) {\n        const context = params.context;\n        const history = params.history;\n        const a = params.input.a;\n        const b = params.input.b;\n        const blur = params.input.blur;\n        const gradient = params.input.gradient;\n        if (!context || !history) return false;\n        history.pause(true);\n        const fxCanvas = (0, $5caaf17bca0749c7$export$8c4423af32b21158)();\n        if (!fxCanvas) return false; // todo more specific error?\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).multiplyAlpha().tiltShift(a.x, a.y, b.x, b.y, blur, gradient).unmultiplyAlpha().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"tiltShift\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n\n\n\n\n\n\n\n\n\n\n\nconst $31d0877b7a0bd896$export$dc15474d94cdc2b3 = {\n    getDialog (params) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        const isSmall = (0, $8522c24dbe0f81fc$export$8f6817a932bf45cd)();\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(klCanvas.getLayerIndex(context.canvas));\n        // determine bounds and initial transformation\n        const boundsObj = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvasBounds(context);\n        if (!boundsObj) return {\n            error: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-transform-empty\")\n        };\n        const initTransform = {\n            x: boundsObj.x + boundsObj.width / 2,\n            y: boundsObj.y + boundsObj.height / 2,\n            width: boundsObj.width,\n            height: boundsObj.height,\n            angleDeg: 0\n        };\n        const rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const result = {\n            element: rootEl\n        };\n        if (!isSmall) result.width = (0, $3ec5d4ed5944260f$export$858e9cb22b0cda44).width;\n        const keyListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).KeyListener({\n            onDown: function(keyStr) {\n                if ((0, $d9f9f4926aa80a1c$export$921068d8846a1559).isInputFocused(true)) return;\n                if (keyStr === \"left\") {\n                    inputX.value = \"\" + (parseFloat(inputX.value) - 1);\n                    onInputsChanged();\n                }\n                if (keyStr === \"right\") {\n                    inputX.value = \"\" + (parseFloat(inputX.value) + 1);\n                    onInputsChanged();\n                }\n                if (keyStr === \"up\") {\n                    inputY.value = \"\" + (parseFloat(inputY.value) - 1);\n                    onInputsChanged();\n                }\n                if (keyStr === \"down\") {\n                    inputY.value = \"\" + (parseFloat(inputY.value) + 1);\n                    onInputsChanged();\n                }\n            }\n        });\n        const leftWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const rightWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const rotWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const inputY = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"input\"\n        });\n        const inputX = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"input\"\n        });\n        const inputR = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            tagName: \"input\"\n        });\n        leftWrapper.style.width = \"100px\";\n        leftWrapper.style.height = \"30px\";\n        rightWrapper.style.width = \"100px\";\n        rightWrapper.style.height = \"30px\";\n        rightWrapper.style.display = \"inline-block\";\n        leftWrapper.style.display = \"inline-block\";\n        rotWrapper.style.display = \"inline-block\";\n        rotWrapper.style.width = \"150px\";\n        rotWrapper.style.height = \"30px\";\n        inputY.type = \"number\";\n        inputX.type = \"number\";\n        inputR.type = \"number\";\n        inputX.style.width = \"70px\";\n        inputY.style.width = \"70px\";\n        inputR.style.width = \"70px\";\n        inputY.value = \"0\";\n        inputX.value = \"0\";\n        inputR.value = \"0\";\n        inputY.onclick = function() {\n            inputY.focus();\n            onInputsChanged();\n        };\n        inputX.onclick = function() {\n            inputX.focus();\n            onInputsChanged();\n        };\n        inputR.onclick = function() {\n            inputR.focus();\n            onInputsChanged();\n        };\n        inputY.onchange = function() {\n            onInputsChanged();\n        };\n        inputX.onchange = function() {\n            onInputsChanged();\n        };\n        inputR.onchange = function() {\n            onInputsChanged();\n        };\n        inputY.onkeyup = function() {\n            onInputsChanged();\n        };\n        inputX.onkeyup = function() {\n            onInputsChanged();\n        };\n        inputR.onkeyup = function() {\n            onInputsChanged();\n        };\n        leftWrapper.append(\"X: \", inputX);\n        rightWrapper.append(\"Y: \", inputY);\n        rotWrapper.append((0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-transform-rotation\") + \": \", inputR);\n        if (!isSmall) {\n            const inputRow = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                parent: rootEl,\n                css: {\n                    marginTop: \"10px\"\n                }\n            });\n            inputRow.append(leftWrapper, rightWrapper, rotWrapper);\n        }\n        // buttons\n        const actionBtnCss = {\n            marginLeft: \"10px\",\n            marginTop: \"10px\"\n        };\n        const buttonRow = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: rootEl,\n            css: {\n                display: \"flex\",\n                flexWrap: \"wrap\",\n                marginLeft: \"-10px\"\n            }\n        });\n        const flipXBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: buttonRow,\n            tagName: \"button\",\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-transform-flip\") + \" X\",\n            onClick: ()=>{\n                const t = freeTransform.getValue();\n                freeTransform.setSize(-t.width, t.height);\n            },\n            css: actionBtnCss\n        });\n        const flipYBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: buttonRow,\n            tagName: \"button\",\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-transform-flip\") + \" Y\",\n            onClick: ()=>{\n                const t = freeTransform.getValue();\n                freeTransform.setSize(t.width, -t.height);\n            },\n            css: actionBtnCss\n        });\n        const scaleRotLeftBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: buttonRow,\n            tagName: \"button\",\n            content: \"-90\\xb0\",\n            onClick: ()=>{\n                const t = freeTransform.getValue();\n                t.angleDeg -= 90;\n                t.angleDeg %= 360;\n                freeTransform.setAngleDeg(t.angleDeg);\n                inputR.value = \"\" + Math.round(t.angleDeg);\n                updatePreview();\n            },\n            css: actionBtnCss\n        });\n        const scaleRotRightBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: buttonRow,\n            tagName: \"button\",\n            content: \"+90\\xb0\",\n            onClick: ()=>{\n                const t = freeTransform.getValue();\n                t.angleDeg += 90;\n                t.angleDeg %= 360;\n                freeTransform.setAngleDeg(t.angleDeg);\n                inputR.value = \"\" + Math.round(t.angleDeg);\n                updatePreview();\n            },\n            css: actionBtnCss\n        });\n        const scaleDoubleBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: buttonRow,\n            tagName: \"button\",\n            content: \"2x\",\n            onClick: ()=>{\n                const t = freeTransform.getValue();\n                if (constrainCheckbox.getValue()) freeTransform.setSize(freeTransform.getRatio() * t.height * 2, t.height * 2);\n                else freeTransform.setSize(t.width * 2, t.height * 2);\n            },\n            css: actionBtnCss\n        });\n        const scaleHalfBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: buttonRow,\n            tagName: \"button\",\n            content: \"1/2x\",\n            onClick: ()=>{\n                const t = freeTransform.getValue();\n                freeTransform.setSize(Math.round(t.width / 2), Math.round(t.height / 2));\n            },\n            css: actionBtnCss\n        });\n        const centerBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: buttonRow,\n            tagName: \"button\",\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"center\"),\n            onClick: ()=>{\n                const t = freeTransform.getValue();\n                freeTransform.setPos({\n                    x: context.canvas.width / 2,\n                    y: context.canvas.height / 2\n                });\n                freeTransform.setAngleDeg(t.angleDeg);\n                updatePreview();\n            },\n            css: actionBtnCss\n        });\n        let isConstrained = true;\n        const constrainCheckbox = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: true,\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-transform-constrain\"),\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"constrain-proportions\"),\n            allowTab: true,\n            callback: function(b) {\n                isConstrained = b;\n                freeTransform.setIsConstrained(isConstrained);\n            },\n            css: {\n                display: \"inline-block\"\n            }\n        });\n        let isSnapping = false;\n        const snappingCheckbox = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: true,\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-transform-snap\"),\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-transform-snap-title\"),\n            allowTab: true,\n            callback: function(b) {\n                isSnapping = b;\n                freeTransform.setSnapping(isSnapping);\n            },\n            css: {\n                display: \"inline-block\",\n                marginLeft: \"10px\"\n            }\n        });\n        const checkboxWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        checkboxWrapper.append(constrainCheckbox.getElement(), snappingCheckbox.getElement());\n        rootEl.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                clear: \"both\",\n                height: \"10px\"\n            }\n        }));\n        const bottomRow = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: rootEl,\n            css: {\n                display: \"flex\",\n                justifyContent: \"space-between\",\n                alignItems: \"center\",\n                marginBottom: \"10px\"\n            }\n        });\n        const algorithmSelect = new (0, $b1ef42bd443626ca$export$ef9b1a59e592288f)({\n            isFocusable: true,\n            optionArr: [\n                [\n                    \"smooth\",\n                    (0, $63d0b335c576c718$export$ce37e184d908d785)(\"algorithm-smooth\")\n                ],\n                [\n                    \"pixelated\",\n                    (0, $63d0b335c576c718$export$ce37e184d908d785)(\"algorithm-pixelated\")\n                ]\n            ],\n            initValue: \"smooth\",\n            title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"scaling-algorithm\"),\n            onChange: ()=>{\n                updatePreview(true);\n            }\n        });\n        bottomRow.append(checkboxWrapper, algorithmSelect.getElement());\n        const previewCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(context.canvas.width, context.canvas.height);\n        const previewLayerArr = [];\n        for(let i = 0; i < layers.length; i++)previewLayerArr.push({\n            image: i === selectedLayerIndex ? previewCanvas : layers[i].context.canvas,\n            isVisible: layers[i].isVisible,\n            opacity: layers[i].opacity,\n            mixModeStr: layers[i].mixModeStr,\n            hasClipping: false\n        });\n        const preview = new (0, $324add89932145ee$export$133773870222880f)({\n            width: (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall),\n            height: (0, $3ec5d4ed5944260f$export$94cffdbcf128864a)(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr\n            },\n            hasEditMode: true,\n            onModeChange: (m)=>{\n                freeTransform.getElement().style.pointerEvents = m === \"edit\" ? \"\" : \"none\";\n                freeTransform.getElement().style.opacity = m === \"edit\" ? \"\" : \"0.5\";\n            },\n            onTransformChange: (transform)=>{\n                freeTransform.setViewportTransform(transform);\n            },\n            padding: 30\n        });\n        preview.render();\n        preview.getElement().classList.add((0, $03ec3d6a52165003$exports.css)({\n            overflow: \"hidden\",\n            marginLeft: \"-20px\",\n            marginRight: \"-20px\"\n        }));\n        rootEl.append(preview.getElement());\n        let lastDrawnTransformStr = \"\";\n        function updatePreview(doForce = false) {\n            if (!freeTransform) return;\n            const transform = freeTransform.getValue();\n            if (JSON.stringify(transform) === lastDrawnTransformStr && !doForce) return;\n            lastDrawnTransformStr = JSON.stringify(transform);\n            const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(previewCanvas);\n            ctx.save();\n            ctx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).drawTransformedImageWithBounds(ctx, layers[selectedLayerIndex].context.canvas, transform, boundsObj, algorithmSelect.getValue() === \"pixelated\" || (0, $d9f9f4926aa80a1c$export$921068d8846a1559).testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height));\n            ctx.restore();\n            preview.render();\n        }\n        const freeTransform = new (0, $d42d1384577ab84d$export$79a74567acf241b0)({\n            x: initTransform.x,\n            y: initTransform.y,\n            width: initTransform.width,\n            height: initTransform.height,\n            angleDeg: initTransform.angleDeg,\n            isConstrained: true,\n            snapX: [\n                0,\n                context.canvas.width\n            ],\n            snapY: [\n                0,\n                context.canvas.height\n            ],\n            callback: function(t) {\n                inputX.value = \"\" + Math.round(t.x - initTransform.x);\n                inputY.value = \"\" + Math.round(t.y - initTransform.y);\n                inputR.value = \"\" + Math.round(t.angleDeg);\n                updatePreview();\n            },\n            viewportTransform: preview.getTransform()\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(freeTransform.getElement(), {\n            position: \"absolute\",\n            left: \"0\",\n            top: \"0\"\n        });\n        preview.getElement().append(freeTransform.getElement());\n        function onInputsChanged() {\n            freeTransform.setPos({\n                x: parseInt(inputX.value) + initTransform.x,\n                y: parseInt(inputY.value) + initTransform.y\n            });\n            freeTransform.setAngleDeg(parseInt(inputR.value));\n            updatePreview();\n        }\n        updatePreview();\n        result.destroy = ()=>{\n            keyListener.destroy();\n            freeTransform.destroy();\n            constrainCheckbox.destroy();\n            snappingCheckbox.destroy();\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(flipXBtn);\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(flipYBtn);\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(scaleRotLeftBtn);\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(scaleRotRightBtn);\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(scaleDoubleBtn);\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(scaleHalfBtn);\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).destroyEl(centerBtn);\n            preview.destroy();\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).freeCanvas(previewCanvas);\n        };\n        result.getInput = function() {\n            const transform = freeTransform.getValue();\n            const input = {\n                transform: transform,\n                bounds: boundsObj,\n                isPixelated: algorithmSelect.getValue() === \"pixelated\" || (0, $d9f9f4926aa80a1c$export$921068d8846a1559).testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height)\n            };\n            result.destroy();\n            return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(input);\n        };\n        return result;\n    },\n    apply (params) {\n        const context = params.context;\n        const history = params.history;\n        if (!context || !history) return false;\n        history.pause(true);\n        const input = params.input;\n        const copyCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyCanvas(context.canvas);\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).drawTransformedImageWithBounds(context, copyCanvas, input.transform, input.bounds, input.isPixelated);\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"transform\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n\n\n\n\n\n\n\n\n\n\n\nconst $b3e717c77532e1e1$export$55e7eb2ebd0db869 = {\n    getDialog (params) {\n        const klCanvas = params.klCanvas;\n        const context = params.context;\n        if (!klCanvas || !context) return false;\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n        const rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const result = {\n            element: rootEl\n        };\n        const isSmall = (0, $8522c24dbe0f81fc$export$8f6817a932bf45cd)();\n        if (!isSmall) result.width = (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall);\n        let radius = 10;\n        const fxPreviewRenderer = new (0, $7f838dbc615d3028$export$94ec999f33a691e3)({\n            original: context.canvas,\n            onUpdate: (fxCanvas, transform)=>{\n                return fxCanvas.multiplyAlpha().triangleBlur(radius * transform.scaleX).unmultiplyAlpha();\n            }\n        });\n        function finishInit() {\n            const radiusSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"radius\"),\n                width: 300,\n                height: 30,\n                min: 1,\n                max: 200,\n                value: radius,\n                eventResMs: (0, $21a9e2eeab18749b$export$5ec472fd0ce20d84),\n                onChange: (val)=>{\n                    radius = val;\n                    preview.render();\n                }\n            });\n            radiusSlider.getElement().style.marginBottom = \"10px\";\n            rootEl.append(radiusSlider.getElement());\n            const previewLayerArr = [];\n            for(let i = 0; i < layers.length; i++)previewLayerArr.push({\n                image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                isVisible: layers[i].isVisible,\n                opacity: layers[i].opacity,\n                mixModeStr: layers[i].mixModeStr,\n                hasClipping: false\n            });\n            const preview = new (0, $324add89932145ee$export$133773870222880f)({\n                width: (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall),\n                height: (0, $3ec5d4ed5944260f$export$94cffdbcf128864a)(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr\n                }\n            });\n            preview.render();\n            preview.getElement().classList.add((0, $03ec3d6a52165003$exports.css)({\n                marginLeft: \"-20px\",\n                marginRight: \"-20px\"\n            }));\n            rootEl.append(preview.getElement());\n            result.destroy = ()=>{\n                radiusSlider.destroy();\n                fxPreviewRenderer.destroy();\n                preview.destroy();\n            };\n            result.getInput = function() {\n                result.destroy();\n                return {\n                    radius: radius\n                };\n            };\n        }\n        setTimeout(finishInit, 1);\n        return result;\n    },\n    apply (params) {\n        const context = params.context;\n        const history = params.history;\n        const radius = params.input.radius;\n        if (!context || !radius || !history) return false;\n        history.pause(true);\n        const fxCanvas = (0, $5caaf17bca0749c7$export$8c4423af32b21158)();\n        if (!fxCanvas) return false; // todo more specific error?\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).multiplyAlpha().triangleBlur(radius).unmultiplyAlpha().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"blur\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n\n\n\n\n\n\n\n\n\n\nconst $a392dfa9711a1868$export$62ac74a5ea43bd5c = {\n    getDialog (params) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n        const rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const result = {\n            element: rootEl\n        };\n        const isSmall = (0, $8522c24dbe0f81fc$export$8f6817a932bf45cd)();\n        if (!isSmall) result.width = (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall);\n        let radius = 2, strength = 0.51;\n        const fxPreviewRenderer = new (0, $7f838dbc615d3028$export$94ec999f33a691e3)({\n            original: context.canvas,\n            onUpdate: (fxCanvas, transform)=>{\n                return fxCanvas.unsharpMask(radius * transform.scaleX, strength);\n            }\n        });\n        function finishInit() {\n            function update() {\n                preview.render();\n            }\n            const radiusSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"radius\"),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 200,\n                value: 2,\n                //eventResMs: eventResMs,\n                onChange: function(val) {\n                    radius = val;\n                    update();\n                },\n                curve: [\n                    [\n                        0,\n                        0\n                    ],\n                    [\n                        0.1,\n                        2\n                    ],\n                    [\n                        0.5,\n                        50\n                    ],\n                    [\n                        1,\n                        200\n                    ]\n                ]\n            });\n            const strengthSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-unsharp-mask-strength\"),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 50,\n                value: 5.1,\n                //eventResMs: eventResMs,\n                onChange: function(val) {\n                    strength = val / 10;\n                    update();\n                },\n                curve: [\n                    [\n                        0,\n                        0\n                    ],\n                    [\n                        0.1,\n                        2\n                    ],\n                    [\n                        0.5,\n                        10\n                    ],\n                    [\n                        1,\n                        50\n                    ]\n                ]\n            });\n            radiusSlider.getElement().style.marginBottom = \"10px\";\n            strengthSlider.getElement().style.marginBottom = \"10px\";\n            rootEl.append(radiusSlider.getElement());\n            rootEl.append(strengthSlider.getElement());\n            const previewLayerArr = [];\n            for(let i = 0; i < layers.length; i++)previewLayerArr.push({\n                image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                isVisible: layers[i].isVisible,\n                opacity: layers[i].opacity,\n                mixModeStr: layers[i].mixModeStr,\n                hasClipping: false\n            });\n            const preview = new (0, $324add89932145ee$export$133773870222880f)({\n                width: (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall),\n                height: (0, $3ec5d4ed5944260f$export$94cffdbcf128864a)(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr\n                }\n            });\n            update();\n            preview.getElement().classList.add((0, $c072f29bb0ad2433$export$dbf350e5966cf602)({\n                marginLeft: \"-20px\",\n                marginRight: \"-20px\"\n            }));\n            rootEl.append(preview.getElement());\n            result.destroy = ()=>{\n                radiusSlider.destroy();\n                strengthSlider.destroy();\n                fxPreviewRenderer.destroy();\n                preview.destroy();\n            };\n            result.getInput = function() {\n                result.destroy();\n                return {\n                    radius: radius,\n                    strength: strength\n                };\n            };\n        }\n        setTimeout(finishInit, 1);\n        return result;\n    },\n    apply (params) {\n        const context = params.context;\n        const history = params.history;\n        const radius = params.input.radius;\n        const strength = params.input.strength;\n        if (!context || radius === null || strength === null || !history) return false;\n        history.pause(true);\n        const fxCanvas = (0, $5caaf17bca0749c7$export$8c4423af32b21158)();\n        if (!fxCanvas) return false; // todo more specific error?\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).unsharpMask(radius, strength).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"unsharpMask\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n\n\n\n\n\n\n\n\n\n\n\nconst $125e47ad063697cb$export$6158ed2b22ebf4d9 = {\n    getDialog (params) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n        const rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const result = {\n            element: rootEl\n        };\n        const isSmall = (0, $8522c24dbe0f81fc$export$8f6817a932bf45cd)();\n        if (!isSmall) result.width = (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall);\n        function finishInit() {\n            const fxPreviewRenderer = new (0, $7f838dbc615d3028$export$94ec999f33a691e3)({\n                original: context.canvas,\n                onUpdate: (fxCanvas)=>{\n                    return fxCanvas.toAlpha(sourceId === \"inverted-luminance\", selectedRgbaObj);\n                }\n            });\n            // source\n            let sourceId = \"inverted-luminance\";\n            const sourceOptions = new (0, $1166276dc18d3ea9$export$c019608e5b5bb4cb)({\n                optionArr: [\n                    {\n                        id: \"inverted-luminance\",\n                        label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-to-alpha-inverted-lum\")\n                    },\n                    {\n                        id: \"luminance\",\n                        label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-to-alpha-lum\")\n                    }\n                ],\n                initId: sourceId,\n                onChange: function(id) {\n                    sourceId = id;\n                    preview.render();\n                }\n            });\n            rootEl.append(sourceOptions.getElement());\n            // color\n            let selectedRgbaObj = {\n                r: 0,\n                g: 0,\n                b: 0,\n                a: 1\n            };\n            const colorOptionsArr = [\n                null,\n                {\n                    r: 0,\n                    g: 0,\n                    b: 0,\n                    a: 1\n                },\n                {\n                    r: 255,\n                    g: 255,\n                    b: 255,\n                    a: 1\n                },\n                {\n                    r: params.currentColorRgb.r,\n                    g: params.currentColorRgb.g,\n                    b: params.currentColorRgb.b,\n                    a: 1\n                },\n                {\n                    r: params.secondaryColorRgb.r,\n                    g: params.secondaryColorRgb.g,\n                    b: params.secondaryColorRgb.b,\n                    a: 1\n                }\n            ];\n            const colorOptions = new (0, $3032e23fa8f3a9e5$export$24ba9b81662d4366)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-to-alpha-replace\"),\n                colorArr: colorOptionsArr,\n                initialIndex: 1,\n                onChange: function(rgbaObj) {\n                    selectedRgbaObj = rgbaObj;\n                    preview.render();\n                }\n            });\n            colorOptions.getElement().style.marginTop = \"10px\";\n            colorOptions.getElement().style.marginBottom = \"10px\";\n            rootEl.append(colorOptions.getElement());\n            const previewLayerArr = [];\n            for(let i = 0; i < layers.length; i++)previewLayerArr.push({\n                image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                isVisible: layers[i].isVisible,\n                opacity: layers[i].opacity,\n                mixModeStr: layers[i].mixModeStr,\n                hasClipping: false\n            });\n            const preview = new (0, $324add89932145ee$export$133773870222880f)({\n                width: (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall),\n                height: (0, $3ec5d4ed5944260f$export$94cffdbcf128864a)(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr\n                }\n            });\n            preview.render();\n            preview.getElement().classList.add((0, $03ec3d6a52165003$exports.css)({\n                marginLeft: \"-20px\",\n                marginRight: \"-20px\"\n            }));\n            rootEl.append(preview.getElement());\n            result.destroy = ()=>{\n                sourceOptions.destroy();\n                colorOptions.destroy();\n                fxPreviewRenderer.destroy();\n                preview.destroy();\n            };\n            result.getInput = function() {\n                result.destroy();\n                return {\n                    sourceId: sourceId,\n                    selectedRgbaObj: selectedRgbaObj\n                };\n            };\n        }\n        setTimeout(finishInit, 1);\n        return result;\n    },\n    apply (params) {\n        const context = params.context;\n        const history = params.history;\n        const sourceId = params.input.sourceId;\n        const selectedRgbaObj = params.input.selectedRgbaObj;\n        if (!context || !sourceId || !history) return false;\n        history.pause(true);\n        const fxCanvas = (0, $5caaf17bca0749c7$export$8c4423af32b21158)();\n        if (!fxCanvas) return false; // todo more specific error?\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).toAlpha(sourceId === \"inverted-luminance\", selectedRgbaObj).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"toAlpha\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n\n\n\n\n\n// ideas: padding, gutter, other shapes\nfunction $074907f5bc61bd8c$export$20d2db9c68afeac(ctx, cellsX, cellsY, thickness, color, opacity) {\n    ctx.save();\n    const w = ctx.canvas.width;\n    const h = ctx.canvas.height;\n    thickness = Math.round(thickness);\n    const thickIsRound = thickness % 2 === 0;\n    ctx.beginPath();\n    ctx.lineWidth = thickness;\n    ctx.strokeStyle = color;\n    ctx.globalAlpha = opacity;\n    for(let i = 0; i < cellsX - 1; i++){\n        const cw = w / cellsX;\n        let pos = cw * (i + 1);\n        if (thickIsRound) pos = Math.round(pos);\n        else pos = Math.round(pos + 0.5) - 0.5;\n        ctx.moveTo(pos, 0);\n        ctx.lineTo(pos, h);\n    }\n    for(let i = 0; i < cellsY - 1; i++){\n        const ch = h / cellsY;\n        let pos = ch * (i + 1);\n        if (thickIsRound) pos = Math.round(pos);\n        else pos = Math.round(pos + 0.5) - 0.5;\n        ctx.moveTo(0, pos);\n        ctx.lineTo(w, pos);\n    }\n    ctx.stroke();\n    ctx.restore();\n}\n\n\n\n\n\n\n\nconst $3e2f8fc3797db2c6$export$50020de79e1bc23 = {\n    getDialog (params) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(klCanvas.getLayerIndex(context.canvas));\n        const rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const result = {\n            element: rootEl\n        };\n        const isSmall = (0, $8522c24dbe0f81fc$export$8f6817a932bf45cd)();\n        if (!isSmall) result.width = (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall);\n        const settingsObj = {\n            x: 2,\n            y: 2,\n            thickness: 8,\n            color: \"#000\",\n            opacity: 1\n        };\n        const line1 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: rootEl,\n            css: {\n                display: \"flex\",\n                alignItems: \"center\"\n            }\n        });\n        const line2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: rootEl,\n            css: {\n                display: \"flex\",\n                alignItems: \"center\",\n                marginTop: \"10px\",\n                marginBottom: \"10px\"\n            }\n        });\n        const xInput = (0, $760dd90d44275661$export$b7e3ae3d7c15e42e)({\n            init: 2,\n            type: \"number\",\n            min: 1,\n            css: {\n                width: \"75px\",\n                marginRight: \"20px\"\n            },\n            callback: function(v) {\n                settingsObj.x = parseFloat(v);\n                updatePreview();\n            }\n        });\n        const yInput = (0, $760dd90d44275661$export$b7e3ae3d7c15e42e)({\n            init: 2,\n            type: \"number\",\n            min: 1,\n            css: {\n                width: \"75px\",\n                marginRight: \"20px\"\n            },\n            callback: function(v) {\n                settingsObj.y = parseFloat(v);\n                updatePreview();\n            }\n        });\n        const thicknessInput = (0, $760dd90d44275661$export$b7e3ae3d7c15e42e)({\n            init: settingsObj.thickness,\n            type: \"number\",\n            min: 1,\n            css: {\n                width: \"75px\",\n                marginRight: \"20px\"\n            },\n            callback: function(v) {\n                settingsObj.thickness = parseFloat(v);\n                updatePreview();\n            }\n        });\n        let selectedRgbaObj = {\n            r: 0,\n            g: 0,\n            b: 0,\n            a: 1\n        };\n        const colorOptionsArr = [\n            {\n                r: 0,\n                g: 0,\n                b: 0,\n                a: 1\n            },\n            {\n                r: 255,\n                g: 255,\n                b: 255,\n                a: 1\n            }\n        ];\n        colorOptionsArr.push({\n            r: params.currentColorRgb.r,\n            g: params.currentColorRgb.g,\n            b: params.currentColorRgb.b,\n            a: 1\n        });\n        colorOptionsArr.push({\n            r: params.secondaryColorRgb.r,\n            g: params.secondaryColorRgb.g,\n            b: params.secondaryColorRgb.b,\n            a: 1\n        });\n        settingsObj.color = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRgbStr(selectedRgbaObj);\n        const colorOptions = new (0, $3032e23fa8f3a9e5$export$24ba9b81662d4366)({\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"shape-stroke\"),\n            colorArr: colorOptionsArr,\n            onChange: function(rgbaObj) {\n                selectedRgbaObj = rgbaObj;\n                settingsObj.color = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.toRgbStr(selectedRgbaObj);\n                updatePreview();\n            }\n        });\n        const labelStyle = {\n            display: \"inline-block\",\n            marginRight: \"5px\"\n        };\n        line1.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: \"X:\",\n            css: labelStyle\n        }), xInput, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: \"Y:\",\n            css: labelStyle\n        }), yInput);\n        line2.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"shape-line-width\") + \":\",\n            css: labelStyle\n        }), thicknessInput, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                flexGrow: \"1\"\n            }\n        }), colorOptions.getElement());\n        const previewCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(context.canvas.width, context.canvas.height);\n        const previewCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(previewCanvas);\n        const previewLayerArr = layers.map((item, i)=>{\n            return {\n                image: i === selectedLayerIndex ? previewCanvas : item.context.canvas,\n                isVisible: item.isVisible,\n                opacity: item.opacity,\n                mixModeStr: item.mixModeStr,\n                hasClipping: false\n            };\n        });\n        const preview = new (0, $324add89932145ee$export$133773870222880f)({\n            width: (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall),\n            height: (0, $3ec5d4ed5944260f$export$94cffdbcf128864a)(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr\n            }\n        });\n        preview.getElement().classList.add((0, $03ec3d6a52165003$exports.css)({\n            marginLeft: \"-20px\",\n            marginRight: \"-20px\"\n        }));\n        rootEl.append(preview.getElement());\n        function updatePreview() {\n            const ctx = previewCtx;\n            ctx.save();\n            ctx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);\n            ctx.drawImage(context.canvas, 0, 0);\n            (0, $074907f5bc61bd8c$export$20d2db9c68afeac)(ctx, settingsObj.x, settingsObj.y, Math.max(settingsObj.thickness, 1), settingsObj.color, settingsObj.opacity);\n            ctx.restore();\n            preview.render();\n        }\n        updatePreview();\n        preview.render();\n        result.destroy = ()=>{\n            preview.destroy();\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).freeCanvas(previewCanvas);\n            colorOptions.destroy();\n        };\n        result.getInput = function() {\n            result.destroy();\n            return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(settingsObj);\n        };\n        return result;\n    },\n    apply (params) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        const history = params.history;\n        if (!context || !klCanvas || !history) return false;\n        history.pause(true);\n        (0, $074907f5bc61bd8c$export$20d2db9c68afeac)(context, params.input.x, params.input.y, params.input.thickness, params.input.color, params.input.opacity);\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"grid\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst $f4f1194f773d88e8$var$presetArr = [\n    // each pixel random value\n    {\n        type: 0,\n        scaleX: 1,\n        scaleY: 1,\n        offsetX: 0,\n        offsetY: 0,\n        octaves: 1,\n        samples: 1,\n        peaks: 0,\n        brightness: 0,\n        contrast: 0,\n        isReversed: true\n    },\n    // cloud\n    {\n        type: 1,\n        scaleX: 166,\n        scaleY: 164,\n        offsetX: 105,\n        offsetY: 30,\n        octaves: 6,\n        samples: 1,\n        peaks: 0,\n        brightness: 0.055,\n        contrast: 0.23,\n        isReversed: true\n    },\n    // thin lines\n    {\n        type: 1,\n        scaleX: 235,\n        scaleY: 190,\n        offsetX: 3227,\n        offsetY: 2156,\n        octaves: 4,\n        samples: 16,\n        peaks: 22,\n        brightness: -0.375,\n        contrast: 1,\n        isReversed: false\n    },\n    // soft large simplex, only 1 octave\n    {\n        type: 1,\n        scaleX: 40,\n        scaleY: 40,\n        offsetX: 0,\n        offsetY: 0,\n        octaves: 1,\n        samples: 1,\n        peaks: 0,\n        brightness: 0,\n        contrast: 0,\n        isReversed: false\n    },\n    // two value large pixels\n    {\n        type: 0,\n        scaleX: 26,\n        scaleY: 26,\n        offsetX: 557,\n        offsetY: 365,\n        octaves: 1,\n        samples: 1,\n        peaks: 0,\n        brightness: 0.02,\n        contrast: 1,\n        isReversed: true\n    },\n    // zebra\n    {\n        type: 1,\n        scaleX: 1500,\n        scaleY: 1500,\n        offsetX: 745,\n        offsetY: 2871,\n        octaves: 5,\n        samples: 16,\n        peaks: 156.02,\n        brightness: 0.03,\n        contrast: 1,\n        isReversed: true\n    },\n    // sparse dots / stars\n    {\n        type: 1,\n        scaleX: 11,\n        scaleY: 11,\n        offsetX: 2940,\n        offsetY: 2045,\n        octaves: 1,\n        samples: 16,\n        peaks: 1,\n        brightness: -0.045,\n        contrast: 1,\n        isReversed: true\n    },\n    // pseudo marble\n    {\n        type: 2,\n        scaleX: 74,\n        scaleY: 74,\n        offsetX: 4816,\n        offsetY: 1304,\n        octaves: 3,\n        samples: 1,\n        peaks: 2.78,\n        brightness: 0,\n        contrast: 0,\n        isReversed: false\n    }\n];\nfunction $f4f1194f773d88e8$var$drawNoise(fxCanvas, settings) {\n    fxCanvas.noise(settings.seed, settings.type, [\n        settings.scaleX,\n        settings.scaleY\n    ], [\n        fxCanvas.width / 2,\n        fxCanvas.height / 2\n    ], settings.octaves, settings.samples, settings.peaks, settings.brightness, settings.contrast, settings.isReversed, settings.colA, settings.colB, settings.channels ? settings.channels : \"rgb\").update();\n}\nconst $f4f1194f773d88e8$export$1dab0536099042f5 = {\n    getDialog (params) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(klCanvas.getLayerIndex(context.canvas));\n        const thumbImgArr = [];\n        const thumbSize = 32;\n        {\n            const fxCanvas = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)((0, $5caaf17bca0749c7$export$8c4423af32b21158)());\n            const canvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(thumbSize, thumbSize);\n            const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(canvas);\n            const texture = fxCanvas.texture(canvas);\n            fxCanvas.draw(texture).update(); // update fxCanvas size\n            texture.destroy();\n            $f4f1194f773d88e8$var$presetArr.forEach((preset)=>{\n                const thumbImg = new Image();\n                const presetCopy = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(preset);\n                presetCopy.scaleX /= 10;\n                presetCopy.scaleY /= 10;\n                $f4f1194f773d88e8$var$drawNoise(fxCanvas, presetCopy);\n                ctx.drawImage(fxCanvas, 0, 0);\n                thumbImg.src = canvas.toDataURL(\"image/png\");\n                thumbImgArr.push(thumbImg);\n            });\n            texture.destroy();\n        }\n        const rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const result = {\n            element: rootEl\n        };\n        const isSmall = (0, $8522c24dbe0f81fc$export$8f6817a932bf45cd)();\n        if (!isSmall) result.width = (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall);\n        const settingsObj = {\n            seed: Math.random() * 300,\n            presetIndex: 0,\n            scale: 50,\n            opacity: 0.5,\n            isReversed: false,\n            channels: \"rgb\",\n            mixModeStr: \"source-over\",\n            colA: {\n                r: 0,\n                g: 0,\n                b: 0\n            },\n            colB: {\n                r: 255,\n                g: 255,\n                b: 255\n            }\n        };\n        const presetOptions = new (0, $1166276dc18d3ea9$export$c019608e5b5bb4cb)({\n            optionArr: thumbImgArr.map((img, index)=>{\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(img, {\n                    margin: \"1px\",\n                    borderRadius: \"3px\",\n                    transition: \"all 0.1s ease-in-out\"\n                });\n                return {\n                    id: \"\" + index,\n                    label: img\n                };\n            }),\n            initId: \"0\",\n            onChange: (id)=>{\n                settingsObj.presetIndex = Number(id);\n                update();\n            }\n        });\n        presetOptions.getElement().style.marginBottom = \"10px\";\n        rootEl.append(presetOptions.getElement());\n        const scaleSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-noise-scale\"),\n            width: 300,\n            height: 30,\n            min: 1,\n            max: 1000,\n            value: settingsObj.scale,\n            eventResMs: (0, $21a9e2eeab18749b$export$5ec472fd0ce20d84),\n            curve: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).quadraticSplineInput(1, 1000, 0.1),\n            onChange: (value)=>{\n                settingsObj.scale = value;\n                update();\n            }\n        });\n        scaleSlider.getElement().style.marginBottom = \"10px\";\n        const opacitySlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"opacity\"),\n            width: 300,\n            height: 30,\n            min: 0.01,\n            max: 1,\n            value: settingsObj.opacity,\n            eventResMs: (0, $21a9e2eeab18749b$export$5ec472fd0ce20d84),\n            toValue: (displayValue)=>displayValue / 100,\n            toDisplayValue: (value)=>value * 100,\n            onChange: (value)=>{\n                settingsObj.opacity = value;\n                update();\n            }\n        });\n        opacitySlider.getElement().style.marginBottom = \"10px\";\n        const row1El = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                display: \"flex\",\n                alignItems: \"center\",\n                marginBottom: \"10px\"\n            }\n        });\n        const row2El = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                display: \"flex\",\n                marginBottom: \"10px\"\n            }\n        });\n        const channelsOptions = new (0, $1166276dc18d3ea9$export$c019608e5b5bb4cb)({\n            optionArr: [\n                {\n                    id: \"rgb\",\n                    label: \"RGB\"\n                },\n                {\n                    id: \"alpha\",\n                    label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-noise-alpha\")\n                }\n            ],\n            initId: \"rgb\",\n            onChange: (id)=>{\n                settingsObj.channels = id;\n                if (id === \"rgb\") row2El.style.visibility = \"\";\n                else row2El.style.visibility = \"hidden\";\n                update();\n            }\n        });\n        const reverseToggle = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"reverse\"),\n            callback: (val)=>{\n                settingsObj.isReversed = val;\n                update();\n            },\n            allowTab: true\n        });\n        const mixModes = [\n            \"source-over\",\n            undefined,\n            \"darken\",\n            \"multiply\",\n            \"color-burn\",\n            undefined,\n            \"lighten\",\n            \"screen\",\n            \"color-dodge\",\n            undefined,\n            \"overlay\",\n            \"soft-light\",\n            \"hard-light\",\n            undefined,\n            \"difference\",\n            \"exclusion\",\n            undefined,\n            \"hue\",\n            \"saturation\",\n            \"color\",\n            \"luminosity\"\n        ];\n        const blendSelect = new (0, $b1ef42bd443626ca$export$ef9b1a59e592288f)({\n            isFocusable: true,\n            optionArr: mixModes.map((item)=>{\n                return item ? [\n                    item,\n                    (0, $326f2f7e3662b29f$export$6e1bedb2a6cdff30)(item)\n                ] : undefined;\n            }),\n            initValue: settingsObj.mixModeStr,\n            onChange: (val)=>{\n                settingsObj.mixModeStr = val;\n                update();\n            }\n        });\n        blendSelect.getElement().title = (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers-blending\");\n        const colorWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                display: \"flex\"\n            }\n        });\n        const colInputStyle = {\n            width: \"34px\",\n            height: \"34px\",\n            marginRight: \"5px\"\n        };\n        const colAInput = (0, $49faab2330529a96$export$6e4a713ddcda1e5e).input({\n            type: \"color\",\n            init: \"#\" + (0, $b68f66663c02a5d5$export$fb7efcd2e153af6e).toHexString(settingsObj.colA),\n            callback: (val)=>{\n                const newColor = (0, $b68f66663c02a5d5$export$fb7efcd2e153af6e).hexToRGB(val);\n                if (newColor) {\n                    settingsObj.colA = newColor;\n                    update();\n                }\n            },\n            css: colInputStyle\n        });\n        const colBInput = (0, $49faab2330529a96$export$6e4a713ddcda1e5e).input({\n            type: \"color\",\n            init: \"#\" + (0, $b68f66663c02a5d5$export$fb7efcd2e153af6e).toHexString(settingsObj.colB),\n            callback: (val)=>{\n                const newColor = (0, $b68f66663c02a5d5$export$fb7efcd2e153af6e).hexToRGB(val);\n                if (newColor) {\n                    settingsObj.colB = newColor;\n                    update();\n                }\n            },\n            css: colInputStyle\n        });\n        colorWrapper.append(colAInput, colBInput);\n        row1El.append(channelsOptions.getElement(), (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                flexGrow: \"1\"\n            }\n        }), reverseToggle.getElement());\n        row2El.append(blendSelect.getElement(), (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                flexGrow: \"1\"\n            }\n        }), colorWrapper);\n        rootEl.append(scaleSlider.getElement(), opacitySlider.getElement(), row1El, row2El);\n        const fxPreviewRenderer = new (0, $7f838dbc615d3028$export$94ec999f33a691e3)({\n            original: context.canvas,\n            onUpdate: (fxCanvas, transform)=>{\n                const settingsCopy = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj($f4f1194f773d88e8$var$presetArr[settingsObj.presetIndex]);\n                settingsCopy.seed = settingsObj.seed;\n                settingsCopy.scaleX = settingsCopy.scaleX * settingsObj.scale / 50 * transform.scaleX;\n                settingsCopy.scaleY = settingsCopy.scaleY * settingsObj.scale / 50 * transform.scaleY;\n                settingsCopy.colA = settingsObj.colA;\n                settingsCopy.colB = settingsObj.colB;\n                settingsCopy.isReversed = settingsObj.isReversed ? !settingsCopy.isReversed : settingsCopy.isReversed;\n                settingsCopy.channels = settingsObj.channels;\n                settingsCopy.offsetX = context.canvas.width / 2 * transform.scaleX + transform.x;\n                settingsCopy.offsetY = context.canvas.height / 2 * transform.scaleY + transform.y;\n                return fxCanvas.noise(settingsCopy.seed, settingsCopy.type, [\n                    settingsCopy.scaleX,\n                    settingsCopy.scaleY\n                ], [\n                    settingsCopy.offsetX,\n                    settingsCopy.offsetY\n                ], settingsCopy.octaves, settingsCopy.samples, settingsCopy.peaks, settingsCopy.brightness, settingsCopy.contrast, settingsCopy.isReversed, settingsCopy.colA, settingsCopy.colB, settingsCopy.channels ? settingsCopy.channels : \"rgb\");\n            },\n            postMix: {\n                opacity: settingsObj.opacity,\n                operation: settingsObj.channels === \"alpha\" ? \"destination-out\" : settingsObj.mixModeStr\n            }\n        });\n        const previewLayerArr = [];\n        for(let i = 0; i < layers.length; i++)previewLayerArr.push({\n            image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n            isVisible: layers[i].isVisible,\n            opacity: layers[i].opacity,\n            mixModeStr: layers[i].mixModeStr,\n            hasClipping: false\n        });\n        const preview = new (0, $324add89932145ee$export$133773870222880f)({\n            width: (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall),\n            height: (0, $3ec5d4ed5944260f$export$94cffdbcf128864a)(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr\n            }\n        });\n        preview.render();\n        preview.getElement().classList.add((0, $03ec3d6a52165003$exports.css)({\n            marginLeft: \"-20px\",\n            marginRight: \"-20px\"\n        }));\n        rootEl.append(preview.getElement());\n        function update() {\n            fxPreviewRenderer.setPostMix({\n                opacity: settingsObj.opacity,\n                operation: settingsObj.channels === \"alpha\" ? \"destination-out\" : settingsObj.mixModeStr\n            });\n            preview.render();\n        }\n        result.destroy = ()=>{\n            presetOptions.destroy();\n            scaleSlider.destroy();\n            opacitySlider.destroy();\n            reverseToggle.destroy();\n            channelsOptions.destroy();\n            blendSelect.destroy();\n            preview.destroy();\n            fxPreviewRenderer.destroy();\n        };\n        result.getInput = function() {\n            result.destroy();\n            return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(settingsObj);\n        };\n        return result;\n    },\n    apply (params) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        const history = params.history;\n        if (!context || !klCanvas || !history) return false;\n        history.pause(true);\n        const fxCanvas = (0, $5caaf17bca0749c7$export$8c4423af32b21158)();\n        if (!fxCanvas) return false; // todo more specific error?\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).update();\n        texture.destroy();\n        const input = params.input;\n        const presetCopy = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj($f4f1194f773d88e8$var$presetArr[input.presetIndex]);\n        presetCopy.seed = input.seed;\n        presetCopy.scaleX = presetCopy.scaleX * input.scale / 50;\n        presetCopy.scaleY = presetCopy.scaleY * input.scale / 50;\n        presetCopy.colA = input.colA;\n        presetCopy.colB = input.colB;\n        presetCopy.isReversed = input.isReversed ? !presetCopy.isReversed : presetCopy.isReversed;\n        presetCopy.channels = input.channels;\n        $f4f1194f773d88e8$var$drawNoise(fxCanvas, presetCopy);\n        context.save();\n        context.globalAlpha = input.opacity;\n        if (input.channels === \"alpha\") context.globalCompositeOperation = \"destination-out\";\n        else context.globalCompositeOperation = input.mixModeStr;\n        context.drawImage(fxCanvas, 0, 0);\n        context.restore();\n        history.pause(false);\n        history.push({\n            tool: [\n                \"canvas\"\n            ],\n            action: \"replaceLayer\",\n            params: [\n                klCanvas.getLayerIndex(context.canvas),\n                context.getImageData(0, 0, context.canvas.width, context.canvas.height)\n            ]\n        });\n        return true;\n    }\n};\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Draws pattern onto context. Pattern generated from context.\n * Can use blending for smoother transition. Will use area outside of bounds for blending.\n *\n * @param context\n * @param settings\n */ function $0fd8ddcd0821b85a$var$drawPattern(context, settings) {\n    // keep bounds in center via offset\n    // because blending done towards bottom right\n    const blendOffsetX = settings.blend ? Math.round(settings.blend * settings.width / 2) : 0;\n    const blendOffsetY = settings.blend ? Math.round(settings.blend * settings.height / 2) : 0;\n    const finalPatternCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(settings.width, settings.height);\n    if (settings.blend) {\n        // construct pattern via linear blending\n        const blendCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(settings.width * 2, settings.height * 2);\n        const blendCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(blendCanvas);\n        const colTransparent = \"#0000\";\n        const colOpaque = \"#000\";\n        // transfer source to blendCanvas\n        blendCtx.drawImage(context.canvas, -settings.x + blendOffsetX, -settings.y + blendOffsetY);\n        // --- 1 cross-fade vertical ------------------------\n        // erase vertical gradient bottom half\n        blendCtx.save();\n        let blendGradient = blendCtx.createLinearGradient(0, settings.height, 0, settings.height * 2);\n        blendGradient.addColorStop(0, colOpaque);\n        blendGradient.addColorStop(settings.blend, colTransparent);\n        blendCtx.globalCompositeOperation = \"destination-in\";\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\n        blendCtx.restore();\n        // erase vertical gradient top half\n        blendCtx.save();\n        blendGradient = blendCtx.createLinearGradient(0, 0, 0, settings.height);\n        blendGradient.addColorStop(0, colTransparent);\n        blendGradient.addColorStop(settings.blend, colOpaque);\n        blendCtx.globalCompositeOperation = \"destination-in\";\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\n        blendCtx.restore();\n        // draw bottom half over top half\n        blendCtx.save();\n        // lighter needed for accurate cross-fade\n        blendCtx.globalCompositeOperation = \"lighter\";\n        blendCtx.drawImage(blendCanvas, 0, -settings.height);\n        blendCtx.restore();\n        // --- 2 cross-fade horizontal ------------------------\n        // erase horizontal gradient right half\n        blendCtx.save();\n        blendGradient = blendCtx.createLinearGradient(settings.width, 0, settings.width * 2, 0);\n        blendGradient.addColorStop(0, colOpaque);\n        blendGradient.addColorStop(settings.blend, colTransparent);\n        blendCtx.globalCompositeOperation = \"destination-in\";\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\n        blendCtx.restore();\n        // erase horizontal gradient left half\n        blendCtx.save();\n        blendGradient = blendCtx.createLinearGradient(0, 0, settings.width, 0);\n        blendGradient.addColorStop(0, colTransparent);\n        blendGradient.addColorStop(settings.blend, colOpaque);\n        blendCtx.globalCompositeOperation = \"destination-in\";\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\n        blendCtx.restore();\n        // draw right half over left half\n        blendCtx.save();\n        // lighter needed for accurate cross-fade\n        blendCtx.globalCompositeOperation = \"lighter\";\n        blendCtx.drawImage(blendCanvas, -settings.width, 0);\n        blendCtx.restore();\n        // transfer to pattern canvas\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(finalPatternCanvas).drawImage(blendCanvas, 0, 0);\n    } else (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(finalPatternCanvas).drawImage(context.canvas, -settings.x, -settings.y);\n    context.save();\n    context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n    context.translate(settings.offsetX - blendOffsetX, settings.offsetY - blendOffsetY);\n    context.fillStyle = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(context.createPattern(finalPatternCanvas, \"repeat\"));\n    context.fillRect(-settings.offsetX + blendOffsetX, -settings.offsetY + blendOffsetY, context.canvas.width, context.canvas.height);\n    context.restore();\n}\nconst $0fd8ddcd0821b85a$export$5b48b77a483d9b33 = {\n    getDialog (params) {\n        const isSmall = (0, $8522c24dbe0f81fc$export$8f6817a932bf45cd)();\n        const maxSize = 1024;\n        const rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const context = params.context;\n        const width = context.canvas.width;\n        const height = context.canvas.height;\n        let settings = {\n            x: 0,\n            y: 0,\n            width: width <= 250 ? Math.round(width / 4) : 200,\n            height: height <= 250 ? Math.round(height / 4) : 200,\n            blend: 0,\n            offsetX: 0,\n            offsetY: 0\n        };\n        let lastDrawnSettings;\n        // determine bounds\n        const bounds = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvasBounds(context);\n        // adjust settings according to bounds\n        if (bounds && bounds.width <= maxSize && bounds.height <= maxSize && // don't exceed max size\n        (bounds.width < width * 0.75 || bounds.height < height * 0.75 // aren't too large (heuristic)\n        )) {\n            settings.x = bounds.x;\n            settings.y = bounds.y;\n            settings.width = bounds.width;\n            settings.height = bounds.height;\n        } else {\n            settings.x = Math.round(width / 2 - settings.width / 2);\n            settings.y = Math.round(height / 2 - settings.height / 2);\n        }\n        // ---- controls ----\n        const xInput = (0, $760dd90d44275661$export$b7e3ae3d7c15e42e)({\n            init: settings.x,\n            type: \"number\",\n            min: 0,\n            max: width,\n            css: {\n                width: \"100%\"\n            },\n            callback: function(v) {\n                settings.x = Number(v);\n                updatePreview();\n            }\n        });\n        const yInput = (0, $760dd90d44275661$export$b7e3ae3d7c15e42e)({\n            init: settings.y,\n            type: \"number\",\n            min: 0,\n            max: height,\n            css: {\n                width: \"100%\"\n            },\n            callback: function(v) {\n                settings.y = Number(v);\n                updatePreview();\n            }\n        });\n        const widthInput = (0, $760dd90d44275661$export$b7e3ae3d7c15e42e)({\n            init: settings.width,\n            type: \"number\",\n            min: 1,\n            max: Math.min(maxSize, width),\n            css: {\n                width: \"100%\"\n            },\n            callback: function(v) {\n                settings.width = Number(v);\n                updatePreview();\n            }\n        });\n        const heightInput = (0, $760dd90d44275661$export$b7e3ae3d7c15e42e)({\n            init: settings.height,\n            type: \"number\",\n            min: 1,\n            max: Math.min(maxSize, height),\n            css: {\n                width: \"100%\"\n            },\n            callback: function(v) {\n                settings.height = Number(v);\n                updatePreview();\n            }\n        });\n        const inputStyle = {\n            marginLeft: \"5px\",\n            flex: \"1\"\n        };\n        rootEl.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: [\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    tagName: \"label\",\n                    content: [\n                        \"X:\",\n                        xInput\n                    ],\n                    css: inputStyle\n                }),\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    tagName: \"label\",\n                    content: [\n                        \"Y:\",\n                        yInput\n                    ],\n                    css: inputStyle\n                }),\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    tagName: \"label\",\n                    content: [\n                        (0, $63d0b335c576c718$export$ce37e184d908d785)(\"width\") + \":\",\n                        widthInput\n                    ],\n                    css: inputStyle\n                }),\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                    tagName: \"label\",\n                    content: [\n                        (0, $63d0b335c576c718$export$ce37e184d908d785)(\"height\") + \":\",\n                        heightInput\n                    ],\n                    css: inputStyle\n                })\n            ],\n            css: {\n                display: \"flex\",\n                marginLeft: \"-5px\"\n            }\n        }));\n        const blendSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"brush-blending\"),\n            width: 300,\n            height: 30,\n            min: 0,\n            max: 1,\n            value: settings.blend,\n            eventResMs: (0, $21a9e2eeab18749b$export$5ec472fd0ce20d84),\n            onChange: function(val) {\n                settings.blend = val;\n                updatePreview();\n            },\n            formatFunc: (val)=>{\n                return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).round(val, 2);\n            },\n            manualInputRoundDigits: 2\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(blendSlider.getElement(), {\n            margin: \"10px 0\"\n        });\n        rootEl.append(blendSlider.getElement());\n        // ---- preview tabs ----\n        let previewMode = 1; // 0 before, 1 after\n        const beforeAfterTabs = new (0, $db258f044f5ffd5c$export$b1241e74876d9bbe)({\n            left: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"compare-before\"),\n            right: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"compare-after\"),\n            init: previewMode,\n            onChange: (val)=>{\n                previewMode = val;\n                overlayCanvas.style.display = val === 0 ? \"block\" : \"none\";\n                updatePreview(true);\n            }\n        });\n        rootEl.append(beforeAfterTabs.getElement());\n        // ---- previews ----\n        const klCanvas = params.klCanvas;\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(klCanvas.getLayerIndex(context.canvas));\n        const fit = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\n        const w = parseInt(\"\" + fit.width), h = parseInt(\"\" + fit.height);\n        const renderW = Math.min(w, context.canvas.width);\n        const renderH = Math.min(h, context.canvas.height);\n        // const renderFactor = renderW / context.canvas.width;\n        const previewFactor = w / context.canvas.width;\n        const previewWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-preview-wrapper\",\n            css: {\n                width: (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall) + \"px\",\n                height: (0, $3ec5d4ed5944260f$export$94cffdbcf128864a)(isSmall) + \"px\",\n                marginTop: \"0\"\n            }\n        });\n        const previewLayer = {\n            image: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(renderW, renderH),\n            isVisible: layers[selectedLayerIndex].isVisible,\n            opacity: layers[selectedLayerIndex].opacity,\n            mixModeStr: layers[selectedLayerIndex].mixModeStr\n        };\n        const previewLayerArr = layers.map((item, i)=>{\n            if (i === selectedLayerIndex) return previewLayer;\n            else return {\n                image: item.context.canvas,\n                isVisible: item.isVisible,\n                opacity: item.opacity,\n                mixModeStr: item.mixModeStr\n            };\n        });\n        const klCanvasPreview = new (0, $f48eb0413169e026$export$e258ade1648009b7)({\n            width: Math.round(w),\n            height: Math.round(h),\n            layers: previewLayerArr\n        });\n        const overlayCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(w, h);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(overlayCanvas, {\n            position: \"absolute\",\n            left: \"0\",\n            top: \"0\",\n            mixBlendMode: \"difference\",\n            imageRendering: \"pixelated\"\n        });\n        const previewInnerWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-preview-wrapper__canvas\",\n            css: {\n                width: parseInt(\"\" + w) + \"px\",\n                height: parseInt(\"\" + h) + \"px\"\n            }\n        });\n        previewInnerWrapper.append(klCanvasPreview.getElement(), overlayCanvas);\n        previewWrapper.append(previewInnerWrapper);\n        rootEl.append(previewWrapper);\n        // ---- preview input processing ----\n        const inputs = {};\n        function syncInputs() {\n            xInput.value = \"\" + settings.x;\n            yInput.value = \"\" + settings.y;\n            widthInput.value = \"\" + settings.width;\n            heightInput.value = \"\" + settings.height;\n        }\n        const keyListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).KeyListener({});\n        previewWrapper.oncontextmenu = function() {\n            return false;\n        };\n        previewInnerWrapper.style.touchAction = \"none\";\n        const pointerListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).PointerListener({\n            target: previewInnerWrapper,\n            onPointer: (event)=>{\n                if (previewMode === 0) {\n                    if (event.type === \"pointerdown\") {\n                        if (!inputs.state) {\n                            inputs.oldSettings = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(settings);\n                            const x = event.relX / previewFactor;\n                            const y = event.relY / previewFactor;\n                            if ((0, $d9f9f4926aa80a1c$export$921068d8846a1559).isInsideRect({\n                                x: x,\n                                y: y\n                            }, {\n                                x: settings.x,\n                                y: settings.y,\n                                width: settings.width,\n                                height: settings.height\n                            })) inputs.state = \"move\";\n                            else inputs.state = \"select\";\n                            inputs.start = {\n                                x: x,\n                                y: y\n                            };\n                        }\n                    } else if (event.type === \"pointermove\") {\n                        const x = event.relX / previewFactor;\n                        const y = event.relY / previewFactor;\n                        if (inputs.state === \"select\") {\n                            inputs.end = {\n                                x: x,\n                                y: y\n                            };\n                            const x1 = Math.max(0, Math.min(inputs.start.x, inputs.end.x));\n                            const y1 = Math.max(0, Math.min(inputs.start.y, inputs.end.y));\n                            const x2 = Math.min(width, Math.max(inputs.start.x, inputs.end.x));\n                            const y2 = Math.min(height, Math.max(inputs.start.y, inputs.end.y));\n                            settings.x = Math.floor(x1);\n                            settings.y = Math.floor(y1);\n                            settings.width = Math.min(maxSize, Math.ceil(x2 - settings.x));\n                            settings.height = Math.min(maxSize, Math.ceil(y2 - settings.y));\n                            if (keyListener.isPressed(\"shift\")) {\n                                settings.width = Math.min(settings.width, settings.height);\n                                settings.height = Math.min(settings.width, settings.height);\n                            }\n                            if (settings.width === 0 || settings.height === 0) settings = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(inputs.oldSettings);\n                            syncInputs();\n                            updatePreview();\n                        } else if (inputs.state === \"move\") {\n                            const dX = Math.round(x - inputs.start.x);\n                            const dY = Math.round(y - inputs.start.y);\n                            settings.x = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(inputs.oldSettings.x + dX, 0, width - settings.width);\n                            settings.y = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(inputs.oldSettings.y + dY, 0, height - settings.height);\n                            syncInputs();\n                            updatePreview();\n                        }\n                    } else if (event.type === \"pointerup\") {\n                        if (inputs.state) inputs.state = null;\n                    }\n                } else {\n                    if (event.type === \"pointerdown\") {\n                        if (!inputs.state) {\n                            inputs.state = \"move\";\n                            inputs.oldSettings = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(settings);\n                            inputs.start = {\n                                x: event.relX / previewFactor,\n                                y: event.relY / previewFactor\n                            };\n                            inputs.end = null;\n                        }\n                    } else if (event.type === \"pointermove\") {\n                        if (inputs.state) {\n                            inputs.end = {\n                                x: event.relX / previewFactor,\n                                y: event.relY / previewFactor\n                            };\n                            settings.offsetX = Math.round(inputs.end.x - inputs.start.x) + inputs.oldSettings.offsetX;\n                            settings.offsetY = Math.round(inputs.end.y - inputs.start.y) + inputs.oldSettings.offsetY;\n                            updatePreview();\n                        }\n                    } else if (event.type === \"pointerup\") {\n                        if (inputs.state) {\n                            if (!inputs.end) {\n                                settings.offsetX = 0;\n                                settings.offsetY = 0;\n                                updatePreview();\n                            }\n                            inputs.state = null;\n                        }\n                    }\n                }\n            }\n        });\n        // ---------- rendering ---------------------\n        const fullSizeCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(width, height);\n        const fullSizeCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(fullSizeCanvas);\n        function sharpStrokeRect(context, x, y, width, height) {\n            const drawX = Math.round(x + 0.5) - 0.5;\n            const drawY = Math.round(y + 0.5) - 0.5;\n            const drawWidth = Math.round(x + width - drawX);\n            const drawHeight = Math.round(y + height - drawY);\n            context.strokeRect(drawX, drawY, drawWidth, drawHeight);\n        }\n        function updatePreview(doForce) {\n            if (!doForce && lastDrawnSettings && JSON.stringify(lastDrawnSettings) === JSON.stringify(settings)) return;\n            if (previewMode === 0) {\n                fullSizeCtx.clearRect(0, 0, width, height);\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\n                const previewCanvas = previewLayer.image;\n                const previewCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(previewCanvas);\n                previewCtx.save();\n                previewCtx.clearRect(0, 0, renderW, renderH);\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\n                previewCtx.restore();\n                const pW = settings.width * previewFactor;\n                const pH = settings.height * previewFactor;\n                const overlayCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(overlayCanvas);\n                overlayCtx.save();\n                overlayCtx.clearRect(0, 0, w, h);\n                overlayCtx.strokeStyle = \"#fff\";\n                sharpStrokeRect(overlayCtx, settings.x * previewFactor, settings.y * previewFactor, pW, pH);\n                if (settings.blend > 0.05) {\n                    overlayCtx.strokeStyle = \"#f0f\";\n                    sharpStrokeRect(overlayCtx, settings.x * previewFactor - pW / 2 * settings.blend, settings.y * previewFactor - pH / 2 * settings.blend, pW * (1 + settings.blend), pH * (1 + settings.blend));\n                }\n                overlayCtx.restore();\n            } else {\n                fullSizeCtx.clearRect(0, 0, width, height);\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\n                $0fd8ddcd0821b85a$var$drawPattern(fullSizeCtx, settings);\n                const previewCanvas = previewLayer.image;\n                const previewCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(previewCanvas);\n                previewCtx.clearRect(0, 0, renderW, renderH);\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\n            }\n            klCanvasPreview.render();\n            lastDrawnSettings = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(settings);\n        }\n        updatePreview();\n        // ----- result -------------------\n        const destroy = ()=>{\n            blendSlider.destroy();\n            keyListener.destroy();\n            pointerListener.destroy();\n            klCanvasPreview.destroy();\n        };\n        const result = {\n            element: rootEl,\n            destroy: destroy,\n            getInput: ()=>{\n                destroy();\n                return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(settings);\n            }\n        };\n        if (!isSmall) result.width = (0, $3ec5d4ed5944260f$export$858e9cb22b0cda44).width;\n        return result;\n    },\n    apply (params) {\n        const klCanvas = params.klCanvas;\n        const ctx = params.context;\n        const history = params.history;\n        if (!klCanvas || !history) return false;\n        history.pause(true);\n        $0fd8ddcd0821b85a$var$drawPattern(ctx, params.input);\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"pattern\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst $9fcfd66886ad70ef$export$77c344cc65ad0ed2 = {\n    getDialog (params) {\n        const isSmall = (0, $8522c24dbe0f81fc$export$8f6817a932bf45cd)();\n        const rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const context = params.context;\n        let isSynced = true;\n        const settings = {\n            stepSize: 1,\n            distortType: 0,\n            scale: {\n                x: 100,\n                y: 100\n            },\n            strength: {\n                x: 20,\n                y: 20\n            },\n            phase: {\n                x: 0,\n                y: 0\n            },\n            offset: {\n                x: 0,\n                y: 0\n            }\n        };\n        // let lastDrawnSettings = null;\n        // ---- thumb -------\n        const thumbImgArr = [];\n        const thumbSize = 32;\n        {\n            const canvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(thumbSize, thumbSize);\n            const ctx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(canvas);\n            ctx.beginPath();\n            ctx.arc(thumbSize / 2, thumbSize / 2, thumbSize / 2.5, 0, Math.PI * 2);\n            ctx.fill();\n            let gradient = ctx.createLinearGradient(0, 0, thumbSize, thumbSize);\n            gradient.addColorStop(0, \"#00f\");\n            gradient.addColorStop(0.5, \"#f00\");\n            gradient.addColorStop(1, \"#fff\");\n            ctx.fillStyle = gradient;\n            ctx.globalCompositeOperation = \"source-atop\";\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\n            gradient = ctx.createLinearGradient(thumbSize, 0, 0, thumbSize);\n            gradient.addColorStop(0, \"#000\");\n            gradient.addColorStop(1, \"#000\");\n            ctx.fillStyle = gradient;\n            ctx.globalCompositeOperation = \"destination-atop\";\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\n            const fxCanvas = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)((0, $5caaf17bca0749c7$export$8c4423af32b21158)());\n            const texture = fxCanvas.texture(canvas);\n            fxCanvas.draw(texture).update(); // update fxCanvas size\n            const scaleFactor = 20;\n            [\n                0,\n                1,\n                2\n            ].forEach((item)=>{\n                const thumbImg = new Image();\n                const settingsCopy = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(settings);\n                settingsCopy.distortType = item;\n                settingsCopy.scale.x /= scaleFactor;\n                settingsCopy.scale.y /= scaleFactor;\n                settingsCopy.strength.x /= scaleFactor;\n                settingsCopy.strength.y /= scaleFactor;\n                fxCanvas.draw(texture).multiplyAlpha().distort(settingsCopy).unmultiplyAlpha().update();\n                ctx.clearRect(0, 0, thumbSize, thumbSize);\n                ctx.drawImage(fxCanvas, 0, 0);\n                thumbImg.src = canvas.toDataURL(\"image/png\");\n                thumbImgArr.push(thumbImg);\n            });\n            texture.destroy();\n        }\n        // ---- controls ----\n        const topRowEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: rootEl,\n            css: {\n                display: \"flex\",\n                alignItems: \"center\"\n            }\n        });\n        const typeOptions = new (0, $1166276dc18d3ea9$export$c019608e5b5bb4cb)({\n            optionArr: thumbImgArr.map((img, index)=>{\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(img, {\n                    margin: \"1px\",\n                    borderRadius: \"3px\",\n                    transition: \"all 0.1s ease-in-out\"\n                });\n                return {\n                    id: \"\" + index,\n                    label: img\n                };\n            }),\n            initId: \"0\",\n            onChange: (id)=>{\n                settings.distortType = Number(id);\n                preview.render();\n            }\n        });\n        function sync(from) {\n            if (from === \"x\") {\n                settings.scale.y = settings.scale.x;\n                settings.strength.y = settings.strength.x;\n                settings.phase.y = settings.phase.x;\n                sliderArr[3].setValue(settings.scale.y);\n                sliderArr[4].setValue(settings.strength.y);\n                sliderArr[5].setValue(settings.phase.y);\n            } else {\n                settings.scale.x = settings.scale.y;\n                settings.strength.x = settings.strength.y;\n                settings.phase.x = settings.phase.y;\n                sliderArr[0].setValue(settings.scale.x);\n                sliderArr[1].setValue(settings.strength.x);\n                sliderArr[2].setValue(settings.phase.x);\n            }\n            preview.render();\n        }\n        const syncToggle = new (0, $213947897b67ec3a$export$48513f6b9f8ce62d)({\n            init: true,\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-distort-sync-xy\"),\n            callback: (val)=>{\n                isSynced = val;\n                if (isSynced) sync(\"x\");\n            }\n        });\n        topRowEl.append(typeOptions.getElement(), (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                flexGrow: \"1\"\n            }\n        }), syncToggle.getElement());\n        const xyRowEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: rootEl,\n            css: {\n                display: \"flex\",\n                flexWrap: \"wrap\"\n            }\n        });\n        const leftCol = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: xyRowEl,\n            css: {\n                marginRight: \"10px\"\n            }\n        });\n        const rightCol = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: xyRowEl\n        });\n        const sliderWidth = isSmall ? 300 : 245;\n        const sliderArr = [];\n        [\n            \"x\",\n            \"y\"\n        ].forEach((item, index)=>{\n            const targetEl = index === 0 ? leftCol : rightCol;\n            const scaleSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-noise-scale\") + \" \" + item.toUpperCase(),\n                width: sliderWidth,\n                height: 30,\n                min: 1,\n                max: 1000,\n                curve: \"quadratic\",\n                value: settings.scale[item],\n                eventResMs: (0, $21a9e2eeab18749b$export$5ec472fd0ce20d84),\n                onChange: (val)=>{\n                    settings.scale[item] = val;\n                    if (isSynced) sync(item);\n                    else preview.render();\n                }\n            });\n            scaleSlider.getElement().style.marginTop = \"20px\";\n            targetEl.append(scaleSlider.getElement());\n            const strengthSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-unsharp-mask-strength\") + \" \" + item.toUpperCase(),\n                width: sliderWidth,\n                height: 30,\n                min: 0,\n                max: 200,\n                curve: \"quadratic\",\n                value: settings.strength[item],\n                eventResMs: (0, $21a9e2eeab18749b$export$5ec472fd0ce20d84),\n                onChange: (val)=>{\n                    settings.strength[item] = val;\n                    if (isSynced) sync(item);\n                    else preview.render();\n                }\n            });\n            strengthSlider.getElement().style.marginTop = \"10px\";\n            targetEl.append(strengthSlider.getElement());\n            const phaseSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n                label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-distort-phase\") + \" \" + item.toUpperCase(),\n                width: sliderWidth,\n                height: 30,\n                min: 0,\n                max: 1,\n                value: settings.phase[item],\n                manualInputRoundDigits: 2,\n                eventResMs: (0, $21a9e2eeab18749b$export$5ec472fd0ce20d84),\n                formatFunc: (val)=>(0, $d9f9f4926aa80a1c$export$921068d8846a1559).round(val, 2),\n                onChange: (val)=>{\n                    settings.phase[item] = val;\n                    if (isSynced) sync(item);\n                    else preview.render();\n                }\n            });\n            phaseSlider.getElement().style.marginTop = \"10px\";\n            targetEl.append(phaseSlider.getElement());\n            sliderArr.push(scaleSlider);\n            sliderArr.push(strengthSlider);\n            sliderArr.push(phaseSlider);\n        });\n        const stepSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-distort-stepsize\"),\n            width: 300,\n            height: 30,\n            min: 1,\n            max: 300,\n            curve: \"quadratic\",\n            value: settings.stepSize,\n            eventResMs: (0, $21a9e2eeab18749b$export$5ec472fd0ce20d84),\n            onChange: (val)=>{\n                settings.stepSize = Math.round(val);\n                preview.render();\n            }\n        });\n        stepSlider.getElement().style.marginTop = \"20px\";\n        stepSlider.getElement().style.marginBottom = \"10px\";\n        rootEl.append(stepSlider.getElement());\n        // ---- preview ----\n        const klCanvas = params.klCanvas;\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(klCanvas.getLayerIndex(context.canvas));\n        const fxPreviewRenderer = new (0, $7f838dbc615d3028$export$94ec999f33a691e3)({\n            original: context.canvas,\n            onUpdate: (fxCanvas, transform)=>{\n                const scaledSettings = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(settings);\n                scaledSettings.stepSize *= transform.scaleX;\n                scaledSettings.strength.x *= transform.scaleX;\n                scaledSettings.strength.y *= transform.scaleY;\n                if (scaledSettings.distortType !== 2) {\n                    scaledSettings.scale.x *= transform.scaleX;\n                    scaledSettings.scale.y *= transform.scaleY;\n                }\n                scaledSettings.offset.x = -transform.x;\n                scaledSettings.offset.y = -transform.y;\n                return fxCanvas.multiplyAlpha().distort(scaledSettings).unmultiplyAlpha();\n            }\n        });\n        const previewLayerArr = layers.map((item, i)=>{\n            return {\n                image: i === selectedLayerIndex ? fxPreviewRenderer.render : item.context.canvas,\n                isVisible: item.isVisible,\n                opacity: item.opacity,\n                mixModeStr: item.mixModeStr,\n                hasClipping: false\n            };\n        });\n        const preview = new (0, $324add89932145ee$export$133773870222880f)({\n            width: (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall),\n            height: (0, $3ec5d4ed5944260f$export$94cffdbcf128864a)(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr\n            }\n        });\n        preview.render();\n        preview.getElement().classList.add((0, $03ec3d6a52165003$exports.css)({\n            marginLeft: \"-20px\",\n            marginRight: \"-20px\"\n        }));\n        rootEl.append(preview.getElement());\n        const destroy = ()=>{\n            typeOptions.destroy();\n            sliderArr.forEach((item)=>item.destroy());\n            stepSlider.destroy();\n            syncToggle.destroy();\n            fxPreviewRenderer.destroy();\n            preview.destroy();\n        };\n        // ----- result -------------------\n        const result = {\n            element: rootEl,\n            destroy: destroy,\n            getInput: ()=>{\n                destroy();\n                return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(settings);\n            }\n        };\n        if (!isSmall) result.width = (0, $3ec5d4ed5944260f$export$858e9cb22b0cda44).width;\n        return result;\n    },\n    apply (params) {\n        const klCanvas = params.klCanvas;\n        const context = params.context;\n        const history = params.history;\n        if (!klCanvas || !history) return false;\n        history.pause(true);\n        const fxCanvas = (0, $5caaf17bca0749c7$export$8c4423af32b21158)();\n        if (!fxCanvas) return false; // todo more specific error?\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).multiplyAlpha().distort(params.input).unmultiplyAlpha().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"distort\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n\n\n\n\n\n\n\nfunction $9ccc4f1680c2a511$export$8f57d6bdbceb36d0(ctx, x, y, lines, thickness, color, opacity) {\n    ctx.save();\n    const degIncrement = 180 / lines;\n    for(let deg = 0; deg < 180; deg += degIncrement){\n        const p2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).rotateAround({\n            x: x,\n            y: y\n        }, {\n            x: x + 9999,\n            y: y\n        }, deg);\n        (0, $583d130d11db85ad$export$71b514a25c47df50)(ctx, {\n            type: \"line\",\n            x1: x,\n            y1: y,\n            x2: p2.x,\n            y2: p2.y,\n            //angleRad: 0,\n            isOutwards: true,\n            opacity: opacity,\n            //isEraser: false,\n            strokeRgb: color,\n            lineWidth: thickness\n        });\n    }\n    ctx.restore();\n}\n\n\n\n\n\n\n\n\n\nconst $f20653d322f43e28$export$a77e8ecd2a7fa9a5 = {\n    getDialog (params) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) return false;\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(klCanvas.getLayerIndex(context.canvas));\n        const previewCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(context.canvas.width, context.canvas.height);\n        const previewCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(previewCanvas);\n        const rootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const result = {\n            element: rootEl\n        };\n        const isSmall = (0, $8522c24dbe0f81fc$export$8f6817a932bf45cd)();\n        if (!isSmall) result.width = (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall);\n        const settingsObj = {\n            x: context.canvas.width / 2,\n            y: context.canvas.height / 2,\n            lines: 8,\n            thickness: 2,\n            color: {\n                r: 0,\n                g: 0,\n                b: 0\n            },\n            opacity: 1\n        };\n        const linesSlider = new (0, $cd73d123a4560ac3$export$a1855b925e534de7)({\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"filter-vanish-point-lines\"),\n            width: 300,\n            height: 30,\n            min: 2,\n            max: 20,\n            value: settingsObj.lines,\n            curve: \"quadratic\",\n            eventResMs: (0, $21a9e2eeab18749b$export$5ec472fd0ce20d84),\n            onChange: function(val) {\n                settingsObj.lines = Math.round(val);\n                update();\n            }\n        });\n        linesSlider.getElement().style.marginBottom = \"10px\";\n        rootEl.append(linesSlider.getElement());\n        const line1 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: rootEl,\n            css: {\n                display: \"flex\",\n                alignItems: \"center\"\n            }\n        });\n        const line2 = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: rootEl,\n            css: {\n                display: \"flex\",\n                alignItems: \"center\",\n                marginTop: \"10px\",\n                marginBottom: \"10px\"\n            }\n        });\n        const xInput = (0, $760dd90d44275661$export$b7e3ae3d7c15e42e)({\n            init: settingsObj.x,\n            type: \"number\",\n            css: {\n                width: \"75px\",\n                marginRight: \"20px\"\n            },\n            callback: function(v) {\n                settingsObj.x = parseFloat(v);\n                dragInput.setValue({\n                    x: settingsObj.x,\n                    y: settingsObj.y\n                });\n                update();\n            }\n        });\n        const yInput = (0, $760dd90d44275661$export$b7e3ae3d7c15e42e)({\n            init: settingsObj.y,\n            type: \"number\",\n            css: {\n                width: \"75px\",\n                marginRight: \"20px\"\n            },\n            callback: function(v) {\n                settingsObj.y = parseFloat(v);\n                dragInput.setValue({\n                    x: settingsObj.x,\n                    y: settingsObj.y\n                });\n                update();\n            }\n        });\n        const thicknessInput = (0, $760dd90d44275661$export$b7e3ae3d7c15e42e)({\n            init: 2,\n            type: \"number\",\n            min: 1,\n            css: {\n                width: \"75px\",\n                marginRight: \"20px\"\n            },\n            callback: function(v) {\n                settingsObj.thickness = parseFloat(v);\n                update();\n            }\n        });\n        let selectedRgbaObj = {\n            r: 0,\n            g: 0,\n            b: 0,\n            a: 1\n        };\n        const colorOptionsArr = [\n            {\n                r: 0,\n                g: 0,\n                b: 0,\n                a: 1\n            },\n            {\n                r: 255,\n                g: 255,\n                b: 255,\n                a: 1\n            }\n        ];\n        colorOptionsArr.push({\n            r: params.currentColorRgb.r,\n            g: params.currentColorRgb.g,\n            b: params.currentColorRgb.b,\n            a: 1\n        });\n        colorOptionsArr.push({\n            r: params.secondaryColorRgb.r,\n            g: params.secondaryColorRgb.g,\n            b: params.secondaryColorRgb.b,\n            a: 1\n        });\n        settingsObj.color = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(selectedRgbaObj);\n        const colorOptions = new (0, $3032e23fa8f3a9e5$export$24ba9b81662d4366)({\n            label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"shape-stroke\"),\n            colorArr: colorOptionsArr,\n            onChange: function(rgbaObj) {\n                selectedRgbaObj = rgbaObj;\n                settingsObj.color = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(selectedRgbaObj);\n                update();\n            }\n        });\n        const labelStyle = {\n            display: \"inline-block\",\n            marginRight: \"5px\"\n        };\n        line1.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: \"X:\",\n            css: labelStyle\n        }), xInput, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: \"Y:\",\n            css: labelStyle\n        }), yInput);\n        line2.append((0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"shape-line-width\") + \":\",\n            css: labelStyle\n        }), thicknessInput, (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                flexGrow: \"1\"\n            }\n        }), colorOptions.getElement());\n        // ---- preview input processing ----\n        function syncInputs() {\n            xInput.value = \"\" + settingsObj.x;\n            yInput.value = \"\" + settingsObj.y;\n        }\n        function update() {\n            const ctx = previewCtx;\n            const w = previewCanvas.width;\n            const h = previewCanvas.height;\n            ctx.save();\n            ctx.clearRect(0, 0, w, h);\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            (0, $9ccc4f1680c2a511$export$8f57d6bdbceb36d0)(ctx, settingsObj.x, settingsObj.y, settingsObj.lines, Math.max(settingsObj.thickness, 1), settingsObj.color, settingsObj.opacity);\n            ctx.restore();\n            preview.render();\n        }\n        const onRender = ()=>{\n            dragInput.setTransform(preview.getTransform());\n            return previewCanvas;\n        };\n        const previewLayerArr = [];\n        for(let i = 0; i < layers.length; i++)previewLayerArr.push({\n            image: i === selectedLayerIndex ? onRender : layers[i].context.canvas,\n            isVisible: layers[i].isVisible,\n            opacity: layers[i].opacity,\n            mixModeStr: layers[i].mixModeStr,\n            hasClipping: false\n        });\n        const preview = new (0, $324add89932145ee$export$133773870222880f)({\n            width: (0, $3ec5d4ed5944260f$export$8b9199c1f5e4be8)(isSmall),\n            height: (0, $3ec5d4ed5944260f$export$94cffdbcf128864a)(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr\n            }\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(preview.getElement(), {\n            marginLeft: \"-20px\",\n            marginRight: \"-20px\",\n            overflow: \"hidden\"\n        });\n        const dragInput = new (0, $d90200485e14eee7$export$87247fc399965417)({\n            value: {\n                x: settingsObj.x,\n                y: settingsObj.y\n            },\n            onChange: (val)=>{\n                settingsObj.x = Math.round(val.x);\n                settingsObj.y = Math.round(val.y);\n                syncInputs();\n                update();\n            }\n        });\n        update();\n        preview.getElement().append(dragInput.getElement());\n        rootEl.append(preview.getElement());\n        result.destroy = ()=>{\n            linesSlider.destroy();\n            colorOptions.destroy();\n            preview.destroy();\n        };\n        result.getInput = function() {\n            result.destroy();\n            return (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(settingsObj);\n        };\n        return result;\n    },\n    apply (params) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        const history = params.history;\n        if (!context || !klCanvas || !history) return false;\n        history.pause(true);\n        (0, $9ccc4f1680c2a511$export$8f57d6bdbceb36d0)(context, params.input.x, params.input.y, params.input.lines, params.input.thickness, params.input.color, params.input.opacity);\n        history.pause(false);\n        history.push({\n            tool: [\n                \"filter\",\n                \"vanishPoint\"\n            ],\n            action: \"apply\",\n            params: [\n                {\n                    input: params.input\n                }\n            ]\n        });\n        return true;\n    }\n};\n\n\nfunction $a5bdfa66fb1ba8cd$var$importFilter(libObj, moduleObj) {\n    if (moduleObj.getDialog) libObj.getDialog = moduleObj.getDialog;\n    libObj.apply = moduleObj.apply;\n}\nfunction $a5bdfa66fb1ba8cd$export$4283b00eae4a6956() {\n    if ((0, $aa2ca71db1de8ae6$export$7a4e0b62a5d854bc).isLoaded) return;\n    $a5bdfa66fb1ba8cd$var$importFilter((0, $aa2ca71db1de8ae6$export$395d33c8e06b92c9).brightnessContrast, (0, $257cfc293f7e7cb2$export$af433fb90aa90a38));\n    $a5bdfa66fb1ba8cd$var$importFilter((0, $aa2ca71db1de8ae6$export$395d33c8e06b92c9).cropExtend, (0, $979e97880c50429e$export$e5937df51b9e1d86));\n    $a5bdfa66fb1ba8cd$var$importFilter((0, $aa2ca71db1de8ae6$export$395d33c8e06b92c9).curves, (0, $eafcde4f99931bb4$export$309483fcb6d5c7ca));\n    $a5bdfa66fb1ba8cd$var$importFilter((0, $aa2ca71db1de8ae6$export$395d33c8e06b92c9).flip, (0, $ca7e2a3c6a0e8777$export$9b1b7b3985b9625a));\n    $a5bdfa66fb1ba8cd$var$importFilter((0, $aa2ca71db1de8ae6$export$395d33c8e06b92c9).hueSaturation, (0, $345ea86e35fe44da$export$2aa46bd5587f0eb));\n    $a5bdfa66fb1ba8cd$var$importFilter((0, $aa2ca71db1de8ae6$export$395d33c8e06b92c9).invert, (0, $19cea8caa4f1f54e$export$b7ebcfbdc840ef76));\n    $a5bdfa66fb1ba8cd$var$importFilter((0, $aa2ca71db1de8ae6$export$395d33c8e06b92c9).perspective, (0, $68cd0c4958325f46$export$a76d798fa7d85e4e));\n    $a5bdfa66fb1ba8cd$var$importFilter((0, $aa2ca71db1de8ae6$export$395d33c8e06b92c9).resize, (0, $7bec11dd1272a23d$export$5705240d31427a82));\n    $a5bdfa66fb1ba8cd$var$importFilter((0, $aa2ca71db1de8ae6$export$395d33c8e06b92c9).rotate, (0, $4e52484ae64ee478$export$ac7e9efc751d5791));\n    $a5bdfa66fb1ba8cd$var$importFilter((0, $aa2ca71db1de8ae6$export$395d33c8e06b92c9).tiltShift, (0, $5aa2347b5ccd9148$export$1b8796b18b7c19ed));\n    $a5bdfa66fb1ba8cd$var$importFilter((0, $aa2ca71db1de8ae6$export$395d33c8e06b92c9).transform, (0, $31d0877b7a0bd896$export$dc15474d94cdc2b3));\n    $a5bdfa66fb1ba8cd$var$importFilter((0, $aa2ca71db1de8ae6$export$395d33c8e06b92c9).blur, (0, $b3e717c77532e1e1$export$55e7eb2ebd0db869));\n    $a5bdfa66fb1ba8cd$var$importFilter((0, $aa2ca71db1de8ae6$export$395d33c8e06b92c9).unsharpMask, (0, $a392dfa9711a1868$export$62ac74a5ea43bd5c));\n    $a5bdfa66fb1ba8cd$var$importFilter((0, $aa2ca71db1de8ae6$export$395d33c8e06b92c9).toAlpha, (0, $125e47ad063697cb$export$6158ed2b22ebf4d9));\n    $a5bdfa66fb1ba8cd$var$importFilter((0, $aa2ca71db1de8ae6$export$395d33c8e06b92c9).grid, (0, $3e2f8fc3797db2c6$export$50020de79e1bc23));\n    $a5bdfa66fb1ba8cd$var$importFilter((0, $aa2ca71db1de8ae6$export$395d33c8e06b92c9).noise, (0, $f4f1194f773d88e8$export$1dab0536099042f5));\n    $a5bdfa66fb1ba8cd$var$importFilter((0, $aa2ca71db1de8ae6$export$395d33c8e06b92c9).pattern, (0, $0fd8ddcd0821b85a$export$5b48b77a483d9b33));\n    $a5bdfa66fb1ba8cd$var$importFilter((0, $aa2ca71db1de8ae6$export$395d33c8e06b92c9).distort, (0, $9fcfd66886ad70ef$export$77c344cc65ad0ed2));\n    $a5bdfa66fb1ba8cd$var$importFilter((0, $aa2ca71db1de8ae6$export$395d33c8e06b92c9).vanishPoint, (0, $f20653d322f43e28$export$a77e8ecd2a7fa9a5));\n    (0, $aa2ca71db1de8ae6$export$7a4e0b62a5d854bc).isLoaded = true;\n}\n\n\n\n\n\nasync function $3ccac2760787e643$export$92433b641be3f7a(klCanvas) {\n    const layerArr = klCanvas.getLayersFast();\n    const psdConfig = {\n        width: klCanvas.getWidth(),\n        height: klCanvas.getHeight(),\n        //canvas: klCanvas.getCompleteCanvas(1), // preview, can be skipped\n        children: layerArr.map((item)=>{\n            // todo - can be optimized if layer mostly empty\n            return {\n                name: item.name,\n                hidden: !item.isVisible,\n                opacity: item.opacity,\n                canvas: item.canvas,\n                blendMode: (0, $49faab2330529a96$export$6e4a713ddcda1e5e).PSD.blendKlToPsd(item.mixModeStr),\n                left: 0,\n                top: 0\n            };\n        })\n    };\n    const agPsd = await (0, $e4b3248b4ce95ea5$export$ab3d838b1d336b38)();\n    const buffer = agPsd.writePsdBuffer(psdConfig);\n    return new Blob([\n        buffer\n    ], {\n        type: \"application/octet-stream\"\n    });\n}\n\n\n\n\n\nclass $2d79f7f8e2e2d334$export$c57e2ed65bcf4d6a {\n    chainIn(event) {\n        event = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(event);\n        this.timeout && clearTimeout(this.timeout);\n        this.interval && clearInterval(this.interval);\n        if (event.type === \"down\") this.lastMixedInput = {\n            x: event.x,\n            y: event.y,\n            pressure: event.pressure\n        };\n        if (event.type === \"move\") {\n            const inputX = event.x;\n            const inputY = event.y;\n            const inputPressure = event.pressure;\n            event.x = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(event.x, this.lastMixedInput.x, this.smoothing);\n            event.y = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(event.y, this.lastMixedInput.y, this.smoothing);\n            event.pressure = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(event.pressure, this.lastMixedInput.pressure, this.smoothing);\n            this.lastMixedInput = {\n                x: event.x,\n                y: event.y,\n                pressure: event.pressure\n            };\n            if (this.smoothing > 0) this.timeout = setTimeout(()=>{\n                this.interval = setInterval(()=>{\n                    event = JSON.parse(JSON.stringify(event));\n                    event.x = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(inputX, this.lastMixedInput.x, this.smoothing);\n                    event.y = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(inputY, this.lastMixedInput.y, this.smoothing);\n                    event.pressure = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).mix(inputPressure, this.lastMixedInput.pressure, this.smoothing);\n                    this.lastMixedInput = {\n                        x: event.x,\n                        y: event.y,\n                        pressure: event.pressure\n                    };\n                    this.chainOut && this.chainOut(event);\n                }, 35);\n            }, 80);\n        }\n        return event;\n    }\n    setChainOut(func) {\n        this.chainOut = func;\n    }\n    setSmoothing(s) {\n        this.smoothing = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(s, 0, 1);\n    }\n    // --- public ---\n    constructor(p){\n        this.smoothing = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).clamp(p.smoothing, 0, 1);\n    }\n}\n\n\nclass $b47927ff4e129b10$export$91dcf4209534d21f {\n    // --- public ---\n    chainIn(event) {\n        if (event.type === \"down\") {\n            if (this.isDrawing) //console.log('line sanitizer - down, but already drawing');\n            this.chainOut && this.chainOut({\n                type: \"up\",\n                scale: event.scale,\n                shiftIsPressed: event.shiftIsPressed,\n                isCoalesced: false\n            });\n            else this.isDrawing = true;\n        }\n        if (!this.isDrawing && (event.type === \"move\" || event.type === \"up\")) //console.log('line sanitizer - ' + event.type + ' but not drawing');\n        return null;\n        if (event.type === \"up\" && this.isDrawing) this.isDrawing = false;\n        return event;\n    }\n    setChainOut(func) {\n        this.chainOut = func;\n    }\n    getIsDrawing() {\n        return this.isDrawing;\n    }\n    constructor(){\n        this.isDrawing = false;\n    }\n}\n\n\n/**\n * from stabilizer dropdown value to line-smoothing value\n * @param s\n */ function $b2e5423e81cbdb22$export$bcd109042a2e4bb5(s) {\n    if (s == 1) return 0.5;\n    if (s == 2) return 0.84;\n    if (s == 3) return 0.965;\n    if (s == 4) return 0.9825;\n    if (s == 5) return 0.99125;\n    return s;\n}\n\n\n\n\n\n\n\nclass $8edbd5a1c1dde18e$export$4ccbb8938b9d5723 {\n    /**\n     *\n     * @param importedImage - convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas}\n     * @param filename - string e.g. 'drawing.psd'\n     * @param optionStr? - 'default' | 'layer' | 'image'\n     */ importFinishedLoading(importedImage, filename, optionStr) {\n        if (!importedImage || isNaN(importedImage.width) || isNaN(importedImage.height) || importedImage.width <= 0 || importedImage.height <= 0) {\n            (0, $49faab2330529a96$export$6e4a713ddcda1e5e).popup({\n                target: this.klRootEl,\n                type: \"error\",\n                message: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"import-broken-file\"),\n                buttons: [\n                    \"Ok\"\n                ]\n            });\n            return;\n        }\n        const getResizedDimensions = (width, height)=>{\n            let w = parseInt(\"\" + width);\n            let h = parseInt(\"\" + height);\n            if (w > this.klMaxCanvasSize) {\n                h = this.klMaxCanvasSize / w * h;\n                w = this.klMaxCanvasSize;\n            }\n            if (h > this.klMaxCanvasSize) {\n                w = this.klMaxCanvasSize / h * w;\n                h = this.klMaxCanvasSize;\n            }\n            w = parseInt(\"\" + w);\n            h = parseInt(\"\" + h);\n            return {\n                width: w,\n                height: h\n            };\n        };\n        const importAsImage = (canvas)=>{\n            const resizedDimensions = getResizedDimensions(canvas.width, canvas.height);\n            //resize first\n            const tempCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(canvas.width, canvas.height);\n            const tempCanvasCtx = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(tempCanvas);\n            tempCanvasCtx.drawImage(canvas, 0, 0);\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).resizeCanvas(tempCanvas, resizedDimensions.width, resizedDimensions.height);\n            this.klCanvas.reset({\n                width: resizedDimensions.width,\n                height: resizedDimensions.height,\n                image: tempCanvas,\n                layerName: filename\n            });\n            this.layerManager.update(0);\n            this.setCurrentLayer(this.klCanvas.getLayer(0));\n            this.klCanvasWorkspace.resetOrFitView();\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n        };\n        /**\n         *\n         * @param convertedPsdObj - if flattened then without layers\n         * @param cropObj? - {x: number, y: number, width: number, height: number}\n         */ const importAsImagePsd = (convertedPsdObj, cropObj)=>{\n            // crop\n            const crop = (targetCanvas, cropCanvas, cropObj)=>{\n                // eslint-disable-next-line no-self-assign\n                cropCanvas.width = cropCanvas.width;\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(cropCanvas).drawImage(targetCanvas, -cropObj.x, -cropObj.y);\n                targetCanvas.width = cropObj.width;\n                targetCanvas.height = cropObj.height;\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ctx(targetCanvas).drawImage(cropCanvas, 0, 0);\n            };\n            if (cropObj && (cropObj.width !== convertedPsdObj.width || cropObj.height !== convertedPsdObj.height)) {\n                const cropCanvas = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).canvas(cropObj.width, cropObj.height);\n                convertedPsdObj.width = cropObj.width;\n                convertedPsdObj.height = cropObj.height;\n                if (!convertedPsdObj.layers) crop(convertedPsdObj.canvas, cropCanvas, cropObj);\n                if (convertedPsdObj.layers) for(let i = 0; i < convertedPsdObj.layers.length; i++){\n                    const item = convertedPsdObj.layers[i];\n                    crop(item.image, cropCanvas, cropObj);\n                }\n            }\n            // resize\n            const resizedDimensions = getResizedDimensions(convertedPsdObj.width, convertedPsdObj.height);\n            convertedPsdObj.width = resizedDimensions.width;\n            convertedPsdObj.height = resizedDimensions.height;\n            if (!convertedPsdObj.layers) (0, $d9f9f4926aa80a1c$export$921068d8846a1559).resizeCanvas(convertedPsdObj.canvas, convertedPsdObj.width, convertedPsdObj.height);\n            if (convertedPsdObj.layers) for(let i = 0; i < convertedPsdObj.layers.length; i++){\n                const item = convertedPsdObj.layers[i];\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).resizeCanvas(item.image, convertedPsdObj.width, convertedPsdObj.height);\n            }\n            let layerIndex;\n            if (convertedPsdObj.layers) layerIndex = this.klCanvas.reset({\n                width: convertedPsdObj.width,\n                height: convertedPsdObj.height,\n                layers: convertedPsdObj.layers\n            });\n            else layerIndex = this.klCanvas.reset({\n                width: convertedPsdObj.width,\n                height: convertedPsdObj.height,\n                image: convertedPsdObj.canvas\n            });\n            this.layerManager.update(layerIndex);\n            this.setCurrentLayer((0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.klCanvas.getLayer(layerIndex)));\n            this.klCanvasWorkspace.resetOrFitView();\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n        };\n        const importAsLayer = (canvas)=>{\n            (0, $49faab2330529a96$export$6e4a713ddcda1e5e).showImportAsLayerDialog({\n                target: this.klRootEl,\n                klCanvas: this.klCanvas,\n                importImage: canvas,\n                callback: (transformObj, isPixelated)=>{\n                    if (!transformObj) return;\n                    (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(true);\n                    this.klCanvas.addLayer();\n                    const layers = this.klCanvas.getLayers();\n                    const activeLayerIndex = layers.length - 1;\n                    if (filename) this.klCanvas.renameLayer(activeLayerIndex, filename);\n                    const activeLayerContext = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.klCanvas.getLayerContext(activeLayerIndex));\n                    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).drawTransformedImageWithBounds(activeLayerContext, canvas, transformObj, undefined, isPixelated);\n                    this.setCurrentLayer((0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.klCanvas.getLayer(activeLayerIndex)));\n                    this.layerManager.update(activeLayerIndex);\n                    (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(false);\n                    (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).push({\n                        tool: [\n                            \"misc\"\n                        ],\n                        action: \"importImage\",\n                        params: [\n                            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyCanvas(activeLayerContext.canvas),\n                            filename\n                        ]\n                    });\n                }\n            });\n        };\n        if (optionStr === \"default\" || !optionStr) (0, $49faab2330529a96$export$6e4a713ddcda1e5e).showImportImageDialog({\n            image: importedImage,\n            target: this.klRootEl,\n            maxSize: this.klMaxCanvasSize,\n            callback: (res)=>{\n                if (res.type === \"as-image\") importAsImage(res.image);\n                else if (res.type === \"as-image-psd\") importAsImagePsd(res.image, res.cropObj);\n                else if (res.type === \"as-layer\") importAsLayer(res.image);\n                else res.type;\n            }\n        });\n        if (optionStr === \"layer\") importAsLayer(importedImage.canvas);\n        if (optionStr === \"image\") {\n            if (importedImage.type === \"psd\") importAsImagePsd(importedImage);\n            else importAsImage(importedImage.canvas);\n        }\n    }\n    // ---- interface ----\n    onPaste(e) {\n        if ((0, $49faab2330529a96$export$6e4a713ddcda1e5e).dialogCounter.get() > 0) return;\n        const retrieveImageFromClipboardAsBlob = (items, callback)=>{\n            if (!items) return;\n            for(let i = 0; i < items.length; i++){\n                if (items[i].type.indexOf(\"image\") == -1) continue;\n                const file = items[i].getAsFile();\n                file && callback(file);\n            }\n        };\n        e.stopPropagation();\n        e.preventDefault();\n        if (!e.clipboardData) return;\n        if (e.clipboardData.files[0]) retrieveImageFromClipboardAsBlob(e.clipboardData.items, (imageBlob)=>{\n            // If there's an image, display it in the canvas\n            const img = new Image();\n            img.onload = ()=>{\n                URL.revokeObjectURL(img.src);\n                this.importFinishedLoading({\n                    type: \"image\",\n                    width: img.width,\n                    height: img.height,\n                    canvas: img\n                }, undefined, \"default\");\n            };\n            const URLObj = window.URL || window.webkitURL;\n            img.src = URLObj.createObjectURL(imageBlob);\n        });\n        else if (e.clipboardData.items[0]) e.clipboardData.items[0].getAsString((pasteStr)=>{\n            pasteStr = pasteStr.trim();\n            if (pasteStr.match(/^https?/)) {\n                // url\n                const img = new Image();\n                img.onload = ()=>{\n                    this.importFinishedLoading({\n                        type: \"image\",\n                        width: img.width,\n                        height: img.height,\n                        canvas: img\n                    }, undefined, \"default\");\n                };\n                img.onerror = (e)=>{\n                    console.log(\"error loading\", e);\n                };\n                img.crossOrigin = \"Anonymous\";\n                img.src = pasteStr;\n            } else if (pasteStr.match(/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)) {\n                // url\n                const rgbObj = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).ColorConverter.hexToRGB(pasteStr.replace(\"#\", \"\"));\n                rgbObj && this.onColor(rgbObj);\n            }\n        });\n    }\n    handleFileSelect(files, optionStr) {\n        const showWarningPsdFlattened = ()=>{\n            (0, $49faab2330529a96$export$6e4a713ddcda1e5e).popup({\n                target: this.klRootEl,\n                type: \"warning\",\n                message: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"import-psd-unsupported\") + \"<br /><br />\",\n                buttons: [\n                    \"Ok\"\n                ]\n            });\n        };\n        let hasUnsupportedFile = false;\n        // eslint-disable-next-line no-cond-assign\n        for(let i = 0, file; file = files[i]; i++){\n            const nameSplit = file.name.split(\".\");\n            const extension = nameSplit[nameSplit.length - 1].toLowerCase();\n            if (extension === \"psd\") ((f)=>{\n                const loaderSizeBytes = 26214400; // 25mb\n                const maxSizeBytes = 1073741824; // 1gb\n                const maxResolution = 4096;\n                if (f.size >= maxSizeBytes) {\n                    (0, $49faab2330529a96$export$6e4a713ddcda1e5e).popup({\n                        target: this.klRootEl,\n                        type: \"error\",\n                        message: \"File too big. Unable to import.<br /><br />\",\n                        buttons: [\n                            \"Ok\"\n                        ]\n                    });\n                    return;\n                }\n                const doShowLoader = files.length === 1 && f.size >= loaderSizeBytes;\n                let loaderIsOpen = true;\n                let closeLoader;\n                if (doShowLoader) (0, $49faab2330529a96$export$6e4a713ddcda1e5e).popup({\n                    target: this.klRootEl,\n                    message: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"import-opening\"),\n                    callback: (result)=>{\n                        loaderIsOpen = false;\n                        closeLoader = null;\n                    },\n                    closeFunc: (f)=>{\n                        closeLoader = f;\n                    }\n                });\n                const reader = new FileReader();\n                reader.onload = (readerResult)=>{\n                    const target = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(readerResult.target);\n                    (0, $49faab2330529a96$export$6e4a713ddcda1e5e).loadAgPsd().then((agPsdLazy)=>{\n                        if (doShowLoader && !loaderIsOpen) return;\n                        try {\n                            let psd;\n                            // first pass, only read metadata\n                            psd = agPsdLazy.readPsd(target.result, {\n                                skipLayerImageData: true,\n                                skipThumbnail: true,\n                                skipCompositeImageData: true\n                            });\n                            if (psd.width > maxResolution || psd.height > maxResolution) {\n                                if (closeLoader) closeLoader();\n                                (0, $49faab2330529a96$export$6e4a713ddcda1e5e).popup({\n                                    target: this.klRootEl,\n                                    type: \"error\",\n                                    message: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"import-psd-too-large\").replace(/{x}/g, \"\" + maxResolution) + \"<br /><br />\" + (0, $63d0b335c576c718$export$ce37e184d908d785)(\"import-psd-size\") + \": \" + psd.width + \" x \" + psd.height + \" pixels\" + \"<br /><br />\",\n                                    buttons: [\n                                        \"Ok\"\n                                    ]\n                                });\n                                return;\n                            }\n                            // second pass, now load actual data.\n                            psd = null;\n                            try {\n                                psd = agPsdLazy.readPsd(target.result);\n                            } catch (e) {\n                            //console.log('failed regular psd import', e);\n                            }\n                            if (psd) {\n                                //console.log('psd', psd);\n                                const convertedPsd = (0, $49faab2330529a96$export$6e4a713ddcda1e5e).PSD.readPsd(psd);\n                                //console.log('converted', convertedPsd);\n                                if (optionStr === \"image\" && convertedPsd.error) showWarningPsdFlattened();\n                                if (closeLoader) closeLoader();\n                                this.importFinishedLoading(convertedPsd, f.name, optionStr);\n                            } else {\n                                psd = agPsdLazy.readPsd(target.result, {\n                                    skipLayerImageData: true,\n                                    skipThumbnail: true\n                                });\n                                if (optionStr === \"image\") showWarningPsdFlattened();\n                                if (closeLoader) closeLoader();\n                                this.importFinishedLoading({\n                                    type: \"psd\",\n                                    width: psd.width,\n                                    height: psd.height,\n                                    canvas: (0, $fc4403c8ee6a33dc$export$5c097f720de072a2)(psd.canvas),\n                                    error: true\n                                }, f.name, optionStr);\n                            }\n                        } catch (e) {\n                            closeLoader && closeLoader();\n                            (0, $49faab2330529a96$export$6e4a713ddcda1e5e).popup({\n                                target: this.klRootEl,\n                                type: \"error\",\n                                message: \"Failed to load PSD.<br /><br />\",\n                                buttons: [\n                                    \"Ok\"\n                                ]\n                            });\n                            console.log(e);\n                            setTimeout(()=>{\n                                throw new Error(\"psd load error\");\n                            });\n                        }\n                    }).catch((e)=>{\n                        closeLoader && closeLoader();\n                        alert(\"Error: failed to load PSD library\");\n                    });\n                };\n                reader.readAsArrayBuffer(f);\n            })(file);\n            else if (file.type.match(\"image.*\")) ((f)=>{\n                window.URL = window.URL || window.webkitURL;\n                const url = window.URL.createObjectURL(f);\n                const im = new Image();\n                im.src = url;\n                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).loadImage(im, ()=>{\n                    this.importFinishedLoading({\n                        type: \"image\",\n                        width: im.width,\n                        height: im.height,\n                        canvas: im\n                    }, f.name, optionStr);\n                });\n            })(file);\n            else hasUnsupportedFile = true;\n        }\n        if (hasUnsupportedFile) (0, $49faab2330529a96$export$6e4a713ddcda1e5e).popup({\n            target: this.klRootEl,\n            message: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"import-unsupported-file\"),\n            type: \"error\",\n            buttons: [\n                \"OK\"\n            ]\n        });\n    }\n    // ---- public ----\n    constructor(input, callback){\n        this.klRootEl = input.klRootEl;\n        this.klMaxCanvasSize = input.klMaxCanvasSize;\n        this.layerManager = input.layerManager;\n        this.setCurrentLayer = input.setCurrentLayer;\n        this.klCanvas = input.klCanvas;\n        this.klCanvasWorkspace = input.klCanvasWorkspace;\n        this.handUi = input.handUi;\n        this.onColor = callback.onColor;\n    }\n}\n\n\n\n\n\n\n\n\nvar $6d04bb35ac2352cf$exports = {};\n\n$6d04bb35ac2352cf$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"tab-settings.be84ac7c.svg\";\n\n\nvar $5ad3867a8e2df089$exports = {};\n\n$5ad3867a8e2df089$exports = (parcelRequire(\"dwTKp\")).getBundleURL(\"lrLBb\") + \"tab-layers.c8a104e7.svg\";\n\n\nfunction $1050fcf084a1ca84$export$982e7602957287fa(p) {\n    const output = [\n        \"Draw via the console! Learn more: %cKL.help()\",\n        \"background: #000; color: #0f0;\"\n    ];\n    \"info\" in console ? console.info(...output) : console.log(...output);\n    return Object.freeze({\n        draw: (path)=>{\n            p.onDraw(path);\n        },\n        help: ()=>{\n            console.log(`KL.draw({x: number; y: number}[]) // draw a line\nKL.help() // print help\n`);\n        }\n    });\n}\n\n\n\n\n\n(0, $a5bdfa66fb1ba8cd$export$4283b00eae4a6956)();\nclass $b7af2ed4a75d4700$export$96f6458b62e4c2c {\n    updateCollapse() {\n        //collapser\n        if (this.uiWidth < this.collapseThreshold) {\n            this.toolspaceCollapser.getElement().style.display = \"block\";\n            this.toolspaceCollapser.setDirection(this.uiState);\n            if (this.toolspaceCollapser.isOpen()) {\n                if (this.uiState === \"left\") {\n                    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.toolspaceCollapser.getElement(), {\n                        left: \"271px\",\n                        right: \"\"\n                    });\n                    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.klCanvasWorkspace.getElement(), {\n                        left: \"271px\"\n                    });\n                } else {\n                    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.toolspaceCollapser.getElement(), {\n                        left: \"\",\n                        right: \"271px\"\n                    });\n                    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.klCanvasWorkspace.getElement(), {\n                        left: \"0\"\n                    });\n                }\n                this.toolspace.style.display = \"block\";\n                this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth - this.toolWidth), this.uiHeight);\n                this.statusOverlay.setWide(false);\n            } else {\n                if (this.uiState === \"left\") {\n                    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.toolspaceCollapser.getElement(), {\n                        left: \"0\",\n                        right: \"\"\n                    });\n                    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.klCanvasWorkspace.getElement(), {\n                        left: \"0\"\n                    });\n                } else {\n                    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.toolspaceCollapser.getElement(), {\n                        left: \"\",\n                        right: \"0\"\n                    });\n                    (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.klCanvasWorkspace.getElement(), {\n                        left: \"0\"\n                    });\n                }\n                this.toolspace.style.display = \"none\";\n                this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth), this.uiHeight);\n                this.statusOverlay.setWide(true);\n            }\n        } else {\n            this.toolspaceCollapser.getElement().style.display = \"none\";\n            if (this.uiState === \"left\") (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.klCanvasWorkspace.getElement(), {\n                left: \"271px\"\n            });\n            else (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.klCanvasWorkspace.getElement(), {\n                left: \"0\"\n            });\n            this.toolspace.style.display = \"block\";\n            this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth - this.toolWidth), this.uiHeight);\n            this.statusOverlay.setWide(false);\n        }\n    }\n    updateBottomBar() {\n        if (!this.bottomBar) return;\n        const isVisible = this.toolspaceInner.scrollHeight + 40 < window.innerHeight;\n        const newDisplay = isVisible ? \"\" : \"none\";\n        // check to prevent infinite MutationObserver loop in Pale Moon\n        if (newDisplay !== this.bottomBarWrapper.style.display) this.bottomBarWrapper.style.display = newDisplay;\n    }\n    updateUi() {\n        this.toolspace.classList.toggle(\"kl-toolspace--left\", this.uiState === \"left\");\n        this.toolspace.classList.toggle(\"kl-toolspace--right\", this.uiState === \"right\");\n        if (this.uiState === \"left\") {\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.toolspace, {\n                left: \"0\",\n                right: \"\"\n            });\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.klCanvasWorkspace.getElement(), {\n                left: \"271px\"\n            });\n        } else {\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.toolspace, {\n                left: \"\",\n                right: \"0\"\n            });\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).css(this.klCanvasWorkspace.getElement(), {\n                left: \"0\"\n            });\n        }\n        this.statusOverlay.setUiState(this.uiState);\n        this.layerPreview.setUiState(this.uiState);\n        this.layerManager.setUiState(this.uiState);\n        this.updateCollapse();\n        this.toolspaceScroller.updateUiState(this.uiState);\n    }\n    // -------- interface --------\n    getEl() {\n        return this.klRootEl;\n    }\n    resize(w, h) {\n        // iPad scrolls down when increasing text zoom\n        if (window.scrollY > 0) window.scrollTo(0, 0);\n        if (this.uiWidth === Math.max(0, w) && this.uiHeight === Math.max(0, h)) return;\n        this.uiWidth = Math.max(0, w);\n        this.uiHeight = Math.max(0, h);\n        this.updateCollapse();\n        this.updateBottomBar();\n        this.layerPreview.setIsVisible(this.uiHeight >= 579);\n        this.klColorSlider.setHeight(Math.max(163, Math.min(400, this.uiHeight - 505)));\n        this.toolspaceToolRow.setIsSmall(this.uiHeight < 540);\n    }\n    out(msg) {\n        this.statusOverlay.out(msg);\n    }\n    getPNG() {\n        return (0, $dda762a0c02e643a$export$b3fb17ae4345ac8f)(this.klCanvas.getCompleteCanvas(1).toDataURL(\"image/png\"));\n    }\n    getProject() {\n        return this.klCanvas.getProject();\n    }\n    swapUiLeftRight() {\n        this.uiState = this.uiState === \"left\" ? \"right\" : \"left\";\n        if (!this.embed) (0, $0ecef66681b62a8c$export$19fffca37ef3e106).setItem(\"uiState\", this.uiState);\n        this.updateUi();\n    }\n    saveAsPsd() {\n        this.saveToComputer.save(\"psd\");\n    }\n    isDrawing() {\n        return this.lineSanitizer.getIsDrawing() || this.klCanvasWorkspace.getIsDrawing();\n    }\n    // -------- public --------\n    constructor(pProject, pOptions){\n        this.collapseThreshold = 820;\n        this.toolWidth = 271;\n        this.getPSD = async ()=>{\n            return await (0, $3ccac2760787e643$export$92433b641be3f7a)(this.klCanvas);\n        };\n        this.embed = pOptions.embed;\n        // default 2048, unless your screen is bigger than that (that computer then probably has the horsepower for that)\n        // but not larger than 4096 - a fairly arbitrary decision\n        const klMaxCanvasSize = Math.min(4096, Math.max(2048, Math.max(window.screen.width, window.screen.height)));\n        this.uiState = this.embed ? \"left\" : (0, $0ecef66681b62a8c$export$19fffca37ef3e106).getItem(\"uiState\") ? (0, $0ecef66681b62a8c$export$19fffca37ef3e106).getItem(\"uiState\") : \"right\";\n        const projectStore = pOptions.projectStore;\n        this.klRootEl = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"g-root\",\n            css: {\n                position: \"absolute\",\n                left: \"0\",\n                top: \"0\",\n                right: \"0\",\n                bottom: \"0\"\n            }\n        });\n        this.uiWidth = Math.max(0, window.innerWidth);\n        this.uiHeight = Math.max(0, window.innerHeight);\n        let exportType = \"png\";\n        this.klCanvas = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).KlCanvas(pProject ? {\n            projectObj: pProject\n        } : {\n            width: Math.max(10, Math.min(klMaxCanvasSize, window.innerWidth < this.collapseThreshold ? this.uiWidth : this.uiWidth - this.toolWidth)),\n            height: Math.max(10, Math.min(klMaxCanvasSize, this.uiHeight))\n        }, this.embed ? -1 : 0);\n        this.klCanvas.setHistory((0, $d2dccce11beb16cf$export$28b6f4d98dde9845));\n        let initState;\n        let mainTabRow = undefined;\n        if (!pOptions.saveReminder) pOptions.saveReminder = {\n            init: ()=>{},\n            reset: ()=>{}\n        };\n        if (pProject) {\n            // attempt at freeing memory\n            pProject.layers.forEach((layer)=>{\n                layer.image = null;\n            });\n            pProject = null;\n        } else {\n            (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(true);\n            this.klCanvas.addLayer();\n            this.klCanvas.layerFill(0, {\n                r: (0, $7a2aeb795d64bafc$export$e4203cb02d5e5b28),\n                g: (0, $7a2aeb795d64bafc$export$e4203cb02d5e5b28),\n                b: (0, $7a2aeb795d64bafc$export$e4203cb02d5e5b28)\n            });\n            (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).pause(false);\n        }\n        try {\n            initState = {\n                canvas: new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).KlCanvas({\n                    copy: this.klCanvas\n                }, this.embed ? -1 : 0),\n                focus: this.klCanvas.getLayerCount() - 1,\n                brushes: {}\n            };\n        } catch (e) {\n            if (e.message === \"kl-create-canvas-error\") this.klCanvas.destroy();\n            throw e;\n        }\n        Object.entries((0, $49faab2330529a96$export$6e4a713ddcda1e5e).brushes).forEach(([b, Brush])=>{\n            initState.brushes[b] = new Brush();\n            if (initState.canvas) initState.brushes[b].setContext(initState.canvas.getLayerContext(initState.focus));\n        });\n        let currentColor = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).RGB(0, 0, 0);\n        let currentBrushUi; // todo\n        let currentBrushId;\n        let lastNonEraserBrushId;\n        let currentLayerCtx = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.klCanvas.getLayerContext(this.klCanvas.getLayerCount() - 1));\n        // when cycling through brushes you need to know the next non-eraser brush\n        const getNextBrushId = ()=>{\n            if (currentBrushId === \"eraserBrush\") return lastNonEraserBrushId;\n            const keyArr = Object.keys(brushUiMap).filter((item)=>item !== \"eraserBrush\");\n            const i = keyArr.findIndex((item)=>item === currentBrushId);\n            return keyArr[(i + 1) % keyArr.length];\n        };\n        const sizeWatcher = (val)=>{\n            brushSettingService.emitSize(val);\n            if (this.klCanvasWorkspace) this.klCanvasWorkspace.setCursorSize(val * 2);\n        };\n        const brushSettingService = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).BrushSettingService((color)=>{\n            this.klColorSlider.setColor(color);\n            currentBrushUi.setColor(color);\n            currentColor = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).copyObj(color);\n        }, (size)=>{\n            currentBrushUi.setSize(size);\n            this.klCanvasWorkspace.setCursorSize(size * 2);\n        }, (opacity)=>{\n            currentBrushUi.setOpacity(opacity);\n        }, ()=>this.klColorSlider.getColor(), ()=>brushUiMap[currentBrushId].getSize(), ()=>brushUiMap[currentBrushId].getOpacity(), ()=>{\n            return {\n                sizeSlider: (0, $49faab2330529a96$export$6e4a713ddcda1e5e).brushesUI[currentBrushId].sizeSlider,\n                opacitySlider: (0, $49faab2330529a96$export$6e4a713ddcda1e5e).brushesUI[currentBrushId].opacitySlider\n            };\n        });\n        const lineSmoothing = new (0, $2d79f7f8e2e2d334$export$c57e2ed65bcf4d6a)({\n            smoothing: (0, $b2e5423e81cbdb22$export$bcd109042a2e4bb5)(1)\n        });\n        this.lineSanitizer = new (0, $b47927ff4e129b10$export$91dcf4209534d21f)();\n        const drawEventChain = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).EventChain({\n            chainArr: [\n                this.lineSanitizer,\n                lineSmoothing\n            ]\n        });\n        drawEventChain.setChainOut((event)=>{\n            if (event.type === \"down\") {\n                this.toolspace.style.pointerEvents = \"none\";\n                currentBrushUi.startLine(event.x, event.y, event.pressure);\n                this.klCanvasWorkspace.requestFrame();\n            }\n            if (event.type === \"move\") {\n                currentBrushUi.goLine(event.x, event.y, event.pressure, false, event.isCoalesced);\n                this.klCanvasWorkspace.setLastDrawEvent(event.x, event.y, event.pressure);\n                this.klCanvasWorkspace.requestFrame();\n            }\n            if (event.type === \"up\") {\n                this.toolspace.style.pointerEvents = \"\";\n                currentBrushUi.endLine();\n                this.klCanvasWorkspace.requestFrame();\n            }\n            if (event.type === \"line\") {\n                currentBrushUi.getBrush().drawLineSegment(event.x0, event.y0, event.x1, event.y1);\n                this.klCanvasWorkspace.requestFrame();\n            }\n        });\n        let textToolSettings = {\n            size: 20,\n            align: \"left\",\n            isBold: false,\n            isItalic: false,\n            font: \"sans-serif\",\n            letterSpacing: 0,\n            lineHeight: 1,\n            fill: {\n                color: {\n                    r: 0,\n                    g: 0,\n                    b: 0,\n                    a: 1\n                }\n            }\n        };\n        this.klCanvasWorkspace = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).KlCanvasWorkspace({\n            klCanvas: this.klCanvas,\n            width: Math.max(0, this.uiWidth - this.toolWidth),\n            height: this.uiHeight,\n            onDraw: (e)=>drawEventChain.chainIn(e),\n            onPick: (rgbObj, isDragDone)=>{\n                brushSettingService.setColor(rgbObj);\n                if (isDragDone) {\n                    this.klColorSlider.pickingDone();\n                    this.klCanvasWorkspace.setMode(this.toolspaceToolRow.getActive());\n                }\n            },\n            onFill: (canvasX, canvasY)=>{\n                const layerIndex = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\n                this.klCanvas.floodFill(layerIndex, canvasX, canvasY, fillUi.getIsEraser() ? null : this.klColorSlider.getColor(), fillUi.getOpacity(), fillUi.getTolerance(), fillUi.getSample(), fillUi.getGrow(), fillUi.getContiguous());\n                this.klCanvasWorkspace.requestFrame();\n            },\n            onGradient: (typeStr, canvasX, canvasY, angleRad)=>{\n                if (typeStr === \"down\") gradientTool.onDown(canvasX, canvasY, angleRad);\n                if (typeStr === \"move\") gradientTool.onMove(canvasX, canvasY);\n                if (typeStr === \"up\") gradientTool.onUp(canvasX, canvasY);\n            },\n            onText: (canvasX, canvasY, angleRad)=>{\n                if ((0, $49faab2330529a96$export$6e4a713ddcda1e5e).dialogCounter.get() > 0) return;\n                (0, $49faab2330529a96$export$6e4a713ddcda1e5e).textToolDialog({\n                    klCanvas: this.klCanvas,\n                    layerIndex: (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.klCanvas.getLayerIndex(currentLayerCtx.canvas)),\n                    primaryColor: this.klColorSlider.getColor(),\n                    secondaryColor: this.klColorSlider.getSecondaryRGB(),\n                    text: {\n                        ...textToolSettings,\n                        text: \"\",\n                        x: canvasX,\n                        y: canvasY,\n                        angleRad: angleRad,\n                        fill: textToolSettings.fill ? {\n                            color: {\n                                ...this.klColorSlider.getColor(),\n                                a: textToolSettings.fill.color.a\n                            }\n                        } : undefined,\n                        stroke: textToolSettings.stroke ? {\n                            ...textToolSettings.stroke,\n                            color: {\n                                ...this.klColorSlider.getSecondaryRGB(),\n                                a: textToolSettings.stroke.color.a\n                            }\n                        } : undefined\n                    },\n                    onConfirm: (val)=>{\n                        textToolSettings = {\n                            ...val,\n                            text: \"\"\n                        };\n                        const layerIndex = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\n                        this.klCanvas.text(layerIndex, val);\n                        this.klCanvasWorkspace.requestFrame();\n                    }\n                });\n            },\n            onShape: (typeStr, canvasX, canvasY, angleRad)=>{\n                if (typeStr === \"down\") shapeTool.onDown(canvasX, canvasY, angleRad);\n                if (typeStr === \"move\") shapeTool.onMove(canvasX, canvasY);\n                if (typeStr === \"up\") shapeTool.onUp(canvasX, canvasY);\n            },\n            onViewChange: (viewChangeObj)=>{\n                if (viewChangeObj.changed.includes(\"scale\")) this.statusOverlay.out({\n                    type: \"transform\",\n                    scale: viewChangeObj.scale,\n                    angleDeg: viewChangeObj.angle * 180 / Math.PI\n                });\n                this.toolspaceToolRow.setEnableZoomIn(viewChangeObj.scale !== this.klCanvasWorkspace.getMaxScale());\n                this.toolspaceToolRow.setEnableZoomOut(viewChangeObj.scale !== this.klCanvasWorkspace.getMinScale());\n                handUi.update(viewChangeObj.scale, viewChangeObj.angle * 180 / Math.PI);\n            },\n            onUndo: ()=>{\n                if ((0, $d2dccce11beb16cf$export$28b6f4d98dde9845).canUndo()) {\n                    if (undoRedoCatchup.undo()) this.statusOverlay.out((0, $63d0b335c576c718$export$ce37e184d908d785)(\"undo\"), true);\n                }\n            },\n            onRedo: ()=>{\n                if ((0, $d2dccce11beb16cf$export$28b6f4d98dde9845).canRedo()) {\n                    if (undoRedoCatchup.redo()) this.statusOverlay.out((0, $63d0b335c576c718$export$ce37e184d908d785)(\"redo\"), true);\n                }\n            }\n        });\n        const updateMainTabVisibility = ()=>{\n            if (!mainTabRow) return;\n            const toolObj = {\n                \"draw\": {},\n                \"hand\": {},\n                \"fill\": {},\n                \"gradient\": {},\n                \"text\": {},\n                \"shape\": {}\n            };\n            const activeStr = this.toolspaceToolRow.getActive();\n            const oldTabId = mainTabRow.getOpenedTabId();\n            const keysArr = Object.keys(toolObj);\n            for(let i = 0; i < keysArr.length; i++)if (activeStr === keysArr[i]) mainTabRow.setIsVisible(keysArr[i], true);\n            else {\n                mainTabRow.setIsVisible(keysArr[i], false);\n                if (oldTabId === keysArr[i]) mainTabRow.open(activeStr);\n            }\n        };\n        const keyListener = new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).KeyListener({\n            onDown: (keyStr, event, comboStr)=>{\n                if ((0, $49faab2330529a96$export$6e4a713ddcda1e5e).dialogCounter.get() > 0 || (0, $d9f9f4926aa80a1c$export$921068d8846a1559).isInputFocused(true)) return;\n                const isDrawing = this.lineSanitizer.getIsDrawing() || this.klCanvasWorkspace.getIsDrawing();\n                if (isDrawing) return;\n                if (comboStr === \"plus\") this.klCanvasWorkspace.zoomByStep(keyListener.isPressed(\"shift\") ? 1 / 8 : 0.5);\n                if (comboStr === \"minus\") this.klCanvasWorkspace.zoomByStep(keyListener.isPressed(\"shift\") ? -1 / 8 : -0.5);\n                if (comboStr === \"home\") this.klCanvasWorkspace.fitView(true);\n                if (comboStr === \"end\") this.klCanvasWorkspace.resetView(true);\n                if ([\n                    \"ctrl+z\",\n                    \"cmd+z\"\n                ].includes(comboStr)) {\n                    event.preventDefault();\n                    undoRedoCatchup.undo();\n                }\n                if ([\n                    \"ctrl+y\",\n                    \"cmd+y\"\n                ].includes(comboStr) || ((0, $d9f9f4926aa80a1c$export$921068d8846a1559).sameKeys(\"ctrl+shift+z\", comboStr) || (0, $d9f9f4926aa80a1c$export$921068d8846a1559).sameKeys(\"cmd+shift+z\", comboStr)) && keyStr === \"z\") {\n                    event.preventDefault();\n                    undoRedoCatchup.redo();\n                }\n                if (!this.embed) {\n                    if ([\n                        \"ctrl+s\",\n                        \"cmd+s\"\n                    ].includes(comboStr)) {\n                        event.preventDefault();\n                        this.saveToComputer.save();\n                    }\n                    if ([\n                        \"ctrl+shift+s\",\n                        \"cmd+shift+s\"\n                    ].includes(comboStr)) {\n                        event.preventDefault();\n                        (async ()=>{\n                            let success = true;\n                            try {\n                                await projectStore.store(this.klCanvas.getProject());\n                            } catch (e) {\n                                success = false;\n                                setTimeout(()=>{\n                                    throw new Error(\"keyboard-shortcut: failed to store browser storage, \" + e);\n                                }, 0);\n                                this.statusOverlay.out(\"\\u274C \" + (0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-storage-failed\"), true);\n                            }\n                            if (success) {\n                                pOptions.saveReminder.reset();\n                                this.statusOverlay.out((0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-storage-stored\"), true);\n                            }\n                        })();\n                    }\n                    if ([\n                        \"ctrl+c\",\n                        \"cmd+c\"\n                    ].includes(comboStr)) {\n                        event.preventDefault();\n                        copyToClipboard(true);\n                    }\n                }\n                if ([\n                    \"ctrl+a\",\n                    \"cmd+a\"\n                ].includes(comboStr)) event.preventDefault();\n                if (keyListener.comboOnlyContains([\n                    \"left\",\n                    \"right\",\n                    \"up\",\n                    \"down\"\n                ])) {\n                    if (keyStr === \"left\") this.klCanvasWorkspace.translateView(1, 0);\n                    if (keyStr === \"right\") this.klCanvasWorkspace.translateView(-1, 0);\n                    if (keyStr === \"up\") this.klCanvasWorkspace.translateView(0, 1);\n                    if (keyStr === \"down\") this.klCanvasWorkspace.translateView(0, -1);\n                }\n                if ([\n                    \"r+left\",\n                    \"r+right\"\n                ].includes(comboStr)) {\n                    if (keyStr === \"left\") {\n                        this.klCanvasWorkspace.setAngle(-15, true);\n                        handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n                    }\n                    if (keyStr === \"right\") {\n                        this.klCanvasWorkspace.setAngle(15, true);\n                        handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n                    }\n                }\n                if ([\n                    \"r+up\"\n                ].includes(comboStr)) {\n                    this.klCanvasWorkspace.setAngle(0);\n                    handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n                }\n                if (comboStr === \"sqbr_open\") currentBrushUi.decreaseSize(0.03 / this.klCanvasWorkspace.getScale());\n                if (comboStr === \"sqbr_close\") currentBrushUi.increaseSize(0.03 / this.klCanvasWorkspace.getScale());\n                if (comboStr === \"enter\") {\n                    this.klCanvas.layerFill((0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.klCanvas.getLayerIndex(currentLayerCtx.canvas)), this.klColorSlider.getColor());\n                    this.statusOverlay.out((0, $63d0b335c576c718$export$ce37e184d908d785)(\"filled\"), true);\n                }\n                if ([\n                    \"delete\",\n                    \"backspace\"\n                ].includes(comboStr)) {\n                    const layerIndex = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\n                    if (layerIndex === 0 && !brushUiMap.eraserBrush.getIsTransparentBg()) this.klCanvas.layerFill(layerIndex, {\n                        r: 255,\n                        g: 255,\n                        b: 255\n                    }, \"source-in\");\n                    else this.klCanvas.clearLayer(layerIndex);\n                    this.statusOverlay.out((0, $63d0b335c576c718$export$ce37e184d908d785)(\"cleared-layer\"), true);\n                }\n                if (comboStr === \"shift+e\") {\n                    event.preventDefault();\n                    currentBrushUi.toggleEraser && currentBrushUi.toggleEraser();\n                } else if (comboStr === \"e\") {\n                    event.preventDefault();\n                    this.klCanvasWorkspace.setMode(\"draw\");\n                    this.toolspaceToolRow.setActive(\"draw\");\n                    mainTabRow && mainTabRow.open(\"draw\");\n                    updateMainTabVisibility();\n                    brushTabRow.open(\"eraserBrush\");\n                }\n                if (comboStr === \"b\") {\n                    event.preventDefault();\n                    const prevMode = this.klCanvasWorkspace.getMode();\n                    this.klCanvasWorkspace.setMode(\"draw\");\n                    this.toolspaceToolRow.setActive(\"draw\");\n                    mainTabRow && mainTabRow.open(\"draw\");\n                    updateMainTabVisibility();\n                    brushTabRow.open(prevMode === \"draw\" ? getNextBrushId() : currentBrushId);\n                }\n                if (comboStr === \"g\") {\n                    event.preventDefault();\n                    const newMode = this.klCanvasWorkspace.getMode() === \"fill\" ? \"gradient\" : \"fill\";\n                    this.klCanvasWorkspace.setMode(newMode);\n                    this.toolspaceToolRow.setActive(newMode);\n                    mainTabRow && mainTabRow.open(newMode);\n                    updateMainTabVisibility();\n                }\n                if (comboStr === \"t\") {\n                    event.preventDefault();\n                    this.klCanvasWorkspace.setMode(\"text\");\n                    this.toolspaceToolRow.setActive(\"text\");\n                    mainTabRow && mainTabRow.open(\"text\");\n                    updateMainTabVisibility();\n                }\n                if (comboStr === \"u\") {\n                    event.preventDefault();\n                    this.klCanvasWorkspace.setMode(\"shape\");\n                    this.toolspaceToolRow.setActive(\"shape\");\n                    mainTabRow && mainTabRow.open(\"shape\");\n                    updateMainTabVisibility();\n                }\n                if (comboStr === \"x\") {\n                    event.preventDefault();\n                    this.klColorSlider.swapColors();\n                }\n            },\n            onUp: (keyStr, event)=>{}\n        });\n        const brushUiMap = {};\n        // create brush UIs\n        Object.entries((0, $49faab2330529a96$export$6e4a713ddcda1e5e).brushesUI).forEach(([b, brushUi])=>{\n            const ui = new brushUi.Ui({\n                onSizeChange: sizeWatcher,\n                onOpacityChange: (opacity)=>{\n                    brushSettingService.emitOpacity(opacity);\n                },\n                onConfigChange: ()=>{\n                    brushSettingService.emitSliderConfig({\n                        sizeSlider: (0, $49faab2330529a96$export$6e4a713ddcda1e5e).brushesUI[currentBrushId].sizeSlider,\n                        opacitySlider: (0, $49faab2330529a96$export$6e4a713ddcda1e5e).brushesUI[currentBrushId].opacitySlider\n                    });\n                }\n            });\n            brushUiMap[b] = ui;\n            ui.getElement().style.padding = \"10px\";\n        });\n        this.statusOverlay = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).StatusOverlay();\n        this.toolspace = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            className: \"kl-toolspace\",\n            css: {\n                position: \"absolute\",\n                right: \"0\",\n                top: \"0\",\n                bottom: \"0\",\n                width: this.toolWidth + \"px\",\n                overflow: \"hidden\",\n                userSelect: \"none\",\n                touchAction: \"none\"\n            }\n        });\n        this.toolspaceInner = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            parent: this.toolspace\n        });\n        this.toolspace.oncontextmenu = ()=>{\n            return false;\n        };\n        this.toolspace.onclick = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).handleClick;\n        this.toolspaceCollapser = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).ToolspaceCollapser({\n            onChange: ()=>{\n                this.updateCollapse();\n            }\n        });\n        this.updateCollapse();\n        let overlayToolspace;\n        setTimeout(()=>{\n            overlayToolspace = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).OverlayToolspace({\n                enabledTest: ()=>{\n                    return (0, $49faab2330529a96$export$6e4a713ddcda1e5e).dialogCounter.get() === 0 && !this.lineSanitizer.getIsDrawing();\n                },\n                brushSettingService: brushSettingService\n            });\n            this.klRootEl.append(overlayToolspace.getElement());\n        }, 0);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).append(this.klRootEl, [\n            this.klCanvasWorkspace.getElement(),\n            this.toolspace,\n            this.toolspaceCollapser.getElement()\n        ]);\n        let toolspaceTopRow;\n        if (this.embed) toolspaceTopRow = new (0, $db287580a54bd175$export$ce26cd3db18613a3)({\n            onHelp: ()=>{\n                (0, $165d2995997b2f9b$export$35fa34e5af64bd4a)(this.embed.url + \"/help.html\", !!this.embed);\n            },\n            onSubmit: ()=>{\n                const onFailure = ()=>{\n                    let closeFunc;\n                    const saveBtn = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                        tagName: \"button\",\n                        textContent: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"save-reminder-save-psd\"),\n                        css: {\n                            display: \"block\"\n                        }\n                    });\n                    saveBtn.onclick = ()=>{\n                        this.saveAsPsd();\n                        closeFunc();\n                    };\n                    (0, $49faab2330529a96$export$6e4a713ddcda1e5e).popup({\n                        target: this.klRootEl,\n                        message: \"<b>\" + (0, $63d0b335c576c718$export$ce37e184d908d785)(\"upload-failed\") + \"</b>\",\n                        div: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                            content: [\n                                (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                                    content: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"backup-drawing\"),\n                                    css: {\n                                        marginBottom: \"10px\"\n                                    }\n                                }),\n                                saveBtn\n                            ]\n                        }),\n                        ignoreBackground: true,\n                        closeFunc: (f)=>{\n                            closeFunc = f;\n                        }\n                    });\n                };\n                (0, $49faab2330529a96$export$6e4a713ddcda1e5e).popup({\n                    target: this.klRootEl,\n                    message: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"submit-prompt\"),\n                    buttons: [\n                        (0, $63d0b335c576c718$export$ce37e184d908d785)(\"submit\"),\n                        \"Cancel\"\n                    ],\n                    callback: async (result)=>{\n                        if (result !== (0, $63d0b335c576c718$export$ce37e184d908d785)(\"submit\")) return;\n                        const overlay = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                            parent: this.klRootEl,\n                            className: \"upload-overlay\",\n                            content: '<div class=\"spinner\"></div> ' + (0, $63d0b335c576c718$export$ce37e184d908d785)(\"submit-submitting\")\n                        });\n                        this.embed.onSubmit(()=>{\n                            pOptions.saveReminder.reset();\n                            overlay.remove();\n                        }, ()=>{\n                            overlay.remove();\n                            onFailure();\n                        });\n                    }\n                });\n            },\n            onLeftRight: ()=>{\n                this.uiState = this.uiState === \"left\" ? \"right\" : \"left\";\n                this.updateUi();\n            }\n        });\n        else toolspaceTopRow = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).ToolspaceTopRow({\n            logoImg: pOptions.logoImg,\n            onLogo: ()=>{\n                (0, $165d2995997b2f9b$export$35fa34e5af64bd4a)(\"./home/\", !!this.embed);\n            },\n            onNew: ()=>{\n                showNewImageDialog();\n            },\n            onImport: ()=>{\n                fileTab.triggerImport();\n            },\n            onSave: ()=>{\n                this.saveToComputer.save();\n            },\n            onShare: ()=>{\n                shareImage();\n            },\n            onHelp: ()=>{\n                (0, $165d2995997b2f9b$export$35fa34e5af64bd4a)(\"./help/\", !!this.embed);\n            }\n        });\n        toolspaceTopRow.getElement().style.marginBottom = \"10px\";\n        this.toolspaceInner.append(toolspaceTopRow.getElement());\n        this.toolspaceToolRow = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).ToolspaceToolRow({\n            onActivate: (activeStr)=>{\n                if (activeStr === \"draw\") this.klCanvasWorkspace.setMode(\"draw\");\n                else if (activeStr === \"hand\") this.klCanvasWorkspace.setMode(\"hand\");\n                else if (activeStr === \"fill\") this.klCanvasWorkspace.setMode(\"fill\");\n                else if (activeStr === \"gradient\") this.klCanvasWorkspace.setMode(\"gradient\");\n                else if (activeStr === \"text\") this.klCanvasWorkspace.setMode(\"text\");\n                else if (activeStr === \"shape\") this.klCanvasWorkspace.setMode(\"shape\");\n                else throw new Error(\"unknown activeStr\");\n                mainTabRow && mainTabRow.open(activeStr);\n                updateMainTabVisibility();\n                this.klColorSlider.pickingDone();\n            },\n            onZoomIn: ()=>{\n                this.klCanvasWorkspace.zoomByStep(keyListener.isPressed(\"shift\") ? 1 / 8 : 0.5);\n            },\n            onZoomOut: ()=>{\n                this.klCanvasWorkspace.zoomByStep(keyListener.isPressed(\"shift\") ? -1 / 8 : -0.5);\n            },\n            onUndo: ()=>{\n                undoRedoCatchup.undo();\n            },\n            onRedo: ()=>{\n                undoRedoCatchup.redo();\n            }\n        });\n        this.toolspaceToolRow.setIsSmall(this.uiHeight < 540);\n        (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).addListener(()=>{\n            this.toolspaceToolRow.setEnableUndo((0, $d2dccce11beb16cf$export$28b6f4d98dde9845).canUndo());\n            this.toolspaceToolRow.setEnableRedo((0, $d2dccce11beb16cf$export$28b6f4d98dde9845).canRedo());\n        });\n        this.toolspaceInner.append(this.toolspaceToolRow.getElement());\n        const setBrushColor = (p_color)=>{\n            currentColor = p_color;\n            currentBrushUi.setColor(p_color);\n            brushSettingService.emitColor(p_color);\n            this.klColorSlider.pickingDone();\n        };\n        this.klColorSlider = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).KlColorSlider({\n            width: 250,\n            height: 30,\n            svHeight: 100,\n            startValue: new (0, $d9f9f4926aa80a1c$export$921068d8846a1559).RGB(0, 0, 0),\n            onPick: setBrushColor\n        });\n        this.klColorSlider.setHeight(Math.max(163, Math.min(400, this.uiHeight - 505)));\n        this.klColorSlider.setPickCallback((doPick)=>{\n            if (doPick) this.klCanvasWorkspace.setMode(\"pick\");\n            else {\n                this.klCanvasWorkspace.setMode(this.toolspaceToolRow.getActive());\n                updateMainTabVisibility();\n            }\n        });\n        const setCurrentBrush = (brushId)=>{\n            if (brushId !== \"eraserBrush\") lastNonEraserBrushId = brushId;\n            if (this.klColorSlider) {\n                if (brushId === \"eraserBrush\") this.klColorSlider.enable(false);\n                else this.klColorSlider.enable(true);\n            }\n            currentBrushId = brushId;\n            currentBrushUi = brushUiMap[brushId];\n            currentBrushUi.setColor(currentColor);\n            currentBrushUi.setContext(currentLayerCtx);\n            this.klCanvasWorkspace.setMode(\"draw\");\n            this.toolspaceToolRow.setActive(\"draw\");\n            updateMainTabVisibility();\n        };\n        const setCurrentLayer = (layer)=>{\n            currentLayerCtx = layer.context;\n            currentBrushUi.setContext(layer.context);\n            this.layerPreview.setLayer(layer);\n        };\n        const brushDiv = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el();\n        const colorDiv = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                margin: \"10px\",\n                display: \"flex\",\n                flexWrap: \"wrap\",\n                justifyContent: \"space-between\",\n                alignItems: \"flex-end\"\n            }\n        });\n        const toolspaceStabilizerRow = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).ToolspaceStabilizerRow({\n            smoothing: 1,\n            onSelect: (v)=>{\n                lineSmoothing.setSmoothing((0, $b2e5423e81cbdb22$export$bcd109042a2e4bb5)(v));\n            }\n        });\n        brushDiv.append(colorDiv);\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).append(colorDiv, [\n            this.klColorSlider.getElement(),\n            this.klColorSlider.getOutputElement(),\n            toolspaceStabilizerRow.getElement()\n        ]);\n        const brushTabRow = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).TabRow({\n            initialId: \"penBrush\",\n            useAccent: true,\n            tabArr: (()=>{\n                const result = [];\n                const createTab = (keyStr)=>{\n                    return {\n                        id: keyStr,\n                        image: (0, $49faab2330529a96$export$6e4a713ddcda1e5e).brushesUI[keyStr].image,\n                        title: (0, $49faab2330529a96$export$6e4a713ddcda1e5e).brushesUI[keyStr].tooltip,\n                        onOpen: ()=>{\n                            brushUiMap[keyStr].getElement().style.display = \"block\";\n                            setCurrentBrush(keyStr);\n                            this.klColorSlider.pickingDone();\n                            brushSettingService.emitSliderConfig({\n                                sizeSlider: (0, $49faab2330529a96$export$6e4a713ddcda1e5e).brushesUI[keyStr].sizeSlider,\n                                opacitySlider: (0, $49faab2330529a96$export$6e4a713ddcda1e5e).brushesUI[keyStr].opacitySlider\n                            });\n                            sizeWatcher(brushUiMap[keyStr].getSize());\n                            brushSettingService.emitOpacity(brushUiMap[keyStr].getOpacity());\n                        },\n                        onClose: ()=>{\n                            brushUiMap[keyStr].getElement().style.display = \"none\";\n                        }\n                    };\n                };\n                const keyArr = Object.keys(brushUiMap);\n                for(let i = 0; i < keyArr.length; i++)result.push(createTab(keyArr[i]));\n                return result;\n            })()\n        });\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).append(brushDiv, [\n            brushTabRow.getElement(),\n            ...Object.entries((0, $49faab2330529a96$export$6e4a713ddcda1e5e).brushesUI).map(([b])=>brushUiMap[b].getElement())\n        ]);\n        const handUi = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).HandUi({\n            scale: this.klCanvasWorkspace.getScale(),\n            angleDeg: 0,\n            onReset: ()=>{\n                this.klCanvasWorkspace.resetView(true);\n                handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n            },\n            onFit: ()=>{\n                this.klCanvasWorkspace.fitView(true);\n                handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n            },\n            onAngleChange: (angleDeg, isRelative)=>{\n                this.klCanvasWorkspace.setAngle(angleDeg, isRelative);\n                handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n            }\n        });\n        const fillUi = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).FillUi({\n            colorSlider: this.klColorSlider\n        });\n        const gradientUi = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).GradientUi({\n            colorSlider: this.klColorSlider\n        });\n        const textUi = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).TextUi({\n            colorSlider: this.klColorSlider\n        });\n        const shapeUi = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).ShapeUi({\n            colorSlider: this.klColorSlider\n        });\n        const gradientTool = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).GradientTool({\n            onGradient: (isDone, x1, y1, x2, y2, angleRad)=>{\n                const layerIndex = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\n                const settings = gradientUi.getSettings();\n                const gradientObj = {\n                    type: settings.type,\n                    color1: this.klColorSlider.getColor(),\n                    isReversed: settings.isReversed,\n                    opacity: settings.opacity,\n                    doLockAlpha: settings.doLockAlpha,\n                    isEraser: settings.isEraser,\n                    doSnap: keyListener.isPressed(\"shift\") || settings.doSnap,\n                    x1: x1,\n                    y1: y1,\n                    x2: x2,\n                    y2: y2,\n                    angleRad: angleRad\n                };\n                if (isDone) {\n                    this.klCanvas.setComposite(layerIndex, null);\n                    this.klCanvas.drawGradient(layerIndex, gradientObj);\n                } else this.klCanvas.setComposite(layerIndex, {\n                    draw: (ctx)=>{\n                        (0, $49faab2330529a96$export$6e4a713ddcda1e5e).drawGradient(ctx, gradientObj);\n                    }\n                });\n                this.klCanvasWorkspace.requestFrame();\n            }\n        });\n        const shapeTool = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).ShapeTool({\n            onShape: (isDone, x1, y1, x2, y2, angleRad)=>{\n                const layerIndex = (0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\n                const shapeObj = {\n                    type: shapeUi.getShape(),\n                    x1: x1,\n                    y1: y1,\n                    x2: x2,\n                    y2: y2,\n                    angleRad: angleRad,\n                    isOutwards: shapeUi.getIsOutwards(),\n                    opacity: shapeUi.getOpacity(),\n                    isEraser: shapeUi.getIsEraser(),\n                    doLockAlpha: shapeUi.getDoLockAlpha()\n                };\n                if (shapeUi.getShape() === \"line\") {\n                    shapeObj.strokeRgb = this.klColorSlider.getColor();\n                    shapeObj.lineWidth = shapeUi.getLineWidth();\n                    shapeObj.isAngleSnap = shapeUi.getIsSnap() || keyListener.isPressed(\"shift\");\n                } else {\n                    shapeObj.isFixedRatio = shapeUi.getIsFixed() || keyListener.isPressed(\"shift\");\n                    if (shapeUi.getMode() === \"stroke\") {\n                        shapeObj.strokeRgb = this.klColorSlider.getColor();\n                        shapeObj.lineWidth = shapeUi.getLineWidth();\n                    } else shapeObj.fillRgb = this.klColorSlider.getColor();\n                }\n                if (isDone) {\n                    this.klCanvas.setComposite(layerIndex, null);\n                    this.klCanvas.drawShape(layerIndex, shapeObj);\n                } else this.klCanvas.setComposite(layerIndex, {\n                    draw: (ctx)=>{\n                        (0, $49faab2330529a96$export$6e4a713ddcda1e5e).drawShape(ctx, shapeObj);\n                    }\n                });\n                this.klCanvasWorkspace.requestFrame();\n            }\n        });\n        this.layerManager = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).LayerManager(this.klCanvas, (val)=>{\n            setCurrentLayer((0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.klCanvas.getLayer(val)));\n            (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).push({\n                tool: [\n                    \"misc\"\n                ],\n                action: \"focusLayer\",\n                params: [\n                    val\n                ]\n            });\n        }, this.klRootEl, this.uiState);\n        this.layerPreview = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).LayerPreview({\n            klRootEl: this.klRootEl,\n            onClick: ()=>{\n                mainTabRow && mainTabRow.open(\"layers\");\n            },\n            uiState: this.uiState\n        });\n        this.layerPreview.setIsVisible(this.uiHeight >= 579);\n        this.layerPreview.setLayer(this.klCanvas.getLayer(this.klCanvas.getLayerIndex(currentLayerCtx.canvas)));\n        const filterTab = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).FilterTab(this.klRootEl, this.klColorSlider, this.layerManager, this.klCanvasWorkspace, handUi, ()=>currentColor, ()=>klMaxCanvasSize, ()=>this.klCanvas, ()=>currentLayerCtx, !!this.embed, this.statusOverlay);\n        const undoRedoCatchup = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).UndoRedoCatchup(brushUiMap, this.layerPreview, this.layerManager, handUi, this.klCanvasWorkspace, ()=>{\n            if (!initState) throw new Error(\"initState not initialized\");\n            return initState;\n        }, ()=>this.klCanvas, ()=>currentLayerCtx, (ctx)=>{\n            currentLayerCtx = ctx;\n        }, ()=>currentBrushUi);\n        (0, $d2dccce11beb16cf$export$28b6f4d98dde9845).addListener((p)=>{\n            undoRedoCatchup.catchup(p);\n        });\n        const showNewImageDialog = ()=>{\n            (0, $49faab2330529a96$export$6e4a713ddcda1e5e).newImageDialog({\n                currentColor: currentColor,\n                secondaryColor: this.klColorSlider.getSecondaryRGB(),\n                maxCanvasSize: klMaxCanvasSize,\n                canvasWidth: this.klCanvas.getWidth(),\n                canvasHeight: this.klCanvas.getHeight(),\n                workspaceWidth: window.innerWidth < this.collapseThreshold ? this.uiWidth : this.uiWidth - this.toolWidth,\n                workspaceHeight: this.uiHeight,\n                onConfirm: (width, height, color)=>{\n                    this.klCanvas.reset({\n                        width: width,\n                        height: height,\n                        color: color.a === 1 ? color : undefined\n                    });\n                    this.layerManager.update(0);\n                    setCurrentLayer((0, $fc4403c8ee6a33dc$export$b813e062795b89b5)(this.klCanvas.getLayer(0)));\n                    this.klCanvasWorkspace.resetOrFitView();\n                    handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n                },\n                onCancel: ()=>{}\n            });\n        };\n        const shareImage = (callback)=>{\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).shareCanvas({\n                canvas: this.klCanvas.getCompleteCanvas(1),\n                fileName: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).getDate() + (0, $5a2f7ed66bdaf6a4$export$4d6077ff8d823dfb).filenameBase + \".png\",\n                title: (0, $d9f9f4926aa80a1c$export$921068d8846a1559).getDate() + (0, $5a2f7ed66bdaf6a4$export$4d6077ff8d823dfb).filenameBase + \".png\",\n                callback: callback ? callback : ()=>{}\n            });\n        };\n        this.saveToComputer = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).SaveToComputer(pOptions.saveReminder, ()=>exportType, ()=>this.klCanvas);\n        const copyToClipboard = (showCrop)=>{\n            (0, $49faab2330529a96$export$6e4a713ddcda1e5e).clipboardDialog(this.klRootEl, this.klCanvas.getCompleteCanvas(1), (inputObj)=>{\n                if (inputObj.left === 0 && inputObj.right === 0 && inputObj.top === 0 && inputObj.bottom === 0) return;\n                //do a crop\n                (0, $49faab2330529a96$export$6e4a713ddcda1e5e).filterLib.cropExtend.apply({\n                    context: currentLayerCtx,\n                    klCanvas: this.klCanvas,\n                    input: inputObj,\n                    history: (0, $d2dccce11beb16cf$export$28b6f4d98dde9845)\n                });\n                this.layerManager.update();\n                this.klCanvasWorkspace.resetOrFitView();\n                handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n            }, this.statusOverlay, showCrop || false);\n        };\n        const fileTab = this.embed ? null : new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).FileTab(this.klRootEl, projectStore, ()=>this.klCanvas.getProject(), exportType, (type)=>{\n            exportType = type;\n        }, (files, optionsStr)=>importHandler.handleFileSelect(files, optionsStr), ()=>this.saveToComputer.save(), showNewImageDialog, shareImage, ()=>{\n            (0, $49faab2330529a96$export$6e4a713ddcda1e5e).imgurUpload(this.klCanvas, this.klRootEl, pOptions.saveReminder, pOptions.app && pOptions.app.imgurKey ? pOptions.app.imgurKey : \"\");\n        }, copyToClipboard, pOptions.saveReminder);\n        const settingsTab = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).SettingsTab(()=>{\n            this.uiState = this.uiState === \"left\" ? \"right\" : \"left\";\n            this.updateUi();\n            if (!this.embed) (0, $0ecef66681b62a8c$export$19fffca37ef3e106).setItem(\"uiState\", this.uiState);\n        }, this.embed ? undefined : pOptions.saveReminder, pOptions.aboutEl);\n        mainTabRow = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).TabRow({\n            initialId: \"draw\",\n            tabArr: [\n                {\n                    id: \"draw\",\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"tool-brush\"),\n                    image: (0, (/*@__PURE__*/$parcel$interopDefault($213fe7f980258b46$exports))),\n                    onOpen: ()=>{\n                        if (currentBrushId === \"eraserBrush\") this.klColorSlider.enable(false);\n                        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).append(colorDiv, [\n                            this.klColorSlider.getElement(),\n                            this.klColorSlider.getOutputElement(),\n                            toolspaceStabilizerRow.getElement()\n                        ]);\n                        brushDiv.style.display = \"block\";\n                    },\n                    onClose: ()=>{\n                        brushDiv.style.display = \"none\";\n                    },\n                    css: {\n                        minWidth: \"45px\"\n                    }\n                },\n                {\n                    id: \"hand\",\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"tool-hand\"),\n                    image: (0, (/*@__PURE__*/$parcel$interopDefault($acb9aa66d548f601$exports))),\n                    isVisible: false,\n                    onOpen: ()=>{\n                        handUi.setIsVisible(true);\n                    },\n                    onClose: ()=>{\n                        handUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: \"45px\"\n                    }\n                },\n                {\n                    id: \"fill\",\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"tool-paint-bucket\"),\n                    image: (0, (/*@__PURE__*/$parcel$interopDefault($b4e2f077fc10d34e$exports))),\n                    isVisible: false,\n                    onOpen: ()=>{\n                        this.klColorSlider.enable(true);\n                        fillUi.setIsVisible(true);\n                    },\n                    onClose: ()=>{\n                        fillUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: \"45px\"\n                    }\n                },\n                {\n                    id: \"gradient\",\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"tool-gradient\"),\n                    image: (0, (/*@__PURE__*/$parcel$interopDefault($7b6a173d3ec8bb59$exports))),\n                    isVisible: false,\n                    onOpen: ()=>{\n                        this.klColorSlider.enable(true);\n                        gradientUi.setIsVisible(true);\n                    },\n                    onClose: ()=>{\n                        gradientUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: \"45px\"\n                    }\n                },\n                {\n                    id: \"text\",\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"tool-text\"),\n                    image: (0, (/*@__PURE__*/$parcel$interopDefault($fc02e0eba0126db4$exports))),\n                    isVisible: false,\n                    onOpen: ()=>{\n                        this.klColorSlider.enable(true);\n                        textUi.setIsVisible(true);\n                    },\n                    onClose: ()=>{\n                        textUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: \"45px\"\n                    }\n                },\n                {\n                    id: \"shape\",\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"tool-shape\"),\n                    image: (0, (/*@__PURE__*/$parcel$interopDefault($b210eded9e92d550$exports))),\n                    isVisible: false,\n                    onOpen: ()=>{\n                        this.klColorSlider.enable(true);\n                        shapeUi.setIsVisible(true);\n                    },\n                    onClose: ()=>{\n                        shapeUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: \"45px\"\n                    }\n                },\n                {\n                    id: \"layers\",\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"layers\"),\n                    image: (0, (/*@__PURE__*/$parcel$interopDefault($5ad3867a8e2df089$exports))),\n                    onOpen: ()=>{\n                        this.layerManager.update();\n                        this.layerManager.getElement().style.display = \"block\";\n                    },\n                    onClose: ()=>{\n                        this.layerManager.getElement().style.display = \"none\";\n                    },\n                    css: {\n                        minWidth: \"45px\"\n                    }\n                },\n                {\n                    id: \"edit\",\n                    label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"tab-edit\"),\n                    onOpen: ()=>{\n                        filterTab.show();\n                    },\n                    onClose: ()=>{\n                        filterTab.hide();\n                    },\n                    css: {\n                        padding: \"0 7px\"\n                    }\n                },\n                {\n                    id: \"file\",\n                    label: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"tab-file\"),\n                    isVisible: !!fileTab,\n                    onOpen: ()=>{\n                        if (!fileTab) return;\n                        fileTab.getElement().style.display = \"block\";\n                        fileTab.setIsVisible(true);\n                    },\n                    onClose: ()=>{\n                        if (!fileTab) return;\n                        fileTab.getElement().style.display = \"none\";\n                        fileTab.setIsVisible(false);\n                    },\n                    css: {\n                        padding: \"0 7px\"\n                    }\n                },\n                {\n                    id: \"settings\",\n                    title: (0, $63d0b335c576c718$export$ce37e184d908d785)(\"tab-settings\"),\n                    image: (0, (/*@__PURE__*/$parcel$interopDefault($6d04bb35ac2352cf$exports))),\n                    onOpen: ()=>{\n                        settingsTab.getElement().style.display = \"block\";\n                    // settingsTab.setIsVisible(true);\n                    },\n                    onClose: ()=>{\n                        settingsTab.getElement().style.display = \"none\";\n                    // settingsTab.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: \"45px\"\n                    }\n                }\n            ]\n        });\n        this.bottomBarWrapper = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n            css: {\n                width: \"270px\",\n                position: \"absolute\",\n                bottom: \"0\",\n                left: \"0\"\n            }\n        });\n        if (pOptions.bottomBar) {\n            this.bottomBar = pOptions.bottomBar;\n            this.bottomBarWrapper.append(this.bottomBar);\n            const observer = new MutationObserver(()=>this.updateBottomBar());\n            observer.observe(this.toolspaceInner, {\n                attributes: true,\n                childList: true,\n                subtree: true\n            });\n        }\n        (0, $d9f9f4926aa80a1c$export$921068d8846a1559).append(this.toolspaceInner, [\n            this.layerPreview.getElement(),\n            mainTabRow.getElement(),\n            brushDiv,\n            handUi.getElement(),\n            fillUi.getElement(),\n            gradientUi.getElement(),\n            textUi.getElement(),\n            shapeUi.getElement(),\n            this.layerManager.getElement(),\n            filterTab.getElement(),\n            fileTab ? fileTab.getElement() : undefined,\n            settingsTab.getElement(),\n            (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                css: {\n                    height: \"10px\"\n                }\n            }),\n            this.bottomBarWrapper ? this.bottomBarWrapper : undefined\n        ]);\n        this.toolspaceScroller = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).ToolspaceScroller({\n            toolspace: this.toolspace,\n            uiState: this.uiState\n        });\n        if (!this.embed) Object.defineProperty(window, \"KL\", {\n            value: (0, $1050fcf084a1ca84$export$982e7602957287fa)({\n                onDraw: (path)=>{\n                    if (!path || path.length === 0) return;\n                    path.forEach((p, index)=>{\n                        if (index === 0) currentBrushUi.startLine(p.x, p.y, 1);\n                        else currentBrushUi.goLine(p.x, p.y, 1);\n                    });\n                    currentBrushUi.endLine();\n                    this.klCanvasWorkspace.requestFrame();\n                }\n            }),\n            writable: false\n        });\n        this.resize(this.uiWidth, this.uiHeight);\n        this.updateUi();\n        const importHandler = new (0, $8edbd5a1c1dde18e$export$4ccbb8938b9d5723)({\n            klRootEl: this.klRootEl,\n            klMaxCanvasSize: klMaxCanvasSize,\n            layerManager: this.layerManager,\n            setCurrentLayer: setCurrentLayer,\n            klCanvas: this.klCanvas,\n            klCanvasWorkspace: this.klCanvasWorkspace,\n            handUi: handUi\n        }, {\n            onColor: (rgb)=>brushSettingService.setColor(rgb)\n        });\n        if (!this.embed) {\n            new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).KlImageDropper({\n                target: document.body,\n                onDrop: (files, optionStr)=>{\n                    if ((0, $49faab2330529a96$export$6e4a713ddcda1e5e).dialogCounter.get() > 0) return;\n                    importHandler.handleFileSelect(files, optionStr);\n                },\n                enabledTest: ()=>{\n                    return (0, $49faab2330529a96$export$6e4a713ddcda1e5e).dialogCounter.get() === 0;\n                }\n            });\n            window.document.addEventListener(\"paste\", (e)=>importHandler.onPaste(e), false);\n        }\n        {\n            window.addEventListener(\"resize\", ()=>{\n                this.resize(window.innerWidth, window.innerHeight);\n            });\n            window.addEventListener(\"orientationchange\", ()=>{\n                this.resize(window.innerWidth, window.innerHeight);\n            });\n            // iPad doesn't trigger 'resize' event when using text zoom, although it's resizing the window.\n            // Workaround: place a div in the body that fills the window, and use a ResizeObserver\n            const windowResizeWatcher = (0, $d9f9f4926aa80a1c$export$921068d8846a1559).el({\n                parent: document.body,\n                css: {\n                    position: \"fixed\",\n                    left: \"0\",\n                    top: \"0\",\n                    right: \"0\",\n                    bottom: \"0\",\n                    pointerEvents: \"none\",\n                    zIndex: \"-1\",\n                    userSelect: \"none\"\n                }\n            });\n            try {\n                // Not all browsers support ResizeObserver. Not critical though.\n                const observer = new ResizeObserver(()=>this.resize(window.innerWidth, window.innerHeight));\n                observer.observe(windowResizeWatcher);\n            } catch (e) {\n                windowResizeWatcher.remove();\n            }\n            // prevent ctrl scroll -> zooming page\n            this.klRootEl.addEventListener(\"wheel\", (event)=>{\n                if (keyListener.isPressed(\"ctrl\")) event.preventDefault();\n            });\n            //maybe prevent zooming on safari mac os - todo still needed?\n            const prevent = (e)=>{\n                e.preventDefault();\n            };\n            window.addEventListener(\"gesturestart\", prevent);\n            window.addEventListener(\"gesturechange\", prevent);\n            window.addEventListener(\"gestureend\", prevent);\n        }\n    }\n}\n\n\n\n\nfunction $8e7310a6fc595c9c$var$initError(e) {\n    const el = document.createElement(\"div\");\n    el.style.textAlign = \"center\";\n    el.style.background = \"#fff\";\n    el.style.padding = \"20px\";\n    el.innerHTML = \"<h1>App failed to initialize</h1>\";\n    const errorMsg = document.createElement(\"div\");\n    errorMsg.textContent = \"Error: \" + (e.message ? e.message : \"\" + e);\n    el.append(errorMsg);\n    document.body.append(el);\n    console.error(e);\n}\n(async ()=>{\n    let klApp;\n    let domIsLoaded = false;\n    try {\n        window.addEventListener(\"DOMContentLoaded\", ()=>{\n            domIsLoaded = true;\n        });\n        await (0, $63d0b335c576c718$export$7a2ea9f2e4d199d3)();\n    } catch (e) {\n        $8e7310a6fc595c9c$var$initError(e);\n        return;\n    }\n    function onProjectLoaded(project, projectStore) {\n        if (klApp) throw \"onKlProjectObjLoaded called more than once\";\n        // in case an extension manipulated the page\n        const loadingScreenEl = document.getElementById(\"loading-screen\");\n        loadingScreenEl === null || loadingScreenEl === void 0 ? void 0 : loadingScreenEl.remove();\n        const saveReminder = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).SaveReminder((0, $d2dccce11beb16cf$export$28b6f4d98dde9845), true, true, ()=>klApp.saveAsPsd(), ()=>{\n            return klApp ? klApp.isDrawing() : false;\n        }, null, null);\n        klApp = new (0, $b7af2ed4a75d4700$export$96f6458b62e4c2c)(project, {\n            saveReminder: saveReminder,\n            projectStore: projectStore\n        });\n        saveReminder.init();\n        if (project) setTimeout(()=>{\n            klApp.out((0, $63d0b335c576c718$export$ce37e184d908d785)(\"file-storage-restored\"));\n        }, 100);\n        document.body.append(klApp.getEl());\n        window.klecks = klApp;\n    }\n    async function onDomLoaded() {\n        try {\n            window.removeEventListener(\"DOMContentLoaded\", onDomLoaded);\n            const projectStore = new (0, $49faab2330529a96$export$6e4a713ddcda1e5e).ProjectStore();\n            let project = null;\n            try {\n                const readResult = await projectStore.read();\n                if (readResult) project = readResult.project;\n            } catch (e) {\n                let message;\n                if (e.message.indexOf(\"db-error\") === 0) message = \"Failed to access Browser Storage\";\n                else if (e.message.indexOf(\"format-error\") === 0) message = \"Failed to restore from Browser Storage\";\n                else message = \"Failed to restore from Browser Storage\";\n                if (message) setTimeout(function() {\n                    klApp && klApp.out(message);\n                    throw new Error(\"Initial browser storage error, \" + e);\n                }, 100);\n            }\n            onProjectLoaded(project, projectStore);\n        } catch (e) {\n            $8e7310a6fc595c9c$var$initError(e);\n        }\n    }\n    if (domIsLoaded) onDomLoaded();\n    else window.addEventListener(\"DOMContentLoaded\", onDomLoaded);\n})();\n\n\n//# sourceMappingURL=index.ab1dda3d.js.map\n","module.exports = (require(\"./helpers/browser/import-polyfill\")(require('./helpers/bundle-manifest').resolve(\"6OT74\"))).then(() => parcelRequire('11sRX'));","\"use strict\";\n\nvar cacheLoader = require('../cacheLoader');\nmodule.exports = cacheLoader(function (bundle) {\n  return new Promise(function (resolve, reject) {\n    // Add a global function to handle when the script loads.\n    var globalName = \"i\".concat(('' + Math.random()).slice(2));\n    global[globalName] = function (m) {\n      resolve(m);\n      cleanup();\n    };\n\n    // Remove script on load or error\n    var cleanup = function () {\n      delete global[globalName];\n      script.onerror = null;\n      script.remove();\n    };\n\n    // Append an inline script tag into the document head\n    var script = document.createElement('script');\n    script.async = true;\n    script.type = 'module';\n    script.charset = 'utf-8';\n    script.textContent = \"import * as m from '\".concat(bundle, \"'; \").concat(globalName, \"(m);\");\n    script.onerror = function (e) {\n      reject(e);\n      cleanup();\n    };\n    document.head.appendChild(script);\n  });\n});","\"use strict\";\n\nvar cachedBundles = {};\nvar cachedPreloads = {};\nvar cachedPrefetches = {};\nfunction getCache(type) {\n  switch (type) {\n    case 'preload':\n      return cachedPreloads;\n    case 'prefetch':\n      return cachedPrefetches;\n    default:\n      return cachedBundles;\n  }\n}\nmodule.exports = function (loader, type) {\n  return function (bundle) {\n    var cache = getCache(type);\n    if (cache[bundle]) {\n      return cache[bundle];\n    }\n    return cache[bundle] = loader.apply(null, arguments).catch(function (e) {\n      delete cache[bundle];\n      throw e;\n    });\n  };\n};","module.exports = (require(\"./helpers/browser/import-polyfill\")(require('./helpers/bundle-manifest').resolve(\"i8WN1\"))).then(() => parcelRequire('aZ0Sx'));","module.exports = (require(\"./helpers/browser/import-polyfill\")(require('./helpers/bundle-manifest').resolve(\"hUIiR\"))).then(() => parcelRequire('2BQEx'));","module.exports = (require(\"./helpers/browser/import-polyfill\")(require('./helpers/bundle-manifest').resolve(\"klZAl\"))).then(() => parcelRequire('68m8f'));","module.exports = (require(\"./helpers/browser/import-polyfill\")(require('./helpers/bundle-manifest').resolve(\"i3Nr5\"))).then(() => parcelRequire('5ukhf'));","module.exports = (require(\"./helpers/browser/import-polyfill\")(require('./helpers/bundle-manifest').resolve(\"eiNJp\"))).then(() => parcelRequire('2C9ch'));","module.exports = (require(\"./helpers/browser/import-polyfill\")(require('./helpers/bundle-manifest').resolve(\"b1997\"))).then(() => parcelRequire('aGeQD'));","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar createInstance_dist_emotionCssCreateInstance = require('../create-instance/dist/emotion-css-create-instance.cjs.prod.js');\nrequire('@emotion/cache');\nrequire('@emotion/serialize');\nrequire('@emotion/utils');\n\nvar _createEmotion = createInstance_dist_emotionCssCreateInstance[\"default\"]({\n  key: 'css'\n}),\n    flush = _createEmotion.flush,\n    hydrate = _createEmotion.hydrate,\n    cx = _createEmotion.cx,\n    merge = _createEmotion.merge,\n    getRegisteredStyles = _createEmotion.getRegisteredStyles,\n    injectGlobal = _createEmotion.injectGlobal,\n    keyframes = _createEmotion.keyframes,\n    css = _createEmotion.css,\n    sheet = _createEmotion.sheet,\n    cache = _createEmotion.cache;\n\nexports.cache = cache;\nexports.css = css;\nexports.cx = cx;\nexports.flush = flush;\nexports.getRegisteredStyles = getRegisteredStyles;\nexports.hydrate = hydrate;\nexports.injectGlobal = injectGlobal;\nexports.keyframes = keyframes;\nexports.merge = merge;\nexports.sheet = sheet;\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar createCache = require('@emotion/cache');\nvar serialize = require('@emotion/serialize');\nvar utils = require('@emotion/utils');\n\nfunction _interopDefault (e) { return e && e.__esModule ? e : { 'default': e }; }\n\nvar createCache__default = /*#__PURE__*/_interopDefault(createCache);\n\nfunction insertWithoutScoping(cache, serialized) {\n  if (cache.inserted[serialized.name] === undefined) {\n    return cache.insert('', serialized, cache.sheet, true);\n  }\n}\n\nfunction merge(registered, css, className) {\n  var registeredStyles = [];\n  var rawClassName = utils.getRegisteredStyles(registered, registeredStyles, className);\n\n  if (registeredStyles.length < 2) {\n    return className;\n  }\n\n  return rawClassName + css(registeredStyles);\n}\n\nvar createEmotion = function createEmotion(options) {\n  var cache = createCache__default[\"default\"](options); // $FlowFixMe\n\n  cache.sheet.speedy = function (value) {\n\n    this.isSpeedy = value;\n  };\n\n  cache.compat = true;\n\n  var css = function css() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    var serialized = serialize.serializeStyles(args, cache.registered, undefined);\n    utils.insertStyles(cache, serialized, false);\n    return cache.key + \"-\" + serialized.name;\n  };\n\n  var keyframes = function keyframes() {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    var serialized = serialize.serializeStyles(args, cache.registered);\n    var animation = \"animation-\" + serialized.name;\n    insertWithoutScoping(cache, {\n      name: serialized.name,\n      styles: \"@keyframes \" + animation + \"{\" + serialized.styles + \"}\"\n    });\n    return animation;\n  };\n\n  var injectGlobal = function injectGlobal() {\n    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n\n    var serialized = serialize.serializeStyles(args, cache.registered);\n    insertWithoutScoping(cache, serialized);\n  };\n\n  var cx = function cx() {\n    for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n      args[_key4] = arguments[_key4];\n    }\n\n    return merge(cache.registered, css, classnames(args));\n  };\n\n  return {\n    css: css,\n    cx: cx,\n    injectGlobal: injectGlobal,\n    keyframes: keyframes,\n    hydrate: function hydrate(ids) {\n      ids.forEach(function (key) {\n        cache.inserted[key] = true;\n      });\n    },\n    flush: function flush() {\n      cache.registered = {};\n      cache.inserted = {};\n      cache.sheet.flush();\n    },\n    // $FlowFixMe\n    sheet: cache.sheet,\n    cache: cache,\n    getRegisteredStyles: utils.getRegisteredStyles.bind(null, cache.registered),\n    merge: merge.bind(null, cache.registered, css)\n  };\n};\n\nvar classnames = function classnames(args) {\n  var cls = '';\n\n  for (var i = 0; i < args.length; i++) {\n    var arg = args[i];\n    if (arg == null) continue;\n    var toAdd = void 0;\n\n    switch (typeof arg) {\n      case 'boolean':\n        break;\n\n      case 'object':\n        {\n          if (Array.isArray(arg)) {\n            toAdd = classnames(arg);\n          } else {\n            toAdd = '';\n\n            for (var k in arg) {\n              if (arg[k] && k) {\n                toAdd && (toAdd += ' ');\n                toAdd += k;\n              }\n            }\n          }\n\n          break;\n        }\n\n      default:\n        {\n          toAdd = arg;\n        }\n    }\n\n    if (toAdd) {\n      cls && (cls += ' ');\n      cls += toAdd;\n    }\n  }\n\n  return cls;\n};\n\nexports[\"default\"] = createEmotion;\n","import { StyleSheet } from '@emotion/sheet';\nimport { dealloc, alloc, next, token, from, peek, delimit, slice, position, RULESET, combine, match, serialize, copy, replace, WEBKIT, MOZ, MS, KEYFRAMES, DECLARATION, hash, charat, strlen, indexof, stringify, COMMENT, rulesheet, middleware, compile } from 'stylis';\nimport '@emotion/weak-memoize';\nimport '@emotion/memoize';\n\nvar identifierWithPointTracking = function identifierWithPointTracking(begin, points, index) {\n  var previous = 0;\n  var character = 0;\n\n  while (true) {\n    previous = character;\n    character = peek(); // &\\f\n\n    if (previous === 38 && character === 12) {\n      points[index] = 1;\n    }\n\n    if (token(character)) {\n      break;\n    }\n\n    next();\n  }\n\n  return slice(begin, position);\n};\n\nvar toRules = function toRules(parsed, points) {\n  // pretend we've started with a comma\n  var index = -1;\n  var character = 44;\n\n  do {\n    switch (token(character)) {\n      case 0:\n        // &\\f\n        if (character === 38 && peek() === 12) {\n          // this is not 100% correct, we don't account for literal sequences here - like for example quoted strings\n          // stylis inserts \\f after & to know when & where it should replace this sequence with the context selector\n          // and when it should just concatenate the outer and inner selectors\n          // it's very unlikely for this sequence to actually appear in a different context, so we just leverage this fact here\n          points[index] = 1;\n        }\n\n        parsed[index] += identifierWithPointTracking(position - 1, points, index);\n        break;\n\n      case 2:\n        parsed[index] += delimit(character);\n        break;\n\n      case 4:\n        // comma\n        if (character === 44) {\n          // colon\n          parsed[++index] = peek() === 58 ? '&\\f' : '';\n          points[index] = parsed[index].length;\n          break;\n        }\n\n      // fallthrough\n\n      default:\n        parsed[index] += from(character);\n    }\n  } while (character = next());\n\n  return parsed;\n};\n\nvar getRules = function getRules(value, points) {\n  return dealloc(toRules(alloc(value), points));\n}; // WeakSet would be more appropriate, but only WeakMap is supported in IE11\n\n\nvar fixedElements = /* #__PURE__ */new WeakMap();\nvar compat = function compat(element) {\n  if (element.type !== 'rule' || !element.parent || // positive .length indicates that this rule contains pseudo\n  // negative .length indicates that this rule has been already prefixed\n  element.length < 1) {\n    return;\n  }\n\n  var value = element.value,\n      parent = element.parent;\n  var isImplicitRule = element.column === parent.column && element.line === parent.line;\n\n  while (parent.type !== 'rule') {\n    parent = parent.parent;\n    if (!parent) return;\n  } // short-circuit for the simplest case\n\n\n  if (element.props.length === 1 && value.charCodeAt(0) !== 58\n  /* colon */\n  && !fixedElements.get(parent)) {\n    return;\n  } // if this is an implicitly inserted rule (the one eagerly inserted at the each new nested level)\n  // then the props has already been manipulated beforehand as they that array is shared between it and its \"rule parent\"\n\n\n  if (isImplicitRule) {\n    return;\n  }\n\n  fixedElements.set(element, true);\n  var points = [];\n  var rules = getRules(value, points);\n  var parentRules = parent.props;\n\n  for (var i = 0, k = 0; i < rules.length; i++) {\n    for (var j = 0; j < parentRules.length; j++, k++) {\n      element.props[k] = points[i] ? rules[i].replace(/&\\f/g, parentRules[j]) : parentRules[j] + \" \" + rules[i];\n    }\n  }\n};\nvar removeLabel = function removeLabel(element) {\n  if (element.type === 'decl') {\n    var value = element.value;\n\n    if ( // charcode for l\n    value.charCodeAt(0) === 108 && // charcode for b\n    value.charCodeAt(2) === 98) {\n      // this ignores label\n      element[\"return\"] = '';\n      element.value = '';\n    }\n  }\n};\nvar ignoreFlag = 'emotion-disable-server-rendering-unsafe-selector-warning-please-do-not-use-this-the-warning-exists-for-a-reason';\n\nvar isIgnoringComment = function isIgnoringComment(element) {\n  return element.type === 'comm' && element.children.indexOf(ignoreFlag) > -1;\n};\n\nvar createUnsafeSelectorsAlarm = function createUnsafeSelectorsAlarm(cache) {\n  return function (element, index, children) {\n    if (element.type !== 'rule' || cache.compat) return;\n    var unsafePseudoClasses = element.value.match(/(:first|:nth|:nth-last)-child/g);\n\n    if (unsafePseudoClasses) {\n      var isNested = !!element.parent; // in nested rules comments become children of the \"auto-inserted\" rule and that's always the `element.parent`\n      //\n      // considering this input:\n      // .a {\n      //   .b /* comm */ {}\n      //   color: hotpink;\n      // }\n      // we get output corresponding to this:\n      // .a {\n      //   & {\n      //     /* comm */\n      //     color: hotpink;\n      //   }\n      //   .b {}\n      // }\n\n      var commentContainer = isNested ? element.parent.children : // global rule at the root level\n      children;\n\n      for (var i = commentContainer.length - 1; i >= 0; i--) {\n        var node = commentContainer[i];\n\n        if (node.line < element.line) {\n          break;\n        } // it is quite weird but comments are *usually* put at `column: element.column - 1`\n        // so we seek *from the end* for the node that is earlier than the rule's `element` and check that\n        // this will also match inputs like this:\n        // .a {\n        //   /* comm */\n        //   .b {}\n        // }\n        //\n        // but that is fine\n        //\n        // it would be the easiest to change the placement of the comment to be the first child of the rule:\n        // .a {\n        //   .b { /* comm */ }\n        // }\n        // with such inputs we wouldn't have to search for the comment at all\n        // TODO: consider changing this comment placement in the next major version\n\n\n        if (node.column < element.column) {\n          if (isIgnoringComment(node)) {\n            return;\n          }\n\n          break;\n        }\n      }\n\n      unsafePseudoClasses.forEach(function (unsafePseudoClass) {\n        console.error(\"The pseudo class \\\"\" + unsafePseudoClass + \"\\\" is potentially unsafe when doing server-side rendering. Try changing it to \\\"\" + unsafePseudoClass.split('-child')[0] + \"-of-type\\\".\");\n      });\n    }\n  };\n};\n\nvar isImportRule = function isImportRule(element) {\n  return element.type.charCodeAt(1) === 105 && element.type.charCodeAt(0) === 64;\n};\n\nvar isPrependedWithRegularRules = function isPrependedWithRegularRules(index, children) {\n  for (var i = index - 1; i >= 0; i--) {\n    if (!isImportRule(children[i])) {\n      return true;\n    }\n  }\n\n  return false;\n}; // use this to remove incorrect elements from further processing\n// so they don't get handed to the `sheet` (or anything else)\n// as that could potentially lead to additional logs which in turn could be overhelming to the user\n\n\nvar nullifyElement = function nullifyElement(element) {\n  element.type = '';\n  element.value = '';\n  element[\"return\"] = '';\n  element.children = '';\n  element.props = '';\n};\n\nvar incorrectImportAlarm = function incorrectImportAlarm(element, index, children) {\n  if (!isImportRule(element)) {\n    return;\n  }\n\n  if (element.parent) {\n    console.error(\"`@import` rules can't be nested inside other rules. Please move it to the top level and put it before regular rules. Keep in mind that they can only be used within global styles.\");\n    nullifyElement(element);\n  } else if (isPrependedWithRegularRules(index, children)) {\n    console.error(\"`@import` rules can't be after other rules. Please put your `@import` rules before your other rules.\");\n    nullifyElement(element);\n  }\n};\n\n/* eslint-disable no-fallthrough */\n\nfunction prefix(value, length) {\n  switch (hash(value, length)) {\n    // color-adjust\n    case 5103:\n      return WEBKIT + 'print-' + value + value;\n    // animation, animation-(delay|direction|duration|fill-mode|iteration-count|name|play-state|timing-function)\n\n    case 5737:\n    case 4201:\n    case 3177:\n    case 3433:\n    case 1641:\n    case 4457:\n    case 2921: // text-decoration, filter, clip-path, backface-visibility, column, box-decoration-break\n\n    case 5572:\n    case 6356:\n    case 5844:\n    case 3191:\n    case 6645:\n    case 3005: // mask, mask-image, mask-(mode|clip|size), mask-(repeat|origin), mask-position, mask-composite,\n\n    case 6391:\n    case 5879:\n    case 5623:\n    case 6135:\n    case 4599:\n    case 4855: // background-clip, columns, column-(count|fill|gap|rule|rule-color|rule-style|rule-width|span|width)\n\n    case 4215:\n    case 6389:\n    case 5109:\n    case 5365:\n    case 5621:\n    case 3829:\n      return WEBKIT + value + value;\n    // appearance, user-select, transform, hyphens, text-size-adjust\n\n    case 5349:\n    case 4246:\n    case 4810:\n    case 6968:\n    case 2756:\n      return WEBKIT + value + MOZ + value + MS + value + value;\n    // flex, flex-direction\n\n    case 6828:\n    case 4268:\n      return WEBKIT + value + MS + value + value;\n    // order\n\n    case 6165:\n      return WEBKIT + value + MS + 'flex-' + value + value;\n    // align-items\n\n    case 5187:\n      return WEBKIT + value + replace(value, /(\\w+).+(:[^]+)/, WEBKIT + 'box-$1$2' + MS + 'flex-$1$2') + value;\n    // align-self\n\n    case 5443:\n      return WEBKIT + value + MS + 'flex-item-' + replace(value, /flex-|-self/, '') + value;\n    // align-content\n\n    case 4675:\n      return WEBKIT + value + MS + 'flex-line-pack' + replace(value, /align-content|flex-|-self/, '') + value;\n    // flex-shrink\n\n    case 5548:\n      return WEBKIT + value + MS + replace(value, 'shrink', 'negative') + value;\n    // flex-basis\n\n    case 5292:\n      return WEBKIT + value + MS + replace(value, 'basis', 'preferred-size') + value;\n    // flex-grow\n\n    case 6060:\n      return WEBKIT + 'box-' + replace(value, '-grow', '') + WEBKIT + value + MS + replace(value, 'grow', 'positive') + value;\n    // transition\n\n    case 4554:\n      return WEBKIT + replace(value, /([^-])(transform)/g, '$1' + WEBKIT + '$2') + value;\n    // cursor\n\n    case 6187:\n      return replace(replace(replace(value, /(zoom-|grab)/, WEBKIT + '$1'), /(image-set)/, WEBKIT + '$1'), value, '') + value;\n    // background, background-image\n\n    case 5495:\n    case 3959:\n      return replace(value, /(image-set\\([^]*)/, WEBKIT + '$1' + '$`$1');\n    // justify-content\n\n    case 4968:\n      return replace(replace(value, /(.+:)(flex-)?(.*)/, WEBKIT + 'box-pack:$3' + MS + 'flex-pack:$3'), /s.+-b[^;]+/, 'justify') + WEBKIT + value + value;\n    // (margin|padding)-inline-(start|end)\n\n    case 4095:\n    case 3583:\n    case 4068:\n    case 2532:\n      return replace(value, /(.+)-inline(.+)/, WEBKIT + '$1$2') + value;\n    // (min|max)?(width|height|inline-size|block-size)\n\n    case 8116:\n    case 7059:\n    case 5753:\n    case 5535:\n    case 5445:\n    case 5701:\n    case 4933:\n    case 4677:\n    case 5533:\n    case 5789:\n    case 5021:\n    case 4765:\n      // stretch, max-content, min-content, fill-available\n      if (strlen(value) - 1 - length > 6) switch (charat(value, length + 1)) {\n        // (m)ax-content, (m)in-content\n        case 109:\n          // -\n          if (charat(value, length + 4) !== 45) break;\n        // (f)ill-available, (f)it-content\n\n        case 102:\n          return replace(value, /(.+:)(.+)-([^]+)/, '$1' + WEBKIT + '$2-$3' + '$1' + MOZ + (charat(value, length + 3) == 108 ? '$3' : '$2-$3')) + value;\n        // (s)tretch\n\n        case 115:\n          return ~indexof(value, 'stretch') ? prefix(replace(value, 'stretch', 'fill-available'), length) + value : value;\n      }\n      break;\n    // position: sticky\n\n    case 4949:\n      // (s)ticky?\n      if (charat(value, length + 1) !== 115) break;\n    // display: (flex|inline-flex)\n\n    case 6444:\n      switch (charat(value, strlen(value) - 3 - (~indexof(value, '!important') && 10))) {\n        // stic(k)y\n        case 107:\n          return replace(value, ':', ':' + WEBKIT) + value;\n        // (inline-)?fl(e)x\n\n        case 101:\n          return replace(value, /(.+:)([^;!]+)(;|!.+)?/, '$1' + WEBKIT + (charat(value, 14) === 45 ? 'inline-' : '') + 'box$3' + '$1' + WEBKIT + '$2$3' + '$1' + MS + '$2box$3') + value;\n      }\n\n      break;\n    // writing-mode\n\n    case 5936:\n      switch (charat(value, length + 11)) {\n        // vertical-l(r)\n        case 114:\n          return WEBKIT + value + MS + replace(value, /[svh]\\w+-[tblr]{2}/, 'tb') + value;\n        // vertical-r(l)\n\n        case 108:\n          return WEBKIT + value + MS + replace(value, /[svh]\\w+-[tblr]{2}/, 'tb-rl') + value;\n        // horizontal(-)tb\n\n        case 45:\n          return WEBKIT + value + MS + replace(value, /[svh]\\w+-[tblr]{2}/, 'lr') + value;\n      }\n\n      return WEBKIT + value + MS + value + value;\n  }\n\n  return value;\n}\n\nvar prefixer = function prefixer(element, index, children, callback) {\n  if (element.length > -1) if (!element[\"return\"]) switch (element.type) {\n    case DECLARATION:\n      element[\"return\"] = prefix(element.value, element.length);\n      break;\n\n    case KEYFRAMES:\n      return serialize([copy(element, {\n        value: replace(element.value, '@', '@' + WEBKIT)\n      })], callback);\n\n    case RULESET:\n      if (element.length) return combine(element.props, function (value) {\n        switch (match(value, /(::plac\\w+|:read-\\w+)/)) {\n          // :read-(only|write)\n          case ':read-only':\n          case ':read-write':\n            return serialize([copy(element, {\n              props: [replace(value, /:(read-\\w+)/, ':' + MOZ + '$1')]\n            })], callback);\n          // :placeholder\n\n          case '::placeholder':\n            return serialize([copy(element, {\n              props: [replace(value, /:(plac\\w+)/, ':' + WEBKIT + 'input-$1')]\n            }), copy(element, {\n              props: [replace(value, /:(plac\\w+)/, ':' + MOZ + '$1')]\n            }), copy(element, {\n              props: [replace(value, /:(plac\\w+)/, MS + 'input-$1')]\n            })], callback);\n        }\n\n        return '';\n      });\n  }\n};\n\nvar defaultStylisPlugins = [prefixer];\n\nvar createCache = function createCache(options) {\n  var key = options.key;\n\n  if (process.env.NODE_ENV !== 'production' && !key) {\n    throw new Error(\"You have to configure `key` for your cache. Please make sure it's unique (and not equal to 'css') as it's used for linking styles to your cache.\\n\" + \"If multiple caches share the same key they might \\\"fight\\\" for each other's style elements.\");\n  }\n\n  if (key === 'css') {\n    var ssrStyles = document.querySelectorAll(\"style[data-emotion]:not([data-s])\"); // get SSRed styles out of the way of React's hydration\n    // document.head is a safe place to move them to(though note document.head is not necessarily the last place they will be)\n    // note this very very intentionally targets all style elements regardless of the key to ensure\n    // that creating a cache works inside of render of a React component\n\n    Array.prototype.forEach.call(ssrStyles, function (node) {\n      // we want to only move elements which have a space in the data-emotion attribute value\n      // because that indicates that it is an Emotion 11 server-side rendered style elements\n      // while we will already ignore Emotion 11 client-side inserted styles because of the :not([data-s]) part in the selector\n      // Emotion 10 client-side inserted styles did not have data-s (but importantly did not have a space in their data-emotion attributes)\n      // so checking for the space ensures that loading Emotion 11 after Emotion 10 has inserted some styles\n      // will not result in the Emotion 10 styles being destroyed\n      var dataEmotionAttribute = node.getAttribute('data-emotion');\n\n      if (dataEmotionAttribute.indexOf(' ') === -1) {\n        return;\n      }\n      document.head.appendChild(node);\n      node.setAttribute('data-s', '');\n    });\n  }\n\n  var stylisPlugins = options.stylisPlugins || defaultStylisPlugins;\n\n  if (process.env.NODE_ENV !== 'production') {\n    // $FlowFixMe\n    if (/[^a-z-]/.test(key)) {\n      throw new Error(\"Emotion key must only contain lower case alphabetical characters and - but \\\"\" + key + \"\\\" was passed\");\n    }\n  }\n\n  var inserted = {};\n  var container;\n  var nodesToHydrate = [];\n\n  {\n    container = options.container || document.head;\n    Array.prototype.forEach.call( // this means we will ignore elements which don't have a space in them which\n    // means that the style elements we're looking at are only Emotion 11 server-rendered style elements\n    document.querySelectorAll(\"style[data-emotion^=\\\"\" + key + \" \\\"]\"), function (node) {\n      var attrib = node.getAttribute(\"data-emotion\").split(' '); // $FlowFixMe\n\n      for (var i = 1; i < attrib.length; i++) {\n        inserted[attrib[i]] = true;\n      }\n\n      nodesToHydrate.push(node);\n    });\n  }\n\n  var _insert;\n\n  var omnipresentPlugins = [compat, removeLabel];\n\n  if (process.env.NODE_ENV !== 'production') {\n    omnipresentPlugins.push(createUnsafeSelectorsAlarm({\n      get compat() {\n        return cache.compat;\n      }\n\n    }), incorrectImportAlarm);\n  }\n\n  {\n    var currentSheet;\n    var finalizingPlugins = [stringify, process.env.NODE_ENV !== 'production' ? function (element) {\n      if (!element.root) {\n        if (element[\"return\"]) {\n          currentSheet.insert(element[\"return\"]);\n        } else if (element.value && element.type !== COMMENT) {\n          // insert empty rule in non-production environments\n          // so @emotion/jest can grab `key` from the (JS)DOM for caches without any rules inserted yet\n          currentSheet.insert(element.value + \"{}\");\n        }\n      }\n    } : rulesheet(function (rule) {\n      currentSheet.insert(rule);\n    })];\n    var serializer = middleware(omnipresentPlugins.concat(stylisPlugins, finalizingPlugins));\n\n    var stylis = function stylis(styles) {\n      return serialize(compile(styles), serializer);\n    };\n\n    _insert = function insert(selector, serialized, sheet, shouldCache) {\n      currentSheet = sheet;\n\n      if (process.env.NODE_ENV !== 'production' && serialized.map !== undefined) {\n        currentSheet = {\n          insert: function insert(rule) {\n            sheet.insert(rule + serialized.map);\n          }\n        };\n      }\n\n      stylis(selector ? selector + \"{\" + serialized.styles + \"}\" : serialized.styles);\n\n      if (shouldCache) {\n        cache.inserted[serialized.name] = true;\n      }\n    };\n  }\n\n  var cache = {\n    key: key,\n    sheet: new StyleSheet({\n      key: key,\n      container: container,\n      nonce: options.nonce,\n      speedy: options.speedy,\n      prepend: options.prepend,\n      insertionPoint: options.insertionPoint\n    }),\n    nonce: options.nonce,\n    inserted: inserted,\n    registered: {},\n    insert: _insert\n  };\n  cache.sheet.hydrate(nodesToHydrate);\n  return cache;\n};\n\nexport { createCache as default };\n","/*\n\nBased off glamor's StyleSheet, thanks Sunil \n\nhigh performance StyleSheet for css-in-js systems\n\n- uses multiple style tags behind the scenes for millions of rules\n- uses `insertRule` for appending in production for *much* faster performance\n\n// usage\n\nimport { StyleSheet } from '@emotion/sheet'\n\nlet styleSheet = new StyleSheet({ key: '', container: document.head })\n\nstyleSheet.insert('#box { border: 1px solid red; }')\n- appends a css rule into the stylesheet\n\nstyleSheet.flush()\n- empties the stylesheet of all its contents\n\n*/\n// $FlowFixMe\nfunction sheetForTag(tag) {\n  if (tag.sheet) {\n    // $FlowFixMe\n    return tag.sheet;\n  } // this weirdness brought to you by firefox\n\n  /* istanbul ignore next */\n\n\n  for (var i = 0; i < document.styleSheets.length; i++) {\n    if (document.styleSheets[i].ownerNode === tag) {\n      // $FlowFixMe\n      return document.styleSheets[i];\n    }\n  }\n}\n\nfunction createStyleElement(options) {\n  var tag = document.createElement('style');\n  tag.setAttribute('data-emotion', options.key);\n\n  if (options.nonce !== undefined) {\n    tag.setAttribute('nonce', options.nonce);\n  }\n\n  tag.appendChild(document.createTextNode(''));\n  tag.setAttribute('data-s', '');\n  return tag;\n}\n\nvar StyleSheet = /*#__PURE__*/function () {\n  // Using Node instead of HTMLElement since container may be a ShadowRoot\n  function StyleSheet(options) {\n    var _this = this;\n\n    this._insertTag = function (tag) {\n      var before;\n\n      if (_this.tags.length === 0) {\n        if (_this.insertionPoint) {\n          before = _this.insertionPoint.nextSibling;\n        } else if (_this.prepend) {\n          before = _this.container.firstChild;\n        } else {\n          before = _this.before;\n        }\n      } else {\n        before = _this.tags[_this.tags.length - 1].nextSibling;\n      }\n\n      _this.container.insertBefore(tag, before);\n\n      _this.tags.push(tag);\n    };\n\n    this.isSpeedy = options.speedy === undefined ? process.env.NODE_ENV === 'production' : options.speedy;\n    this.tags = [];\n    this.ctr = 0;\n    this.nonce = options.nonce; // key is the value of the data-emotion attribute, it's used to identify different sheets\n\n    this.key = options.key;\n    this.container = options.container;\n    this.prepend = options.prepend;\n    this.insertionPoint = options.insertionPoint;\n    this.before = null;\n  }\n\n  var _proto = StyleSheet.prototype;\n\n  _proto.hydrate = function hydrate(nodes) {\n    nodes.forEach(this._insertTag);\n  };\n\n  _proto.insert = function insert(rule) {\n    // the max length is how many rules we have per style tag, it's 65000 in speedy mode\n    // it's 1 in dev because we insert source maps that map a single rule to a location\n    // and you can only have one source map per style tag\n    if (this.ctr % (this.isSpeedy ? 65000 : 1) === 0) {\n      this._insertTag(createStyleElement(this));\n    }\n\n    var tag = this.tags[this.tags.length - 1];\n\n    if (process.env.NODE_ENV !== 'production') {\n      var isImportRule = rule.charCodeAt(0) === 64 && rule.charCodeAt(1) === 105;\n\n      if (isImportRule && this._alreadyInsertedOrderInsensitiveRule) {\n        // this would only cause problem in speedy mode\n        // but we don't want enabling speedy to affect the observable behavior\n        // so we report this error at all times\n        console.error(\"You're attempting to insert the following rule:\\n\" + rule + '\\n\\n`@import` rules must be before all other types of rules in a stylesheet but other rules have already been inserted. Please ensure that `@import` rules are before all other rules.');\n      }\n      this._alreadyInsertedOrderInsensitiveRule = this._alreadyInsertedOrderInsensitiveRule || !isImportRule;\n    }\n\n    if (this.isSpeedy) {\n      var sheet = sheetForTag(tag);\n\n      try {\n        // this is the ultrafast version, works across browsers\n        // the big drawback is that the css won't be editable in devtools\n        sheet.insertRule(rule, sheet.cssRules.length);\n      } catch (e) {\n        if (process.env.NODE_ENV !== 'production' && !/:(-moz-placeholder|-moz-focus-inner|-moz-focusring|-ms-input-placeholder|-moz-read-write|-moz-read-only|-ms-clear|-ms-expand|-ms-reveal){/.test(rule)) {\n          console.error(\"There was a problem inserting the following rule: \\\"\" + rule + \"\\\"\", e);\n        }\n      }\n    } else {\n      tag.appendChild(document.createTextNode(rule));\n    }\n\n    this.ctr++;\n  };\n\n  _proto.flush = function flush() {\n    // $FlowFixMe\n    this.tags.forEach(function (tag) {\n      return tag.parentNode && tag.parentNode.removeChild(tag);\n    });\n    this.tags = [];\n    this.ctr = 0;\n\n    if (process.env.NODE_ENV !== 'production') {\n      this._alreadyInsertedOrderInsensitiveRule = false;\n    }\n  };\n\n  return StyleSheet;\n}();\n\nexport { StyleSheet };\n","var e=\"-ms-\";var r=\"-moz-\";var a=\"-webkit-\";var n=\"comm\";var c=\"rule\";var s=\"decl\";var t=\"@page\";var u=\"@media\";var i=\"@import\";var f=\"@charset\";var o=\"@viewport\";var l=\"@supports\";var v=\"@document\";var p=\"@namespace\";var h=\"@keyframes\";var b=\"@font-face\";var w=\"@counter-style\";var d=\"@font-feature-values\";var $=\"@layer\";var g=Math.abs;var k=String.fromCharCode;var m=Object.assign;function x(e,r){return O(e,0)^45?(((r<<2^O(e,0))<<2^O(e,1))<<2^O(e,2))<<2^O(e,3):0}function y(e){return e.trim()}function j(e,r){return(e=r.exec(e))?e[0]:e}function z(e,r,a){return e.replace(r,a)}function C(e,r){return e.indexOf(r)}function O(e,r){return e.charCodeAt(r)|0}function A(e,r,a){return e.slice(r,a)}function M(e){return e.length}function S(e){return e.length}function q(e,r){return r.push(e),e}function B(e,r){return e.map(r).join(\"\")}var D=1;var E=1;var F=0;var G=0;var H=0;var I=\"\";function J(e,r,a,n,c,s,t){return{value:e,root:r,parent:a,type:n,props:c,children:s,line:D,column:E,length:t,return:\"\"}}function K(e,r){return m(J(\"\",null,null,\"\",null,null,0),e,{length:-e.length},r)}function L(){return H}function N(){H=G>0?O(I,--G):0;if(E--,H===10)E=1,D--;return H}function P(){H=G<F?O(I,G++):0;if(E++,H===10)E=1,D++;return H}function Q(){return O(I,G)}function R(){return G}function T(e,r){return A(I,e,r)}function U(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function V(e){return D=E=1,F=M(I=e),G=0,[]}function W(e){return I=\"\",e}function X(e){return y(T(G-1,re(e===91?e+2:e===40?e+1:e)))}function Y(e){return W(_(V(e)))}function Z(e){while(H=Q())if(H<33)P();else break;return U(e)>2||U(H)>3?\"\":\" \"}function _(e){while(P())switch(U(H)){case 0:q(ne(G-1),e);break;case 2:q(X(H),e);break;default:q(k(H),e)}return e}function ee(e,r){while(--r&&P())if(H<48||H>102||H>57&&H<65||H>70&&H<97)break;return T(e,R()+(r<6&&Q()==32&&P()==32))}function re(e){while(P())switch(H){case e:return G;case 34:case 39:if(e!==34&&e!==39)re(H);break;case 40:if(e===41)re(e);break;case 92:P();break}return G}function ae(e,r){while(P())if(e+H===47+10)break;else if(e+H===42+42&&Q()===47)break;return\"/*\"+T(r,G-1)+\"*\"+k(e===47?e:P())}function ne(e){while(!U(Q()))P();return T(e,G)}function ce(e){return W(se(\"\",null,null,null,[\"\"],e=V(e),0,[0],e))}function se(e,r,a,n,c,s,t,u,i){var f=0;var o=0;var l=t;var v=0;var p=0;var h=0;var b=1;var w=1;var d=1;var $=0;var g=\"\";var m=c;var x=s;var y=n;var j=g;while(w)switch(h=$,$=P()){case 40:if(h!=108&&O(j,l-1)==58){if(C(j+=z(X($),\"&\",\"&\\f\"),\"&\\f\")!=-1)d=-1;break}case 34:case 39:case 91:j+=X($);break;case 9:case 10:case 13:case 32:j+=Z(h);break;case 92:j+=ee(R()-1,7);continue;case 47:switch(Q()){case 42:case 47:q(ue(ae(P(),R()),r,a),i);break;default:j+=\"/\"}break;case 123*b:u[f++]=M(j)*d;case 125*b:case 59:case 0:switch($){case 0:case 125:w=0;case 59+o:if(d==-1)j=z(j,/\\f/g,\"\");if(p>0&&M(j)-l)q(p>32?ie(j+\";\",n,a,l-1):ie(z(j,\" \",\"\")+\";\",n,a,l-2),i);break;case 59:j+=\";\";default:q(y=te(j,r,a,f,o,c,u,g,m=[],x=[],l),s);if($===123)if(o===0)se(j,r,y,y,m,s,l,u,x);else switch(v===99&&O(j,3)===110?100:v){case 100:case 108:case 109:case 115:se(e,y,y,n&&q(te(e,y,y,0,0,c,u,g,c,m=[],l),x),c,x,l,u,n?m:x);break;default:se(j,y,y,y,[\"\"],x,0,u,x)}}f=o=p=0,b=d=1,g=j=\"\",l=t;break;case 58:l=1+M(j),p=h;default:if(b<1)if($==123)--b;else if($==125&&b++==0&&N()==125)continue;switch(j+=k($),$*b){case 38:d=o>0?1:(j+=\"\\f\",-1);break;case 44:u[f++]=(M(j)-1)*d,d=1;break;case 64:if(Q()===45)j+=X(P());v=Q(),o=l=M(g=j+=ne(R())),$++;break;case 45:if(h===45&&M(j)==2)b=0}}return s}function te(e,r,a,n,s,t,u,i,f,o,l){var v=s-1;var p=s===0?t:[\"\"];var h=S(p);for(var b=0,w=0,d=0;b<n;++b)for(var $=0,k=A(e,v+1,v=g(w=u[b])),m=e;$<h;++$)if(m=y(w>0?p[$]+\" \"+k:z(k,/&\\f/g,p[$])))f[d++]=m;return J(e,r,a,s===0?c:i,f,o,l)}function ue(e,r,a){return J(e,r,a,n,k(L()),A(e,2,-2),0)}function ie(e,r,a,n){return J(e,r,a,s,A(e,0,n),A(e,n+1,-1),n)}function fe(n,c,s){switch(x(n,c)){case 5103:return a+\"print-\"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return a+n+n;case 4789:return r+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return a+n+r+n+e+n+n;case 5936:switch(O(n,c+11)){case 114:return a+n+e+z(n,/[svh]\\w+-[tblr]{2}/,\"tb\")+n;case 108:return a+n+e+z(n,/[svh]\\w+-[tblr]{2}/,\"tb-rl\")+n;case 45:return a+n+e+z(n,/[svh]\\w+-[tblr]{2}/,\"lr\")+n}case 6828:case 4268:case 2903:return a+n+e+n+n;case 6165:return a+n+e+\"flex-\"+n+n;case 5187:return a+n+z(n,/(\\w+).+(:[^]+)/,a+\"box-$1$2\"+e+\"flex-$1$2\")+n;case 5443:return a+n+e+\"flex-item-\"+z(n,/flex-|-self/g,\"\")+(!j(n,/flex-|baseline/)?e+\"grid-row-\"+z(n,/flex-|-self/g,\"\"):\"\")+n;case 4675:return a+n+e+\"flex-line-pack\"+z(n,/align-content|flex-|-self/g,\"\")+n;case 5548:return a+n+e+z(n,\"shrink\",\"negative\")+n;case 5292:return a+n+e+z(n,\"basis\",\"preferred-size\")+n;case 6060:return a+\"box-\"+z(n,\"-grow\",\"\")+a+n+e+z(n,\"grow\",\"positive\")+n;case 4554:return a+z(n,/([^-])(transform)/g,\"$1\"+a+\"$2\")+n;case 6187:return z(z(z(n,/(zoom-|grab)/,a+\"$1\"),/(image-set)/,a+\"$1\"),n,\"\")+n;case 5495:case 3959:return z(n,/(image-set\\([^]*)/,a+\"$1\"+\"$`$1\");case 4968:return z(z(n,/(.+:)(flex-)?(.*)/,a+\"box-pack:$3\"+e+\"flex-pack:$3\"),/s.+-b[^;]+/,\"justify\")+a+n+n;case 4200:if(!j(n,/flex-|baseline/))return e+\"grid-column-align\"+A(n,c)+n;break;case 2592:case 3360:return e+z(n,\"template-\",\"\")+n;case 4384:case 3616:if(s&&s.some((function(e,r){return c=r,j(e.props,/grid-\\w+-end/)}))){return~C(n+(s=s[c].value),\"span\")?n:e+z(n,\"-start\",\"\")+n+e+\"grid-row-span:\"+(~C(s,\"span\")?j(s,/\\d+/):+j(s,/\\d+/)-+j(n,/\\d+/))+\";\"}return e+z(n,\"-start\",\"\")+n;case 4896:case 4128:return s&&s.some((function(e){return j(e.props,/grid-\\w+-start/)}))?n:e+z(z(n,\"-end\",\"-span\"),\"span \",\"\")+n;case 4095:case 3583:case 4068:case 2532:return z(n,/(.+)-inline(.+)/,a+\"$1$2\")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(M(n)-1-c>6)switch(O(n,c+1)){case 109:if(O(n,c+4)!==45)break;case 102:return z(n,/(.+:)(.+)-([^]+)/,\"$1\"+a+\"$2-$3\"+\"$1\"+r+(O(n,c+3)==108?\"$3\":\"$2-$3\"))+n;case 115:return~C(n,\"stretch\")?fe(z(n,\"stretch\",\"fill-available\"),c,s)+n:n}break;case 5152:case 5920:return z(n,/(.+?):(\\d+)(\\s*\\/\\s*(span)?\\s*(\\d+))?(.*)/,(function(r,a,c,s,t,u,i){return e+a+\":\"+c+i+(s?e+a+\"-span:\"+(t?u:+u-+c)+i:\"\")+n}));case 4949:if(O(n,c+6)===121)return z(n,\":\",\":\"+a)+n;break;case 6444:switch(O(n,O(n,14)===45?18:11)){case 120:return z(n,/(.+:)([^;\\s!]+)(;|(\\s+)?!.+)?/,\"$1\"+a+(O(n,14)===45?\"inline-\":\"\")+\"box$3\"+\"$1\"+a+\"$2$3\"+\"$1\"+e+\"$2box$3\")+n;case 100:return z(n,\":\",\":\"+e)+n}break;case 5719:case 2647:case 2135:case 3927:case 2391:return z(n,\"scroll-\",\"scroll-snap-\")+n}return n}function oe(e,r){var a=\"\";var n=S(e);for(var c=0;c<n;c++)a+=r(e[c],c,e,r)||\"\";return a}function le(e,r,a,t){switch(e.type){case $:if(e.children.length)break;case i:case s:return e.return=e.return||e.value;case n:return\"\";case h:return e.return=e.value+\"{\"+oe(e.children,t)+\"}\";case c:e.value=e.props.join(\",\")}return M(a=oe(e.children,t))?e.return=e.value+\"{\"+a+\"}\":\"\"}function ve(e){var r=S(e);return function(a,n,c,s){var t=\"\";for(var u=0;u<r;u++)t+=e[u](a,n,c,s)||\"\";return t}}function pe(e){return function(r){if(!r.root)if(r=r.return)e(r)}}function he(n,t,u,i){if(n.length>-1)if(!n.return)switch(n.type){case s:n.return=fe(n.value,n.length,u);return;case h:return oe([K(n,{value:z(n.value,\"@\",\"@\"+a)})],i);case c:if(n.length)return B(n.props,(function(c){switch(j(c,/(::plac\\w+|:read-\\w+)/)){case\":read-only\":case\":read-write\":return oe([K(n,{props:[z(c,/:(read-\\w+)/,\":\"+r+\"$1\")]})],i);case\"::placeholder\":return oe([K(n,{props:[z(c,/:(plac\\w+)/,\":\"+a+\"input-$1\")]}),K(n,{props:[z(c,/:(plac\\w+)/,\":\"+r+\"$1\")]}),K(n,{props:[z(c,/:(plac\\w+)/,e+\"input-$1\")]})],i)}return\"\"}))}}function be(e){switch(e.type){case c:e.props=e.props.map((function(r){return B(Y(r),(function(r,a,n){switch(O(r,0)){case 12:return A(r,1,M(r));case 0:case 40:case 43:case 62:case 126:return r;case 58:if(n[++a]===\"global\")n[a]=\"\",n[++a]=\"\\f\"+A(n[a],a=1,-1);case 32:return a===1?\"\":r;default:switch(a){case 0:e=r;return S(n)>1?\"\":r;case a=S(n)-1:case 2:return a===2?r+e+e:r+e;default:return r}}}))}))}}export{f as CHARSET,n as COMMENT,w as COUNTER_STYLE,s as DECLARATION,v as DOCUMENT,b as FONT_FACE,d as FONT_FEATURE_VALUES,i as IMPORT,h as KEYFRAMES,$ as LAYER,u as MEDIA,r as MOZ,e as MS,p as NAMESPACE,t as PAGE,c as RULESET,l as SUPPORTS,o as VIEWPORT,a as WEBKIT,g as abs,V as alloc,q as append,m as assign,R as caret,L as char,H as character,I as characters,O as charat,E as column,B as combine,ue as comment,ae as commenter,ce as compile,K as copy,W as dealloc,ie as declaration,X as delimit,re as delimiter,ee as escaping,k as from,x as hash,ne as identifier,C as indexof,F as length,D as line,j as match,ve as middleware,be as namespace,P as next,J as node,se as parse,Q as peek,G as position,fe as prefix,he as prefixer,N as prev,z as replace,te as ruleset,pe as rulesheet,oe as serialize,S as sizeof,T as slice,le as stringify,M as strlen,A as substr,U as token,Y as tokenize,_ as tokenizer,y as trim,Z as whitespace};\n//# sourceMappingURL=stylis.mjs.map\n","export var MS = '-ms-'\nexport var MOZ = '-moz-'\nexport var WEBKIT = '-webkit-'\n\nexport var COMMENT = 'comm'\nexport var RULESET = 'rule'\nexport var DECLARATION = 'decl'\n\nexport var PAGE = '@page'\nexport var MEDIA = '@media'\nexport var IMPORT = '@import'\nexport var CHARSET = '@charset'\nexport var VIEWPORT = '@viewport'\nexport var SUPPORTS = '@supports'\nexport var DOCUMENT = '@document'\nexport var NAMESPACE = '@namespace'\nexport var KEYFRAMES = '@keyframes'\nexport var FONT_FACE = '@font-face'\nexport var COUNTER_STYLE = '@counter-style'\nexport var FONT_FEATURE_VALUES = '@font-feature-values'\nexport var LAYER = '@layer'\n","/**\n * @param {number}\n * @return {number}\n */\nexport var abs = Math.abs\n\n/**\n * @param {number}\n * @return {string}\n */\nexport var from = String.fromCharCode\n\n/**\n * @param {object}\n * @return {object}\n */\nexport var assign = Object.assign\n\n/**\n * @param {string} value\n * @param {number} length\n * @return {number}\n */\nexport function hash (value, length) {\n\treturn charat(value, 0) ^ 45 ? (((((((length << 2) ^ charat(value, 0)) << 2) ^ charat(value, 1)) << 2) ^ charat(value, 2)) << 2) ^ charat(value, 3) : 0\n}\n\n/**\n * @param {string} value\n * @return {string}\n */\nexport function trim (value) {\n\treturn value.trim()\n}\n\n/**\n * @param {string} value\n * @param {RegExp} pattern\n * @return {string?}\n */\nexport function match (value, pattern) {\n\treturn (value = pattern.exec(value)) ? value[0] : value\n}\n\n/**\n * @param {string} value\n * @param {(string|RegExp)} pattern\n * @param {string} replacement\n * @return {string}\n */\nexport function replace (value, pattern, replacement) {\n\treturn value.replace(pattern, replacement)\n}\n\n/**\n * @param {string} value\n * @param {string} search\n * @return {number}\n */\nexport function indexof (value, search) {\n\treturn value.indexOf(search)\n}\n\n/**\n * @param {string} value\n * @param {number} index\n * @return {number}\n */\nexport function charat (value, index) {\n\treturn value.charCodeAt(index) | 0\n}\n\n/**\n * @param {string} value\n * @param {number} begin\n * @param {number} end\n * @return {string}\n */\nexport function substr (value, begin, end) {\n\treturn value.slice(begin, end)\n}\n\n/**\n * @param {string} value\n * @return {number}\n */\nexport function strlen (value) {\n\treturn value.length\n}\n\n/**\n * @param {any[]} value\n * @return {number}\n */\nexport function sizeof (value) {\n\treturn value.length\n}\n\n/**\n * @param {any} value\n * @param {any[]} array\n * @return {any}\n */\nexport function append (value, array) {\n\treturn array.push(value), value\n}\n\n/**\n * @param {string[]} array\n * @param {function} callback\n * @return {string}\n */\nexport function combine (array, callback) {\n\treturn array.map(callback).join('')\n}\n","import {from, trim, charat, strlen, substr, append, assign} from './Utility.js'\n\nexport var line = 1\nexport var column = 1\nexport var length = 0\nexport var position = 0\nexport var character = 0\nexport var characters = ''\n\n/**\n * @param {string} value\n * @param {object | null} root\n * @param {object | null} parent\n * @param {string} type\n * @param {string[] | string} props\n * @param {object[] | string} children\n * @param {number} length\n */\nexport function node (value, root, parent, type, props, children, length) {\n\treturn {value: value, root: root, parent: parent, type: type, props: props, children: children, line: line, column: column, length: length, return: ''}\n}\n\n/**\n * @param {object} root\n * @param {object} props\n * @return {object}\n */\nexport function copy (root, props) {\n\treturn assign(node('', null, null, '', null, null, 0), root, {length: -root.length}, props)\n}\n\n/**\n * @return {number}\n */\nexport function char () {\n\treturn character\n}\n\n/**\n * @return {number}\n */\nexport function prev () {\n\tcharacter = position > 0 ? charat(characters, --position) : 0\n\n\tif (column--, character === 10)\n\t\tcolumn = 1, line--\n\n\treturn character\n}\n\n/**\n * @return {number}\n */\nexport function next () {\n\tcharacter = position < length ? charat(characters, position++) : 0\n\n\tif (column++, character === 10)\n\t\tcolumn = 1, line++\n\n\treturn character\n}\n\n/**\n * @return {number}\n */\nexport function peek () {\n\treturn charat(characters, position)\n}\n\n/**\n * @return {number}\n */\nexport function caret () {\n\treturn position\n}\n\n/**\n * @param {number} begin\n * @param {number} end\n * @return {string}\n */\nexport function slice (begin, end) {\n\treturn substr(characters, begin, end)\n}\n\n/**\n * @param {number} type\n * @return {number}\n */\nexport function token (type) {\n\tswitch (type) {\n\t\t// \\0 \\t \\n \\r \\s whitespace token\n\t\tcase 0: case 9: case 10: case 13: case 32:\n\t\t\treturn 5\n\t\t// ! + , / > @ ~ isolate token\n\t\tcase 33: case 43: case 44: case 47: case 62: case 64: case 126:\n\t\t// ; { } breakpoint token\n\t\tcase 59: case 123: case 125:\n\t\t\treturn 4\n\t\t// : accompanied token\n\t\tcase 58:\n\t\t\treturn 3\n\t\t// \" ' ( [ opening delimit token\n\t\tcase 34: case 39: case 40: case 91:\n\t\t\treturn 2\n\t\t// ) ] closing delimit token\n\t\tcase 41: case 93:\n\t\t\treturn 1\n\t}\n\n\treturn 0\n}\n\n/**\n * @param {string} value\n * @return {any[]}\n */\nexport function alloc (value) {\n\treturn line = column = 1, length = strlen(characters = value), position = 0, []\n}\n\n/**\n * @param {any} value\n * @return {any}\n */\nexport function dealloc (value) {\n\treturn characters = '', value\n}\n\n/**\n * @param {number} type\n * @return {string}\n */\nexport function delimit (type) {\n\treturn trim(slice(position - 1, delimiter(type === 91 ? type + 2 : type === 40 ? type + 1 : type)))\n}\n\n/**\n * @param {string} value\n * @return {string[]}\n */\nexport function tokenize (value) {\n\treturn dealloc(tokenizer(alloc(value)))\n}\n\n/**\n * @param {number} type\n * @return {string}\n */\nexport function whitespace (type) {\n\twhile (character = peek())\n\t\tif (character < 33)\n\t\t\tnext()\n\t\telse\n\t\t\tbreak\n\n\treturn token(type) > 2 || token(character) > 3 ? '' : ' '\n}\n\n/**\n * @param {string[]} children\n * @return {string[]}\n */\nexport function tokenizer (children) {\n\twhile (next())\n\t\tswitch (token(character)) {\n\t\t\tcase 0: append(identifier(position - 1), children)\n\t\t\t\tbreak\n\t\t\tcase 2: append(delimit(character), children)\n\t\t\t\tbreak\n\t\t\tdefault: append(from(character), children)\n\t\t}\n\n\treturn children\n}\n\n/**\n * @param {number} index\n * @param {number} count\n * @return {string}\n */\nexport function escaping (index, count) {\n\twhile (--count && next())\n\t\t// not 0-9 A-F a-f\n\t\tif (character < 48 || character > 102 || (character > 57 && character < 65) || (character > 70 && character < 97))\n\t\t\tbreak\n\n\treturn slice(index, caret() + (count < 6 && peek() == 32 && next() == 32))\n}\n\n/**\n * @param {number} type\n * @return {number}\n */\nexport function delimiter (type) {\n\twhile (next())\n\t\tswitch (character) {\n\t\t\t// ] ) \" '\n\t\t\tcase type:\n\t\t\t\treturn position\n\t\t\t// \" '\n\t\t\tcase 34: case 39:\n\t\t\t\tif (type !== 34 && type !== 39)\n\t\t\t\t\tdelimiter(character)\n\t\t\t\tbreak\n\t\t\t// (\n\t\t\tcase 40:\n\t\t\t\tif (type === 41)\n\t\t\t\t\tdelimiter(type)\n\t\t\t\tbreak\n\t\t\t// \\\n\t\t\tcase 92:\n\t\t\t\tnext()\n\t\t\t\tbreak\n\t\t}\n\n\treturn position\n}\n\n/**\n * @param {number} type\n * @param {number} index\n * @return {number}\n */\nexport function commenter (type, index) {\n\twhile (next())\n\t\t// //\n\t\tif (type + character === 47 + 10)\n\t\t\tbreak\n\t\t// /*\n\t\telse if (type + character === 42 + 42 && peek() === 47)\n\t\t\tbreak\n\n\treturn '/*' + slice(index, position - 1) + '*' + from(type === 47 ? type : next())\n}\n\n/**\n * @param {number} index\n * @return {string}\n */\nexport function identifier (index) {\n\twhile (!token(peek()))\n\t\tnext()\n\n\treturn slice(index, position)\n}\n","import {COMMENT, RULESET, DECLARATION} from './Enum.js'\nimport {abs, charat, trim, from, sizeof, strlen, substr, append, replace, indexof} from './Utility.js'\nimport {node, char, prev, next, peek, caret, alloc, dealloc, delimit, whitespace, escaping, identifier, commenter} from './Tokenizer.js'\n\n/**\n * @param {string} value\n * @return {object[]}\n */\nexport function compile (value) {\n\treturn dealloc(parse('', null, null, null, [''], value = alloc(value), 0, [0], value))\n}\n\n/**\n * @param {string} value\n * @param {object} root\n * @param {object?} parent\n * @param {string[]} rule\n * @param {string[]} rules\n * @param {string[]} rulesets\n * @param {number[]} pseudo\n * @param {number[]} points\n * @param {string[]} declarations\n * @return {object}\n */\nexport function parse (value, root, parent, rule, rules, rulesets, pseudo, points, declarations) {\n\tvar index = 0\n\tvar offset = 0\n\tvar length = pseudo\n\tvar atrule = 0\n\tvar property = 0\n\tvar previous = 0\n\tvar variable = 1\n\tvar scanning = 1\n\tvar ampersand = 1\n\tvar character = 0\n\tvar type = ''\n\tvar props = rules\n\tvar children = rulesets\n\tvar reference = rule\n\tvar characters = type\n\n\twhile (scanning)\n\t\tswitch (previous = character, character = next()) {\n\t\t\t// (\n\t\t\tcase 40:\n\t\t\t\tif (previous != 108 && charat(characters, length - 1) == 58) {\n\t\t\t\t\tif (indexof(characters += replace(delimit(character), '&', '&\\f'), '&\\f') != -1)\n\t\t\t\t\t\tampersand = -1\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t// \" ' [\n\t\t\tcase 34: case 39: case 91:\n\t\t\t\tcharacters += delimit(character)\n\t\t\t\tbreak\n\t\t\t// \\t \\n \\r \\s\n\t\t\tcase 9: case 10: case 13: case 32:\n\t\t\t\tcharacters += whitespace(previous)\n\t\t\t\tbreak\n\t\t\t// \\\n\t\t\tcase 92:\n\t\t\t\tcharacters += escaping(caret() - 1, 7)\n\t\t\t\tcontinue\n\t\t\t// /\n\t\t\tcase 47:\n\t\t\t\tswitch (peek()) {\n\t\t\t\t\tcase 42: case 47:\n\t\t\t\t\t\tappend(comment(commenter(next(), caret()), root, parent), declarations)\n\t\t\t\t\t\tbreak\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tcharacters += '/'\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t// {\n\t\t\tcase 123 * variable:\n\t\t\t\tpoints[index++] = strlen(characters) * ampersand\n\t\t\t// } ; \\0\n\t\t\tcase 125 * variable: case 59: case 0:\n\t\t\t\tswitch (character) {\n\t\t\t\t\t// \\0 }\n\t\t\t\t\tcase 0: case 125: scanning = 0\n\t\t\t\t\t// ;\n\t\t\t\t\tcase 59 + offset: if (ampersand == -1) characters = replace(characters, /\\f/g, '')\n\t\t\t\t\t\tif (property > 0 && (strlen(characters) - length))\n\t\t\t\t\t\t\tappend(property > 32 ? declaration(characters + ';', rule, parent, length - 1) : declaration(replace(characters, ' ', '') + ';', rule, parent, length - 2), declarations)\n\t\t\t\t\t\tbreak\n\t\t\t\t\t// @ ;\n\t\t\t\t\tcase 59: characters += ';'\n\t\t\t\t\t// { rule/at-rule\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tappend(reference = ruleset(characters, root, parent, index, offset, rules, points, type, props = [], children = [], length), rulesets)\n\n\t\t\t\t\t\tif (character === 123)\n\t\t\t\t\t\t\tif (offset === 0)\n\t\t\t\t\t\t\t\tparse(characters, root, reference, reference, props, rulesets, length, points, children)\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tswitch (atrule === 99 && charat(characters, 3) === 110 ? 100 : atrule) {\n\t\t\t\t\t\t\t\t\t// d l m s\n\t\t\t\t\t\t\t\t\tcase 100: case 108: case 109: case 115:\n\t\t\t\t\t\t\t\t\t\tparse(value, reference, reference, rule && append(ruleset(value, reference, reference, 0, 0, rules, points, type, rules, props = [], length), children), rules, children, length, points, rule ? props : children)\n\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\tparse(characters, reference, reference, reference, [''], children, 0, points, children)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tindex = offset = property = 0, variable = ampersand = 1, type = characters = '', length = pseudo\n\t\t\t\tbreak\n\t\t\t// :\n\t\t\tcase 58:\n\t\t\t\tlength = 1 + strlen(characters), property = previous\n\t\t\tdefault:\n\t\t\t\tif (variable < 1)\n\t\t\t\t\tif (character == 123)\n\t\t\t\t\t\t--variable\n\t\t\t\t\telse if (character == 125 && variable++ == 0 && prev() == 125)\n\t\t\t\t\t\tcontinue\n\n\t\t\t\tswitch (characters += from(character), character * variable) {\n\t\t\t\t\t// &\n\t\t\t\t\tcase 38:\n\t\t\t\t\t\tampersand = offset > 0 ? 1 : (characters += '\\f', -1)\n\t\t\t\t\t\tbreak\n\t\t\t\t\t// ,\n\t\t\t\t\tcase 44:\n\t\t\t\t\t\tpoints[index++] = (strlen(characters) - 1) * ampersand, ampersand = 1\n\t\t\t\t\t\tbreak\n\t\t\t\t\t// @\n\t\t\t\t\tcase 64:\n\t\t\t\t\t\t// -\n\t\t\t\t\t\tif (peek() === 45)\n\t\t\t\t\t\t\tcharacters += delimit(next())\n\n\t\t\t\t\t\tatrule = peek(), offset = length = strlen(type = characters += identifier(caret())), character++\n\t\t\t\t\t\tbreak\n\t\t\t\t\t// -\n\t\t\t\t\tcase 45:\n\t\t\t\t\t\tif (previous === 45 && strlen(characters) == 2)\n\t\t\t\t\t\t\tvariable = 0\n\t\t\t\t}\n\t\t}\n\n\treturn rulesets\n}\n\n/**\n * @param {string} value\n * @param {object} root\n * @param {object?} parent\n * @param {number} index\n * @param {number} offset\n * @param {string[]} rules\n * @param {number[]} points\n * @param {string} type\n * @param {string[]} props\n * @param {string[]} children\n * @param {number} length\n * @return {object}\n */\nexport function ruleset (value, root, parent, index, offset, rules, points, type, props, children, length) {\n\tvar post = offset - 1\n\tvar rule = offset === 0 ? rules : ['']\n\tvar size = sizeof(rule)\n\n\tfor (var i = 0, j = 0, k = 0; i < index; ++i)\n\t\tfor (var x = 0, y = substr(value, post + 1, post = abs(j = points[i])), z = value; x < size; ++x)\n\t\t\tif (z = trim(j > 0 ? rule[x] + ' ' + y : replace(y, /&\\f/g, rule[x])))\n\t\t\t\tprops[k++] = z\n\n\treturn node(value, root, parent, offset === 0 ? RULESET : type, props, children, length)\n}\n\n/**\n * @param {number} value\n * @param {object} root\n * @param {object?} parent\n * @return {object}\n */\nexport function comment (value, root, parent) {\n\treturn node(value, root, parent, COMMENT, from(char()), substr(value, 2, -2), 0)\n}\n\n/**\n * @param {string} value\n * @param {object} root\n * @param {object?} parent\n * @param {number} length\n * @return {object}\n */\nexport function declaration (value, root, parent, length) {\n\treturn node(value, root, parent, DECLARATION, substr(value, 0, length), substr(value, length + 1, -1), length)\n}\n","import {MS, MOZ, WEBKIT} from './Enum.js'\nimport {hash, charat, strlen, indexof, replace, substr, match} from './Utility.js'\n\n/**\n * @param {string} value\n * @param {number} length\n * @param {object[]} children\n * @return {string}\n */\nexport function prefix (value, length, children) {\n\tswitch (hash(value, length)) {\n\t\t// color-adjust\n\t\tcase 5103:\n\t\t\treturn WEBKIT + 'print-' + value + value\n\t\t// animation, animation-(delay|direction|duration|fill-mode|iteration-count|name|play-state|timing-function)\n\t\tcase 5737: case 4201: case 3177: case 3433: case 1641: case 4457: case 2921:\n\t\t// text-decoration, filter, clip-path, backface-visibility, column, box-decoration-break\n\t\tcase 5572: case 6356: case 5844: case 3191: case 6645: case 3005:\n\t\t// mask, mask-image, mask-(mode|clip|size), mask-(repeat|origin), mask-position, mask-composite,\n\t\tcase 6391: case 5879: case 5623: case 6135: case 4599: case 4855:\n\t\t// background-clip, columns, column-(count|fill|gap|rule|rule-color|rule-style|rule-width|span|width)\n\t\tcase 4215: case 6389: case 5109: case 5365: case 5621: case 3829:\n\t\t\treturn WEBKIT + value + value\n\t\t// tab-size\n\t\tcase 4789:\n\t\t\treturn MOZ + value + value\n\t\t// appearance, user-select, transform, hyphens, text-size-adjust\n\t\tcase 5349: case 4246: case 4810: case 6968: case 2756:\n\t\t\treturn WEBKIT + value + MOZ + value + MS + value + value\n\t\t// writing-mode\n\t\tcase 5936:\n\t\t\tswitch (charat(value, length + 11)) {\n\t\t\t\t// vertical-l(r)\n\t\t\t\tcase 114:\n\t\t\t\t\treturn WEBKIT + value + MS + replace(value, /[svh]\\w+-[tblr]{2}/, 'tb') + value\n\t\t\t\t// vertical-r(l)\n\t\t\t\tcase 108:\n\t\t\t\t\treturn WEBKIT + value + MS + replace(value, /[svh]\\w+-[tblr]{2}/, 'tb-rl') + value\n\t\t\t\t// horizontal(-)tb\n\t\t\t\tcase 45:\n\t\t\t\t\treturn WEBKIT + value + MS + replace(value, /[svh]\\w+-[tblr]{2}/, 'lr') + value\n\t\t\t\t// default: fallthrough to below\n\t\t\t}\n\t\t// flex, flex-direction, scroll-snap-type, writing-mode\n\t\tcase 6828: case 4268: case 2903:\n\t\t\treturn WEBKIT + value + MS + value + value\n\t\t// order\n\t\tcase 6165:\n\t\t\treturn WEBKIT + value + MS + 'flex-' + value + value\n\t\t// align-items\n\t\tcase 5187:\n\t\t\treturn WEBKIT + value + replace(value, /(\\w+).+(:[^]+)/, WEBKIT + 'box-$1$2' + MS + 'flex-$1$2') + value\n\t\t// align-self\n\t\tcase 5443:\n\t\t\treturn WEBKIT + value + MS + 'flex-item-' + replace(value, /flex-|-self/g, '') + (!match(value, /flex-|baseline/) ? MS + 'grid-row-' + replace(value, /flex-|-self/g, '') : '') + value\n\t\t// align-content\n\t\tcase 4675:\n\t\t\treturn WEBKIT + value + MS + 'flex-line-pack' + replace(value, /align-content|flex-|-self/g, '') + value\n\t\t// flex-shrink\n\t\tcase 5548:\n\t\t\treturn WEBKIT + value + MS + replace(value, 'shrink', 'negative') + value\n\t\t// flex-basis\n\t\tcase 5292:\n\t\t\treturn WEBKIT + value + MS + replace(value, 'basis', 'preferred-size') + value\n\t\t// flex-grow\n\t\tcase 6060:\n\t\t\treturn WEBKIT + 'box-' + replace(value, '-grow', '') + WEBKIT + value + MS + replace(value, 'grow', 'positive') + value\n\t\t// transition\n\t\tcase 4554:\n\t\t\treturn WEBKIT + replace(value, /([^-])(transform)/g, '$1' + WEBKIT + '$2') + value\n\t\t// cursor\n\t\tcase 6187:\n\t\t\treturn replace(replace(replace(value, /(zoom-|grab)/, WEBKIT + '$1'), /(image-set)/, WEBKIT + '$1'), value, '') + value\n\t\t// background, background-image\n\t\tcase 5495: case 3959:\n\t\t\treturn replace(value, /(image-set\\([^]*)/, WEBKIT + '$1' + '$`$1')\n\t\t// justify-content\n\t\tcase 4968:\n\t\t\treturn replace(replace(value, /(.+:)(flex-)?(.*)/, WEBKIT + 'box-pack:$3' + MS + 'flex-pack:$3'), /s.+-b[^;]+/, 'justify') + WEBKIT + value + value\n\t\t// justify-self\n\t\tcase 4200:\n\t\t\tif (!match(value, /flex-|baseline/)) return MS + 'grid-column-align' + substr(value, length) + value\n\t\t\tbreak\n\t\t// grid-template-(columns|rows)\n\t\tcase 2592: case 3360:\n\t\t\treturn MS + replace(value, 'template-', '') + value\n\t\t// grid-(row|column)-start\n\t\tcase 4384: case 3616:\n\t\t\tif (children && children.some(function (element, index) { return length = index, match(element.props, /grid-\\w+-end/) })) {\n\t\t\t\treturn ~indexof(value + (children = children[length].value), 'span') ? value : (MS + replace(value, '-start', '') + value + MS + 'grid-row-span:' + (~indexof(children, 'span') ? match(children, /\\d+/) : +match(children, /\\d+/) - +match(value, /\\d+/)) + ';')\n\t\t\t}\n\t\t\treturn MS + replace(value, '-start', '') + value\n\t\t// grid-(row|column)-end\n\t\tcase 4896: case 4128:\n\t\t\treturn (children && children.some(function (element) { return match(element.props, /grid-\\w+-start/) })) ? value : MS + replace(replace(value, '-end', '-span'), 'span ', '') + value\n\t\t// (margin|padding)-inline-(start|end)\n\t\tcase 4095: case 3583: case 4068: case 2532:\n\t\t\treturn replace(value, /(.+)-inline(.+)/, WEBKIT + '$1$2') + value\n\t\t// (min|max)?(width|height|inline-size|block-size)\n\t\tcase 8116: case 7059: case 5753: case 5535:\n\t\tcase 5445: case 5701: case 4933: case 4677:\n\t\tcase 5533: case 5789: case 5021: case 4765:\n\t\t\t// stretch, max-content, min-content, fill-available\n\t\t\tif (strlen(value) - 1 - length > 6)\n\t\t\t\tswitch (charat(value, length + 1)) {\n\t\t\t\t\t// (m)ax-content, (m)in-content\n\t\t\t\t\tcase 109:\n\t\t\t\t\t\t// -\n\t\t\t\t\t\tif (charat(value, length + 4) !== 45)\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t// (f)ill-available, (f)it-content\n\t\t\t\t\tcase 102:\n\t\t\t\t\t\treturn replace(value, /(.+:)(.+)-([^]+)/, '$1' + WEBKIT + '$2-$3' + '$1' + MOZ + (charat(value, length + 3) == 108 ? '$3' : '$2-$3')) + value\n\t\t\t\t\t// (s)tretch\n\t\t\t\t\tcase 115:\n\t\t\t\t\t\treturn ~indexof(value, 'stretch') ? prefix(replace(value, 'stretch', 'fill-available'), length, children) + value : value\n\t\t\t\t}\n\t\t\tbreak\n\t\t// grid-(column|row)\n\t\tcase 5152: case 5920:\n\t\t\treturn replace(value, /(.+?):(\\d+)(\\s*\\/\\s*(span)?\\s*(\\d+))?(.*)/, function (_, a, b, c, d, e, f) { return (MS + a + ':' + b + f) + (c ? (MS + a + '-span:' + (d ? e : +e - +b)) + f : '') + value })\n\t\t// position: sticky\n\t\tcase 4949:\n\t\t\t// stick(y)?\n\t\t\tif (charat(value, length + 6) === 121)\n\t\t\t\treturn replace(value, ':', ':' + WEBKIT) + value\n\t\t\tbreak\n\t\t// display: (flex|inline-flex|grid|inline-grid)\n\t\tcase 6444:\n\t\t\tswitch (charat(value, charat(value, 14) === 45 ? 18 : 11)) {\n\t\t\t\t// (inline-)?fle(x)\n\t\t\t\tcase 120:\n\t\t\t\t\treturn replace(value, /(.+:)([^;\\s!]+)(;|(\\s+)?!.+)?/, '$1' + WEBKIT + (charat(value, 14) === 45 ? 'inline-' : '') + 'box$3' + '$1' + WEBKIT + '$2$3' + '$1' + MS + '$2box$3') + value\n\t\t\t\t// (inline-)?gri(d)\n\t\t\t\tcase 100:\n\t\t\t\t\treturn replace(value, ':', ':' + MS) + value\n\t\t\t}\n\t\t\tbreak\n\t\t// scroll-margin, scroll-margin-(top|right|bottom|left)\n\t\tcase 5719: case 2647: case 2135: case 3927: case 2391:\n\t\t\treturn replace(value, 'scroll-', 'scroll-snap-') + value\n\t}\n\n\treturn value\n}\n","import {IMPORT, LAYER, COMMENT, RULESET, DECLARATION, KEYFRAMES} from './Enum.js'\nimport {strlen, sizeof} from './Utility.js'\n\n/**\n * @param {object[]} children\n * @param {function} callback\n * @return {string}\n */\nexport function serialize (children, callback) {\n\tvar output = ''\n\tvar length = sizeof(children)\n\n\tfor (var i = 0; i < length; i++)\n\t\toutput += callback(children[i], i, children, callback) || ''\n\n\treturn output\n}\n\n/**\n * @param {object} element\n * @param {number} index\n * @param {object[]} children\n * @param {function} callback\n * @return {string}\n */\nexport function stringify (element, index, children, callback) {\n\tswitch (element.type) {\n\t\tcase LAYER: if (element.children.length) break\n\t\tcase IMPORT: case DECLARATION: return element.return = element.return || element.value\n\t\tcase COMMENT: return ''\n\t\tcase KEYFRAMES: return element.return = element.value + '{' + serialize(element.children, callback) + '}'\n\t\tcase RULESET: element.value = element.props.join(',')\n\t}\n\n\treturn strlen(children = serialize(element.children, callback)) ? element.return = element.value + '{' + children + '}' : ''\n}\n","import {MS, MOZ, WEBKIT, RULESET, KEYFRAMES, DECLARATION} from './Enum.js'\nimport {match, charat, substr, strlen, sizeof, replace, combine} from './Utility.js'\nimport {copy, tokenize} from './Tokenizer.js'\nimport {serialize} from './Serializer.js'\nimport {prefix} from './Prefixer.js'\n\n/**\n * @param {function[]} collection\n * @return {function}\n */\nexport function middleware (collection) {\n\tvar length = sizeof(collection)\n\n\treturn function (element, index, children, callback) {\n\t\tvar output = ''\n\n\t\tfor (var i = 0; i < length; i++)\n\t\t\toutput += collection[i](element, index, children, callback) || ''\n\n\t\treturn output\n\t}\n}\n\n/**\n * @param {function} callback\n * @return {function}\n */\nexport function rulesheet (callback) {\n\treturn function (element) {\n\t\tif (!element.root)\n\t\t\tif (element = element.return)\n\t\t\t\tcallback(element)\n\t}\n}\n\n/**\n * @param {object} element\n * @param {number} index\n * @param {object[]} children\n * @param {function} callback\n */\nexport function prefixer (element, index, children, callback) {\n\tif (element.length > -1)\n\t\tif (!element.return)\n\t\t\tswitch (element.type) {\n\t\t\t\tcase DECLARATION: element.return = prefix(element.value, element.length, children)\n\t\t\t\t\treturn\n\t\t\t\tcase KEYFRAMES:\n\t\t\t\t\treturn serialize([copy(element, {value: replace(element.value, '@', '@' + WEBKIT)})], callback)\n\t\t\t\tcase RULESET:\n\t\t\t\t\tif (element.length)\n\t\t\t\t\t\treturn combine(element.props, function (value) {\n\t\t\t\t\t\t\tswitch (match(value, /(::plac\\w+|:read-\\w+)/)) {\n\t\t\t\t\t\t\t\t// :read-(only|write)\n\t\t\t\t\t\t\t\tcase ':read-only': case ':read-write':\n\t\t\t\t\t\t\t\t\treturn serialize([copy(element, {props: [replace(value, /:(read-\\w+)/, ':' + MOZ + '$1')]})], callback)\n\t\t\t\t\t\t\t\t// :placeholder\n\t\t\t\t\t\t\t\tcase '::placeholder':\n\t\t\t\t\t\t\t\t\treturn serialize([\n\t\t\t\t\t\t\t\t\t\tcopy(element, {props: [replace(value, /:(plac\\w+)/, ':' + WEBKIT + 'input-$1')]}),\n\t\t\t\t\t\t\t\t\t\tcopy(element, {props: [replace(value, /:(plac\\w+)/, ':' + MOZ + '$1')]}),\n\t\t\t\t\t\t\t\t\t\tcopy(element, {props: [replace(value, /:(plac\\w+)/, MS + 'input-$1')]})\n\t\t\t\t\t\t\t\t\t], callback)\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn ''\n\t\t\t\t\t\t})\n\t\t\t}\n}\n\n/**\n * @param {object} element\n * @param {number} index\n * @param {object[]} children\n */\nexport function namespace (element) {\n\tswitch (element.type) {\n\t\tcase RULESET:\n\t\t\telement.props = element.props.map(function (value) {\n\t\t\t\treturn combine(tokenize(value), function (value, index, children) {\n\t\t\t\t\tswitch (charat(value, 0)) {\n\t\t\t\t\t\t// \\f\n\t\t\t\t\t\tcase 12:\n\t\t\t\t\t\t\treturn substr(value, 1, strlen(value))\n\t\t\t\t\t\t// \\0 ( + > ~\n\t\t\t\t\t\tcase 0: case 40: case 43: case 62: case 126:\n\t\t\t\t\t\t\treturn value\n\t\t\t\t\t\t// :\n\t\t\t\t\t\tcase 58:\n\t\t\t\t\t\t\tif (children[++index] === 'global')\n\t\t\t\t\t\t\t\tchildren[index] = '', children[++index] = '\\f' + substr(children[index], index = 1, -1)\n\t\t\t\t\t\t// \\s\n\t\t\t\t\t\tcase 32:\n\t\t\t\t\t\t\treturn index === 1 ? '' : value\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tswitch (index) {\n\t\t\t\t\t\t\t\tcase 0: element = value\n\t\t\t\t\t\t\t\t\treturn sizeof(children) > 1 ? '' : value\n\t\t\t\t\t\t\t\tcase index = sizeof(children) - 1: case 2:\n\t\t\t\t\t\t\t\t\treturn index === 2 ? value + element + element : value + element\n\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\treturn value\n\t\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t})\n\t}\n}\n","var weakMemoize = function weakMemoize(func) {\n  // $FlowFixMe flow doesn't include all non-primitive types as allowed for weakmaps\n  var cache = new WeakMap();\n  return function (arg) {\n    if (cache.has(arg)) {\n      // $FlowFixMe\n      return cache.get(arg);\n    }\n\n    var ret = func(arg);\n    cache.set(arg, ret);\n    return ret;\n  };\n};\n\nexport { weakMemoize as default };\n","function memoize(fn) {\n  var cache = Object.create(null);\n  return function (arg) {\n    if (cache[arg] === undefined) cache[arg] = fn(arg);\n    return cache[arg];\n  };\n}\n\nexport { memoize as default };\n","import hashString from '@emotion/hash';\nimport unitless from '@emotion/unitless';\nimport memoize from '@emotion/memoize';\n\nvar ILLEGAL_ESCAPE_SEQUENCE_ERROR = \"You have illegal escape sequence in your template literal, most likely inside content's property value.\\nBecause you write your CSS inside a JavaScript string you actually have to do double escaping, so for example \\\"content: '\\\\00d7';\\\" should become \\\"content: '\\\\\\\\00d7';\\\".\\nYou can read more about this here:\\nhttps://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#ES2018_revision_of_illegal_escape_sequences\";\nvar UNDEFINED_AS_OBJECT_KEY_ERROR = \"You have passed in falsy value as style object's key (can happen when in example you pass unexported component as computed key).\";\nvar hyphenateRegex = /[A-Z]|^ms/g;\nvar animationRegex = /_EMO_([^_]+?)_([^]*?)_EMO_/g;\n\nvar isCustomProperty = function isCustomProperty(property) {\n  return property.charCodeAt(1) === 45;\n};\n\nvar isProcessableValue = function isProcessableValue(value) {\n  return value != null && typeof value !== 'boolean';\n};\n\nvar processStyleName = /* #__PURE__ */memoize(function (styleName) {\n  return isCustomProperty(styleName) ? styleName : styleName.replace(hyphenateRegex, '-$&').toLowerCase();\n});\n\nvar processStyleValue = function processStyleValue(key, value) {\n  switch (key) {\n    case 'animation':\n    case 'animationName':\n      {\n        if (typeof value === 'string') {\n          return value.replace(animationRegex, function (match, p1, p2) {\n            cursor = {\n              name: p1,\n              styles: p2,\n              next: cursor\n            };\n            return p1;\n          });\n        }\n      }\n  }\n\n  if (unitless[key] !== 1 && !isCustomProperty(key) && typeof value === 'number' && value !== 0) {\n    return value + 'px';\n  }\n\n  return value;\n};\n\nif (process.env.NODE_ENV !== 'production') {\n  var contentValuePattern = /(var|attr|counters?|url|element|(((repeating-)?(linear|radial))|conic)-gradient)\\(|(no-)?(open|close)-quote/;\n  var contentValues = ['normal', 'none', 'initial', 'inherit', 'unset'];\n  var oldProcessStyleValue = processStyleValue;\n  var msPattern = /^-ms-/;\n  var hyphenPattern = /-(.)/g;\n  var hyphenatedCache = {};\n\n  processStyleValue = function processStyleValue(key, value) {\n    if (key === 'content') {\n      if (typeof value !== 'string' || contentValues.indexOf(value) === -1 && !contentValuePattern.test(value) && (value.charAt(0) !== value.charAt(value.length - 1) || value.charAt(0) !== '\"' && value.charAt(0) !== \"'\")) {\n        throw new Error(\"You seem to be using a value for 'content' without quotes, try replacing it with `content: '\\\"\" + value + \"\\\"'`\");\n      }\n    }\n\n    var processed = oldProcessStyleValue(key, value);\n\n    if (processed !== '' && !isCustomProperty(key) && key.indexOf('-') !== -1 && hyphenatedCache[key] === undefined) {\n      hyphenatedCache[key] = true;\n      console.error(\"Using kebab-case for css properties in objects is not supported. Did you mean \" + key.replace(msPattern, 'ms-').replace(hyphenPattern, function (str, _char) {\n        return _char.toUpperCase();\n      }) + \"?\");\n    }\n\n    return processed;\n  };\n}\n\nvar noComponentSelectorMessage = 'Component selectors can only be used in conjunction with ' + '@emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware ' + 'compiler transform.';\n\nfunction handleInterpolation(mergedProps, registered, interpolation) {\n  if (interpolation == null) {\n    return '';\n  }\n\n  if (interpolation.__emotion_styles !== undefined) {\n    if (process.env.NODE_ENV !== 'production' && interpolation.toString() === 'NO_COMPONENT_SELECTOR') {\n      throw new Error(noComponentSelectorMessage);\n    }\n\n    return interpolation;\n  }\n\n  switch (typeof interpolation) {\n    case 'boolean':\n      {\n        return '';\n      }\n\n    case 'object':\n      {\n        if (interpolation.anim === 1) {\n          cursor = {\n            name: interpolation.name,\n            styles: interpolation.styles,\n            next: cursor\n          };\n          return interpolation.name;\n        }\n\n        if (interpolation.styles !== undefined) {\n          var next = interpolation.next;\n\n          if (next !== undefined) {\n            // not the most efficient thing ever but this is a pretty rare case\n            // and there will be very few iterations of this generally\n            while (next !== undefined) {\n              cursor = {\n                name: next.name,\n                styles: next.styles,\n                next: cursor\n              };\n              next = next.next;\n            }\n          }\n\n          var styles = interpolation.styles + \";\";\n\n          if (process.env.NODE_ENV !== 'production' && interpolation.map !== undefined) {\n            styles += interpolation.map;\n          }\n\n          return styles;\n        }\n\n        return createStringFromObject(mergedProps, registered, interpolation);\n      }\n\n    case 'function':\n      {\n        if (mergedProps !== undefined) {\n          var previousCursor = cursor;\n          var result = interpolation(mergedProps);\n          cursor = previousCursor;\n          return handleInterpolation(mergedProps, registered, result);\n        } else if (process.env.NODE_ENV !== 'production') {\n          console.error('Functions that are interpolated in css calls will be stringified.\\n' + 'If you want to have a css call based on props, create a function that returns a css call like this\\n' + 'let dynamicStyle = (props) => css`color: ${props.color}`\\n' + 'It can be called directly with props or interpolated in a styled call like this\\n' + \"let SomeComponent = styled('div')`${dynamicStyle}`\");\n        }\n\n        break;\n      }\n\n    case 'string':\n      if (process.env.NODE_ENV !== 'production') {\n        var matched = [];\n        var replaced = interpolation.replace(animationRegex, function (match, p1, p2) {\n          var fakeVarName = \"animation\" + matched.length;\n          matched.push(\"const \" + fakeVarName + \" = keyframes`\" + p2.replace(/^@keyframes animation-\\w+/, '') + \"`\");\n          return \"${\" + fakeVarName + \"}\";\n        });\n\n        if (matched.length) {\n          console.error('`keyframes` output got interpolated into plain string, please wrap it with `css`.\\n\\n' + 'Instead of doing this:\\n\\n' + [].concat(matched, [\"`\" + replaced + \"`\"]).join('\\n') + '\\n\\nYou should wrap it with `css` like this:\\n\\n' + (\"css`\" + replaced + \"`\"));\n        }\n      }\n\n      break;\n  } // finalize string values (regular strings and functions interpolated into css calls)\n\n\n  if (registered == null) {\n    return interpolation;\n  }\n\n  var cached = registered[interpolation];\n  return cached !== undefined ? cached : interpolation;\n}\n\nfunction createStringFromObject(mergedProps, registered, obj) {\n  var string = '';\n\n  if (Array.isArray(obj)) {\n    for (var i = 0; i < obj.length; i++) {\n      string += handleInterpolation(mergedProps, registered, obj[i]) + \";\";\n    }\n  } else {\n    for (var _key in obj) {\n      var value = obj[_key];\n\n      if (typeof value !== 'object') {\n        if (registered != null && registered[value] !== undefined) {\n          string += _key + \"{\" + registered[value] + \"}\";\n        } else if (isProcessableValue(value)) {\n          string += processStyleName(_key) + \":\" + processStyleValue(_key, value) + \";\";\n        }\n      } else {\n        if (_key === 'NO_COMPONENT_SELECTOR' && process.env.NODE_ENV !== 'production') {\n          throw new Error(noComponentSelectorMessage);\n        }\n\n        if (Array.isArray(value) && typeof value[0] === 'string' && (registered == null || registered[value[0]] === undefined)) {\n          for (var _i = 0; _i < value.length; _i++) {\n            if (isProcessableValue(value[_i])) {\n              string += processStyleName(_key) + \":\" + processStyleValue(_key, value[_i]) + \";\";\n            }\n          }\n        } else {\n          var interpolated = handleInterpolation(mergedProps, registered, value);\n\n          switch (_key) {\n            case 'animation':\n            case 'animationName':\n              {\n                string += processStyleName(_key) + \":\" + interpolated + \";\";\n                break;\n              }\n\n            default:\n              {\n                if (process.env.NODE_ENV !== 'production' && _key === 'undefined') {\n                  console.error(UNDEFINED_AS_OBJECT_KEY_ERROR);\n                }\n\n                string += _key + \"{\" + interpolated + \"}\";\n              }\n          }\n        }\n      }\n    }\n  }\n\n  return string;\n}\n\nvar labelPattern = /label:\\s*([^\\s;\\n{]+)\\s*(;|$)/g;\nvar sourceMapPattern;\n\nif (process.env.NODE_ENV !== 'production') {\n  sourceMapPattern = /\\/\\*#\\ssourceMappingURL=data:application\\/json;\\S+\\s+\\*\\//g;\n} // this is the cursor for keyframes\n// keyframes are stored on the SerializedStyles object as a linked list\n\n\nvar cursor;\nvar serializeStyles = function serializeStyles(args, registered, mergedProps) {\n  if (args.length === 1 && typeof args[0] === 'object' && args[0] !== null && args[0].styles !== undefined) {\n    return args[0];\n  }\n\n  var stringMode = true;\n  var styles = '';\n  cursor = undefined;\n  var strings = args[0];\n\n  if (strings == null || strings.raw === undefined) {\n    stringMode = false;\n    styles += handleInterpolation(mergedProps, registered, strings);\n  } else {\n    if (process.env.NODE_ENV !== 'production' && strings[0] === undefined) {\n      console.error(ILLEGAL_ESCAPE_SEQUENCE_ERROR);\n    }\n\n    styles += strings[0];\n  } // we start at 1 since we've already handled the first arg\n\n\n  for (var i = 1; i < args.length; i++) {\n    styles += handleInterpolation(mergedProps, registered, args[i]);\n\n    if (stringMode) {\n      if (process.env.NODE_ENV !== 'production' && strings[i] === undefined) {\n        console.error(ILLEGAL_ESCAPE_SEQUENCE_ERROR);\n      }\n\n      styles += strings[i];\n    }\n  }\n\n  var sourceMap;\n\n  if (process.env.NODE_ENV !== 'production') {\n    styles = styles.replace(sourceMapPattern, function (match) {\n      sourceMap = match;\n      return '';\n    });\n  } // using a global regex with .exec is stateful so lastIndex has to be reset each time\n\n\n  labelPattern.lastIndex = 0;\n  var identifierName = '';\n  var match; // https://esbench.com/bench/5b809c2cf2949800a0f61fb5\n\n  while ((match = labelPattern.exec(styles)) !== null) {\n    identifierName += '-' + // $FlowFixMe we know it's not null\n    match[1];\n  }\n\n  var name = hashString(styles) + identifierName;\n\n  if (process.env.NODE_ENV !== 'production') {\n    // $FlowFixMe SerializedStyles type doesn't have toString property (and we don't want to add it)\n    return {\n      name: name,\n      styles: styles,\n      map: sourceMap,\n      next: cursor,\n      toString: function toString() {\n        return \"You have tried to stringify object returned from `css` function. It isn't supposed to be used directly (e.g. as value of the `className` prop), but rather handed to emotion so it can handle it (e.g. as value of `css` prop).\";\n      }\n    };\n  }\n\n  return {\n    name: name,\n    styles: styles,\n    next: cursor\n  };\n};\n\nexport { serializeStyles };\n","/* eslint-disable */\n// Inspired by https://github.com/garycourt/murmurhash-js\n// Ported from https://github.com/aappleby/smhasher/blob/61a0530f28277f2e850bfc39600ce61d02b518de/src/MurmurHash2.cpp#L37-L86\nfunction murmur2(str) {\n  // 'm' and 'r' are mixing constants generated offline.\n  // They're not really 'magic', they just happen to work well.\n  // const m = 0x5bd1e995;\n  // const r = 24;\n  // Initialize the hash\n  var h = 0; // Mix 4 bytes at a time into the hash\n\n  var k,\n      i = 0,\n      len = str.length;\n\n  for (; len >= 4; ++i, len -= 4) {\n    k = str.charCodeAt(i) & 0xff | (str.charCodeAt(++i) & 0xff) << 8 | (str.charCodeAt(++i) & 0xff) << 16 | (str.charCodeAt(++i) & 0xff) << 24;\n    k =\n    /* Math.imul(k, m): */\n    (k & 0xffff) * 0x5bd1e995 + ((k >>> 16) * 0xe995 << 16);\n    k ^=\n    /* k >>> r: */\n    k >>> 24;\n    h =\n    /* Math.imul(k, m): */\n    (k & 0xffff) * 0x5bd1e995 + ((k >>> 16) * 0xe995 << 16) ^\n    /* Math.imul(h, m): */\n    (h & 0xffff) * 0x5bd1e995 + ((h >>> 16) * 0xe995 << 16);\n  } // Handle the last few bytes of the input array\n\n\n  switch (len) {\n    case 3:\n      h ^= (str.charCodeAt(i + 2) & 0xff) << 16;\n\n    case 2:\n      h ^= (str.charCodeAt(i + 1) & 0xff) << 8;\n\n    case 1:\n      h ^= str.charCodeAt(i) & 0xff;\n      h =\n      /* Math.imul(h, m): */\n      (h & 0xffff) * 0x5bd1e995 + ((h >>> 16) * 0xe995 << 16);\n  } // Do a few final mixes of the hash to ensure the last few\n  // bytes are well-incorporated.\n\n\n  h ^= h >>> 13;\n  h =\n  /* Math.imul(h, m): */\n  (h & 0xffff) * 0x5bd1e995 + ((h >>> 16) * 0xe995 << 16);\n  return ((h ^ h >>> 15) >>> 0).toString(36);\n}\n\nexport { murmur2 as default };\n","var unitlessKeys = {\n  animationIterationCount: 1,\n  aspectRatio: 1,\n  borderImageOutset: 1,\n  borderImageSlice: 1,\n  borderImageWidth: 1,\n  boxFlex: 1,\n  boxFlexGroup: 1,\n  boxOrdinalGroup: 1,\n  columnCount: 1,\n  columns: 1,\n  flex: 1,\n  flexGrow: 1,\n  flexPositive: 1,\n  flexShrink: 1,\n  flexNegative: 1,\n  flexOrder: 1,\n  gridRow: 1,\n  gridRowEnd: 1,\n  gridRowSpan: 1,\n  gridRowStart: 1,\n  gridColumn: 1,\n  gridColumnEnd: 1,\n  gridColumnSpan: 1,\n  gridColumnStart: 1,\n  msGridRow: 1,\n  msGridRowSpan: 1,\n  msGridColumn: 1,\n  msGridColumnSpan: 1,\n  fontWeight: 1,\n  lineHeight: 1,\n  opacity: 1,\n  order: 1,\n  orphans: 1,\n  tabSize: 1,\n  widows: 1,\n  zIndex: 1,\n  zoom: 1,\n  WebkitLineClamp: 1,\n  // SVG-related properties\n  fillOpacity: 1,\n  floodOpacity: 1,\n  stopOpacity: 1,\n  strokeDasharray: 1,\n  strokeDashoffset: 1,\n  strokeMiterlimit: 1,\n  strokeOpacity: 1,\n  strokeWidth: 1\n};\n\nexport { unitlessKeys as default };\n","var isBrowser = \"object\" !== 'undefined';\nfunction getRegisteredStyles(registered, registeredStyles, classNames) {\n  var rawClassName = '';\n  classNames.split(' ').forEach(function (className) {\n    if (registered[className] !== undefined) {\n      registeredStyles.push(registered[className] + \";\");\n    } else {\n      rawClassName += className + \" \";\n    }\n  });\n  return rawClassName;\n}\nvar registerStyles = function registerStyles(cache, serialized, isStringTag) {\n  var className = cache.key + \"-\" + serialized.name;\n\n  if ( // we only need to add the styles to the registered cache if the\n  // class name could be used further down\n  // the tree but if it's a string tag, we know it won't\n  // so we don't have to add it to registered cache.\n  // this improves memory usage since we can avoid storing the whole style string\n  (isStringTag === false || // we need to always store it if we're in compat mode and\n  // in node since emotion-server relies on whether a style is in\n  // the registered cache to know whether a style is global or not\n  // also, note that this check will be dead code eliminated in the browser\n  isBrowser === false ) && cache.registered[className] === undefined) {\n    cache.registered[className] = serialized.styles;\n  }\n};\nvar insertStyles = function insertStyles(cache, serialized, isStringTag) {\n  registerStyles(cache, serialized, isStringTag);\n  var className = cache.key + \"-\" + serialized.name;\n\n  if (cache.inserted[serialized.name] === undefined) {\n    var current = serialized;\n\n    do {\n      cache.insert(serialized === current ? \".\" + className : '', current, cache.sheet, true);\n\n      current = current.next;\n    } while (current !== undefined);\n  }\n};\n\nexport { getRegisteredStyles, insertStyles, registerStyles };\n","module.exports = (require(\"./helpers/browser/import-polyfill\")(require('./helpers/bundle-manifest').resolve(\"4tKUq\"))).then(() => parcelRequire('duojR'));","module.exports = (require(\"./helpers/browser/import-polyfill\")(require('./helpers/bundle-manifest').resolve(\"hn23i\"))).then(() => parcelRequire('2vgBY'));","module.exports = (require(\"./helpers/browser/import-polyfill\")(require('./helpers/bundle-manifest').resolve(\"af9Ft\"))).then(() => parcelRequire('lbeJP'));","/**\n * by bitbof (bitbof.com)\n */\n\nimport './polyfills/polyfills';\nimport {KL} from './klecks/kl';\nimport {klHistory} from './klecks/history/kl-history';\nimport {KlApp} from './app/kl-app';\nimport {IKlProject} from './klecks/kl-types';\nimport {ProjectStore} from './klecks/storage/project-store';\nimport {initLANG, LANG} from './language/language';\nimport '../script/theme/theme';\n\ndeclare global {\n    interface Window {\n        klecks: KlApp;\n    }\n}\n\nfunction initError (e: Error): void {\n    const el = document.createElement('div');\n    el.style.textAlign = 'center';\n    el.style.background = '#fff';\n    el.style.padding = '20px';\n    el.innerHTML = '<h1>App failed to initialize</h1>';\n    const errorMsg = document.createElement('div');\n    errorMsg.textContent = 'Error: ' + (e.message ? e.message : ('' + e));\n    el.append(errorMsg);\n    document.body.append(el);\n    console.error(e);\n}\n\n(async () => {\n    let klApp: KlApp;\n    let domIsLoaded = false;\n\n    try {\n        window.addEventListener('DOMContentLoaded', () => {\n            domIsLoaded = true;\n        });\n        await initLANG();\n    } catch (e) {\n        initError(e as Error);\n        return;\n    }\n\n    function onProjectLoaded (project: IKlProject | null, projectStore: ProjectStore) {\n        if (klApp) {\n            throw 'onKlProjectObjLoaded called more than once';\n        }\n        // in case an extension manipulated the page\n        const loadingScreenEl = document.getElementById('loading-screen');\n        loadingScreenEl?.remove();\n\n        const saveReminder = new KL.SaveReminder(\n            klHistory,\n            true,\n            true,\n            () => klApp.saveAsPsd(),\n            () => {\n                return klApp ? klApp.isDrawing() : false;\n            },\n            null,\n            null,\n        );\n        klApp = new KlApp(\n            project,\n            {\n                saveReminder,\n                projectStore,\n            }\n        );\n        saveReminder.init();\n        if (project) {\n            setTimeout(() => {\n                klApp.out(LANG('file-storage-restored'));\n            }, 100);\n        }\n\n        document.body.append(klApp.getEl());\n        window.klecks = klApp;\n    }\n\n    async function onDomLoaded () {\n        try {\n            window.removeEventListener('DOMContentLoaded', onDomLoaded);\n            const projectStore = new KL.ProjectStore();\n            let project: IKlProject | null = null;\n            try {\n                const readResult = await projectStore.read();\n                if (readResult) {\n                    project = readResult.project;\n                }\n            } catch(e) {\n                let message: string;\n                if ((e as Error).message.indexOf('db-error') === 0) {\n                    message = 'Failed to access Browser Storage';\n                } else if ((e as Error).message.indexOf('format-error') === 0) {\n                    message = 'Failed to restore from Browser Storage';\n                } else {\n                    message = 'Failed to restore from Browser Storage';\n                }\n                if (message) {\n                    setTimeout(function () {\n                        klApp && klApp.out(message);\n                        throw new Error('Initial browser storage error, ' + e);\n                    }, 100);\n                }\n            }\n            onProjectLoaded(project, projectStore);\n        } catch (e) {\n            initError(e as Error);\n        }\n\n    }\n    if (domIsLoaded) {\n        onDomLoaded();\n    } else {\n        window.addEventListener('DOMContentLoaded', onDomLoaded);\n    }\n})();\n\n","import './polyfills-nomodule';\n\n/*\n * ---- Below ----------------------\n * features that didn't have support until *after* browsers supported the modules script tag:\n * Chrome 61\n * Edge 16\n * Safari 11\n * Firefox 60\n * https://caniuse.com/es6-module\n */\n\n// chrome 61, edge 79, safari 16, firefox 107\nif (!('scrollTo' in Element.prototype)) {\n    Object.defineProperty(Element.prototype, 'scrollTo', {\n        value: function (x: number, y: number) {\n            this.scrollLeft = x;\n            this.scrollTop = y;\n        },\n    });\n}\n\n// chrome 61, edge 79, safari 16, firefox 107\nif (!('scrollBy' in Element.prototype)) {\n    Object.defineProperty(Element.prototype, 'scrollBy', {\n        value: function (x: number, y: number) {\n            this.scrollLeft += x;\n            this.scrollTop += y;\n        },\n    });\n}\n\n// chrome 69, edge 79, safari 12, firefox 62\nif (!Array.prototype.flat) {\n    Object.defineProperty(Array.prototype, 'flat', {\n        configurable: true,\n        value: function flat (...args: any[]) {\n            const depth = isNaN(args[0]) ? 1 : Number(args[0]);\n\n            return depth ? Array.prototype.reduce.call(this, function (acc: any, cur) {\n                if (Array.isArray(cur)) {\n                    // eslint-disable-next-line prefer-spread\n                    acc.push.apply(acc, flat.call(cur, depth - 1));\n                } else {\n                    acc.push(cur);\n                }\n\n                return acc;\n            }, []) : Array.prototype.slice.call(this);\n        },\n        writable: true,\n    });\n}\n\n// Chrome 85, Firefox 77, Safari 13.1\n// if there are problems, maybe use core-js\nif (!String.prototype.replaceAll) {\n    Object.defineProperty(String.prototype, 'replaceAll', {\n        value: function (searchValue: string | RegExp, replaceValue: string): string {\n            if (typeof replaceValue === 'function') {\n                throw new Error('replaceAll polyfill does not support replaceValue: function');\n            }\n            return this.replace(new RegExp(searchValue, 'g'), replaceValue);\n        },\n    });\n}\n\n/*\n    Copyright 2018  Alfredo Mungo <alfredo.mungo@protonmail.ch>\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to\n    deal in the Software without restriction, including without limitation the\n    rights to use, copy, modify, merge, publish, distribute, sublicense, and/or\n    sell copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in\n    all copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n    IN THE SOFTWARE.\n*/\nif (!Object.fromEntries) {\n    Object.defineProperty(Object, 'fromEntries', {\n        value (entries: any) {\n            if (!entries || !entries[Symbol.iterator]) {\n                throw new Error('Object.fromEntries() requires a single iterable argument');\n            }\n            const o: any = {};\n            Object.keys(entries).forEach((key) => {\n                const [k, v] = entries[key];\n                o[k] = v;\n            });\n            return o;\n        },\n    });\n}\n\n// sometimes Android WebView has no localStorage\nif (!('localStorage' in window)) {\n    try {\n        (window as any).localStorage = {\n            getItem: () => null,\n            setItem: () => {},\n            removeItem: () => {},\n        };\n    } catch (e) {\n        // maybe it fails?\n    }\n}\n","/**\n * features that were available before module script tags:\n * chrome 61\n * edge 16\n * safari 11\n * firefox 60\n * https://caniuse.com/es6-module\n */\n\nimport 'mdn-polyfills/Node.prototype.append';\nimport 'mdn-polyfills/Node.prototype.prepend'; // edge 17 (one version after module)\nimport 'mdn-polyfills/String.prototype.padStart';\nimport 'mdn-polyfills/Array.prototype.findIndex';","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.appendChild(n)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"append\")||Object.defineProperty(e,\"append\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","!function(){function t(){var e=Array.prototype.slice.call(arguments),n=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(String(e)))}),this.insertBefore(n,this.firstChild)}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty(\"prepend\")||Object.defineProperty(e,\"prepend\",{configurable:!0,enumerable:!0,writable:!0,value:t})})}();\n","String.prototype.padStart||(String.prototype.padStart=function(t,n){return t>>=0,n=String(n||\" \"),this.length>t?String(this):((t-=this.length)>n.length&&(n+=n.repeat(t/n.length)),n.slice(0,t)+String(this))});\n","Array.prototype.findIndex||Object.defineProperty(Array.prototype,\"findIndex\",{value:function(r){if(null==this)throw new TypeError('\"this\" is null or not defined');var e=Object(this),t=e.length>>>0;if(\"function\"!=typeof r)throw new TypeError(\"predicate must be a function\");for(var n=arguments[1],o=0;o<t;){var i=e[o];if(r.call(n,i,o,e))return o;o++}return-1}});\n","import {DecoyKlHistory, klHistory} from './history/kl-history';\nimport {showModal} from './ui/modals/base/showModal';\nimport {DynamicModal} from './ui/modals/base/dynamic-modal';\nimport {dialogCounter} from './ui/modals/modal-count';\nimport {Checkbox} from './ui/components/checkbox';\nimport {input} from './ui/components/input';\nimport {Select} from './ui/components/select';\nimport {ImageToggle} from './ui/components/image-toggle';\nimport {ImageRadioList} from './ui/components/image-radio-list';\nimport {createPenPressureToggle} from './ui/components/create-pen-pressure-toggle';\nimport {KlSlider} from './ui/components/kl-slider';\nimport {calcSliderFalloffFactor} from './ui/components/slider-falloff';\nimport {HexColorDialog} from './ui/modals/color-slider-hex-dialog';\nimport {KlColorSlider} from './ui/components/kl-color-slider';\nimport {KlColorSliderSmall} from './ui/components/kl-color-slider-small';\nimport {PointSlider} from './ui/components/point-slider';\nimport {ColorOptions} from './ui/components/color-options';\nimport {Options} from './ui/components/options';\nimport {StatusOverlay} from './ui/components/status-overlay';\nimport {CropCopy} from './ui/components/crop-copy';\nimport {clipboardDialog} from './ui/modals/clipboard-dialog';\nimport {LayerManager} from './ui/tool-tabs/layer-manager/layer-manager';\nimport {WorkspaceSvgOverlay} from './canvas-ui/workspace-svg-overlay';\nimport {KlCanvasWorkspace} from './canvas-ui/kl-canvas-workspace';\nimport {KlCanvasPreview} from './canvas-ui/canvas-preview';\nimport {FreeTransform} from './ui/components/free-transform';\nimport {FreeTransformCanvas} from './ui/components/free-transform-canvas';\nimport {Cropper} from './ui/components/cropper';\nimport {LayerPreview} from './ui/components/layer-preview';\nimport {showImportAsLayerDialog} from './ui/modals/show-import-as-layer-dialog';\nimport {KlImageDropper} from './ui/components/kl-image-dropper';\nimport {OverlayToolspace} from './ui/components/overlay-toolspace';\nimport {ToolspaceTopRow} from './ui/components/toolspace-top-row';\nimport {ToolDropdown} from './ui/components/tool-dropdown';\nimport {ToolspaceToolRow} from './ui/components/toolspace-tool-row';\nimport {ToolspaceStabilizerRow} from './ui/components/toolspace-stabilizer-row';\nimport {TabRow} from './ui/components/tab-row';\nimport {HandUi} from './ui/tool-tabs/hand-ui';\nimport {FillUi} from './ui/tool-tabs/fill-ui';\nimport {TextUi} from './ui/tool-tabs/text-ui';\nimport {ShapeUi} from './ui/tool-tabs/shape-ui';\nimport {newImageDialog} from './ui/modals/new-image-dialog';\nimport {ToolspaceCollapser} from './ui/components/toolspace-collapser';\nimport {renderText} from './image-operations/render-text';\nimport {textToolDialog} from './ui/modals/text-tool-dialog/text-tool-dialog';\nimport {showImportImageDialog} from './ui/modals/show-import-image-dialog';\nimport {floodFillBits} from './image-operations/flood-fill';\nimport * as PSD from './storage/psd';\nimport {drawShape, ShapeTool} from './image-operations/shape-tool';\nimport {KlCanvas} from './canvas/kl-canvas';\nimport * as indexedDb from './storage/indexed-db';\nimport {setDbName} from './storage/indexed-db';\nimport {filterLib, filterLibStatus} from './filters/filters';\nimport {brushes} from './brushes/brushes';\nimport {brushesUI} from './brushes-ui/brushes-ui';\nimport {showIframeModal} from './ui/modals/show-iframe-modal';\nimport {RadioList} from './ui/components/radio-list';\nimport {BrowserStorageUi} from './ui/components/browser-storage-ui';\nimport {drawProject} from './canvas/draw-project';\nimport {ProjectStore} from './storage/project-store';\nimport {FileTab} from './ui/tool-tabs/file-tab';\nimport {FilterTab} from './ui/tool-tabs/filter-tab';\nimport {imgurUpload} from './ui/modals/imgur-upload';\nimport {loadAgPsd} from './storage/load-ag-psd';\nimport {SaveReminder} from './ui/components/save-reminder';\nimport {SaveToComputer} from './storage/save-to-computer';\nimport {UndoRedoCatchup} from './history/undo-redo-catchup';\nimport {BrushSettingService} from './brushes-ui/brush-setting-service';\nimport {BoxToggle} from './ui/components/box-toggle';\nimport {SettingsTab} from './ui/tool-tabs/settings-tab';\nimport {ToolspaceScroller} from './ui/components/toolspace-scroller';\nimport {GradientUi} from './ui/tool-tabs/gradient-ui';\nimport {drawGradient, GradientTool} from './image-operations/gradient-tool';\n\n/**\n * paint tool functionality\n */\nexport const KL = {\n\n    // --- brushes ---\n    brushes,\n    brushesUI,\n    BrushSettingService,\n\n    // --- canvas ---\n    KlCanvas,\n    drawProject,\n\n    // --- canvas ui ---\n    WorkspaceSvgOverlay,\n    KlCanvasWorkspace,\n    KlCanvasPreview,\n\n    // --- filters ---\n    filterLibStatus,\n    filterLib,\n\n    // --- history ---\n    UndoRedoCatchup,\n\n    // --- image operations ---\n    renderText,\n    floodFillBits,\n    ShapeTool,\n    drawShape,\n    GradientTool,\n    drawGradient,\n\n    // --- storage ---\n    PSD,\n    setDbName,\n    indexedDb,\n    ProjectStore,\n    loadAgPsd,\n    SaveToComputer,\n    \n    // --- ui - components ---\n    calcSliderFalloffFactor,\n    Checkbox,\n    input,\n    Select,\n    ImageToggle,\n    ImageRadioList,\n    RadioList,\n    createPenPressureToggle,\n    KlSlider,\n    HexColorDialog,\n    KlColorSlider,\n    KlColorSliderSmall,\n    PointSlider,\n    ColorOptions,\n    Options,\n    BoxToggle,\n    StatusOverlay,\n    CropCopy,\n    FreeTransform,\n    FreeTransformCanvas,\n    Cropper,\n    LayerPreview,\n    KlImageDropper,\n    OverlayToolspace,\n    ToolspaceTopRow,\n    ToolDropdown,\n    ToolspaceToolRow,\n    ToolspaceStabilizerRow,\n    TabRow,\n    ToolspaceCollapser,\n    BrowserStorageUi,\n    SaveReminder,\n    ToolspaceScroller,\n\n    // --- ui - modals ---\n    dialogCounter,\n    popup: showModal,\n    Popup: DynamicModal,\n    clipboardDialog,\n    showImportAsLayerDialog,\n    newImageDialog,\n    textToolDialog,\n    showImportImageDialog,\n    showIframePopup: showIframeModal,\n    imgurUpload,\n\n    // --- ui - tool tabs ---\n    HandUi,\n    FillUi,\n    GradientUi,\n    TextUi,\n    ShapeUi,\n    FileTab,\n    FilterTab,\n    SettingsTab,\n    LayerManager,\n\n    klHistory,\n    DecoyKlHistory,\n};\n\nObject.keys(KL); // without this, parcel build may break this object","\n\n// --------- history entry types ------------------------------\nimport {throwIfNull} from '../../bb/base/base';\n\nexport interface IHistoryAction {\n    action: string;\n    params: any[];\n}\n\nexport interface IHistoryEntry {\n    tool: string[];\n    action?: string;\n    params?: any[];\n    actions?: IHistoryAction[];\n}\n\ntype THistoryActionParams<T> = T extends (...args: infer A) => void ? A : never;\nexport type THistoryActions<ToolName, T> = {\n    [K in keyof T]: {\n        tool: [ToolName];\n        action: K;\n        params: THistoryActionParams<T[K]>;\n    }\n}[keyof T];\n\nexport type THistoryInnerActions<T> = {\n    [K in keyof T]: {\n        action: K;\n        params: THistoryActionParams<T[K]>;\n    }\n}[keyof T];\n\nexport type THistoryEntryG<Tool extends string[], Action extends string, Params extends unknown[]> = {\n    tool: Tool;\n    action: Action;\n    params: Params;\n}\n\nexport type TMiscImportImageHistoryEntry = THistoryEntryG<\n    ['misc'],\n    'importImage',\n    [HTMLCanvasElement, string | undefined]>;\n\nexport type TMiscFocusLayerHistoryEntry = THistoryEntryG<\n    ['misc'],\n    'focusLayer',\n    [number]>;\n\n// --------- classes etc ------------------------------\n\nexport interface IHistoryBroadcast {\n    bufferUpdate: IHistoryEntry;\n}\n\nlet historyInstance: boolean = false;\n\nexport type IHistoryListener = (p: IHistoryBroadcast | null) => void;\n\nexport interface KlHistoryInterface {\n    pause (b: boolean): void;\n    addListener (l: IHistoryListener): void;\n    push (e: IHistoryEntry): void;\n    undo (): IHistoryEntry[];\n    redo (): IHistoryEntry | undefined;\n    getAll (): (IHistoryEntry | null)[];\n    canRedo (): boolean;\n    canUndo (): boolean;\n    getState (): number;\n    getActionNumber (): number;\n}\n\nexport class DecoyKlHistory implements KlHistoryInterface {\n    pause (): void {}\n    addListener (): void {}\n    push (): void {}\n    undo (): IHistoryEntry[] { return []; }\n    redo (): (IHistoryEntry | undefined) { return undefined; }\n    getAll (): (IHistoryEntry | null)[] { return []; }\n    canRedo (): boolean { return false; }\n    canUndo (): boolean { return false; }\n    getState (): number { return 0; }\n    getActionNumber (): number { return 0; }\n}\n\nconst DO_DELETE_OLD = true;\n\nexport class KlHistory implements KlHistoryInterface {\n\n    private state: number; // on .push state increments by one\n    private readonly entries: (IHistoryEntry | null)[]; // null if beyond max undo to trigger garbage collection\n    private readonly listeners: IHistoryListener[];\n    private pauseStack: number; // how often paused without unpause\n    private readonly max: number = 20; // max number undo steps\n    private maxState: number; // can't go backwards -> max state is the buffer image(klCanvas)\n    private actionNumber: number; // current action the user is on. untouched document = -1 because dataArr.length is 0\n    \n    private broadcast (p: IHistoryBroadcast | null): void {\n        setTimeout(() => {\n            for (let i = 0; i < this.listeners.length; i++) {\n                this.listeners[i](p);\n            }\n            this.state++;\n        }, 1);\n    }\n    \n    // ---- public ----\n    \n    constructor () {\n        if (historyInstance) {\n            throw new Error('klHistory already instantiated');\n        }\n        historyInstance = true;\n        this.state = 0;\n        this.entries = [];\n        this.listeners = [];\n        this.pauseStack = 0;\n        this.maxState = -1;\n        this.actionNumber = -1;\n    }\n\n    /**\n     * Needed, because sometimes there are actions that would cause other undo steps.\n     * For example a filter that does something with two layers and then merges them.\n     * That should be a single undo step, and prevent merging from creating its own undo step.\n     * Pause prevents creation of unintended undo steps.\n     */\n    pause (b: boolean): void {\n        if (b) {\n            this.pauseStack++;\n        } else {\n            this.pauseStack = Math.max(0, this.pauseStack - 1);\n        }\n    }\n\n    addListener (l: IHistoryListener): void {\n        this.listeners.push(l);\n    }\n\n    push (newEntry: IHistoryEntry): void {\n        if (this.pauseStack > 0) {\n            return;\n        }\n        while (this.actionNumber < this.entries.length - 1) {\n            this.entries.pop();\n        }\n\n        //taking care of actions that shouldn't cause a new undo step\n        const lastEntry = this.entries[this.entries.length - 1];\n        // opacity\n        if (\n            lastEntry && newEntry.tool[0] === 'canvas' && lastEntry.tool[0] === 'canvas' &&\n            newEntry.action === 'layerOpacity' && lastEntry.action === 'layerOpacity' &&\n            lastEntry.params![0] === newEntry.params![0]\n        ) {\n            this.entries[this.entries.length - 1] = newEntry;\n            this.state++; //still needs to increment because something changed\n            return;\n        }\n        // layer visibility\n        if (\n            lastEntry && newEntry.tool[0] === 'canvas' && lastEntry.tool[0] === 'canvas' &&\n            newEntry.action === 'setLayerIsVisible' && lastEntry.action === 'setLayerIsVisible' &&\n            lastEntry.params![0] === newEntry.params![0] &&\n            lastEntry.params![1] != newEntry.params![1]\n        ) {\n            // if last and current step toggle visibility -> that means it's the way it was before\n            this.entries.pop();\n            this.actionNumber--;\n            this.state++; //still needs to increment because something changed\n            this.broadcast(null);\n            return;\n        }\n        // select layer\n        if (newEntry.action === 'focusLayer' && lastEntry && lastEntry.action === 'focusLayer') {\n            this.entries[this.entries.length - 1] = newEntry;\n            this.state++;\n            return;\n        }\n\n        this.entries[this.entries.length] = newEntry;\n        this.actionNumber = this.entries.length - 1;\n        const maxBefore = this.maxState;\n        this.maxState = Math.max(this.maxState, this.actionNumber - this.max);\n        if (maxBefore < this.maxState) {\n            const item = this.entries[this.maxState];\n            if (!item) {\n                throw new Error('this.dataArr[this.maxState] null');\n            }\n            this.broadcast({bufferUpdate: item});\n        } else {\n            this.broadcast(null);\n        }\n        if (DO_DELETE_OLD && this.maxState >= 0) {\n            this.entries[this.maxState] = null; //to free some memory...imported images take a lot of space\n        }\n    }\n\n    /**\n     * lowers action number, returns all entries that need to be executed\n     * on trailing snapshot to represent the canvas one undo step back.\n     * Empty array if it can't undo\n     */\n    undo (): IHistoryEntry[] {\n        const result: IHistoryEntry[] = [];\n        if (!this.canUndo()) {\n            return result;\n        }\n        for (let i = this.maxState + 1; i < this.actionNumber; i++) {\n            result.push(throwIfNull(this.entries[i]));\n        }\n        this.actionNumber--;\n        this.broadcast(null);\n        return result;\n    }\n\n    /**\n     * raises action number, returns the action to be redone\n     */\n    redo (): (IHistoryEntry | undefined) {\n        if (!this.canRedo()) {\n            return undefined;\n        }\n        this.actionNumber++;\n        this.broadcast(null);\n        return throwIfNull(this.entries[this.actionNumber]);\n    }\n\n    getAll (): (IHistoryEntry | null)[] {\n        return [...this.entries];\n    }\n\n    canRedo (): boolean {\n        return this.actionNumber < this.entries.length - 1;\n    }\n\n    canUndo (): boolean {\n        return this.actionNumber > this.maxState;\n    }\n\n    getState (): number {\n        return this.state;\n    }\n\n    /**\n     * actionNumber - number of undo-able actions a user has done (e.g. if drawn 5 lines total -> 5)\n     */\n    getActionNumber (): number {\n        return (this.actionNumber + 1);\n    }\n    \n}\n\nexport const klHistory = new KlHistory();\n","import {IKeyString, IKeyStringOptional, ISize2D, ISVG, IVector2D} from '../bb-types';\n\nexport function insertAfter (referenceNode: Element, newNode: Element): void {\n    if (referenceNode.parentNode) {\n        referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);\n    }\n}\n\nexport function loadImage (im: HTMLImageElement, callback: () => void): void {\n    let counter = 0;\n\n    function check (): void {\n        if (counter === 1000) {\n            alert(\"couldn't load\");\n            return;\n        }\n        if (im.complete) {\n            counter++;\n            callback();\n        } else {\n            setTimeout(check, 1);\n        }\n    }\n\n    check();\n}\n\nexport function asyncLoadImage (src: string): Promise<HTMLImageElement> {\n    return new Promise((resolve, reject) => {\n        const img = new Image();\n        img.onload = () => resolve(img);\n        img.onerror = reject;\n        img.src = src;\n    });\n}\n\nexport function css (el: HTMLElement | SVGElement, styleObj: IKeyStringOptional): void {\n    const keyArr = Object.keys(styleObj);\n    let keyStr: string;\n    const style = (el.style as unknown) as IKeyStringOptional;\n    for (let i = 0; i < keyArr.length; i++) {\n        keyStr = keyArr[i];\n        style[keyStr] = styleObj[keyStr];\n        if (keyStr === 'userSelect') {\n            style.webkitUserSelect = styleObj[keyStr]; // safari\n        }\n    }\n}\n\nexport function setAttributes (el: Element, attrObj: IKeyString): void {\n    const keyArr = Object.keys(attrObj);\n    let keyStr;\n    for (let i = 0; i < keyArr.length; i++) {\n        keyStr = keyArr[i];\n        el.setAttribute(keyStr, attrObj[keyStr]);\n    }\n}\n\n/**\n * append a list to DOM element\n */\nexport function append (target: HTMLElement, els: (HTMLElement | string | undefined)[]): void {\n    const fragment = document.createDocumentFragment();\n    els.forEach(item => item && fragment.append(item));\n    target.append(fragment);\n}\n\n/**\n * a needs to fit into b\n */\nexport function fitInto (aw: number, ah: number, bw: number, bh: number, min?: number): ISize2D {\n    let width = aw * bw, height = ah * bw;\n    if (width > bw) {\n        height = bw / width * height;\n        width = bw;\n    }\n    if (height > bh) {\n        width = bh / height * width;\n        height = bh;\n    }\n    if (min) {\n        width = Math.max(min, width);\n        height = Math.max(min, height);\n    }\n    return {width, height};\n}\n\n/**\n * center b in a\n * @param aw\n * @param ah\n * @param bw\n * @param bh\n */\nexport function centerWithin (aw: number, ah: number, bw: number, bh: number): IVector2D {\n    return {\n        x: aw / 2 - bw / 2,\n        y: ah / 2 - bh / 2,\n    };\n}\n\nexport function getDate (): string {\n    const date = new Date();\n    const year = date.getFullYear();\n    const month = (date.getMonth() + 1).toString().padStart(2, '0');\n    const day = date.getDate().toString().padStart(2, '0');\n    const minutes = (date.getHours() * 60 + date.getMinutes()).toString(36).padStart(3, '0');\n\n    return year + '_' + month + '_' + day + '_' + minutes + '_';\n}\n\nexport function gcd (a: number, b: number): number {\n    return b ? gcd(b, a % b) : a;\n}\n\nexport function reduce (numerator: number, denominator: number): [number, number] {\n    const g = gcd(numerator, denominator);\n    return [numerator / g, denominator / g];\n}\n\nexport function decToFraction (decimalNumber: number): [number, number] {\n    const len = decimalNumber.toString().length - 2;\n    const denominator = Math.pow(10, len);\n    const numerator = decimalNumber * denominator;\n    return reduce(numerator, denominator);\n}\n\n/**\n * blobObj isn't always a Blob, but rather an object, because Blob doesn't exist.\n * @param blobObj\n * @returns {string}\n */\nexport function imageBlobToUrl (blobObj: Blob): string {\n    if (!blobObj) {\n        throw new Error('blobObj is undefined or null');\n    }\n    if (window.Blob && blobObj instanceof Blob) {\n        return URL.createObjectURL(blobObj); // object url\n    } else if (blobObj.constructor.name === 'Object') {\n        const fauxBlob = (blobObj as unknown) as {type: string; encoding: string; data: string};\n        return 'data:' + fauxBlob.type + ';' + fauxBlob.encoding + ',' + fauxBlob.data; // data url\n    } else {\n        throw new Error('unknown blob format');\n    }\n}\n\nexport function dateDayDifference (dateA: string | Date, dateB: string | Date): number {\n    dateA = new Date(dateA);\n    dateB = new Date(dateB);\n    dateA.setHours(0, 0, 0, 0);\n    dateB.setHours(0, 0, 0, 0);\n    return (dateB.getTime() - dateA.getTime()) / (1000 * 60 * 60 * 24);\n}\n\nexport function copyObj<T> (obj: T): T {\n    return JSON.parse(JSON.stringify(obj));\n}\n\n/**\n * triggers Web Share API - share feature on mobile devices\n * Only works if they support file sharing - e.g. Safari can't do this yet\n * only call if BB.canShareFiles() -> true\n *\n * p = {\n *     canvas: Canvas,\n *     fileName: string,\n *     title: string\n * }\n *\n * @param p\n */\nexport function shareCanvas (p: {canvas: HTMLCanvasElement; fileName:string; title: string; callback: () => void}): void {\n    const mimetype = 'image/png';\n    const err = (): void => alert('sharing not supported');\n    p.canvas.toBlob(function (blob) {\n        if (!blob) {\n            err();\n            p.callback();\n            return;\n        }\n        try {\n            const filesArray = [new File([blob], p.fileName, {type: mimetype})];\n            navigator.share({\n                title: p.title,\n                files: filesArray,\n            } as any)\n                .then(() => {})\n                .catch(() => {\n                    err();\n            });\n        } catch(e) {\n            err();\n        }\n        p.callback();\n    }, mimetype);\n}\n\n/**\n * Prevent ipad from zooming in when double tapping. iPadOS 13 bug.\n * Give it your click event\n *\n * @param clickEvent\n * @returns {boolean}\n */\nexport function handleClick (clickEvent: Event): boolean {\n    const target: HTMLElement | null = clickEvent.target as HTMLElement;\n    if (!target) {\n        return false;\n    }\n    if (['A', 'LABEL', 'INPUT', 'SUMMARY'].includes(target.tagName) || (target as any).allowClick) {\n        return true;\n    }\n    clickEvent.preventDefault();\n    return false;\n}\n\n\nexport function createSvg (p: ISVG): SVGElement {\n    const result = document.createElementNS('http://www.w3.org/2000/svg', p.elementType);\n    Object.entries(p).forEach(([keyStr, item]) => {\n        if (keyStr === 'childrenArr') {\n            (item as ISVG[]).forEach(child => {\n                result.append(createSvg(child));\n            });\n        } else if (keyStr !== 'elementType') {\n            result.setAttribute(keyStr, item as string);\n        }\n    });\n    return result;\n}\n\nexport function throwIfNull<T> (v: T | null): T {\n    // (disabled) eslint-disable-next-line no-null/no-null\n    if (v === null) {\n        throw new Error('value is null');\n    }\n    return v;\n}\n\nexport function throwIfUndefined<T> (v: T | undefined, message = 'value is undefined'): T {\n    if (v === undefined) {\n        throw new Error(message);\n    }\n    return v;\n}\n\nexport function nullToUndefined<T> (v: T | null): T | undefined {\n    return v === null ? undefined : v;\n}\n\nconst matchMediaDark = ('matchMedia' in window) ? window.matchMedia('(prefers-color-scheme: dark)') : false;\n\nexport function isDark (): boolean {\n    return matchMediaDark && matchMediaDark.matches;\n}\n\nexport function addIsDarkListener (func: () => void): void {\n    matchMediaDark && 'addEventListener' in matchMediaDark && matchMediaDark.addEventListener('change', func);\n}\n\nexport function removeIsDarkListener (func: () => void): void {\n    matchMediaDark && 'removeEventListener' in matchMediaDark && matchMediaDark.removeEventListener('change', func);\n}","import {IKeyString} from '../../../../bb/bb-types';\nimport {dialogCounter} from '../modal-count';\nimport {BB} from '../../../../bb/bb';\nimport {LANG} from '../../../../language/language';\nimport './scroll-fix';\nimport cancelImg from '/src/app/img/ui/cancel.svg';\nimport checkImg from '/src/app/img/ui/check.svg';\n\nexport function showModal (\n    p: {\n        target: HTMLElement;\n        div?: HTMLElement; // node with content\n        message: string | Element; // can be html\n        callback?: (result: string) => void;\n        buttons?: string[]; // \"Ok\", and \"Cancel\" will be automatically translated\n        primaries?: string[];\n        type?: 'error' | 'warning' | 'upload' | 'ok'; // todo\n        closeFunc?: (f: () => void) => void; // returns a function you can call to close (Cancel) the dialog\n        style?: IKeyString;\n        clickOnEnter?: string; // name of button - will be clicked if enter key pressed\n        autoFocus?: false | string; // name of  to automatically focus - default 'Ok' - false -> none\n        ignoreBackground?: boolean; // default false; if true clicking on background doesn't close\n    }\n): {\n    setIgnoreBackground: (b: boolean) => void;\n} {\n    dialogCounter.increase();\n    let isClosed = false;\n    let ignoreBackground = !!p.ignoreBackground;\n\n    // need this extra layer because chrome mobile otherwise scrolls the page and then glitches as the address bar goes away\n    const rootRootEl = BB.el({\n        parent: document.body,\n        css: {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            right: '0',\n            bottom: '0',\n            overflow: 'hidden',\n        },\n    });\n    const rootEl = BB.el({\n        parent: rootRootEl,\n        className: 'kl-popup',\n    });\n\n    const scrollContent = BB.el({\n        parent: rootEl,\n        css: {\n            width: '100%',\n            minHeight: '100%',\n            // padding: '10px 0',\n            position: 'relative',\n            display: 'flex',\n            flexDirection: 'column',\n            justifyContent: 'center',\n            alignItems: 'center',\n        },\n    });\n\n    const bgEl = BB.el({\n        parent: scrollContent,\n        onClick: () => {\n            if (ignoreBackground) {\n                return;\n            }\n            close('Cancel');\n        },\n        css: {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            zIndex: '0',\n            width: '100%',\n            height: '100%',\n        },\n    });\n\n    const titleHeight = 40;\n    const xButton = BB.el({\n        tagName: 'button',\n        className: 'popup-x',\n        content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\n        title: LANG('modal-close'),\n        onClick: () => {\n            close('Cancel');\n        },\n        css: {\n            width: titleHeight + 'px',\n            height: titleHeight + 'px',\n            lineHeight: titleHeight + 'px',\n            position: 'absolute',\n            right: '0',\n            top: '0',\n            background: 'none',\n            boxShadow: 'none',\n        },\n    });\n\n    let icon: HTMLElement | undefined = undefined;\n    if (p.type) {\n\n        icon = BB.el({\n            className: {\n                error: 'kl-popup__icon-error',\n                ok: 'kl-popup__icon-ok',\n                warning: 'kl-popup__icon-warning',\n                upload: 'kl-popup__icon-upload',\n            }[p.type],\n        });\n    }\n\n    const boxClasses = ['kl-popup-box'];\n    boxClasses.push('kl-popup-box--sm');\n    const boxEl = BB.el({\n        content: [\n            xButton,\n            icon,\n            BB.el({\n                content: p.message,\n                css: {\n                    marginRight: '15px',\n                    marginBottom: p.div ? '10px' : undefined,\n                },\n            }),\n            p.div,\n        ],\n        className: boxClasses.join(' '),\n        css: p.style ? p.style : undefined,\n    });\n\n    scrollContent.append(\n        BB.el({\n            css: {\n                flex: '0.5',\n            },\n        }),\n        boxEl,\n        BB.el({\n            css: {\n                flex: '1',\n            },\n        })\n    );\n\n    const keyListener = new BB.KeyListener({\n        onDown: function (keyStr, e, comboStr): void {\n            if (isClosed) {\n                return;\n            }\n            if (clickOnEnterBtn && comboStr === 'enter' && !BB.isInputFocused()) {\n                e.stopPropagation();\n                setTimeout(() => {\n                    clickOnEnterBtn && clickOnEnterBtn.click();\n                }, 10);\n            }\n            if (comboStr === 'esc') {\n                e.stopPropagation();\n                close('Cancel');\n            }\n        },\n    });\n    // prevent ctrl scroll -> zooming page\n    const wheelPrevent = (event: WheelEvent): void => {\n        if (keyListener.isPressed('ctrl')) {\n            event.preventDefault();\n        }\n    };\n    rootEl.addEventListener('wheel', wheelPrevent);\n    rootEl.onclick = BB.handleClick;\n\n    let autoFocus: string | undefined;\n    if (p.autoFocus) {\n        autoFocus = p.autoFocus;\n    } else if (p.autoFocus === false) {\n        autoFocus = undefined;\n    } else {\n        autoFocus = 'Ok';\n    }\n\n    const buttonRowEl = p.buttons && p.buttons.length > 0 ? BB.el({\n        parent: boxEl,\n        css: {\n            display: 'flex',\n            flexWrap: 'wrap',\n            justifyContent: 'flex-end',\n            marginTop: '12px', // 8px already via buttons\n            marginLeft: '-8px',\n        },\n    }) : undefined;\n    let clickOnEnterBtn: HTMLButtonElement | undefined;\n    const btnElArr: HTMLButtonElement[] = [];\n    if (p.buttons) {\n        p.buttons.forEach(buttonName => {\n            const btnClasses = ['kl-popup__btn'];\n            if (buttonName === 'Ok' || (p.primaries && p.primaries.includes(buttonName))) {\n                btnClasses.push('kl-button-primary');\n            }\n            let iconUrl;\n            let label = buttonName;\n            if (buttonName === 'Ok') {\n                label = LANG('modal-ok');\n                iconUrl = checkImg;\n            }\n            if (buttonName === 'Cancel') {\n                label = LANG('modal-cancel');\n                iconUrl = cancelImg;\n                btnClasses.push('kl-button-cancel');\n            }\n            let iconImg: HTMLElement | undefined = undefined;\n            if (iconUrl) {\n                iconImg = BB.el({\n                    tagName: 'img',\n                    custom: {\n                        src: iconUrl,\n                        height: '17',\n                    },\n                });\n            }\n            const btn = BB.el({\n                parent: buttonRowEl,\n                tagName: 'button',\n                className: btnClasses.join(' '),\n                content: [\n                    iconImg,\n                    BB.el({\n                        className: 'kl-popup__btn__text',\n                        content: label,\n                    }),\n                ],\n                onClick: () => {\n                    close(buttonName);\n                },\n            });\n            btnElArr.push(btn);\n            if (autoFocus === buttonName) {\n                setTimeout(() => {\n                    btn.focus();\n                    rootEl.scrollTo(0, 0);\n                }, 10);\n                setTimeout(() => {\n                    // safari needs a separate timeout\n                    rootEl.scrollTo(0, 0);\n                }, 20);\n            }\n            if (buttonName === p.clickOnEnter) {\n                clickOnEnterBtn = btn;\n            }\n        });\n    }\n\n    function close (value: string): void {\n        if (isClosed) {\n            return;\n        }\n\n        isClosed = true;\n        BB.clearSelection();\n        BB.unfocusAnyInput();\n        rootRootEl.remove();\n        dialogCounter.decrease();\n        BB.destroyEl(xButton);\n        BB.destroyEl(bgEl);\n        keyListener.destroy();\n        rootEl.removeEventListener('wheel', wheelPrevent);\n        // (disabled) eslint-disable-next-line no-null/no-null\n        rootEl.onclick = null;\n        btnElArr.forEach(item => BB.destroyEl(item));\n        btnElArr.splice(0, btnElArr.length);\n\n        if (p.callback) {\n            p.callback(value);\n        }\n    }\n\n    if (p.closeFunc) {\n        p.closeFunc(function () {\n            close('Cancel');\n        });\n    }\n\n    return {\n        setIgnoreBackground: (b: boolean) => {\n            ignoreBackground = b;\n        },\n    } as const;\n}","\n// not the best\n\n/**\n * how many modals are open\n */\n\nexport class DialogCounter {\n    private listeners: ((v: number) => void)[] = [];\n    private count = 0;\n\n    private emit (): void {\n        this.listeners.forEach(item => {\n            item(this.count);\n        });\n    }\n\n    increase (v?: number): void {\n        if (v !== undefined) {\n            this.count += v;\n        } else {\n            this.count++;\n        }\n        this.emit();\n    }\n    decrease (v?: number): void {\n        if (v !== undefined) {\n            this.count -= v;\n        } else {\n            this.count--;\n        }\n        this.emit();\n    }\n    get (): number {\n        return this.count;\n    }\n    subscribe (listener: (v: number) => void): void {\n        this.listeners.push(listener);\n    }\n}\n\nexport const dialogCounter = new DialogCounter();\n","import {\n    append,\n    centerWithin,\n    copyObj,\n    createSvg,\n    css,\n    dateDayDifference,\n    decToFraction,\n    fitInto,\n    gcd,\n    getDate,\n    handleClick,\n    imageBlobToUrl,\n    insertAfter, isDark,\n    loadImage, nullToUndefined,\n    reduce,\n    setAttributes,\n    shareCanvas,\n    throwIfNull,\n} from './base/base';\nimport {\n    canShareFiles,\n    eventUsesHighResTimeStamp,\n    hasPointerEvents,\n    isCssMinMaxSupported, unsetEventHandler,\n} from './base/browser';\nimport {KeyListener, sameKeys} from './input/key-listener';\nimport {PointerListener} from './input/pointer-listener';\nimport {\n    canvasBounds,\n    convertToAlphaChannelCanvas,\n    copyCanvas,\n    createCheckerCanvas,\n    createCheckerDataUrl,\n    ctx,\n    drawTransformedImageOnCanvas,\n    drawTransformedImageWithBounds,\n    freeCanvas,\n    resizeCanvas,\n    testShouldPixelate,\n} from './base/canvas';\nimport {Matrix} from './math/matrix';\nimport {Vec2} from './math/vec2';\nimport {BezierLine, PointLine, projectPointOnLine, quadraticSplineInput, SplineInterpolator} from './math/line';\nimport {CMYK, ColorConverter, HSV, RGB, testIsWhiteBestContrast} from './color/color';\nimport {\n    appendTextDiv,\n    clearSelection,\n    destroyEl,\n    el,\n    isInputFocused,\n    makeUnfocusable,\n    unfocusAnyInput,\n} from './base/ui';\nimport {\n    boundsInArea,\n    clamp,\n    dist,\n    distSquared,\n    intDxy,\n    isInsideRect,\n    lenSquared,\n    mix,\n    pointsToAngleDeg,\n    pointsToAngleRad,\n    rotate,\n    rotateAround,\n    round,\n    roundEven,\n    roundUneven,\n    updateBounds,\n} from './math/math';\nimport {createCanvas} from './base/create-canvas';\nimport {BbLog} from './base/bb-log';\nimport {LocalStorage} from './base/local-storage';\nimport {CoalescedExploder} from './input/event-chain/coalesced-exploder';\nimport {NFingerTapper} from './input/event-chain/n-finger-tapper';\nimport {PinchZoomer} from './input/event-chain/pinch-zoomer';\nimport {DoubleTapper} from './input/event-chain/double-tapper';\nimport {OnePointerLimiter} from './input/event-chain/one-pointer-limiter';\nimport {EventChain} from './input/event-chain/event-chain';\n\nexport const BB = {\n\n    // ---- browser ----\n    eventUsesHighResTimeStamp,\n    hasPointerEvents,\n    isCssMinMaxSupported,\n    canShareFiles,\n    unsetEventHandler,\n\n    // ---- base ----\n    insertAfter,\n    loadImage,\n    css,\n    setAttributes,\n    append,\n    fitInto,\n    centerWithin,\n    getDate,\n    gcd,\n    reduce,\n    decToFraction,\n    imageBlobToUrl,\n    dateDayDifference,\n    copyObj,\n    shareCanvas,\n    handleClick,\n    createSvg,\n    BbLog,\n    LocalStorage,\n    throwIfNull,\n    nullToUndefined,\n    isDark,\n\n    // ---- math ----\n    mix,\n    dist,\n    distSquared,\n    lenSquared,\n    pointsToAngleRad,\n    pointsToAngleDeg,\n    isInsideRect,\n    clamp,\n    rotate,\n    rotateAround,\n    Matrix,\n    Vec2,\n    intDxy,\n    roundEven,\n    roundUneven,\n    round,\n    updateBounds,\n    boundsInArea,\n\n    // ---- line ----\n    projectPointOnLine,\n    PointLine,\n    BezierLine,\n    SplineInterpolator,\n    quadraticSplineInput,\n\n    // ---- canvas ----\n    canvas: createCanvas,\n    ctx,\n    copyCanvas,\n    testShouldPixelate,\n    drawTransformedImageWithBounds,\n    drawTransformedImageOnCanvas,\n    createCheckerCanvas,\n    createCheckerDataUrl,\n    resizeCanvas,\n    convertToAlphaChannelCanvas,\n    freeCanvas,\n    canvasBounds,\n\n    // ---- color ----\n    HSV,\n    RGB,\n    CMYK,\n    ColorConverter,\n    testIsWhiteBestContrast,\n\n    // ---- UI ----\n    appendTextDiv,\n    clearSelection,\n    makeUnfocusable,\n    el,\n    destroyEl,\n    isInputFocused,\n    unfocusAnyInput,\n\n\n    // ---- events / input ----\n\n    KeyListener,\n    PointerListener,\n    sameKeys,\n\n    EventChain,\n    DoubleTapper,\n    NFingerTapper,\n    PinchZoomer,\n    CoalescedExploder,\n    OnePointerLimiter,\n};\n\nObject.keys(BB); // without this, parcel build may break this object","\nexport const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\n\nexport const eventUsesHighResTimeStamp = (function (): (() => boolean) {\n    const eventUsesHighResTimeStamp: boolean = new Event('').timeStamp < 1000 * 60 * 60;\n    return function (): boolean {\n        return eventUsesHighResTimeStamp;\n    };\n})();\n\nexport const hasPointerEvents = !!window.PointerEvent;\n\nexport const isCssMinMaxSupported = (function (): (() => boolean) {\n    let result: boolean | undefined;\n\n    function test (): void {\n        const div = document.createElement('div');\n        div.style.position = 'absolute';\n        div.style.top = '0';\n        div.style.left = 'max(0px, 25px)';\n        document.body.append(div);\n        setTimeout(function () {\n            result = div.offsetLeft === 25;\n            div.remove();\n        }, 25);\n    }\n\n    if (document.body) {\n        test();\n    } else {\n        window.addEventListener('DOMContentLoaded', function () {\n            test();\n        });\n    }\n\n    return function (): boolean {\n        if (result === undefined) {\n            throw new Error('isCssMinMaxSupported not initialized');\n        }\n        return result;\n    };\n})();\n\nexport const canShareFiles = function (): boolean {\n    return 'share' in navigator && 'canShare' in navigator;\n};\n\ntype THandler = 'onchange' | 'onclick' | 'onkeyup';\nexport function unsetEventHandler (obj: HTMLElement, ...handlers: [...THandler[]]): void {\n    handlers.forEach(handler => {\n        // (disabled) eslint-disable-next-line no-null/no-null\n        obj[handler] = null;\n    });\n}","import {IKeyString} from '../bb-types';\n\ntype TGlobalKey = {\n    add: (keyListenerRef: TKeyListenerRef) => void;\n    remove: (keyListenerRef: TKeyListenerRef) => void;\n    getIsDown: () => TIsDown;\n    getCombo: () => string[];\n}\n\ntype TIsDown = {\n    [key: string]: boolean;\n};\n\nexport type TOnKeyDown = (keyStr: string, e: KeyboardEvent, comboStr: string, isRepeat?: boolean) => void;\nexport type TOnKeyUp = (keyStr: string, e: KeyboardEvent, oldComboStr: string) => void;\ntype TOnBlur = () => void;\ntype TKeyListenerRef = [\n    TOnKeyDown | undefined,\n    TOnKeyUp | undefined,\n    TOnBlur | undefined,\n];\n\n\nconst globalKey = ((): TGlobalKey => {\n\n    // keyStr - our key naming system\n    // key - KeyboardEvent.key\n    // code - KeyboardEvent.code\n\n    const keyStrToKeyObj = { // keyStr not to contain a '+', because that's used for the comboStr\n        'space': [' ', 'Spacebar'], // Spacebar in IE\n        'alt': ['Alt', 'AltGraph'],\n        'shift': 'Shift',\n        'ctrl': 'Control',\n        'cmd': ['Meta', 'MetaLeft', 'MetaRight'],\n        'enter': 'Enter',\n        'esc': 'Escape',\n        'backspace': 'Backspace',\n        'delete': 'Delete',\n        'sqbr_open': '[',\n        'sqbr_close': ']',\n        'a': ['a', 'A'],\n        'b': ['b', 'B'],\n        'c': ['c', 'C'],\n        'e': ['e', 'E'],\n        'f': ['f', 'F'],\n        'g': ['g', 'G'],\n        'r': ['r', 'R'], // when holding shift\n        's': ['s', 'S'],\n        't': ['t', 'T'],\n        'u': ['u', 'U'],\n        'x': ['x', 'X'],\n        'y': ['y', 'Y'],\n        'z': ['z', 'Z'],\n        'plus': '+',\n        'minus': '-',\n        'left': 'ArrowLeft',\n        'right': 'ArrowRight',\n        'up': 'ArrowUp',\n        'down': 'ArrowDown',\n        'home': 'Home',\n        'end': 'End',\n    };\n\n    // ['space', 'alt', ... ]\n    const keyStrArr = Object.keys(keyStrToKeyObj);\n\n    // { space: false, ... }\n    const isDownObj: TIsDown = Object.entries(keyStrToKeyObj).reduce((acc, [key]) => {\n        acc[key] = false;\n        return acc;\n    }, {} as TIsDown);\n\n    // event.key to keyStr\n    // { ArrowLeft: 'left', ... }\n    const keyToKeyStrObj = Object.entries(keyStrToKeyObj).reduce((acc, [key, code]) => {\n        if (typeof code === 'string') {\n            acc[code] = key;\n        } else {\n            code.forEach(item => {\n                acc[item] = key;\n            });\n        }\n        return acc;\n    }, {} as IKeyString);\n\n    let comboArr: string[] = [];\n\n    // a physical key's \"key\" can change as other keys get pressed. to keep track, need to also track the code\n    // { KeyE: 'e', KeyF: undefined } - undefined - not down, string - the associated keyStr\n    let codeIsDownObj: {\n        [key: string]: string | undefined;\n    } = {};\n    const listenerArr: TKeyListenerRef[] = [];\n\n\n    const emitDown: TOnKeyDown = function (a, b, c, d?): void {\n        listenerArr.forEach(item => {\n            if (!item[0]) {\n                return;\n            }\n            item[0](a, b, c, d);\n        });\n    };\n\n    const emitUp: TOnKeyUp = function (a, b, c): void {\n        listenerArr.forEach(item => {\n            if (!item[1]) {\n                return;\n            }\n            item[1](a, b, c);\n        });\n    };\n\n    const emitBlur: TOnBlur = function (): void {\n        listenerArr.forEach(item => {\n            if (!item[2]) {\n                return;\n            }\n            item[2]();\n        });\n    };\n\n    function keyDown (e: KeyboardEvent): void {\n        const key = e.key;\n        const code = e.code;\n\n        if (key in keyToKeyStrObj) {\n            const keyStr = keyToKeyStrObj[key];\n            if (isDownObj[keyStr]) {\n                emitDown(keyStr, e, comboArr.join('+'), true);\n                return;\n            }\n            isDownObj[keyStr] = true;\n            codeIsDownObj[code] = keyStr;\n\n            //add to combo\n            comboArr.push(keyStr);\n\n            emitDown(keyStr, e, comboArr.join('+'));\n        }\n    }\n\n\n    function keyUp (e: KeyboardEvent): void {\n        const code = e.code;\n        const oldComboStr = comboArr.join('+');\n\n        // because of a macOS bug: when meta key is down, keyup of other keys does not fire.\n        // https://stackoverflow.com/questions/25438608/javascript-keyup-isnt-called-when-command-and-another-is-pressed\n        if ([\n            'Meta', 'MetaLeft', 'MetaRight',\n            'OSLeft', 'OSRight', // Firefox\n        ].includes(code)) {\n            blur();\n            return;\n        }\n\n        const keyStr = codeIsDownObj[code];\n        if (keyStr !== undefined) {\n            isDownObj[keyStr] = false;\n            codeIsDownObj[code] = undefined;\n\n            // remove from combo\n            for (let i = 0; i < comboArr.length; i++) {\n                if (comboArr[i] == keyStr) {\n                    comboArr.splice(i, 1);\n                    i--;\n                }\n            }\n\n            emitUp(keyStr, e, oldComboStr);\n        }\n    }\n\n    function blur (): void {\n        const oldComboStr = comboArr.join('+');\n        comboArr = [];\n        codeIsDownObj = {};\n\n        const eventArr: string[] = [];\n        keyStrArr.forEach(keyStr => {\n            if (isDownObj[keyStr]) {\n                isDownObj[keyStr] = false;\n                eventArr.push(keyStr);\n            }\n        });\n        for (let i = 0; i < eventArr.length; i++) {\n            emitUp(\n                eventArr[i],\n                {\n                    preventDefault: function () {},\n                    stopPropagation: function () {},\n                } as KeyboardEvent,\n                oldComboStr,\n            );\n        }\n        emitBlur();\n    }\n\n\n\n    return {\n        add: (keyListenerRef: TKeyListenerRef): void => {\n            if (listenerArr.includes(keyListenerRef)) {\n                return;\n            }\n            const first = listenerArr.length === 0;\n            listenerArr.push(keyListenerRef);\n\n            if (first) {\n                document.addEventListener('keydown', keyDown);\n                document.addEventListener('keyup', keyUp);\n                window.addEventListener('blur', blur);\n            }\n        },\n        remove: (keyListenerRef: TKeyListenerRef): void => {\n            if (!listenerArr.includes(keyListenerRef)) {\n                return;\n            }\n            const last = listenerArr.length === 1;\n            for (let i = 0; i < listenerArr.length; i++) {\n                if (listenerArr[i] === keyListenerRef) {\n                    listenerArr.splice(i, 1);\n                    break;\n                }\n            }\n            if (last) {\n                document.removeEventListener('keydown', keyDown);\n                document.removeEventListener('keyup', keyUp);\n                window.removeEventListener('blur', blur);\n            }\n        },\n        getIsDown: (): TIsDown => isDownObj,\n        getCombo: (): string[] => comboArr,\n    };\n})();\n\n\n\n/**\n * Listens to key events in window. Makes combos easier - e.g. ctrl + z\n *\n * keyStr - see in implementation - my representation of a key. e.g. 'r' can be 'r' and 'R'\n * comboStr - string joins currently pressed keyStr with a +\n *              e.g. 'ctrl+z'\n *\n */\nexport class KeyListener {\n\n    private readonly onDown: TOnKeyDown | undefined;\n    private readonly onUp: TOnKeyUp | undefined;\n    private readonly onBlur: TOnBlur | undefined;\n    private readonly ref: TKeyListenerRef;\n\n    constructor (\n        p: {\n            onDown?: TOnKeyDown;\n            onUp?: TOnKeyUp;\n            onBlur?: TOnBlur;\n        },\n    ) {\n        this.onDown = p.onDown;\n        this.onUp = p.onUp;\n        this.onBlur = p.onBlur;\n        this.ref = [this.onDown, this.onUp, this.onBlur];\n        globalKey.add(this.ref);\n    }\n\n    isPressed (keyStr: string): boolean {\n        if (!(keyStr in globalKey.getIsDown())) {\n            throw 'key \"' + keyStr + '\" not found';\n        }\n        return globalKey.getIsDown()[keyStr];\n    }\n\n    getComboStr (): string {\n        return globalKey.getCombo().join('+');\n    }\n\n    comboOnlyContains (keyStrArr: string[]): boolean {\n        for (let i = 0; i < globalKey.getCombo().length; i++) {\n            if (!keyStrArr.includes(globalKey.getCombo()[i])) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    destroy (): void {\n        globalKey.remove(this.ref);\n    }\n}\n\n/**\n * Test, are the same keys pressed. Order does not matter.\n */\nexport function sameKeys (comboAStr: string, comboBStr: string): boolean {\n    return comboAStr.split('+').sort().join('+') === comboBStr.split('+').sort().join('+');\n}","import {eventUsesHighResTimeStamp, hasPointerEvents, isFirefox} from '../base/browser';\nimport {WheelCleaner} from './wheel-cleaner';\nimport {IPointerEvent, IWheelEvent, TPointerButton, TPointerEventType, TPointerType} from './event.types';\nimport {PressureNormalizer} from './pressure-normalizer';\n\nexport interface IPointerListenerParams {\n    target: HTMLElement | SVGElement;\n    onPointer?: (pointerEvent: IPointerEvent) => void;\n    onWheel?: (wheelEvent: IWheelEvent) => void;\n    onEnterLeave?: (isOver: boolean) => void; // optional\n    maxPointers?: number; // int [1,n] default is 1 - how many concurrent pointers to pay attention to\n    fixScribble?: boolean; // fix ipad scribble issue - TODO remove, fixed start of 2022 -> https://bugs.webkit.org/show_bug.cgi?id=217430#c2\n}\n\ninterface IPointer {\n    pointerId: number;\n    lastPageX: number | null;\n    lastPageY: number | null;\n}\n\ninterface IDragObj {\n    pointerId: number; // long\n    pointerType?: TPointerType;\n    downPageX: number; //where was pointer when down-event occurred\n    downPageY: number;\n    buttons: number; // long\n    lastPageX: number; //pageX in previous event - only for touch events, because they don't have movementX/Y\n    lastPageY: number;\n    lastTimeStamp?: number;\n}\n\ninterface ICoalescedPointerEvent {\n    pageX: number;\n    pageY: number;\n    clientX: number;\n    clientY: number;\n    movementX: number;\n    movementY: number;\n    timeStamp: number;\n    pressure: number;\n}\n\ninterface ICorrectedPointerEvent {\n    pointerId: number;\n    pointerType: string;\n    pageX: number;\n    pageY: number;\n    clientX: number;\n    clientY: number;\n    movementX: number;\n    movementY: number;\n    timeStamp: number;\n    pressure: number; // normalized\n    buttons: number;\n    button: number;\n    coalescedArr: ICoalescedPointerEvent[];\n    eventPreventDefault: () => void;\n    eventStopPropagation: () => void;\n}\n\ninterface TExtendedDOMPointerEvent extends PointerEvent {\n    corrected: ICorrectedPointerEvent;\n}\n\n\n// keeping track of pointers for movement fallback\nconst pointerArr: IPointer[] = [];\n\nfunction addPointer (event: ICorrectedPointerEvent): IPointer {\n    const pointerObj: IPointer = {\n        pointerId: event.pointerId,\n        lastPageX: null,\n        lastPageY: null,\n    };\n    pointerArr.push(pointerObj);\n\n    if (pointerArr.length > 15) {\n        pointerArr.shift();\n    }\n\n    return pointerObj;\n}\n\nfunction getPointer (event: ICorrectedPointerEvent): IPointer | null {\n    for (let i = pointerArr.length - 1; i >= 0; i--) {\n        if (event.pointerId === pointerArr[i].pointerId) {\n            return pointerArr[i];\n        }\n    }\n    return null;\n}\n\nfunction getButtonStr (buttons: number): TPointerButton | undefined {\n    switch (buttons) {\n        case 1:\n            return 'left';\n        case 2:\n            return 'right';\n        case 4:\n            return 'middle';\n        default:\n            return undefined;\n    }\n}\n\nconst pressureNormalizer = new PressureNormalizer();\nconst timeStampOffset = eventUsesHighResTimeStamp() ? 0 : -performance.timing.navigationStart;\n\n\nconst pointerDownEvt = (hasPointerEvents ? 'pointerdown' : 'mousedown') as 'pointerdown';\nconst pointerMoveEvt = (hasPointerEvents ? 'pointermove' : 'mousemove') as 'pointermove';\nconst pointerUpEvt = (hasPointerEvents ? 'pointerup' : 'mouseup') as 'pointerup';\nconst pointerCancelEvt = (hasPointerEvents ? 'pointercancel' : 'mousecancel') as 'pointercancel';\nconst pointerLeaveEvt = (hasPointerEvents ? 'pointerleave' : 'mouseleave') as 'pointerleave';\nconst pointerEnterEvt = (hasPointerEvents ? 'pointerenter' : 'mouseenter') as 'pointerenter';\n\n\n/**\n * More trustworthy pointer attributes. that behave the same across browsers.\n * returns a new object. Also attaches itself to the orig event. -> event.corrected\n */\nfunction correctPointerEvent (event: PointerEvent | TExtendedDOMPointerEvent): ICorrectedPointerEvent {\n    if ('corrected' in event) {\n        return event.corrected;\n    }\n\n    function determineButtons (): number {\n        if (event.buttons !== undefined) {\n            return event.buttons;\n        }\n        /*\n                button -> buttons\n        none:\tundefined -> 0\n        left:\t0 -> 1\n        middle:\t1 -> 4\n        right:\t2 -> 2\n        fourth:\t3 -> 8\n        fifth:\t4 -> 16\n         */\n        if (event.button !== undefined) { // old safari on mac has no buttons. remove eventually.\n            return [1,4,2,8,16][event.button];\n        }\n        return 0;\n    }\n\n    const correctedObj: ICorrectedPointerEvent = {\n        pointerId: event.pointerId,\n        pointerType: event.pointerType,\n        pageX: event.pageX,\n        pageY: event.pageY,\n        clientX: event.clientX,\n        clientY: event.clientY,\n        movementX: event.movementX,\n        movementY: event.movementY,\n        timeStamp: event.timeStamp + timeStampOffset,\n        pressure: pressureNormalizer.normalize(event.pressure),\n        buttons: determineButtons(),\n        button: event.button,\n        coalescedArr: [],\n        eventPreventDefault: () => event.preventDefault(),\n        eventStopPropagation: () => event.stopPropagation(),\n    };\n    (event as TExtendedDOMPointerEvent).corrected = correctedObj;\n\n    let customPressure = null;\n    if ('pointerId' in event) {\n        if ('pressure' in event && event.buttons !== 0 && (['mouse'].includes(event.pointerType) || (event.pointerType === 'touch' && event.pressure === 0))) {\n            correctedObj.pressure = 1;\n            customPressure = 1;\n        }\n    } else {\n        correctedObj.pointerId = 0;\n        correctedObj.pointerType = 'mouse';\n        correctedObj.pressure = (event as PointerEvent).buttons !== 0 ? 1 : 0;\n        customPressure = correctedObj.pressure;\n    }\n\n    if (isFirefox && event.pointerType != 'mouse' && event.type === 'pointermove' && event.buttons === 0) { // once again firefox\n        correctedObj.buttons = 1; // todo wrong if no buttons actually pressed\n    }\n\n    let coalescedEventArr: PointerEvent[] = [];\n    if ('getCoalescedEvents' in event) {\n        coalescedEventArr = event.getCoalescedEvents();\n    }\n\n    // chrome somehow movementX not same scale as pageX. todo: only chrome?\n    // so make my own\n\n    const pointerObj: IPointer = getPointer(correctedObj) || addPointer(correctedObj);\n\n    const totalLastX = pointerObj.lastPageX;\n    const totalLastY = pointerObj.lastPageY;\n\n    for (let i = 0; i < coalescedEventArr.length; i++) {\n        const eventItem = coalescedEventArr[i];\n\n        correctedObj.coalescedArr.push({\n            pageX: eventItem.pageX,\n            pageY: eventItem.pageY,\n            clientX: eventItem.clientX,\n            clientY: eventItem.clientY,\n            movementX: pointerObj.lastPageX === null ? 0 : eventItem.pageX - pointerObj.lastPageX,\n            movementY: pointerObj.lastPageY === null ? 0 : eventItem.pageY - pointerObj.lastPageY,\n            timeStamp: eventItem.timeStamp === 0 ? correctedObj.timeStamp : (eventItem.timeStamp + timeStampOffset), // 0 in firefox\n            pressure: customPressure === null ? pressureNormalizer.normalize(eventItem.pressure) : customPressure,\n        });\n\n        pointerObj.lastPageX = eventItem.pageX;\n        pointerObj.lastPageY = eventItem.pageY;\n    }\n\n    pointerObj.lastPageX = correctedObj.pageX;\n    pointerObj.lastPageY = correctedObj.pageY;\n    correctedObj.movementX = totalLastX === null ? 0 : pointerObj.lastPageX - totalLastX;\n    correctedObj.movementY = totalLastY === null ? 0 : pointerObj.lastPageY - totalLastY;\n\n    return correctedObj;\n}\n\n/**\n * PointerListener - for pointer events, wheel events. uses fallbacks. ideally consistent behavior across browsers.\n * Has some workarounds for browser specific bugs. As browsers evolve this constructor should get smaller.\n */\nexport class PointerListener {\n\n    private isDestroyed: boolean = false;\n\n    // ts has problems with (HTMLElement|SVGElement) when adding event listeners\n    // https://github.com/microsoft/TypeScript/issues/46819\n    private readonly targetElement: HTMLElement;\n    private readonly onPointerCallback: undefined | ((pointerEvent: IPointerEvent) => void);\n    private readonly onWheelCallback: undefined | ((wheelEvent: IWheelEvent) => void);\n    private readonly onEnterLeaveCallback: undefined | ((isOver: boolean) => void);\n    private readonly maxPointers: number;\n    private readonly wheelCleaner: WheelCleaner;\n    private isOverCounter: number = 0;\n\n    // pointers that are pressing a button\n    private dragObjArr: IDragObj[] = [];\n    private dragPointerIdArr: number[] = [];\n\n    // chrome input glitch workaround\n    private lastPointerType: TPointerType | null = null;\n    private didSkip: boolean = false;\n\n    // listeners\n    private readonly onPointerEnter: (() => void) | undefined;\n    private readonly onPointerLeave: (() => void) | undefined;\n    private readonly onPointerMove: ((event: PointerEvent) => void) | undefined;\n    private readonly onPointerDown: ((event: PointerEvent, skipGlobal?: boolean) => void) | undefined;\n    private readonly onWheel: ((e: WheelEvent) => void) | undefined;\n    private readonly onTouchMoveScribbleFix: ((e: TouchEvent) => void) | undefined;\n    private readonly windowOnPointerMove: ((event: PointerEvent) => void) | undefined;\n    private readonly windowOnPointerUp: ((event: PointerEvent) => void) | undefined;\n    private readonly windowOnPointerLeave: ((event: PointerEvent) => void) | undefined;\n    // fallback pre pointer events (iOS < 13, as of 2023-02, still 4.4% of iOS users)\n    private readonly onTouchStart: ((e: TouchEvent) => void) | undefined;\n    private readonly onTouchMove: ((e: TouchEvent) => void) | undefined;\n    private readonly onTouchEnd: ((e: TouchEvent) => void) | undefined;\n    private readonly onTouchCancel: ((e: TouchEvent) => void) | undefined;\n\n\n    private getDragObj (pointerId: number): IDragObj | null {\n        for (let i = 0; i < this.dragObjArr.length; i++) {\n            if (pointerId === this.dragObjArr[i].pointerId) {\n                return this.dragObjArr[i];\n            }\n        }\n        return null;\n    }\n\n    private removeDragObj (pointerId: number): IDragObj | null {\n        let removedDragObj: IDragObj | null = null;\n        for (let i = 0; i < this.dragPointerIdArr.length; i++) {\n            if (this.dragPointerIdArr[i] === pointerId) {\n                removedDragObj = this.dragObjArr[i];\n                this.dragObjArr.splice(i, 1);\n                this.dragPointerIdArr.splice(i, 1);\n                i--;\n            }\n        }\n        return removedDragObj;\n    }\n\n    /**\n     * Creates a value for onPointer, from a pointer event handler.\n     */\n    private createPointerOutEvent (\n        typeStr: TPointerEventType,\n        correctedEvent: ICorrectedPointerEvent,\n        custom?: Partial<IPointerEvent>,\n    ): IPointerEvent {\n\n        const bounds: DOMRect = this.targetElement.getBoundingClientRect();\n        const result: IPointerEvent = {\n            type: typeStr,\n            pointerId: correctedEvent.pointerId,\n            pointerType: correctedEvent.pointerType as TPointerType,\n            pageX: correctedEvent.pageX,\n            pageY: correctedEvent.pageY,\n            clientX: correctedEvent.clientX,\n            clientY: correctedEvent.clientY,\n            relX: correctedEvent.clientX - bounds.left + this.targetElement.scrollLeft,\n            relY: correctedEvent.clientY - bounds.top + this.targetElement.scrollTop,\n            dX: correctedEvent.movementX,\n            dY: correctedEvent.movementY,\n            time: correctedEvent.timeStamp,\n            eventPreventDefault: correctedEvent.eventPreventDefault,\n            eventStopPropagation: correctedEvent.eventStopPropagation,\n            ...custom,\n        };\n\n        if (typeStr === 'pointermove') {\n            result.coalescedArr = [];\n            if (correctedEvent.coalescedArr.length > 1) {\n                let coalescedItem;\n                for (let i = 0; i < correctedEvent.coalescedArr.length; i++) {\n                    coalescedItem = correctedEvent.coalescedArr[i];\n                    result.coalescedArr.push({\n                        pageX: coalescedItem.pageX,\n                        pageY: coalescedItem.pageY,\n                        clientX: coalescedItem.clientX,\n                        clientY: coalescedItem.clientY,\n                        relX: coalescedItem.clientX - bounds.left + this.targetElement.scrollLeft,\n                        relY: coalescedItem.clientY - bounds.top + this.targetElement.scrollTop,\n                        dX: coalescedItem.movementX,\n                        dY: coalescedItem.movementY,\n                        time: coalescedItem.timeStamp,\n                    });\n                }\n            }\n        }\n\n        return result;\n    }\n\n    private setupDocumentListeners () {\n        this.windowOnPointerMove && document.addEventListener(pointerMoveEvt, this.windowOnPointerMove);\n        this.windowOnPointerUp && document.addEventListener(pointerUpEvt, this.windowOnPointerUp);\n        this.windowOnPointerLeave && document.addEventListener(pointerCancelEvt, this.windowOnPointerLeave);\n        this.windowOnPointerLeave && document.addEventListener(pointerLeaveEvt, this.windowOnPointerLeave);\n    }\n\n    private destroyDocumentListeners () {\n        this.windowOnPointerMove && document.removeEventListener(pointerMoveEvt, this.windowOnPointerMove);\n        this.windowOnPointerUp && document.removeEventListener(pointerUpEvt, this.windowOnPointerUp);\n        this.windowOnPointerLeave && document.removeEventListener(pointerCancelEvt, this.windowOnPointerLeave);\n        this.windowOnPointerLeave && document.removeEventListener(pointerLeaveEvt, this.windowOnPointerLeave);\n    }\n\n\n    // ---- public ----\n\n    constructor (p: IPointerListenerParams) {\n        this.targetElement = p.target as HTMLElement;\n        this.onPointerCallback = p.onPointer;\n        this.onWheelCallback = p.onWheel;\n        this.onEnterLeaveCallback = p.onEnterLeave;\n        this.maxPointers = Math.max(1, p.maxPointers || 1);\n\n\n        this.wheelCleaner = new WheelCleaner((cleanerEvent) => {\n            if (this.isDestroyed || !this.onWheelCallback) {\n                return;\n            }\n            const bounds = this.targetElement.getBoundingClientRect();\n            const whlEvent = {\n                ...cleanerEvent,\n                relX: cleanerEvent.clientX - bounds.left + this.targetElement.scrollLeft,\n                relY: cleanerEvent.clientY - bounds.top + this.targetElement.scrollTop,\n            };\n            this.onWheelCallback(whlEvent);\n        });\n\n        if (this.onPointerCallback) {\n            this.onPointerMove = (event: PointerEvent) => {\n                const correctedEvent = correctPointerEvent(event);\n\n                const tempLastPointerType = this.lastPointerType;\n                this.lastPointerType = correctedEvent.pointerType as TPointerType;\n\n                if (\n                    this.dragPointerIdArr.includes(correctedEvent.pointerId) ||\n                    this.dragPointerIdArr.length === this.maxPointers ||\n                    correctedEvent.pointerType === 'touch'\n                ) {\n                    this.didSkip = false;\n                    return;\n                }\n\n                // chrome input glitch workaround - throws in a random mouse event with the wrong position when using a stylus\n                if (!this.didSkip && correctedEvent.pointerType === 'mouse' && tempLastPointerType === 'pen') {\n                    this.didSkip = true;\n                    return;\n                }\n                this.didSkip = false;\n\n                const outEvent = this.createPointerOutEvent('pointermove', correctedEvent);\n                this.onPointerCallback && this.onPointerCallback(outEvent);\n            };\n\n            this.onPointerDown = (event: PointerEvent, onSkipGlobal? : boolean) => {\n\n                //BB.throwOut('pointerdown ' + event.pointerId + ' | ' + dragPointerIdArr.length);\n                const correctedEvent = correctPointerEvent(event);\n                ////console.log('debug: ' + event.pointerId + ' pointerdown');\n                if (this.dragPointerIdArr.includes(correctedEvent.pointerId) || this.dragPointerIdArr.length === this.maxPointers || ![1, 2, 4].includes(correctedEvent.buttons)) {\n                    //BB.throwOut('pointerdown ignored');\n                    return;\n                }\n\n                //set up global listeners\n                if (this.dragObjArr.length === 0 && !onSkipGlobal) {\n                    this.setupDocumentListeners();\n                }\n                const dragObj: IDragObj = {\n                    pointerId: correctedEvent.pointerId,\n                    pointerType: correctedEvent.pointerType as TPointerType,\n                    downPageX: correctedEvent.pageX,\n                    downPageY: correctedEvent.pageY,\n                    buttons: correctedEvent.buttons,\n                    lastPageX: correctedEvent.pageX,\n                    lastPageY: correctedEvent.pageY,\n                    lastTimeStamp: correctedEvent.timeStamp,\n                };\n                this.dragObjArr.push(dragObj);\n                this.dragPointerIdArr.push(correctedEvent.pointerId);\n\n                const outEvent: IPointerEvent = this.createPointerOutEvent('pointerdown', correctedEvent, {\n                    downPageX: correctedEvent.pageX,\n                    downPageY: correctedEvent.pageY,\n                    button: getButtonStr(correctedEvent.buttons),\n                    pressure: correctedEvent.pressure,\n                });\n\n                this.onPointerCallback && this.onPointerCallback(outEvent);\n            };\n\n            this.windowOnPointerMove = (event: PointerEvent) => {\n                //BB.throwOut('pointermove ' + event.pointerId);\n                const correctedEvent = correctPointerEvent(event);\n                ////console.log('debug: ' + event.pointerId + ' GLOBALpointermove');\n                if (!(this.dragPointerIdArr.includes(correctedEvent.pointerId))) {\n                    return;\n                }\n\n                const dragObj = this.getDragObj(correctedEvent.pointerId);\n\n                if (!dragObj) {\n                    // todo need to handle this!\n                    return;\n                }\n\n                //if pointer changes button its pressing -> turn into pointerup\n                if (correctedEvent.buttons !== dragObj.buttons) {\n                    //pointer up\n\n                    //remove listener\n                    if (this.dragObjArr.length === 1) {\n                        this.destroyDocumentListeners();\n                    }\n                    this.removeDragObj(correctedEvent.pointerId);\n\n                    const outEvent = this.createPointerOutEvent('pointerup', correctedEvent, {\n                        downPageX: dragObj.downPageX,\n                        downPageY: dragObj.downPageY,\n                    });\n                    this.onPointerCallback && this.onPointerCallback(outEvent);\n                    return;\n                }\n\n                // ipad likes to do this\n                if (\n                    correctedEvent.pointerType === 'pen' &&\n                    correctedEvent.pageX === dragObj.lastPageX &&\n                    correctedEvent.pageY === dragObj.lastPageY &&\n                    correctedEvent.timeStamp === dragObj.lastTimeStamp\n                ) {\n                    //ignore\n                    return;\n                }\n\n                const outEvent = this.createPointerOutEvent('pointermove', correctedEvent, {\n                    downPageX: dragObj.downPageX,\n                    downPageY: dragObj.downPageY,\n                    button: getButtonStr(correctedEvent.buttons),\n                    pressure: correctedEvent.pressure,\n                });\n\n                dragObj.lastPageX = correctedEvent.pageX;\n                dragObj.lastPageY = correctedEvent.pageY;\n                dragObj.lastTimeStamp = correctedEvent.timeStamp;\n\n                this.onPointerCallback && this.onPointerCallback(outEvent);\n            };\n\n            this.windowOnPointerUp = (event: PointerEvent) => {\n                //BB.throwOut('pointerup ' + event.pointerId);\n                const correctedEvent = correctPointerEvent(event);\n                ////console.log('debug: ' + event.pointerId + ' GLOBALpointerup');\n                if (!(this.dragPointerIdArr.includes(correctedEvent.pointerId))) {\n                    return;\n                }\n\n                //remove listener\n                if (this.dragObjArr.length === 1) {\n                    this.destroyDocumentListeners();\n                }\n                const dragObj = this.removeDragObj(correctedEvent.pointerId);\n                if (!dragObj) {\n                    // todo need to handle this!\n                    return;\n                }\n\n                const outEvent = this.createPointerOutEvent('pointerup', correctedEvent, {\n                    downPageX: dragObj.downPageX,\n                    downPageY: dragObj.downPageY,\n                });\n                this.onPointerCallback && this.onPointerCallback(outEvent);\n\n            };\n\n            this.windowOnPointerLeave = (event: PointerEvent) => {\n                //BB.throwOut('pointerleave ' + event.pointerId);\n                const correctedEvent = correctPointerEvent(event);\n                ////console.log('debug: ' + event.pointerId + ' onGlobalPointerLeave', event);\n                if (!(this.dragPointerIdArr.includes(correctedEvent.pointerId))) { //} || event.target !== document) {\n                    return;\n                }\n\n                //remove listener\n                if (this.dragObjArr.length === 1) {\n                    this.destroyDocumentListeners();\n                }\n                const dragObj = this.removeDragObj(correctedEvent.pointerId);\n                if (!dragObj) {\n                    // todo need to handle this!\n                    return;\n                }\n\n                const outEvent = this.createPointerOutEvent('pointerup', correctedEvent, {\n                    downPageX: dragObj.downPageX,\n                    downPageY: dragObj.downPageY,\n                });\n                this.onPointerCallback && this.onPointerCallback(outEvent);\n            };\n\n            this.targetElement.addEventListener(pointerMoveEvt, this.onPointerMove);\n            this.targetElement.addEventListener(pointerDownEvt, this.onPointerDown);\n\n            if (!hasPointerEvents) {\n                const touchToFakePointer = (touch: Touch, touchEvent: TouchEvent, isDown: boolean) => {\n                    return {\n                        pointerId: touch.identifier,\n                        pointerType: 'touch',\n                        pageX: touch.pageX,\n                        pageY: touch.pageY,\n                        clientX: touch.clientX,\n                        clientY: touch.clientY,\n                        button: isDown ? 0 : undefined,\n                        buttons: isDown ? 1 : 0,\n                        timeStamp: touchEvent.timeStamp,\n                        target: touchEvent.target,\n                        pressure: isDown ? 1 : 0,\n                        preventDefault: () => touchEvent.preventDefault(),\n                        stopPropagation: () => touchEvent.stopPropagation(),\n                    };\n                };\n\n                const handleTouch = (e: TouchEvent, type: 'start' | 'move' | 'end' | 'cancel'): void => {\n                    for (let i = 0; i < e.changedTouches.length; i++) {\n                        const touch = e.changedTouches[i];\n                        const fakePointer = touchToFakePointer(touch, e, ['start', 'move'].includes(type));\n                        if (type === 'start') {\n                            this.onPointerDown!(fakePointer as PointerEvent, false);\n                        } else if (type === 'move') {\n                            this.windowOnPointerMove!(fakePointer as PointerEvent);\n                        } else if (type === 'end') {\n                            this.windowOnPointerUp!(fakePointer as PointerEvent);\n                        } else {\n                            this.windowOnPointerLeave!(fakePointer as PointerEvent);\n                        }\n                    }\n                };\n\n                this.onTouchStart = (e: TouchEvent): void => {\n                    e.preventDefault();\n                    handleTouch(e, 'start');\n                };\n                this.onTouchMove = (e: TouchEvent): void => {\n                    handleTouch(e, 'move');\n                };\n                this.onTouchEnd = (e: TouchEvent): void => {\n                    handleTouch(e, 'end');\n                };\n                this.onTouchCancel = (e: TouchEvent): void => {\n                    handleTouch(e, 'cancel');\n                };\n\n                this.targetElement.addEventListener('touchstart', this.onTouchStart);\n                this.targetElement.addEventListener('touchmove', this.onTouchMove);\n                this.targetElement.addEventListener('touchend', this.onTouchEnd);\n                this.targetElement.addEventListener('touchcancel', this.onTouchCancel);\n            }\n        }\n        if (this.onWheelCallback) {\n            this.onWheel = (e: WheelEvent) => {\n                this.wheelCleaner.process(e);\n            };\n            this.targetElement.addEventListener('wheel', this.onWheel);\n        }\n        if (this.onEnterLeaveCallback) {\n            this.onPointerEnter = () => {\n                this.isOverCounter++;\n                this.onEnterLeaveCallback && this.onEnterLeaveCallback(true);\n            };\n\n            this.onPointerLeave = () => {\n                this.isOverCounter--;\n                this.onEnterLeaveCallback && this.onEnterLeaveCallback(false);\n            };\n\n            this.targetElement.addEventListener(pointerEnterEvt, this.onPointerEnter);\n            this.targetElement.addEventListener(pointerLeaveEvt, this.onPointerLeave);\n        }\n\n        if (p.fixScribble) {\n            //ipad scribble workaround https://developer.apple.com/forums/thread/662874\n            this.onTouchMoveScribbleFix = (e: TouchEvent) => e.preventDefault();\n            this.targetElement.addEventListener('touchmove', this.onTouchMoveScribbleFix);\n        }\n    }\n\n    destroy (): void {\n        if (this.isDestroyed) {\n            return;\n        }\n        this.isDestroyed = true;\n        this.onPointerEnter && this.targetElement.removeEventListener(pointerEnterEvt, this.onPointerEnter);\n        this.onPointerLeave && this.targetElement.removeEventListener(pointerLeaveEvt, this.onPointerLeave);\n        this.onPointerMove && this.targetElement.removeEventListener(pointerMoveEvt, this.onPointerMove);\n        this.onPointerDown && this.targetElement.removeEventListener(pointerDownEvt, this.onPointerDown);\n        this.onWheel && this.targetElement.removeEventListener('wheel', this.onWheel);\n        this.destroyDocumentListeners();\n        this.onTouchMoveScribbleFix && document.removeEventListener('touchmove', this.onTouchMoveScribbleFix);\n\n        this.onTouchStart && this.targetElement.removeEventListener('touchstart', this.onTouchStart);\n        this.onTouchMove && this.targetElement.removeEventListener('touchmove', this.onTouchMove);\n        this.onTouchEnd && this.targetElement.removeEventListener('touchend', this.onTouchEnd);\n        this.onTouchCancel && this.targetElement.removeEventListener('touchcancel', this.onTouchCancel);\n    }\n\n}","export interface IWheelCleanerEvent {\n    deltaY: number;\n    pageX: number;\n    pageY: number;\n    clientX: number;\n    clientY: number;\n}\n\nconst SEQUENCE_TIMEOUT_MS = 200;\n\n/**\n * Filters wheel events. removes swipe scrolling and pinch scrolling that trackpads do. (as best as it can)\n * Normalizes regular scrolls.\n *\n * Why:\n * - trackpad scrolling is different from old school mouse scrolling\n * - but there is no way to learn from the browser if it's trackpad scrolling\n * - browsers don't even give access to the raw swiping or pinching movement, but some abstraction on top, making the scrolling\n *      continue an arbitrary amount, at an arbitrary scale\n * - each browser does this differently. So you can't offer a consistent/controlled experience\n *\n * - also trackpads are painful to draw with. So supporting a trackpad-based workflow makes not much sense.\n */\nexport class WheelCleaner {\n\n    private readonly knownUnitArr: number[] = [100];\n    private sequenceLength: number = 0;\n    private sequenceUnit: null | number = null;\n    private endSequenceTimeout: undefined | ReturnType<typeof setTimeout>;\n    private toEmitDelta: null | number = null;\n    private position: null | {\n        pageX: number;\n        pageY: number;\n        clientX: number;\n        clientY: number;\n    } = null;\n\n\n    private emit (delta: number): void {\n        if (this.position === null || this.sequenceUnit === null) {\n            return;\n        }\n        this.callback({\n            deltaY: Math.round(delta / this.sequenceUnit),\n            pageX: this.position.pageX,\n            pageY: this.position.pageY,\n            clientX: this.position.clientX,\n            clientY: this.position.clientY,\n        });\n    }\n\n    private endSequence (): void {\n        if (this.toEmitDelta !== null) {\n            this.emit(this.toEmitDelta);\n            this.toEmitDelta = null;\n        }\n        if (this.sequenceUnit !== null && !(this.knownUnitArr.includes(this.sequenceUnit))) {\n            this.knownUnitArr.push(this.sequenceUnit);\n        }\n        this.sequenceLength = 0;\n        this.sequenceUnit = null;\n    }\n\n\n    // ---- public ----\n\n    constructor (private callback: (p: IWheelCleanerEvent) => void) {}\n\n    process (event: WheelEvent): void {\n        this.position = {\n            pageX: event.pageX,\n            pageY: event.pageY,\n            clientX: event.clientX,\n            clientY: event.clientY,\n        };\n\n        if (this.endSequenceTimeout) {\n            clearTimeout(this.endSequenceTimeout);\n        }\n        this.endSequenceTimeout = setTimeout(() => this.endSequence(), SEQUENCE_TIMEOUT_MS);\n\n        //prep delta\n        let delta = event.deltaY;\n        if ('deltaMode' in event && event.deltaMode === 1) {\n            delta *= 100 / 3;\n        }\n        const absDelta = Math.abs(delta);\n\n        //sequence begins\n        if (this.sequenceLength === 0) {\n            this.sequenceLength++;\n            if (absDelta < 50) {\n                //dirty - probably a swipe scroll or pinch scroll on trackpad\n                return;\n            }\n\n            this.sequenceUnit = absDelta;\n            if (this.knownUnitArr.includes(this.sequenceUnit)) {\n                //we know this unit - emit right away\n                this.emit(delta);\n            } else {\n                //unknown unit - wait until next event or sequence end, to have more certainty that it's clean\n                this.toEmitDelta = delta;\n            }\n            return;\n        }\n\n        if (this.sequenceUnit === null) {\n            //previously determined dirty sequence\n            this.toEmitDelta = null;\n            return;\n        }\n\n        //sequence continues\n        if (absDelta === 0) {\n            //ignore zero scroll\n            return;\n        }\n        if (\n            absDelta === this.sequenceUnit ||\n            (absDelta / this.sequenceUnit) % 1 < 0.0001// a multiple\n        ) {\n            //fine\n        } else if ((this.sequenceUnit / absDelta) % 1 < 0.0001) {\n            //unit was actually a multiple - update it\n            this.sequenceUnit = absDelta;\n\n        } else if (absDelta !== this.sequenceUnit) {\n            //not clean - delta is varying - probably a swipe scroll or pinch scroll on trackpad\n            this.sequenceUnit = null;\n            this.toEmitDelta = null;\n            return;\n        }\n\n\n        if (this.toEmitDelta !== null) {\n            this.emit(this.toEmitDelta);\n            this.toEmitDelta = null;\n        }\n        this.emit(delta);\n    }\n\n}\n","import {mix} from '../math/math';\n\n/**\n * different devices/browsers have different pressure curves\n * pressure normalize attempts to achieve similar mapping\n *\n * pressure range [0, 1]\n */\nexport class PressureNormalizer {\n    \n    private count: number = 0;\n    private avgPressure: number = 0; // float [0, 1]\n    private normalizeIsComplete: boolean = false;\n    private normalizeFactor: number = 1;\n    \n    // ---- public ----\n    normalize (pressure: number): number {\n        if (pressure === 0 || pressure === 1) {\n            return pressure;\n        }\n\n        if (this.count < 60) {\n            if (this.count === 0 || this.count === null) {\n                this.avgPressure = pressure;\n            } else {\n                this.avgPressure = mix(pressure, this.avgPressure, 0.95);\n            }\n            this.count++;\n        } else if (!this.normalizeIsComplete) {\n            this.normalizeIsComplete = true;\n            //BB.throwOut('avg pressure decision!' + this.avgPressure);\n            if (this.avgPressure < 0.13) { // absurd pressure needed\n                this.normalizeFactor = 2.3;\n            }\n        }\n\n        return Math.pow(pressure, 1 / this.normalizeFactor);\n    }\n    \n}","import {IBounds, IRect, IVector2D} from '../bb-types';\n\nexport function mix (a: number, b: number, f: number): number {\n    return a * (1 - f) + b * f;\n}\n\nexport function dist (ax: number, ay: number, bx: number, by: number): number {\n    return Math.sqrt(Math.pow(ax - bx, 2) + Math.pow(ay - by, 2));\n}\n\nexport function distSquared (ax: number, ay: number, bx: number, by: number): number {\n    // faster because no square-root\n    return Math.pow(ax - bx, 2) + Math.pow(ay - by, 2);\n}\n\nexport function lenSquared (x: number, y: number): number {\n    // faster because no square-root\n    return x * x + y * y;\n}\n\nexport function pointsToAngleRad (p1: IVector2D, p2: IVector2D): number {\n    return Math.atan2(p2.y - p1.y, p2.x - p1.x);\n}\n\nexport function pointsToAngleDeg (p1: IVector2D, p2: IVector2D): number {\n    return pointsToAngleRad(p1, p2) * 180 / Math.PI;\n}\n\nexport function isInsideRect (p: IVector2D, rect: IRect): boolean {\n    return rect.x <= p.x && p.x <= rect.x + rect.width &&\n        rect.y <= p.y && p.y <= rect.y + rect.height;\n}\n\nexport function clamp (num: number, min: number, max: number): number {\n    return num < min\n        ? min\n        : num > max\n            ? max\n            : num;\n}\n\nexport function rotate (x: number, y: number, deg: number): IVector2D {\n    const theta = deg * (Math.PI / 180);\n    const cs = Math.cos(theta);\n    const sn = Math.sin(theta);\n\n    return {\n        x: x * cs - y * sn,\n        y: x * sn + y * cs,\n    };\n}\n\nexport function rotateAround (center: IVector2D, point: IVector2D, deg: number): IVector2D {\n    const rot = rotate(point.x - center.x, point.y - center.y, deg);\n    rot.x += center.x;\n    rot.y += center.y;\n    return rot;\n}\n\nexport function intDxy (remainder: IVector2D, fDx: number, fDy: number): {dX: number; dY: number} {\n    remainder.x += fDx;\n    remainder.y += fDy;\n    const dX = Math.round(remainder.x);\n    const dY = Math.round(remainder.y);\n    remainder.x -= dX;\n    remainder.y -= dY;\n    return {\n        dX,\n        dY,\n    };\n}\n\n/**\n * return closest even number\n * @param f\n */\nexport function roundEven (f: number): number {\n    if (f % 1 === 0) {\n        if (f % 2 === 0) {\n            return f;\n        }\n        return f + 1;\n    }\n    const above = Math.ceil(f);\n    const below = Math.floor(f);\n    if (above % 2 === 0) {\n        return above;\n    } else {\n        return below;\n    }\n}\n\n/**\n * return closest uneven number\n * @param f\n */\nexport function roundUneven (f: number): number {\n    if (f % 1 === 0) {\n        if (f % 2 === 0) {\n            return f + 1;\n        }\n        return f;\n    }\n    const above = Math.ceil(f);\n    const below = Math.floor(f);\n    if (above % 2 === 1) {\n        return above;\n    } else {\n        return below;\n    }\n}\n\n/**\n * round number to certain precision.\n * round(1.2345, 2) = 1.23\n * round(1.2345, 0) = 0\n * round(123, -1) = 120\n *\n * @param f\n * @param digits\n */\nexport function round (f: number, digits: number): number {\n    const digitMult = Math.pow(10, digits);\n    return Math.round((f/* + Number.EPSILON*/) * digitMult) / digitMult;\n}\n\n/**\n * update target so it includes bounds\n * @param target\n * @param bounds\n */\nexport function updateBounds (target: IBounds | undefined, bounds: IBounds | undefined): IBounds {\n    if (!bounds && !target) {\n        throw new Error('at least one param needs to be defined');\n    }\n    if (!bounds) {\n        return target!;\n    }\n    if (!target) {\n        target = { x1: bounds.x1, y1: bounds.y1, x2: bounds.x2, y2: bounds.y2 };\n    } else {\n        target.x1 = Math.min(target.x1, bounds.x1);\n        target.y1 = Math.min(target.y1, bounds.y1);\n        target.x2 = Math.max(target.x2, bounds.x2);\n        target.y2 = Math.max(target.y2, bounds.y2);\n    }\n    return target;\n}\n\n/**\n * determine overlap of bounds with width&height\n */\nexport function boundsInArea (bounds: IBounds | undefined, width: number, height: number): IBounds | undefined {\n    if (!bounds) {\n        return undefined;\n    }\n    const x1 = Math.max(0, bounds.x1);\n    const y1 = Math.max(0, bounds.y1);\n    const x2 = Math.min(width - 1, bounds.x2);\n    const y2 = Math.min(height - 1, bounds.y2);\n    if (x1 > x2 || y1 > y2) {\n        return undefined;\n    }\n    return { x1, y1, x2, y2 };\n}","import {IBounds, IKeyString, IRect} from '../bb-types';\nimport {createCanvas} from './create-canvas';\nimport {copyObj} from './base';\n\nexport function copyCanvas (canvas: HTMLCanvasElement): HTMLCanvasElement {\n    const resultCanvas = createCanvas(canvas.width, canvas.height);\n    const ctx = resultCanvas.getContext('2d');\n    if (!ctx) {\n        throw new Error('2d context not supported or canvas already initialized');\n    }\n    ctx.drawImage(canvas, 0, 0);\n    return resultCanvas;\n}\n\nexport function ctx (canvas: HTMLCanvasElement, options?: CanvasRenderingContext2DSettings): CanvasRenderingContext2D {\n    const ctx = canvas.getContext('2d', options);\n    if (!ctx) {\n        throw new Error(\"couldn't get 2d context\");\n    }\n    return ctx;\n}\n\n/**\n * Determine if we should disable imageSmoothing for transformation.\n * ImageSmoothing can make images blurry even when they're in the original scale and aligned with the pixelgrid.\n */\nexport function testShouldPixelate (\n    transform: {x: number; y: number; width:number; height: number; angleDeg: number},\n    scaleX: number,\n    scaleY: number,\n): boolean {\n    if (\n        ![1, -1].includes(scaleX) || ![1, -1].includes(scaleY) ||\n        transform.width % 1 !== 0 || transform.height % 1 !== 0 ||\n        Math.abs(transform.angleDeg) % 90 !== 0\n    ) {\n        return false;\n    }\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\n    const width = whSwapped ? transform.height : transform.width;\n    const height = whSwapped ? transform.width : transform.height;\n    return (\n            (Math.abs(width) % 2 === 0 && transform.x % 1 === 0) ||\n            (Math.abs(width) % 2 === 1 && transform.x % 1 === 0.5)\n        ) &&\n        (\n            (Math.abs(height) % 2 === 0 && transform.y % 1 === 0) ||\n            (Math.abs(height) % 2 === 1 && transform.y % 1 === 0.5)\n        );\n}\n\n\n/**\n * @param destCtx - the canvas that will be drawn on\n * @param transformImage - image that will be drawn on canvas\n * @param transform - {x, y, width, height, angle} - x and y are center of transformImage\n * @param bounds object - optional {x, y, width, height} - crop of transformImage in transformImage image space\n * @param pixelated\n */\nexport function drawTransformedImageWithBounds (\n    destCtx: CanvasRenderingContext2D,\n    transformImage: HTMLImageElement | HTMLCanvasElement,\n    transform: {x: number; y: number; width:number; height: number; angleDeg: number},\n    bounds?: {x: number; y: number; width: number; height: number},\n    pixelated?: boolean,\n): void {\n    if (!bounds) {\n        bounds = {\n            x: 0,\n            y: 0,\n            width: transformImage.width,\n            height: transformImage.height,\n        };\n    }\n\n    destCtx.save();\n    if (pixelated) {\n        destCtx.imageSmoothingEnabled = false;\n    } else {\n        destCtx.imageSmoothingEnabled = true;\n        destCtx.imageSmoothingQuality = 'high';\n    }\n\n    destCtx.translate(transform.x, transform.y);\n    destCtx.rotate(transform.angleDeg / 180 * Math.PI);\n    destCtx.scale(transform.width > 0 ? 1 : -1, transform.height > 0 ? 1 : -1);\n    destCtx.drawImage(\n        transformImage,\n        bounds.x, bounds.y, bounds.width, bounds.height,\n        -Math.abs(transform.width) / 2, -Math.abs(transform.height) / 2, Math.abs(transform.width), Math.abs(transform.height));\n\n    destCtx.restore();\n}\n\n/**\n * all transformations are optional\n * center is the point around which will be scaled and rotated\n *\n * @param baseCanvas canvas - the canvas that will be drawn on\n * @param transformImage image|canvas - image that will be drawn on canvas\n * @param transformObj {center: {x, y}, scale: {x, y}, translate: {x, y}, angleDegree}\n */\nexport function drawTransformedImageOnCanvas (\n    baseCanvas: HTMLCanvasElement,\n    transformImage: HTMLImageElement | HTMLCanvasElement,\n    transformObj: {\n        center: {x: number; y: number};\n        scale: {x: number; y: number};\n        translate: {x: number; y: number};\n        angleDegree: number;\n    },\n): void {\n    transformObj = copyObj(transformObj);\n    if (!transformObj.center) {\n        transformObj.center = {\n            x: transformImage.width / 2,\n            y: transformImage.height / 2,\n        };\n    }\n    if (!transformObj.scale) {\n        transformObj.scale = {\n            x: 1,\n            y: 1,\n        };\n    }\n    if (!transformObj.angleDegree) {\n        transformObj.angleDegree = 0;\n    }\n    if (!transformObj.translate) {\n        transformObj.translate = {\n            x: 0,\n            y: 0,\n        };\n    }\n\n    const ctx = baseCanvas.getContext('2d');\n    if (!ctx) {\n        throw new Error('2d context not supported or canvas already initialized');\n    }\n    ctx.save();\n    if (\n        Math.abs(transformObj.scale.x - 1) >  0.000001 ||\n        Math.abs(transformObj.scale.y - 1) > 0.000001 ||\n        Math.abs(transformObj.angleDegree % 90) > 0.000001\n    ) {\n        ctx.imageSmoothingEnabled = true;\n        ctx.imageSmoothingQuality = 'high';\n    } else {\n        ctx.imageSmoothingEnabled = false;\n    }\n\n    ctx.translate(transformObj.translate.x, transformObj.translate.y);\n    ctx.translate(transformObj.center.x, transformObj.center.y);\n    ctx.rotate(transformObj.angleDegree / 180 * Math.PI);\n    ctx.scale(transformObj.scale.x, transformObj.scale.y);\n    ctx.translate(-transformObj.center.x, -transformObj.center.y);\n    ctx.drawImage(transformImage, 0, 0, transformImage.width, transformImage.height);\n\n    ctx.restore();\n}\n\nexport const createCheckerCanvas = function (size: number, isDark?: boolean): HTMLCanvasElement {\n    const canvas = createCanvas();\n    let ctx;\n    if (size < 1) {\n        canvas.width = 1;\n        canvas.height = 1;\n        ctx = canvas.getContext('2d');\n        if (!ctx) {\n            throw new Error('2d context not supported or canvas already initialized');\n        }\n        ctx.fillStyle = 'rgb(128, 128, 128)';\n        ctx.fillRect(0, 0, 1, 1);\n    } else if (size > 200) {\n        canvas.width = 401;\n        canvas.height = 401;\n    } else {\n        canvas.width = size * 2;\n        canvas.height = size * 2;\n        ctx = canvas.getContext('2d');\n        if (!ctx) {\n            throw new Error('2d context not supported or canvas already initialized');\n        }\n        ctx.fillStyle = isDark ? 'rgb(90, 90, 90)' : 'rgb(255, 255, 255)';\n        ctx.fillRect(0, 0, size * 2, size * 2);\n        ctx.fillStyle = isDark ? 'rgb(63, 63, 63)': 'rgb(200, 200, 200)';\n        ctx.fillRect(0, 0, size, size);\n        ctx.fillRect(size, size, size * 2, size * 2);\n    }\n    return canvas;\n};\n\nexport const createCheckerDataUrl = (function () {\n    const cache: IKeyString = { // previously created dataUrls\n        '8l': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMElEQVQ4T2M8ceLEfwY8wNzcHJ80A+OoAcMiDP7//483HZw8eRJ/Ohg1gIFx6IcBAIhJUqnarXQ1AAAAAElFTkSuQmCC',\n        '4l': 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAJ0lEQVQoU2M8ceLEfwYkYG5ujsxlYKSDgv///6O44eTJk6huoL0CAGsOKVVu8UYvAAAAAElFTkSuQmCC',\n    };\n\n    return function (size: number, callback?: (s: string) => void, isDark?: boolean): string | void {\n        const modeStr = isDark ? 'd' : 'l';\n\n        function create (size: number): string {\n            size = parseInt('' + size);\n            if (cache['' + size + modeStr]) {\n                return cache['' + size + modeStr];\n            }\n            const canvas = createCheckerCanvas(size, isDark);\n            const result = canvas.toDataURL('image/png');\n            cache['' + size + modeStr] = result;\n            return result;\n        }\n\n        if (callback) { //async\n            setTimeout(function () {\n                callback(create(size));\n            }, 1);\n        } else { //sync\n            return create(size);\n        }\n    };\n})();\n\n/**\n * smooth resize image\n * @param canvas canvas - will be resized (modified)\n * @param w\n * @param h\n * @param tmp1 canvas - optional, provide to save resources\n * @param tmp2 canvas - optional, provide to save resources\n */\nexport function resizeCanvas (\n    canvas: HTMLCanvasElement,\n    w: number,\n    h: number,\n    tmp1?: HTMLCanvasElement,\n    tmp2?: HTMLCanvasElement,\n): void {\n\n    //determine base 2 exponents of old and new size\n    function getBase2Obj (oldW: number, oldH: number, newW: number, newH: number) {\n        const result = {\n            oldWidthEx: Math.round(Math.log2(oldW)),\n            oldHeightEx: Math.round(Math.log2(oldH)),\n            newWidthEx: Math.ceil(Math.log2(newW)),\n            newHeightEx: Math.ceil(Math.log2(newH)),\n        };\n        result.oldWidthEx = Math.max(result.oldWidthEx, result.newWidthEx);\n        result.oldHeightEx = Math.max(result.oldHeightEx, result.newHeightEx);\n        return result;\n    }\n\n    if (!w || !h || (w === canvas.width && h === canvas.height)) {\n        return;\n    }\n    w = Math.max(w, 1);\n    h = Math.max(h, 1);\n    if (w <= canvas.width && h <= canvas.height) {\n\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\n        tmp2 = !tmp2 ? createCanvas() : tmp2;\n\n        const base2 = getBase2Obj(canvas.width, canvas.height, w, h);\n\n        //initially scale to a base of 2. unless new size is too close to old. e.g. sizing from 900 to 600\n        tmp2.width = base2.oldWidthEx > base2.newWidthEx ? Math.pow(2, base2.oldWidthEx) : w;\n        tmp2.height = base2.oldHeightEx > base2.newHeightEx ? Math.pow(2, base2.oldHeightEx) : h;\n        tmp1.getContext('2d')!.save();\n        tmp2.getContext('2d')!.save();\n\n        let ew, eh;\n        let buffer1 = tmp1, buffer2 = tmp2;\n\n        ew = base2.oldWidthEx;\n        eh = base2.oldHeightEx;\n\n        let bufferCtx = buffer2.getContext('2d')!;\n        bufferCtx.imageSmoothingEnabled = true;\n        bufferCtx.imageSmoothingQuality  = 'high';\n        bufferCtx.globalCompositeOperation  = 'copy';\n        bufferCtx.drawImage(canvas, 0, 0, buffer2.width, buffer2.height);\n\n        let currentWidth = buffer2.width;\n        let currentHeight = buffer2.height;\n\n        //stepwise half the size\n        for (; ew > base2.newWidthEx || eh > base2.newHeightEx; ew--, eh--) {\n            bufferCtx = buffer1.getContext('2d')!;\n            bufferCtx.imageSmoothingEnabled = true;\n            bufferCtx.imageSmoothingQuality  = 'high';\n            bufferCtx.globalCompositeOperation  = 'copy';\n\n            const newWidth = (ew > base2.newWidthEx) ? currentWidth / 2 : currentWidth;\n            const newHeight = (eh > base2.newHeightEx) ? currentHeight / 2 : currentHeight;\n\n            //buffer also needs to be properly sized, unfortunately\n            buffer1.width = newWidth;\n            buffer1.height = newHeight;\n\n            bufferCtx.drawImage(\n                buffer2,\n                0, 0,\n                currentWidth, currentHeight,\n                0, 0,\n                newWidth, newHeight\n            );\n            currentWidth = newWidth;\n            currentHeight = newHeight;\n\n            //swap\n            const tmp = buffer1;\n            buffer1 = buffer2;\n            buffer2 = tmp;\n        }\n\n        //when no longer can be halved, bring to target size\n        canvas.width = w;\n        canvas.height = h;\n        const canvasCtx = canvas.getContext('2d')!;\n        canvasCtx.save();\n        canvasCtx.imageSmoothingEnabled = true;\n        canvasCtx.imageSmoothingQuality  = 'high';\n        canvasCtx.drawImage(\n            buffer2,\n            0, 0,\n            currentWidth, currentHeight,\n            0, 0,\n            w, h\n        );\n        canvasCtx.restore();\n        tmp1.getContext('2d')!.restore();\n        tmp2.getContext('2d')!.restore();\n\n    } else if (w >= canvas.width && h >= canvas.height) {\n\n        tmp1 = !tmp1 ? createCanvas() : tmp1;\n        tmp1.width = w;\n        tmp1.height = h;\n        const tmp1Ctx = tmp1.getContext('2d')!;\n        tmp1Ctx.save();\n        tmp1Ctx.imageSmoothingEnabled = true;\n        tmp1Ctx.imageSmoothingQuality  = 'high';\n        tmp1Ctx.drawImage(canvas, 0, 0, w, h);\n        tmp1Ctx.restore();\n\n        canvas.width = w;\n        canvas.height = h;\n        canvas.getContext('2d')!.drawImage(tmp1, 0, 0);\n\n    } else {\n        resizeCanvas(canvas, w, canvas.height, tmp1, tmp2);\n        resizeCanvas(canvas, w, h, tmp1, tmp2);\n    }\n}\n\n/**\n * puts naive greyscale version of image into alpha channel.\n * only writes a, doesn't write rgb\n * @param canvas\n */\nexport function convertToAlphaChannelCanvas (canvas: HTMLCanvasElement): void {\n    const imdat = canvas.getContext('2d')!.getImageData(0, 0, canvas.width, canvas.height);\n    for (let i = 0; i < imdat.data.length; i += 4) {\n        if (imdat.data[i + 3] === 0) {\n            continue;\n        }\n        imdat.data[i + 3] = (imdat.data[i] + imdat.data[i + 1] + imdat.data[i + 2]) / 3 * (imdat.data[i + 3] / 255);\n    }\n    canvas.getContext('2d')!.putImageData(imdat, 0, 0);\n}\n\n/**\n * Sometimes garbage collection is too slow, and canvases use up too much memory,\n * or in the worst case there is a hard to fix memory leak.\n * This function manually makes the canvas use as little memory as possible.\n */\nexport function freeCanvas (canvas: HTMLCanvasElement): void {\n    canvas.width = 1;\n    canvas.height = 1;\n    canvas.remove();\n}\n\n/**\n * Determine bounding box that describes all pixels which are not fully transparent.\n * Returns null if empty.\n *\n * @param context\n */\nexport function canvasBounds (context: CanvasRenderingContext2D): IRect | undefined {\n    const boundsObj: {\n        x: number;\n        y: number;\n        width: number;\n        height: number;\n    } = { x: 0, y: 0, width: 0, height: 0 };\n    {\n        const tempBounds: Partial<IBounds> = {\n            x1: undefined,\n            y1: undefined,\n            x2: undefined,\n            y2: undefined,\n        };\n        const imdat = context.getImageData(0, 0, context.canvas.width, context.canvas.height);\n\n        if (imdat.data[3] > 0 && imdat.data[imdat.data.length - 1] > 0) {\n            tempBounds.x1 = 0;\n            tempBounds.y1 = 0;\n            tempBounds.x2 = context.canvas.width - 1;\n            tempBounds.y2 = context.canvas.height - 1;\n        } else {\n            for (let i = 3; i < imdat.data.length; i += 4) {\n                if (imdat.data[i] > 0 ) {\n                    const x = ((i - 3) / 4) %  context.canvas.width;\n                    const y = Math.floor((i - 3) / 4 / context.canvas.width);\n                    if (tempBounds.x1 === undefined || tempBounds.x1 > x) {\n                        tempBounds.x1 = x;\n                    }\n                    if (tempBounds.y1 === undefined) {\n                        tempBounds.y1 = y;\n                    }\n                    if (tempBounds.x2 === undefined || tempBounds.x2 < x) {\n                        tempBounds.x2 = x;\n                    }\n                    if (tempBounds.y2 === undefined || tempBounds.y2 < y) {\n                        tempBounds.y2 = y;\n                    }\n                }\n            }\n        }\n        if (tempBounds.x1 === undefined || tempBounds.y1 === undefined || tempBounds.x2 === undefined || tempBounds.y2 === undefined) {\n            return undefined;\n        }\n        boundsObj.x = tempBounds.x1;\n        boundsObj.y = tempBounds.y1;\n        boundsObj.width = tempBounds.x2! - tempBounds.x1 + 1;\n        boundsObj.height = tempBounds.y2! - tempBounds.y1 + 1;\n    }\n    return boundsObj;\n}","/*window['canvases'] = [];\n\nwindow['printCanvases'] = () => {\n    let total = 0;\n\n    console.log(window['canvases'].map(item => {\n        total += item.width * item.height;\n        return {w: item.width, h: item.height};\n    }));\n\n    console.log('total: ' + (total * 4 / 1000 / 1000) + 'mb');\n};*/\n\nexport function createCanvas (w?: number, h?: number): HTMLCanvasElement {\n    const result = document.createElement('canvas');\n    if (w && h) {\n        result.width = w;\n        result.height = h;\n    }\n    // window['canvases'].push(result);\n    return result;\n}","\n// https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Matrix_math_for_the_web\n// not optimized\n\ntype TMatrix4x4 = [\n    number, number, number, number,\n    number, number, number, number,\n    number, number, number, number,\n    number, number, number, number,\n];\n\nexport type TVec4 = [number, number, number, number];\n\nfunction getIdentity (): TMatrix4x4 {\n    return [\n        1, 0, 0, 0,\n        0, 1, 0, 0,\n        0, 0, 1, 0,\n        0, 0, 0, 1,\n    ];\n}\n\n// point  matrix\nfunction multiplyMatrixAndPoint (matrix: TMatrix4x4, point: TVec4): TVec4 {\n    return [\n        (point[0] * matrix[0]) + (point[1] * matrix[4]) + (point[2] * matrix[8]) + (point[3] * matrix[12]), // x\n        (point[0] * matrix[1]) + (point[1] * matrix[5]) + (point[2] * matrix[9]) + (point[3] * matrix[13]), // y\n        (point[0] * matrix[2]) + (point[1] * matrix[6]) + (point[2] * matrix[10]) + (point[3] * matrix[14]), // z\n        (point[0] * matrix[3]) + (point[1] * matrix[7]) + (point[2] * matrix[11]) + (point[3] * matrix[15]), // w\n    ];\n}\n\n//matrixB  matrixA\nfunction multiplyMatrices (matrixA: TMatrix4x4, matrixB: TMatrix4x4): TMatrix4x4 {\n\n    // Slice the second matrix up into rows\n    const row0: TVec4 = [matrixB[0], matrixB[1], matrixB[2], matrixB[3]];\n    const row1: TVec4 = [matrixB[4], matrixB[5], matrixB[6], matrixB[7]];\n    const row2: TVec4 = [matrixB[8], matrixB[9], matrixB[10], matrixB[11]];\n    const row3: TVec4 = [matrixB[12], matrixB[13], matrixB[14], matrixB[15]];\n\n    // Multiply each row by matrixA\n    const result0 = multiplyMatrixAndPoint(matrixA, row0);\n    const result1 = multiplyMatrixAndPoint(matrixA, row1);\n    const result2 = multiplyMatrixAndPoint(matrixA, row2);\n    const result3 = multiplyMatrixAndPoint(matrixA, row3);\n\n    // Turn the result rows back into a single matrix\n    return [\n        result0[0], result0[1], result0[2], result0[3],\n        result1[0], result1[1], result1[2], result1[3],\n        result2[0], result2[1], result2[2], result2[3],\n        result3[0], result3[1], result3[2], result3[3],\n    ];\n}\n\nfunction createTranslationMatrix (x: number, y: number): TMatrix4x4 {\n    return [\n        1, 0, 0, 0,\n        0, 1, 0, 0,\n        0, 0, 1, 0,\n        x, y, 0, 1,\n    ];\n}\n\nfunction createRotationMatrix (angleRad: number): TMatrix4x4 {\n    //let angleRad = angleDeg / 360 * 2 * Math.PI;\n    return [\n        Math.cos(-angleRad), -Math.sin(-angleRad), 0, 0,\n        Math.sin(-angleRad), Math.cos(-angleRad), 0, 0,\n        0, 0, 1, 0,\n        0, 0, 0, 1,\n    ];\n}\n\nfunction createScaleMatrix (f: number): TMatrix4x4 {\n    return [\n        f, 0, 0, 0,\n        0, f, 0, 0,\n        0, 0, 1, 0,\n        0, 0, 0, 1,\n    ];\n}\n\nexport const Matrix = Object.freeze({\n    getIdentity,\n    multiplyMatrixAndPoint,\n    multiplyMatrices,\n    createTranslationMatrix,\n    createRotationMatrix,\n    createScaleMatrix,\n});\n","import {IVector2D} from '../bb-types';\n\nexport const Vec2 = {\n    add: function (p1: IVector2D, p2: IVector2D): IVector2D {\n        return {x: p1.x + p2.x, y: p1.y + p2.y};\n    },\n    sub: function (p1: IVector2D, p2: IVector2D): IVector2D {\n        return {x: p1.x - p2.x, y: p1.y - p2.y};\n    },\n    nor: function (p: IVector2D): IVector2D {\n        const len = Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\n        return {x: p.x / len, y: p.y / len};\n    },\n    len: function (p: IVector2D): number {\n        return Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2));\n    },\n    dist: function (p1: IVector2D, p2: IVector2D): number {\n        return Vec2.len(Vec2.sub(p1, p2));\n    },\n    mul: function (p: IVector2D, s: number): IVector2D {\n        return {x: p.x * s, y: p.y * s};\n    },\n    angle: function (p1: IVector2D, p2: IVector2D): number {\n        return Math.atan2(p2.y - p1.y, p2.x - p1.x);\n    },\n    dot: function (a: IVector2D, b: IVector2D): number {\n        const aArr = [a.x, a.y];\n        const bArr = [b.x, b.y];\n        return aArr.map((x, i) => aArr[i] * bArr[i]).reduce((m, n) => m + n);\n    },\n};","import {Vec2} from './vec2';\nimport {clamp, dist, mix, pointsToAngleDeg} from './math';\nimport {IVector2D} from '../bb-types';\nimport {copyObj} from '../base/base';\n\n/**\n * project p onto line\n * @param lineStart\n * @param lineEnd\n * @param p\n */\nexport const projectPointOnLine = function (lineStart: IVector2D, lineEnd: IVector2D, p: IVector2D): IVector2D {\n    let x, y;\n    if (lineStart.x === lineEnd.x) {\n        x = lineStart.x;\n        y = p.y;\n\n        return {\n            x: x,\n            y: y,\n        };\n    }\n    const m = (lineEnd.y - lineStart.y) / (lineEnd.x - lineStart.x);\n    const b = lineStart.y - (m * lineStart.x);\n\n    x = (m * p.y + p.x - m * b) / (m * m + 1);\n    y = (m * m * p.y + m * p.x + b) / (m * m + 1);\n\n    return {\n        x: x,\n        y: y,\n    };\n};\n\n\n/**\n * Operations on a line made up of points\n */\nexport class PointLine {\n\n    private readonly segmentArr: {\n        x: number;\n        y: number;\n        length: number; // last is 0\n    }[];\n\n    // ---- public ----\n    constructor (\n        p: {\n            points: IVector2D[];\n        }\n    ) {\n        this.segmentArr = [];\n\n        for (let i = 0; i < p.points.length; i++) {\n            ((i) => {\n                let length = 0;\n                if (i < p.points.length - 1) {\n                    length = dist(p.points[i].x, p.points[i].y, p.points[i + 1].x, p.points[i + 1].y);\n                }\n                this.segmentArr[i] = {\n                    x: p.points[i].x,\n                    y: p.points[i].y,\n                    length: length,\n                };\n            })(i);\n        }\n    }\n\n    // ---- interface ----\n\n    /**\n     * returns point when traveling *dist* along the line, > 0\n     * @param dist\n     */\n    getAtDist (dist: number): IVector2D {\n        let remainder = Math.min(this.getLength(), dist);\n        let i = 0;\n\n        for (; remainder > this.segmentArr[i].length && i < this.segmentArr.length - 2; i++) {\n            remainder -= this.segmentArr[i].length;\n        }\n\n        const fac = Math.min(1, Math.max(0, remainder / this.segmentArr[i].length));\n\n        return {\n            x: (this.segmentArr[i].x * (1 - fac) + this.segmentArr[i + 1].x * fac),\n            y: (this.segmentArr[i].y * (1 - fac) + this.segmentArr[i + 1].y * fac),\n        };\n    }\n\n    /**\n     * total length of line\n     */\n    getLength (): number {\n        let result = 0;\n        for (let i = 0; i < this.segmentArr.length - 1; i++) {\n            result += this.segmentArr[i].length;\n        }\n        return result;\n    }\n}\n\nexport type TBezierLineCallback = (\n    v: {\n        x: number;\n        y: number;\n        t: number; // [0, 1] - how far along\n        angle?: number;\n        dAngle: number;\n    }\n) => void;\ntype TBezierLineControlsCallback = (\n    v: {\n        p1: IVector2D;\n        p2: IVector2D;\n        p3: IVector2D;\n        p4: IVector2D;\n    }\n) => void;\n\ntype TBezierLinePoint = {\n    x: number;\n    y: number;\n    spacing: number;\n    dir: IVector2D;\n};\n\n/**\n * Each instance is one line made up of bezier interpolated segments.\n * You feed it points. It calculates control points on its own, and the resulting curve.\n */\nexport class BezierLine {\n\n    private readonly pointArr: TBezierLinePoint[];\n    private lastDot: number = 0;\n    private lastPoint: IVector2D | undefined;\n    private lastCallbackPoint: IVector2D | undefined;\n    private lastAngle: number | undefined;\n    private lastSpacing: number | undefined;\n\n    /**\n     * creates bezier curve from control points\n     * @param p1 - control point 1 {x: float, y: float}\n     * @param p2 - control point 2 {x: float, y: float}\n     * @param p3 - control point 3 {x: float, y: float}\n     * @param p4 - control point 4 {x: float, y: float}\n     * @param resolution - int\n     * @returns bezier curve made up of points {x: float, y: float}\n     */\n    private getBezierPoints (p1: IVector2D, p2: IVector2D, p3: IVector2D, p4: IVector2D, resolution: number): IVector2D[] {\n        const curvePoints = [];\n        let t;\n        for (let i = 0; i <= resolution; i++) {\n            t = i / resolution;\n            curvePoints[curvePoints.length] = {\n                x: Math.pow(1 - t, 3) * p1.x + 3 * Math.pow(1 - t, 2) * t * p2.x + 3 * (1 - t) * Math.pow(t, 2) * p3.x + Math.pow(t, 3) * p4.x,\n                y: Math.pow(1 - t, 3) * p1.y + 3 * Math.pow(1 - t, 2) * t * p2.y + 3 * (1 - t) * Math.pow(t, 2) * p3.y + Math.pow(t, 3) * p4.y,\n            };\n        }\n        return curvePoints;\n    }\n\n    // ---- public ----\n    constructor () {\n        this.pointArr = [];\n    }\n\n    // ---- interface ----\n\n    /**\n     * Add new point to line. \"Drawn\" line will go until the previous point.\n     *\n     * @param x - coord of new point\n     * @param y\n     * @param spacing - space between each step\n     * @param callback - calls for each step\n     * @param controlsCallback - calls that callback with the bezier control points\n     */\n    add (\n        x: number,\n        y: number,\n        spacing: number,\n        callback?: TBezierLineCallback,\n        controlsCallback?: TBezierLineControlsCallback,\n    ): void {\n        if (this.lastPoint && x === this.lastPoint.x && y === this.lastPoint.y) {\n            return;\n        }\n        this.lastPoint = {x, y};\n        this.pointArr[this.pointArr.length] = {\n            x,\n            y,\n            spacing,\n        } as TBezierLinePoint;\n\n        //calculate directions\n        if (this.pointArr.length === 1) {\n            this.lastSpacing = spacing;\n            return;\n        } else if (this.pointArr.length === 2) {\n            this.pointArr[0].dir = Vec2.nor(Vec2.sub(this.pointArr[1], this.pointArr[0]));\n            this.lastDot = spacing;\n            this.lastSpacing = spacing;\n            return;\n        } else {\n            const pointM1 = this.pointArr[this.pointArr.length - 1];\n            const pointM2 = this.pointArr[this.pointArr.length - 2];\n            const pointM3 = this.pointArr[this.pointArr.length - 3];\n            pointM2.dir = Vec2.nor(Vec2.sub(pointM1, pointM3));\n            if (isNaN(pointM2.dir.x) || isNaN(pointM2.dir.y)) {\n                //when xy -3 == -1\n                pointM2.dir = copyObj(pointM3.dir);\n            }\n        }\n\n        //get bezier curve\n        const a = this.pointArr[this.pointArr.length - 3];\n        const b = this.pointArr[this.pointArr.length - 2];\n        const p1 = a;\n        const p2 = Vec2.add(a, Vec2.mul(a.dir, Vec2.dist(a, b) / 4));\n        const p3 = Vec2.sub(b, Vec2.mul(b.dir, Vec2.dist(a, b) / 4));\n        const p4 = b;\n\n\n        let pointLine: PointLine;\n        if (callback) {\n            const curvePoints = this.getBezierPoints(p1, p2, p3, p4, 20);\n            pointLine = new PointLine({points: curvePoints});\n        } else {\n            pointLine = new PointLine({points: [p1, p4]});\n        }\n\n        //iterate over curve with spacing and callback\n        const len = pointLine.getLength();\n        let tempSpacing = mix(this.lastSpacing!, spacing, clamp(this.lastDot / len, 0, 1));\n        let d = this.lastDot;\n        for (; d <= len; d += tempSpacing) {\n            tempSpacing = mix(this.lastSpacing!, spacing, clamp(d / len, 0, 1));\n            const point = pointLine.getAtDist(d);\n            const angle = this.lastCallbackPoint ? pointsToAngleDeg(this.lastCallbackPoint, point) : undefined;\n            if (callback) {\n                callback({\n                    x: point.x,\n                    y: point.y,\n                    t: d / len,\n                    angle: angle,\n                    dAngle: this.lastCallbackPoint ? angle! - this.lastAngle! : 0,\n                });\n            }\n            this.lastCallbackPoint = point;\n            this.lastAngle = angle;\n        }\n\n        if (callback) {\n            this.lastDot = d - len;\n        } else {\n            this.lastDot = 0;\n            controlsCallback && controlsCallback({p1: p1, p2: p2, p3: p3, p4: p4});\n        }\n\n        this.lastSpacing = spacing;\n    }\n\n    addFinal (\n        spacing: number,\n        callback?: TBezierLineCallback,\n        controlsCallback?: TBezierLineControlsCallback,\n    ): void {\n        if (this.pointArr.length < 2) {\n            return;\n        }\n\n        const p1 = this.pointArr[this.pointArr.length - 2];\n        const p2 = this.pointArr[this.pointArr.length - 1];\n\n        const newP = Vec2.add(p2, Vec2.sub(p2, p1));\n\n        this.add(newP.x, newP.y, spacing, callback, controlsCallback);\n    }\n}\n\n/**\n * from SplineInterpolator.cs in the Paint.NET source code\n */\nexport class SplineInterpolator {\n\n    private readonly xa: number[];\n    private readonly ya: number[];\n    private readonly u: number[];\n    private readonly y2: number[];\n    private readonly first: number;\n    private readonly last: number;\n\n\n    // ---- public ----\n    constructor (\n        points: [number, number][],\n    ) {\n        const n = points.length;\n        this.xa = [];\n        this.ya = [];\n        this.u = [];\n        this.y2 = [];\n        let i;\n\n        this.first = points[0][0];\n        this.last = points[points.length - 1][0];\n\n        points.sort(function (a, b) {\n            return a[0] - b[0];\n        });\n        for (i = 0; i < n; i++) {\n            this.xa.push(points[i][0]);\n            this.ya.push(points[i][1]);\n        }\n\n        this.u[0] = 0;\n        this.y2[0] = 0;\n\n        for (i = 1; i < n - 1; ++i) {\n            // This is the decomposition loop of the tridiagonal algorithm.\n            // y2 and u are used for temporary storage of the decomposed factors.\n            const wx = this.xa[i + 1] - this.xa[i - 1];\n            const sig = (this.xa[i] - this.xa[i - 1]) / wx;\n            const p = sig * this.y2[i - 1] + 2.0;\n\n            this.y2[i] = (sig - 1.0) / p;\n\n            const ddydx =\n                (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) -\n                (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\n\n            this.u[i] = (6.0 * ddydx / wx - sig * this.u[i - 1]) / p;\n        }\n\n        this.y2[n - 1] = 0;\n\n        // This is the backsubstitution loop of the tridiagonal algorithm\n        for (i = n - 2; i >= 0; --i) {\n            this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\n        }\n    }\n\n    // ---- interface ----\n\n    getFirstX (): number {\n        return this.first;\n    }\n\n    getLastX (): number {\n        return this.last;\n    }\n\n    interpolate (x: number): number {\n        const n = this.ya.length;\n        let klo = 0;\n        let khi = n - 1;\n\n        // We will find the right place in the table by means of\n        // bisection. This is optimal if sequential calls to this\n        // routine are at random values of x. If sequential calls\n        // are in order, and closely spaced, one would do better\n        // to store previous values of klo and khi.\n        while (khi - klo > 1) {\n            const k = (khi + klo) >> 1;\n\n            if (this.xa[k] > x) {\n                khi = k;\n            } else {\n                klo = k;\n            }\n        }\n\n        const h = this.xa[khi] - this.xa[klo];\n        const a = (this.xa[khi] - x) / h;\n        const b = (x - this.xa[klo]) / h;\n\n        // Cubic spline polynomial is now evaluated.\n        return a * this.ya[klo] + b * this.ya[khi] +\n            ((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h) / 6.0;\n    }\n\n    /**\n     * find x to y. simply by stepping through. suboptimal, so don't call often.\n     * searches in x 0-1 range\n     */\n    findX (y: number, resolution: number): number | undefined {\n        let x;\n        let dist: number;\n        for (let i = 0; i <= resolution; i++) {\n            const tempX = i / resolution;\n            const tempY = this.interpolate(tempX);\n            if (x === undefined) {\n                x = tempX;\n                dist = Math.abs(tempY - y);\n                continue;\n            }\n\n            const tempDist = Math.abs(tempY - y);\n\n            if (tempDist < dist!) {\n                x = tempX;\n                dist = tempDist;\n            } else {\n                //distance increasing\n                break;\n            }\n        }\n        return x;\n    }\n}\n\n\n/**\n * input for a spline, following curve of quadratic function x^2 [0 - 1]\n * returns [[0, startVal], ..., [1, endVal]]\n * @param startVal\n * @param endVal\n * @param stepSize\n */\nexport function quadraticSplineInput (\n    startVal: number,\n    endVal: number,\n    stepSize: number,\n): [number, number][] {\n    function round (v: number, dec: number): number {\n        return Math.round(v * Math.pow(10, dec)) / Math.pow(10, dec);\n    }\n\n    const resultArr: [number, number][] = [];\n    for (let i = 0; i <= 1; i += stepSize) {\n        resultArr.push([round(i, 4), round(startVal + Math.pow(i, 2) * (endVal - startVal), 4)]);\n    }\n    return resultArr;\n}","\n\n\n// based on js color conversion http://www.webtoolkit.info/\n\n\nexport class HSV {\n    h: number;\n    s: number;\n    v: number;\n    constructor (h: number, s: number, v: number) {\n        this.h = Math.max(0, Math.min(360, h));\n        this.s = Math.max(0.001, Math.min(100, s)); //bug when 0\n        this.v = Math.max(0, Math.min(100, v));\n    }\n}\n\nexport class RGB {\n    r : number;\n    g: number;\n    b: number;\n    constructor (r: number, g: number, b: number) {\n        this.r = Math.max(0, Math.min(255, r));\n        this.g = Math.max(0, Math.min(255, g));\n        this.b = Math.max(0, Math.min(255, b));\n    }\n}\n\nexport class CMYK {\n    c: number;\n    m: number;\n    y: number;\n    k: number;\n    constructor (c: number, m: number, y: number, k: number) {\n        this.c = Math.max(0, Math.min(100, c));\n        this.m = Math.max(0, Math.min(100, m));\n        this.y = Math.max(0, Math.min(100, y));\n        this.k = Math.max(0, Math.min(100, k));\n    }\n}\n\nexport const ColorConverter = {\n\n    _RGBtoHSV: function (RGB: RGB): HSV {\n        const result = new HSV(0, 0, 0);\n\n        const r = RGB.r / 255;\n        const g = RGB.g / 255;\n        const b = RGB.b / 255;\n\n        const minVal = Math.min(r, g, b);\n        const maxVal = Math.max(r, g, b);\n        const delta = maxVal - minVal;\n\n        result.v = maxVal;\n\n        if (delta == 0) {\n            result.h = 0;\n            result.s = 0;\n        } else {\n            result.s = delta / maxVal;\n            const del_R = (((maxVal - r) / 6) + (delta / 2)) / delta;\n            const del_G = (((maxVal - g) / 6) + (delta / 2)) / delta;\n            const del_B = (((maxVal - b) / 6) + (delta / 2)) / delta;\n\n            if (r == maxVal) {\n                result.h = del_B - del_G;\n            } else if (g == maxVal) {\n                result.h = (1 / 3) + del_R - del_B;\n            } else if (b == maxVal) {\n                result.h = (2 / 3) + del_G - del_R;\n            }\n\n            if (result.h < 0) {\n                result.h += 1;\n            }\n            if (result.h > 1) {\n                result.h -= 1;\n            }\n        }\n\n        result.h = Math.round(result.h * 360);\n        result.s = Math.round(result.s * 100);\n        result.v = Math.round(result.v * 100);\n\n        return result;\n    },\n\n    _HSVtoRGB: function (HSV: HSV): RGB {\n        const result = new RGB(0, 0, 0);\n\n        let var_h, var_i, var_1, var_2, var_3, var_r, var_g, var_b;\n\n        const h = (HSV.h / 360) % 1;\n        const s = HSV.s / 100;\n        const v = HSV.v / 100;\n\n        if (s == 0) {\n            result.r = v * 255;\n            result.g = v * 255;\n            result.b = v * 255;\n        } else {\n            var_h = h * 6;\n            var_i = Math.floor(var_h);\n            var_1 = v * (1 - s);\n            var_2 = v * (1 - s * (var_h - var_i));\n            var_3 = v * (1 - s * (1 - (var_h - var_i)));\n\n            if (var_i == 0) {\n                var_r = v;\n                var_g = var_3;\n                var_b = var_1;\n            } else if (var_i == 1) {\n                var_r = var_2;\n                var_g = v;\n                var_b = var_1;\n            } else if (var_i == 2) {\n                var_r = var_1;\n                var_g = v;\n                var_b = var_3;\n            } else if (var_i == 3) {\n                var_r = var_1;\n                var_g = var_2;\n                var_b = v;\n            } else if (var_i == 4) {\n                var_r = var_3;\n                var_g = var_1;\n                var_b = v;\n            } else {\n                var_r = v;\n                var_g = var_1;\n                var_b = var_2;\n            }\n\n            result.r = var_r * 255;\n            result.g = var_g * 255;\n            result.b = var_b * 255;\n\n            result.r = Math.round(result.r);\n            result.g = Math.round(result.g);\n            result.b = Math.round(result.b);\n        }\n\n        return result;\n    },\n\n    _CMYKtoRGB: function (CMYK: CMYK): RGB {\n        const result = new RGB(0, 0, 0);\n\n        const c = CMYK.c / 100;\n        const m = CMYK.m / 100;\n        const y = CMYK.y / 100;\n        const k = CMYK.k / 100;\n\n        result.r = 1 - Math.min(1, c * (1 - k) + k);\n        result.g = 1 - Math.min(1, m * (1 - k) + k);\n        result.b = 1 - Math.min(1, y * (1 - k) + k);\n\n        result.r = Math.round(result.r * 255);\n        result.g = Math.round(result.g * 255);\n        result.b = Math.round(result.b * 255);\n\n        return result;\n    },\n\n    _RGBtoCMYK: function (RGB: RGB): CMYK {\n        const result = new CMYK(0, 0, 0, 0);\n\n        const r = RGB.r / 255;\n        const g = RGB.g / 255;\n        const b = RGB.b / 255;\n\n        result.k = Math.min(1 - r, 1 - g, 1 - b);\n        result.c = (1 - r - result.k) / (1 - result.k);\n        result.m = (1 - g - result.k) / (1 - result.k);\n        result.y = (1 - b - result.k) / (1 - result.k);\n\n        result.c = Math.round(result.c * 100);\n        result.m = Math.round(result.m * 100);\n        result.y = Math.round(result.y * 100);\n        result.k = Math.round(result.k * 100);\n\n        return result;\n    },\n\n    toRGB: function (o: RGB | HSV | CMYK): RGB {\n        if (o instanceof RGB) {\n            return o;\n        }\n        if (o instanceof HSV) {\n            return this._HSVtoRGB(o);\n        }\n        if (o instanceof CMYK) {\n            return this._CMYKtoRGB(o);\n        }\n        throw new Error('unknown type');\n    },\n\n    toHSV: function (o: RGB | HSV | CMYK): HSV {\n        if (o instanceof HSV) {\n            return o;\n        }\n        if (o instanceof RGB) {\n            return this._RGBtoHSV(o);\n        }\n        if (o instanceof CMYK) {\n            return this._RGBtoHSV(this._CMYKtoRGB(o));\n        }\n        throw new Error('unknown type');\n    },\n\n    toCMYK: function (o: RGB | HSV | CMYK): CMYK {\n        if (o instanceof CMYK) {\n            return o;\n        }\n        if (o instanceof RGB) {\n            return this._RGBtoCMYK(o);\n        }\n        if (o instanceof HSV) {\n            return this._RGBtoCMYK(this._HSVtoRGB(o));\n        }\n        throw new Error('unknown type');\n    },\n    toHexString: function (o: RGB): string {\n        if (o instanceof RGB || ('r' in o && 'g' in o && 'b' in o)) {\n            let ha = (parseInt('' + o.r)).toString(16);\n            let hb = (parseInt('' + o.g)).toString(16);\n            let hc = (parseInt('' + o.b)).toString(16);\n            if (ha.length == 1) {\n                ha = '0' + ha;\n            }\n            if (hb.length == 1) {\n                hb = '0' + hb;\n            }\n            if (hc.length == 1) {\n                hc = '0' + hc;\n            }\n            return ha + hb + hc;\n        }\n        return '#000';\n    },\n    toRgbStr: function (rgbObj: {r: number; g: number; b: number}): string {\n        return 'rgb(' + Math.round(rgbObj.r) + ', ' + Math.round(rgbObj.g) + ', ' + Math.round(rgbObj.b) + ')';\n    },\n    toRgbaStr: function (rgbaObj: {r: number; g: number; b: number; a: number}): string {\n        return 'rgba(' + Math.round(rgbaObj.r) + ', ' + Math.round(rgbaObj.g) + ', ' + Math.round(rgbaObj.b) + ', ' + rgbaObj.a + ')';\n    },\n    hexToRGB: function (hexStr: string): RGB | undefined {\n        hexStr = hexStr.trim();\n        // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\n        const shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n        hexStr = hexStr.replace(shorthandRegex, function (m, r, g, b) {\n            return r + r + g + g + b + b;\n        });\n\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hexStr);\n        return result ? new RGB(\n            parseInt(result[1], 16),\n            parseInt(result[2], 16),\n            parseInt(result[3], 16)\n        ) : undefined;\n    },\n\n};\n\nexport function testIsWhiteBestContrast (rgbObj: {r: number; g: number; b: number}): boolean {\n    return (rgbObj.r * 0.299 + rgbObj.g * 0.587 + rgbObj.b * 0.114) < 125;\n}","import {css} from './base';\nimport {BB} from '../bb';\nimport {IKeyStringOptional} from '../bb-types';\n\n\nexport function appendTextDiv (target: HTMLElement, text: string): HTMLDivElement {\n    const div = document.createElement('div');\n    div.innerHTML = text;\n    target.append(div);\n    return div;\n}\n\n/**\n * Is an input element focused.\n * Set attribute \"data-ignore-focus\" to \"true\" if its focus should be ignored.\n *\n * @param getAll - check all, even those with \"data-ignore-focus\" = \"true\"\n */\nexport function isInputFocused (getAll: boolean = false): boolean {\n    const result: boolean = !!document.activeElement && ['INPUT', 'TEXTAREA', 'SELECT'].includes(document.activeElement.tagName);\n    if (getAll) {\n        return result;\n    } else {\n        return result && !document.activeElement?.getAttribute('data-ignore-focus');\n    }\n}\n\nexport function unfocusAnyInput (): void {\n    if (isInputFocused(true)) {\n        /*\n            Unfocus anything that is focused.\n\n            If an Input is focused in Firefox, and it gets detached from the DOM via a Node\n            that isn't its direct parent, then Firefox will keep anything attached to this\n            Input in memory. It will not be garbage collected until a new Input is focused.\n\n            Workaround: Temporarily create an input, focus it, detach it.\n             */\n        const focusEl = BB.el({\n            parent: document.body,\n            tagName: 'input',\n            css: {\n                opacity: '0',\n                width: '0',\n                height: '0',\n            },\n        });\n        setTimeout(() => {\n            focusEl.select();\n            focusEl.focus();\n            focusEl.remove();\n        }, 10);\n    }\n}\n\n/**\n * clears text selection in window\n */\nexport function clearSelection (): void {\n    if (window.getSelection) {\n        const sel = window.getSelection();\n        if (sel) {\n            if (sel.empty) {\n                sel.empty();\n            } else if (sel.removeAllRanges) {\n                sel.removeAllRanges();\n            }\n        }\n    }\n}\n\n/**\n * prevents being able to focus element.\n * warning: it creates a listener\n *\n * @param el - dom element\n */\nexport const makeUnfocusable = (function (): ((el: HTMLElement) => void) {\n\n    function preventFocus (event: FocusEvent): void {\n        event.preventDefault();\n        let didFocusRelated = false;\n        if (event.relatedTarget) {\n            try {\n                (event.relatedTarget as HTMLElement).focus();\n                didFocusRelated = true;\n            } catch(e) {\n                console.error('failed to focus');\n            }\n        }\n        if (!didFocusRelated) {\n            (event.currentTarget as HTMLElement).blur();\n        }\n    }\n\n    return function (el) {\n        el.setAttribute('tabindex', '-1');\n        el.addEventListener('focus', preventFocus);\n    };\n})();\n\n\nconst els: {\n    el: HTMLElement;\n    listeners: [keyof HTMLElementEventMap, EventListener][];\n}[] = [];\n// window['els'] = els;\n\n/**\n *\n * Create DOM element - div by default\n * params = {\n * \t    parent: someOtherDiv,\n * \t    css: {\n * \t\t    width: \"500px\",\n * \t\t    backgroundColor: \"#fff\"\n * \t    },\n * \t    content: \"test\", //or  content: [divA, divB, divC]   or content: someDiv\n * \t    className: \"bla\",\n *      id: \"bla\"\n * }\n *\n *  If onClick or onChange is used, then BB.destroyEl MUST be called\n *  to prevent a memory leak.\n *\n * @param params\n */\nexport function el <GTag extends keyof HTMLElementTagNameMap = 'div'> (\n    params?: {\n        parent?: HTMLElement;\n        css?: IKeyStringOptional;\n        custom?: { [key: string]: string };\n        content?: string | (HTMLElement | string | undefined)[] | Element;\n        textContent?: string;\n        className?: string;\n        title?: string;\n        id?: string;\n        tagName?: GTag;\n        onClick?: (e: Event) => void;\n        onChange?: (e: Event) => void;\n        noRef?: boolean; // don't keep references of listeners\n    }\n) {\n    if (!params) {\n        return document.createElement('div') as HTMLElementTagNameMap[GTag];\n    }\n    const result = document.createElement(params.tagName ? params.tagName : 'div');\n    params.css && css(result, params.css);\n\n    if (params.content) {\n        if (typeof params.content === typeof 'aa') {\n            result.innerHTML = params.content as string;\n\n        } else if (Array.isArray(params.content)) {\n            BB.append(result, params.content);\n\n        } else {\n            result.append(params.content as HTMLElement);\n\n        }\n    }\n    if (params.textContent) {\n        result.textContent = params.textContent;\n    }\n    if (params.className) {\n        result.className = params.className;\n    }\n    if (params.id) {\n        result.id = params.id;\n    }\n    if (params.parent) {\n        params.parent.append(result);\n    }\n    if ('title' in params && params.title !== undefined) {\n        result.title = params.title;\n    }\n    const listeners: [keyof HTMLElementEventMap, EventListener][] = [];\n    if (params.onClick !== undefined) {\n        result.addEventListener('click', params.onClick);\n        !params.noRef && listeners.push(['click', params.onClick as EventListener]);\n    }\n    if (params.onChange !== undefined) {\n        result.addEventListener('change', params.onChange);\n        !params.noRef && listeners.push(['change', params.onChange]);\n    }\n    if (listeners.length > 0) {\n        els.push({\n            el: result,\n            listeners,\n        });\n        /*div.style.backgroundColor = '#ff0';\n        div.style.border = '1px solid #ff0';*/\n    }\n    if ('custom' in params && params.custom) {\n        const customKeyArr = Object.keys(params.custom);\n        for (let i = 0; i < customKeyArr.length; i++) {\n            result.setAttribute(customKeyArr[i], params.custom[customKeyArr[i]]);\n        }\n    }\n    return result as HTMLElementTagNameMap[GTag];\n}\n\n/**\n * removes event listeners for Elements created via el()\n * @param el\n */\nexport function destroyEl (el?: HTMLElement): void {\n    if (!el) {\n        return;\n    }\n    for (let i = 0; i < els.length; i++) {\n        const item = els[i];\n        if (item.el === el) {\n            item.listeners.forEach(item => {\n                el.removeEventListener(item[0], item[1]);\n            });\n            els.splice(i, 1);\n            return;\n        }\n    }\n    // not found\n    return;\n}\n","\ntype TLogListener = (msg: any) => void;\n\nexport class BbLog {\n\n    private static listeners: TLogListener[] = [];\n\n    constructor () {\n    }\n\n    static subscribe (listener: TLogListener): void {\n        if (BbLog.listeners.includes(listener)) {\n            return;\n        }\n        BbLog.listeners.push(listener);\n    }\n\n    static unsubscribe (listener: TLogListener): void {\n        for (let i = 0; i < BbLog.listeners.length; i++) {\n            if (listener === BbLog.listeners[i]) {\n                BbLog.listeners.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    static emit (msg: any): void {\n        BbLog.listeners.forEach(item => {\n            item(msg);\n        });\n    }\n}","/**\n * LocalStorage wrapper that does not throw exceptions.\n * If cookies disabled in Safari localStorage interactions throw exception \"insecure operation\"\n */\nexport class LocalStorage {\n\n    private static error: unknown | undefined;\n\n    static getItem (key: string): string | null {\n        // (disabled) eslint-disable-next-line no-null/no-null\n        let result = null;\n        try {\n            result = localStorage.getItem(key);\n        } catch (e) {\n            this.error = e;\n        }\n        return result;\n    }\n\n    static setItem (key: string, value: string): void {\n        try {\n            localStorage.setItem(key, value);\n        } catch (e) {\n            this.error = e;\n        }\n    }\n\n    static removeItem (key: string): void {\n        try {\n            localStorage.removeItem(key);\n        } catch (e) {\n            this.error = e;\n        }\n    }\n\n    static getError (): unknown {\n        return this.error;\n    }\n}","import {IPointerEvent} from '../event.types';\nimport {copyObj} from '../../base/base';\n\nexport interface ICoalescedPointerEvent extends IPointerEvent {\n    isCoalesced?: true;\n}\n\n/**\n * A ChainElement. Splits up coalesced events into their own pointermove events. Otherwise regular pass through.\n *\n * in: IPointerEvent\n * out: IPointerEvent with property isCoalesced: boolean\n *\n * todo: eventPreventDefault and eventStopPropagation are broken events w coalesced events. (because of json parse json stringify)\n * but how could that even work?\n */\nexport class CoalescedExploder {\n\n    private chainOut: ((e: ICoalescedPointerEvent) => void) | undefined;\n\n    // ---- public ----\n\n    setChainOut (func: (e: ICoalescedPointerEvent) => void) {\n        this.chainOut = func;\n    }\n\n    chainIn (event: IPointerEvent): IPointerEvent | null {\n        if (event.type === 'pointermove') {\n\n            if (event.coalescedArr && event.coalescedArr.length > 0) {\n                for (let i = 0; i < event.coalescedArr.length; i++) {\n                    const eventCopy: ICoalescedPointerEvent = copyObj(event);\n                    if (i === 0) {\n                        eventCopy.coalescedArr = [];\n                    }\n                    const coalescedItem = event.coalescedArr[i];\n\n                    eventCopy.pageX = coalescedItem.pageX;\n                    eventCopy.pageY = coalescedItem.pageY;\n                    eventCopy.relX = coalescedItem.relX;\n                    eventCopy.relY = coalescedItem.relY;\n                    eventCopy.dX = coalescedItem.dX;\n                    eventCopy.dY = coalescedItem.dY;\n                    eventCopy.time = coalescedItem.time;\n                    if (i < event.coalescedArr.length - 1) {\n                        eventCopy.isCoalesced = true;\n                    }\n\n                    this.chainOut && this.chainOut(eventCopy);\n                }\n\n            } else {\n                return event;\n            }\n        } else {\n            return event;\n        }\n\n        return null;\n    }\n\n}\n","import {dist} from '../../math/math';\nimport {IPointerEvent} from '../event.types';\n\n/**\n * A ChainElement. Detects a single tap with N 'touch' pointers\n *\n * in IPointerEvent\n * out IPointerEvent\n */\nexport class NFingerTapper {\n\n    private readonly minSilenceBeforeDurationMs = 50;\n    private readonly maxTapMs = 500;\n    private readonly maxFirstLastFingerDownMs = 250;\n    private readonly maxPressedDistancePx = 12; //5 + fingers * 5;\n\n    private chainOut: ((e: IPointerEvent) => void) | undefined;\n    private fingerArr: {\n        pointerId: number;\n        downTimeMs: number;\n        downPageX: number;\n        downPageY: number;\n        isUp?: boolean;\n    }[] = [];\n    private eventQueueArr: IPointerEvent[] = [];\n    private firstDownTime: number = 0;\n    private lastEventTime: number = 0;\n    private nowTime: number = performance.now();\n    private readonly pointersDownIdArr: number[] = [];\n    private readonly fingers: number;\n    private readonly onTap: () => void;\n    private readonly timeoutObj: {\n        firstLastDownTimeout: ReturnType<typeof setTimeout> | null;\n        tapTimeout: ReturnType<typeof setTimeout> | null;\n    } = {\n        firstLastDownTimeout: null,\n        tapTimeout: null,\n    };\n\n    private failGesture (): void {\n        if (this.eventQueueArr.length === 0) {\n            return;\n        }\n        this.timeoutObj.firstLastDownTimeout && clearTimeout(this.timeoutObj.firstLastDownTimeout);\n        this.timeoutObj.tapTimeout && clearTimeout(this.timeoutObj.tapTimeout);\n        for (let i = 0; i < this.eventQueueArr.length; i++) {\n            this.chainOut && this.chainOut(this.eventQueueArr[i]);\n        }\n        this.eventQueueArr = [];\n        this.fingerArr = [];\n    }\n\n    private success (): void {\n        this.timeoutObj.firstLastDownTimeout && clearTimeout(this.timeoutObj.firstLastDownTimeout);\n        this.timeoutObj.tapTimeout && clearTimeout(this.timeoutObj.tapTimeout);\n        this.eventQueueArr = []; // events get swallowed\n        this.fingerArr = [];\n        this.onTap();\n    }\n\n    private setupTimeout (timeoutStr: 'firstLastDownTimeout' | 'tapTimeout', timeMS: number): boolean {\n        const diff = timeMS - this.nowTime;\n        //console.log(fingers + ': ' + timeoutStr + ' diff', diff);\n        if (diff <= 0) { // time already up\n            return false;\n        }\n        this.timeoutObj[timeoutStr] = setTimeout(() => this.failGesture(), diff);\n        return true;\n    }\n\n    private processEvent (event: IPointerEvent): true | void {\n\n        const tempLastEventTime = this.lastEventTime;\n        this.lastEventTime = event.time;\n\n        if (event.type === 'pointerdown') {\n            this.pointersDownIdArr.push(event.pointerId);\n        } else if (event.type === 'pointerup') {\n            for (let i = 0; i < this.pointersDownIdArr.length; i++) {\n                if (this.pointersDownIdArr[i] === event.pointerId) {\n                    this.pointersDownIdArr.splice(i, 1);\n                    break;\n                }\n            }\n        }\n\n        if (event.pointerType !== 'touch') {\n            if (this.fingerArr.length > 0) { // already in gesture -> fail\n                this.failGesture();\n            }\n            return;\n        }\n\n        this.nowTime = performance.now();\n\n        if (event.type === 'pointerdown') {\n            //console.log('down');\n            if (this.fingerArr.length + 1 !== this.pointersDownIdArr.length) { // failed before, and some fingers are still down -> fail\n                this.failGesture();\n                return;\n            }\n            if (this.fingerArr.length === this.fingers) { // too many fingers down -> fail\n                //console.log(fingers + ': too many fingers down -> fail');\n                this.failGesture();\n                return;\n            }\n            if (this.fingerArr.length > 0 && event.time - this.maxFirstLastFingerDownMs > this.fingerArr[0].downTimeMs) { // took too long to touch with all fingers -> fail\n                //console.log(fingers + ': took too long to touch with all fingers -> fail');\n                this.failGesture();\n                return;\n            }\n            if (this.fingerArr.length === 0 && event.time - this.minSilenceBeforeDurationMs < tempLastEventTime) { // not enough silence before -> fail\n                //console.log(fingers + ': not enough silence before -> fail');\n                this.failGesture();\n                return;\n            }\n\n            if (this.fingerArr.length === 0) {\n                this.firstDownTime = event.time;\n\n                if (!this.setupTimeout('firstLastDownTimeout', event.time + this.maxFirstLastFingerDownMs) || !this.setupTimeout('tapTimeout', event.time + this.maxTapMs)) { // timeouts already up -> fail\n                    this.failGesture();\n                    return;\n                }\n\n            }\n            this.fingerArr.push({\n                pointerId: event.pointerId,\n                downTimeMs: event.time,\n                downPageX: event.pageX,\n                downPageY: event.pageY,\n            });\n            return;\n\n        }\n\n        if (event.type === 'pointermove') {\n\n            if (this.fingerArr.length === 0) {\n                //not in a gesture -> ignore\n                return;\n            }\n\n            let fingerObj = null;\n            for (let i = 0; i < this.fingerArr.length; i++) {\n                if (this.fingerArr[i].pointerId === event.pointerId) {\n                    fingerObj = this.fingerArr[i];\n                    break;\n                }\n            }\n            if (fingerObj === null) { // finger not part of the tap is on screen -> fail\n                this.failGesture();\n                return;\n            }\n\n            if (event.time - this.maxTapMs > this.firstDownTime) { // tap took too long -> fail\n                //console.log(fingers + ': tap took too long -> fail');\n                this.failGesture();\n                return;\n            }\n\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\n            if (distance > this.maxPressedDistancePx) { // finger moved too much -> fail\n                //console.log(fingers + ': a finger moved too much -> fail', distance);\n                this.failGesture();\n                return;\n            }\n\n        }\n\n        if (event.type === 'pointerup') {\n\n            if (this.fingerArr.length === 0) {\n                //not in a gesture -> ignore\n                return;\n            }\n\n            //console.log('up', event.pageX, event.pageY);\n            if (this.fingerArr.length !== this.fingers) { // not enough fingers -> fail\n                //console.log(fingers + ': not enough fingers -> fail');\n                this.failGesture();\n                return;\n            }\n\n            let fingerObj = null;\n            let i = 0;\n            for (; i < this.fingerArr.length; i++) {\n                if (this.fingerArr[i].pointerId === event.pointerId) {\n                    fingerObj = this.fingerArr[i];\n                    break;\n                }\n            }\n            if (fingerObj === null) {\n                //do nothing\n                return;\n            }\n\n            if (event.time - this.maxTapMs > this.firstDownTime) { // tap took too long -> fail\n                //console.log(fingers + ': tap took too long -> fail');\n                this.failGesture();\n                return;\n            }\n\n            const distance = dist(event.pageX, event.pageY, fingerObj.downPageX, fingerObj.downPageY);\n            if (distance > this.maxPressedDistancePx) { // finger moved too much -> fail\n                //console.log(fingers + ': b finger moved too much -> fail', distance, event.pageX, event.pageY);\n                //console.log(fingerArr);\n                this.failGesture();\n                return;\n            }\n\n            fingerObj.isUp = true;\n\n            let allAreUp = true;\n            for (let i = 0; i < this.fingerArr.length; i++) {\n                if (!this.fingerArr[i].isUp) {\n                    allAreUp = false;\n                    break;\n                }\n            }\n            //console.log('fingerArr', fingerArr);\n\n            if (allAreUp) { // success\n                this.success();\n                return true;\n            }\n\n        }\n\n\n    }\n\n    // ---- public ----\n    constructor (\n        p: {\n            fingers: number;\n            onTap: () => void;\n        }\n    ) {\n        this.fingers = p.fingers;\n        this.onTap = p.onTap;\n    }\n\n\n    chainIn (event: IPointerEvent): (IPointerEvent | null) {\n\n        const result = this.processEvent(event);\n\n        //console.log(fingerArr.length);\n\n        if (result === true) {\n            //tap success -> event gets swallowed\n            return null;\n        }\n        if (this.fingerArr.length === 0) {\n            return event;\n        } else {\n            this.eventQueueArr.push(event);\n        }\n\n        return null;\n\n    }\n\n    setChainOut (func: (e: IPointerEvent) => void): void {\n        this.chainOut = func;\n    }\n\n\n}\n","import {dist, pointsToAngleRad} from '../../math/math';\nimport {IPointerEvent} from '../event.types';\n\nexport type TPinchZoomerEvent = { type: 'end' } | {\n    type: 'move';\n\n    downRelX: number;\n    downRelY: number;\n    relX: number;\n    relY: number;\n\n    angleRad: number;\n    scale: number;\n};\n\ntype TTouchPointer =  {\n    pointerId: number;\n    relX: number;\n    relY: number;\n    downRelX?: number; // only for first\n    downRelY?: number;\n};\n\ntype TPinchGesture = {\n    touchPointerArr: TTouchPointer[];\n    otherPointerIdArr: number[];\n    isInProgress: boolean;\n};\n\n/**\n * A ChainElement. Detects a pinch zooming (2 touch pointers). If one finger lifts, then will use the remaining.\n * Further pointers are ignored, but their events get swallowed during the pinching.\n * pinching ends when ALL pointers are lifted.\n * Events passed through if no pinching.\n *\n * in IPointerEvent\n * out IPointerEvent\n */\nexport class PinchZoomer {\n\n    private readonly firstFingerMaxDistancePx = 10;\n    private readonly untilSecondFingerDurationMs = 250;\n\n\n    private chainOut: ((e: IPointerEvent) => void) | undefined;\n    private readonly pointersDownIdArr: number[] = [];\n    private gestureObj: null | TPinchGesture = null;\n    private eventQueueArr: IPointerEvent[] = [];\n    private nowTime: number = performance.now();\n    private readonly timeoutObj: {\n        secondFingerTimeout: ReturnType<typeof setTimeout> | null;\n    } = {\n        secondFingerTimeout: null,\n    };\n    private pincherArr: {\n        pointerId: number;\n        relX: number;\n        relY: number;\n        downRelX: number;\n        downRelY: number;\n    }[] = [];\n    private readonly onPinch: (e: TPinchZoomerEvent) => void;\n\n\n    private end (): void {\n        this.gestureObj = null;\n        this.eventQueueArr = [];\n    }\n\n    private fail (doSwallow?: boolean): void {\n        if (!this.gestureObj) { // no gesture happening -> ignore\n            return;\n        }\n\n        this.timeoutObj.secondFingerTimeout && clearTimeout(this.timeoutObj.secondFingerTimeout);\n        if (!doSwallow) {\n            for (let i = 0; i < this.eventQueueArr.length; i++) {\n                this.chainOut && this.chainOut(this.eventQueueArr[i]);\n            }\n        }\n        this.end();\n    }\n\n    private setupFailTimeout (timeMS: number): boolean {\n        const diff = timeMS - this.nowTime;\n        if (diff <= 0) { // time already up\n            return false;\n        }\n        this.timeoutObj.secondFingerTimeout = setTimeout(() => this.fail(), diff);\n        return true;\n    }\n\n    private processEvent (event: IPointerEvent): void {\n\n        if (event.type === 'pointerdown') {\n            this.pointersDownIdArr.push(event.pointerId);\n\n        } else if (event.type === 'pointerup') {\n            for (let i = 0; i < this.pointersDownIdArr.length; i++) {\n                if (this.pointersDownIdArr[i] === event.pointerId) {\n                    this.pointersDownIdArr.splice(i, 1);\n                    break;\n                }\n            }\n        }\n\n        //pass through scenarios\n        if (\n            !this.gestureObj && (\n                event.pointerType !== 'touch' || // wrong pointer type\n                (event.type === 'pointermove' && this.pointersDownIdArr.length > 0) || // failed before\n                this.pointersDownIdArr.length > 1 || // failed before\n                event.type === 'pointerup' // failed before\n            )\n        ) {\n            return;\n        }\n\n        this.nowTime = performance.now();\n\n\n        //pointer down\n        if (event.type === 'pointerdown') {\n\n            if (this.gestureObj) {\n                if (event.pointerType === 'touch') { // touch finger down - as nth pointer\n\n                    this.gestureObj.touchPointerArr.push({\n                        pointerId: event.pointerId,\n                        relX: event.relX,\n                        relY: event.relY,\n                    });\n\n                    if (this.gestureObj.isInProgress) {\n                        this.continuePinch(this.gestureObj, {\n                            type: 'down',\n                            index: this.gestureObj.touchPointerArr.length - 1,\n                        });\n                    } else {\n                        this.timeoutObj.secondFingerTimeout && clearTimeout(this.timeoutObj.secondFingerTimeout);\n                        this.gestureObj.isInProgress = true;\n                        this.beginPinch(this.gestureObj);\n                    }\n                    return;\n\n                } else { // non-touch finger down - as nth pointer\n\n                    if (this.gestureObj.isInProgress) {\n                        this.gestureObj.otherPointerIdArr.push(event.pointerId);\n                    } else { // second pointer wrong type -> fail\n                        this.fail();\n                    }\n                    return;\n                }\n\n\n            } else {\n                // first finger down - can only be touch if no gestureObj\n                this.gestureObj = {\n                    touchPointerArr: [{\n                        pointerId: event.pointerId,\n                        relX: event.relX,\n                        relY: event.relY,\n                        downRelX: event.relX,\n                        downRelY: event.relY,\n                    }],\n                    otherPointerIdArr: [],\n                    isInProgress: false,\n                };\n                if (!this.setupFailTimeout(event.time + this.untilSecondFingerDurationMs)) { // time ran out -> fail\n                    this.fail();\n                    return;\n                }\n                return;\n            }\n\n        }\n\n        // should not happen. something went wrong\n        if (!this.gestureObj) {\n            // throw? would make it less robust\n            this.fail();\n            return;\n        }\n\n        //pointer move\n        if (event.type === 'pointermove' && event.pointerType === 'touch') {\n            //gesture object should always exist here\n\n            let touchPointerObj: TTouchPointer | null = null;\n            let i = 0;\n            for (; i < this.gestureObj.touchPointerArr.length; i++) {\n                if (event.pointerId === this.gestureObj.touchPointerArr[i].pointerId) {\n                    touchPointerObj = this.gestureObj.touchPointerArr[i];\n                    break;\n                }\n            }\n\n            //null should not be possible. something went wrong\n            if (!touchPointerObj) {\n                // throw? would make it less robust\n                this.fail();\n                return;\n            }\n\n            touchPointerObj.relX = event.relX;\n            touchPointerObj.relY = event.relY;\n\n            if (!this.gestureObj.isInProgress) { // only one finger down & pinching hasn't started\n\n                // should not happen. something went wrong\n                if (\n                    !('downRelX' in touchPointerObj && touchPointerObj.downRelX !== undefined) ||\n                    !('downRelY' in touchPointerObj && touchPointerObj.downRelY !== undefined)\n                ) {\n                    this.fail();\n                    return;\n                }\n\n                const distance = dist(touchPointerObj.downRelX, touchPointerObj.downRelY, touchPointerObj.relX, touchPointerObj.relY);\n                if (distance > this.firstFingerMaxDistancePx) { // moved too much -> fail\n                    this.fail();\n                    return;\n                }\n\n            } else {\n                if (i < 2) { // only first two touches can affect pinching\n                    this.continuePinch(this.gestureObj, {\n                        type: 'move',\n                        index: i,\n                    });\n                }\n            }\n\n            return;\n        }\n\n\n        //pointer up\n        if (event.type === 'pointerup') {\n            //gesture object should always exist here\n\n            if (event.pointerType === 'touch') {\n                let i = 0;\n                for (; i < this.gestureObj.touchPointerArr.length; i++) {\n                    if (this.gestureObj.touchPointerArr[i].pointerId === event.pointerId) {\n                        this.gestureObj.touchPointerArr.splice(i, 1);\n                        break;\n                    }\n                }\n                if (this.gestureObj.touchPointerArr.length > 0) {\n                    this.continuePinch(this.gestureObj, {\n                        type: 'up',\n                        index: i,\n                    });\n                }\n\n            } else { // non-touch\n                for (let i = 0; i < this.gestureObj.otherPointerIdArr.length; i++) {\n                    if (this.gestureObj.otherPointerIdArr[i] === event.pointerId) {\n                        this.gestureObj.otherPointerIdArr.splice(i, 1);\n                        break;\n                    }\n                }\n            }\n\n            //all fingers lifted?\n            if (this.gestureObj.touchPointerArr.length === 0 && this.gestureObj.otherPointerIdArr.length === 0) {\n                if (this.gestureObj.isInProgress) { // lifted last finger -> end of pinching\n                    this.end();\n                    this.endPinch();\n                } else { // lifted finger again before pinching started -> fail\n                    this.fail();\n                }\n                return;\n            }\n\n        }\n\n\n    }\n\n    private beginPinch (gestureObj: TPinchGesture): void {\n\n        for (let i = 0; i < gestureObj.touchPointerArr.length; i++) {\n            const pointerObj = gestureObj.touchPointerArr[i];\n            this.pincherArr.push({\n                pointerId: pointerObj.pointerId,\n                relX: pointerObj.relX,\n                relY: pointerObj.relY,\n                downRelX: pointerObj.relX,\n                downRelY: pointerObj.relY,\n            });\n        }\n\n        const event: TPinchZoomerEvent = {\n            type: 'move',\n\n            // temp\n            downRelX: 0,\n            downRelY: 0,\n            relX: 0,\n            relY: 0,\n\n            angleRad: 0,\n            scale: 1,\n        };\n\n        if (this.pincherArr.length === 1) {\n            event.relX = this.pincherArr[0].downRelX;\n            event.relY = this.pincherArr[0].downRelY;\n        } else {\n            event.relX = 0.5 * (this.pincherArr[0].downRelX + this.pincherArr[1].downRelX);\n            event.relY = 0.5 * (this.pincherArr[0].downRelY + this.pincherArr[1].downRelY);\n        }\n        event.downRelX = event.relX;\n        event.downRelY = event.relY;\n\n        this.onPinch(event);\n\n    }\n\n    //actionObj = {type: 'down'|'move'|'up', index: number}\n    private continuePinch (\n        gestureObj: TPinchGesture,\n        actionObj: {\n            type: 'down' | 'move' | 'up';\n            index: number;\n        }\n    ): void {\n\n        if (actionObj.index > 1) { // only first two pointers matter\n            return;\n        }\n\n        if (actionObj.type === 'move') {\n\n            let event: TPinchZoomerEvent;\n            this.pincherArr[actionObj.index].relX = gestureObj.touchPointerArr[actionObj.index].relX;\n            this.pincherArr[actionObj.index].relY = gestureObj.touchPointerArr[actionObj.index].relY;\n\n            if (this.pincherArr.length === 1) {\n\n                event = {\n                    type: 'move',\n                    downRelX: this.pincherArr[0].downRelX,\n                    downRelY: this.pincherArr[0].downRelY,\n                    relX: this.pincherArr[0].relX,\n                    relY: this.pincherArr[0].relY,\n                    angleRad: 0,\n                    scale: 1,\n                };\n\n            } else {\n\n                const startDist = dist(this.pincherArr[0].downRelX, this.pincherArr[0].downRelY, this.pincherArr[1].downRelX, this.pincherArr[1].downRelY);\n                const distance = dist(this.pincherArr[0].relX, this.pincherArr[0].relY, this.pincherArr[1].relX, this.pincherArr[1].relY);\n\n                const startAngle = pointsToAngleRad({\n                    x: this.pincherArr[0].downRelX,\n                    y: this.pincherArr[0].downRelY,\n                }, {x: this.pincherArr[1].downRelX, y: this.pincherArr[1].downRelY});\n                const angle = pointsToAngleRad({\n                    x: this.pincherArr[0].relX,\n                    y: this.pincherArr[0].relY,\n                }, {x: this.pincherArr[1].relX, y: this.pincherArr[1].relY});\n\n                event = {\n                    type: 'move',\n                    downRelX: 0.5 * (this.pincherArr[0].downRelX + this.pincherArr[1].downRelX),\n                    downRelY: 0.5 * (this.pincherArr[0].downRelY + this.pincherArr[1].downRelY),\n                    relX: 0.5 * (this.pincherArr[0].relX + this.pincherArr[1].relX),\n                    relY: 0.5 * (this.pincherArr[0].relY + this.pincherArr[1].relY),\n                    angleRad: angle - startAngle,\n                    scale: distance / startDist,\n                };\n\n            }\n\n            this.onPinch(event);\n\n        } else if (actionObj.type === 'down' || actionObj.type === 'up') {\n            this.endPinch();\n            this.beginPinch(gestureObj);\n        }\n\n    }\n\n    private endPinch (): void {\n        this.pincherArr = [];\n        this.onPinch({\n            type: 'end',\n        });\n    }\n\n\n    // ---- public ----\n    constructor (\n        p: {\n            onPinch: (e: TPinchZoomerEvent) => void;\n        }\n    ) {\n        this.onPinch = p.onPinch;\n    }\n\n    chainIn (event: IPointerEvent): IPointerEvent | null {\n        this.processEvent(event);\n        if (this.gestureObj) {\n            if (!this.gestureObj.isInProgress) { // might still fail -> into queue\n                this.eventQueueArr.push(event);\n            }\n        } else {\n            return event;\n        }\n        return null;\n    }\n\n    setChainOut (func: (e: IPointerEvent) => void): void {\n        this.chainOut = func;\n    }\n\n}\n","import {TChainOutFunc} from './event-chain.types';\nimport {dist} from '../../math/math';\nimport {IPointerEvent, TPointerButton, TPointerType} from '../event.types';\n\n\nexport interface IDoubleTapperEvent {\n    pageX: number;\n    pageY: number;\n    relX: number;\n    relY: number;\n}\n\ntype TDoubleTapperTimeoutType = 'fail' | 'maxUntilSecondDown' | 'success';\n\n/**\n * A ChainElement. Detects double taps.\n *\n * in IPointerEvent\n * out IPointerEvent\n */\nexport class DoubleTapper {\n\n    private readonly onDoubleTap: (e: IDoubleTapperEvent) => void;\n    private chainOut: TChainOutFunc | undefined;\n    private allowedPointerTypeArr: TPointerType[] = ['touch', 'mouse', 'pen'];\n    private allowedButtonArr: TPointerButton[] = ['left'];\n    private minSilenceBeforeDurationMs: number = 400;\n    private maxPressedDurationMs: number = 300;\n    private maxPressedDistancePx: number = 10;\n    private maxInbetweenDistancePx: number = 19;\n    private maxUpToUpDurationMs: number = 500;\n    private maxUntilSecondDownDurationMs: number = 300;\n    private minSilenceAfterMs: number = 250;\n    private sequenceArr: (\n        {\n            isDown: boolean;\n            time: number;\n            position: [number, number];\n            pointerId: number;\n        } |\n        {\n            isUp: boolean;\n            time: number;\n            position: [number, number];\n        } |\n        {\n            pageX: number;\n            pageY: number;\n            relX: number;\n            relY: number;\n        }\n        )[] = [];\n    private pointersDownIdArr: number[] = [];\n    private lastUpTime: number = 0;\n    private nowTime: number = 0;\n    private eventQueueArr: IPointerEvent[] = [];\n    private timeoutObj: {\n        [K in TDoubleTapperTimeoutType]: ReturnType<typeof setTimeout> | null;\n    } = {\n        fail: null,\n        maxUntilSecondDown: null,\n        success: null,\n    };\n    private readonly gestureFailed: () => void;\n\n    // double tap achieved\n    private success (): void {\n        this.timeoutObj.fail = null;\n        this.timeoutObj.success = null;\n        this.eventQueueArr = []; // events get swallowed\n        const lastSequenceItem = this.sequenceArr[this.sequenceArr.length - 1];\n        this.sequenceArr = [];\n        if ('pageX' in lastSequenceItem) {\n            this.onDoubleTap({\n                pageX: lastSequenceItem.pageX,\n                pageY: lastSequenceItem.pageY,\n                relX: lastSequenceItem.relX,\n                relY: lastSequenceItem.relY,\n            });\n        }\n    }\n\n    // returns false if time already up. otherwise sets up timeout\n    private setupTimeout (\n        timeoutStr: TDoubleTapperTimeoutType,\n        targetFunc: () => void,\n        timeMS: number,\n        noComparison?: boolean,\n    ): boolean {\n        const diff = timeMS - this.nowTime;\n        // console.log(fingers + ': ' + timeoutStr + ' diff', diff);\n        if (diff <= 0 && !noComparison) { // time already up\n            return false;\n        }\n        this.timeoutObj[timeoutStr] = setTimeout(targetFunc, Math.max(0, diff));\n        return true;\n    }\n\n    /**\n     * @param event object - a pointer event from BB.PointerListener\n     */\n    private processEvent (event: IPointerEvent): void {\n\n        if (event.type === 'pointerdown') {\n            this.pointersDownIdArr.push(event.pointerId);\n        } else if (event.type === 'pointerup') {\n            for (let i = 0; i < this.pointersDownIdArr.length; i++) {\n                if (this.pointersDownIdArr[i] === event.pointerId) {\n                    this.pointersDownIdArr.splice(i, 1);\n                    break;\n                }\n            }\n        }\n\n        if (!this.allowedPointerTypeArr.includes(event.pointerType)) { //wrong input type -> fail\n            //console.log('wrong input type -> fail');\n            this.gestureFailed();\n            return;\n        }\n\n        this.nowTime = performance.now();\n        const lastSequenceItem = this.sequenceArr.length > 0 ? this.sequenceArr[this.sequenceArr.length - 1] : null;\n        if (event.type === 'pointerup') {\n            this.lastUpTime = event.time;\n        }\n\n        if (event.type === 'pointerdown') {\n            if (this.pointersDownIdArr.length > 1) { // more than one pointer down -> fail\n                //console.log('more than one pointer down -> fail');\n                this.gestureFailed();\n                return;\n            }\n            if (this.timeoutObj.success !== null) { // silence-after not achieved -> fail\n                //console.log('silence-after not achieved -> fail');\n                this.gestureFailed();\n                return;\n            }\n            if (this.sequenceArr.length === 0 && this.nowTime - this.lastUpTime < this.minSilenceBeforeDurationMs) { // silence before not achieved -> fail\n                //console.log('silence before not achieved -> fail');\n                this.gestureFailed();\n                return;\n            }\n            if (event.button && !this.allowedButtonArr.includes(event.button)) { // wrong button -> fail\n                //console.log('wrong button -> fail', event.button, allowedButtonArr);\n                this.gestureFailed();\n                return;\n            }\n            if ((lastSequenceItem && 'isDown' in lastSequenceItem && lastSequenceItem.isDown) || this.sequenceArr.length > 2) { // jumbled -> fail\n                //console.log('jumbled -> fail');\n                this.gestureFailed();\n                return;\n            }\n            if (lastSequenceItem && 'position' in lastSequenceItem) {\n                const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\n                if (distance > this.maxInbetweenDistancePx) { //moved too much -> reset\n                    //console.log('maxInbetweenDistancePx -> reset');\n                    this.gestureFailed();\n\n\n                    if ('time' in lastSequenceItem && this.nowTime - lastSequenceItem.time < this.minSilenceBeforeDurationMs) { //silence before not achieved -> fail\n                        return;\n                    }\n                }\n            }\n            this.sequenceArr.push({\n                isDown: true,\n                time: this.nowTime,\n                position: [event.pageX, event.pageY],\n                pointerId: event.pointerId,\n            });\n            //maxUntilSecondDown\n\n            if (this.sequenceArr.length > 1) {\n                this.timeoutObj.maxUntilSecondDown && clearTimeout(this.timeoutObj.maxUntilSecondDown);\n            } else if (!this.setupTimeout('maxUntilSecondDown', () => this.gestureFailed(), event.time + this.maxUntilSecondDownDurationMs)) {\n                //console.log('event.time + maxPressedDurationMs -> fail');\n                this.gestureFailed();\n                return;\n            }\n\n\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\n            if (!this.setupTimeout('fail', () => this.gestureFailed(), event.time + this.maxPressedDurationMs)) {\n                //console.log('event.time + maxPressedDurationMs -> fail');\n                this.gestureFailed();\n                return;\n            }\n        }\n        if (lastSequenceItem && event.type === 'pointermove' && 'pointerId' in lastSequenceItem && lastSequenceItem.pointerId === event.pointerId) {\n            /*if (lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\n                console.log('another pointer mixing in -> fail');\n                this.fail();\n                return;\n            }*/\n            const distance = dist(lastSequenceItem.position[0], lastSequenceItem.position[1], event.pageX, event.pageY);\n            if (distance > this.maxPressedDistancePx) { //moved too much -> fail\n                //console.log('maxPressedDistancePx -> fail');\n                this.gestureFailed();\n                return;\n            }\n        }\n        if (lastSequenceItem && event.type === 'pointerup') {\n            if ('pointerId' in lastSequenceItem && lastSequenceItem.pointerId !== event.pointerId) { //another pointer mixing in -> fail\n                this.gestureFailed();\n                return;\n            }\n            if ('time' in lastSequenceItem && this.nowTime >= lastSequenceItem.time + this.maxPressedDurationMs) { //pressed too long -> fail\n                this.gestureFailed();\n                return;\n            }\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\n\n            if (this.sequenceArr.length < 3) {\n                if (!this.setupTimeout('fail', () => this.gestureFailed(), event.time + this.maxUpToUpDurationMs)) {\n                    this.gestureFailed();\n                    return;\n                }\n\n                this.sequenceArr = [\n                    lastSequenceItem,\n                    {\n                        isUp: true,\n                        time: this.nowTime,\n                        position: [event.pageX, event.pageY],\n                    },\n                ];\n                return;\n            }\n\n            if ('time' in this.sequenceArr[1] && this.nowTime < this.sequenceArr[1].time + this.maxUpToUpDurationMs) {\n                // double tap almost success\n                // only needs silence\n                this.sequenceArr.push({\n                    pageX: event.pageX,\n                    pageY: event.pageY,\n                    relX: event.relX,\n                    relY: event.relY,\n                });\n                if (\n                    !this.setupTimeout(\n                        'success',\n                        () => this.success(),\n                        event.time + this.minSilenceAfterMs,\n                        true\n                    )\n                ) {\n                    this.gestureFailed();\n                }\n            } else { // time up -> fail\n                this.gestureFailed();\n            }\n\n        }\n    }\n\n\n    // ---- public ----\n    constructor (\n        p: {\n            onDoubleTap: (e: IDoubleTapperEvent) => void; // fires when double tap occurs\n            isInstant?: boolean;\n        }\n    ) {\n        this.onDoubleTap = p.onDoubleTap;\n        if (p.isInstant) {\n            this.minSilenceBeforeDurationMs = 0;\n            this.minSilenceAfterMs = 0;\n        }\n        this.gestureFailed = () => {\n            if (this.sequenceArr.length === 0) { // no gesture started -> can be ignored\n                return;\n            }\n            this.timeoutObj.fail && clearTimeout(this.timeoutObj.fail);\n            this.timeoutObj.maxUntilSecondDown && clearTimeout(this.timeoutObj.maxUntilSecondDown);\n            this.timeoutObj.success && clearTimeout(this.timeoutObj.success);\n            this.timeoutObj.fail = null;\n            this.timeoutObj.maxUntilSecondDown = null;\n            this.timeoutObj.success = null;\n\n            if (this.chainOut) {\n                for (let i = 0; i < this.eventQueueArr.length; i++) {\n                    this.chainOut(this.eventQueueArr[i]);\n                }\n            }\n\n            this.eventQueueArr = [];\n            this.sequenceArr = [];\n        };\n    }\n\n    chainIn (event: IPointerEvent): IPointerEvent | null {\n\n        this.processEvent(event);\n\n        if (this.sequenceArr.length === 0) { //existing events can not become a double tap\n            this.gestureFailed();\n            return event;\n        }\n        // events might become a double tap -> queue\n        this.eventQueueArr.push(event);\n        return null;\n    }\n\n    setChainOut (func: TChainOutFunc): void {\n        this.chainOut = func;\n    }\n\n    setAllowedPointerTypeArr (arr: TPointerType[]): void {\n        this.allowedPointerTypeArr = [...arr];\n    }\n\n    setAllowedButtonArr (arr: TPointerButton[]): void {\n        this.allowedButtonArr = [...arr];\n    }\n\n}\n","import {TChainOutFunc} from './event-chain.types';\nimport {IPointerEvent} from '../event.types';\n\n/**\n * only lets through events from one pointer at a time.\n *\n * in IPointerEvent\n * out IPointerEvent\n */\nexport class OnePointerLimiter {\n\n    private chainOut: TChainOutFunc | undefined;\n    private downPointerId: number | null = null;\n    private readonly ignorePointerIdArr: number[] = [];\n\n    // ---- public ----\n    chainIn (event: IPointerEvent): IPointerEvent | null {\n\n        if (this.ignorePointerIdArr.includes(event.pointerId)) {\n            if (event.type === 'pointerup') {\n                for (let i = 0; i < this.ignorePointerIdArr.length; i++) {\n                    if (this.ignorePointerIdArr[i] === event.pointerId) {\n                        this.ignorePointerIdArr.splice(i, 1);\n                        break;\n                    }\n                }\n            }\n            return null;\n        }\n\n        if (this.downPointerId === null) {\n            if (event.type === 'pointerdown') {\n                this.downPointerId = event.pointerId;\n            }\n            return event;\n\n        } else {\n            if (event.pointerId !== this.downPointerId) {\n                if (event.type === 'pointerdown') {\n                    this.ignorePointerIdArr.push(event.pointerId);\n                }\n                return null;\n            }\n            if (event.type === 'pointerup') {\n                this.downPointerId = null;\n            }\n            return event;\n        }\n    }\n\n    setChainOut (func: TChainOutFunc): void {\n        this.chainOut = func;\n    }\n}","import {IChainElement, TChainOutFunc} from './event-chain.types';\nimport {IPointerEvent} from '../event.types';\n\n/**\n * for chaining event processing. useful for gestures (double tap, pinch zoom, max pointer filter).\n * each element in the chain might hold back the events, swallow them, transform them, or create new ones\n */\nexport class EventChain {\n    private readonly chainArr: IChainElement[];\n    private chainOut: TChainOutFunc | undefined;\n\n    private continueChain (i: number, event: IPointerEvent): null {\n        for (; i < this.chainArr.length; i++) {\n            event = this.chainArr[i].chainIn(event);\n            if (event === null) {\n                return null;\n            }\n        }\n        this.chainOut && this.chainOut(event);\n        return null;\n    }\n\n    // ---- public ----\n    constructor (\n        p: {\n            chainArr: IChainElement[];\n        }\n    ) {\n        this.chainArr = p.chainArr;\n\n        for (let i = 0; i < this.chainArr.length; i++) {\n            ( (i) => {\n                this.chainArr[i].setChainOut((event: IPointerEvent) => {\n                    this.continueChain(i + 1, event);\n                });\n            })(i);\n        }\n\n    }\n\n    /**\n     * feed an event into the chain\n     */\n    chainIn (event: IPointerEvent): null {\n        return this.continueChain(0, event);\n    }\n\n    /**\n     * func will be called when event has passed through the chain\n     */\n    setChainOut (func: TChainOutFunc): void {\n        this.chainOut = func;\n    }\n\n}\n","import {english, languages, loadLanguage, TTranslationCode} from '../../languages/languages';\n\nexport const LS_LANGUAGE_KEY = 'klecks-language';\n\nclass LanguageStrings {\n    private data: any;\n    private listeners: (() => void)[] = [];\n    private code: string;\n\n    // --- public ----\n    constructor () {\n        // need to use setLanguage for a different language\n        this.data = {...english};\n        this.code = 'en';\n    }\n\n    async setLanguage (langCode: string): Promise<void> {\n        if (langCode === 'en') {\n            this.data = {...english};\n        } else {\n            this.data = {...english, ...(await loadLanguage(langCode))};\n        }\n        this.code = langCode;\n        document.documentElement.setAttribute('lang', langCode);\n        this.listeners.forEach(item => {\n            item();\n        });\n    }\n\n    get (code: TTranslationCode): string {\n        if (!(code in this.data)) {\n            throw new Error(\"translation code doesn't exist: \" + code);\n        }\n        return this.data[code];\n    }\n\n    getLanguage (): {code: string; name: string} {\n        return languages.find(item => {\n            return item.code === this.code;\n        })!;\n    }\n\n    getAutoLanguage (): {code: string; name: string} {\n        const autoCode = getLanguage(false);\n        return languages.find(item => {\n            return item.code === autoCode;\n        })!;\n    }\n\n    getCode (): string {\n        return this.code;\n    }\n\n    // get notified on language change\n    subscribe (subscriber: () => void) {\n        if (this.listeners.includes(subscriber)) {\n            return;\n        }\n        this.listeners.push(subscriber);\n    }\n\n    unsubscribe (subscriber: () => void) {\n        for (let i = 0; i < this.listeners.length; i++) {\n            if (subscriber === this.listeners[i]) {\n                this.listeners.splice(i, 1);\n                return;\n            }\n        }\n    }\n}\n\nexport function getLanguage (useLocalStorage?: boolean): string {\n\n    let result: string = 'en';\n\n    const langs: string[] = []; // from highest to lowest priority\n    const navLangs = navigator.languages ? navigator.languages : [navigator.language];\n    navLangs.forEach(item => {\n        const split = item.split('-');\n        langs.push(item);\n        if (split.length === 2) {\n            langs.push(split[0]);\n        }\n    });\n\n    if (useLocalStorage) {\n        try {\n            const item = localStorage.getItem(LS_LANGUAGE_KEY);\n            if (item) {\n                langs.unshift(item);\n            }\n        } catch (e) {\n            // likely cookies disabled in Safari\n        }\n    }\n\n    for (let i = 0; i < langs.length; i++) {\n        const lang = langs[i];\n        const found = languages.find(item => {\n            return item.code.toLowerCase() === lang.toLowerCase();\n        });\n        if (found) {\n            result = found.code;\n            break;\n        }\n    }\n    return result;\n}\n\nconst activeLanguageCode = getLanguage(true);\nexport const languageStrings = new LanguageStrings();\n\nexport const LANG = (code: TTranslationCode, replace?: {[key: string]: string}): string => {\n    if (replace) {\n        let result = languageStrings.get(code);\n        const keyArr = Object.keys(replace);\n        keyArr.forEach(key => {\n            result = result.replace(`{${key}}`, replace[key]);\n        });\n        return result;\n    } else {\n        return languageStrings.get(code);\n    }\n};\n\nexport const initLANG = () => languageStrings.setLanguage(activeLanguageCode);","// generated from src/languages. \"npm run lang:build\" to update\n\nimport dataEn from './en.json';\n\nexport const english = dataEn;\nexport const languages: {code: string; name: string}[] = [\n    {\n        code: 'en',\n        name: 'English',\n    },\n    {\n        code: 'de',\n        name: 'Deutsch',\n    },\n    {\n        code: 'fr',\n        name: 'Franais',\n    },\n    {\n        code: 'ja',\n        name: '',\n    },\n    {\n        code: 'ko',\n        name: '',\n    },\n    {\n        code: 'ru',\n        name: '',\n    },\n    {\n        code: 'zh-CN',\n        name: '',\n    },\n    {\n        code: 'zh-TW',\n        name: '',\n    },\n];\nexport const loadLanguage = async (code: string): Promise<Record<TTranslationCode, string>> => {\n    if (code === 'en') {\n        return english;\n    } else if (code === 'de') {\n        return await import('./de.json');\n    } else if (code === 'fr') {\n        return await import('./fr.json');\n    } else if (code === 'ja') {\n        return await import('./ja.json');\n    } else if (code === 'ko') {\n        return await import('./ko.json');\n    } else if (code === 'ru') {\n        return await import('./ru.json');\n    } else if (code === 'zh-CN') {\n        return await import('./zh-CN.json');\n    } else if (code === 'zh-TW') {\n        return await import('./zh-TW.json');\n    }\n    throw new Error('unknown language code');\n};\n\nexport type TTranslationCode = 'switch-ui-left-right' | // Switch left/right UI\n    'toggle-show-tools' | // Show/Hide Tools\n    'scroll' | // Scroll\n    'donate' | // Donate\n    'home' | // Home\n    'modal-new-tab' | // Open in new tab\n    'tab-edit' | // Edit\n    'tab-file' | // File\n    'tool-brush' | // Brush\n    'tool-paint-bucket' | // Paint Bucket\n    'tool-gradient' | // Gradient\n    'tool-shape' | // Shape\n    'tool-text' | // Text\n    'tool-hand' | // Hand Tool\n    'tool-zoom' | // Zoom\n    'undo' | // Undo\n    'redo' | // Redo\n    'brush-pen' | // Pen\n    'brush-blend' | // Blend\n    'brush-sketchy' | // Sketchy\n    'brush-pixel' | // Pixel\n    'brush-chemy' | // Chemy\n    'brush-smudge' | // Smudge\n    'brush-size' | // Size\n    'brush-blending' | // Blending\n    'brush-toggle-pressure' | // Toggle Pressure Sensitivity\n    'brush-pen-circle' | // Circle\n    'brush-pen-chalk' | // Chalk\n    'brush-pen-calligraphy' | // Calligraphy\n    'brush-pen-square' | // Square\n    'brush-sketchy-scale' | // Scale\n    'brush-pixel-dither' | // Dither\n    'brush-chemy-fill' | // Fill\n    'brush-chemy-stroke' | // Stroke\n    'brush-chemy-mirror-x' | // Horizontal Symmetry\n    'brush-chemy-mirror-y' | // Vertical Symmetry\n    'brush-chemy-gradient' | // Gradient\n    'brush-eraser-transparent-bg' | // Transparent Background\n    'stabilizer' | // Stabilizer\n    'stabilizer-title' | // Stroke Stabilizer\n    'eyedropper' | // Eyedropper\n    'secondary-color' | // Secondary Color\n    'manual-color-input' | // Manual Color Input\n    'mci-hex' | // Hex\n    'mci-copy' | // Copy\n    'modal-ok' | // Ok\n    'modal-cancel' | // Cancel\n    'modal-close' | // Close\n    'layers-active-layer' | // Active Layer\n    'layers-layer' | // Layer\n    'layers-copy' | // copy\n    'layers-blending' | // Blending\n    'layers-new' | // New Layer\n    'layers-remove' | // Remove Layer\n    'layers-duplicate' | // Duplicate Layer\n    'layers-merge' | // Merge with layer below\n    'layers-merge-all' | // Merge all\n    'layers-rename' | // Rename\n    'layers-active-layer-visible' | // Active layer is visible\n    'layers-active-layer-hidden' | // Active layer is hidden\n    'layers-visibility-toggle' | // Layer Visibility\n    'layers-blend-normal' | // normal\n    'layers-blend-darken' | // darken\n    'layers-blend-multiply' | // multiply\n    'layers-blend-color-burn' | // color burn\n    'layers-blend-lighten' | // lighten\n    'layers-blend-screen' | // screen\n    'layers-blend-color-dodge' | // color dodge\n    'layers-blend-overlay' | // overlay\n    'layers-blend-soft-light' | // soft light\n    'layers-blend-hard-light' | // hard light\n    'layers-blend-difference' | // difference\n    'layers-blend-exclusion' | // exclusion\n    'layers-blend-hue' | // hue\n    'layers-blend-saturation' | // saturation\n    'layers-blend-color' | // color\n    'layers-blend-luminosity' | // luminosity\n    'layers-rename-title' | // Rename Layer\n    'layers-rename-name' | // Name\n    'layers-rename-clear' | // Clear Name\n    'layers-rename-sketch' | // Sketch\n    'layers-rename-colors' | // Colors\n    'layers-rename-shading' | // Shading\n    'layers-rename-lines' | // Lines\n    'layers-rename-effects' | // Effects\n    'layers-rename-foreground' | // Foreground\n    'layers-merge-modal-title' | // Merge/Mix Layers\n    'layers-merge-description' | // Merges the selected layer with the one underneath. Select the mix mode:\n    'file-no-autosave' | // No autosave, no cloud storage\n    'file-new' | // New\n    'file-import' | // Import\n    'file-save' | // Save\n    'file-format' | // File Format\n    'file-copy' | // Copy\n    'file-copy-title' | // Copy To Clipboard\n    'file-share' | // Share\n    'file-storage' | // Browser Storage\n    'file-storage-thumb-title' | // Restores when reopening page\n    'file-storage-about' | // About Browser Storage\n    'file-storage-cant-access' | // Can't access\n    'file-storage-empty' | // Empty\n    'file-storage-store' | // Store\n    'file-storage-clear' | // Clear\n    'file-storage-storing' | // Storing\n    'file-storage-overwrite' | // Overwrite\n    'file-storage-min-ago' | // {x}min ago\n    'file-storage-hours-ago' | // {x}h ago\n    'file-storage-days-ago' | // {x}d ago\n    'file-storage-month-ago' | // > 1month ago\n    'file-storage-restored' | // Restored from Browser Storage\n    'file-storage-stored' | // Stored to Browser Storage\n    'file-storage-failed' | // Failed to store to Browser Storage\n    'file-storage-failed-1' | // Failed to store. Possible causes:\n    'file-storage-failed-2' | // Out of disk space\n    'file-storage-failed-3' | // Storage disabled in incognito tab\n    'file-storage-failed-4' | // Browser doesn't support storage\n    'file-storage-failed-clear' | // Failed to clear.\n    'file-upload' | // Upload\n    'cleared-layer' | // Cleared layer\n    'filled' | // Filled\n    'new-title' | // New Image\n    'new-current' | // Current\n    'new-fit' | // Fit\n    'new-oversize' | // Oversize\n    'new-square' | // Square\n    'new-landscape' | // Landscape\n    'new-portrait' | // Portrait\n    'new-screen' | // Screen\n    'new-video' | // Video\n    'new-din-paper' | // DIN Paper\n    'new-px' | // px\n    'new-ratio' | // Ratio\n    'upload-title' | // Upload to Imgur\n    'upload-link-notice' | // Anyone with the link to your uploaded image will be able to view it.\n    'upload-name' | // Title\n    'upload-title-untitled' | // Untitled\n    'upload-caption' | // Caption\n    'upload-submit' | // Upload\n    'upload-uploading' | // Uploading...\n    'upload-success' | // Upload Successful\n    'upload-failed' | // Upload failed.\n    'upload-delete' | // To delete your image from Imgur visit:\n    'cropcopy-title-copy' | // Copy To Clipboard\n    'cropcopy-title-crop' | // Crop\n    'cropcopy-click-hold' | // Right-click or press hold to copy.\n    'cropcopy-btn-copy' | // To Clipboard\n    'cropcopy-copied' | // Copied.\n    'cropcopy-btn-crop' | // Apply Crop\n    'crop-drag-to-crop' | // Drag to crop\n    'filter-crop-extend' | // Crop/Extend\n    'filter-flip' | // Flip\n    'filter-perspective' | // Perspective\n    'filter-resize' | // Resize\n    'filter-rotate' | // Rotate\n    'filter-transform' | // Transform\n    'filter-bright-contrast' | // Bright/Contrast\n    'filter-curves' | // Curves\n    'filter-hue-sat' | // Hue/Saturation\n    'filter-invert' | // Invert\n    'filter-tilt-shift' | // Tilt Shift\n    'filter-to-alpha' | // To Alpha\n    'filter-triangle-blur' | // Triangle Blur\n    'filter-unsharp-mask' | // Unsharp Mask\n    'filter-crop-title' | // Crop / Extend\n    'filter-crop-description' | // Crop or extend the image.\n    'filter-crop-left' | // Left\n    'filter-crop-right' | // Right\n    'filter-crop-top' | // Top\n    'filter-crop-bottom' | // Bottom\n    'filter-crop-rule-thirds' | // Rule of Thirds\n    'filter-crop-fill' | // Fill\n    'filter-flip-title' | // Flip\n    'filter-flip-description' | // Flips layer or whole image.\n    'filter-flip-horizontal' | // Horizontal\n    'filter-flip-vertical' | // Vertical\n    'filter-flip-image' | // Flip Image\n    'filter-flip-layer' | // Flip Layer\n    'filter-perspective-title' | // Perspective\n    'filter-perspective-description' | // Transforms the selected layer.\n    'filter-resize-title' | // Resize\n    'filter-resize-description' | // Resizes the image.\n    'filter-rotate-title' | // Rotate\n    'filter-rotate-description' | // Rotates the image.\n    'filter-transform-empty' | // Layer is empty.\n    'filter-transform-title' | // Transform\n    'filter-transform-description' | // Transforms selected layer. Hold Shift for additional behavior.\n    'filter-transform-rotation' | // Rotation\n    'filter-transform-flip' | // Flip\n    'filter-transform-center' | // Center\n    'filter-transform-constrain' | // Constrain\n    'filter-transform-snap' | // Snap\n    'filter-transform-snap-title' | // Snap Rotation And Position\n    'filter-bright-contrast-title' | // Brightness / Contrast\n    'filter-bright-contrast-description' | // Change brightness and contrast for the selected layer.\n    'filter-bright-contrast-brightness' | // Brightness\n    'filter-bright-contrast-contrast' | // Contrast\n    'filter-curves-title' | // Curves\n    'filter-curves-description' | // Apply curves on the selected layer.\n    'filter-curves-all' | // All\n    'filter-hue-sat-title' | // Hue / Saturation\n    'filter-hue-sat-description' | // Change hue and saturation for the selected layer.\n    'filter-hue-sat-hue' | // Hue\n    'filter-hue-sat-saturation' | // Saturation\n    'filter-applied' | // applied\n    'filter-tilt-shift-title' | // Tilt Shift\n    'filter-tilt-shift-description' | // Applies tilt shift on the selected layer.\n    'filter-tilt-shift-blur' | // Blur Radius\n    'filter-tilt-shift-gradient' | // Gradient Radius\n    'filter-to-alpha-title' | // To Alpha\n    'filter-to-alpha-description' | // Generates alpha channel for selected layer from:\n    'filter-to-alpha-inverted-lum' | // Inverted Luminance\n    'filter-to-alpha-lum' | // Luminance\n    'filter-to-alpha-replace' | // Replace RGB\n    'filter-triangle-blur-title' | // Triangle Blur\n    'filter-triangle-blur-description' | // Applies triangle blur on the selected layer.\n    'filter-unsharp-mask-title' | // Unsharp Mask\n    'filter-unsharp-mask-description' | // Sharpens the selected layer by scaling pixels away from the average of their neighbors.\n    'filter-unsharp-mask-strength' | // Strength\n    'filter-grid' | // Grid\n    'filter-grid-description' | // Draws grid on selected layer.\n    'filter-noise' | // Noise\n    'filter-noise-description' | // Adds noise to selected layer.\n    'filter-noise-scale' | // Scale\n    'filter-noise-alpha' | // Alpha\n    'filter-pattern' | // Pattern\n    'filter-pattern-description' | // Generates pattern on selected layer. Drag the preview for further controls.\n    'filter-distort' | // Distort\n    'filter-distort-description' | // Distorts the selected layer.\n    'filter-distort-phase' | // Phase\n    'filter-distort-stepsize' | // Step Size\n    'filter-distort-sync-xy' | // Sync XY\n    'filter-vanish-point' | // Vanish Point\n    'filter-vanish-point-title' | // Vanishing Point\n    'filter-vanish-point-description' | // Adds vanishing point to selected layer. Drag preview to move.\n    'filter-vanish-point-lines' | // Lines\n    'import-opening' | // Opening file...\n    'import-title' | // Import Image\n    'import-too-large' | // Image too large, will be downscaled.\n    'import-btn-as-layer' | // As Layer\n    'import-btn-as-image' | // As Image\n    'import-as-layer-title' | // Import Image as New Layer\n    'import-as-layer-description' | // Adjust the position of the imported image.\n    'import-as-layer-limit-reached' | // Layer limit reached. Image will be placed on existing layer.\n    'import-as-layer-fit' | // Fit\n    'import-flatten' | // Flatten image\n    'import-unsupported-file' | // Unsupported file type. See Help for supported types.\n    'import-broken-file' | // Couldn't load image. File might be corrupted.\n    'import-psd-unsupported' | // Unsupported features. PSD had to be flattened.\n    'import-psd-limited-support' | // PSD support is limited. Flattened will more likely look correct.\n    'import-psd-too-large' | // Image exceeds maximum dimensions of {x} x {x} pixels. Unable to import.\n    'import-psd-size' | // Image size\n    'hand-reset' | // Reset\n    'hand-fit' | // Fit\n    'bucket-tolerance' | // Tolerance\n    'bucket-sample' | // Sample\n    'bucket-sample-title' | // Which layers to sample color from\n    'bucket-sample-all' | // All\n    'bucket-sample-active' | // Active\n    'bucket-sample-above' | // Above\n    'bucket-grow' | // Grow\n    'bucket-grow-title' | // Grow filled area (in pixels)\n    'bucket-contiguous' | // Contiguous\n    'bucket-contiguous-title' | // Only fill connected areas\n    'gradient-linear' | // Linear\n    'gradient-linear-mirror' | // Linear-Mirror\n    'gradient-radial' | // Radial\n    'shape-stroke' | // Stroke\n    'shape-fill' | // Fill\n    'shape-rect' | // Rectangle\n    'shape-ellipse' | // Ellipse\n    'shape-line' | // Line\n    'shape-line-width' | // Line Width\n    'shape-outwards' | // Outwards\n    'shape-fixed' | // Fixed 1:1\n    'text-instruction' | // Click canvas to place text\n    'text-title' | // Add Text\n    'text-text' | // Text\n    'text-font' | // Font\n    'text-placeholder' | // Your text\n    'text-color' | // Color\n    'text-size' | // Size\n    'text-line-height' | // Line Height\n    'text-letter-spacing' | // Letter Spacing\n    'text-left' | // Left\n    'text-center' | // Center\n    'text-right' | // Right\n    'text-italic' | // Italic\n    'text-bold' | // Bold\n    'save-reminder-title' | // Unsaved Work\n    'save-reminder-text' | // Image was not saved in {a} minutes{b}. Save now to prevent eventual loss.\n    'save-reminder-save-psd' | // Save As PSD\n    'save-reminder-psd-layers' | // PSD will remember all layers.\n    'backup-drawing' | // You can backup your drawing.\n    'submit' | // Submit\n    'submit-title' | // Submit Drawing\n    'submit-prompt' | // Submit drawing?\n    'submit-submitting' | // Submitting\n    'embed-init-loading' | // Loading app\n    'embed-init-waiting' | // Waiting for image\n    'unsaved' | // Unsaved\n    'help' | // Help\n    'tab-settings' | // Settings\n    'settings-language' | // Language\n    'settings-language-reload' | // Will update after reloading.\n    'settings-theme' | // Theme\n    'settings-save-reminder-label' | // Save Reminder\n    'settings-save-reminder-disabled' | // disabled\n    'settings-save-reminder-confirm-title' | // Turn off Save Reminder?\n    'settings-save-reminder-confirm-a' | // There is no autosave and browser tabs don't last forever. If you don't periodically save you will likely lose work.\n    'settings-save-reminder-confirm-b' | // Disable at your own risk?\n    'settings-save-reminder-confirm-disable' | // Disable\n    'theme-dark' | // Dark\n    'theme-light' | // Light\n    'terms-of-service' | // Terms of Service\n    'licenses' | // Licenses\n    'source-code' | // Source Code\n    'auto' | // auto\n    'zoom-in' | // Zoom In\n    'zoom-out' | // Zoom Out\n    'radius' | // Radius\n    'constrain-proportions' | // Constrain Proportions\n    'width' | // Width\n    'height' | // Height\n    'opacity' | // Opacity\n    'red' | // Red\n    'green' | // Green\n    'blue' | // Blue\n    'eraser' | // Eraser\n    'center' | // Center\n    'layers' | // Layers\n    'background' | // Background\n    'scaling-algorithm' | // Scaling Algorithm\n    'algorithm-smooth' | // Smooth\n    'algorithm-pixelated' | // Pixelated\n    'preview' | // Preview\n    'angle-snap' | // Snap\n    'angle-snap-title' | // 45 Angle Snapping\n    'lock-alpha' | // Lock Alpha\n    'lock-alpha-title' | // Locks layer's alpha channel\n    'reverse' | // Reverse\n    'compare-before' | // Before\n    'compare-after' | // After\n    'loading' | // Loading\n    'more' | // More\n    'x-minutes'; // {x}min\n","{\"switch-ui-left-right\":\"Switch left/right UI\",\"toggle-show-tools\":\"Show/Hide Tools\",\"scroll\":\"Scroll\",\"donate\":\"Donate\",\"home\":\"Home\",\"modal-new-tab\":\"Open in new tab\",\"tab-edit\":\"Edit\",\"tab-file\":\"File\",\"tool-brush\":\"Brush\",\"tool-paint-bucket\":\"Paint Bucket\",\"tool-gradient\":\"Gradient\",\"tool-shape\":\"Shape\",\"tool-text\":\"Text\",\"tool-hand\":\"Hand Tool\",\"tool-zoom\":\"Zoom\",\"undo\":\"Undo\",\"redo\":\"Redo\",\"brush-pen\":\"Pen\",\"brush-blend\":\"Blend\",\"brush-sketchy\":\"Sketchy\",\"brush-pixel\":\"Pixel\",\"brush-chemy\":\"Chemy\",\"brush-smudge\":\"Smudge\",\"brush-size\":\"Size\",\"brush-blending\":\"Blending\",\"brush-toggle-pressure\":\"Toggle Pressure Sensitivity\",\"brush-pen-circle\":\"Circle\",\"brush-pen-chalk\":\"Chalk\",\"brush-pen-calligraphy\":\"Calligraphy\",\"brush-pen-square\":\"Square\",\"brush-sketchy-scale\":\"Scale\",\"brush-pixel-dither\":\"Dither\",\"brush-chemy-fill\":\"Fill\",\"brush-chemy-stroke\":\"Stroke\",\"brush-chemy-mirror-x\":\"Horizontal Symmetry\",\"brush-chemy-mirror-y\":\"Vertical Symmetry\",\"brush-chemy-gradient\":\"Gradient\",\"brush-eraser-transparent-bg\":\"Transparent Background\",\"stabilizer\":\"Stabilizer\",\"stabilizer-title\":\"Stroke Stabilizer\",\"eyedropper\":\"Eyedropper\",\"secondary-color\":\"Secondary Color\",\"manual-color-input\":\"Manual Color Input\",\"mci-hex\":\"Hex\",\"mci-copy\":\"Copy\",\"modal-ok\":\"Ok\",\"modal-cancel\":\"Cancel\",\"modal-close\":\"Close\",\"layers-active-layer\":\"Active Layer\",\"layers-layer\":\"Layer\",\"layers-copy\":\"copy\",\"layers-blending\":\"Blending\",\"layers-new\":\"New Layer\",\"layers-remove\":\"Remove Layer\",\"layers-duplicate\":\"Duplicate Layer\",\"layers-merge\":\"Merge with layer below\",\"layers-merge-all\":\"Merge all\",\"layers-rename\":\"Rename\",\"layers-active-layer-visible\":\"Active layer is visible\",\"layers-active-layer-hidden\":\"Active layer is hidden\",\"layers-visibility-toggle\":\"Layer Visibility\",\"layers-blend-normal\":\"normal\",\"layers-blend-darken\":\"darken\",\"layers-blend-multiply\":\"multiply\",\"layers-blend-color-burn\":\"color burn\",\"layers-blend-lighten\":\"lighten\",\"layers-blend-screen\":\"screen\",\"layers-blend-color-dodge\":\"color dodge\",\"layers-blend-overlay\":\"overlay\",\"layers-blend-soft-light\":\"soft light\",\"layers-blend-hard-light\":\"hard light\",\"layers-blend-difference\":\"difference\",\"layers-blend-exclusion\":\"exclusion\",\"layers-blend-hue\":\"hue\",\"layers-blend-saturation\":\"saturation\",\"layers-blend-color\":\"color\",\"layers-blend-luminosity\":\"luminosity\",\"layers-rename-title\":\"Rename Layer\",\"layers-rename-name\":\"Name\",\"layers-rename-clear\":\"Clear Name\",\"layers-rename-sketch\":\"Sketch\",\"layers-rename-colors\":\"Colors\",\"layers-rename-shading\":\"Shading\",\"layers-rename-lines\":\"Lines\",\"layers-rename-effects\":\"Effects\",\"layers-rename-foreground\":\"Foreground\",\"layers-merge-modal-title\":\"Merge/Mix Layers\",\"layers-merge-description\":\"Merges the selected layer with the one underneath. Select the mix mode:\",\"file-no-autosave\":\"No autosave, no cloud storage\",\"file-new\":\"New\",\"file-import\":\"Import\",\"file-save\":\"Save\",\"file-format\":\"File Format\",\"file-copy\":\"Copy\",\"file-copy-title\":\"Copy To Clipboard\",\"file-share\":\"Share\",\"file-storage\":\"Browser Storage\",\"file-storage-thumb-title\":\"Restores when reopening page\",\"file-storage-about\":\"About Browser Storage\",\"file-storage-cant-access\":\"Can't access\",\"file-storage-empty\":\"Empty\",\"file-storage-store\":\"Store\",\"file-storage-clear\":\"Clear\",\"file-storage-storing\":\"Storing\",\"file-storage-overwrite\":\"Overwrite\",\"file-storage-min-ago\":\"{x}min ago\",\"file-storage-hours-ago\":\"{x}h ago\",\"file-storage-days-ago\":\"{x}d ago\",\"file-storage-month-ago\":\"> 1month ago\",\"file-storage-restored\":\"Restored from Browser Storage\",\"file-storage-stored\":\"Stored to Browser Storage\",\"file-storage-failed\":\"Failed to store to Browser Storage\",\"file-storage-failed-1\":\"Failed to store. Possible causes:\",\"file-storage-failed-2\":\"Out of disk space\",\"file-storage-failed-3\":\"Storage disabled in incognito tab\",\"file-storage-failed-4\":\"Browser doesn't support storage\",\"file-storage-failed-clear\":\"Failed to clear.\",\"file-upload\":\"Upload\",\"cleared-layer\":\"Cleared layer\",\"filled\":\"Filled\",\"new-title\":\"New Image\",\"new-current\":\"Current\",\"new-fit\":\"Fit\",\"new-oversize\":\"Oversize\",\"new-square\":\"Square\",\"new-landscape\":\"Landscape\",\"new-portrait\":\"Portrait\",\"new-screen\":\"Screen\",\"new-video\":\"Video\",\"new-din-paper\":\"DIN Paper\",\"new-px\":\"px\",\"new-ratio\":\"Ratio\",\"upload-title\":\"Upload to Imgur\",\"upload-link-notice\":\"Anyone with the link to your uploaded image will be able to view it.\",\"upload-name\":\"Title\",\"upload-title-untitled\":\"Untitled\",\"upload-caption\":\"Caption\",\"upload-submit\":\"Upload\",\"upload-uploading\":\"Uploading...\",\"upload-success\":\"Upload Successful\",\"upload-failed\":\"Upload failed.\",\"upload-delete\":\"To delete your image from Imgur visit:\",\"cropcopy-title-copy\":\"Copy To Clipboard\",\"cropcopy-title-crop\":\"Crop\",\"cropcopy-click-hold\":\"Right-click or press hold to copy.\",\"cropcopy-btn-copy\":\"To Clipboard\",\"cropcopy-copied\":\"Copied.\",\"cropcopy-btn-crop\":\"Apply Crop\",\"crop-drag-to-crop\":\"Drag to crop\",\"filter-crop-extend\":\"Crop/Extend\",\"filter-flip\":\"Flip\",\"filter-perspective\":\"Perspective\",\"filter-resize\":\"Resize\",\"filter-rotate\":\"Rotate\",\"filter-transform\":\"Transform\",\"filter-bright-contrast\":\"Bright/Contrast\",\"filter-curves\":\"Curves\",\"filter-hue-sat\":\"Hue/Saturation\",\"filter-invert\":\"Invert\",\"filter-tilt-shift\":\"Tilt Shift\",\"filter-to-alpha\":\"To Alpha\",\"filter-triangle-blur\":\"Triangle Blur\",\"filter-unsharp-mask\":\"Unsharp Mask\",\"filter-crop-title\":\"Crop / Extend\",\"filter-crop-description\":\"Crop or extend the image.\",\"filter-crop-left\":\"Left\",\"filter-crop-right\":\"Right\",\"filter-crop-top\":\"Top\",\"filter-crop-bottom\":\"Bottom\",\"filter-crop-rule-thirds\":\"Rule of Thirds\",\"filter-crop-fill\":\"Fill\",\"filter-flip-title\":\"Flip\",\"filter-flip-description\":\"Flips layer or whole image.\",\"filter-flip-horizontal\":\"Horizontal\",\"filter-flip-vertical\":\"Vertical\",\"filter-flip-image\":\"Flip Image\",\"filter-flip-layer\":\"Flip Layer\",\"filter-perspective-title\":\"Perspective\",\"filter-perspective-description\":\"Transforms the selected layer.\",\"filter-resize-title\":\"Resize\",\"filter-resize-description\":\"Resizes the image.\",\"filter-rotate-title\":\"Rotate\",\"filter-rotate-description\":\"Rotates the image.\",\"filter-transform-empty\":\"Layer is empty.\",\"filter-transform-title\":\"Transform\",\"filter-transform-description\":\"Transforms selected layer. Hold Shift for additional behavior.\",\"filter-transform-rotation\":\"Rotation\",\"filter-transform-flip\":\"Flip\",\"filter-transform-center\":\"Center\",\"filter-transform-constrain\":\"Constrain\",\"filter-transform-snap\":\"Snap\",\"filter-transform-snap-title\":\"Snap Rotation And Position\",\"filter-bright-contrast-title\":\"Brightness / Contrast\",\"filter-bright-contrast-description\":\"Change brightness and contrast for the selected layer.\",\"filter-bright-contrast-brightness\":\"Brightness\",\"filter-bright-contrast-contrast\":\"Contrast\",\"filter-curves-title\":\"Curves\",\"filter-curves-description\":\"Apply curves on the selected layer.\",\"filter-curves-all\":\"All\",\"filter-hue-sat-title\":\"Hue / Saturation\",\"filter-hue-sat-description\":\"Change hue and saturation for the selected layer.\",\"filter-hue-sat-hue\":\"Hue\",\"filter-hue-sat-saturation\":\"Saturation\",\"filter-applied\":\"applied\",\"filter-tilt-shift-title\":\"Tilt Shift\",\"filter-tilt-shift-description\":\"Applies tilt shift on the selected layer.\",\"filter-tilt-shift-blur\":\"Blur Radius\",\"filter-tilt-shift-gradient\":\"Gradient Radius\",\"filter-to-alpha-title\":\"To Alpha\",\"filter-to-alpha-description\":\"Generates alpha channel for selected layer from:\",\"filter-to-alpha-inverted-lum\":\"Inverted Luminance\",\"filter-to-alpha-lum\":\"Luminance\",\"filter-to-alpha-replace\":\"Replace RGB\",\"filter-triangle-blur-title\":\"Triangle Blur\",\"filter-triangle-blur-description\":\"Applies triangle blur on the selected layer.\",\"filter-unsharp-mask-title\":\"Unsharp Mask\",\"filter-unsharp-mask-description\":\"Sharpens the selected layer by scaling pixels away from the average of their neighbors.\",\"filter-unsharp-mask-strength\":\"Strength\",\"filter-grid\":\"Grid\",\"filter-grid-description\":\"Draws grid on selected layer.\",\"filter-noise\":\"Noise\",\"filter-noise-description\":\"Adds noise to selected layer.\",\"filter-noise-scale\":\"Scale\",\"filter-noise-alpha\":\"Alpha\",\"filter-pattern\":\"Pattern\",\"filter-pattern-description\":\"Generates pattern on selected layer. Drag the preview for further controls.\",\"filter-distort\":\"Distort\",\"filter-distort-description\":\"Distorts the selected layer.\",\"filter-distort-phase\":\"Phase\",\"filter-distort-stepsize\":\"Step Size\",\"filter-distort-sync-xy\":\"Sync XY\",\"filter-vanish-point\":\"Vanish Point\",\"filter-vanish-point-title\":\"Vanishing Point\",\"filter-vanish-point-description\":\"Adds vanishing point to selected layer. Drag preview to move.\",\"filter-vanish-point-lines\":\"Lines\",\"import-opening\":\"Opening file...\",\"import-title\":\"Import Image\",\"import-too-large\":\"Image too large, will be downscaled.\",\"import-btn-as-layer\":\"As Layer\",\"import-btn-as-image\":\"As Image\",\"import-as-layer-title\":\"Import Image as New Layer\",\"import-as-layer-description\":\"Adjust the position of the imported image.\",\"import-as-layer-limit-reached\":\"Layer limit reached. Image will be placed on existing layer.\",\"import-as-layer-fit\":\"Fit\",\"import-flatten\":\"Flatten image\",\"import-unsupported-file\":\"Unsupported file type. See Help for supported types.\",\"import-broken-file\":\"Couldn't load image. File might be corrupted.\",\"import-psd-unsupported\":\"Unsupported features. PSD had to be flattened.\",\"import-psd-limited-support\":\"PSD support is limited. Flattened will more likely look correct.\",\"import-psd-too-large\":\"Image exceeds maximum dimensions of {x} x {x} pixels. Unable to import.\",\"import-psd-size\":\"Image size\",\"hand-reset\":\"Reset\",\"hand-fit\":\"Fit\",\"bucket-tolerance\":\"Tolerance\",\"bucket-sample\":\"Sample\",\"bucket-sample-title\":\"Which layers to sample color from\",\"bucket-sample-all\":\"All\",\"bucket-sample-active\":\"Active\",\"bucket-sample-above\":\"Above\",\"bucket-grow\":\"Grow\",\"bucket-grow-title\":\"Grow filled area (in pixels)\",\"bucket-contiguous\":\"Contiguous\",\"bucket-contiguous-title\":\"Only fill connected areas\",\"gradient-linear\":\"Linear\",\"gradient-linear-mirror\":\"Linear-Mirror\",\"gradient-radial\":\"Radial\",\"shape-stroke\":\"Stroke\",\"shape-fill\":\"Fill\",\"shape-rect\":\"Rectangle\",\"shape-ellipse\":\"Ellipse\",\"shape-line\":\"Line\",\"shape-line-width\":\"Line Width\",\"shape-outwards\":\"Outwards\",\"shape-fixed\":\"Fixed 1:1\",\"text-instruction\":\"Click canvas to place text\",\"text-title\":\"Add Text\",\"text-text\":\"Text\",\"text-font\":\"Font\",\"text-placeholder\":\"Your text\",\"text-color\":\"Color\",\"text-size\":\"Size\",\"text-line-height\":\"Line Height\",\"text-letter-spacing\":\"Letter Spacing\",\"text-left\":\"Left\",\"text-center\":\"Center\",\"text-right\":\"Right\",\"text-italic\":\"Italic\",\"text-bold\":\"Bold\",\"save-reminder-title\":\"Unsaved Work\",\"save-reminder-text\":\"Image was not saved in {a} minutes{b}. Save now to prevent eventual loss.\",\"save-reminder-save-psd\":\"Save As PSD\",\"save-reminder-psd-layers\":\"PSD will remember all layers.\",\"backup-drawing\":\"You can backup your drawing.\",\"submit\":\"Submit\",\"submit-title\":\"Submit Drawing\",\"submit-prompt\":\"Submit drawing?\",\"submit-submitting\":\"Submitting\",\"embed-init-loading\":\"Loading app\",\"embed-init-waiting\":\"Waiting for image\",\"unsaved\":\"Unsaved\",\"help\":\"Help\",\"tab-settings\":\"Settings\",\"settings-language\":\"Language\",\"settings-language-reload\":\"Will update after reloading.\",\"settings-theme\":\"Theme\",\"settings-save-reminder-label\":\"Save Reminder\",\"settings-save-reminder-disabled\":\"disabled\",\"settings-save-reminder-confirm-title\":\"Turn off Save Reminder?\",\"settings-save-reminder-confirm-a\":\"There is no autosave and browser tabs don't last forever. If you don't periodically save you will likely lose work.\",\"settings-save-reminder-confirm-b\":\"Disable at your own risk?\",\"settings-save-reminder-confirm-disable\":\"Disable\",\"theme-dark\":\"Dark\",\"theme-light\":\"Light\",\"terms-of-service\":\"Terms of Service\",\"licenses\":\"Licenses\",\"source-code\":\"Source Code\",\"auto\":\"auto\",\"zoom-in\":\"Zoom In\",\"zoom-out\":\"Zoom Out\",\"radius\":\"Radius\",\"constrain-proportions\":\"Constrain Proportions\",\"width\":\"Width\",\"height\":\"Height\",\"opacity\":\"Opacity\",\"red\":\"Red\",\"green\":\"Green\",\"blue\":\"Blue\",\"eraser\":\"Eraser\",\"center\":\"Center\",\"layers\":\"Layers\",\"background\":\"Background\",\"scaling-algorithm\":\"Scaling Algorithm\",\"algorithm-smooth\":\"Smooth\",\"algorithm-pixelated\":\"Pixelated\",\"preview\":\"Preview\",\"angle-snap\":\"Snap\",\"angle-snap-title\":\"45 Angle Snapping\",\"lock-alpha\":\"Lock Alpha\",\"lock-alpha-title\":\"Locks layer's alpha channel\",\"reverse\":\"Reverse\",\"compare-before\":\"Before\",\"compare-after\":\"After\",\"loading\":\"Loading\",\"more\":\"More\",\"x-minutes\":\"{x}min\"}","window.onscroll = (e) => {\n    e.preventDefault();\n};","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"cancel.5edb67d5.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"check.42e17e77.svg\";","import {KeyListener} from '../../../../bb/input/key-listener';\nimport {dialogCounter} from '../modal-count';\nimport {BB} from '../../../../bb/bb';\nimport {LANG} from '../../../../language/language';\nimport './scroll-fix';\nimport cancelImg from '/src/app/img/ui/cancel.svg';\n\n/**\n * popup that fill whole height, with some padding.\n * currently only used for iframe popups.\n */\nexport class DynamicModal {\n\n    private readonly parent: HTMLElement;\n    private readonly rootEl: HTMLElement;\n    private readonly updatePos: () => void;\n    private readonly keyListener: KeyListener;\n    private readonly xButton: HTMLElement;\n    private readonly bgEl: HTMLElement;\n    private readonly onClose: ((result?: string) => void) | undefined;\n\n\n    // ---- public ----\n    constructor (\n        p: {\n            title?: HTMLElement;\n            content?: HTMLElement;\n            buttonArr?: string[];\n            autoFocus?: string | false; // todo - not implemented\n            clickOnEnter?: string; // button name - todo not implemented\n            onClose?: (result?: string) => void;\n\n            //size and position\n            width: number;\n            isMaxHeight: boolean; // todo - not implemented\n        }\n    ) {\n        dialogCounter.increase();\n        this.onClose = p.onClose;\n        this.parent = document.body;\n        this.rootEl = BB.el({\n            parent: this.parent,\n            className: 'g-root kl-d-modal-root',\n            css: {\n                position: 'fixed',\n                left: '0',\n                top: '0',\n                bottom: '0',\n                right: '0',\n                overflow: 'auto',\n                animationName: 'consoleIn',\n                animationDuration: '0.3s',\n                animationTimingFunction: 'ease-out',\n            },\n            onClick: BB.handleClick,\n        });\n\n        //background element registering clicks\n        this.bgEl = BB.el({\n            parent: this.rootEl,\n            css: {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                bottom: '0',\n                right: '0',\n            },\n            onClick: () => this.close(),\n        });\n\n        //the actual popup box\n        const popupEl = BB.el({\n            parent: this.rootEl,\n            className: 'kl-d-modal',\n            css: {\n                position: 'absolute',\n                width: (BB.isCssMinMaxSupported() ?\n                    'min(calc(100% - 40px), ' + (p.width ? p.width : 400) + 'px)' :\n                    (p.width ? p.width : 400) + 'px'),\n                height: 'calc(100% - 40px)',\n                borderRadius: '10px',\n                overflow: 'hidden',\n            },\n        });\n\n        //x and y position via script. flex not powerful enough imo\n        this.updatePos = () => {\n            const elW = popupEl.offsetWidth;\n            const elH = popupEl.offsetHeight;\n\n            BB.css(popupEl, {\n                left: Math.max(0, (window.innerWidth - elW) / 2) + 'px',\n                top: Math.max(20, (window.innerHeight - elH) / 2 - (elH * 0.20)) + 'px',\n            });\n        };\n\n        this.updatePos();\n        window.addEventListener('resize', this.updatePos);\n\n        //title row in popup\n        const titleHeight = 40;\n        const titleEl = BB.el({\n            parent: popupEl,\n            css: {\n                height: titleHeight + 'px',\n                display: 'flex',\n                justifyContent: 'space-between',\n                alignItems: 'center',\n                paddingLeft: (titleHeight / 2) + 'px',\n            },\n        });\n        if (p.title) {\n            titleEl.append(p.title);\n        }\n        this.xButton = BB.el({\n            parent: titleEl,\n            tagName: 'button',\n            className: 'popup-x',\n            content: `<img alt=\"${LANG('modal-close')}\" height=\"20\" src=\"${cancelImg}\">`,\n            title: LANG('modal-close'),\n            onClick: () => this.close(),\n            css: {\n                width: titleHeight + 'px',\n                height: titleHeight + 'px',\n                lineHeight: titleHeight + 'px',\n                background: 'none',\n                boxShadow: 'none',\n            },\n            custom: {\n                tabindex: '0',\n            },\n        });\n\n        const contentEl = BB.el({\n            parent: popupEl,\n            css: {\n                height: 'calc(100% - ' + titleHeight + 'px)',\n            },\n        });\n        if (p.content) {\n            contentEl.append(p.content);\n        }\n\n        this.keyListener = new BB.KeyListener({\n            onDown: (keyStr, e) => {\n                if (keyStr === 'esc') {\n                    e.stopPropagation();\n                    this.close();\n                }\n            },\n        });\n    }\n\n    // ---- interface ----\n    close (): void {\n        dialogCounter.decrease();\n        BB.destroyEl(this.rootEl);\n        this.rootEl.remove();\n        window.removeEventListener('resize', this.updatePos);\n        this.keyListener.destroy();\n        BB.destroyEl(this.xButton);\n        BB.destroyEl(this.bgEl);\n        this.onClose && this.onClose();\n    }\n}\n","import {BB} from '../../../bb/bb';\nimport {IKeyStringOptional} from '../../../bb/bb-types';\n\n/**\n * Checkbox - with label\n */\nexport class Checkbox {\n\n    private readonly element: HTMLElement;\n    private check: HTMLInputElement;\n    private readonly doHighlight: boolean;\n\n    // --- public ---\n\n    constructor (params: {\n        init?: boolean; // default false\n        label: string;\n        callback?: (b: boolean) => void;\n        allowTab?: boolean; // default false\n        title?: string;\n        doHighlight?: boolean; // default false\n        css?: IKeyStringOptional;\n    }) {\n        this.doHighlight = !!params.doHighlight;\n\n        this.element = BB.el({\n            className: 'kl-checkbox',\n        });\n\n        const innerEl = BB.el({\n            parent: this.element,\n            tagName: 'label',\n            className: 'kl-checkbox__inner',\n            css: {\n                display: 'flex',\n            },\n        });\n\n        this.check = BB.el({\n            parent: innerEl,\n            tagName: 'input',\n            css: {\n                margin: '0 5px 0 0',\n            },\n            custom: {\n                type: 'checkbox',\n            },\n        });\n\n        this.check.checked = !!params.init;\n        if (this.doHighlight && this.check.checked) {\n            this.element.classList.add('kl-checkbox--highlight');\n        }\n        if (!params.allowTab) {\n            this.check.tabIndex = -1;\n        }\n\n        if (params.title) {\n            innerEl.title = params.title;\n        }\n\n        const label = BB.el({\n            parent: innerEl,\n            content: params.label,\n            css: {},\n        });\n        (label as any).allowClick = true;\n\n        this.check.onchange = () => {\n            if (this.doHighlight) {\n                this.element.classList.toggle('kl-checkbox--highlight', this.check.checked);\n            }\n            params.callback && params.callback(this.check.checked);\n            setTimeout(() => {\n                this.check.blur();\n            }, 0);\n        };\n        if (params.css) {\n            BB.css(this.element, params.css);\n        }\n    }\n\n    getValue (): boolean {\n        return this.check.checked;\n    }\n\n    setValue (b: boolean): void {\n        this.check.checked = !!b;\n        if (this.doHighlight) {\n            this.element.classList.toggle('kl-checkbox--highlight', this.check.checked);\n        }\n    }\n\n    getElement (): HTMLElement {\n        return this.element;\n    }\n\n    destroy (): void {\n        this.check.onchange = null;\n    }\n\n}\n","import {BB} from '../../../bb/bb';\nimport {IKeyString} from '../../../bb/bb-types';\nimport {KeyListener} from '../../../bb/input/key-listener';\n\ntype TInputType = 'button' | 'checkbox' | 'number' | 'text' | 'color';\n\nexport type TInputParams = {\n    type?: TInputType; // default: text\n    init: string | number;\n    title?: string;\n    label?: string | HTMLElement;\n\n    // for type: number\n    min?: number;\n    max?: number;\n    step?: number;\n\n    onChange?: (v: string) => void;\n\n    doScrollWithoutFocus?: boolean; // default: false\n    doResetIfInvalid?: boolean; // default: false\n\n    css?: IKeyString;\n};\n\nexport class Input {\n    private readonly rootEl: HTMLLabelElement;\n    private readonly input: HTMLInputElement;\n    private readonly type: TInputType;\n    private readonly pointerListener;\n    private readonly keyListener: KeyListener = {destroy: () => {}} as KeyListener;\n\n    // ---- public ----\n    constructor (p: TInputParams) {\n        this.rootEl = BB.el({\n            tagName: 'label',\n            content: p.label,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                gap: '5px',\n            },\n        });\n\n\n        this.input = BB.el({\n            tagName: 'input',\n            parent: this.rootEl,\n            title: p.title,\n        });\n\n        this.input.type;\n\n        this.type = p.type ?? 'text';\n        try {\n            this.input.type = this.type;\n        } catch(e) {\n            // ie can't deal with number\n        }\n\n        const stepSize = p.step ?? 1;\n\n        if (this.type === 'number') {\n            if (p.min !== undefined) {\n                this.input.min = '' + p.min;\n            }\n            if (p.max !== undefined) {\n                this.input.max = '' + p.max;\n            }\n            if (p.step !== undefined) {\n                this.input.step = '' + stepSize;\n            }\n        }\n\n        this.input.value = '' + p.init;\n\n        let lastValidValue = this.input.value;\n\n        /**\n         * return true if not changed\n         */\n        const handleChange = (): boolean => {\n            const oldVal = lastValidValue;\n            let newValue = this.input.value;\n            if (p.doResetIfInvalid) {\n                let didChange = false;\n                if (newValue === '') {\n                    newValue = lastValidValue;\n                    didChange = true;\n                }\n                if (p.min !== undefined && parseFloat(newValue) < p.min) {\n                    newValue = '' + p.min;\n                    didChange = true;\n                }\n                if (p.max !== undefined && parseFloat(newValue) > p.max) {\n                    newValue = '' + p.max;\n                    didChange = true;\n                }\n                if (didChange) {\n                    this.input.value = '' + newValue;\n                }\n            }\n\n            lastValidValue = newValue;\n\n            return oldVal !== newValue;\n        };\n\n        if (p.onChange) {\n            const onChange = p.onChange;\n            this.input.onchange = () => {\n                handleChange() && onChange(this.input.value);\n            };\n        }\n        if (p.css) {\n            BB.css(this.input, p.css);\n        }\n\n        if (p.doScrollWithoutFocus && p.type === 'number' && p.onChange) {\n            const onChange = p.onChange;\n            this.keyListener = new BB.KeyListener({});\n            this.pointerListener = new BB.PointerListener({\n                target: this.input,\n                onWheel: (e) => {\n                    /*if (document.hasFocus()) { // what was the point of this?\n                        return;\n                    }*/\n                    const fac = this.keyListener.isPressed('shift') ? 4 : 1;\n                    this.input.value = '' + (parseFloat(this.input.value) - e.deltaY * stepSize * fac);\n                    handleChange() && onChange(this.input.value);\n                },\n            });\n        }\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValue (): string {\n        return this.input.value;\n    }\n\n    setValue (v: string | number): void {\n        this.input.value = '' + v;\n    }\n\n    destroy (): void {\n        this.pointerListener && this.pointerListener.destroy();\n        this.keyListener.destroy();\n    }\n}\n\n// todo replace instances with class\nexport const input = function (params: {\n    type?: TInputType; // default text\n    min?: number;\n    max?: number;\n    callback: (val: string) => void;\n    init: string | number;\n    css?: IKeyString;\n}) {\n    const result = document.createElement('input');\n    if (params.type) {\n        try {\n            result.type = params.type;\n        } catch(e) {\n            /* empty */\n            // ie can't deal with number\n        }\n    } else {\n        result.type = 'text';\n    }\n    if (params.min !== undefined) {\n        result.min = '' + params.min;\n    }\n    if (params.max !== undefined) {\n        result.max = '' + params.max;\n    }\n    result.value = '' + params.init;\n    if (params.callback) {\n        result.onchange = function () {\n            params.callback(result.value);\n        };\n    }\n    if (params.css) {\n        BB.css(result, params.css);\n    }\n\n    return result;\n};","import {BB} from '../../../bb/bb';\nimport {IKeyString, IKeyStringOptional} from '../../../bb/bb-types';\n\n\ntype TSelectItem<ValueType> = [ValueType, string] | [ValueType, string, { css: IKeyStringOptional }]; // [value, label, properties]\n\n/**\n * A select dropdown\n */\nexport class Select<ValueType extends string> {\n\n    private readonly selectEl: HTMLSelectElement;\n    private optionArr: {\n        item: (TSelectItem<ValueType> | undefined);\n        el?: HTMLOptionElement;\n    }[] = [];\n    private readonly changeListener: () => void;\n    private readonly onChange: ((val: ValueType) => void) | undefined;\n\n    \n    // --- public ---\n    constructor (p: {\n        isFocusable?: boolean; // default false\n        optionArr: (TSelectItem<ValueType> | undefined)[];\n        initValue?: ValueType; // default ''\n        onChange?: (val: ValueType) => void;\n        css?: IKeyString;\n        title?: string;\n    }) {\n        this.selectEl = BB.el({\n            tagName: 'select',\n            title: p.title,\n            className: 'kl-select',\n            css: {\n                cursor: 'pointer',\n                fontSize: '15px',\n                padding: '3px',\n            },\n        });\n        if (p.css) {\n            BB.css(this.selectEl, p.css);\n        }\n\n        const isFocusable = p.isFocusable;\n        if (!isFocusable) {\n            this.selectEl.tabIndex = -1;\n        }\n        this.setOptionArr(p.optionArr);\n        if (p.onChange) {\n            this.onChange = p.onChange;\n        }\n        this.changeListener = () => {\n            if (!isFocusable) {\n                this.selectEl.blur();\n            }\n            this.onChange && this.onChange(this.getValue());\n        };\n        this.selectEl.addEventListener('change', this.changeListener);\n        this.selectEl.value = p.initValue !== undefined ? p.initValue : '';\n    }\n\n    setValue (val: ValueType | undefined): void {\n        this.selectEl.value = val === undefined ? '' : val;\n    }\n\n    getValue (): ValueType {\n        return this.selectEl.value as ValueType;\n    }\n\n    setDeltaValue (delta: number): void {\n        let index = 0;\n        for (let i = 0; i < this.optionArr.length; i++) {\n            const option = this.optionArr[i];\n            if (option.item && '' + option.item[0] === this.selectEl.value) {\n                index = i;\n                break;\n            }\n        }\n        index = Math.max(0, Math.min(this.optionArr.length -1, index + delta));\n        const option = this.optionArr[index];\n        this.selectEl.value = option.item ? option.item[0] : '';\n        this.onChange && this.onChange(this.getValue());\n    }\n\n    getElement (): HTMLElement {\n        return this.selectEl;\n    }\n\n    updateLabel (id: ValueType, label: string): void {\n        this.optionArr.forEach(option => {\n            if (option.item && option.item[0] === id && option.el) {\n                option.item[1] = label;\n                option.el.textContent = option.item[1];\n            }\n        });\n    }\n\n    setOptionArr (optionArr: (TSelectItem<ValueType> | undefined)[]): void {\n        this.optionArr = [];\n        this.selectEl.innerHTML = '';\n        for (let i = 0; i < optionArr.length; i++) {\n            const item = optionArr[i];\n            if (!item) {\n                this.optionArr.push({\n                    item,\n                });\n                continue;\n            }\n            const el = document.createElement('option');\n            el.value = item[0];\n            el.textContent = item[1];\n            if (item[2]) {\n                BB.css(el, item[2].css);\n            }\n            this.optionArr.push({\n                item,\n                el,\n            });\n            this.selectEl.append(el);\n        }\n    }\n\n    destroy (): void {\n        this.selectEl.removeEventListener('change', this.changeListener);\n    }\n    \n}\n","import {BB} from '../../../bb/bb';\n\n/**\n * Toggle button with an image\n */\nexport class ImageToggle {\n\n    private readonly rootEl: HTMLElement;\n    private isActive: boolean;\n\n    private update (): void {\n        this.rootEl.classList.toggle('image-toggle-active', this.isActive);\n    }\n\n    // --- public ---\n    constructor (\n        p: {\n            initValue: boolean;\n            title: string;\n            isRadio?: boolean; // if true, can't click when active\n            onChange: (b: boolean) => void;\n            image: string;\n            darkInvert?: boolean;\n        }\n    ) {\n        this.isActive = !!p.initValue;\n        this.rootEl = BB.el({\n            className: 'image-toggle',\n            title: p.title,\n            content: BB.el({\n                className: 'image-toggle__im' + (p.darkInvert ? ' dark-invert' : ''),\n                css: {\n                    backgroundImage: \"url('\" + p.image + \"')\",\n                },\n            }),\n            onClick: (e) => {\n                e.preventDefault();\n                if (p.isRadio && this.isActive) {\n                    return;\n                }\n                this.isActive = !this.isActive;\n                this.update();\n                p.onChange(this.isActive);\n            },\n        });\n\n\n        this.update();\n    }\n\n    // --- interface ---\n    setValue (b: boolean): void {\n        this.isActive = !!b;\n        this.update();\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValue (): boolean {\n        return this.isActive;\n    }\n\n    destroy (): void {\n        BB.destroyEl(this.rootEl);\n    }\n}\n","import {BB} from '../../../bb/bb';\nimport {ImageToggle} from './image-toggle';\n\ntype TOptionItem<IdType> = {\n    id: IdType;\n    title: string;\n    image: string;\n    darkInvert?: boolean;\n};\n\n/**\n * Radio input group. each one has an image\n */\nexport class ImageRadioList<IdType> {\n\n    private readonly rootEl: HTMLElement;\n    private activeIndex: number;\n    private readonly optionArr: {\n        id: IdType;\n        radioEl: ImageToggle;\n    }[];\n\n    // --- public ---\n    constructor (\n        p: {\n            optionArr: TOptionItem<IdType>[];\n            initId: string;\n            onChange: (id: IdType) => void;\n        }\n    ) {\n        this.rootEl = BB.el({\n            className: 'image-radio-wrapper',\n            css: {\n                display: 'flex',\n            },\n        });\n\n        this.optionArr = [];\n\n        const select = (index: number, id: IdType): void => {\n            this.activeIndex = index;\n            for (let i = 0; i < this.optionArr.length; i++) {\n                this.optionArr[i].radioEl.setValue(i === this.activeIndex);\n            }\n            p.onChange(id);\n        };\n\n        let initialIndex;\n        const createOption = (index: number, o: TOptionItem<IdType>): {\n            id: IdType;\n            radioEl: ImageToggle;\n        } => {\n            if (o.id === p.initId) {\n                initialIndex = index;\n            }\n            const radioEl = new ImageToggle({\n                image: o.image,\n                title: o.title,\n                initValue: o.id === p.initId,\n                isRadio: true,\n                onChange: () => {\n                    select(index, o.id);\n                },\n                darkInvert: o.darkInvert,\n            });\n            this.rootEl.append(radioEl.getElement());\n\n            return {\n                id: o.id,\n                radioEl,\n            };\n        };\n\n        for (let i = 0; i < p.optionArr.length; i++) {\n            this.optionArr.push(createOption(i, p.optionArr[i]));\n        }\n\n        if (initialIndex === undefined) {\n            throw new Error('initId not in optionArr');\n        }\n        this.activeIndex = initialIndex;\n    }\n\n    // --- interface ---\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValue (): IdType {\n        return this.optionArr[this.activeIndex].id;\n    }\n\n    destroy (): void {\n        this.optionArr.forEach(item => {\n            item.radioEl.destroy();\n        });\n    }\n}\n","import {BB} from '../../../bb/bb';\nimport {LANG} from '../../../language/language';\nimport iconImg from '/src/app/img/ui/brush-pressure.svg';\nimport {BoxToggle} from './box-toggle';\n\n/**\n * small toggle button with a pen icon - representing toggling pressure sensitivity\n * @param isChecked initial value\n * @param changeCallback called on change\n */\nexport const createPenPressureToggle = function (\n    isChecked: boolean,\n    changeCallback: (b: boolean) => void,\n): HTMLElement {\n\n    const toggleEl = new BoxToggle({\n        label: BB.el({\n            className: 'dark-invert',\n            css: {\n                width: '17px',\n                height: '17px',\n                backgroundImage: 'url(\"' + iconImg + '\")',\n                backgroundSize: 'contain',\n                backgroundRepeat: 'no-repeat',\n                margin: '1px',\n                borderRadius: '3px',\n            },\n        }),\n        title: LANG('brush-toggle-pressure'),\n        init: isChecked,\n        onChange: (b) => {\n            changeCallback(b);\n        },\n    });\n\n\n    return toggleEl.getElement();\n};","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"brush-pressure.f4437531.svg\";","import {BB} from '../../../bb/bb';\n\nexport class BoxToggle {\n    el: HTMLElement;\n    value: boolean;\n\n    update (): void {\n        this.el.classList.toggle('kl-box-toggle--active', this.value);\n    }\n\n    // --- public ---\n    constructor (\n        p: {\n            label: string | HTMLElement | SVGElement;\n            title?: string;\n            init?: boolean;\n            onChange: (b: boolean) => void;\n        }\n    ) {\n        this.value = !!p.init;\n        this.el = BB.el({\n            content: p.label,\n            title: p.title,\n            className: (typeof p.label === 'string') ? 'kl-box-toggle' : 'kl-box-toggle kl-box-toggle--custom-el',\n            onClick: () => {\n                this.value = !this.value;\n                this.update();\n                p.onChange(this.value);\n            },\n            css: {\n                cursor: 'pointer',\n            },\n        });\n        if (typeof p.label !== 'string') {\n            BB.css(p.label, {\n                display: 'block',\n                pointerEvents: 'none',\n            });\n        }\n        this.update();\n    }\n\n    getValue (): boolean {\n        return this.value;\n    }\n\n    setValue (b: boolean): void {\n        this.value = !!b;\n        this.update();\n    }\n\n    getElement (): HTMLElement {\n        return this.el;\n    }\n\n    destroy (): void {\n        BB.destroyEl(this.el);\n    }\n}","import {BB} from '../../../bb/bb';\nimport {calcSliderFalloffFactor} from './slider-falloff';\nimport {IKlSliderConfig} from '../../kl-types';\nimport {languageStrings} from '../../../language/language';\nimport {KlSliderManualInput} from './kl-slider-manual-input';\nimport {SplineInterpolator} from '../../../bb/math/line';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\nimport {IPointerEvent} from '../../../bb/input/event.types';\nimport {IChainElement} from '../../../bb/input/event-chain/event-chain.types';\n\n/**\n * Horizontal slider, can be changed by dragging anywhere on it. Has a label & value.\n * e.g. used for brush size\n *\n * left mouse button - set absolute value\n * right mouse button - change relative value\n * drag mouse vertically away - precision mode\n * double-click/tap slider - manual input mode\n *\n * Values can be spline interpolated\n * On change callback can be debounced\n *\n */\nexport class KlSlider {\n\n    /*\n    Three types of values\n    - value - the actual value, when using setValue(), getValue(), and what is emitted\n    - displayValue - the number that the user sees on the slider and in the manual input field\n        - might be further formatted with formatFunc\n        - also might be the same as value, if no toDisplayValue function provided\n    - sliderValue - the draggable position of the slider, 0 - 1\n     */\n\n    private value: number;\n\n    private readonly elementWidth: number;\n    private readonly elementHeight: number;\n    private isEnabled: boolean;\n\n    private min: number; // min value\n    private max: number; // max value\n    private useSpline: boolean;\n    private splineInterpolator: undefined | SplineInterpolator;\n    private readonly resolution: number;\n\n    private readonly isChangeOnFinal: boolean;\n    private readonly formatFunc: undefined | ((val: number) => number | string);\n    private readonly unit: string | undefined;\n\n    private readonly onChange: (val: number) => void;\n    private readonly valueToDisplayValue: (value: number) => number;\n    private readonly displayValueToValue: (displayValue: number) => number;\n\n\n    private readonly rootEl: HTMLElement;\n    private readonly sliderWrapperEl: HTMLElement;\n    private readonly textEl: HTMLElement; // displays label, displayValue\n    private readonly label: string;\n    private readonly control: HTMLElement;\n    private manualInput: undefined | KlSliderManualInput;\n    private readonly manualInputRoundDigits: number | undefined;\n\n    private pointerListener: PointerListener | undefined;\n    private readonly pointerListenerTimeout: ReturnType<typeof setTimeout>;\n\n    private readonly eventResMs: undefined | number;\n    private emitValue: undefined | number; // next value for interval\n    private emitInterval: (ReturnType<typeof setTimeout> | undefined); // interval of eventResMs which calls onChange()\n\n    private valueToSliderValue (value: number): number {\n        if (this.useSpline && this.splineInterpolator) {\n            return this.splineInterpolator.findX(value, Math.floor(this.resolution)) || 0;\n        }\n        return (value - this.min) / (this.max - this.min);\n    }\n\n    private sliderValueToValue (sliderValue: number): number {\n        let result = this.min + sliderValue * (this.max - this.min);\n        if (this.useSpline && this.splineInterpolator) {\n            result = this.splineInterpolator.interpolate(sliderValue) || 0;\n        }\n        return result;\n    }\n\n    private updateLabel (): void {\n        let displayValue: number | string = this.valueToDisplayValue(this.value);\n        displayValue = this.formatFunc ? this.formatFunc(displayValue) : Math.round(displayValue);\n        displayValue = displayValue.toLocaleString(languageStrings.getCode());\n        const unit = this.unit !== undefined ? this.unit : '';\n        this.textEl.innerHTML = this.label + '&nbsp;&nbsp;<span style=\"font-weight:bold\">' + displayValue + unit + '</span>';\n\n        const sliderValue = this.valueToSliderValue(this.value);\n        this.control.style.width = (sliderValue * this.elementWidth) + 'px';\n    }\n\n    private emit (isFinal: boolean): void {\n        if (!isFinal && this.isChangeOnFinal) {\n            return;\n        }\n\n        if (isFinal || !this.eventResMs) {\n            this.onChange(this.value);\n            if (this.emitInterval) {\n                clearInterval(this.emitInterval);\n                this.emitInterval = undefined;\n            }\n            return;\n        }\n\n        if (this.emitInterval) {\n            this.emitValue = this.value;\n\n        } else {\n            this.onChange(this.value);\n\n            this.emitInterval = setInterval(() => {\n                if (this.emitValue === undefined) {\n                    clearInterval(this.emitInterval);\n                    this.emitInterval = undefined;\n                } else {\n                    this.onChange(this.emitValue);\n                    this.emitValue = undefined;\n                }\n            }, this.eventResMs);\n        }\n    }\n\n    private updateEnable (): void {\n        this.sliderWrapperEl.classList.toggle('slider-wrapper--disabled', !this.isEnabled);\n        BB.css(this.sliderWrapperEl, {\n            opacity: this.isEnabled ? '' : '0.5',\n            pointerEvents: this.isEnabled ? '' : 'none',\n        });\n        if (this.manualInput) {\n            this.manualInput.setIsEnabled(this.isEnabled);\n        }\n    }\n\n    private showManualInput (): void {\n\n        this.manualInput = new KlSliderManualInput(\n            this.valueToDisplayValue(this.value),\n            this.valueToDisplayValue(this.min),\n            this.valueToDisplayValue(this.max),\n            this.sliderWrapperEl.getBoundingClientRect(),\n            (val) => {\n                val = this.displayValueToValue(val);\n                this.setValue(BB.clamp(val, this.min, this.max));\n                this.onChange(this.value);\n            },\n            () => {\n                BB.css(this.sliderWrapperEl, {\n                    display: '',\n                });\n                if (this.manualInput) {\n                    this.manualInput.getElement().remove();\n                    this.manualInput.destroy();\n                }\n                this.manualInput = undefined;\n            },\n            (this.manualInputRoundDigits && this.manualInputRoundDigits > 0) ? this.manualInputRoundDigits : 0,\n        );\n        this.manualInput.setIsEnabled(this.isEnabled);\n        this.rootEl.append(this.manualInput.getElement());\n        setTimeout(() => {\n            this.manualInput && this.manualInput.focus();\n        });\n        BB.css(this.sliderWrapperEl, {\n            display: 'none',\n        });\n    }\n\n\n    // --- public ---\n\n    constructor (\n        p: {\n            label: string;\n            width: number; // px\n            height: number; // px\n            min: number; // min value\n            max: number;\n            value: number;\n            resolution?: number; // int, if you want spline.findX() to use a custom resolution\n            curve?: 'quadratic' | [number, number][]; // optional. array is BB.SplineInterpolator points. 0-1\n            formatFunc?: (val: number) => number | string; // function to display a different number than value\n            onChange?: (val: number) => void;\n            isChangeOnFinal?: boolean; // only fire onChange on pointerUp\n            eventResMs?: number; // frequency of change events\n            isEnabled?: boolean; // default = true\n            manualInputRoundDigits?: number; // default 0, how value should be rounded for manual input\n            toDisplayValue?: (value: number) => number;\n            toValue?: (displayValue: number) => number;\n            unit?: string; // attached to end of value in output\n        }\n    ) {\n        this.isEnabled = p.isEnabled !== false;\n        this.manualInputRoundDigits = p.manualInputRoundDigits;\n        this.useSpline = !!p.curve;\n\n        if (!p.label) {\n            throw new Error('KlSlider missing params');\n        }\n        if (p.min != 0 && p.max != 0 && p.value != 0) {\n            if (!p.min || !p.max || !p.value) {\n                throw new Error('KlSlider broken params');\n            }\n        }\n        if (p.min >= p.max) {\n            throw new Error('KlSlider broken params');\n        }\n\n        this.min = p.min;\n        this.max = p.max;\n        this.value = BB.clamp(p.value, this.min, this.max);\n        this.elementWidth = p.width;\n        this.elementHeight = p.height;\n        this.resolution = p.resolution ? p.resolution : this.elementWidth * 2;\n\n        this.onChange = p.onChange ? p.onChange : () => {};\n        if (!p.toValue !== !p.toDisplayValue) {\n            throw new Error('both or neither have to be set, toValue and toDisplayValue');\n        }\n        this.displayValueToValue = p.toValue ? p.toValue : (displayValue) => displayValue;\n        this.valueToDisplayValue = p.toDisplayValue ? p.toDisplayValue : (value) => value;\n        this.isChangeOnFinal = !!p.isChangeOnFinal;\n        this.formatFunc = p.formatFunc;\n        this.eventResMs = p.eventResMs;\n        this.unit = p.unit;\n\n        if (this.useSpline) {\n            if (!p.curve) {\n                throw new Error('curve needs to be set if useSpline true');\n            }\n            const curveArr: [number, number][] = p.curve === 'quadratic' ? BB.quadraticSplineInput(this.min, this.max, 0.1) : p.curve;\n            this.splineInterpolator = new BB.SplineInterpolator(curveArr);\n        }\n\n        this.rootEl = BB.el({\n            css: {\n                display: 'flex',\n            },\n        });\n        this.sliderWrapperEl = BB.el({\n            parent: this.rootEl,\n            className: 'slider-wrapper',\n            css: {\n                overflow: 'hidden',\n                position: 'relative',\n                width: this.elementWidth + 'px',\n                height: this.elementHeight + 'px',\n                userSelect: 'none',\n            },\n        });\n        this.rootEl.oncontextmenu = function () {\n            return false;\n        };\n        this.label = p.label;\n        const labelFontSize = this.elementHeight - 14;\n        this.textEl = BB.el({\n            content: this.label,\n            css: {\n                position: 'absolute',\n                display: 'flex',\n                alignItems: 'center',\n                marginLeft: '7px',\n                height: '100%',\n                fontSize: labelFontSize + 'px',\n                pointerEvents: 'none',\n            },\n        });\n        this.control = BB.el({\n            className: 'slider-inner',\n            css: {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                width: (this.valueToSliderValue(this.value) * this.elementWidth) + 'px',\n                height: this.elementHeight + 'px',\n            },\n        });\n        const controlInner = document.createElement('div');\n\n        this.sliderWrapperEl.append(this.control, this.textEl);\n        this.control.append(controlInner);\n\n        this.updateEnable();\n\n\n        const doubleTapper = new BB.DoubleTapper({\n            onDoubleTap: () => {\n                this.showManualInput();\n            },\n        });\n        doubleTapper.setAllowedButtonArr(['left', 'right']);\n        const eventChain = new BB.EventChain({\n            chainArr: [\n                doubleTapper as IChainElement,\n            ],\n        });\n\n        let virtualVal: number;\n        const onPointer = (event: IPointerEvent) => {\n            event.eventPreventDefault();\n\n            if (!this.isEnabled) {\n                return;\n            }\n\n            if (event.type === 'pointerdown') {\n\n                // unfocus manual slider input\n                BB.unfocusAnyInput();\n\n                this.sliderWrapperEl.className = 'slider-wrapper slider-wrapper--active';\n\n                if (event.button === 'left') {\n                    let sliderValue = event.relX / this.elementWidth;\n                    sliderValue = Math.max(0, Math.min(1, sliderValue));\n                    this.value = this.sliderValueToValue(sliderValue);\n                    this.updateLabel();\n                    this.emit(false);\n                }\n                virtualVal = this.valueToSliderValue(this.value);\n            }\n\n            if (event.type === 'pointermove' && ['left', 'right'].includes(event.button || '')) {\n\n                let deltaX = event.dX;\n                const deltaY = Math.abs(event.pageY - (event.downPageY || 0));\n                const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\n                deltaX *= factor;\n                deltaX /= this.elementWidth;\n\n                virtualVal += deltaX;\n\n                const sliderValue = Math.max(0, Math.min(1, virtualVal));\n                this.value = this.sliderValueToValue(sliderValue);\n                this.updateLabel();\n                this.emit(false);\n            }\n\n            if (event.type === 'pointerup') {\n                this.sliderWrapperEl.className = 'slider-wrapper';\n                this.emit(true);\n            }\n\n        };\n\n        this.pointerListenerTimeout = setTimeout(() => {\n            this.pointerListener = new BB.PointerListener({\n                target: this.sliderWrapperEl,\n                fixScribble: true,\n                onPointer: (e) => {\n                    onPointer(e);\n                    eventChain.chainIn(e);\n                },\n                onWheel: (event) => {\n                    let sliderValue = this.valueToSliderValue(this.value);\n                    sliderValue = BB.clamp(sliderValue - event.deltaY / 40, 0, 1);\n                    this.value = this.sliderValueToValue(sliderValue);\n                    this.updateLabel();\n                    this.onChange(this.value);\n                },\n            });\n            this.updateLabel();\n        }, 1);\n    }\n\n    changeSliderValue (f: number): void {\n        if (!this.isEnabled) {\n            return;\n        }\n        let sliderValue = this.valueToSliderValue(this.value);\n        sliderValue = BB.clamp(sliderValue + f, 0, 1);\n        this.value = this.sliderValueToValue(sliderValue);\n        this.updateLabel();\n        this.onChange(this.value);\n    }\n\n    setValue (v: number): void {\n        this.value = BB.clamp(v, this.min, this.max);\n        this.updateLabel();\n    }\n\n    getValue (): number {\n        return this.value;\n    }\n\n    update (config: IKlSliderConfig): void {\n        this.min = config.min;\n        this.max = config.max;\n        this.useSpline = !!config.curve;\n        if (this.useSpline) {\n            if (!config.curve) {\n                throw new Error('curve needs to be set if useSpline true');\n            }\n            const curveArr = config.curve === 'quadratic' ? BB.quadraticSplineInput(this.min, this.max, 0.1) : config.curve;\n            this.splineInterpolator = new BB.SplineInterpolator(curveArr);\n        } else {\n            this.splineInterpolator = undefined;\n        }\n        this.setIsEnabled(!config.isDisabled);\n    }\n\n    setIsEnabled (e: boolean): void {\n        this.isEnabled = !!e;\n        this.updateEnable();\n    }\n\n    destroy (): void {\n        clearTimeout(this.pointerListenerTimeout);\n        this.pointerListener && this.pointerListener.destroy();\n        if (this.manualInput) {\n            this.manualInput.destroy();\n        }\n        if (this.emitInterval) {\n            clearInterval(this.emitInterval);\n        }\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n}\n","/**\n * To make sliders more fine-grained. The falloff when moving cursor away from cursor.\n * Returns the factor [0,1]\n *  0 -> infinite movement required for change of 1\n *  1 -> 1px movement for change of 1\n *\n * @param deltaY vertical distance from pointerdown\n * @param isRightButton\n */\nexport function calcSliderFalloffFactor (deltaY: number, isRightButton: boolean): number {\n    let result = Math.min(10, 1 + Math.pow(Math.floor(deltaY / 50), 2));\n    if (isRightButton) {\n        result *= 2;\n    }\n    return 1 / result;\n}\n","import {BB} from '../../../bb/bb';\nimport {input} from './input';\n\n/**\n * Used by KlSlider. Allows user to type in value in input (type=number) field, instead of dragging with mouse.\n * Input goes away when losing focus, or when pressing Enter/Escape.\n */\nexport class KlSliderManualInput {\n\n    private readonly input: HTMLInputElement;\n    private isEnabled: boolean = true;\n    private scrollBefore: { x: number; y: number } | undefined; // window scroll position on creation\n    private lastValue: number; // last emitted value\n    private isClosed: boolean = false;\n\n    private emit (): void {\n        if (this.lastValue !== Number(this.input.value)) {\n            this.onChange(Number(this.input.value));\n            this.lastValue = Number(this.input.value);\n        }\n    }\n\n    private privateOnClose (): void {\n        if (this.isClosed) {\n            return;\n        }\n        this.isClosed = true;\n\n        this.emit();\n        this.onClose();\n        setTimeout(() => {\n            // because iPad keyboard changes the scroll position\n            this.scrollBefore && window.scrollTo(this.scrollBefore.x, this.scrollBefore.y);\n            this.scrollBefore = undefined;\n        });\n    }\n\n    // --- public ---\n\n    constructor (\n        value: number, // initial value (displayValue)\n        min: number,\n        max: number,\n        rect: DOMRect, // size of input field\n        private onChange: (displayValue: number) => void,\n        private onClose: () => void,\n        roundDigits?: number,\n    ) {\n\n        this.input = input({\n            type: 'number',\n            init: value,\n            min,\n            max,\n            callback: (val) => {\n                this.emit();\n            },\n        });\n        if (roundDigits !== 0) {\n            this.input.setAttribute('step', 'any');\n        }\n        this.input.onblur = () => {\n            this.privateOnClose();\n        };\n        this.input.addEventListener('keyup', (e) => {\n            if (['Enter', 'Escape'].includes(e.key)) {\n                this.privateOnClose();\n            } else {\n                this.emit();\n            }\n        });\n        this.input.addEventListener('wheel', () => this.emit());\n\n        this.scrollBefore = {\n            x: window.scrollX,\n            y: window.scrollY,\n        };\n\n        let currentValue;\n        if (roundDigits || roundDigits === 0) {\n            currentValue = BB.round(value, roundDigits);\n        } else {\n            currentValue = value;\n        }\n        this.lastValue = currentValue;\n        this.input.value = '' + currentValue;\n\n        BB.css(this.input, {\n            width: rect.width + 'px',\n            height: rect.height + 'px',\n        });\n    }\n\n    getElement () {\n        return this.input;\n    }\n\n    setIsEnabled (b: boolean): void {\n        this.isEnabled = !!b;\n    }\n\n    focus (): void {\n        this.input.focus();\n        this.input.select();\n    }\n\n    destroy (): void {\n        BB.destroyEl(this.input);\n    }\n}","import {BB} from '../../../bb/bb';\nimport {input} from '../components/input';\nimport {showModal} from './base/showModal';\nimport {LANG} from '../../../language/language';\nimport copyImg from '/src/app/img/ui/copy.svg';\nimport {IRGB} from '../../kl-types';\nimport {RGB} from '../../../bb/color/color';\nimport {c} from '../../../bb/base/c';\nimport {css} from '@emotion/css';\n\n\ntype TInputRow = {\n    update: () => void;\n    destroy: () => void;\n    element: HTMLElement;\n};\n\n/**\n * dialog for manually inputting the color\n */\nexport class HexColorDialog {\n\n\n    // ---- public ----\n    constructor (\n        p: {\n            color: IRGB;\n            onClose: (rgb: IRGB | undefined) => void;\n        }\n    ) {\n        let lastValidRgb: RGB = new BB.RGB(p.color.r, p.color.g, p.color.b);\n\n        const previewEl = BB.el({\n            css: {\n                width: '20px',\n                height: '20px',\n                marginBottom: '10px',\n                boxShadow: 'inset 0 0 0 1px #fff, 0 0 0 1px #000',\n                background: '#' + BB.ColorConverter.toHexString(lastValidRgb),\n            },\n        });\n\n        // --- Hex ---\n\n        const hexLabel = BB.el({\n            content: LANG('mci-hex'),\n        });\n        const hexInput = input({\n            init: '#' + BB.ColorConverter.toHexString(lastValidRgb),\n            css: {\n                width: '80px',\n            },\n            callback: function () {\n                let rgbObj = BB.ColorConverter.hexToRGB(hexInput.value);\n                if (!rgbObj) {\n                    rgbObj = lastValidRgb;\n                    hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\n                } else {\n                    lastValidRgb = rgbObj;\n                }\n                previewEl.style.background = '#' + BB.ColorConverter.toHexString(rgbObj);\n\n                for (let i = 0; i < rgbArr.length; i++) {\n                    rgbArr[i].update();\n                }\n            },\n        });\n        const copyButton = BB.el({\n            tagName: 'button',\n            content: '<img src=\"' + copyImg + '\" height=\"20\" alt=\"\"/>',\n            title: LANG('mci-copy'),\n            onClick: function () {\n                hexInput.select();\n                navigator.clipboard.writeText(hexInput.value).then().catch();\n            },\n        });\n\n        const hexRowEl = c({\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginBottom: '15px',\n                flexWrap: 'wrap',\n                gap: '5px 10px',\n                maxWidth: '250px',\n            },\n        }, [\n            hexLabel,\n            c(',flex,items-center,gap-10', [\n                hexInput,\n                copyButton,\n            ]),\n        ]);\n        setTimeout(function () {\n            hexInput.focus();\n            hexInput.select();\n        }, 0);\n\n\n        // --- R G B ---\n        function createRgbInputRow (labelStr: string, attributeStr: 'r' | 'g' | 'b'): TInputRow {\n\n            const inputEl = input({\n                init: lastValidRgb[attributeStr],\n                min: 0,\n                max: 255,\n                type: 'number',\n                css: {\n                    width: '80px',\n                },\n                callback: function () {\n                    if (inputEl.value === '' || parseFloat(inputEl.value) < 0 || parseFloat(inputEl.value) > 255) {\n                        result.update();\n                        return;\n                    }\n                    inputEl.value = '' + Math.round(parseFloat(inputEl.value));\n                    lastValidRgb[attributeStr] = Number(inputEl.value);\n                    previewEl.style.background = '#' + BB.ColorConverter.toHexString(lastValidRgb);\n                    hexInput.value = '#' + BB.ColorConverter.toHexString(lastValidRgb);\n                },\n            });\n\n            const rowEl = c('tr', [\n                c('td,pr-10', labelStr),\n                c('td', [inputEl]),\n            ]);\n\n            const result = {\n                update: (): void => {\n                    inputEl.value = '' + lastValidRgb[attributeStr];\n                },\n                destroy: (): void => {\n                    BB.unsetEventHandler(inputEl, 'onchange');\n                },\n                element: rowEl,\n            };\n            return result;\n        }\n        const rgbArr: TInputRow[] = [\n            createRgbInputRow(LANG('red'), 'r'),\n            createRgbInputRow(LANG('green'), 'g'),\n            createRgbInputRow(LANG('blue'), 'b'),\n        ];\n\n        const tableCss = css({\n            borderCollapse: 'collapse',\n            'td': {\n                paddingBottom: '5px',\n            },\n        });\n        const rootEl = c('', [\n            previewEl,\n            hexRowEl,\n            c('table.' + tableCss, [c('tbody', rgbArr.map(item => item.element))]),\n        ]);\n\n        showModal({\n            target: document.body,\n            message: `<b>${LANG('manual-color-input')}</b>`,\n            div: rootEl,\n            autoFocus: false,\n            clickOnEnter: 'Ok',\n            buttons: ['Ok', 'Cancel'],\n            callback: function (resultStr) {\n                BB.destroyEl(copyButton);\n                rgbArr.forEach(item => item.destroy());\n                rgbArr.splice(0, rgbArr.length);\n\n                p.onClose(resultStr === 'Ok' ? BB.ColorConverter.hexToRGB(hexInput.value) : undefined);\n            },\n        });\n    }\n\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"copy.4adadd0c.svg\";","import {IKeyStringOptional} from '../bb-types';\nimport {BB} from '../bb';\nimport {el} from './ui';\n\nfunction decomposeElString (el: string) {\n    if (el === '') {\n        return {};\n    }\n\n    let split: string[];\n    let tagName: string;\n    const classes: string[] = [];\n\n    split = el.split('.');\n\n    if (split.length === 1) {\n        split = split[0].split(',');\n        tagName = split.shift()!;\n\n    } else {\n        tagName = split.shift()!;\n        split.forEach((item, index) => {\n            const isLast = index === split.length - 1;\n            if (isLast) {\n                split = item.split(',');\n                const last = split.shift();\n                if (last !== undefined) {\n                    classes.push(last);\n                }\n            } else {\n                classes.push(item);\n            }\n        });\n    }\n\n    const result = {} as {\n        tagName?: string;\n        classes?: string[];\n        styles?: string[];\n    };\n    if (tagName !== '') {\n        result.tagName = tagName;\n    }\n    if (classes.length > 0) {\n        result.classes = classes;\n    }\n    if (split.length > 0) {\n        result.styles = split;\n    }\n    return result;\n}\n\nfunction applyStyleNames (el: HTMLElement, styleNames: string[]) {\n    const style: IKeyStringOptional = {};\n\n    const operations: {\n        [key: string]: (params: string[]) => void;\n    } = {\n        c: (params) => {\n            style.color = params[0];\n        },\n        bg: (params) => {\n            style.background = params[0];\n        },\n        p: (params) => {\n            style.padding = params[0] + 'px';\n        },\n        py: (params) => {\n            style.paddingTop = params[0] + 'px';\n            style.paddingBottom = params[0] + 'px';\n        },\n        pt: (params) => {\n            style.paddingTop = params[0] + 'px';\n        },\n        pr: (params) => {\n            style.paddingRight = params[0] + 'px';\n        },\n        pb: (params) => {\n            style.paddingBottom = params[0] + 'px';\n        },\n        pl: (params) => {\n            style.paddingLeft = params[0] + 'px';\n        },\n        mt: (params) => {\n            style.marginTop = params[0] + 'px';\n        },\n        mr: (params) => {\n            style.marginRight = params[0] + 'px';\n        },\n        mb: (params) => {\n            style.marginBottom = params[0] + 'px';\n        },\n        ml: (params) => {\n            style.marginLeft = params[0] + 'px';\n        },\n\n        // flex\n        flex: () => {\n            style.display = 'flex';\n        },\n        'flexCol': () => {\n            style.flexDirection = 'column';\n        },\n        'flexWrap': () => {\n            style.flexWrap = 'wrap';\n        },\n        gap: (params) => {\n            style.gap = params.map(item => item + 'px').join(' ');\n        },\n        grow: () => {\n            style.flexGrow = '1';\n        },\n        justify: (params) => {\n            style.justifyContent = params[0];\n        },\n        items: (params) => {\n            style.alignItems = params[0];\n        },\n\n        hidden: () => {\n            style.display = 'none';\n        },\n        nowrap: () => {\n            style.whiteSpace = 'nowrap';\n        },\n        abs: (params) => {\n            style.position = 'absolute';\n            style.left = params[0] + 'px';\n            style.top = params[1] + 'px';\n        },\n        w: (params) => {\n            style.width = params[0] === 'full' ? '100%' : params[0] + 'px';\n        },\n        h: (params) => {\n            style.height = params[0] === 'full' ? '100%' : params[0] + 'px';\n        },\n        minh: (params) => {\n            style.minHeight = params[0] + 'px';\n        },\n        z: (params) => {\n            style.zIndex = params[0];\n        },\n        overflow: (params) => {\n            style.overflow = params[0];\n        },\n        pos: (params) => {\n            style.position = params[0];\n        },\n        left: (params) => {\n            style.left = params[0] === 'full' ? '100%' : params[0] + 'px';\n        },\n        top: (params) => {\n            style.top = params[0] === 'full' ? '100%' : params[0] + 'px';\n        },\n        right: (params) => {\n            style.right = params[0] === 'full' ? '100%' : params[0] + 'px';\n        },\n        bottom: (params) => {\n            style.bottom = params[0] === 'full' ? '100%' : params[0] + 'px';\n        },\n        size: (params) => {\n            style.fontSize = params[0] + 'px';\n        },\n        pointer: (params) => {\n            style.pointerEvents = params[0];\n        },\n    };\n\n    styleNames.forEach(item => {\n        const params = item.split('-');\n        const operation = params.shift()!;\n        operations[operation](params);\n    });\n    BB.css(el, style);\n}\n\n/**\n * composes HTML\n */\nexport function c (\n    element?: HTMLElement | string | Parameters<typeof el>[0],\n    inner?: string | (SVGElement | HTMLElement | string)[]\n): HTMLElement {\n    if (element === undefined) {\n        return document.createElement('div');\n    }\n    if (typeof element !== 'string') {\n        if (!(element instanceof HTMLElement)) {\n            element = el(element);\n        }\n        if (inner) {\n            if (typeof inner === 'string') {\n                element.innerHTML = inner;\n            } else {\n                element.append(...inner);\n            }\n        }\n\n        return element;\n    }\n\n    const decomp = decomposeElString(element);\n    const result = document.createElement(decomp.tagName ?? 'div');\n    decomp.classes && result.classList.add(...decomp.classes);\n    decomp.styles && applyStyleNames(result, decomp.styles);\n\n    if (inner) {\n        if (typeof inner === 'string') {\n            result.innerHTML = inner;\n        } else {\n            result.append(...inner);\n        }\n    }\n    return result;\n}\n","import createEmotion from '../create-instance/dist/emotion-css-create-instance.esm.js';\nimport '@emotion/cache';\nimport '@emotion/serialize';\nimport '@emotion/utils';\n\nvar _createEmotion = createEmotion({\n  key: 'css'\n}),\n    flush = _createEmotion.flush,\n    hydrate = _createEmotion.hydrate,\n    cx = _createEmotion.cx,\n    merge = _createEmotion.merge,\n    getRegisteredStyles = _createEmotion.getRegisteredStyles,\n    injectGlobal = _createEmotion.injectGlobal,\n    keyframes = _createEmotion.keyframes,\n    css = _createEmotion.css,\n    sheet = _createEmotion.sheet,\n    cache = _createEmotion.cache;\n\nexport { cache, css, cx, flush, getRegisteredStyles, hydrate, injectGlobal, keyframes, merge, sheet };\n","import createCache from '@emotion/cache';\nimport { serializeStyles } from '@emotion/serialize';\nimport { getRegisteredStyles, insertStyles } from '@emotion/utils';\n\nfunction insertWithoutScoping(cache, serialized) {\n  if (cache.inserted[serialized.name] === undefined) {\n    return cache.insert('', serialized, cache.sheet, true);\n  }\n}\n\nfunction merge(registered, css, className) {\n  var registeredStyles = [];\n  var rawClassName = getRegisteredStyles(registered, registeredStyles, className);\n\n  if (registeredStyles.length < 2) {\n    return className;\n  }\n\n  return rawClassName + css(registeredStyles);\n}\n\nvar createEmotion = function createEmotion(options) {\n  var cache = createCache(options); // $FlowFixMe\n\n  cache.sheet.speedy = function (value) {\n    if (process.env.NODE_ENV !== 'production' && this.ctr !== 0) {\n      throw new Error('speedy must be changed before any rules are inserted');\n    }\n\n    this.isSpeedy = value;\n  };\n\n  cache.compat = true;\n\n  var css = function css() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    var serialized = serializeStyles(args, cache.registered, undefined);\n    insertStyles(cache, serialized, false);\n    return cache.key + \"-\" + serialized.name;\n  };\n\n  var keyframes = function keyframes() {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    var serialized = serializeStyles(args, cache.registered);\n    var animation = \"animation-\" + serialized.name;\n    insertWithoutScoping(cache, {\n      name: serialized.name,\n      styles: \"@keyframes \" + animation + \"{\" + serialized.styles + \"}\"\n    });\n    return animation;\n  };\n\n  var injectGlobal = function injectGlobal() {\n    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n\n    var serialized = serializeStyles(args, cache.registered);\n    insertWithoutScoping(cache, serialized);\n  };\n\n  var cx = function cx() {\n    for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n      args[_key4] = arguments[_key4];\n    }\n\n    return merge(cache.registered, css, classnames(args));\n  };\n\n  return {\n    css: css,\n    cx: cx,\n    injectGlobal: injectGlobal,\n    keyframes: keyframes,\n    hydrate: function hydrate(ids) {\n      ids.forEach(function (key) {\n        cache.inserted[key] = true;\n      });\n    },\n    flush: function flush() {\n      cache.registered = {};\n      cache.inserted = {};\n      cache.sheet.flush();\n    },\n    // $FlowFixMe\n    sheet: cache.sheet,\n    cache: cache,\n    getRegisteredStyles: getRegisteredStyles.bind(null, cache.registered),\n    merge: merge.bind(null, cache.registered, css)\n  };\n};\n\nvar classnames = function classnames(args) {\n  var cls = '';\n\n  for (var i = 0; i < args.length; i++) {\n    var arg = args[i];\n    if (arg == null) continue;\n    var toAdd = void 0;\n\n    switch (typeof arg) {\n      case 'boolean':\n        break;\n\n      case 'object':\n        {\n          if (Array.isArray(arg)) {\n            toAdd = classnames(arg);\n          } else {\n            toAdd = '';\n\n            for (var k in arg) {\n              if (arg[k] && k) {\n                toAdd && (toAdd += ' ');\n                toAdd += k;\n              }\n            }\n          }\n\n          break;\n        }\n\n      default:\n        {\n          toAdd = arg;\n        }\n    }\n\n    if (toAdd) {\n      cls && (cls += ' ');\n      cls += toAdd;\n    }\n  }\n\n  return cls;\n};\n\nexport { createEmotion as default };\n","import {BB} from '../../../bb/bb';\nimport {HexColorDialog} from '../modals/color-slider-hex-dialog';\nimport {calcSliderFalloffFactor} from './slider-falloff';\nimport eyedropperImg from '/src/app/img/ui/tool-picker.svg';\nimport {LANG} from '../../../language/language';\nimport {IRGB} from '../../kl-types';\nimport {HSV, RGB} from '../../../bb/color/color';\nimport {ERASE_COLOR} from '../../brushes/erase-color';\n\n/**\n * big main HS+V color slider\n * 2 elements: slider, and colorpreview(output) + eyedropper\n */\nexport class KlColorSlider {\n\n    private readonly rootEl: HTMLElement;\n    private readonly outputDiv: HTMLElement;\n    private readonly divPreview: HTMLElement;\n    private readonly hexButton: HTMLElement;\n    private readonly secondaryColorBtn: HTMLElement;\n    private primaryColorRGB: RGB;\n    private primaryColorHSV: HSV;\n    private secondaryColorRGB: RGB;\n    private secondaryColorHSV: HSV;\n    private readonly controlH: HTMLElement;\n    private pickCallback: undefined | ((b: boolean) => void);\n    private isPicking: boolean;\n    private readonly pickerButton: HTMLElement;\n    private readonly width: number;\n    private readonly height: number; // hue slider and output height\n    private readonly hueStop: Element;\n\n    private readonly SVContainer: HTMLElement;\n    private readonly pointerSV: HTMLElement;\n    private svHeight: number;\n    private readonly svSvg: HTMLElement;\n\n    private readonly emitColor: (rgb: RGB) => void;\n\n\n\n    private updatePrimaryHSV (hsv: HSV): void {\n        if (hsv.s === 0) {\n            this.primaryColorHSV = new BB.HSV(this.primaryColorHSV.h, hsv.s, hsv.v);\n        } else {\n            this.primaryColorHSV = new BB.HSV(hsv.h, hsv.s, hsv.v);\n        }\n    }\n\n    private updateSVCanvas (): void {\n        const rgb = BB.ColorConverter.toRGB(new BB.HSV(this.primaryColorHSV.h, 100, 100));\n        BB.setAttributes(this.hueStop, {\n            'stop-color': '#' + BB.ColorConverter.toHexString(rgb),\n        });\n    }\n\n    private updateSVPointer (): void {\n        const left = this.primaryColorHSV.s / 100 * this.width - 7;\n        const top = (1 - this.primaryColorHSV.v / 100) * this.svHeight - 6;\n        BB.css(this.pointerSV, {\n            left: left + 'px',\n            top: top + 'px',\n        });\n    }\n\n    private setColPreview (): void {\n        this.divPreview.style.backgroundColor = 'rgb(' + this.primaryColorRGB.r + ',' + this.primaryColorRGB.g + ',' + this.primaryColorRGB.b + ')';\n\n        if (BB.testIsWhiteBestContrast(this.primaryColorRGB)) {\n            BB.css(this.pickerButton, {\n                filter: 'invert(1)',\n            });\n            BB.css(this.hexButton, {\n                filter: 'invert(1)',\n            });\n        } else{\n            BB.css(this.pickerButton, {\n                filter: '',\n            });\n            BB.css(this.hexButton, {\n                filter: '',\n            });\n        }\n\n    }\n\n    private updateSecondaryColor (): void {\n        this.secondaryColorBtn.style.backgroundColor = BB.ColorConverter.toRgbStr(this.secondaryColorRGB);\n    }\n\n\n\n    // ---- public ----\n\n    constructor (\n        p: {\n            width: number;\n            height: number; // hue slider and output height\n            svHeight: number;\n            startValue: IRGB; // 0-255\n            onPick: (rgb: IRGB) => void;\n        }\n    ) {\n        this.rootEl = BB.el({\n            className: 'kl-color-picker',\n            css: {\n                position: 'relative',\n            },\n        });\n        this.outputDiv = BB.el({\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n            },\n        });\n        this.width = p.width;\n        this.svHeight = p.svHeight;\n        this.height = p.height;\n        this.emitColor = p.onPick;\n\n        this.primaryColorRGB = {\n            r: parseInt('' + p.startValue.r),\n            g: parseInt('' + p.startValue.g),\n            b: parseInt('' + p.startValue.b),\n        };\n        this.primaryColorHSV = BB.ColorConverter.toHSV(p.startValue); // BB.HSV\n        this.secondaryColorRGB = {r: ERASE_COLOR, g: ERASE_COLOR, b: ERASE_COLOR};\n        this.secondaryColorHSV = BB.ColorConverter._RGBtoHSV(this.secondaryColorRGB); // BB.HSV\n\n        const svWrapper = BB.el();\n        this.svSvg = new DOMParser().parseFromString('<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"none\"><defs><linearGradient id=\"value\" gradientTransform=\"rotate(90)\"><stop offset=\"0\" stop-color=\"#fff\"/><stop offset=\"100%\" stop-color=\"#000\"/></linearGradient><linearGradient id=\"hue\" gradientTransform=\"rotate(0)\"><stop offset=\"0\" stop-color=\"#fff\"/><stop id=\"hue-stop\" offset=\"100%\" stop-color=\"#f00\"/></linearGradient></defs><rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#hue\\')\"/><rect x=\"0\" y=\"0\" width=\"100\" height=\"100\" fill=\"url(\\'#value\\')\" style=\"mix-blend-mode: multiply\"/></svg>', 'image/svg+xml').documentElement;\n        {\n            const hueStop = this.svSvg.querySelector('#hue-stop');\n            if (!hueStop) {\n                throw Error('#hue-stop not found in svSvg');\n            }\n            this.hueStop = hueStop;\n        }\n        BB.setAttributes(this.hueStop, {\n            'stop-color': '#f0f',\n        });\n        BB.css(this.svSvg, {\n            width: this.width + 'px',\n            height: this.svHeight + 'px',\n        });\n        svWrapper.append(this.svSvg);\n\n        const divH = BB.el({\n            className: 'kl-color-picker__h',\n            css: {\n                overflow: 'hidden',\n                position: 'relative',\n                width: this.width + 'px',\n                height: this.height + 'px',\n                cursor: 'ew-resize',\n                marginTop: '1px',\n                marginBottom: '1px',\n            },\n        });\n        this.divPreview = BB.el({\n            className: 'kl-color-picker__preview',\n            css: {\n                display: 'flex',\n                justifyContent: 'space-between',\n                width: (this.height * 2.5) + 'px',\n                height: this.height + 'px',\n            },\n        });\n        this.controlH = BB.el();\n\n\n\n        const createHueBg = (targetEl: HTMLElement) => {\n            const im = new Image();\n            BB.css(im, {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                display: 'none',\n                pointerEvents: 'none',\n            });\n            const cv = BB.canvas(this.width, this.height);\n            const ctx = BB.ctx(cv);\n            const gradH = ctx.createLinearGradient(0, 0, this.width, 0);\n            for (let i = 0; i < 1; i += 0.01) {\n                const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\n                let ha = (parseInt('' + col.r)).toString(16);\n                let hb = (parseInt('' + col.g)).toString(16);\n                let hc = (parseInt('' + col.b)).toString(16);\n                if (ha.length === 1) {\n                    ha = '0' + ha;\n                }\n                if (hb.length === 1) {\n                    hb = '0' + hb;\n                }\n                if (hc.length === 1) {\n                    hc = '0' + hc;\n                }\n                gradH.addColorStop(i, '#' + ha + hb + hc);\n            }\n            ctx.fillStyle = gradH;\n            ctx.fillRect(0, 0, this.width, this.height);\n\n            targetEl.append(im);\n            im.alt = 'hue';\n            im.src = cv.toDataURL('image/png');\n            im.style.display = 'block';\n        };\n\n\n\n\n\n\n\n\n        this.updateSVCanvas();\n        this.rootEl.style.width = this.width + 'px';\n        this.rootEl.oncontextmenu = () => {\n            return false;\n        };\n\n        this.SVContainer = BB.el({\n            className: 'kl-color-picker__sv',\n            css: {\n                width: this.width + 'px',\n                height: this.svHeight + 'px',\n                overflow: 'hidden',\n                display: 'block',\n                position: 'relative',\n                cursor: 'crosshair',\n            },\n        });\n\n        this.pointerSV = BB.el({\n           css: {\n               width: '12px',\n               height: '12px',\n               borderRadius: '6px',\n               position: 'absolute',\n               pointerEvents: 'none',\n               boxShadow: '0px 0px 0 1px #000, inset 0px 0px 0 1px #fff',\n           },\n        });\n\n        this.SVContainer.append(svWrapper, this.pointerSV);\n        this.updateSVPointer();\n        this.rootEl.append(this.SVContainer, divH);\n        this.outputDiv.append(this.divPreview);\n\n        //divH.className = \"svSlider\";\n        BB.css(this.controlH, {\n            width: '1px',\n            height: this.height + 'px',\n            background: '#000',\n            borderLeft: '1px solid #fff',\n            position: 'absolute',\n            top: '0',\n            left: parseInt('' + (this.primaryColorHSV.h / 360 * this.width - 1)) + 'px',\n        });\n\n\n        const virtualHSV = {\n            h: 0,\n            s: 0,\n            v: 0,\n        };\n\n\n        this.pickerButton = BB.el({\n            title: LANG('eyedropper') + ' [Alt]',\n            className: 'color-picker-preview-button',\n            css: {\n                width: '30px',\n                height: '30px',\n                backgroundImage: 'url(' + eyedropperImg + ')',\n                backgroundRepeat:  'no-repeat',\n                backgroundSize: '70%',\n                backgroundPosition: 'center',\n            },\n            onClick: () => {\n                if (this.isPicking) {\n                    this.pickCallback && this.pickCallback(false);\n                    this.pickingDone();\n                } else {\n                    this.pickerButton.classList.remove('color-picker-preview-button-hover');\n                    this.pickerButton.classList.add('color-picker-preview-button-active');\n                    this.isPicking = true;\n                    this.pickCallback && this.pickCallback(true);\n                }\n            },\n        });\n        this.isPicking = false;\n\n        const pickerButtonPointerListener = new BB.PointerListener({\n            target: this.pickerButton,\n            onEnterLeave: (isOver) => {\n                if (this.isPicking) {\n                    return;\n                }\n                this.pickerButton.classList.toggle('color-picker-preview-button-hover', isOver);\n            },\n        });\n        this.divPreview.append(this.pickerButton);\n\n\n        this.hexButton = BB.el({\n            content: '#',\n            className: 'color-picker-preview-button',\n            title: LANG('manual-color-input'),\n            css: {\n                height: '100%',\n                width: this.height + 'px',\n                lineHeight: this.height + 'px',\n                fontSize: (this.height * 0.65) + 'px',\n            },\n            onClick: () => {\n                new HexColorDialog({\n                    color: new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b),\n                    onClose: (rgbObj) => {\n                        if (!rgbObj) {\n                            return;\n                        }\n                        this.setColor(rgbObj);\n                        this.emitColor(new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b));\n                    },\n                });\n            },\n        });\n        const hexButtonPointerListener = new BB.PointerListener({\n            target: this.hexButton,\n            onEnterLeave: (isOver) => {\n                this.hexButton.classList.toggle('color-picker-preview-button-hover', isOver);\n            },\n        });\n        this.divPreview.append(this.hexButton);\n\n        this.setColPreview();\n\n\n        setTimeout(() => {\n            createHueBg(divH);\n            divH.append(this.controlH);\n            const svPointerListener = new BB.PointerListener({\n                target: svWrapper,\n                fixScribble: true,\n                onPointer: (event) => {\n                    if (event.type === 'pointerdown') {\n\n                        // prevent manual slider input keeping focus on iPad\n                        BB.unfocusAnyInput();\n\n                        this.SVContainer.classList.toggle('kl-color-picker--active', true);\n\n                        if (event.button === 'left') {\n\n                            virtualHSV.s = event.relX / this.width * 100;\n                            virtualHSV.v = 100 - event.relY / this.svHeight * 100;\n\n                            this.primaryColorHSV = new BB.HSV(this.primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\n                            this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\n\n                            this.updateSVPointer();\n                            this.setColPreview();\n                            this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\n                        } else {\n                            virtualHSV.s = this.primaryColorHSV.s;\n                            virtualHSV.v = this.primaryColorHSV.v;\n                        }\n                    }\n\n                    if (event.type === 'pointermove' && ['left', 'right'].includes(event.button || '')) {\n\n                        let factor = 1;\n                        if (event.button === 'right') {\n                            factor = 0.5;\n                        }\n\n                        virtualHSV.s += event.dX / this.width * 100 * factor;\n                        virtualHSV.v -= event.dY / this.svHeight * 100 * factor;\n\n                        this.primaryColorHSV = new BB.HSV(this.primaryColorHSV.h, virtualHSV.s, virtualHSV.v);\n                        this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\n                        this.updateSVPointer();\n                        this.setColPreview();\n                        this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\n\n                    }\n\n                    if (event.type === 'pointerup') {\n                        this.SVContainer.classList.toggle('kl-color-picker--active', false);\n                    }\n\n                },\n            });\n            const hPointerListener = new BB.PointerListener({\n                target: divH,\n                fixScribble: true,\n                onPointer: (event) => {\n\n                    if (event.type === 'pointerdown') {\n\n                        // prevent manual slider input keeping focus on iPad\n                        BB.unfocusAnyInput();\n\n                        divH.classList.toggle('kl-color-picker--active', true);\n\n                        if (event.button === 'left') {\n\n                            virtualHSV.h = event.relX / this.width * 359.99;\n\n                            this.primaryColorHSV = new BB.HSV(virtualHSV.h, this.primaryColorHSV.s, this.primaryColorHSV.v);\n                            this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\n                            this.controlH.style.left = (Math.round(this.primaryColorHSV.h / 359.99 * this.width) - 1) + 'px';\n                            this.updateSVCanvas();\n                            this.setColPreview();\n                            this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\n                        } else {\n                            virtualHSV.h = this.primaryColorHSV.h;\n                        }\n                    }\n\n                    if (event.type === 'pointermove' && ['left', 'right'].includes(event.button || '')) {\n\n                        const deltaY = Math.abs(event.pageY - event.downPageY!);\n                        const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\n\n                        virtualHSV.h += event.dX / this.width * 359.99 * factor;\n\n                        if (event.button === 'right') {\n                            virtualHSV.h = virtualHSV.h % 359.99;\n                            if (virtualHSV.h < 0) {\n                                virtualHSV.h += 359.99;\n                            }\n                        }\n                        virtualHSV.h = Math.min(359.99, virtualHSV.h);\n                        this.primaryColorHSV = new BB.HSV(virtualHSV.h, this.primaryColorHSV.s, this.primaryColorHSV.v);\n                        this.primaryColorRGB = BB.ColorConverter.toRGB(this.primaryColorHSV);\n                        this.controlH.style.left = (Math.round(this.primaryColorHSV.h / 359.99 * this.width) - 1) + 'px';\n                        this.updateSVCanvas();\n                        this.setColPreview();\n                        this.emitColor(BB.ColorConverter.toRGB(this.primaryColorHSV));\n\n                    }\n\n                    if (event.type === 'pointerup') {\n                        divH.classList.toggle('kl-color-picker--active', false);\n                    }\n                },\n            });\n        }, 1);\n\n\n        // --- secondary color ---\n\n        this.secondaryColorBtn = BB.el({\n            parent: this.outputDiv,\n            title: LANG('secondary-color') + ' [X]',\n            className: 'kl-color-picker__secondary',\n            css: {\n                cursor: 'pointer',\n                marginLeft: '5px',\n                width: '22px',\n                height: '22px',\n            },\n            onClick: (e) => {\n                e.preventDefault();\n                this.swapColors();\n            },\n        });\n        this.updateSecondaryColor();\n    }\n\n    setColor (c: IRGB): void {\n        this.primaryColorRGB = {r: parseInt('' + c.r), g: parseInt('' + c.g), b: parseInt('' + c.b)};\n        this.updatePrimaryHSV(BB.ColorConverter.toHSV(c));\n        this.controlH.style.left = parseInt('' + (this.primaryColorHSV.h / 359 * this.width - 1)) + 'px';\n        this.updateSVCanvas();\n        this.updateSVPointer();\n        this.setColPreview();\n    }\n\n    getColor (): RGB {\n        return new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b);\n    }\n\n    getSecondaryRGB (): RGB {\n        return new BB.RGB(this.secondaryColorRGB.r, this.secondaryColorRGB.g, this.secondaryColorRGB.b);\n    }\n\n    setPickCallback (func: (b: boolean) => void): void {\n        this.pickCallback = func;\n    }\n\n    pickingDone (): void {\n        if (!this.isPicking) {\n            return;\n        }\n        this.isPicking = false;\n        this.pickerButton.classList.remove('color-picker-preview-button-active');\n    }\n\n    enable (e: boolean): void {\n        if (e) {\n            this.rootEl.style.pointerEvents = '';\n            this.rootEl.style.opacity = '1';\n            this.outputDiv.style.pointerEvents = '';\n            this.outputDiv.style.opacity = '1';\n        } else {\n            this.rootEl.style.pointerEvents = 'none';\n            this.rootEl.style.opacity = '0.5';\n            this.outputDiv.style.pointerEvents = 'none';\n            this.outputDiv.style.opacity = '0.5';\n        }\n    }\n\n    setHeight (h: number): void {\n        h = parseInt('' +(h - this.height * 2 - 3), 10);\n        if (h === this.svHeight) {\n            return;\n        }\n        this.svHeight = h;\n        BB.css(this.svSvg, {\n            width: this.width + 'px',\n            height: this.svHeight + 'px',\n        });\n        this.SVContainer.style.height = this.svHeight + 'px';\n        this.updateSVPointer();\n    }\n\n    swapColors (): void {\n        // swap hsv\n        let tmp: RGB | HSV = this.secondaryColorHSV;\n        this.secondaryColorHSV = this.primaryColorHSV;\n        this.updatePrimaryHSV(tmp);\n        // swap rgb\n        tmp = this.secondaryColorRGB;\n        this.secondaryColorRGB = this.primaryColorRGB;\n        this.primaryColorRGB = tmp;\n\n        this.controlH.style.left = parseInt('' + (this.primaryColorHSV.h / 359 * this.width - 1)) + 'px';\n        this.updateSVCanvas();\n        this.updateSVPointer();\n        this.setColPreview();\n        this.updateSecondaryColor();\n\n        this.emitColor(new BB.RGB(this.primaryColorRGB.r, this.primaryColorRGB.g, this.primaryColorRGB.b));\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getOutputElement (): HTMLElement {\n        return this.outputDiv;\n    }\n\n}","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"tool-picker.d0e69c3a.svg\";","import {theme} from '../../theme/theme';\n\nexport const ERASE_COLOR = theme.isDark() ? 255 : 255;","import {addIsDarkListener, isDark} from '../bb/base/base';\n\nconst LS_THEME_KEY = 'klecks-theme';\n\nexport type TTheme = 'dark' | 'light';\ntype TThemeListener = () => void;\n\nclass Theme {\n\n    private storedTheme: TTheme | undefined;\n    // initialization will be overwritten.\n    private mediaQueryTheme: TTheme = 'light'; // prefers-color-scheme\n    private theme: TTheme = 'light';\n    private readonly listeners: TThemeListener[] = [];\n\n    private updateTheme (): void {\n        const oldTheme = this.theme;\n        this.theme = this.storedTheme || this.mediaQueryTheme;\n\n        if (this.theme === oldTheme) {\n            return;\n        }\n        document.body.classList.toggle('kl-theme-dark', this.theme === 'dark');\n        this.listeners.forEach(item => item());\n    }\n\n    private readLocalStorage (): TTheme | undefined {\n        let result = localStorage.getItem(LS_THEME_KEY) as unknown;\n        if (!result || (typeof result === 'string' && !['dark', 'light'].includes(result))) {\n            result = undefined;\n            localStorage.removeItem(LS_THEME_KEY); // reset because invalid\n        }\n        return result as (TTheme | undefined);\n    }\n\n    // ---- public ----\n    constructor () {\n\n        // init media query\n        this.mediaQueryTheme = isDark() ? 'dark' : 'light';\n        addIsDarkListener(() => {\n            this.mediaQueryTheme = isDark() ? 'dark' : 'light';\n            this.updateTheme();\n        });\n\n        // init local storage\n        this.storedTheme = this.readLocalStorage();\n        addEventListener('storage', (e) => {\n            if (e.key === LS_THEME_KEY) {\n                this.storedTheme = this.readLocalStorage();\n                this.updateTheme();\n            }\n        });\n\n        this.updateTheme();\n    }\n\n    isDark (): boolean {\n        return this.theme === 'dark';\n    }\n\n    addIsDarkListener (func: TThemeListener): void {\n        if (this.listeners.includes(func)) {\n            return;\n        }\n        this.listeners.push(func);\n    }\n\n    removeIsDarkListener (func: TThemeListener): void {\n        for (let i = 0; i < this.listeners.length; i++) {\n            if (this.listeners[i] === func) {\n                this.listeners.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    getMediaQueryTheme (): TTheme {\n        return this.mediaQueryTheme;\n    }\n\n    getStoredTheme (): TTheme | undefined {\n        return this.storedTheme;\n    }\n\n    setStoredTheme (theme: TTheme | undefined): void {\n        if (theme) {\n            localStorage.setItem(LS_THEME_KEY, theme);\n        } else {\n            localStorage.removeItem(LS_THEME_KEY);\n        }\n        this.storedTheme = theme;\n        this.updateTheme();\n    }\n\n}\n\nexport const theme = new Theme();","import {BB} from '../../../bb/bb';\nimport {calcSliderFalloffFactor} from './slider-falloff';\nimport {IRGB} from '../../kl-types';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\nimport {HSV} from '../../../bb/color/color';\n\n/**\n * a small color slider\n */\nexport class KlColorSliderSmall {\n\n    private readonly rootEl: HTMLElement;\n    private color: HSV;\n    private readonly svPointerListener: PointerListener;\n    private readonly hPointerListener: PointerListener;\n    private svPointerId: number | null;\n    private hPointerId: number | null;\n    private readonly width: number;\n    private readonly heightSV: number;\n    private readonly pointerSV: HTMLElement;\n    private readonly pointerH: HTMLElement;\n    private readonly canvasSV: HTMLCanvasElement;\n\n\n    private updateSV (): void {\n        const ctx = BB.ctx(this.canvasSV);\n        if(!ctx) {\n            throw new Error('couldnt create canvas');\n        }\n        for (let i = 0; i < this.canvasSV.height; i += 1) {\n            const gradient1 = ctx.createLinearGradient(0, 0, this.canvasSV.width, 0);\n\n            const colleft = BB.ColorConverter.toRGB(new BB.HSV(this.color.h, 1, 100 - (i / this.canvasSV.height * 100.0)));\n            const colright = BB.ColorConverter.toRGB(new BB.HSV(this.color.h, 100, 100 - (i / this.canvasSV.height * 100.0)));\n            gradient1.addColorStop(0, '#' + BB.ColorConverter.toHexString(colleft));\n            gradient1.addColorStop(1, '#' + BB.ColorConverter.toHexString(colright));\n            ctx.fillStyle = '#ff0000'; //needed for chrome...otherwise alpha problem\n            ctx.fillStyle = gradient1;\n            ctx.fillRect(0, i, this.canvasSV.width, 1);\n        }\n    }\n\n    private updateSVPointer (): void {\n        const left = this.color.s / 100 * this.width - 4;\n        const top = (1 - this.color.v / 100) * this.heightSV - 4;\n        BB.css(this.pointerSV, {\n            left: left + 'px',\n            top: top + 'px',\n        });\n    }\n\n    private updateHPointer (): void {\n        this.pointerH.style.left = (this.color.h / 359.999 * this.width - 1) + 'px';\n    }\n\n\n\n\n    // ----- public ----\n    constructor (\n        p: {\n            width: number;\n            heightSV: number; // height of saturation/value\n            heightH: number; // height of hue\n            color: IRGB;\n            callback: (c: IRGB) => void;\n        }\n    ) {\n        this.rootEl = BB.el({\n            css: {\n                width: p.width + 'px',\n                position: 'relative',\n                overflow: 'hidden',\n                userSelect: 'none',\n            },\n        });\n        this.rootEl.oncontextmenu = (e) => {\n            e.preventDefault();\n        };\n        this.color = BB.ColorConverter.toHSV(new BB.RGB(p.color.r, p.color.g, p.color.b));\n        this.width = p.width;\n        this.heightSV = p.heightSV;\n\n        this.canvasSV = BB.canvas(10, 10);\n        BB.css(this.canvasSV, {\n            width: this.width + 'px',\n            height: this.heightSV + 'px',\n            cursor: 'crosshair',\n        });\n\n\n        this.updateSV();\n\n        const canvasH = BB.canvas(p.width, p.heightH);\n        canvasH.style.cursor = 'ew-resize';\n        (() => {\n            const ctx = BB.ctx(canvasH);\n\n            const gradH = ctx.createLinearGradient(0, 0, p.width, 0);\n            for (let i = 0; i < 1; i += 0.01) {\n                const col = BB.ColorConverter.toRGB(new BB.HSV(i * 360, 100, 100));\n                gradH.addColorStop(i, 'rgba(' + parseInt('' + col.r) + ', ' + parseInt('' + col.g) + ', ' + parseInt('' + col.b) + ', 1)');\n            }\n            ctx.fillStyle = gradH;\n            ctx.fillRect(0, 0, p.width, p.heightH);\n\n        })();\n        BB.css(this.canvasSV, {\n            width: p.width + 'px',\n            height: p.heightSV + 'px',\n            overflow: 'hidden',\n            position: 'relative',\n        });\n        this.canvasSV.style.cssFloat = 'left';\n        canvasH.style.cssFloat = 'left';\n\n        this.rootEl.append(this.canvasSV, canvasH);\n\n        this.pointerSV = BB.el({\n            parent: this.rootEl,\n            css: {\n                width: '8px',\n                height: '8px',\n                borderRadius: '8px',\n                position: 'absolute',\n                pointerEvents: 'none',\n                boxShadow: '0 0 0 1px #000, inset 0 0 0 1px #fff',\n            },\n        });\n\n        this.pointerH = BB.el({\n            parent: this.rootEl,\n            css: {\n                width: '0',\n                height: p.heightH + 'px',\n                borderLeft: '1px solid #fff',\n                borderRight: '1px solid #000',\n                position: 'absolute',\n                top: p.heightSV + 'px',\n                pointerEvents: 'none',\n            },\n        });\n\n        this.updateSVPointer();\n        this.updateHPointer();\n\n        const virtualHSV = {\n            h: 0,\n            s: 0,\n            v: 0,\n        };\n\n        this.svPointerId = null;\n        this.svPointerListener = new BB.PointerListener({\n            target: this.canvasSV,\n            fixScribble: true,\n            onPointer: (event) => {\n\n                if (event.type === 'pointerdown') {\n\n                    // prevent manual slider input keeping focus on iPad\n                    BB.unfocusAnyInput();\n\n                    this.svPointerId = event.pointerId;\n                    if (event.button === 'left') {\n\n                        virtualHSV.s = event.relX / p.width * 100;\n                        virtualHSV.v = 100 - event.relY / p.heightSV * 100;\n\n                        this.color = new BB.HSV(this.color.h, virtualHSV.s, virtualHSV.v);\n\n                        this.updateSVPointer();\n                        p.callback(BB.ColorConverter.toRGB(this.color));\n                    } else {\n                        virtualHSV.s = this.color.s;\n                        virtualHSV.v = this.color.v;\n                    }\n                }\n\n                if (event.type === 'pointermove' && ['left', 'right'].includes('' + event.button) && this.svPointerId === event.pointerId) {\n\n                    let factor = 1;\n                    if (event.button === 'right') {\n                        factor = 0.5;\n                    }\n\n                    virtualHSV.s += event.dX / p.width * 100 * factor;\n                    virtualHSV.v -= event.dY / p.heightSV * 100 * factor;\n\n                    this.color = new BB.HSV(this.color.h, virtualHSV.s, virtualHSV.v);\n                    this.updateSVPointer();\n                    p.callback(BB.ColorConverter.toRGB(this.color));\n\n                }\n                if (event.type === 'pointerup') {\n                    this.svPointerId = null;\n                }\n\n            },\n        });\n\n        this.hPointerId = null;\n        this.hPointerListener = new BB.PointerListener({\n            target: canvasH,\n            fixScribble: true,\n            onPointer: (event) => {\n\n                if (event.type === 'pointerdown') {\n                    this.hPointerId = event.pointerId;\n                    if (event.button === 'left') {\n\n                        virtualHSV.h = event.relX / p.width * 359.99;\n\n                        this.color = new BB.HSV(virtualHSV.h, this.color.s, this.color.v);\n                        this.updateSV();\n                        this.updateHPointer();\n                        p.callback(BB.ColorConverter.toRGB(this.color));\n                    } else {\n                        virtualHSV.h = this.color.h;\n                    }\n                }\n\n                if (event.type === 'pointermove' && ['left', 'right'].includes('' + event.button) && this.hPointerId === event.pointerId) {\n\n                    const deltaY = Math.abs(event.pageY - event.downPageY!);\n                    const factor = calcSliderFalloffFactor(deltaY, event.button === 'right');\n\n                    virtualHSV.h += event.dX / p.width * 359.99 * factor;\n\n                    if (event.button === 'right') {\n                        virtualHSV.h = virtualHSV.h % 359.99;\n                        if (virtualHSV.h < 0) {\n                            virtualHSV.h += 359.99;\n                        }\n                    }\n                    virtualHSV.h = Math.min(359.99, virtualHSV.h);\n                    this.color = new BB.HSV(virtualHSV.h, this.color.s, this.color.v);\n                    this.updateSV();\n                    this.updateHPointer();\n                    p.callback(BB.ColorConverter.toRGB(this.color));\n\n                }\n                if (event.type === 'pointerup') {\n                    this.hPointerId = null;\n                }\n            },\n        });\n\n\n        const cleardiv = BB.el({\n            parent: this.rootEl,\n            css: {\n                clear: 'both',\n            },\n        });\n    }\n\n    // ---- interface ----\n    setColor (c: IRGB): void {\n        this.color = BB.ColorConverter.toHSV(new BB.RGB(c.r, c.g, c.b));\n        this.updateSV();\n        this.updateSVPointer();\n        this.updateHPointer();\n    }\n\n    getColor (): IRGB {\n        return BB.ColorConverter.toRGB(this.color);\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    destroy (): void {\n        this.svPointerListener.destroy();\n        this.hPointerListener.destroy();\n    }\n\n    end (): void {\n        this.svPointerId = null;\n        this.hPointerId = null;\n    }\n}\n","import {BB} from '../../../bb/bb';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\n\n/**\n * A slider that looks like this\n * ------O----\n */\nexport class PointSlider {\n\n    private readonly rootEl: HTMLElement;\n    private readonly sliderPoint: HTMLElement;\n    private readonly pointerListener: PointerListener;\n\n    // ---- public ----\n    constructor (\n        p: {\n            init: number;\n            width: number;\n            pointSize: number;\n            callback: (value: number, isFirst: boolean, isLast: boolean) => void;\n        }\n    ) {\n        this.rootEl = BB.el({\n            css: {\n                position: 'relative',\n            },\n        });\n        const sliderLine = BB.el({\n            parent: this.rootEl,\n            className: 'kl-point-slider__line',\n            css: {\n                marginTop: parseInt('' + (p.pointSize / 2 - 1)) + 'px',\n                width: p.width + 'px',\n            },\n        });\n        this.sliderPoint = BB.el({\n            parent: this.rootEl,\n            className: 'kl-point-slider__point',\n        });\n        let sliderPos: number;\n        let isDragging = false;\n\n        //sliderPoint\n        const touchAreaEl = BB.el({ // expand clickable area\n            parent: this.sliderPoint,\n            css: {\n                // background: 'rgba(255,0,0,0.4)',\n                margin: '-7px 0 0 -7px',\n                width: 'calc(100% + 14px)',\n                height: 'calc(100% + 7px)',\n            },\n        });\n\n        const redrawPoint = () => {\n            BB.css(this.sliderPoint, {\n                left: sliderPos + 'px',\n            });\n        };\n        const getValue = () => {\n            return sliderPos /  (p.width - p.pointSize);\n        };\n\n        {\n            let isFirst: boolean;\n            sliderPos = BB.clamp(p.init * (p.width - p.pointSize), 0, p.width - p.pointSize);\n            BB.css(this.sliderPoint, {\n                width: p.pointSize + 'px',\n                height: p.pointSize + 'px',\n                borderRadius: p.pointSize + 'px',\n            });\n            redrawPoint();\n            let imaginaryPos: number;\n            this.pointerListener = new BB.PointerListener({\n                target: this.sliderPoint,\n                fixScribble: true,\n                onPointer: (event): void => {\n                    if (event.type === 'pointerdown' && event.button === 'left') {\n                        isFirst = true;\n                        isDragging = true;\n                        imaginaryPos = sliderPos;\n                        redrawPoint();\n                        event.eventStopPropagation();\n                    } else if (event.type === 'pointermove' && event.button === 'left') {\n                        event.eventStopPropagation();\n                        imaginaryPos = imaginaryPos + event.dX;\n                        sliderPos = parseInt('' + BB.clamp(imaginaryPos, 0, p.width - p.pointSize));\n                        redrawPoint();\n                        p.callback(getValue(), isFirst, false);\n                        isFirst = false;\n                    }\n                    if (event.type === 'pointerup') {\n                        event.eventStopPropagation();\n                        isDragging = false;\n                        redrawPoint();\n                        p.callback(getValue(), false, true);\n                    }\n                },\n            });\n        }\n    }\n\n    // ---- interface ----\n\n    getEl (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setActive (isActive: boolean): void {\n        this.sliderPoint.style.backgroundColor = isActive ? '#fff' : '#eaeaea';\n    }\n\n    destroy (): void {\n        this.pointerListener.destroy();\n    }\n}\n","import {BB} from '../../../bb/bb';\nimport {IRGBA} from '../../kl-types';\nimport {theme} from '../../../theme/theme';\nimport {ColorConverter} from '../../../bb/color/color';\nimport {c} from '../../../bb/base/c';\n\n/**\n * UI to pick between colors in colorArr. can display full transparent (checkerboard).\n * Can't deal with 0.5 alpha.\n * Rectangular buttons.\n */\nexport class ColorOptions {\n\n    private readonly rootEl: HTMLElement;\n    private readonly buttonArr: {\n        el: HTMLElement;\n        setIsSelected: (b: boolean) => void;\n    }[];\n    private readonly colorArr: (IRGBA | null)[] = [];\n    private selectedIndex: number = 0;\n    private colorInput: HTMLInputElement;\n\n    private readonly updateCheckerboard: () => void;\n    private readonly onColorInputChange: () => void;\n\n    // ---- public ----\n    constructor (\n        p: {\n            colorArr: (IRGBA | null)[]; // duplicates will be removed\n            onChange: (rgbaObj: IRGBA | null) => void;\n            label?: string;\n            initialIndex?: number; // index before duplicates were removed\n            title?: string;\n        }\n    ) {\n        this.rootEl = BB.el({\n            content: p.label ? p.label : '',\n            title: p.title ?? undefined,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                gap: '7px',\n            },\n        });\n\n        this.buttonArr = [];\n        const buttonSize = 22;\n        const checkerUrl = BB.createCheckerDataUrl(5, undefined, theme.isDark());\n\n        this.onColorInputChange = () => {\n            const i = this.selectedIndex;\n            const color = this.colorArr[i];\n            if (!color || color.a < 1) {\n                // ignore\n                return;\n            }\n\n            const newRawColor = this.colorInput.value;\n            this.buttonArr[this.selectedIndex].el.style.backgroundColor = newRawColor;\n            this.colorArr[i] = {\n                ...ColorConverter.hexToRGB(newRawColor)!,\n                a: 1,\n            };\n            p.onChange(this.colorArr[i]);\n        };\n        this.colorInput = BB.el({\n            tagName: 'input',\n            custom: {\n                type: 'color',\n                tabIndex: '-1',\n            },\n        });\n        this.colorInput.onchange = this.onColorInputChange;\n        this.colorInput.oninput = this.onColorInputChange;\n\n        // build colorArr while removing duplicates\n        for (let i = 0; i < p.colorArr.length; i++) {\n            const item = p.colorArr[i];\n            let found = false;\n            for (let e = 0; e < this.colorArr.length; e++) {\n                const sItem = this.colorArr[e];\n                if (sItem === item) {\n                    found = true;\n                    break;\n                }\n                if (sItem === null || item === null) {\n                    continue;\n                }\n                if (sItem.r === item.r && sItem.g === item.g && sItem.b === item.b && sItem.a === item.a) {\n                    found = true;\n                    break;\n                }\n            }\n            if (found) {\n                continue;\n            }\n            this.colorArr.push(item);\n            if ('initialIndex' in p && p.initialIndex === i) {\n                this.selectedIndex = this.colorArr.length - 1;\n            }\n        }\n\n        for (let i = 0; i < this.colorArr.length; i++) {\n            ((i) => {\n                const color = this.colorArr[i];\n\n                const colorButton = BB.el({\n                    parent: this.rootEl,\n                    content: color ? '' : 'X',\n                    className: 'kl-color-option',\n                    css: {\n                        width: buttonSize + 'px',\n                        height: buttonSize + 'px',\n                        backgroundColor: color ? BB.ColorConverter.toRgbaStr(color) : 'transparent',\n                        lineHeight: (buttonSize + 1) + 'px',\n                    },\n                    onClick: (e) => {\n                        if (this.selectedIndex === i) {\n                            if (color && color.a === 1) {\n                                this.colorInput.showPicker ? this.colorInput.showPicker() : this.colorInput.click();\n                            }\n                            return;\n                        }\n\n                        e.preventDefault();\n                        this.selectedIndex = i;\n                        update();\n                        p.onChange(this.colorArr[i]); // color may change\n                    },\n                });\n                if (color && color.a === 0) {\n                    colorButton.style.backgroundImage = 'url(' + checkerUrl + ')';\n                }\n\n                const setIsSelected = (b: boolean): void => {\n                    colorButton.classList.toggle('kl-color-option--active', b);\n                };\n\n                this.buttonArr.push({\n                    el: colorButton,\n                    setIsSelected,\n                });\n            })(i);\n        }\n\n        this.rootEl.append(c(',w-0,h-0,overflow-hidden', [this.colorInput]));\n\n\n        const update = () => {\n            for (let i = 0; i < this.buttonArr.length; i++) {\n                this.buttonArr[i].setIsSelected(i === this.selectedIndex);\n            }\n        };\n        update();\n\n        this.updateCheckerboard = (): void => {\n            const checkerUrl = BB.createCheckerDataUrl(5, undefined, theme.isDark());\n            this.buttonArr.forEach((button, i) => {\n                const color = this.colorArr[i];\n                if (color && color.a === 0) {\n                    button.el.style.backgroundImage = 'url(' + checkerUrl + ')';\n                }\n            });\n        };\n        theme.addIsDarkListener(this.updateCheckerboard);\n    }\n\n    // ---- interface ----\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValue (): IRGBA | null {\n        return this.colorArr[this.selectedIndex];\n    }\n\n    destroy (): void {\n        this.rootEl.remove();\n        this.buttonArr.forEach(item => {\n            BB.destroyEl(item.el);\n        });\n        this.buttonArr.splice(0, this.buttonArr.length);\n        theme.removeIsDarkListener(this.updateCheckerboard);\n        this.colorInput.onchange = null;\n        this.colorInput.oninput = null;\n    }\n\n}\n\n","import {BB} from '../../../bb/bb';\n\n/**\n * selectable options\n */\nexport class Options<IdType> {\n\n    private readonly rootEl: HTMLElement;\n    private selectedId: IdType;\n    private readonly optionArr: {\n        id: IdType;\n        el: HTMLElement;\n    }[];\n    private readonly onChange: ((id: IdType) => void) | undefined;\n\n    private getIndex (): number {\n        for (let i = 0; i < this.optionArr.length; i++) {\n            if (this.optionArr[i].id === this.selectedId) {\n                return i;\n            }\n        }\n        return -1;\n    }\n\n    private update (): void {\n        for (let i = 0; i < this.optionArr.length; i++) {\n            this.optionArr[i].el.classList.toggle(\n                'kl-option-selected',\n                this.optionArr[i].id === this.selectedId\n            );\n        }\n    }\n\n    // ---- public ----\n    constructor (\n        p: {\n            optionArr: {\n                id: IdType;\n                label: string | HTMLElement | SVGElement;\n                title?: string;\n            }[];\n            initId?: IdType;\n            onChange?: (id: IdType) => void;\n            changeOnInit?: boolean; // trigger change on creation\n            isSmall? :boolean;\n        }\n    ) {\n        this.rootEl = BB.el();\n\n        const wrapperEl = BB.el({\n            parent: this.rootEl,\n            className: 'kl-option-wrapper',\n            css: {\n                display: 'flex',\n            },\n        });\n\n        if (p.onChange) {\n            this.onChange = p.onChange;\n        }\n        this.optionArr = [];\n        this.selectedId = ('initialId' in p && p.initId !== undefined) ? p.initId : p.optionArr[0].id;\n\n        const createOption = (o: {\n            id: IdType;\n            label: string | HTMLElement | SVGElement;\n            title?: string;\n        }) => {\n\n            const classArr = ['kl-option'];\n            if (p.isSmall) {\n                classArr.push('kl-option--small');\n            }\n            if (typeof o.label !== 'string') {\n                classArr.push('kl-option--custom-el');\n                BB.css(o.label, {\n                    display: 'block',\n                    pointerEvents: 'none',\n                });\n            }\n\n            const optionObj = {\n                id: o.id,\n                el: BB.el({\n                    parent: wrapperEl,\n                    content: o.label,\n                    className: classArr.join(' '),\n                    onClick: () => {\n                        if (this.selectedId !== optionObj.id) {\n                            this.selectedId = optionObj.id;\n                            this.update();\n                            this.onChange && this.onChange(this.selectedId);\n                        }\n                    },\n                }),\n            };\n\n            if (o.title) {\n                optionObj.el.title = o.title;\n            }\n\n            this.optionArr.push(optionObj);\n        };\n\n        for (let i = 0; i < p.optionArr.length; i++) {\n            createOption(p.optionArr[i]);\n        }\n\n        this.update();\n\n        if (p.changeOnInit) {\n            setTimeout(() => {\n                this.onChange && this.onChange(this.selectedId);\n            }, 0);\n        }\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValue (): IdType {\n        return this.selectedId;\n    }\n\n    next (): void {\n        this.selectedId = this.optionArr[(this.getIndex() + 1) % this.optionArr.length].id;\n        this.update();\n        this.onChange && this.onChange(this.selectedId);\n    }\n\n    previous (): void {\n        this.selectedId = this.optionArr[(this.optionArr.length + this.getIndex() - 1) % this.optionArr.length].id;\n        this.update();\n        this.onChange && this.onChange(this.selectedId);\n    }\n\n    destroy (): void {\n        this.rootEl.remove();\n        this.optionArr.forEach(item => {\n            BB.destroyEl(item.el);\n        });\n        this.optionArr.splice(0, this.optionArr.length);\n    }\n}\n\n","import {BB} from '../../../bb/bb';\nimport angleSvg from '/src/app/img/ui/angle.svg';\n\n\ntype TUiState = 'left' | 'right';\n\n/**\n * display little messages at the top of KlWorkspace\n */\nexport class StatusOverlay {\n\n    private readonly el: HTMLDivElement;\n    private readonly innerEl: HTMLDivElement;\n    private readonly angleIm: HTMLImageElement;\n    private readonly innerInnerEl: HTMLDivElement;\n    private isWide: boolean = false; // tool space hidden\n    private uiState: TUiState = 'right';\n\n    private timeout: ReturnType<typeof setTimeout> | undefined;\n    private timeout2: ReturnType<typeof setTimeout> | undefined;\n    private timeout3: ReturnType<typeof setTimeout> | undefined;\n\n    private updateUiState () {\n        if (this.uiState === 'left') {\n            this.el.style.left = '271px';\n        } else {\n            this.el.style.removeProperty('left');\n        }\n    }\n\n\n    // --- public ---\n\n    constructor () {\n        this.el = BB.el({\n            className: 'top-overlay g-root',\n            onClick: BB.handleClick,\n        });\n\n        this.updateUiState();\n\n        this.innerEl = BB.el({\n            className: 'top-overlay--inner',\n        });\n\n\n        this.angleIm = new Image();\n        this.angleIm.src = angleSvg;\n        BB.css(this.angleIm, {\n            verticalAlign: 'bottom',\n            width: '20px',\n            height: '20px',\n            marginLeft: '5px',\n            borderRadius: '10px',\n        });\n\n        this.innerInnerEl = document.createElement('div');\n        this.innerInnerEl.style.display = 'inline-block';\n\n        this.innerEl.append(this.innerInnerEl, this.angleIm);\n        this.el.append(this.innerEl);\n        document.body.append(this.el);\n        this.el.style.display = 'none';\n    }\n\n    setWide (b: boolean) {\n        this.isWide = b;\n\n        if (!this.el) {\n            return;\n        }\n\n        if (this.isWide) {\n            this.el.style.width = '100%';\n            this.el.style.left = '';\n        } else {\n            this.el.style.removeProperty('width');\n            this.el.style.left = this.uiState === 'left' ? '271px' : '';\n        }\n    }\n\n    setUiState (state: TUiState) {\n        this.uiState = state;\n        this.updateUiState();\n    }\n\n    out (msg: string | {type: 'transform'; angleDeg: number; scale: number}, doPulse?: boolean) {\n\n        if (typeof msg === 'string') {\n            this.angleIm.style.display = 'none';\n            this.innerInnerEl.innerHTML = msg;\n        } else {\n            if (msg.type === 'transform') {\n                this.angleIm.style.display = 'inline-block';\n                this.angleIm.style.transform = 'rotate(' + msg.angleDeg + 'deg)';\n\n                if (msg.angleDeg % 90 === 0) {\n                    this.angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255, 255, 255, 0.7)';\n                } else {\n                    this.angleIm.style.boxShadow = '';\n                }\n\n                this.innerInnerEl.innerHTML = Math.round(msg.scale * 100) + '%';\n\n\n            } else {\n                this.angleIm.style.display = 'none';\n            }\n        }\n\n        if (doPulse) {\n            this.innerEl.style.animation = '';\n            setTimeout(\n                () => this.innerEl.style.animation = 'topOverlayPulse 0.5s ease-out',\n                20\n            );\n            clearTimeout(this.timeout3);\n            this.timeout3 = setTimeout(\n                () => this.innerEl.style.animation = '',\n                520\n            );\n        }\n\n\n\n        clearTimeout(this.timeout);\n        clearTimeout(this.timeout2);\n        this.el.style.animationName = doPulse ? 'consoleInFast' : 'consoleIn';\n        this.el.style.opacity = '1';\n        this.timeout = setTimeout(() => {\n            this.el.style.opacity = '0';\n            this.el.style.animationName = 'consoleOut';\n            this.timeout2 = setTimeout(() => {\n                this.el.style.display = 'none';\n            }, 450);\n        }, 1200);\n        this.el.style.display = 'flex';\n    }\n\n\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"angle.f0b557ac.svg\";","import {BB} from '../../../bb/bb';\nimport {KeyListener} from '../../../bb/input/key-listener';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\nimport {IRect, IVector2D} from '../../../bb/bb-types';\nimport {Preview, TPreviewMode} from '../project-viewport/preview';\nimport {applyToPoint, inverse} from 'transformation-matrix';\nimport {createTransformMatrix} from '../project-viewport/utils/create-transform-matrix';\nimport {clamp} from '../../../bb/math/math';\nimport {LANG} from '../../../language/language';\nimport editCropImg from '/src/app/img/ui/edit-crop.svg';\nimport {EventChain} from '../../../bb/input/event-chain/event-chain';\nimport {OnePointerLimiter} from '../../../bb/input/event-chain/one-pointer-limiter';\nimport {IChainElement} from '../../../bb/input/event-chain/event-chain.types';\n\n\n/**\n * element that lets you crop an image and copy it via right click\n */\nexport class CropCopy {\n\n    private readonly rootEl: HTMLElement;\n    private readonly eventTarget: HTMLElement;\n    private crop: IRect = {x: 0, y: 0, width: 0, height: 0}; // canvas coordinates\n    private readonly croppedCanvas: HTMLCanvasElement;\n    private readonly croppedImage: undefined | HTMLImageElement; // isn't canvas enough?\n    private readonly keyListener: KeyListener;\n    private readonly pointerListener: PointerListener;\n    private readonly canvas: HTMLImageElement | HTMLCanvasElement;\n    private readonly onChange: undefined | ((width: number, height: number) => void);\n    private readonly selectionRectEl: HTMLElement;\n    private readonly preview: Preview;\n    private mode: TPreviewMode = 'edit';\n\n\n    private resetCrop (): void {\n        this.crop = {\n            x: 0,\n            y: 0,\n            width: this.canvas.width,\n            height: this.canvas.height,\n        };\n    }\n\n    private getViewportSelectionRect (): IRect {\n        const transform = this.preview.getTransform();\n        const mat = createTransformMatrix(transform);\n        const p = applyToPoint(mat, this.crop);\n        return {\n            x: p.x,\n            y: p.y,\n            width: this.crop.width * transform.scale,\n            height: this.crop.height * transform.scale,\n        };\n    }\n\n    private updateCroppedCanvas (): void {\n        this.croppedCanvas.width = Math.round(this.crop.width);\n        this.croppedCanvas.height = Math.round(this.crop.height);\n        const ctx = BB.ctx(this.croppedCanvas);\n        ctx.drawImage(this.canvas, Math.round(-this.crop.x), Math.round(-this.crop.y));\n        if (this.croppedImage) {\n            this.croppedImage.src = this.croppedCanvas.toDataURL('image/png');\n        }\n        this.onChange && this.onChange(this.croppedCanvas.width, this.croppedCanvas.height);\n    }\n    private updateSelectionRect (): void {\n        const rect = this.getViewportSelectionRect();\n\n        BB.css(this.selectionRectEl, {\n            left: rect.x + 'px',\n            top: rect.y + 'px',\n            width: rect.width + 'px',\n            height: rect.height + 'px',\n            display: this.isReset() ? 'none' : '',\n        });\n        this.onChange && this.onChange(Math.round(this.crop.width), Math.round(this.crop.height));\n    }\n\n    // ---- public ----\n\n    constructor (\n        param: {\n            width: number;\n            height: number;\n            canvas: HTMLImageElement | HTMLCanvasElement;\n            isNotCopy: boolean;\n            onChange?: (width: number, height: number) => void;\n        }\n    ) {\n        this.rootEl = BB.el({\n            className: 'kl-edit-crop-preview',\n            css: {\n                position: 'relative',\n                height: param.height + 'px',\n                width: param.width + 'px',\n                overflow: 'hidden',\n            },\n        });\n        if (param.onChange) {\n            this.onChange = param.onChange;\n        }\n        this.canvas = param.canvas;\n\n        this.resetCrop();\n\n\n\n\n        const isInsideSelectionRect = (p: IVector2D): boolean => {\n            return BB.isInsideRect(p, this.getViewportSelectionRect());\n        };\n\n        this.croppedCanvas = BB.canvas();\n        this.eventTarget = this.croppedCanvas;\n        if (!param.isNotCopy) {\n            this.croppedImage = new Image();\n            this.eventTarget = this.croppedImage;\n        }\n        BB.css(this.eventTarget, {\n            height: param.height + 'px',\n            width: param.width + 'px',\n        });\n        this.rootEl.append(this.eventTarget);\n        this.updateCroppedCanvas();\n\n        this.preview = new Preview({\n            width: param.width,\n            height: param.height - 2, // subtract border\n            project: {\n                width: param.canvas.width,\n                height: param.canvas.height,\n                layers: [{\n                    image: param.canvas,\n                    opacity: 1,\n                    isVisible: true,\n                    mixModeStr: 'source-over',\n                    hasClipping: false,\n                }],\n            },\n            hasEditMode: true,\n            onModeChange: (mode) => {\n                this.mode = mode;\n                this.preview.getElement().style.pointerEvents = mode === 'edit' ? 'none' : '';\n                this.rootEl.title = mode === 'edit' ? LANG('crop-drag-to-crop') : '';\n            },\n            onTransformChange: () => this.updateSelectionRect(),\n            padding: 20,\n            hasBorder: false,\n            editIcon: editCropImg,\n        });\n        BB.css(this.preview.getElement(), {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            overflow: 'hidden',\n            pointerEvents: 'none',\n        });\n        this.preview.render();\n        this.rootEl.append(this.preview.getElement());\n\n        this.selectionRectEl = BB.el({\n            parent: this.preview.getElement(),\n            className: 'kl-edit-crop-preview__sel',\n        });\n        this.updateSelectionRect();\n\n        //gen crop from viewport points\n        const genCrop = (p1: IVector2D, p2: IVector2D): IRect => {\n            const mat = createTransformMatrix(this.preview.getTransform());\n            const inverseMat = inverse(mat);\n            const topLeftP = {\n                x: Math.min(p1.x, p2.x),\n                y: Math.min(p1.y, p2.y),\n            };\n            const bottomRightP = {\n                x: Math.max(p1.x, p2.x),\n                y: Math.max(p1.y, p2.y),\n            };\n            const origTopLeftP = applyToPoint(inverseMat, topLeftP);\n            const origBottomRightP = applyToPoint(inverseMat, bottomRightP);\n            origTopLeftP.x = clamp(Math.floor(origTopLeftP.x), 0, this.canvas.width);\n            origTopLeftP.y = clamp(Math.floor(origTopLeftP.y), 0, this.canvas.height);\n            origBottomRightP.x = clamp(Math.ceil(origBottomRightP.x), 0, this.canvas.width);\n            origBottomRightP.y = clamp(Math.ceil(origBottomRightP.y), 0, this.canvas.height);\n            return {\n                x: origTopLeftP.x,\n                y: origTopLeftP.y,\n                width: origBottomRightP.x - origTopLeftP.x,\n                height: origBottomRightP.y - origTopLeftP.y,\n            };\n        };\n\n\n\n        let startP: IVector2D | null;\n        let startCrop: IRect | null = null;\n        let isDragging = false;\n        let didMove = false;\n        let updateCropTimeout: ReturnType<typeof setTimeout>;\n        const pointerChain = new EventChain({\n            chainArr: [\n                new OnePointerLimiter() as IChainElement,\n            ],\n        });\n        pointerChain.setChainOut((event) => {\n            if (event.type === 'pointerdown' && event.button === 'left') {\n                event.eventPreventDefault();\n                isDragging = true;\n                startP = {\n                    x: event.relX,\n                    y: event.relY,\n                };\n                if (!this.isReset() && isInsideSelectionRect(startP)) {\n                    startCrop = {\n                        x: this.crop.x,\n                        y: this.crop.y,\n                        width: this.crop.width,\n                        height: this.crop.height,\n                    };\n                } else {\n                    this.crop = genCrop(startP, startP);\n                }\n            } else if (event.type === 'pointermove' && event.button === 'left') {\n                event.eventPreventDefault();\n                didMove = true;\n                if (startCrop) {\n                    const transform = this.preview.getTransform();\n                    this.crop.x = startCrop.x + Math.round((event.relX - startP!.x) / transform.scale);\n                    this.crop.y = startCrop.y + Math.round((event.relY - startP!.y) / transform.scale);\n                    this.crop.x = BB.clamp(this.crop.x, 0, this.canvas.width - this.crop.width);\n                    this.crop.y = BB.clamp(this.crop.y, 0, this.canvas.height - this.crop.height);\n                } else {\n                    this.crop = genCrop(startP!, {x: event.relX, y: event.relY});\n                }\n                this.updateSelectionRect();\n            } else if (event.type === 'pointerup' && startP) {\n                event.eventPreventDefault();\n                isDragging = false;\n                startCrop = null;\n                startP = null;\n                if (this.crop.width === 0 || this.crop.height === 0 || !didMove) {\n                    this.resetCrop();\n                    this.updateSelectionRect();\n                }\n                didMove = false;\n                updateCropTimeout = setTimeout(() => this.updateCroppedCanvas(), 1);\n            }\n        });\n        this.pointerListener = new BB.PointerListener({\n            target: this.eventTarget,\n            fixScribble: true,\n            onWheel: (event) => {\n                this.preview.onWheel(event);\n            },\n            onPointer: (event) => {\n                if (this.mode === 'hand') {\n                    event.eventPreventDefault();\n                    this.preview.onPointer(event);\n                    return;\n                }\n                pointerChain.chainIn(event);\n            },\n            maxPointers: 2,\n        });\n\n        this.keyListener = new BB.KeyListener({\n            onDown: (keyStr, e) => {\n                if (isDragging) {\n                    return;\n                }\n                let doUpdate = false;\n                const transform = this.preview.getTransform();\n\n                const stepSize = Math.max(1, 1 / transform.scale);\n                const shiftIsPressed = this.keyListener.isPressed('shift');\n\n                if (keyStr === 'left') {\n                    if (shiftIsPressed) {\n                        this.crop.width = BB.clamp(this.crop.width - stepSize, 1, this.canvas.width - this.crop.x);\n                    } else {\n                        this.crop.x = BB.clamp(this.crop.x - stepSize, 0, this.canvas.width - this.crop.width);\n                    }\n                    doUpdate = true;\n                }\n                if (keyStr === 'right') {\n                    if (shiftIsPressed) {\n                        this.crop.width = BB.clamp(this.crop.width + stepSize, 1, this.canvas.width - this.crop.x);\n                    } else {\n                        this.crop.x = BB.clamp(this.crop.x + stepSize, 0, this.canvas.width - this.crop.width);\n                    }\n                    doUpdate = true;\n                }\n                if (keyStr === 'up') {\n                    if (shiftIsPressed) {\n                        this.crop.height = BB.clamp(this.crop.height - stepSize, 1, this.canvas.height - this.crop.y);\n                    } else {\n                        this.crop.y = BB.clamp(this.crop.y - stepSize, 0, this.canvas.height - this.crop.height);\n                    }\n                    doUpdate = true;\n                }\n                if (keyStr === 'down') {\n                    if (shiftIsPressed) {\n                        this.crop.height = BB.clamp(this.crop.height + stepSize, 1, this.canvas.height - this.crop.y);\n                    } else {\n                        this.crop.y = BB.clamp(this.crop.y + stepSize, 0, this.canvas.height - this.crop.height);\n                    }\n                    doUpdate = true;\n                }\n\n                if (doUpdate) {\n                    e.preventDefault();\n                    this.updateSelectionRect();\n                    clearTimeout(updateCropTimeout);\n                    updateCropTimeout = setTimeout(() => this.updateCroppedCanvas(), 100);\n                }\n            },\n        });\n    }\n\n    // ---- interface ----\n\n    getEl (): HTMLElement {\n        return this.rootEl;\n    }\n    reset (): void {\n        this.resetCrop();\n        this.updateCroppedCanvas();\n        this.updateSelectionRect();\n    }\n    destroy (): void {\n        this.rootEl.remove();\n        this.eventTarget.style.removeProperty('width');\n        this.eventTarget.style.removeProperty('height');\n        this.keyListener.destroy();\n        this.pointerListener.destroy();\n        this.preview.destroy();\n    }\n    isReset (): boolean {\n        return this.crop.x === 0 && this.crop.y === 0 && this.crop.width === this.canvas.width && this.crop.height === this.canvas.height;\n    }\n    getRect (): IRect {\n        return BB.copyObj(this.crop);\n    }\n    getCroppedCanvas (): HTMLCanvasElement {\n        return this.croppedCanvas;\n    }\n}\n\n","import {c} from '../../../bb/base/c';\nimport {ProjectViewport, TProjectViewportProject, TViewportTransform} from './project-viewport';\nimport {BB} from '../../../bb/bb';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\nimport toolZoomInImg from '/src/app/img/ui/tool-zoom-in.svg';\nimport toolZoomOutImg from '/src/app/img/ui/tool-zoom-out.svg';\nimport viewportResetImg from '/src/app/img/ui/viewport-reset.svg';\nimport toolHandImg from '/src/app/img/ui/tool-hand.svg';\nimport editPencilImg from '/src/app/img/ui/edit-pencil.svg';\nimport {EventChain} from '../../../bb/input/event-chain/event-chain';\nimport {DoubleTapper} from '../../../bb/input/event-chain/double-tapper';\nimport {IChainElement} from '../../../bb/input/event-chain/event-chain.types';\nimport {css} from '@emotion/css';\nimport {createTransformMatrix} from './utils/create-transform-matrix';\nimport {zoomByStep} from './utils/zoom-by-step';\nimport {PinchZoomer} from '../../../bb/input/event-chain/pinch-zoomer';\nimport {LANG} from '../../../language/language';\nimport {inverse, applyToPoint} from 'transformation-matrix';\nimport {createTransform} from './utils/create-transform';\nimport {toMetaTransform} from './utils/to-meta-transform';\nimport {Options} from '../components/options';\nimport {IPointerEvent, IWheelEvent} from '../../../bb/input/event.types';\n\n\nexport type TPreviewMode = 'edit' | 'hand';\n\nexport type TPreviewParams = {\n    width: number;\n    height: number;\n    project: TProjectViewportProject;\n    onTransformChange?: (transform: TViewportTransform) => void;\n    hasEditMode?: boolean; // default false\n    onModeChange?: (mode: TPreviewMode) => void;\n    padding?: number; //default -> DEFAULT_PADDING\n    hasBorder?: boolean; // default true\n    editIcon?: string;\n};\n\nconst DEFAULT_PADDING = 10;\n\nexport class Preview {\n    private readonly rootEl: HTMLElement;\n    private readonly project: TProjectViewportProject;\n    private viewport: ProjectViewport;\n    private readonly width: number;\n    private readonly height: number;\n    private isReset: boolean = true;\n    private readonly viewportPointerListener: PointerListener;\n    private doRender = false;\n    private readonly padding: number;\n    private animationFrameId: ReturnType<typeof requestAnimationFrame> | undefined;\n    private onTransformChange: TPreviewParams['onTransformChange'] | undefined;\n    private lastEmittedTransform: TViewportTransform = {x: 0, y: 0, scale: 0, angleDeg: 0};\n    private modeToggle: Options<TPreviewMode> | undefined;\n    private readonly pointerChain: EventChain;\n\n\n\n    private renderLoop = (): void => {\n        this.animationFrameId = requestAnimationFrame(this.renderLoop);\n\n        if (this.doRender) {\n            this.doRender = false;\n            this.viewport.render();\n            const viewportTransform = this.viewport.getTransform();\n            if (\n                this.onTransformChange &&\n                JSON.stringify(this.lastEmittedTransform) !== JSON.stringify(viewportTransform)\n            ) {\n                this.onTransformChange(viewportTransform);\n                this.lastEmittedTransform = viewportTransform;\n            }\n        }\n    };\n\n    private requestRerender (): void {\n        this.doRender = true;\n    }\n\n    private resetOrZoom (x: number, y: number): void {\n        if (this.isReset) {\n            this.isReset = false;\n\n            const canvasP = applyToPoint(inverse(createTransformMatrix(this.viewport.getTransform())), {x, y});\n\n            this.viewport.setTransform(createTransform(\n                {x: this.width / 2, y: this.height / 2},\n                canvasP,\n                1,\n                0,\n            ));\n            this.requestRerender();\n        } else {\n            this.reset();\n        }\n    }\n\n    private reset (): void {\n        const fit = BB.fitInto(\n            this.project.width, this.project.height,\n            this.width - this.padding * 2,\n            this.height - this.padding * 2,\n        );\n        const scale = fit.width / this.project.width;\n        this.viewport.setTransform(createTransform(\n            {x: this.width / 2, y: this.height / 2},\n            {x: this.project.width / 2, y: this.project.height / 2},\n            scale,\n            0\n        ));\n        this.isReset = true;\n        this.requestRerender();\n    }\n\n    private transformCanvas (\n        t: {\n            type: 'translate';\n            x: number;\n            y: number;\n        } | {\n            type: 'rotate';\n            cX: number;\n            cY: number;\n            angleDeg: number;\n        } | {\n            type: 'zoom';\n            vX?: number;\n            vY?: number;\n            fac: number;\n        }\n    ): void {\n        if (t.type === 'translate') {\n            const old = this.viewport.getTransform();\n            if (t.x === 0 && t.y === 0) {\n                return;\n            }\n            this.viewport.setTransform({\n                ...old,\n                x: old.x + t.x,\n                y: old.y + t.y,\n            });\n        } else if (t.type === 'zoom') {\n            const old = this.viewport.getTransform();\n            const viewportRect = this.viewport.getElement().getBoundingClientRect();\n            t.vX = t.vX ?? viewportRect.width / 2;\n            t.vY = t.vY ?? viewportRect.height / 2;\n\n            const metaTransform = toMetaTransform(\n                old,\n                    {x: t.vX, y: t.vY},\n            );\n            metaTransform.scale *= t.fac;\n\n            this.viewport.setTransform(createTransform(\n                metaTransform.viewportP,\n                metaTransform.canvasP,\n                metaTransform.scale,\n                metaTransform.angleDeg,\n            ));\n        }\n        this.isReset = false;\n\n        this.requestRerender();\n    }\n\n    // ---- public ----\n    constructor (p: TPreviewParams) {\n        this.width = p.width;\n        this.height = p.height;\n        this.project = p.project;\n        this.onTransformChange = p.onTransformChange;\n        this.padding = p.padding ?? DEFAULT_PADDING;\n\n        const fit = BB.fitInto(\n            this.project.width, this.project.height,\n            this.width - this.padding * 2,\n            this.height - this.padding * 2,\n        );\n        const scale = fit.width / this.project.width;\n\n        this.viewport = new ProjectViewport({\n            width: this.width,\n            height: this.height,\n            transform: createTransform(\n                {x: this.width / 2, y: this.height / 2},\n                {x: this.project.width / 2, y: this.project.height / 2},\n                scale,\n                0\n            ),\n            project: this.project,\n            useNativeResolution: false,\n            drawBackground: true,\n        });\n\n        const doubleTapper = new DoubleTapper({\n            onDoubleTap: (e) => {\n                const m = createTransformMatrix(this.viewport.getTransform());\n                const tl = applyToPoint(m, {x: 0, y: 0});\n                const br = applyToPoint(m, {x: this.project.width, y: this.project.height});\n                const isInside = BB.isInsideRect(\n                    {x: e.relX, y: e.relY},\n                    {\n                        x: tl.x,\n                        y: tl.y,\n                        width: br.x - tl.x,\n                        height: br.y - tl.y,\n                    },\n                );\n\n                if (!this.isReset || isInside) {\n                    this.resetOrZoom(e.relX, e.relY);\n                }\n            },\n            isInstant: true,\n        });\n        let oldTransform: TViewportTransform | undefined = undefined;\n        const pinchZoomer = new PinchZoomer({\n            onPinch: (e) => {\n                if (e.type === 'move') {\n                    if (!oldTransform) {\n                        oldTransform = this.viewport.getTransform();\n                    }\n                    const metaTransform = toMetaTransform(oldTransform, {x: e.downRelX, y: e.downRelY});\n                    metaTransform.scale *= e.scale;\n                    metaTransform.viewportP.x += e.relX - e.downRelX;\n                    metaTransform.viewportP.y += e.relY - e.downRelY;\n                    this.viewport.setTransform(createTransform(\n                        metaTransform.viewportP,\n                        metaTransform.canvasP,\n                        metaTransform.scale,\n                        metaTransform.angleDeg,\n                    ));\n                    this.requestRerender();\n                    this.isReset = false;\n\n                }  else if (e.type === 'end') {\n                    oldTransform = undefined;\n                }\n            },\n        });\n\n\n        this.pointerChain = new EventChain({\n           chainArr: [\n               pinchZoomer as IChainElement,\n               doubleTapper as IChainElement,\n           ],\n        });\n        this.pointerChain.setChainOut((e) => {\n            if (e.button && ['left', 'middle'].includes(e.button)) {\n                // debugOut(JSON.stringify(e));\n                this.transformCanvas({\n                    type: 'translate',\n                    x: e.dX,\n                    y: e.dY,\n                });\n            }\n        });\n\n        this.viewport.getElement().classList.add(css({\n            cursor: 'grab',\n            ':active': {\n                cursor: 'grabbing',\n            },\n        }));\n        BB.css(this.viewport.getElement(), {\n            userSelect: 'none',\n            touchAction: 'none',\n        });\n        this.viewport.getElement().addEventListener( 'touchend', (e) => {\n            e.preventDefault();\n            return false;\n        });\n        this.viewport.getElement().addEventListener('contextmenu', (e) => {\n            e.preventDefault();\n            return false;\n        });\n        this.viewport.getElement().addEventListener('dragstart', (e) => {\n            e.preventDefault();\n            return false;\n        });\n\n        this.viewportPointerListener = new PointerListener({\n            target: this.viewport.getElement(),\n            onPointer: (e) => {\n                this.pointerChain.chainIn(e);\n            },\n            onWheel: this.onWheel,\n            maxPointers: 2,\n        });\n        this.viewport.getElement().addEventListener('wheel', (e) => {\n            e.preventDefault();\n        });\n\n        if (p.hasEditMode) {\n            this.modeToggle = new Options<TPreviewMode>({\n                optionArr: (['edit', 'hand'] as const).map(id => {\n                    const el = BB.el({\n                        className: 'dark-invert',\n                        css: {\n                            width: '28px',\n                            height: '28px',\n                            backgroundSize: 'contain',\n                            margin: '5px',\n                            backgroundImage: `url(${id === 'edit' ? p.editIcon ?? editPencilImg : toolHandImg})`,\n                            backgroundPosition: 'center',\n                            backgroundRepeat: 'no-repeat',\n                        },\n                    });\n\n                    return {\n                        id,\n                        label: el,\n                        title: id === 'edit' ? LANG('tab-edit') : LANG('tool-hand'),\n                    };\n                }),\n                initId: 'edit',\n                onChange: (val) => {\n                    p.onModeChange && p.onModeChange(val);\n                },\n            });\n        }\n\n        const elCss = css(p.hasBorder === false ? {} : {\n            borderTop: '1px solid #7f7f7f',\n            borderBottom: '1px solid #7f7f7f',\n            '.kl-theme-dark &': {\n                borderTop: '1px solid #636363',\n                borderBottom: '1px solid #636363',\n            },\n        });\n        // pointer-events: auto - So the canvas can be ignored, while the buttons still work.\n        this.rootEl = c(\n            {\n                className: elCss,\n                css: {\n                    position: 'relative',\n                },\n            },\n            [\n                this.viewport.getElement(),\n                ...(this.modeToggle ? [\n                    c(',pos-absolute,left-5,top-5,z-1,pointer-auto', [\n                        this.modeToggle.getElement(),\n                    ]),\n                ] : []),\n                c(',pos-absolute,right-5,bottom-5,flex,flexCol,gap-5,z-1,pointer-auto', [\n                    c({\n                        tagName: 'button',\n                        title: LANG('hand-reset'),\n                        onClick: () => {\n                            this.reset();\n                        },\n                        content: `<img alt=\"reset\" height=\"20\" src=\"${viewportResetImg}\">`,\n                        noRef: true,\n                    }),\n                    c({\n                        tagName: 'button',\n                        title: LANG('zoom-in'),\n                        onClick: () => {\n                            const oldScale = this.viewport.getTransform().scale;\n                            const newScale = zoomByStep(oldScale, 1);\n                            this.transformCanvas({\n                                type: 'zoom',\n                                fac: newScale / oldScale,\n                            });\n                        },\n                        content: `<img alt=\"zoom-in\" height=\"20\" src=\"${toolZoomInImg}\">`,\n                        noRef: true,\n                    }),\n                    c({\n                        tagName: 'button',\n                        title: LANG('zoom-out'),\n                        onClick: () => {\n                            const oldScale = this.viewport.getTransform().scale;\n                            const newScale = zoomByStep(oldScale, -1);\n                            this.transformCanvas({\n                                type: 'zoom',\n                                fac: newScale / oldScale,\n                            });\n                        },\n                        content: `<img alt=\"zoom-out\" height=\"20\" src=\"${toolZoomOutImg}\">`,\n                        noRef: true,\n                    }),\n                ]),\n            ],\n        );\n        this.renderLoop();\n    }\n\n    render (): void {\n        this.requestRerender();\n    }\n\n    setTransform (transform: TViewportTransform): void {\n        this.viewport.setTransform(transform);\n        this.requestRerender();\n        this.isReset = false;\n    }\n\n    getTransform (): TViewportTransform {\n        return this.viewport.getTransform();\n    }\n\n    onPointer (event: IPointerEvent): void {\n        this.pointerChain.chainIn(event);\n    }\n\n    onWheel = (e: IWheelEvent): void => {\n        const viewportRect = this.viewport.getElement().getBoundingClientRect();\n        const vX = e.pageX - viewportRect.x;\n        const vY = e.pageY - viewportRect.y;\n\n        const oldScale = this.viewport.getTransform().scale;\n        const newScale = zoomByStep(oldScale, -e.deltaY / 2);\n\n        this.transformCanvas({\n            type: 'zoom',\n            vX,\n            vY,\n            fac: newScale / oldScale,\n        });\n    };\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    destroy (): void {\n        this.animationFrameId !== undefined && cancelAnimationFrame(this.animationFrameId);\n        this.viewport.destroy();\n        this.viewportPointerListener.destroy();\n        this.rootEl.remove();\n        this.modeToggle && this.modeToggle.destroy();\n    }\n}","import {TMixMode} from '../../kl-types';\nimport {BB} from '../../../bb/bb';\nimport {throwIfNull} from '../../../bb/base/base';\nimport {theme} from '../../../theme/theme';\nimport {Matrix, inverse, compose} from 'transformation-matrix';\nimport {createTransformMatrix} from './utils/create-transform-matrix';\n\nfunction fixScale (scale: number, pixels: number): number {\n    return Math.round(pixels * scale) / pixels;\n}\n\n// width, height - viewport size\nexport type TProjectViewportLayerFunc = (\n    viewportTransform: TViewportTransformXY,\n    viewportWidth: number,\n    viewportHeight: number\n) => (\n        CanvasImageSource |\n        {image: CanvasImageSource; transform: Matrix} // image drawn with ctx.setTransform(transform)\n    );\n\nexport type TProjectViewportProject = {\n    width: number;\n    height: number;\n    layers: {\n        image: CanvasImageSource | TProjectViewportLayerFunc;\n        isVisible: boolean;\n        opacity: number;\n        mixModeStr: TMixMode;\n        hasClipping: boolean;\n    }[];\n};\n\nexport type TViewportTransform = {\n    scale: number;\n    angleDeg: number;\n    x: number;\n    y: number;\n};\n\nexport type TViewportTransformXY = {\n    scaleX: number;\n    scaleY: number;\n    angleDeg: number;\n    x: number;\n    y: number;\n};\n\nexport type TProjectViewportParams = {\n    width: number;\n    height: number;\n    project: TProjectViewportProject;\n    transform: TViewportTransform;\n    drawBackground?: boolean;\n    useNativeResolution?: boolean;\n    renderAfter?: (ctx: CanvasRenderingContext2D) => void;\n    fillParent?: boolean;\n};\n\n/**\n *\n * Scale - size of one project-canvas pixel compared to CSS pixel\n *      -> 1 means 1 pixel in the drawing is the size of a CSS pixel\n *      -> independent of device pixel ratio, or what resolution the viewport\n *          canvas may actually have.\n * Translate - translates in CSS pixels\n * Viewport origin is top left (same as canvas)\n *\n * Order of transformations (matrix multiplication is reversed): translate, rotate, scale\n */\nexport class ProjectViewport {\n    private width: number;\n    private height: number;\n    private readonly canvas: HTMLCanvasElement;\n    private readonly ctx: CanvasRenderingContext2D;\n    private transform: TViewportTransform;\n\n    private project: TProjectViewportProject;\n    private useNativeResolution: boolean;\n\n    private pattern: CanvasPattern;\n    private resFactor: number;\n    private readonly drawBackground: boolean;\n    private doResize: boolean = true;\n    private readonly doFillParent: boolean;\n\n    private onIsDark = (): void => {\n        this.pattern = throwIfNull(this.ctx.createPattern(BB.createCheckerCanvas(10, theme.isDark()), 'repeat'));\n        this.render();\n    };\n\n    private oldDPR = devicePixelRatio;\n    private resizeListener = () => {\n        if (devicePixelRatio !== this.oldDPR) {\n            this.canvas.style.imageRendering = Math.round(devicePixelRatio) !== devicePixelRatio ? '' : 'pixelated';\n            this.oldDPR = devicePixelRatio;\n        }\n    };\n\n    // ---- public ----\n    constructor (p: TProjectViewportParams) {\n        this.width = p.width;\n        this.height = p.height;\n        this.project = p.project;\n        this.useNativeResolution = !!p.useNativeResolution;\n        this.drawBackground = !!p.drawBackground;\n        this.doFillParent = !!p.fillParent;\n\n        this.transform = {\n            ...p.transform,\n        };\n\n\n        this.resFactor = this.useNativeResolution ? devicePixelRatio : 1;\n        this.canvas = BB.canvas(\n            this.width * this.resFactor,\n            this.height * this.resFactor,\n        );\n        this.ctx = BB.ctx(this.canvas);\n        BB.css(this.canvas, {\n            width: this.doFillParent ? '100%' : (this.width + 'px'),\n            height: this.doFillParent ? '100%' : (this.height + 'px'),\n            imageRendering: Math.round(devicePixelRatio) !== devicePixelRatio ? undefined : 'pixelated',\n            display: 'block',\n        });\n        window.addEventListener('resize', this.resizeListener);\n\n        this.pattern = throwIfNull(this.ctx.createPattern(BB.createCheckerCanvas(10, theme.isDark()), 'repeat'));\n        theme.addIsDarkListener(this.onIsDark);\n\n        // this.render();\n    }\n\n    render (): void {\n        const isDark = theme.isDark();\n        const transform = {\n            ...this.transform,\n            x: this.transform.x,\n            y: this.transform.y,\n            scale: this.transform.scale,\n        };\n\n        if (this.doResize) {\n            this.doResize = false;\n            this.resFactor = this.useNativeResolution ? devicePixelRatio : 1;\n            this.canvas.width = Math.round(this.width * this.resFactor);\n            this.canvas.height = Math.round(this.height * this.resFactor);\n        }\n\n        const renderedTransform: TViewportTransformXY = {\n            x: Math.round(transform.x),\n            y: Math.round(transform.y),\n            scaleX: fixScale(transform.scale, this.project.width),\n            scaleY: fixScale(transform.scale, this.project.height),\n            angleDeg: transform.angleDeg,\n        };\n        const renderedMat = createTransformMatrix(renderedTransform);\n\n\n\n        this.ctx.save();\n        this.ctx.imageSmoothingEnabled = false;\n\n        if (this.drawBackground) {\n            this.ctx.fillStyle = isDark ? 'rgb(33, 33, 33)' : 'rgb(158,158,158)';\n            this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n        } else {\n            this.ctx.fillStyle = this.pattern;\n            this.ctx.fillRect(0, 0, this.width, this.height);\n        }\n\n        // this.ctx.scale(this.resFactor, this.resFactor);\n        this.ctx.translate(renderedTransform.x, renderedTransform.y);\n        this.ctx.scale(renderedTransform.scaleX, renderedTransform.scaleY);\n        this.ctx.rotate(renderedTransform.angleDeg / 180 * Math.PI);\n\n\n        if (this.drawBackground) {\n            this.ctx.save();\n\n            this.ctx.fillStyle = theme.isDark() ? 'rgba(255,255,255,0.25)' : 'rgba(0,0,0,0.2)';\n            const scaledPixelX = 1 / renderedTransform.scaleX;\n            const scaledPixelY = 1 / renderedTransform.scaleY;\n            this.ctx.fillRect(-scaledPixelX, -scaledPixelY, this.project.width + scaledPixelX * 2, this.project.height + scaledPixelY * 2);\n\n            this.ctx.fillStyle = this.pattern;\n            this.pattern.setTransform(inverse(renderedMat));\n            this.ctx.fillRect(0, 0, this.project.width, this.project.height);\n\n            this.ctx.restore();\n        }\n\n        this.project.layers.forEach(layer => {\n            if (!layer.isVisible || !layer.opacity) {\n                return;\n            }\n            this.ctx.save();\n            this.ctx.globalCompositeOperation = layer.mixModeStr;\n            this.ctx.globalAlpha = layer.opacity;\n\n            let image: CanvasImageSource = {} as CanvasImageSource;\n            if (typeof layer.image === 'function') {\n                const res = layer.image(renderedTransform, this.canvas.width, this.canvas.height);\n                if ('image' in res && 'transform' in res) {\n                    image = res.image;\n                    this.ctx.setTransform(compose(renderedMat, res.transform));\n                } else {\n                    image = res;\n                }\n            } else {\n                image = layer.image;\n            }\n            this.ctx.drawImage(image, 0, 0); // , this.project.width, this.project.height);\n            this.ctx.restore();\n        });\n\n        this.ctx.restore();\n    }\n\n    setSize (width: number, height: number): void {\n        this.doResize = true;\n        this.width = width;\n        this.height = height;\n\n        BB.css(this.canvas, {\n            width: this.doFillParent ? '100%' : (this.width + 'px'),\n            height: this.doFillParent ? '100%' : (this.height + 'px'),\n        });\n    }\n\n    setTransform (transform: TViewportTransform): void {\n        this.transform = { ...transform };\n    }\n\n    getTransform (): TViewportTransform {\n        return { ...this.transform };\n    }\n\n    setUseNativeResolution (b: boolean): void {\n        this.useNativeResolution = b;\n        this.doResize = true;\n    }\n\n    getUseNativeResolution (): boolean {\n        return this.useNativeResolution;\n    }\n\n    getElement (): HTMLElement {\n        return this.canvas;\n    }\n\n    destroy (): void {\n        BB.freeCanvas(this.canvas);\n        theme.removeIsDarkListener(this.onIsDark);\n        window.removeEventListener('resize', this.resizeListener);\n    }\n}","export * from './applyToPoint'\nexport * from './fromObject'\nexport * from './fromString'\nexport * from './identity'\nexport * from './inverse'\nexport * from './isAffineMatrix'\nexport * from './rotate'\nexport * from './scale'\nexport * from './shear'\nexport * from './skew'\nexport * from './toString'\nexport * from './transform'\nexport * from './translate'\nexport * from './fromTriangles'\nexport * from './smoothMatrix'\nexport * from './fromDefinition'\nexport * from './fromTransformAttribute'\nexport * from './decompose'\nexport * from './flip'\nexport * from './fromMovingPoints'\n","/**\n * Calculate a point transformed with an affine matrix\n * @param matrix {Matrix} Affine Matrix\n * @param  point {Point} Point\n * @returns {Point} Point\n */\nexport function applyToPoint (matrix, point) {\n  return Array.isArray(point)\n    ? [\n        matrix.a * point[0] + matrix.c * point[1] + matrix.e,\n        matrix.b * point[0] + matrix.d * point[1] + matrix.f\n      ]\n    : {\n        x: matrix.a * point.x + matrix.c * point.y + matrix.e,\n        y: matrix.b * point.x + matrix.d * point.y + matrix.f\n      }\n}\n\n/**\n * Calculate an array of points transformed with an affine matrix\n * @param matrix {Matrix} Affine Matrix\n * @param points {Point[]} Array of point\n * @returns {Point[]} Array of point\n */\nexport function applyToPoints (matrix, points) {\n  return points.map(point => applyToPoint(matrix, point))\n}\n","/**\n * Extract an affine matrix from an object that contains a,b,c,d,e,f keys\n * Any value could be a float or a string that contains a float\n * @param object {Object} Object that contains a,b,c,d,e,f keys\n * @return {Matrix} Affine Matrix\n */\nexport function fromObject (object) {\n  return {\n    a: parseFloat(object.a),\n    b: parseFloat(object.b),\n    c: parseFloat(object.c),\n    d: parseFloat(object.d),\n    e: parseFloat(object.e),\n    f: parseFloat(object.f)\n  }\n}\n","/**\n * @ignore\n * @type {RegExp}\n */\nconst matrixRegex = /^matrix\\(\\s*([0-9_+-.e]+)\\s*,\\s*([0-9_+-.e]+)\\s*,\\s*([0-9_+-.e]+)\\s*,\\s*([0-9_+-.e]+)\\s*,\\s*([0-9_+-.e]+)\\s*,\\s*([0-9_+-.e]+)\\s*\\)$/i\n\n/**\n * Parse a string formatted as matrix(a,b,c,d,e,f)\n * @param string {string} String with an affine matrix\n * @returns {Matrix} Affine Matrix\n *\n * @example\n * > fromString('matrix(1,2,3,4,5,6)')\n * {a: 1, b: 2, c: 3, d: 4, c: 5, e: 6}\n */\nexport function fromString (string) {\n  const parsed = string.match(matrixRegex)\n  if (parsed === null || parsed.length < 7) throw new Error(`'${string}' is not a matrix`)\n  return {\n    a: parseFloat(parsed[1]),\n    b: parseFloat(parsed[2]),\n    c: parseFloat(parsed[3]),\n    d: parseFloat(parsed[4]),\n    e: parseFloat(parsed[5]),\n    f: parseFloat(parsed[6])\n  }\n}\n","/**\n * Identity matrix\n * @returns {Matrix} Affine Matrix\n */\nexport function identity () {\n  return {\n    a: 1,\n    c: 0,\n    e: 0,\n    b: 0,\n    d: 1,\n    f: 0\n  }\n}\n","/**\n * Calculate a matrix that is the inverse of the provided matrix\n * @param matrix {Matrix} Affine Matrix\n * @returns {Matrix} Inverted Affine Matrix\n */\nexport function inverse (matrix) {\n  // http://www.wolframalpha.com/input/?i=Inverse+%5B%7B%7Ba,c,e%7D,%7Bb,d,f%7D,%7B0,0,1%7D%7D%5D\n\n  const { a, b, c, d, e, f } = matrix\n\n  const denom = a * d - b * c\n\n  return {\n    a: d / denom,\n    b: b / -denom,\n    c: c / -denom,\n    d: a / denom,\n    e: (d * e - c * f) / -denom,\n    f: (b * e - a * f) / denom\n  }\n}\n","import { isNumeric, isObject } from './utils'\n\n/**\n * Check if the object contain an affine matrix\n * @param object {Object} Generic Plain Object\n * @return {boolean} True if is an object and contains an affine matrix\n */\n\nexport function isAffineMatrix (object) {\n  return isObject(object) &&\n    'a' in object &&\n    isNumeric(object.a) &&\n    'b' in object &&\n    isNumeric(object.b) &&\n    'c' in object &&\n    isNumeric(object.c) &&\n    'd' in object &&\n    isNumeric(object.d) &&\n    'e' in object &&\n    isNumeric(object.e) &&\n    'f' in object &&\n    isNumeric(object.f)\n}\n","export function isUndefined (val) {\n  return typeof val === 'undefined'\n}\n\nexport function isNumeric (n) {\n  return typeof n === 'number' &&\n    !Number.isNaN(n) &&\n    Number.isFinite(n)\n}\n\nexport function isObject (obj) {\n  return typeof obj === 'object' &&\n    obj !== null &&\n    !Array.isArray(obj)\n}\n\nexport function matchesShape (obj, keys) {\n  return keys.every(key => key in obj)\n}\n","import { isUndefined } from './utils'\nimport { translate } from './translate'\nimport { transform } from './transform'\n\nconst { cos, sin, PI } = Math\n/**\n * Calculate a rotation matrix\n * @param angle {number} Angle in radians\n * @param [cx] {number} If (cx,cy) are supplied the rotate is about this point\n * @param [cy] {number} If (cx,cy) are supplied the rotate is about this point\n * @returns {Matrix} Affine Matrix\n */\nexport function rotate (angle, cx, cy) {\n  const cosAngle = cos(angle)\n  const sinAngle = sin(angle)\n  const rotationMatrix = {\n    a: cosAngle,\n    c: -sinAngle,\n    e: 0,\n    b: sinAngle,\n    d: cosAngle,\n    f: 0\n  }\n  if (isUndefined(cx) || isUndefined(cy)) {\n    return rotationMatrix\n  }\n\n  return transform([\n    translate(cx, cy),\n    rotationMatrix,\n    translate(-cx, -cy)\n  ])\n}\n\n/**\n * Calculate a rotation matrix with a DEG angle\n * @param angle {number} Angle in degree\n * @param [cx] {number} If (cx,cy) are supplied the rotate is about this point\n * @param [cy] {number} If (cx,cy) are supplied the rotate is about this point\n * @returns {Matrix} Affine Matrix\n */\nexport function rotateDEG (angle, cx = undefined, cy = undefined) {\n  return rotate(angle * PI / 180, cx, cy)\n}\n","/**\n * Calculate a translate matrix\n * @param tx {number} Translation on axis x\n * @param [ty = 0] {number} Translation on axis y\n * @returns {Matrix} Affine Matrix\n */\nexport function translate (tx, ty = 0) {\n  return {\n    a: 1,\n    c: 0,\n    e: tx,\n    b: 0,\n    d: 1,\n    f: ty\n  }\n}\n","/**\n * Merge multiple matrices into one\n * @param matrices {...Matrix | Matrix[]} Matrices listed as separate parameters or in an array\n * @returns {Matrix} Affine Matrix\n */\nexport function transform (...matrices) {\n  matrices = Array.isArray(matrices[0]) ? matrices[0] : matrices\n\n  const multiply = (m1, m2) => {\n    return {\n      a: m1.a * m2.a + m1.c * m2.b,\n      c: m1.a * m2.c + m1.c * m2.d,\n      e: m1.a * m2.e + m1.c * m2.f + m1.e,\n      b: m1.b * m2.a + m1.d * m2.b,\n      d: m1.b * m2.c + m1.d * m2.d,\n      f: m1.b * m2.e + m1.d * m2.f + m1.f\n    }\n  }\n\n  switch (matrices.length) {\n    case 0:\n      throw new Error('no matrices provided')\n\n    case 1:\n      return matrices[0]\n\n    case 2:\n      return multiply(matrices[0], matrices[1])\n\n    default: {\n      const [m1, m2, ...rest] = matrices\n      const m = multiply(m1, m2)\n      return transform(m, ...rest)\n    }\n  }\n}\n\n/**\n * Merge multiple matrices into one\n * @param matrices {...Matrix | Matrix[]} Matrices listed as separate parameters or in an array\n * @returns {Matrix} Affine Matrix\n */\nexport function compose (...matrices) {\n  return transform(...matrices)\n}\n","import { isUndefined } from './utils'\nimport { translate } from './translate'\nimport { transform } from './transform'\n\n/**\n * Calculate a scaling matrix\n * @param sx {number} Scaling on axis x\n * @param [sy = sx] {number} Scaling on axis y (default sx)\n * @param [cx] {number} If (cx,cy) are supplied the scaling is about this point\n * @param [cy] {number} If (cx,cy) are supplied the scaling is about this point\n * @returns {Matrix} Affine Matrix\n */\nexport function scale (sx, sy = undefined, cx = undefined, cy = undefined) {\n  if (isUndefined(sy)) sy = sx\n\n  const scaleMatrix = {\n    a: sx,\n    c: 0,\n    e: 0,\n    b: 0,\n    d: sy,\n    f: 0\n  }\n\n  if (isUndefined(cx) || isUndefined(cy)) {\n    return scaleMatrix\n  }\n\n  return transform([\n    translate(cx, cy),\n    scaleMatrix,\n    translate(-cx, -cy)\n  ])\n}\n","/**\n * Calculate a shear matrix\n * @param shx {number} Shear on axis x\n * @param shy {number} Shear on axis y\n * @returns {Matrix} Affine Matrix\n */\nexport function shear (shx, shy) {\n  return {\n    a: 1,\n    c: shx,\n    e: 0,\n    b: shy,\n    d: 1,\n    f: 0\n  }\n}\n","// https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function/skew\nconst { tan } = Math\n\n/**\n * Calculate a skew matrix\n * @param ax {number} Skew on axis x\n * @param ay {number} Skew on axis y\n * @returns {Matrix} Affine Matrix\n */\nexport function skew (ax, ay) {\n  return {\n    a: 1,\n    c: tan(ax),\n    e: 0,\n    b: tan(ay),\n    d: 1,\n    f: 0\n  }\n}\n\n/**\n * Calculate a skew matrix using DEG angles\n * @param ax {number} Skew on axis x\n * @param ay {number} Skew on axis y\n * @returns {Matrix} Affine Matrix\n */\nexport function skewDEG (ax, ay) {\n  return skew(ax * Math.PI / 180, ay * Math.PI / 180)\n}\n","/**\n * Serialize an affine matrix to a string that can be used with CSS or SVG\n * @param matrix {Matrix} Affine Matrix\n * @returns {string} String that contains an affine matrix formatted as matrix(a,b,c,d,e,f)\n */\nexport function toCSS (matrix) {\n  return toString(matrix)\n}\n\n/**\n * Serialize an affine matrix to a string that can be used with CSS or SVG\n * @param matrix {Matrix} Affine Matrix\n * @returns {string} String that contains an affine matrix formatted as matrix(a,b,c,d,e,f)\n */\nexport function toSVG (matrix) {\n  return toString(matrix)\n}\n\n/**\n * Serialize an affine matrix to a string that can be used with CSS or SVG\n * @param matrix {Matrix} Affine Matrix\n * @returns {string} String that contains an affine matrix formatted as matrix(a,b,c,d,e,f)\n */\nexport function toString (matrix) {\n  return `matrix(${matrix.a},${matrix.b},${matrix.c},${matrix.d},${matrix.e},${matrix.f})`\n}\n","import { inverse } from './inverse'\nimport { transform } from './transform'\nimport { smoothMatrix } from './smoothMatrix'\n\n/**\n * Returns a matrix that transforms a triangle t1 into another triangle t2, or throws an exception if it is impossible.\n * @param t1 {Point[]} Array of points containing the three points for the first triangle\n * @param t2 {Point[]} Array of points containing the three points for the second triangle\n * @returns {Matrix} Matrix which transforms t1 to t2\n * @throws Exception if the matrix becomes not invertible\n */\nexport function fromTriangles (t1, t2) {\n  // point p = first point of the triangle\n  const px1 = t1[0].x != null ? t1[0].x : t1[0][0]\n  const py1 = t1[0].y != null ? t1[0].y : t1[0][1]\n  const px2 = t2[0].x != null ? t2[0].x : t2[0][0]\n  const py2 = t2[0].y != null ? t2[0].y : t2[0][1]\n\n  // point q = second point of the triangle\n  const qx1 = t1[1].x != null ? t1[1].x : t1[1][0]\n  const qy1 = t1[1].y != null ? t1[1].y : t1[1][1]\n  const qx2 = t2[1].x != null ? t2[1].x : t2[1][0]\n  const qy2 = t2[1].y != null ? t2[1].y : t2[1][1]\n\n  // point r = third point of the triangle\n  const rx1 = t1[2].x != null ? t1[2].x : t1[2][0]\n  const ry1 = t1[2].y != null ? t1[2].y : t1[2][1]\n  const rx2 = t2[2].x != null ? t2[2].x : t2[2][0]\n  const ry2 = t2[2].y != null ? t2[2].y : t2[2][1]\n\n  const r1 = {\n    a: px1 - rx1,\n    b: py1 - ry1,\n    c: qx1 - rx1,\n    d: qy1 - ry1,\n    e: rx1,\n    f: ry1\n  }\n  const r2 = {\n    a: px2 - rx2,\n    b: py2 - ry2,\n    c: qx2 - rx2,\n    d: qy2 - ry2,\n    e: rx2,\n    f: ry2\n  }\n\n  const inverseR1 = inverse(r1)\n  const affineMatrix = transform([r2, inverseR1])\n\n  // round the matrix elements to smooth the finite inversion\n  return smoothMatrix(affineMatrix)\n}\n","/**\n * Rounds all elements of the given matrix using the given precision\n * @param matrix {Matrix} An affine matrix to round\n * @param [precision] {number} A precision to use for Math.round. Defaults to 10000000000 (meaning which rounds to the 10th digit after the comma).\n * @returns {Matrix} The rounded Affine Matrix\n */\nexport function smoothMatrix (matrix, precision = 10000000000) {\n  return {\n    a: Math.round(matrix.a * precision) / precision,\n    b: Math.round(matrix.b * precision) / precision,\n    c: Math.round(matrix.c * precision) / precision,\n    d: Math.round(matrix.d * precision) / precision,\n    e: Math.round(matrix.e * precision) / precision,\n    f: Math.round(matrix.f * precision) / precision\n  }\n}\n","import { fromObject } from './fromObject'\nimport { translate } from './translate'\nimport { scale } from './scale'\nimport { rotateDEG } from './rotate'\nimport { skewDEG } from './skew'\nimport { shear } from './shear'\n\n/**\n * Converts array of matrix descriptor to array of matrix\n * @param definitionOrArrayOfDefinition {Object[]} Array of object describing the matrix\n * @returns {Matrix[]} Array of matrix\n *\n * @example\n * > fromDefinition([\n *  { type: 'matrix', a:1, b:2, c:3, d:4, e:5, f:6 },\n *  { type: 'translate', tx: 10, ty: 20 },\n *  { type: 'scale', sx: 2, sy: 4 },\n *  { type: 'rotate', angle: 90, cx: 50, cy: 25 },\n *  { type: 'skewX', angle: 45 },\n *  { type: 'skewY',  angle: 45 },\n *  { type: 'shear', shx: 10, shy: 20}\n * ])\n *\n * [\n *  { a: 1, b: 2, c: 3, d: 4, e: 5, f: 6 },\n *  { a: 1, c: 0, e: 10, b: 0, d: 1, f: 20 },\n *  { a: 2, c: 0, e: 0, b: 0, d: 4, f: 0 },\n *  { a: 6.123, c: -1, e: 0, b: 1, d: 6.123, f: 0 },\n *  { a: 1, c: 0.99.., e: 0, b: 0, d: 1, f: 0 },\n *  { a: 1, c: 0, e: 0, b: 0.99, d: 1, f: 0 },\n *  { a: 1, c: 10, e: 0, b: 20, d: 1, f: 0 }\n * ]\n **/\nexport function fromDefinition (definitionOrArrayOfDefinition) {\n  return Array.isArray(definitionOrArrayOfDefinition)\n    ? definitionOrArrayOfDefinition.map(mapper)\n    : mapper(definitionOrArrayOfDefinition)\n\n  function mapper (descriptor) {\n    switch (descriptor.type) {\n      case 'matrix':\n        if ('a' in descriptor &&\n          'b' in descriptor &&\n          'c' in descriptor &&\n          'd' in descriptor &&\n          'e' in descriptor &&\n          'f' in descriptor\n        ) {\n          return fromObject(descriptor)\n        } else {\n          throw new Error('MISSING_MANDATORY_PARAM')\n        }\n\n      case 'translate':\n        if (!('tx' in descriptor)) throw new Error('MISSING_MANDATORY_PARAM')\n\n        if ('ty' in descriptor) return translate(descriptor.tx, descriptor.ty)\n\n        return translate(descriptor.tx)\n\n      case 'scale':\n        if (!('sx' in descriptor)) throw new Error('MISSING_MANDATORY_PARAM')\n\n        if ('sy' in descriptor) return scale(descriptor.sx, descriptor.sy)\n\n        return scale(descriptor.sx)\n\n      case 'rotate':\n        if (!('angle' in descriptor)) throw new Error('MISSING_MANDATORY_PARAM')\n\n        if ('cx' in descriptor && 'cy' in descriptor) {\n          return rotateDEG(descriptor.angle, descriptor.cx, descriptor.cy)\n        }\n        return rotateDEG(descriptor.angle)\n\n      case 'skewX':\n        if (!('angle' in descriptor)) throw new Error('MISSING_MANDATORY_PARAM')\n        return skewDEG(descriptor.angle, 0)\n\n      case 'skewY':\n        if (!('angle' in descriptor)) throw new Error('MISSING_MANDATORY_PARAM')\n        return skewDEG(0, descriptor.angle)\n\n      case 'shear':\n        if (!('shx' in descriptor && 'shy' in descriptor)) throw new Error('MISSING_MANDATORY_PARAM')\n        return shear(descriptor.shx, descriptor.shy)\n\n      default:\n        throw new Error('UNSUPPORTED_DESCRIPTOR')\n    }\n  }\n}\n","import { parse } from './fromTransformAttribute.autogenerated'\n\n/**\n * Parser for SVG Trasform Attribute http://www.w3.org/TR/SVG/coords.html#TransformAttribute <br/>\n * Warning: This should be considered BETA until it is released a stable version of pegjs.\n * @param transformString {string} Transform string as defined by w3 Consortium\n * @returns {MatrixDescriptor[]} Array of MatrixDescriptor\n *\n * @example\n * > fromTransformAttribute('translate(-10,-10) scale(2,2) translate(10,10)')\n * [\n *  { type: 'translate', tx: -10, ty: -10},\n *  { type: 'scale', sx: 2, sy: 2 },\n *  { type: 'translate', tx: 10, ty: 10}\n * ]\n *\n * > compose(fromDefinition(fromTransformAttribute('translate(-10, -10) scale(10, 10)')))\n * { a: 10, c: 0, e: -10, b: 0, d: 10, f: -10 }\n */\nexport function fromTransformAttribute (transformString) {\n  return parse(transformString)\n}\n","// Generated by Peggy 3.0.0.\n//\n// https://peggyjs.org/\n\nfunction peg$subclass(child, parent) {\n  function C() { this.constructor = child; }\n  C.prototype = parent.prototype;\n  child.prototype = new C();\n}\n\nfunction peg$SyntaxError(message, expected, found, location) {\n  var self = Error.call(this, message);\n  // istanbul ignore next Check is a necessary evil to support older environments\n  if (Object.setPrototypeOf) {\n    Object.setPrototypeOf(self, peg$SyntaxError.prototype);\n  }\n  self.expected = expected;\n  self.found = found;\n  self.location = location;\n  self.name = \"SyntaxError\";\n  return self;\n}\n\npeg$subclass(peg$SyntaxError, Error);\n\nfunction peg$padEnd(str, targetLength, padString) {\n  padString = padString || \" \";\n  if (str.length > targetLength) { return str; }\n  targetLength -= str.length;\n  padString += padString.repeat(targetLength);\n  return str + padString.slice(0, targetLength);\n}\n\npeg$SyntaxError.prototype.format = function(sources) {\n  var str = \"Error: \" + this.message;\n  if (this.location) {\n    var src = null;\n    var k;\n    for (k = 0; k < sources.length; k++) {\n      if (sources[k].source === this.location.source) {\n        src = sources[k].text.split(/\\r\\n|\\n|\\r/g);\n        break;\n      }\n    }\n    var s = this.location.start;\n    var offset_s = (this.location.source && (typeof this.location.source.offset === \"function\"))\n      ? this.location.source.offset(s)\n      : s;\n    var loc = this.location.source + \":\" + offset_s.line + \":\" + offset_s.column;\n    if (src) {\n      var e = this.location.end;\n      var filler = peg$padEnd(\"\", offset_s.line.toString().length, ' ');\n      var line = src[s.line - 1];\n      var last = s.line === e.line ? e.column : line.length + 1;\n      var hatLen = (last - s.column) || 1;\n      str += \"\\n --> \" + loc + \"\\n\"\n          + filler + \" |\\n\"\n          + offset_s.line + \" | \" + line + \"\\n\"\n          + filler + \" | \" + peg$padEnd(\"\", s.column - 1, ' ')\n          + peg$padEnd(\"\", hatLen, \"^\");\n    } else {\n      str += \"\\n at \" + loc;\n    }\n  }\n  return str;\n};\n\npeg$SyntaxError.buildMessage = function(expected, found) {\n  var DESCRIBE_EXPECTATION_FNS = {\n    literal: function(expectation) {\n      return \"\\\"\" + literalEscape(expectation.text) + \"\\\"\";\n    },\n\n    class: function(expectation) {\n      var escapedParts = expectation.parts.map(function(part) {\n        return Array.isArray(part)\n          ? classEscape(part[0]) + \"-\" + classEscape(part[1])\n          : classEscape(part);\n      });\n\n      return \"[\" + (expectation.inverted ? \"^\" : \"\") + escapedParts.join(\"\") + \"]\";\n    },\n\n    any: function() {\n      return \"any character\";\n    },\n\n    end: function() {\n      return \"end of input\";\n    },\n\n    other: function(expectation) {\n      return expectation.description;\n    }\n  };\n\n  function hex(ch) {\n    return ch.charCodeAt(0).toString(16).toUpperCase();\n  }\n\n  function literalEscape(s) {\n    return s\n      .replace(/\\\\/g, \"\\\\\\\\\")\n      .replace(/\"/g,  \"\\\\\\\"\")\n      .replace(/\\0/g, \"\\\\0\")\n      .replace(/\\t/g, \"\\\\t\")\n      .replace(/\\n/g, \"\\\\n\")\n      .replace(/\\r/g, \"\\\\r\")\n      .replace(/[\\x00-\\x0F]/g,          function(ch) { return \"\\\\x0\" + hex(ch); })\n      .replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, function(ch) { return \"\\\\x\"  + hex(ch); });\n  }\n\n  function classEscape(s) {\n    return s\n      .replace(/\\\\/g, \"\\\\\\\\\")\n      .replace(/\\]/g, \"\\\\]\")\n      .replace(/\\^/g, \"\\\\^\")\n      .replace(/-/g,  \"\\\\-\")\n      .replace(/\\0/g, \"\\\\0\")\n      .replace(/\\t/g, \"\\\\t\")\n      .replace(/\\n/g, \"\\\\n\")\n      .replace(/\\r/g, \"\\\\r\")\n      .replace(/[\\x00-\\x0F]/g,          function(ch) { return \"\\\\x0\" + hex(ch); })\n      .replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, function(ch) { return \"\\\\x\"  + hex(ch); });\n  }\n\n  function describeExpectation(expectation) {\n    return DESCRIBE_EXPECTATION_FNS[expectation.type](expectation);\n  }\n\n  function describeExpected(expected) {\n    var descriptions = expected.map(describeExpectation);\n    var i, j;\n\n    descriptions.sort();\n\n    if (descriptions.length > 0) {\n      for (i = 1, j = 1; i < descriptions.length; i++) {\n        if (descriptions[i - 1] !== descriptions[i]) {\n          descriptions[j] = descriptions[i];\n          j++;\n        }\n      }\n      descriptions.length = j;\n    }\n\n    switch (descriptions.length) {\n      case 1:\n        return descriptions[0];\n\n      case 2:\n        return descriptions[0] + \" or \" + descriptions[1];\n\n      default:\n        return descriptions.slice(0, -1).join(\", \")\n          + \", or \"\n          + descriptions[descriptions.length - 1];\n    }\n  }\n\n  function describeFound(found) {\n    return found ? \"\\\"\" + literalEscape(found) + \"\\\"\" : \"end of input\";\n  }\n\n  return \"Expected \" + describeExpected(expected) + \" but \" + describeFound(found) + \" found.\";\n};\n\nfunction peg$parse(input, options) {\n  options = options !== undefined ? options : {};\n\n  var peg$FAILED = {};\n  var peg$source = options.grammarSource;\n\n  var peg$startRuleFunctions = { transformList: peg$parsetransformList };\n  var peg$startRuleFunction = peg$parsetransformList;\n\n  var peg$c0 = \"matrix\";\n  var peg$c1 = \"(\";\n  var peg$c2 = \")\";\n  var peg$c3 = \"translate\";\n  var peg$c4 = \"scale\";\n  var peg$c5 = \"rotate\";\n  var peg$c6 = \"skewX\";\n  var peg$c7 = \"skewY\";\n  var peg$c8 = \",\";\n  var peg$c9 = \".\";\n\n  var peg$r0 = /^[eE]/;\n  var peg$r1 = /^[+\\-]/;\n  var peg$r2 = /^[0-9]/;\n  var peg$r3 = /^[ \\t\\r\\n]/;\n\n  var peg$e0 = peg$literalExpectation(\"matrix\", false);\n  var peg$e1 = peg$literalExpectation(\"(\", false);\n  var peg$e2 = peg$literalExpectation(\")\", false);\n  var peg$e3 = peg$literalExpectation(\"translate\", false);\n  var peg$e4 = peg$literalExpectation(\"scale\", false);\n  var peg$e5 = peg$literalExpectation(\"rotate\", false);\n  var peg$e6 = peg$literalExpectation(\"skewX\", false);\n  var peg$e7 = peg$literalExpectation(\"skewY\", false);\n  var peg$e8 = peg$literalExpectation(\",\", false);\n  var peg$e9 = peg$otherExpectation(\"fractionalConstant\");\n  var peg$e10 = peg$literalExpectation(\".\", false);\n  var peg$e11 = peg$classExpectation([\"e\", \"E\"], false, false);\n  var peg$e12 = peg$classExpectation([\"+\", \"-\"], false, false);\n  var peg$e13 = peg$classExpectation([[\"0\", \"9\"]], false, false);\n  var peg$e14 = peg$classExpectation([\" \", \"\\t\", \"\\r\", \"\\n\"], false, false);\n\n  var peg$f0 = function(ts) { return ts; };\n  var peg$f1 = function(t, ts) { return t.concat(ts) };\n  var peg$f2 = function(a, b, c, d, e, f) {\n      return [{type: 'matrix', a: a, b: b, c: c, d: d, e: e, f: f}];\n    };\n  var peg$f3 = function(tx, ty) {\n      var t = {type: 'translate', tx: tx};\n      if (ty) t.ty = ty;\n      return [t];\n    };\n  var peg$f4 = function(sx, sy) {\n      var s = {type:'scale', sx: sx};\n      if (sy) s.sy = sy;\n      return [s];\n    };\n  var peg$f5 = function(angle, c) {\n      var r = {type:'rotate', angle: angle};\n      if (c) {\n        r.cx = c[0];\n        r.cy = c[1];\n      }\n      return [r];\n    };\n  var peg$f6 = function(angle) {\n      return [{type: 'skewX', angle: angle}];\n    };\n  var peg$f7 = function(angle) {\n      return [{type: 'skewY', angle: angle}];\n    };\n  var peg$f8 = function(f) { return parseFloat(f.join(\"\")); };\n  var peg$f9 = function(i) { return parseInt(i.join(\"\")); };\n  var peg$f10 = function(n) { return n; };\n  var peg$f11 = function(n1, n2) { return [n1, n2]; };\n  var peg$f12 = function(ds) { return ds.join(\"\"); };\n  var peg$f13 = function(f, e) { return [f, e || null].join(\"\")};\n  var peg$f14 = function(d, e) { return [d, e].join(\"\")};\n  var peg$f15 = function(d1, d2) { return [d1 ? d1.join(\"\") : null, \".\", d2.join(\"\")].join(\"\"); };\n  var peg$f16 = function(d) { return d.join(\"\"); };\n  var peg$f17 = function(s, d) { return ['e', s, d.join(\"\")].join(\"\") };\n  var peg$currPos = 0;\n  var peg$savedPos = 0;\n  var peg$posDetailsCache = [{ line: 1, column: 1 }];\n  var peg$maxFailPos = 0;\n  var peg$maxFailExpected = [];\n  var peg$silentFails = 0;\n\n  var peg$result;\n\n  if (\"startRule\" in options) {\n    if (!(options.startRule in peg$startRuleFunctions)) {\n      throw new Error(\"Can't start parsing from rule \\\"\" + options.startRule + \"\\\".\");\n    }\n\n    peg$startRuleFunction = peg$startRuleFunctions[options.startRule];\n  }\n\n  function text() {\n    return input.substring(peg$savedPos, peg$currPos);\n  }\n\n  function offset() {\n    return peg$savedPos;\n  }\n\n  function range() {\n    return {\n      source: peg$source,\n      start: peg$savedPos,\n      end: peg$currPos\n    };\n  }\n\n  function location() {\n    return peg$computeLocation(peg$savedPos, peg$currPos);\n  }\n\n  function expected(description, location) {\n    location = location !== undefined\n      ? location\n      : peg$computeLocation(peg$savedPos, peg$currPos);\n\n    throw peg$buildStructuredError(\n      [peg$otherExpectation(description)],\n      input.substring(peg$savedPos, peg$currPos),\n      location\n    );\n  }\n\n  function error(message, location) {\n    location = location !== undefined\n      ? location\n      : peg$computeLocation(peg$savedPos, peg$currPos);\n\n    throw peg$buildSimpleError(message, location);\n  }\n\n  function peg$literalExpectation(text, ignoreCase) {\n    return { type: \"literal\", text: text, ignoreCase: ignoreCase };\n  }\n\n  function peg$classExpectation(parts, inverted, ignoreCase) {\n    return { type: \"class\", parts: parts, inverted: inverted, ignoreCase: ignoreCase };\n  }\n\n  function peg$anyExpectation() {\n    return { type: \"any\" };\n  }\n\n  function peg$endExpectation() {\n    return { type: \"end\" };\n  }\n\n  function peg$otherExpectation(description) {\n    return { type: \"other\", description: description };\n  }\n\n  function peg$computePosDetails(pos) {\n    var details = peg$posDetailsCache[pos];\n    var p;\n\n    if (details) {\n      return details;\n    } else {\n      p = pos - 1;\n      while (!peg$posDetailsCache[p]) {\n        p--;\n      }\n\n      details = peg$posDetailsCache[p];\n      details = {\n        line: details.line,\n        column: details.column\n      };\n\n      while (p < pos) {\n        if (input.charCodeAt(p) === 10) {\n          details.line++;\n          details.column = 1;\n        } else {\n          details.column++;\n        }\n\n        p++;\n      }\n\n      peg$posDetailsCache[pos] = details;\n\n      return details;\n    }\n  }\n\n  function peg$computeLocation(startPos, endPos, offset) {\n    var startPosDetails = peg$computePosDetails(startPos);\n    var endPosDetails = peg$computePosDetails(endPos);\n\n    var res = {\n      source: peg$source,\n      start: {\n        offset: startPos,\n        line: startPosDetails.line,\n        column: startPosDetails.column\n      },\n      end: {\n        offset: endPos,\n        line: endPosDetails.line,\n        column: endPosDetails.column\n      }\n    };\n    if (offset && peg$source && (typeof peg$source.offset === \"function\")) {\n      res.start = peg$source.offset(res.start);\n      res.end = peg$source.offset(res.end);\n    }\n    return res;\n  }\n\n  function peg$fail(expected) {\n    if (peg$currPos < peg$maxFailPos) { return; }\n\n    if (peg$currPos > peg$maxFailPos) {\n      peg$maxFailPos = peg$currPos;\n      peg$maxFailExpected = [];\n    }\n\n    peg$maxFailExpected.push(expected);\n  }\n\n  function peg$buildSimpleError(message, location) {\n    return new peg$SyntaxError(message, null, null, location);\n  }\n\n  function peg$buildStructuredError(expected, found, location) {\n    return new peg$SyntaxError(\n      peg$SyntaxError.buildMessage(expected, found),\n      expected,\n      found,\n      location\n    );\n  }\n\n  function peg$parsetransformList() {\n    var s0, s1, s2, s3, s4;\n\n    s0 = peg$currPos;\n    s1 = [];\n    s2 = peg$parsewsp();\n    while (s2 !== peg$FAILED) {\n      s1.push(s2);\n      s2 = peg$parsewsp();\n    }\n    s2 = peg$parsetransforms();\n    if (s2 === peg$FAILED) {\n      s2 = null;\n    }\n    s3 = [];\n    s4 = peg$parsewsp();\n    while (s4 !== peg$FAILED) {\n      s3.push(s4);\n      s4 = peg$parsewsp();\n    }\n    peg$savedPos = s0;\n    s0 = peg$f0(s2);\n\n    return s0;\n  }\n\n  function peg$parsetransforms() {\n    var s0, s1, s2, s3;\n\n    s0 = peg$currPos;\n    s1 = peg$parsetransform();\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsecommaWsp();\n      if (s3 !== peg$FAILED) {\n        while (s3 !== peg$FAILED) {\n          s2.push(s3);\n          s3 = peg$parsecommaWsp();\n        }\n      } else {\n        s2 = peg$FAILED;\n      }\n      if (s2 !== peg$FAILED) {\n        s3 = peg$parsetransforms();\n        if (s3 !== peg$FAILED) {\n          peg$savedPos = s0;\n          s0 = peg$f1(s1, s3);\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    if (s0 === peg$FAILED) {\n      s0 = peg$parsetransform();\n    }\n\n    return s0;\n  }\n\n  function peg$parsetransform() {\n    var s0;\n\n    s0 = peg$parsematrix();\n    if (s0 === peg$FAILED) {\n      s0 = peg$parsetranslate();\n      if (s0 === peg$FAILED) {\n        s0 = peg$parsescale();\n        if (s0 === peg$FAILED) {\n          s0 = peg$parserotate();\n          if (s0 === peg$FAILED) {\n            s0 = peg$parseskewX();\n            if (s0 === peg$FAILED) {\n              s0 = peg$parseskewY();\n            }\n          }\n        }\n      }\n    }\n\n    return s0;\n  }\n\n  function peg$parsematrix() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8, s9, s10, s11, s12, s13, s14, s15, s16, s17;\n\n    s0 = peg$currPos;\n    if (input.substr(peg$currPos, 6) === peg$c0) {\n      s1 = peg$c0;\n      peg$currPos += 6;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e0); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsewsp();\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$parsewsp();\n      }\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s3 = peg$c1;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e1); }\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = [];\n        s5 = peg$parsewsp();\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = peg$parsewsp();\n        }\n        s5 = peg$parsenumber();\n        if (s5 !== peg$FAILED) {\n          s6 = peg$parsecommaWsp();\n          if (s6 !== peg$FAILED) {\n            s7 = peg$parsenumber();\n            if (s7 !== peg$FAILED) {\n              s8 = peg$parsecommaWsp();\n              if (s8 !== peg$FAILED) {\n                s9 = peg$parsenumber();\n                if (s9 !== peg$FAILED) {\n                  s10 = peg$parsecommaWsp();\n                  if (s10 !== peg$FAILED) {\n                    s11 = peg$parsenumber();\n                    if (s11 !== peg$FAILED) {\n                      s12 = peg$parsecommaWsp();\n                      if (s12 !== peg$FAILED) {\n                        s13 = peg$parsenumber();\n                        if (s13 !== peg$FAILED) {\n                          s14 = peg$parsecommaWsp();\n                          if (s14 !== peg$FAILED) {\n                            s15 = peg$parsenumber();\n                            if (s15 !== peg$FAILED) {\n                              s16 = [];\n                              s17 = peg$parsewsp();\n                              while (s17 !== peg$FAILED) {\n                                s16.push(s17);\n                                s17 = peg$parsewsp();\n                              }\n                              if (input.charCodeAt(peg$currPos) === 41) {\n                                s17 = peg$c2;\n                                peg$currPos++;\n                              } else {\n                                s17 = peg$FAILED;\n                                if (peg$silentFails === 0) { peg$fail(peg$e2); }\n                              }\n                              if (s17 !== peg$FAILED) {\n                                peg$savedPos = s0;\n                                s0 = peg$f2(s5, s7, s9, s11, s13, s15);\n                              } else {\n                                peg$currPos = s0;\n                                s0 = peg$FAILED;\n                              }\n                            } else {\n                              peg$currPos = s0;\n                              s0 = peg$FAILED;\n                            }\n                          } else {\n                            peg$currPos = s0;\n                            s0 = peg$FAILED;\n                          }\n                        } else {\n                          peg$currPos = s0;\n                          s0 = peg$FAILED;\n                        }\n                      } else {\n                        peg$currPos = s0;\n                        s0 = peg$FAILED;\n                      }\n                    } else {\n                      peg$currPos = s0;\n                      s0 = peg$FAILED;\n                    }\n                  } else {\n                    peg$currPos = s0;\n                    s0 = peg$FAILED;\n                  }\n                } else {\n                  peg$currPos = s0;\n                  s0 = peg$FAILED;\n                }\n              } else {\n                peg$currPos = s0;\n                s0 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s0;\n              s0 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsetranslate() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8;\n\n    s0 = peg$currPos;\n    if (input.substr(peg$currPos, 9) === peg$c3) {\n      s1 = peg$c3;\n      peg$currPos += 9;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e3); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsewsp();\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$parsewsp();\n      }\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s3 = peg$c1;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e1); }\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = [];\n        s5 = peg$parsewsp();\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = peg$parsewsp();\n        }\n        s5 = peg$parsenumber();\n        if (s5 !== peg$FAILED) {\n          s6 = peg$parsecommaWspNumber();\n          if (s6 === peg$FAILED) {\n            s6 = null;\n          }\n          s7 = [];\n          s8 = peg$parsewsp();\n          while (s8 !== peg$FAILED) {\n            s7.push(s8);\n            s8 = peg$parsewsp();\n          }\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s8 = peg$c2;\n            peg$currPos++;\n          } else {\n            s8 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e2); }\n          }\n          if (s8 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s0 = peg$f3(s5, s6);\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsescale() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8;\n\n    s0 = peg$currPos;\n    if (input.substr(peg$currPos, 5) === peg$c4) {\n      s1 = peg$c4;\n      peg$currPos += 5;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e4); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsewsp();\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$parsewsp();\n      }\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s3 = peg$c1;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e1); }\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = [];\n        s5 = peg$parsewsp();\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = peg$parsewsp();\n        }\n        s5 = peg$parsenumber();\n        if (s5 !== peg$FAILED) {\n          s6 = peg$parsecommaWspNumber();\n          if (s6 === peg$FAILED) {\n            s6 = null;\n          }\n          s7 = [];\n          s8 = peg$parsewsp();\n          while (s8 !== peg$FAILED) {\n            s7.push(s8);\n            s8 = peg$parsewsp();\n          }\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s8 = peg$c2;\n            peg$currPos++;\n          } else {\n            s8 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e2); }\n          }\n          if (s8 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s0 = peg$f4(s5, s6);\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parserotate() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8;\n\n    s0 = peg$currPos;\n    if (input.substr(peg$currPos, 6) === peg$c5) {\n      s1 = peg$c5;\n      peg$currPos += 6;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e5); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsewsp();\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$parsewsp();\n      }\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s3 = peg$c1;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e1); }\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = [];\n        s5 = peg$parsewsp();\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = peg$parsewsp();\n        }\n        s5 = peg$parsenumber();\n        if (s5 !== peg$FAILED) {\n          s6 = peg$parsecommaWspTwoNumbers();\n          if (s6 === peg$FAILED) {\n            s6 = null;\n          }\n          s7 = [];\n          s8 = peg$parsewsp();\n          while (s8 !== peg$FAILED) {\n            s7.push(s8);\n            s8 = peg$parsewsp();\n          }\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s8 = peg$c2;\n            peg$currPos++;\n          } else {\n            s8 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e2); }\n          }\n          if (s8 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s0 = peg$f5(s5, s6);\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parseskewX() {\n    var s0, s1, s2, s3, s4, s5, s6, s7;\n\n    s0 = peg$currPos;\n    if (input.substr(peg$currPos, 5) === peg$c6) {\n      s1 = peg$c6;\n      peg$currPos += 5;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e6); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsewsp();\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$parsewsp();\n      }\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s3 = peg$c1;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e1); }\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = [];\n        s5 = peg$parsewsp();\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = peg$parsewsp();\n        }\n        s5 = peg$parsenumber();\n        if (s5 !== peg$FAILED) {\n          s6 = [];\n          s7 = peg$parsewsp();\n          while (s7 !== peg$FAILED) {\n            s6.push(s7);\n            s7 = peg$parsewsp();\n          }\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s7 = peg$c2;\n            peg$currPos++;\n          } else {\n            s7 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e2); }\n          }\n          if (s7 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s0 = peg$f6(s5);\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parseskewY() {\n    var s0, s1, s2, s3, s4, s5, s6, s7;\n\n    s0 = peg$currPos;\n    if (input.substr(peg$currPos, 5) === peg$c7) {\n      s1 = peg$c7;\n      peg$currPos += 5;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e7); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$parsewsp();\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$parsewsp();\n      }\n      if (input.charCodeAt(peg$currPos) === 40) {\n        s3 = peg$c1;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e1); }\n      }\n      if (s3 !== peg$FAILED) {\n        s4 = [];\n        s5 = peg$parsewsp();\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = peg$parsewsp();\n        }\n        s5 = peg$parsenumber();\n        if (s5 !== peg$FAILED) {\n          s6 = [];\n          s7 = peg$parsewsp();\n          while (s7 !== peg$FAILED) {\n            s6.push(s7);\n            s7 = peg$parsewsp();\n          }\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s7 = peg$c2;\n            peg$currPos++;\n          } else {\n            s7 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e2); }\n          }\n          if (s7 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s0 = peg$f7(s5);\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsenumber() {\n    var s0, s1, s2, s3;\n\n    s0 = peg$currPos;\n    s1 = peg$currPos;\n    s2 = peg$parsesign();\n    if (s2 === peg$FAILED) {\n      s2 = null;\n    }\n    s3 = peg$parsefloatingPointConstant();\n    if (s3 !== peg$FAILED) {\n      s2 = [s2, s3];\n      s1 = s2;\n    } else {\n      peg$currPos = s1;\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      peg$savedPos = s0;\n      s1 = peg$f8(s1);\n    }\n    s0 = s1;\n    if (s0 === peg$FAILED) {\n      s0 = peg$currPos;\n      s1 = peg$currPos;\n      s2 = peg$parsesign();\n      if (s2 === peg$FAILED) {\n        s2 = null;\n      }\n      s3 = peg$parseintegerConstant();\n      if (s3 !== peg$FAILED) {\n        s2 = [s2, s3];\n        s1 = s2;\n      } else {\n        peg$currPos = s1;\n        s1 = peg$FAILED;\n      }\n      if (s1 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s1 = peg$f9(s1);\n      }\n      s0 = s1;\n    }\n\n    return s0;\n  }\n\n  function peg$parsecommaWspNumber() {\n    var s0, s1, s2;\n\n    s0 = peg$currPos;\n    s1 = peg$parsecommaWsp();\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parsenumber();\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f10(s2);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsecommaWspTwoNumbers() {\n    var s0, s1, s2, s3, s4;\n\n    s0 = peg$currPos;\n    s1 = peg$parsecommaWsp();\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parsenumber();\n      if (s2 !== peg$FAILED) {\n        s3 = peg$parsecommaWsp();\n        if (s3 !== peg$FAILED) {\n          s4 = peg$parsenumber();\n          if (s4 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s0 = peg$f11(s2, s4);\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsecommaWsp() {\n    var s0, s1, s2, s3, s4;\n\n    s0 = peg$currPos;\n    s1 = [];\n    s2 = peg$parsewsp();\n    if (s2 !== peg$FAILED) {\n      while (s2 !== peg$FAILED) {\n        s1.push(s2);\n        s2 = peg$parsewsp();\n      }\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parsecomma();\n      if (s2 === peg$FAILED) {\n        s2 = null;\n      }\n      s3 = [];\n      s4 = peg$parsewsp();\n      while (s4 !== peg$FAILED) {\n        s3.push(s4);\n        s4 = peg$parsewsp();\n      }\n      s1 = [s1, s2, s3];\n      s0 = s1;\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    if (s0 === peg$FAILED) {\n      s0 = peg$currPos;\n      s1 = peg$parsecomma();\n      if (s1 !== peg$FAILED) {\n        s2 = [];\n        s3 = peg$parsewsp();\n        while (s3 !== peg$FAILED) {\n          s2.push(s3);\n          s3 = peg$parsewsp();\n        }\n        s1 = [s1, s2];\n        s0 = s1;\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    }\n\n    return s0;\n  }\n\n  function peg$parsecomma() {\n    var s0;\n\n    if (input.charCodeAt(peg$currPos) === 44) {\n      s0 = peg$c8;\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e8); }\n    }\n\n    return s0;\n  }\n\n  function peg$parseintegerConstant() {\n    var s0, s1;\n\n    s0 = peg$currPos;\n    s1 = peg$parsedigitSequence();\n    if (s1 !== peg$FAILED) {\n      peg$savedPos = s0;\n      s1 = peg$f12(s1);\n    }\n    s0 = s1;\n\n    return s0;\n  }\n\n  function peg$parsefloatingPointConstant() {\n    var s0, s1, s2;\n\n    s0 = peg$currPos;\n    s1 = peg$parsefractionalConstant();\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parseexponent();\n      if (s2 === peg$FAILED) {\n        s2 = null;\n      }\n      peg$savedPos = s0;\n      s0 = peg$f13(s1, s2);\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    if (s0 === peg$FAILED) {\n      s0 = peg$currPos;\n      s1 = peg$parsedigitSequence();\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parseexponent();\n        if (s2 !== peg$FAILED) {\n          peg$savedPos = s0;\n          s0 = peg$f14(s1, s2);\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    }\n\n    return s0;\n  }\n\n  function peg$parsefractionalConstant() {\n    var s0, s1, s2, s3;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    s1 = peg$parsedigitSequence();\n    if (s1 === peg$FAILED) {\n      s1 = null;\n    }\n    if (input.charCodeAt(peg$currPos) === 46) {\n      s2 = peg$c9;\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e10); }\n    }\n    if (s2 !== peg$FAILED) {\n      s3 = peg$parsedigitSequence();\n      if (s3 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f15(s1, s3);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    if (s0 === peg$FAILED) {\n      s0 = peg$currPos;\n      s1 = peg$parsedigitSequence();\n      if (s1 !== peg$FAILED) {\n        if (input.charCodeAt(peg$currPos) === 46) {\n          s2 = peg$c9;\n          peg$currPos++;\n        } else {\n          s2 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$e10); }\n        }\n        if (s2 !== peg$FAILED) {\n          peg$savedPos = s0;\n          s0 = peg$f16(s1);\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e9); }\n    }\n\n    return s0;\n  }\n\n  function peg$parseexponent() {\n    var s0, s1, s2, s3;\n\n    s0 = peg$currPos;\n    if (peg$r0.test(input.charAt(peg$currPos))) {\n      s1 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e11); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parsesign();\n      if (s2 === peg$FAILED) {\n        s2 = null;\n      }\n      s3 = peg$parsedigitSequence();\n      if (s3 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f17(s2, s3);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsesign() {\n    var s0;\n\n    if (peg$r1.test(input.charAt(peg$currPos))) {\n      s0 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e12); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsedigitSequence() {\n    var s0, s1;\n\n    s0 = [];\n    s1 = peg$parsedigit();\n    if (s1 !== peg$FAILED) {\n      while (s1 !== peg$FAILED) {\n        s0.push(s1);\n        s1 = peg$parsedigit();\n      }\n    } else {\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsedigit() {\n    var s0;\n\n    if (peg$r2.test(input.charAt(peg$currPos))) {\n      s0 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e13); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsewsp() {\n    var s0;\n\n    if (peg$r3.test(input.charAt(peg$currPos))) {\n      s0 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e14); }\n    }\n\n    return s0;\n  }\n\n  peg$result = peg$startRuleFunction();\n\n  if (peg$result !== peg$FAILED && peg$currPos === input.length) {\n    return peg$result;\n  } else {\n    if (peg$result !== peg$FAILED && peg$currPos < input.length) {\n      peg$fail(peg$endExpectation());\n    }\n\n    throw peg$buildStructuredError(\n      peg$maxFailExpected,\n      peg$maxFailPos < input.length ? input.charAt(peg$maxFailPos) : null,\n      peg$maxFailPos < input.length\n        ? peg$computeLocation(peg$maxFailPos, peg$maxFailPos + 1)\n        : peg$computeLocation(peg$maxFailPos, peg$maxFailPos)\n    );\n  }\n}\n\nexport {\n  peg$SyntaxError as SyntaxError,\n\n  peg$parse as parse\n};\n","import { scale } from './scale'\nimport { compose } from './transform'\n/**\n * Decompose a matrix into translation, scaling and rotation components, optionally\n * take horizontal and vertical flip in to consideration.\n * Note this function decomposes a matrix in rotation -> scaling -> translation order. I.e. for\n * certain translation T {tx, ty}, rotation R and scaling S { sx, sy }, it's only true for:\n *  decomposeTSR(compose(T, S, R)) === { translate: T, rotation: R, scale: S }\n * composing in a different order may yield a different decomposition result.\n * @param matrix {Matrix} Affine Matrix\n * @param  flipX {boolean} Whether the matrix contains vertical flip, i.e. mirrors on x-axis\n * @param  flipY {boolean} Whether the matrix contains horizontal flip, i.e. mirrors on y-axis\n * @returns {Transform} A transform object consisted by its translation, scaling\n * and rotation components.\n */\nexport function decomposeTSR (matrix, flipX = false, flipY = false) {\n  // Remove flip from the matrix first - flip could be incorrectly interpreted as\n  // rotations (e.g. flipX + flipY = rotate by 180 degrees).\n  // Note flipX is a vertical flip, and flipY is a horizontal flip.\n  if (flipX) {\n    if (flipY) {\n      matrix = compose(matrix, scale(-1, -1))\n    } else {\n      matrix = compose(matrix, scale(1, -1))\n    }\n  } else if (flipY) {\n    matrix = compose(matrix, scale(-1, 1))\n  }\n\n  const a = matrix.a; const b = matrix.b\n  const c = matrix.c; const d = matrix.d\n  let scaleX, scaleY, rotation\n\n  if (a !== 0 || c !== 0) {\n    const hypotAc = Math.hypot(a, c)\n    scaleX = hypotAc\n    scaleY = (a * d - b * c) / hypotAc\n    const acos = Math.acos(a / hypotAc)\n    rotation = c > 0 ? -acos : acos\n  } else if (b !== 0 || d !== 0) {\n    const hypotBd = Math.hypot(b, d)\n    scaleX = (a * d - b * c) / hypotBd\n    scaleY = hypotBd\n    const acos = Math.acos(b / hypotBd)\n    rotation = Math.PI / 2 + (d > 0 ? -acos : acos)\n  } else {\n    scaleX = 0\n    scaleY = 0\n    rotation = 0\n  }\n\n  // put the flip factors back\n  if (flipY) {\n    scaleX = -scaleX\n  }\n\n  if (flipX) {\n    scaleY = -scaleY\n  }\n\n  return {\n    translate: { tx: matrix.e, ty: matrix.f },\n    scale: { sx: scaleX, sy: scaleY },\n    rotation: { angle: rotation }\n  }\n}\n","\n/**\n * Tranformation matrix that mirrors on x-axis\n * @returns {Matrix} Affine Matrix\n */\nexport function flipX () {\n  return {\n    a: 1,\n    c: 0,\n    e: 0,\n    b: 0,\n    d: -1,\n    f: 0\n  }\n}\n\n/**\n * Tranformation matrix that mirrors on y-axis\n * @returns {Matrix} Affine Matrix\n */\nexport function flipY () {\n  return {\n    a: -1,\n    c: 0,\n    e: 0,\n    b: 0,\n    d: 1,\n    f: 0\n  }\n}\n\n/**\n * Tranformation matrix that mirrors on origin\n * @returns {Matrix} Affine Matrix\n */\nexport function flipOrigin () {\n  return {\n    a: -1,\n    c: 0,\n    e: 0,\n    b: 0,\n    d: -1,\n    f: 0\n  }\n}\n","import { translate } from './translate'\nimport { applyToPoint } from './applyToPoint'\nimport { rotate } from './rotate'\nimport { scale } from './scale'\nimport { compose } from './transform'\n\n// https://manivannan-ai.medium.com/find-the-angle-between-three-points-from-2d-using-python-348c513e2cd\n\n/**\n * Calculate a transformation matrix from a point that starts from A to A'\n * This approach can be associated to a pointer that moves on a device\n * @param {Point} startingPoint - Starting point (A)\n * @param {Point} endingPoint - Ending point (A')\n */\nexport function fromOneMovingPoint (startingPoint, endingPoint) {\n  const tx = endingPoint.x - startingPoint.x\n  const ty = endingPoint.y - startingPoint.y\n\n  return translate(tx, ty)\n}\n\n/**\n * Calculate a transformation matrix about two points that move from positions A and B to A' and B'\n * This approach can be associated to a two finger gesture on a touch device\n * @param {Point} startingPoint1 - Starting Point (A)\n * @param {Point} startingPoint2 - Starting Point (B)\n * @param {Point} endingPoint1 - Ending point (A')\n * @param {Point} endingPoint2 - Ending Point (B')\n */\nexport function fromTwoMovingPoints (startingPoint1, startingPoint2, endingPoint1, endingPoint2) {\n  // finds translation\n  const translationMatrix = fromOneMovingPoint(startingPoint1, endingPoint1)\n\n  const pointA = applyToPoint(translationMatrix, startingPoint2) // I have to translate this point\n  const center = endingPoint1\n  const pointB = endingPoint2\n\n  // finds rotation matrix\n  const angle = Math.atan2(pointB.y - center.y, pointB.x - center.x) - Math.atan2(pointA.y - center.y, pointA.x - center.x)\n  const rotationMatrix = rotate(angle, center.x, center.y)\n\n  // finds scale matrix\n  const d1 = Math.sqrt(Math.pow(pointA.x - center.x, 2) + Math.pow(pointA.y - center.y, 2))\n  const d2 = Math.sqrt(Math.pow(pointB.x - center.x, 2) + Math.pow(pointB.y - center.y, 2))\n  const scalingLevel = d2 / d1\n  const scalingMatrix = scale(scalingLevel, scalingLevel, center.x, center.y)\n\n  return compose([\n    translationMatrix,\n    scalingMatrix,\n    rotationMatrix\n  ])\n}\n","import {TViewportTransform, TViewportTransformXY} from '../project-viewport';\nimport {compose, Matrix, rotate, scale, translate} from 'transformation-matrix';\n\nexport function createTransformMatrix (transform: TViewportTransform | TViewportTransformXY): Matrix {\n    const scaleX = 'scale' in transform ? transform.scale : transform.scaleX;\n    const scaleY = 'scale' in transform ? transform.scale : transform.scaleY;\n    return compose(\n        translate(transform.x, transform.y),\n        rotate(transform.angleDeg / 180 * Math.PI),\n        scale(scaleX, scaleY),\n    );\n}","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"tool-zoom-in.d413f042.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"tool-zoom-out.299f4d1f.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"viewport-reset.25476ab5.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"tool-hand.e7fc81b9.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"edit-pencil.d7636d97.svg\";","\nexport function zoomByStep (oldScale: number, stepNum: number): number {\n    const step = Math.log2(oldScale);\n\n    let newStep = step / Math.abs(stepNum);\n    newStep += stepNum > 0 ? 1 : -1;\n    newStep = Math.round(newStep);\n    newStep *= Math.abs(stepNum);\n\n    return Math.pow(2, newStep);\n}","import {TViewportTransform} from '../project-viewport';\nimport {IVector2D} from '../../../../bb/bb-types';\nimport {compose, rotate, scale as scaleFunc, applyToPoint} from 'transformation-matrix';\n\nexport function createTransform (\n    viewportPoint: IVector2D,\n    canvasPoint: IVector2D,\n    scale: number,\n    angleDeg: number,\n): TViewportTransform {\n    const mat = compose(\n        scaleFunc(-scale, -scale),\n        rotate(angleDeg / 180 * Math.PI),\n    );\n    const topLeftP = applyToPoint(mat, canvasPoint);\n    topLeftP.x += viewportPoint.x;\n    topLeftP.y += viewportPoint.y;\n    return {\n        x: topLeftP.x,\n        y: topLeftP.y,\n        scale,\n        angleDeg,\n    };\n}","import {createTransformMatrix} from './create-transform-matrix';\nimport {TViewportTransform} from '../project-viewport';\nimport {IVector2D} from '../../../../bb/bb-types';\nimport {inverse, applyToPoint} from 'transformation-matrix';\n\nexport type TMetaTransform = {\n    viewportP: IVector2D;\n    canvasP: IVector2D;\n    scale: number;\n    angleDeg: number;\n}\n\nexport function toMetaTransform (\n    transform: TViewportTransform,\n    viewportP: IVector2D,\n): TMetaTransform {\n    const m = createTransformMatrix(transform);\n    const canvasP = applyToPoint(inverse(m), viewportP);\n    return {\n        viewportP,\n        canvasP,\n        scale: transform.scale,\n        angleDeg: transform.angleDeg,\n    };\n}","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"edit-crop.16c534dd.svg\";","import {BB} from '../../../bb/bb';\nimport {showModal} from './base/showModal';\nimport {CropCopy} from '../components/crop-copy';\nimport {LANG} from '../../../language/language';\nimport {StatusOverlay} from '../components/status-overlay';\nimport {ICropRect} from '../../../bb/bb-types';\n\nexport function clipboardDialog (\n    parent: HTMLElement,\n    fullCanvas: HTMLCanvasElement,\n    cropCallback: (crop: ICropRect) => void,\n    output: StatusOverlay,\n    showCropButton: boolean,\n): void {\n\n    let clipboardItemIsSupported: boolean = false;\n    try {\n        clipboardItemIsSupported = !!ClipboardItem;\n    } catch (e) { /* empty */ }\n\n    const div = document.createElement('div');\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\n\n    const topWrapper = BB.el({\n        content: LANG('crop-drag-to-crop') + (clipboardItemIsSupported ? '' : '<br>' + LANG('cropcopy-click-hold')),\n        css: {\n            textAlign: 'center',\n        },\n    });\n    div.append(topWrapper);\n\n\n    const cropCopy = new CropCopy({\n        width: isSmall ? 340 : 540,\n        height: isSmall ? 300 : 350,\n        canvas: fullCanvas,\n        isNotCopy: false,\n        onChange: () => setTimeout(() => updateBlob()),\n    });\n    BB.css(cropCopy.getEl(), {\n        marginTop: '10px',\n        marginLeft: '-20px',\n    });\n    div.append(cropCopy.getEl());\n\n    let blob: Blob | undefined = undefined;\n\n    // Safari doesn't allow any async operations between user interaction (click) and navigator.clipboard.write.\n    // It throws \"NotAllowedError: the request is not allowed by the user agent or the platform in the current context,\n    // possibly because the user denied permission.\"\n    // So, we try to prepare blob beforehand.\n    let cropTimeout: ReturnType<typeof setTimeout> | undefined;\n    function updateBlob () {\n        if (!clipboardItemIsSupported) {\n            return;\n        }\n        clearTimeout(cropTimeout);\n        cropTimeout = setTimeout(() => {\n            cropCopy.getCroppedCanvas().toBlob((result) => {\n                blob = result ?? undefined;\n            }, 'image/png');\n        }, 50);\n    }\n\n    async function toClipboard () {\n        if (!blob) {\n            return;\n        }\n        try {\n            await (navigator.clipboard as any).write([\n                new ClipboardItem({\n                    [blob.type]: blob,\n                }),\n            ]);\n            setTimeout(function () {\n                output.out(LANG('cropcopy-copied'), true);\n            }, 200);\n        } catch (err) {\n            console.error((err as Error).name, (err as Error).message);\n            return;\n        }\n    }\n\n    const keyListener = new BB.KeyListener({\n        onDown: function (keyStr, KeyEvent, comboStr) {\n            if (['ctrl+c', 'cmd+c'].includes(comboStr)) {\n                toClipboard();\n                closeFunc && closeFunc();\n            }\n        },\n    });\n\n    let closeFunc: () => void;\n    function blur () {\n        closeFunc && closeFunc();\n    }\n    window.addEventListener('blur', blur);\n\n    const buttonArr = [];\n    if (clipboardItemIsSupported) {\n        buttonArr.push(LANG('cropcopy-btn-copy'));\n    }\n    if (showCropButton) {\n        buttonArr.push(LANG('cropcopy-btn-crop'));\n    }\n    buttonArr.push('Cancel');\n\n    showModal({\n        target: parent,\n        message: '<b>' + (showCropButton ? `${LANG('cropcopy-title-copy')} / ${LANG('cropcopy-title-crop')}` : `${LANG('cropcopy-title-copy')}`) + '</b>',\n        div: div,\n        style: isSmall ? {} : {\n            width: '540px',\n        },\n        buttons: buttonArr,\n        primaries: [LANG('cropcopy-btn-copy')],\n        callback: function (result) {\n            if (result === LANG('cropcopy-btn-copy')) {\n                toClipboard();\n            } else if (result === LANG('cropcopy-btn-crop')) {\n                const rectObj = cropCopy.getRect();\n                cropCallback({\n                    left: Math.round(-rectObj.x),\n                    right: Math.round(rectObj.x + rectObj.width - fullCanvas.width),\n                    top: Math.round(-rectObj.y),\n                    bottom: Math.round(rectObj.y + rectObj.height - fullCanvas.height),\n                });\n            }\n            window.removeEventListener('blur', blur);\n            BB.freeCanvas(cropCopy.getCroppedCanvas());\n            cropCopy.destroy();\n            keyListener.destroy();\n        },\n        clickOnEnter: LANG('cropcopy-btn-copy'),\n        closeFunc: function (func) {\n            closeFunc = func;\n        },\n    });\n}","import {BB} from '../../../../bb/bb';\nimport {klHistory} from '../../../history/kl-history';\nimport {Select} from '../../components/select';\nimport {PointSlider} from '../../components/point-slider';\nimport {KlCanvas, MAX_LAYERS} from '../../../canvas/kl-canvas';\nimport {TMixMode, TUiLayout} from '../../../kl-types';\nimport {LANG} from '../../../../language/language';\nimport {translateBlending} from '../../../canvas/translate-blending';\nimport {PointerListener} from '../../../../bb/input/pointer-listener';\nimport {IPointerEvent} from '../../../../bb/input/event.types';\nimport {renameLayerDialog} from './rename-layer-dialog';\nimport {mergeLayerDialog} from './merge-layer-dialog';\nimport {theme} from '../../../../theme/theme';\nimport {throwIfNull} from '../../../../bb/base/base';\nimport {hasPointerEvents} from '../../../../bb/base/browser';\nimport {c} from '../../../../bb/base/c';\nimport {DropdownMenu} from '../../components/dropdown-menu';\nimport addLayerImg from '/src/app/img/ui/add-layer.svg';\nimport duplicateLayerImg from '/src/app/img/ui/duplicate-layer.svg';\nimport mergeLayerImg from '/src/app/img/ui/merge-layers.svg';\nimport removeLayerImg from '/src/app/img/ui/remove-layer.svg';\nimport renameLayerImg from '/src/app/img/ui/rename-layer.svg';\nimport caretDownImg from '/src/app/img/ui/caret-down.svg';\n\ntype TLayerEl = HTMLElement & {\n    label: HTMLElement;\n    opacityLabel: HTMLElement;\n    thumb: HTMLCanvasElement;\n\n    spot: number;\n    posY: number;\n    layerName: string;\n    opacity: number;\n    pointerListener: PointerListener;\n    opacitySlider: PointSlider;\n    isSelected: boolean;\n};\n\nconst paddingLeft = 25;\n\nexport class LayerManager {\n\n    private readonly parentEl: HTMLElement;\n    private readonly rootEl: HTMLElement;\n    private readonly klCanvas: KlCanvas;\n    private klCanvasLayerArr: {\n        context: CanvasRenderingContext2D;\n        opacity: number;\n        name: string;\n        mixModeStr: TMixMode;\n    }[];\n    private readonly layerListEl: HTMLElement;\n    private layerElArr: TLayerEl[];\n    private selectedSpotIndex: number;\n    private readonly removeBtn: HTMLButtonElement;\n    private readonly addBtn: HTMLButtonElement;\n    private readonly duplicateBtn: HTMLButtonElement;\n    private readonly mergeBtn: HTMLButtonElement;\n    private readonly moreDropdown: DropdownMenu;\n    private readonly modeSelect: Select<TMixMode>;\n    private uiState: TUiLayout;\n    private readonly largeThumbDiv: HTMLElement;\n    private oldHistoryState: number | undefined;\n\n    private readonly largeThumbCanvas: HTMLCanvasElement;\n    private largeThumbInDocument: boolean;\n    private largeThumbInTimeout: undefined | ReturnType<typeof setTimeout>;\n    private largeThumbTimeout: undefined | ReturnType<typeof setTimeout>;\n    private lastpos: number = 0;\n\n    private readonly onSelect: (layerIndex: number) => void;\n    private readonly layerHeight: number = 35;\n    private readonly layerSpacing: number = 0;\n\n    private move (oldSpotIndex: number, newSpotIndex: number): void {\n        if (isNaN(oldSpotIndex) || isNaN(newSpotIndex)) {\n            throw 'layermanager - invalid move';\n        }\n        for (let i = 0; i < this.klCanvasLayerArr.length; i++) {\n            ((i) => {\n                let posy = this.layerElArr[i].spot; // <- here\n                if (this.layerElArr[i].spot === oldSpotIndex) {\n                    posy = newSpotIndex;\n                } else {\n                    if (this.layerElArr[i].spot > oldSpotIndex) {\n                        posy--;\n                    }\n                    if (posy >= newSpotIndex) {\n                        posy++;\n                    }\n                }\n                this.layerElArr[i].spot = posy;\n                this.layerElArr[i].posY = (this.layerHeight + this.layerSpacing) * (this.klCanvasLayerArr.length - posy - 1);\n                this.layerElArr[i].style.top = this.layerElArr[i].posY + 'px';\n            })(i);\n        }\n        if (oldSpotIndex === newSpotIndex) {\n            return;\n        }\n        this.klCanvas.moveLayer(this.selectedSpotIndex, newSpotIndex - oldSpotIndex);\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\n        this.selectedSpotIndex = newSpotIndex;\n        this.mergeBtn.disabled = this.selectedSpotIndex === 0;\n    }\n\n    private posToSpot (p: number): number {\n        let result = parseInt('' + (p / (this.layerHeight + this.layerSpacing) + 0.5));\n        result = Math.min(this.klCanvasLayerArr.length - 1, Math.max(0, result));\n        result = this.klCanvasLayerArr.length - result - 1;\n        return result;\n    }\n\n    /**\n     * update css position of all layers that are not being dragged, while dragging\n     */\n    private updateLayersVerticalPosition (id: number, newspot: number): void {\n        newspot = Math.min(this.klCanvasLayerArr.length - 1, Math.max(0, newspot));\n        if (newspot === this.lastpos) {\n            return;\n        }\n        for (let i = 0; i < this.klCanvasLayerArr.length; i++) {\n            if (this.layerElArr[i].spot === id) { // <- here\n                continue;\n            }\n            let posy = this.layerElArr[i].spot;\n            if (this.layerElArr[i].spot > id) {\n                posy--;\n            }\n            if (posy >= newspot) {\n                posy++;\n            }\n            this.layerElArr[i].posY = (this.layerHeight + this.layerSpacing) * (this.klCanvasLayerArr.length - posy - 1);\n            this.layerElArr[i].style.top = this.layerElArr[i].posY + 'px';\n        }\n        this.lastpos = newspot;\n    }\n\n    private renameLayer (layerSpot: number): void {\n\n        renameLayerDialog(\n            this.parentEl,\n            this.klCanvas.getLayer(layerSpot)!.name,\n            (newName) => {\n                if (newName === undefined || newName === this.klCanvas.getLayer(layerSpot)!.name) {\n                    return;\n                }\n                this.klCanvas.renameLayer(layerSpot, newName);\n                this.createLayerList();\n                klHistory.pause(true);\n                this.onSelect(layerSpot);\n                klHistory.pause(false);\n            }\n        );\n    }\n\n    private updateHeight (): void {\n        this.layerListEl.style.height = (this.layerElArr.length * 35) + 'px';\n    }\n\n    private createLayerList (): void {\n        this.oldHistoryState = klHistory.getState();\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\n        const checkerImUrl = BB.createCheckerDataUrl(4, undefined, theme.isDark());\n\n        const createLayerEntry = (index: number): void => {\n            const klLayer = throwIfNull(this.klCanvas.getLayer(index));\n            const layerName = klLayer.name;\n            const opacity = this.klCanvasLayerArr[index].opacity;\n            const isVisible = klLayer.isVisible;\n            const layercanvas = this.klCanvasLayerArr[index].context.canvas;\n\n            const layer: TLayerEl = BB.el({\n                className: 'kl-layer',\n            }) as HTMLElement as TLayerEl;\n            this.layerElArr[index] = layer;\n            layer.posY = ((this.klCanvasLayerArr.length - 1) * 35 - index * 35);\n            BB.css(layer, {\n                top: layer.posY + 'px',\n            });\n            const innerLayer = BB.el();\n            BB.css(innerLayer, {\n                position: 'relative',\n            });\n\n            const container1 = BB.el();\n            BB.css(container1, {\n                width: '270px',\n                height: '34px',\n            });\n            const container2 = BB.el();\n            layer.append(innerLayer);\n            innerLayer.append(container1, container2);\n\n            layer.spot = index;\n\n            //checkbox - visibility\n            {\n                const checkWrapper = BB.el({\n                    tagName: 'label',\n                    parent: container1,\n                    title: LANG('layers-visibility-toggle'),\n                    css: {\n                        display: 'flex',\n                        width: '25px',\n                        height: '100%',\n                        justifyContent: 'right',\n                        alignItems: 'center',\n                        cursor: 'pointer',\n                    },\n                });\n                const check = BB.el({\n                    tagName: 'input',\n                    parent: checkWrapper,\n                    custom: {\n                        type: 'checkbox',\n                        tabindex: '-1',\n                    },\n                    css: {\n                        display: 'block',\n                        cursor: 'pointer',\n                        margin: '0',\n                        marginRight: '5px',\n                    },\n                });\n                check.checked = isVisible;\n                check.onchange = () => {\n                    this.klCanvas.setLayerIsVisible(layer.spot, check.checked);\n                    this.createLayerList();\n                    if (layer.spot === this.selectedSpotIndex) {\n                        klHistory.pause(true);\n                        this.onSelect(this.selectedSpotIndex);\n                        klHistory.pause(false);\n                    }\n                };\n                // prevent layer getting dragged\n                const preventFunc = (e: PointerEvent | MouseEvent) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                };\n                if (hasPointerEvents) {\n                    checkWrapper.onpointerdown = preventFunc;\n                } else {\n                    checkWrapper.onmousedown = preventFunc;\n                }\n            }\n\n\n            //thumb\n            {\n                const thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 30, 30, 1);\n                layer.thumb = BB.canvas(thumbDimensions.width, thumbDimensions.height);\n\n                const thc = BB.ctx(layer.thumb);\n                thc.save();\n                if (layer.thumb.width > layercanvas.width) {\n                    thc.imageSmoothingEnabled = false;\n                }\n                thc.drawImage(layercanvas, 0, 0, layer.thumb.width, layer.thumb.height);\n                thc.restore();\n                BB.css(layer.thumb, {\n                    position: 'absolute',\n                    left: ((32 - layer.thumb.width) / 2 + paddingLeft) + 'px',\n                    top: ((32 - layer.thumb.height) / 2 + 1) + 'px',\n                });\n                layer.thumb.style.backgroundImage = 'url(' + checkerImUrl + ')';\n            }\n\n            //layerlabel\n            {\n                layer.label = BB.el({\n                    className: 'kl-layer__label',\n                });\n                layer.layerName = layerName;\n                layer.label.append(layer.layerName);\n\n                BB.css(layer.label, {\n                    position: 'absolute',\n                    left: (1 + 32 + 5 + paddingLeft) + 'px',\n                    top: 1 + 'px',\n                    fontSize: '13px',\n                    width: '170px',\n                    height: '20px',\n                    overflow: 'hidden',\n                    whiteSpace: 'nowrap',\n                });\n\n                layer.label.ondblclick = () => {\n                    this.renameLayer(layer.spot);\n                };\n            }\n            //layer label opacity\n            {\n                layer.opacityLabel = BB.el({\n                    className: 'kl-layer__opacity-label',\n                });\n                layer.opacity = opacity;\n                layer.opacityLabel.append(parseInt('' + (layer.opacity * 100)) + '%');\n\n                BB.css(layer.opacityLabel, {\n                    position: 'absolute',\n                    left: (250 - 1 - 5 - 50 - 5 + paddingLeft) + 'px',\n                    top: 1 + 'px',\n                    fontSize: '13px',\n                    textAlign: 'right',\n                    width: '50px',\n                    transition: 'color 0.2s ease-in-out',\n                    textDecoration: isVisible ? undefined : 'line-through',\n                });\n            }\n\n            let oldOpacity: number;\n            const opacitySlider = new PointSlider({\n                init: layer.opacity,\n                width: 200,\n                pointSize: 14,\n                callback: (sliderValue, isFirst, isLast) => {\n                    if (isFirst) {\n                        oldOpacity = this.klCanvas.getLayer(layer.spot)!.opacity;\n                        klHistory.pause(true);\n                        return;\n                    }\n                    if (isLast) {\n                        klHistory.pause(false);\n                        if (oldOpacity !== sliderValue) {\n                            this.klCanvas.layerOpacity(layer.spot, sliderValue);\n                        }\n                        return;\n                    }\n                    layer.opacityLabel.innerHTML = Math.round(sliderValue * 100) + '%';\n                    this.klCanvas.layerOpacity(layer.spot, sliderValue);\n                },\n            });\n            BB.css(opacitySlider.getEl(), {\n                position: 'absolute',\n                left: (39 + paddingLeft) + 'px',\n                top: '17px',\n            });\n            layer.opacitySlider = opacitySlider;\n\n            //larger layer preview - hover\n            layer.thumb.onpointerover = (e) => {\n                if (e.buttons !== 0 && (!e.pointerType || e.pointerType !== 'touch')) { //shouldn't show while dragging\n                    return;\n                }\n\n                const thumbDimensions = BB.fitInto(layercanvas.width, layercanvas.height, 250, 250, 1);\n\n                if (this.largeThumbCanvas.width !== thumbDimensions.width || this.largeThumbCanvas.height !== thumbDimensions.height) {\n                    this.largeThumbCanvas.width = thumbDimensions.width;\n                    this.largeThumbCanvas.height = thumbDimensions.height;\n                }\n                const ctx = BB.ctx(this.largeThumbCanvas);\n                ctx.save();\n                if (this.largeThumbCanvas.width > layercanvas.width) {\n                    ctx.imageSmoothingEnabled = false;\n                }\n                ctx.imageSmoothingQuality = 'high';\n                ctx.clearRect(0, 0, this.largeThumbCanvas.width, this.largeThumbCanvas.height);\n                ctx.drawImage(layercanvas, 0, 0, this.largeThumbCanvas.width, this.largeThumbCanvas.height);\n                ctx.restore();\n                BB.css(this.largeThumbDiv, {\n                    top: (e.clientY - this.largeThumbCanvas.height / 2) + 'px',\n                    opacity: '0',\n                });\n                if (!this.largeThumbInDocument) {\n                    document.body.append(this.largeThumbDiv);\n                    this.largeThumbInDocument = true;\n                }\n                clearTimeout(this.largeThumbInTimeout);\n                this.largeThumbInTimeout = setTimeout(() => {\n                    BB.css(this.largeThumbDiv, {\n                        opacity: '1',\n                    });\n                }, 20);\n                clearTimeout(this.largeThumbTimeout);\n            };\n            layer.thumb.onpointerout = () => {\n                clearTimeout(this.largeThumbInTimeout);\n                BB.css(this.largeThumbDiv, {\n                    opacity: '0',\n                });\n                clearTimeout(this.largeThumbTimeout);\n                this.largeThumbTimeout = setTimeout(() => {\n                    if (!this.largeThumbInDocument) {\n                        return;\n                    }\n                    this.largeThumbDiv.remove();\n                    this.largeThumbInDocument = false;\n                }, 300);\n            };\n\n            container1.append(layer.thumb, layer.label, layer.opacityLabel, opacitySlider.getEl());\n            let dragstart = false;\n            let freshSelection = false;\n\n            //events for moving layers up and down\n            const dragEventHandler = (event: IPointerEvent) => {\n                if (event.type === 'pointerdown' && event.button === 'left') {\n                    BB.css(layer, {\n                        transition: 'box-shadow 0.3s ease-in-out',\n                    });\n                    layer.style.zIndex = '1';\n                    this.lastpos = layer.spot;\n                    freshSelection = false;\n                    if (!layer.isSelected) {\n                        freshSelection = true;\n                        this.activateLayer(layer.spot);\n                    }\n                    dragstart = true;\n\n                } else if (event.type === 'pointermove' && event.button === 'left') {\n\n                    if (dragstart) {\n                        dragstart = false;\n                        BB.css(layer, {\n                            boxShadow: '1px 3px 5px rgba(0,0,0,0.4)',\n                        });\n                    }\n                    layer.posY += event.dY;\n                    const corrected = Math.max(0, Math.min((this.klCanvasLayerArr.length - 1) * (35), layer.posY));\n                    layer.style.top = corrected + 'px';\n                    this.updateLayersVerticalPosition(layer.spot, this.posToSpot(layer.posY));\n\n                }\n                if (event.type === 'pointerup') {\n                    BB.css(layer, {\n                        transition: 'all 0.1s linear',\n                    });\n                    setTimeout(() => {\n                        BB.css(layer, {\n                            boxShadow: '',\n                        });\n                    }, 20);\n                    layer.posY = Math.max(0, Math.min((this.klCanvasLayerArr.length - 1) * (35), layer.posY));\n                    layer.style.zIndex = '';\n                    const newSpot = this.posToSpot(layer.posY);\n                    const oldSpot = layer.spot;\n                    this.move(layer.spot, newSpot);\n                    if (oldSpot != newSpot) {\n                        klHistory.pause(true);\n                        this.onSelect(this.selectedSpotIndex);\n                        klHistory.pause(false);\n                    }\n                    if (oldSpot === newSpot && freshSelection) {\n                        this.onSelect(this.selectedSpotIndex);\n                    }\n                    freshSelection = false;\n                }\n            };\n\n            layer.pointerListener = new BB.PointerListener({\n                target: container1,\n                onPointer: dragEventHandler,\n            });\n\n            this.layerListEl.append(layer);\n        };\n        this.layerElArr = [];\n        while (this.layerListEl.firstChild) {\n            const child = this.layerListEl.firstChild as TLayerEl;\n            child.pointerListener.destroy();\n            child.opacitySlider.destroy();\n            child.remove();\n        }\n        for (let i = 0; i < this.klCanvasLayerArr.length; i++) {\n            createLayerEntry(i);\n        }\n        this.activateLayer(this.selectedSpotIndex);\n        this.updateHeight();\n    }\n\n    private updateButtons (): void {\n        const maxReached = this.klCanvasLayerArr.length === MAX_LAYERS;\n        const oneLayer = this.klCanvasLayerArr.length === 1;\n\n        this.addBtn.disabled = maxReached;\n        this.removeBtn.disabled = oneLayer;\n        this.duplicateBtn.disabled = maxReached;\n        this.mergeBtn.disabled = this.selectedSpotIndex === 0;\n        this.moreDropdown.setEnabled('merge-all', !oneLayer);\n    }\n\n\n    // ---- public ----\n    constructor (\n        klCanvas: KlCanvas,\n        onSelect: (layerIndex: number) => void,\n        parentEl: HTMLElement,\n        uiState: TUiLayout,\n    ) {\n        this.parentEl = parentEl;\n        this.klCanvas = klCanvas;\n        this.layerElArr = [];\n        this.layerHeight = 35;\n        this.layerSpacing = 0;\n        const width = 270;\n        this.onSelect = onSelect;\n        this.uiState = uiState;\n\n        this.largeThumbDiv = BB.el({\n            onClick: BB.handleClick,\n            css: {\n                position: 'absolute',\n                top: '500px',\n                background: '#aaa',\n                boxShadow: '1px 1px 3px rgba(0,0,0,0.3)',\n                pointerEvents: 'none',\n                padding: '0',\n                border: '1px solid #aaa',\n                transition: 'opacity 0.3s ease-out',\n                userSelect: 'none',\n            },\n        });\n        this.setUiState(uiState);\n        BB.createCheckerDataUrl(4, (url) => {\n            this.largeThumbDiv.style.backgroundImage = 'url(' + url + ')';\n        }, theme.isDark());\n        this.largeThumbCanvas = BB.canvas(200, 200);\n        this.largeThumbCanvas.style.display = 'block';\n        this.largeThumbDiv.append(this.largeThumbCanvas);\n        this.largeThumbInDocument = false;\n\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\n        this.selectedSpotIndex = this.klCanvasLayerArr.length - 1;\n        this.rootEl = BB.el({\n            css: {\n                marginRight: '10px',\n                marginBottom: '10px',\n                marginLeft: '10px',\n                marginTop: '10px',\n                cursor: 'default',\n            },\n        });\n\n        const listDiv = BB.el({\n            css: {\n                width: width + 'px',\n                position: 'relative',\n                margin: '0 -10px',\n                zIndex: '0',\n            },\n        });\n\n        this.layerListEl = BB.el({\n            parent: listDiv,\n        });\n\n        this.addBtn = BB.el({tagName: 'button'});\n        this.duplicateBtn = BB.el({tagName: 'button'});\n        this.mergeBtn = BB.el({tagName: 'button'});\n        this.removeBtn = BB.el({tagName: 'button'});\n        const renameBtn = BB.el({tagName: 'button'});\n        this.moreDropdown = new DropdownMenu({\n            button: BB.el({\n                content: `<img src=\"${caretDownImg}\" width=\"13\"/>`,\n                css: {\n                    display: 'flex',\n                    justifyContent: 'center',\n                    opacity: '0.9',\n                },\n            }),\n            buttonTitle: LANG('more'),\n            items: [\n                ['merge-all', LANG('layers-merge-all')],\n            ],\n            onItemClick: (id) => {\n                if (id === 'merge-all') {\n                    const newIndex = this.klCanvas.mergeAll();\n                    if (newIndex === false) {\n                        return;\n                    }\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\n                    this.selectedSpotIndex = newIndex;\n\n                    this.createLayerList();\n                    klHistory.pause(true);\n                    this.onSelect(this.selectedSpotIndex);\n                    klHistory.pause(false);\n\n                    this.updateButtons();\n                }\n            },\n        });\n\n        this.updateButtons();\n\n        const createButtons = () => {\n            const div = BB.el();\n            const async = () => {\n                BB.makeUnfocusable(this.addBtn);\n                BB.makeUnfocusable(this.duplicateBtn);\n                BB.makeUnfocusable(this.mergeBtn);\n                BB.makeUnfocusable(this.removeBtn);\n                BB.makeUnfocusable(renameBtn);\n\n                this.addBtn.style.cssFloat = 'left';\n                this.duplicateBtn.style.cssFloat = 'left';\n                this.mergeBtn.style.cssFloat = 'left';\n                this.removeBtn.style.cssFloat = 'left';\n                renameBtn.style.cssFloat = 'left';\n\n                this.addBtn.title = LANG('layers-new');\n                this.duplicateBtn.title = LANG('layers-duplicate');\n                this.removeBtn.title = LANG('layers-remove');\n                this.mergeBtn.title = LANG('layers-merge');\n                renameBtn.title = LANG('layers-rename-title');\n\n                this.addBtn.style.paddingLeft = '5px';\n                this.addBtn.style.paddingRight = '3px';\n\n                this.removeBtn.style.paddingLeft = '5px';\n                this.removeBtn.style.paddingRight = '3px';\n\n                this.duplicateBtn.style.paddingLeft = '5px';\n                this.duplicateBtn.style.paddingRight = '3px';\n\n                this.mergeBtn.style.paddingLeft = '5px';\n                this.mergeBtn.style.paddingRight = '3px';\n\n                renameBtn.style.height = '30px';\n                renameBtn.style.lineHeight = '20px';\n\n                this.addBtn.innerHTML = \"<img src='\" + addLayerImg + \"' height='20'/>\";\n                this.duplicateBtn.innerHTML = \"<img src='\" + duplicateLayerImg + \"' height='20'/>\";\n                this.mergeBtn.innerHTML = \"<img src='\" + mergeLayerImg + \"' height='20'/>\";\n                this.removeBtn.innerHTML = \"<img src='\" + removeLayerImg + \"' height='20'/>\";\n                renameBtn.innerHTML = \"<img src='\" + renameLayerImg + \"' height='20'/>\";\n                div.append(\n                    c(',flex,gap-5,mb-10', [\n                        this.addBtn,\n                        this.removeBtn,\n                        this.duplicateBtn,\n                        this.mergeBtn,\n                        renameBtn,\n                        c(',grow-1'),\n                        this.moreDropdown.getElement(),\n                    ]),\n                );\n\n                this.addBtn.onclick = () => {\n                    if (this.klCanvas.addLayer(this.selectedSpotIndex) === false) {\n                        return;\n                    }\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\n\n                    this.selectedSpotIndex = this.selectedSpotIndex + 1;\n                    this.createLayerList();\n                    klHistory.pause(true);\n                    this.onSelect(this.selectedSpotIndex);\n                    klHistory.pause(false);\n\n                    this.updateButtons();\n                };\n                this.duplicateBtn.onclick = () => {\n                    if (this.klCanvas.duplicateLayer(this.selectedSpotIndex) === false) {\n                        return;\n                    }\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\n\n                    this.selectedSpotIndex++;\n                    this.createLayerList();\n                    klHistory.pause(true);\n                    this.onSelect(this.selectedSpotIndex);\n                    klHistory.pause(false);\n\n                    this.updateButtons();\n                };\n                this.removeBtn.onclick = () => {\n                    if (this.layerElArr.length <= 1) {\n                        return;\n                    }\n\n                    this.klCanvas.removeLayer(this.selectedSpotIndex);\n                    if (this.selectedSpotIndex > 0) {\n                        this.selectedSpotIndex--;\n                    }\n                    this.klCanvasLayerArr = this.klCanvas.getLayers();\n                    this.createLayerList();\n                    klHistory.pause(true);\n                    this.onSelect(this.selectedSpotIndex);\n                    klHistory.pause(false);\n\n                    this.updateButtons();\n                };\n                this.mergeBtn.onclick = () => {\n                    if (this.selectedSpotIndex <= 0) {\n                        return;\n                    }\n                    mergeLayerDialog(this.parentEl, {\n                        topCanvas: this.klCanvasLayerArr[this.selectedSpotIndex].context.canvas,\n                        bottomCanvas: this.klCanvasLayerArr[this.selectedSpotIndex - 1].context.canvas,\n                        topOpacity: this.klCanvas.getLayer(this.selectedSpotIndex)!.opacity,\n                        mixModeStr: this.klCanvasLayerArr[this.selectedSpotIndex].mixModeStr,\n                        callback: (mode) => {\n                            this.klCanvas.mergeLayers(this.selectedSpotIndex, this.selectedSpotIndex - 1, mode as TMixMode | 'as-alpha');\n                            this.klCanvasLayerArr = this.klCanvas.getLayers();\n                            this.selectedSpotIndex--;\n\n                            this.createLayerList();\n                            klHistory.pause(true);\n                            this.onSelect(this.selectedSpotIndex);\n                            klHistory.pause(false);\n\n                            this.updateButtons();\n                        },\n                    });\n                };\n\n                renameBtn.onclick = () => {\n                    this.renameLayer(this.selectedSpotIndex);\n                };\n            };\n            setTimeout(async, 1);\n            return div;\n        };\n        this.rootEl.append(createButtons());\n\n        let modeWrapper;\n        {\n            modeWrapper = BB.el({\n                content: LANG('layers-blending') + '&nbsp;',\n                css: {\n                    fontSize: '15px',\n                },\n            });\n\n            this.modeSelect = new Select<TMixMode>({\n                optionArr: [\n                    'source-over',\n                    undefined,\n                    'darken',\n                    'multiply',\n                    'color-burn',\n                    undefined,\n                    'lighten',\n                    'screen',\n                    'color-dodge',\n                    undefined,\n                    'overlay',\n                    'soft-light',\n                    'hard-light',\n                    undefined,\n                    'difference',\n                    'exclusion',\n                    undefined,\n                    'hue',\n                    'saturation',\n                    'color',\n                    'luminosity',\n                ].map((item: any) => {\n                    return item ? [item, translateBlending(item)] : undefined;\n                }),\n                onChange: (val) => {\n                    this.klCanvas.setMixMode(this.selectedSpotIndex, val as TMixMode);\n                    this.update(this.selectedSpotIndex);\n                },\n                css: {\n                    marginBottom: '10px',\n                },\n            });\n\n            modeWrapper.append(this.modeSelect.getElement());\n            this.rootEl.append(modeWrapper);\n\n        }\n\n\n        this.rootEl.append(listDiv);\n\n        //updating the thumbs in interval\n        //don't update when: manager not visible || layer didn't change || is drawing\n        setInterval(() => {\n            if (this.rootEl.style.display !== 'block') {\n                return;\n            }\n\n            const historyState = klHistory.getState();\n            if (historyState === this.oldHistoryState) {\n                return;\n            }\n            this.oldHistoryState = historyState;\n\n            for (let i = 0; i < this.layerElArr.length; i++) {\n                if (this.selectedSpotIndex === this.layerElArr[i].spot && this.klCanvasLayerArr[this.layerElArr[i].spot]) { // second check, because might be out of date\n                    const ctx = BB.ctx(this.layerElArr[i].thumb);\n                    ctx.save();\n                    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n                    if (this.klCanvasLayerArr[this.layerElArr[i].spot].context.canvas.width < this.layerElArr[i].thumb.width) {\n                        ctx.imageSmoothingEnabled = false;\n                    }\n                    ctx.drawImage(this.klCanvasLayerArr[this.layerElArr[i].spot].context.canvas, 0, 0, this.layerElArr[i].thumb.width, this.layerElArr[i].thumb.height);\n                    ctx.restore();\n                }\n            }\n\n        }, 1);\n\n        theme.addIsDarkListener(() => {\n            this.createLayerList();\n        });\n\n        this.createLayerList();\n    }\n\n    // ---- interface ----\n    update (activeLayerSpotIndex?: number): void {\n        this.klCanvasLayerArr = this.klCanvas.getLayers();\n        if (activeLayerSpotIndex || activeLayerSpotIndex === 0) {\n            this.selectedSpotIndex = activeLayerSpotIndex;\n        }\n        this.updateButtons();\n        setTimeout(() => this.createLayerList(), 1);\n    }\n\n    getSelected (): number {\n        return this.selectedSpotIndex;\n    }\n\n    activateLayer (spotIndex: number): void {\n        if (spotIndex < 0 || spotIndex > this.layerElArr.length - 1) {\n            throw 'invalid spotIndex ' + spotIndex + ', layerElArr.length ' + this.layerElArr.length;\n        }\n        this.selectedSpotIndex = spotIndex;\n        this.modeSelect.setValue(this.klCanvasLayerArr[this.selectedSpotIndex].mixModeStr);\n        for (let i = 0; i < this.layerElArr.length; i++) {\n            const layer = this.layerElArr[i];\n            const isSelected = this.selectedSpotIndex === layer.spot;\n\n            BB.css(layer, {\n                boxShadow: '',\n            });\n            layer.classList.toggle('kl-layer--selected', isSelected);\n            layer.opacitySlider.setActive(isSelected);\n            layer.isSelected = isSelected;\n        }\n        this.mergeBtn.disabled = this.selectedSpotIndex === 0;\n    }\n\n    setUiState (stateStr: TUiLayout): void {\n        this.uiState = stateStr;\n\n        if (this.uiState === 'left') {\n            BB.css(this.largeThumbDiv, {\n                left: '280px',\n                right: '',\n            });\n        } else {\n            BB.css(this.largeThumbDiv, {\n                left: '',\n                right: '280px',\n            });\n        }\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n}\n","import {BB} from '../../bb/bb';\nimport {floodFillBits} from '../image-operations/flood-fill';\nimport {drawShape} from '../image-operations/shape-tool';\nimport {TRenderTextParam, renderText} from '../image-operations/render-text';\nimport {IGradient, IKlProject, IRGB, IShapeToolObject, TFillSampling, TKlCanvasLayer, TMixMode} from '../kl-types';\nimport {DecoyKlHistory, KlHistoryInterface, THistoryActions} from '../history/kl-history';\nimport {drawProject} from './draw-project';\nimport {LANG} from '../../language/language';\nimport {drawGradient} from '../image-operations/gradient-tool';\nimport {nullToUndefined} from '../../bb/base/base';\n\n\n// TODO remove in 2026\n// workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\n// reported 2021-13 (v96), fixed 2022-02 (v99)\n// affects: source-in, source-out, destination-in, destination-atop\nfunction workaroundForChromium1281185 (ctx: CanvasRenderingContext2D): void {\n    ctx.save();\n    ctx.fillStyle = 'rgba(0,0,0,0.01)';\n    ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\n    ctx.restore();\n}\n\nexport type TKlCanvasHistoryEntry = THistoryActions<'canvas', KlCanvas>;\n\nconst allowedMixModes = [\n    'source-over',\n    'darken',\n    'multiply',\n    'color-burn',\n    'lighten',\n    'screen',\n    'color-dodge',\n    'overlay',\n    'soft-light',\n    'hard-light',\n    'difference',\n    'exclusion',\n    'hue',\n    'saturation',\n    'color',\n    'luminosity',\n] as const;\n\nexport const MAX_LAYERS = 16;\n\nexport interface KlCanvasLayer extends HTMLCanvasElement {\n    name: string;\n    mixModeStr: TMixMode;\n    isVisible: boolean;\n    opacity: number;\n    compositeObj?: {\n        draw: (ctx: CanvasRenderingContext2D) => void;\n    };\n    index: number; // certain brushes need to know\n}\n\nexport type KlCanvasContext = CanvasRenderingContext2D & {\n    canvas: KlCanvasLayer;\n};\n\n/**\n * The image/canvas that the user paints on\n * Has layers. layers have names and opacity.\n *\n * Interacts with the history you specify (for undo/redo)\n */\nexport class KlCanvas {\n\n    // todo changeListener consistent concept\n    // todo history interaction, consistent concept - currently have to look at code to know if something pushes on history\n\n    private isDestroyed = false;\n    private width: number;\n    private height: number;\n    private layerCanvasArr: KlCanvasLayer[];\n    private pickCanvas: HTMLCanvasElement; // canvas to draw into for color picker\n    private history: KlHistoryInterface;\n    private changeListenerArr:  (() => void)[]; // subscribers get notified when opacity changes\n\n\n    private init (w: number, h: number): void {\n        if (!w || !h || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\n            throw new Error('init - invalid canvas size: ' + w + ', ' + h);\n        }\n        this.width = w;\n        this.height = h;\n    }\n\n    private emitChange (): void {\n        // some changes don't get captured by the history - e.g. changing opacity as the user drags the slider\n        this.changeListenerArr.forEach(item => item());\n    }\n\n    private updateIndices (): void {\n        this.layerCanvasArr.forEach((item, index) => {\n            item.index = index;\n        });\n    }\n\n    // ---- public ----\n\n    constructor (\n        params: {\n            projectObj: IKlProject;\n        } | {\n            // creates blank KlCanvas, 0 layers\n            width: number;\n            height: number;\n        } | {\n            copy: KlCanvas;\n        },\n        private layerNrOffset: number = 0,\n    ) {\n        this.layerCanvasArr = [];\n        this.pickCanvas = BB.canvas(1, 1);\n        this.history = new DecoyKlHistory();\n        if ('copy' in params) {\n            this.width = 1;\n            this.height = 1;\n        } else {\n            if ('width' in params && 'height' in params) {\n                this.width = params.width;\n                this.height = params.height;\n            } else {\n                this.width = 1;\n                this.height = 1;\n            }\n        }\n        this.init(this.width, this.height);\n\n        this.changeListenerArr = [];\n\n        if ('copy' in params) {\n            try {\n                this.copy(params.copy);\n            } catch (e) {\n                this.destroy();\n                throw e;\n            }\n        } else if ('projectObj' in params) {\n            const inLayers = [...params.projectObj.layers];\n            this.init(params.projectObj.width, params.projectObj.height);\n\n            if (!inLayers.length) {\n                throw new Error('project.layers needs at least 1 layer');\n            }\n\n            for (let i = 0; i < inLayers.length; i++) {\n                const mixModeStr = inLayers[i].mixModeStr;\n                if (mixModeStr && !allowedMixModes.includes(mixModeStr)) {\n                    throw new Error('unknown mixModeStr ' + inLayers[i].mixModeStr);\n                }\n\n                this.addLayer();\n                this.layerOpacity(i, inLayers[i].opacity);\n                this.layerCanvasArr[i].name = inLayers[i].name;\n                this.layerCanvasArr[i].isVisible = inLayers[i].isVisible;\n                this.layerCanvasArr[i].mixModeStr = mixModeStr || 'source-over';\n                BB.ctx(this.layerCanvasArr[i]).drawImage(inLayers[i].image, 0, 0);\n            }\n        }\n        this.updateIndices();\n    }\n\n    setHistory (h: KlHistoryInterface): void {\n        this.history = h;\n    }\n\n    /**\n     * Resets canvas -> 1 layer, 100% opacity,\n     * unless layers provided.\n     * @param p\n     */\n    reset (\n        p: {\n            width: number;\n            height: number;\n            color?: IRGB; // optional - fill color\n            image?: HTMLImageElement | HTMLCanvasElement; // image drawn on layer\n            layerName?: string; // if via image\n            layers?: {\n                name: string;\n                isVisible: boolean;\n                opacity: number;\n                mixModeStr: TMixMode;\n                image: HTMLCanvasElement;\n            }[];\n        }\n    ): number {\n        if (!p.width || !p.height || p.width < 1 || p.height < 1 || isNaN(p.width) || isNaN(p.height) ) {\n            throw new Error('invalid canvas size');\n        }\n\n        this.history.pause(true);\n\n        this.width = p.width;\n        this.height = p.height;\n\n        this.layerCanvasArr.splice(1, Math.max(0, this.layerCanvasArr.length - 1));\n\n        if (p.layers) {\n            for (let i = 0; i < p.layers.length; i++) {\n                const item = p.layers[i];\n                if (!this.layerCanvasArr[i]) {\n                    this.addLayer();\n                }\n                this.layerCanvasArr[i].name = item.name;\n                this.layerCanvasArr[i].isVisible = item.isVisible;\n                this.layerCanvasArr[i].width = this.width;\n                this.layerCanvasArr[i].height = this.height;\n                this.layerCanvasArr[i].mixModeStr = item.mixModeStr ? item.mixModeStr : 'source-over';\n                BB.ctx(this.layerCanvasArr[i]).drawImage(item.image, 0, 0);\n                this.layerOpacity(i, item.opacity);\n            }\n        } else {\n            this.layerCanvasArr[0].name = p.layerName ? p.layerName : LANG('layers-layer') + ' 1';\n            this.layerCanvasArr[0].isVisible = true;\n            this.layerCanvasArr[0].width = this.width;\n            this.layerCanvasArr[0].height = this.height;\n            this.layerCanvasArr[0].mixModeStr = 'source-over';\n            this.layerOpacity(0, 1);\n            if (p.color) {\n                this.layerFill(0, p.color);\n            } else if (p.image) {\n                BB.ctx(this.layerCanvasArr[0]).drawImage(p.image, 0, 0);\n            }\n        }\n        this.updateIndices();\n\n        this.history.pause(false);\n\n        this.history.push({\n            tool: ['canvas'],\n            action: 'reset',\n            params: [p], // don't modify with p\n        } as TKlCanvasHistoryEntry);\n\n        return this.layerCanvasArr.length - 1;\n    }\n\n    isLayerLimitReached (): boolean {\n        return this.layerCanvasArr.length >= MAX_LAYERS;\n    }\n\n    getWidth (): number {\n        return this.width;\n    }\n\n    getHeight (): number {\n        return this.height;\n    }\n\n    copy (toCopyCanvas: KlCanvas): void {\n        if (\n            toCopyCanvas.getWidth() < 1 ||\n            toCopyCanvas.getHeight() < 1 ||\n            isNaN(toCopyCanvas.getWidth()) ||\n            isNaN(toCopyCanvas.getHeight())\n        ) {\n            throw new Error('invalid canvas size');\n        }\n\n        // keep existing canvases\n\n        const origLayers = toCopyCanvas.getLayers();\n\n        while (this.layerCanvasArr.length > origLayers.length) {\n            this.removeLayer(this.layerCanvasArr.length - 1);\n        }\n\n        if (toCopyCanvas.getWidth() != this.width || toCopyCanvas.getHeight() != this.height) {\n            this.init(toCopyCanvas.getWidth(), toCopyCanvas.getHeight());\n        }\n        for (let i = 0; i < origLayers.length; i++) {\n            if (i >= this.layerCanvasArr.length) {\n                this.addLayer();\n            } else {\n                this.layerCanvasArr[i].width = this.width;\n                this.layerCanvasArr[i].height = this.height;\n            }\n            this.layerOpacity(i, origLayers[i].opacity);\n            this.layerCanvasArr[i].name = origLayers[i].name;\n            this.layerCanvasArr[i].isVisible = origLayers[i].isVisible;\n            this.layerCanvasArr[i].mixModeStr = origLayers[i].mixModeStr;\n            BB.ctx(this.layerCanvasArr[i]).drawImage(origLayers[i].context.canvas, 0, 0);\n        }\n        this.updateIndices();\n    }\n\n    getLayerCount (): number {\n        return this.layerCanvasArr.length;\n    }\n\n    resize (w: number, h: number, algorithm: 'smooth' | 'pixelated' = 'smooth'): boolean {\n        if (!w || !h || (w === this.width && h === this.height) || isNaN(w) || isNaN(h) || w < 1 || h < 1) {\n            return false;\n        }\n        w = Math.max(w, 1);\n        h = Math.max(h, 1);\n\n        let tmp1, tmp2;\n\n        if (algorithm === 'pixelated') {\n            tmp1 = BB.canvas(w, h);\n            const tmp1Ctx = BB.ctx(tmp1);\n            tmp1Ctx.imageSmoothingEnabled = false;\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\n                if (i > 0) {\n                    tmp1Ctx.clearRect(0, 0, w, h);\n                }\n                const layerCanvas = this.layerCanvasArr[i];\n                tmp1Ctx.drawImage(layerCanvas, 0, 0, w, h);\n                layerCanvas.width = w;\n                layerCanvas.height = h;\n                const layerContext = BB.ctx(layerCanvas);\n                layerContext.drawImage(tmp1, 0, 0);\n            }\n\n        } else if (algorithm === 'smooth') {\n            tmp1 = BB.canvas();\n            tmp2 = BB.canvas();\n            for (let i = 0; i < this.layerCanvasArr.length; i++) {\n                BB.resizeCanvas(this.layerCanvasArr[i], w, h, tmp1, tmp2);\n            }\n        } else {\n            throw new Error('unknown resize algorithm');\n        }\n\n        this.width = w;\n        this.height = h;\n        return true;\n    }\n\n    /**\n     * crop / extend\n     * @param p\n     */\n    resizeCanvas (p: {\n        left: number;\n        top: number;\n        right: number;\n        bottom: number;\n        fillColor?: IRGB;\n    }): void {\n\n        const newW = Math.round(p.left) + this.width + Math.round(p.right);\n        const newH = Math.round(p.top) + this.height + Math.round(p.bottom);\n        const offX = Math.round(p.left);\n        const offY = Math.round(p.top);\n\n        if (isNaN(newW) || isNaN(newH) || newW < 1 || newH < 1) {\n            throw new Error('KlCanvas.resizeCanvas - invalid canvas size');\n        }\n\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\n            const ctemp = BB.canvas(this.width, this.height);\n            const layerCanvas = this.layerCanvasArr[i];\n            const layerCtx = BB.ctx(this.layerCanvasArr[i]);\n            BB.ctx(ctemp).drawImage(layerCanvas, 0, 0);\n\n            this.layerCanvasArr[i].width = newW;\n            this.layerCanvasArr[i].height = newH;\n\n            layerCtx.save();\n            if (i === 0 && p.fillColor) {\n                layerCtx.fillStyle = BB.ColorConverter.toRgbStr(p.fillColor);\n                layerCtx.fillRect(0, 0, newW, newH);\n                layerCtx.clearRect(offX, offY, this.width, this.height);\n            }\n            layerCtx.drawImage(ctemp, offX, offY);\n            layerCtx.restore();\n        }\n        this.width = newW;\n        this.height = newH;\n    }\n\n    /**\n     * will be inserted on top of selected\n     * @param selected\n     */\n    addLayer (selected?: number): false | number {\n        if (this.isLayerLimitReached()) {\n            return false;\n        }\n        const canvas = BB.canvas(this.width, this.height) as KlCanvasLayer;\n        if (!canvas.getContext('2d')) {\n            throw new Error('kl-create-canvas-error');\n        }\n\n        canvas.isVisible = true;\n        canvas.mixModeStr = 'source-over';\n\n        if (selected === undefined) {\n            this.layerCanvasArr[this.layerCanvasArr.length] = canvas;\n            selected = Math.max(0, this.layerCanvasArr.length - 1);\n        } else {\n            this.layerCanvasArr.splice(selected + 1, 0, canvas);\n            selected++;\n        }\n\n        canvas.name = LANG('layers-layer') + ' ' + (this.layerCanvasArr.length + this.layerNrOffset);\n        this.history.pause(true);\n        this.layerOpacity(selected, 1);\n        this.history.pause(false);\n        this.updateIndices();\n        this.history.push({\n            tool: ['canvas'],\n            action: 'addLayer',\n            params: [selected - 1],\n        } as TKlCanvasHistoryEntry);\n        return selected;\n    }\n\n    duplicateLayer (i: number): false | number {\n        if (!this.layerCanvasArr[i] || this.isLayerLimitReached()) {\n            return false;\n        }\n        const canvas = BB.canvas(this.width, this.height) as KlCanvasLayer;\n        this.layerCanvasArr.splice(i + 1, 0, canvas);\n\n        canvas.name = this.layerCanvasArr[i].name + ' ' + LANG('layers-copy');\n        canvas.isVisible = this.layerCanvasArr[i].isVisible;\n        canvas.mixModeStr = this.layerCanvasArr[i].mixModeStr;\n        // 2023-04-30 workaround for https://bugs.webkit.org/show_bug.cgi?id=256151\n        // todo replace with simple drawImage eventually when fixed\n        BB.ctx(canvas).putImageData(BB.ctx(this.layerCanvasArr[i]).getImageData(0, 0, this.width, this.height), 0, 0);\n        this.history.pause(true);\n        this.layerOpacity(i + 1, this.layerCanvasArr[i].opacity);\n        this.history.pause(false);\n\n        this.updateIndices();\n\n        this.history.push({\n            tool: ['canvas'],\n            action: 'duplicateLayer',\n            params: [i],\n        } as TKlCanvasHistoryEntry);\n        return i + 1;\n    }\n\n    getLayerContext (i: number, doReturnNull?: boolean): CanvasRenderingContext2D | null {\n        if (this.layerCanvasArr[i]) {\n            return BB.ctx(this.layerCanvasArr[i]);\n        }\n        if (doReturnNull) {\n            return null;\n        }\n        throw new Error('layer of index ' + i + ' not found (in ' + this.layerCanvasArr.length + ' layers)');\n    }\n\n    removeLayer (i: number): false | number {\n        if (this.layerCanvasArr[i]) {\n            this.layerCanvasArr.splice(i, 1);\n            this.updateIndices();\n        } else {\n            return false;\n        }\n        this.history.push({\n            tool: ['canvas'],\n            action: 'removeLayer',\n            params: [i],\n        } as TKlCanvasHistoryEntry);\n\n        return Math.max(0, i - 1);\n    }\n\n    renameLayer (i: number, name: string): boolean {\n        if (this.layerCanvasArr[i]) {\n            this.layerCanvasArr[i].name = name;\n        } else {\n            return false;\n        }\n\n        this.history.push({\n            tool: ['canvas'],\n            action: 'renameLayer',\n            params: [i, name],\n        } as TKlCanvasHistoryEntry);\n\n        return true;\n    }\n\n    layerOpacity (layerIndex: number, opacity: number): void {\n        if (!this.layerCanvasArr[layerIndex]) {\n            return;\n        }\n        opacity = Math.max(0, Math.min(1, opacity));\n        this.layerCanvasArr[layerIndex].opacity = opacity;\n\n        this.history.push({\n            tool: ['canvas'],\n            action: 'layerOpacity',\n            params: [layerIndex, opacity],\n        } as TKlCanvasHistoryEntry);\n\n        this.emitChange();\n    }\n\n    setLayerIsVisible (layerIndex: number, isVisible: boolean): void {\n        if (this.layerCanvasArr[layerIndex]) {\n            this.layerCanvasArr[layerIndex].isVisible = isVisible;\n        } else {\n            throw new Error(`layer ${layerIndex} undefined`);\n        }\n\n        this.history.push({\n            tool: ['canvas'],\n            action: 'setLayerIsVisible',\n            params: [layerIndex, isVisible],\n        } as TKlCanvasHistoryEntry);\n    }\n\n    moveLayer (i: number, d: number): void | number {\n        if (d === 0) {\n            return;\n        }\n        if (this.layerCanvasArr[i]) {\n            const temp = this.layerCanvasArr[i];\n            this.layerCanvasArr.splice(i, 1);\n            const targetIndex = Math.max(0, Math.min(i + d, this.layerCanvasArr.length));\n            this.layerCanvasArr.splice(targetIndex, 0, temp);\n            this.updateIndices();\n            this.history.push({\n                tool: ['canvas'],\n                action: 'moveLayer',\n                params: [i, d],\n            } as TKlCanvasHistoryEntry);\n            return targetIndex;\n        }\n    }\n\n    mergeLayers (layerBottomIndex: number, layerTopIndex: number, mixModeStr: TMixMode | 'as-alpha'): void | number {\n        if (\n            !this.layerCanvasArr[layerBottomIndex] ||\n            !this.layerCanvasArr[layerTopIndex] ||\n            layerBottomIndex === layerTopIndex\n        ) {\n            return;\n        }\n        //order messed up\n        if (layerBottomIndex > layerTopIndex) {\n            const temp = layerBottomIndex;\n            layerBottomIndex = layerTopIndex;\n            layerTopIndex = temp;\n        }\n\n        const topOpacity = this.layerCanvasArr[layerTopIndex].opacity;\n        if (topOpacity !== 0 && topOpacity) {\n            const ctx = BB.ctx(this.layerCanvasArr[layerBottomIndex]);\n            ctx.save();\n\n            if (mixModeStr === 'as-alpha') { // todo remove this?\n\n                BB.convertToAlphaChannelCanvas(this.layerCanvasArr[layerTopIndex]);\n                ctx.globalCompositeOperation = 'destination-in';\n                ctx.globalAlpha = topOpacity;\n                BB.ctx(this.layerCanvasArr[layerBottomIndex]).drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\n\n            } else {\n\n                if (mixModeStr) {\n                    ctx.globalCompositeOperation = mixModeStr;\n                }\n                ctx.globalAlpha = topOpacity;\n                BB.ctx(this.layerCanvasArr[layerBottomIndex]).drawImage(this.layerCanvasArr[layerTopIndex], 0, 0);\n\n            }\n\n            ctx.restore();\n\n            mixModeStr && workaroundForChromium1281185(ctx);\n        }\n        this.updateIndices();\n        this.history.pause(true);\n        this.removeLayer(layerTopIndex);\n        this.history.pause(false);\n        this.history.push({\n            tool: ['canvas'],\n            action: 'mergeLayers',\n            params: [layerBottomIndex, layerTopIndex, mixModeStr],\n        } as TKlCanvasHistoryEntry);\n\n        return layerBottomIndex;\n    }\n\n    mergeAll (): number | false {\n        if (this.layerCanvasArr.length === 1) {\n            return false;\n        }\n\n        // draw all on bottom layer\n        const ctx = BB.ctx(this.layerCanvasArr[0]);\n        for (let i = 1; i < this.layerCanvasArr.length; i++) {\n            const current = this.layerCanvasArr[i];\n            if (!current.isVisible || current.opacity === 0) {\n                continue;\n            }\n\n            ctx.save();\n            ctx.globalCompositeOperation = current.mixModeStr;\n            ctx.globalAlpha = current.opacity;\n            ctx.drawImage(current, 0, 0);\n            ctx.restore();\n        }\n\n        this.history.pause(true);\n\n        // remove upper layers\n        for (let i = this.layerCanvasArr.length - 1; i > 0; i--) {\n            this.removeLayer(i);\n        }\n\n        // rename first layer to \"layer 1\"\n        this.renameLayer(0, LANG('layers-layer') + ' 1');\n\n        this.history.pause(false);\n\n        this.history.push({\n            tool: ['canvas'],\n            action: 'mergeAll',\n            params: [],\n        } as TKlCanvasHistoryEntry);\n\n        return 0;\n    }\n\n    rotate (deg: number): void {\n        while (deg < 0) {\n            deg += 360;\n        }\n        deg %= 360;\n        if (deg % 90 != 0 || deg === 0) {\n            return;\n        }\n        const temp = BB.canvas();\n        if (deg === 0 || deg === 180) {\n            temp.width = this.width;\n            temp.height = this.height;\n        } else if (deg === 90 || deg === 270) {\n            temp.width = (this.height);\n            temp.height = (this.width);\n        }\n        const ctx = BB.ctx(temp);\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\n            ctx.clearRect(0, 0, temp.width, temp.height);\n            ctx.save();\n            ctx.translate(temp.width / 2, temp.height / 2);\n            ctx.rotate(deg * Math.PI / 180);\n            if (deg === 180) {\n                ctx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\n            } else if (deg === 90 || deg === 270) {\n                ctx.drawImage(this.layerCanvasArr[i], -temp.height / 2, -temp.width / 2);\n            }\n            this.layerCanvasArr[i].width = temp.width;\n            this.layerCanvasArr[i].height = temp.height;\n            BB.ctx(this.layerCanvasArr[i]).clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\n            BB.ctx(this.layerCanvasArr[i]).drawImage(temp, 0, 0);\n            ctx.restore();\n        }\n        this.width = temp.width;\n        this.height = temp.height;\n    }\n\n    flip (isHorizontal: boolean, isVertical: boolean, layerIndex?: number): void {\n        if (!isHorizontal && !isVertical) {\n            return;\n        }\n\n        const temp = BB.canvas(this.width, this.height);\n        temp.width = this.width;\n        temp.height = this.height;\n        const tempCtx = BB.ctx(temp);\n\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\n\n            if ( (layerIndex || layerIndex === 0) && i !== layerIndex) {\n                continue;\n            }\n\n            tempCtx.save();\n            tempCtx.clearRect(0, 0, temp.width, temp.height);\n            tempCtx.translate(temp.width / 2, temp.height / 2);\n            tempCtx.scale((isHorizontal ? -1 : 1), (isVertical ? -1 : 1));\n            tempCtx.drawImage(this.layerCanvasArr[i], -temp.width / 2, -temp.height / 2);\n            tempCtx.restore();\n\n            BB.ctx(this.layerCanvasArr[i]).clearRect(0, 0, this.layerCanvasArr[i].width, this.layerCanvasArr[i].height);\n            BB.ctx(this.layerCanvasArr[i]).drawImage(temp, 0, 0);\n        }\n    }\n\n    layerFill (layerIndex: number, colorObj: IRGB, compositeOperation?: string): void {\n        const ctx = BB.ctx(this.layerCanvasArr[layerIndex]);\n        ctx.save();\n        if (compositeOperation) {\n            ctx.globalCompositeOperation = compositeOperation as GlobalCompositeOperation;\n        }\n        ctx.fillStyle = 'rgba(' + colorObj.r + ',' + colorObj.g + ',' + colorObj.b + ',1)';\n        ctx.fillRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\n        ctx.restore();\n\n        // workaround for chrome bug https://bugs.chromium.org/p/chromium/issues/detail?id=1281185\n        // TODO remove if chrome updated\n        ctx.save();\n        ctx.fillStyle = 'rgba(0,0,0,0.01)';\n        ctx.fillRect(-0.9999999, -0.9999999, 1, 1);\n        ctx.restore();\n\n        /*if (!document.getElementById('testocanvas')) {\n            layerCanvasArr[layerIndex].id = 'testocanvas';\n            document.body.append(layerCanvasArr[layerIndex]);\n            BB.css(layerCanvasArr[layerIndex], {\n                position: 'fixed',\n                left: '0',\n                top: '0',\n                zIndex: '1111111',\n                transform: 'scale(0.2)',\n                border: '10px solid red',\n            });\n        }\n        if (!document.getElementById('testocanvas')) {\n            let c = document.createElement('canvas');\n            c.width = 1000;\n            c.height = 1000;\n            let ctx2 = c.getContext('2d');\n            ctx2.drawImage(layerCanvasArr[layerIndex], 0, 0);\n            c.id = 'testocanvas';\n            document.body.append(c);\n            BB.css(c, {\n                position: 'fixed',\n                left: '0',\n                top: '0',\n                zIndex: '1111111',\n                transform: 'scale(0.2)',\n                border: '10px solid red',\n            });\n        }*/\n\n        this.history.push({\n            tool: ['canvas'],\n            action: 'layerFill',\n            params: [layerIndex, colorObj, compositeOperation],\n        } as TKlCanvasHistoryEntry);\n    }\n\n    floodFill (\n        layerIndex: number, // index of layer to be filled\n        x: number, // starting point\n        y: number,\n        rgb: IRGB | null, // fill color, if null -> erase\n        opacity: number,\n        tolerance: number,\n        sampleStr: TFillSampling,\n        grow: number, // int >= 0 - radius around filled area that is to be filled too\n        isContiguous: boolean,\n    ): void {\n        if (x < 0 || y < 0 || x >= this.width || y >= this.height || opacity === 0) {\n            return;\n        }\n        tolerance = Math.round(tolerance);\n\n        if (!(['above', 'current', 'all'].includes(sampleStr))) {\n            throw new Error('invalid sampleStr');\n        }\n\n        let result;\n        let targetCtx;\n        let targetImageData;\n\n        if (sampleStr === 'all') {\n\n            const srcCanvas = this.layerCanvasArr.length === 1 ? this.layerCanvasArr[0] : this.getCompleteCanvas(1);\n            const srcCtx = BB.ctx(srcCanvas);\n            const srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\n            const srcData = srcImageData.data;\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\n\n            targetCtx = BB.ctx(this.layerCanvasArr[layerIndex]);\n            targetImageData = targetCtx.getImageData(0, 0, this.width, this.height);\n\n        } else {\n            const srcIndex = sampleStr === 'above' ? layerIndex + 1 : layerIndex;\n\n            if (srcIndex >= this.layerCanvasArr.length) {\n                return;\n            }\n\n            const srcCtx = BB.ctx(this.layerCanvasArr[srcIndex]);\n            const srcImageData = srcCtx.getImageData(0, 0, this.width, this.height);\n            const srcData = srcImageData.data;\n            result = floodFillBits(srcData, this.width, this.height, x, y, tolerance, Math.round(grow), isContiguous);\n\n            targetCtx = layerIndex === srcIndex ? srcCtx : BB.ctx(this.layerCanvasArr[layerIndex]);\n            targetImageData = layerIndex === srcIndex ? srcImageData : targetCtx.getImageData(0, 0, this.width, this.height);\n\n        }\n\n        const targetData = targetImageData.data;\n        if (rgb) {\n            if (opacity === 1) {\n                for (let i = 0; i < this.width * this.height; i++) {\n                    if (result.data[i] === 255) {\n                        targetData[i * 4] = rgb.r;\n                        targetData[i * 4 + 1] = rgb.g;\n                        targetData[i * 4 + 2] = rgb.b;\n                        targetData[i * 4 + 3] = 255;\n                    }\n                }\n            } else {\n                for (let i = 0; i < this.width * this.height; i++) {\n                    if (result.data[i] === 255) {\n                        targetData[i * 4] = BB.mix(targetData[i * 4], rgb.r, opacity);\n                        targetData[i * 4 + 1] = BB.mix(targetData[i * 4 + 1], rgb.g, opacity);\n                        targetData[i * 4 + 2] = BB.mix(targetData[i * 4 + 2], rgb.b, opacity);\n                        targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 255, opacity);\n                    }\n                }\n            }\n        } else { // erase\n            if (opacity === 1) {\n                for (let i = 0; i < this.width * this.height; i++) {\n                    if (result.data[i] === 255) {\n                        targetData[i * 4 + 3] = 0;\n                    }\n                }\n            } else {\n                for (let i = 0; i < this.width * this.height; i++) {\n                    if (result.data[i] === 255) {\n                        targetData[i * 4 + 3] = BB.mix(targetData[i * 4 + 3], 0, opacity);\n                    }\n                }\n            }\n        }\n        targetCtx.putImageData(targetImageData, 0, 0);\n\n\n        this.history.push({\n            tool: ['canvas'],\n            action: 'replaceLayer',\n            params: [layerIndex, targetImageData],\n        } as TKlCanvasHistoryEntry);\n    }\n\n    /**\n     * draw shape via BB.drawShape\n     * @param layerIndex\n     * @param shapeObj\n     */\n    drawShape (layerIndex: number, shapeObj: IShapeToolObject): void {\n        if (shapeObj.x1 === shapeObj.x2 && shapeObj.y1 === shapeObj.y2) {\n            return;\n        }\n        drawShape(BB.ctx(this.layerCanvasArr[layerIndex]), shapeObj);\n        this.history.push({\n            tool: ['canvas'],\n            action: 'drawShape',\n            params: [layerIndex, BB.copyObj(shapeObj)],\n        } as TKlCanvasHistoryEntry);\n    }\n\n    drawGradient (layerIndex: number, gradientObj: IGradient): void {\n        drawGradient(BB.ctx(this.layerCanvasArr[layerIndex]), gradientObj);\n        this.history.push({\n            tool: ['canvas'],\n            action: 'drawGradient',\n            params: [layerIndex, BB.copyObj(gradientObj)],\n        } as TKlCanvasHistoryEntry);\n    }\n\n    text (layerIndex: number, p: TRenderTextParam): void {\n        renderText(this.layerCanvasArr[layerIndex], BB.copyObj(p));\n        this.history.push({\n            tool: ['canvas'],\n            action: 'text',\n            params: [layerIndex, BB.copyObj(p)],\n        } as TKlCanvasHistoryEntry);\n    }\n\n    replaceLayer (layerIndex: number, imageData: ImageData): void {\n        const ctx = BB.ctx(this.layerCanvasArr[layerIndex]);\n        ctx.putImageData(imageData, 0, 0);\n        this.history.push({\n            tool: ['canvas'],\n            action: 'replaceLayer',\n            params: [layerIndex, imageData],\n        } as TKlCanvasHistoryEntry);\n    }\n\n    clearLayer (layerIndex: number): void {\n        const ctx = BB.ctx(this.layerCanvasArr[layerIndex]);\n        ctx.save();\n        ctx.clearRect(0, 0, this.layerCanvasArr[layerIndex].width, this.layerCanvasArr[layerIndex].height);\n        ctx.restore();\n\n        this.history.push({\n            tool: ['canvas'],\n            action: 'clearLayer',\n            params: [layerIndex],\n        } as TKlCanvasHistoryEntry);\n    }\n\n    getLayers (): {\n        context: CanvasRenderingContext2D;\n        isVisible: boolean;\n        opacity: number;\n        name: string;\n        mixModeStr: TMixMode;\n    }[] {\n        return this.layerCanvasArr.map(item => {\n            return {\n                context: BB.ctx(item),\n                isVisible: item.isVisible,\n                opacity: item.opacity,\n                name: item.name,\n                mixModeStr: item.mixModeStr,\n            };\n        });\n    }\n\n    getLayersFast (): {\n        canvas: KlCanvasLayer;\n        isVisible: boolean;\n        opacity: number;\n        name: string;\n        mixModeStr: TMixMode;\n    }[] {\n        return this.layerCanvasArr.map(item => {\n            return {\n                canvas: item,\n                isVisible: item.isVisible,\n                opacity: item.opacity,\n                name: item.name,\n                mixModeStr: item.mixModeStr,\n            };\n        });\n    }\n\n    getLayerIndex (canvasObj: HTMLCanvasElement, doReturnNull?: boolean): null | number {\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\n            if (this.layerCanvasArr[i] === canvasObj) {\n                return i;\n            }\n        }\n        if (!doReturnNull) {\n            throw new Error('layer not found (in ' + this.layerCanvasArr.length + ' layers)');\n        }\n        return null;\n    }\n\n    getLayer (index: number, doReturnNull?: boolean): null | TKlCanvasLayer {\n        if (this.layerCanvasArr[index]) {\n            return {\n                context: BB.ctx(this.layerCanvasArr[index]),\n                isVisible: this.layerCanvasArr[index].isVisible,\n                opacity: this.layerCanvasArr[index].opacity,\n                name: this.layerCanvasArr[index].name,\n                id: index,\n            };\n        }\n        if (!doReturnNull) {\n            throw new Error('layer of index ' + index + ' not found (in ' + this.layerCanvasArr.length + ' layers)');\n        }\n        return null;\n    }\n\n    getColorAt (x: number, y: number): IRGB {\n        x = Math.floor(x);\n        y = Math.floor(y);\n        const ctx = BB.ctx(this.pickCanvas);\n        ctx.save();\n        ctx.imageSmoothingEnabled = false;\n        ctx.clearRect(0, 0, 1, 1);\n        for (let i = 0; i < this.layerCanvasArr.length; i++) {\n            const layer = this.layerCanvasArr[i];\n            if (!layer.isVisible || layer.opacity === 0) {\n                continue;\n            }\n            ctx.globalAlpha = layer.opacity;\n            ctx.globalCompositeOperation = layer.mixModeStr;\n            ctx.drawImage(layer, -x, -y);\n        }\n        ctx.restore();\n        const imData = ctx.getImageData(0, 0, 1, 1);\n        return new BB.RGB(imData.data[0], imData.data[1], imData.data[2]);\n    }\n\n    getCompleteCanvas (factor: number): HTMLCanvasElement {\n        return drawProject(this.getProject(), factor);\n    }\n\n    getProject (): IKlProject {\n        return {\n            width: this.width,\n            height: this.height,\n            layers: this.layerCanvasArr.map(layer => {\n                return {\n                    name: layer.name,\n                    isVisible: layer.isVisible,\n                    opacity: layer.opacity,\n                    mixModeStr: layer.mixModeStr,\n                    image: layer,\n                };\n            }),\n        };\n    }\n\n    addChangeListener (func: () => void): void {\n        if (this.changeListenerArr.includes(func)) {\n            return;\n        }\n        this.changeListenerArr.push(func);\n    }\n\n    removeChangeListener (func: () => void): void {\n        for (let i = 0; i < this.changeListenerArr.length; i++) {\n            if (this.changeListenerArr[i] === func) {\n                this.changeListenerArr.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    setMixMode (layerIndex: number, mixModeStr: TMixMode): void {\n        if (!this.layerCanvasArr[layerIndex]) {\n            throw new Error('invalid layer');\n        }\n        this.layerCanvasArr[layerIndex].mixModeStr = mixModeStr;\n\n        this.history.push({\n            tool: ['canvas'],\n            action: 'setMixMode',\n            params: [layerIndex, '' + mixModeStr],\n        } as TKlCanvasHistoryEntry);\n    }\n\n    /**\n     * Set composite drawing step for KlCanvasWorkspace.\n     * To apply temporary manipulations to a layer.\n     *\n     * @param layerIndex\n     * @param compositeObj\n     */\n    setComposite (\n        layerIndex: number,\n        compositeObj: null | {\n            draw: (ctx: CanvasRenderingContext2D) => void;\n        }\n    ): void {\n        if (!this.layerCanvasArr[layerIndex]) {\n            throw new Error('invalid layer');\n        }\n        this.layerCanvasArr[layerIndex].compositeObj = nullToUndefined(compositeObj);\n    }\n\n    destroy (): void {\n        if (this.isDestroyed) {\n            return;\n        }\n        this.layerCanvasArr.forEach(canvas => {\n            BB.freeCanvas(canvas);\n        });\n        this.layerCanvasArr = [];\n        this.isDestroyed = true;\n    }\n\n}\n","\n/**\n * Flood fill. Tried https://github.com/binarymax/floodfill.js/, but it implemented tolerance wrong, and had bugs.\n * So, my own implementation. can handle tolerance, grow, opacity.\n * Needs to be optimized.\n */\n\n/**\n * Set values in data within rect to 254, unless they're 255\n *\n * @param data Uint8Array\n * @param width int\n * @param x0 int\n * @param y0 int\n * @param x1 int >x0\n * @param y1 int >y0\n */\nfunction fillRect (data: Uint8Array, width: number, x0: number, y0: number, x1: number, y1: number): void {\n    for (let x = x0; x <= x1; x++) {\n        for (let y = y0; y <= y1; y++) {\n            if (data[y * width + x] === 255) {\n                continue;\n            }\n            data[y * width + x] = 254;\n        }\n    }\n}\n\nlet mx, my;\n\n/**\n * Get index i moved by dX, dY. in array with dimensions width height.\n * Returns null if outside bounds.\n *\n * @param width int\n * @param height int\n * @param i int\n * @param dX int\n * @param dY int\n */\nfunction moveIndex (width: number, height: number, i: number, dX: number, dY: number): (undefined | number) {\n    mx = i % width + dX;\n    my = Math.floor(i / width) + dY;\n\n    if (mx < 0 || my < 0 || mx >= width || my >= height) {\n        return undefined;\n    }\n\n    return my * width + mx;\n}\n\n/**\n * If pixel can be filled (within tolerance) will be set 255 and returns true.\n * returns false if already filled, or i is null\n *\n * @param srcArr Uint8ClampedArray rgba\n * @param targetArr Uint8Array\n * @param width int\n * @param height int\n * @param initRgba rgba\n * @param tolerance int 0 - 255\n * @param i int - srcArr index\n * @returns {boolean}\n */\nfunction testAndFill (\n    srcArr: Uint8ClampedArray,\n    targetArr: Uint8Array,\n    width: number,\n    height: number,\n    initRgba: [number, number, number, number],\n    tolerance: number,\n    i: number | undefined,\n): boolean {\n    if (i === undefined || targetArr[i] === 255) {\n        return false;\n    }\n\n    if (\n        srcArr[i * 4] === initRgba[0] &&\n        srcArr[i * 4 + 1] === initRgba[1] &&\n        srcArr[i * 4 + 2] === initRgba[2] &&\n        srcArr[i * 4 + 3] === initRgba[3]\n    ) {\n        targetArr[i] = 255;\n        return true;\n    }\n\n    if (\n        tolerance > 0 &&\n        Math.abs(srcArr[i * 4] - initRgba[0]) <= tolerance &&\n        Math.abs(srcArr[i * 4 + 1] - initRgba[1]) <= tolerance &&\n        Math.abs(srcArr[i * 4 + 2] - initRgba[2]) <= tolerance &&\n        Math.abs(srcArr[i * 4 + 3] - initRgba[3]) <= tolerance\n    ) {\n        targetArr[i] = 255;\n        return true;\n    }\n\n    return false;\n}\n\n\n/**\n *\n * @param srcArr Uint8ClampedArray rgba\n * @param targetArr Uint8Array\n * @param width int\n * @param height int\n * @param px int\n * @param py int\n * @param tolerance int 0 - 255\n * @param grow int >= 0\n * @param isContiguous boolean\n */\nfunction floodFill (\n    srcArr: Uint8ClampedArray,\n    targetArr: Uint8Array,\n    width: number,\n    height: number,\n    px: number,\n    py: number,\n    tolerance: number,\n    grow: number,\n    isContiguous: boolean,\n): void {\n\n    const initRgba: [number, number, number, number] = [\n        srcArr[(py * width + px) * 4],\n        srcArr[(py * width + px) * 4 + 1],\n        srcArr[(py * width + px) * 4 + 2],\n        srcArr[(py * width + px) * 4 + 3],\n    ];\n\n    if (isContiguous) {\n        const q: number[] = [];\n        q.push(py * width + px);\n        targetArr[py * width + px] = 255;\n\n        let i: number, e: number | undefined;\n        while (q.length) {\n            i = q.pop() as number; // a test would slow down the code\n\n            // queue up unfilled neighbors\n            e = moveIndex(width, height, i, -1, 0); // left\n            // test will return false if e is undefined -> only numbers will be pushed to q\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\n\n            e = moveIndex(width, height, i, 1, 0); // right\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\n\n            e = moveIndex(width, height, i, 0, -1); // up\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\n\n            e = moveIndex(width, height, i, 0, 1); // bottom\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, e) && q.push(e as number);\n        }\n    } else {\n        for (let i = 0; i < width * height; i++) {\n            testAndFill(srcArr, targetArr, width, height, initRgba, tolerance, i);\n        }\n    }\n\n    // grow\n    if (grow === 0) {\n        return;\n    }\n\n    // how does it grow? it finds all pixel at the edge.\n    // then depending on what kind of edge it is, it draws a rectangle into target\n    // the rectangle has the value 254, or else it will mess it all up.\n    // after it's all done, replaces it with 255\n    let x0, x1, y0, y1;\n    let l, tl, t, tr, r, br, b, bl; // left, top left, top, top right, etc.\n    for (let x = 0; x < width; x++) {\n        for (let y = 0; y < height; y++) {\n            if (targetArr[y * width + x] !== 255) {\n                continue;\n            }\n\n            // bounds of rectangle\n            x0 = x;\n            x1 = x;\n            y0 = y;\n            y1 = y;\n\n            l = targetArr[(y) * width + x - 1] !== 255;\n            tl = targetArr[(y - 1) * width + x - 1] !== 255;\n            t = targetArr[(y - 1) * width + x] !== 255;\n            tr = targetArr[(y - 1) * width + x + 1] !== 255;\n            r = targetArr[(y) * width + x + 1] !== 255;\n            br = targetArr[(y + 1) * width + x + 1] !== 255;\n            b = targetArr[(y + 1) * width + x] !== 255;\n            bl = targetArr[(y + 1) * width + x - 1] !== 255;\n\n            if (l) { // left\n                x0 = x - grow;\n            }\n            if (l && tl && t) { // top left\n                x0 = x - grow;\n                y0 = y - grow;\n            }\n            if (t) { // top\n                y0 = Math.min(y0, y - grow);\n            }\n            if (t && tr && r) { // top right\n                y0 = Math.min(y0, y - grow);\n                x1 = x + grow;\n            }\n            if (r) { // right\n                x1 = Math.max(x1, x + grow);\n            }\n            if (r && br && b) { // bottom right\n                x1 = Math.max(x1, x + grow);\n                y1 = Math.max(y1, y + grow);\n            }\n            if (b) { // bottom\n                y1 = Math.max(y1, y + grow);\n            }\n            if (b && bl && l) { // bottom left\n                x0 = Math.min(x0, x - grow);\n                y1 = Math.max(y1, y + grow);\n            }\n\n            if (!l && !tl && !t && !tr && !r && !br && !b && !bl) {\n                continue;\n            }\n\n            fillRect(\n                targetArr,\n                width,\n                Math.max(0, x0),\n                Math.max(0, y0),\n                Math.min(width - 1, x1),\n                Math.min(height - 1, y1)\n            );\n        }\n    }\n    for (let i = 0; i < width * height; i++) {\n        if (targetArr[i] === 254) {\n            targetArr[i] = 255;\n        }\n    }\n\n}\n\n\n/**\n * Does flood fill, and returns that. an array - 0 not filled. 255 filled\n\n * @param rgbaArr Uint8ClampedArray rgba\n * @param width int\n * @param height int\n * @param x int\n * @param y int\n * @param tolerance int 0 - 255\n * @param grow int >= 0\n * @param isContiguous boolean\n */\nexport function floodFillBits (\n    rgbaArr: Uint8ClampedArray,\n    width: number,\n    height: number,\n    x: number,\n    y: number,\n    tolerance: number,\n    grow: number,\n    isContiguous: boolean,\n): {\n    data: Uint8Array;\n} {\n    x = Math.round(x);\n    y = Math.round(y);\n\n    const resultArr = new Uint8Array(new ArrayBuffer(width * height));\n\n    floodFill(rgbaArr, resultArr, width, height, x, y, tolerance, grow, isContiguous);\n\n    return {\n        data: resultArr,\n    };\n}\n","import {BB} from '../../bb/bb';\nimport {IRGB, IShapeToolObject} from '../kl-types';\n\n/**\n * Input processor for shape tool.\n * Coordinates are in canvas space.\n * angleRad is the angle of the canvas.\n */\nexport class ShapeTool {\n\n    private readonly onShape: (isDone: boolean, x1: number, y1: number, x2: number, y2: number, angleRad: number) => void;\n    private downX: number = 0;\n    private downY: number = 0;\n    private downAngleRad: number = 0;\n\n    // ---- public ----\n    constructor (\n        p: {\n            onShape: (isDone: boolean, x1: number, y1: number, x2: number, y2: number, angleRad: number) => void;\n        }\n    ) {\n        this.onShape = p.onShape;\n    }\n\n    onDown (x: number, y: number, angleRad: number): void {\n        this.downX = x;\n        this.downY = y;\n        this.downAngleRad = angleRad;\n    }\n\n    onMove (x: number, y: number): void {\n        this.onShape(false, this.downX, this.downY, x, y, this.downAngleRad);\n    }\n\n    onUp (x: number, y: number): void {\n        this.onShape(true, this.downX, this.downY, x, y, this.downAngleRad);\n    }\n}\n\n/**\n * Draw a shape (rectangle, ellipse, line)\n */\nexport function drawShape (\n    ctx: CanvasRenderingContext2D,\n    shapeObj: IShapeToolObject,\n): void {\n    shapeObj = {\n        // defaults\n        angleRad: 0,\n        isOutwards: false,\n        opacity: 1,\n        isEraser: false,\n        doLockAlpha: false,\n\n        ...BB.copyObj(shapeObj),\n    };\n\n    if (['rect', 'ellipse', 'line'].includes(shapeObj.type)) {\n        if (shapeObj.angleRad === undefined) {\n            throw new Error('angleRad undefined');\n        }\n\n        const lineWidth = shapeObj.lineWidth === undefined ? -1 : Math.round(shapeObj.lineWidth);\n        const angleDeg = shapeObj.angleRad * 180 / Math.PI;\n\n        // --- prep color ---\n        if (!shapeObj.isEraser && shapeObj.fillRgb === undefined && shapeObj.strokeRgb === undefined) {\n            throw new Error('fillRgb and strokeRgb undefined');\n        }\n        const colorRGB: IRGB = shapeObj.isEraser ? {r: 255, g: 255, b: 255} : (shapeObj.fillRgb ? shapeObj.fillRgb : shapeObj.strokeRgb!);\n\n\n        // --- prep canvas ---\n        ctx.save();\n        if (shapeObj.opacity) {\n            ctx.globalAlpha = shapeObj.opacity;\n        }\n        if (shapeObj.isEraser) {\n            ctx.globalCompositeOperation = 'destination-out';\n        }\n        if (shapeObj.doLockAlpha) {\n            ctx.globalCompositeOperation = 'source-atop';\n        }\n        ctx.rotate(-shapeObj.angleRad);\n        if (shapeObj.fillRgb) {\n            ctx.fillStyle = BB.ColorConverter.toRgbStr(colorRGB);\n        } else if (shapeObj.strokeRgb) {\n            ctx.strokeStyle = BB.ColorConverter.toRgbStr(colorRGB);\n            ctx.lineWidth = lineWidth;\n        }\n\n        let x1 = shapeObj.x1;\n        let y1 = shapeObj.y1;\n        let x2 = shapeObj.x2;\n        let y2 = shapeObj.y2;\n\n        // --- angle snapping ---\n        if (shapeObj.isAngleSnap) {\n            const r1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\n            const r2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\n\n            const pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\n            const pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\n            const rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\n            x2 = rotated.x;\n            y2 = rotated.y;\n\n            // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\n            if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\n                if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\n                    x2 = x1;\n                } else { // left or right\n                    y2 = y1;\n                }\n            }\n        }\n\n        let x = x1;\n        let y = y1;\n        let dX = x2 - x1;\n        let dY = y2 - y1;\n\n        // --- 1:1 ratio ---\n        if (shapeObj.type !== 'line' && shapeObj.isFixedRatio) {\n            let r1 = BB.rotate(shapeObj.x1, shapeObj.y1, shapeObj.angleRad / Math.PI * 180);\n            let r2 = BB.rotate(shapeObj.x2, shapeObj.y2, shapeObj.angleRad / Math.PI * 180);\n\n            const rx = r1.x;\n            const ry = r1.y;\n            let rdX = r2.x - r1.x;\n            let rdY = r2.y - r1.y;\n\n            if (Math.abs(rdX) < Math.abs(rdY)) {\n                rdY = Math.abs(rdX) * (rdY < 0 ? -1 : 1);\n            } else {\n                rdX = Math.abs(rdY) * (rdX < 0 ? -1 : 1);\n            }\n            r2.x = rx + rdX;\n            r2.y = ry + rdY;\n\n            r1 = BB.rotate(r1.x, r1.y, -shapeObj.angleRad / Math.PI * 180);\n            r2 = BB.rotate(r2.x, r2.y, -shapeObj.angleRad / Math.PI * 180);\n\n            x1 = r1.x;\n            y1 = r1.y;\n            x2 = r2.x;\n            y2 = r2.y;\n\n            x = x1;\n            y = y1;\n            dX = x2 - x1;\n            dY = y2 - y1;\n        }\n\n        // outwards modifier\n        if (shapeObj.isOutwards) {\n            x -= dX;\n            y -= dY;\n            dX *= 2;\n            dY *= 2;\n\n            x1 = x;\n            y1 = y;\n            x2 = x + dX;\n            y2 = y + dY;\n        }\n\n        let p1;\n        let p2;\n        if (shapeObj.type === 'line') { // --- line ---\n\n            // rounded\n            const x1r = Math.round(x1);\n            const y1r = Math.round(y1);\n            const x2r = Math.round(x2);\n            const y2r = Math.round(y2);\n\n            // floored\n            const x1f = Math.floor(x1);\n            const y1f = Math.floor(y1);\n            const x2f = Math.floor(x2);\n            const y2f = Math.floor(y2);\n\n            if (lineWidth % 2 === 0) {\n\n                if (y1r === y2r) {\n                    p1 = {\n                        x: x1f,\n                        y: y1r,\n                    };\n                    p2 = {\n                        x: x2f,\n                        y: y2r,\n                    };\n\n                    if (x1f < x2f) {\n                        p2.x += 1;\n                    } else {\n                        p1.x += 1;\n                    }\n                } else if (x1r === x2r) {\n                    p1 = {\n                        x: x1r,\n                        y: y1f,\n                    };\n                    p2 = {\n                        x: x2r,\n                        y: y2f,\n                    };\n\n                    if (y1f < y2f) {\n                        p2.y += 1;\n                    } else {\n                        p1.y += 1;\n                    }\n                } else {\n                    p1 = {\n                        x: x1,\n                        y: y1,\n                    };\n                    p2 = {\n                        x: x2,\n                        y: y2,\n                    };\n                }\n\n            } else {\n                p1 = {\n                    x: x1f,\n                    y: y1f,\n                };\n                p2 = {\n                    x: x2f,\n                    y: y2f,\n                };\n                if (y1f === y2f) {\n                    if (x1f < x2f) {\n                        p2.x += 1;\n                    } else {\n                        p1.x += 1;\n                    }\n                    p1.y += 0.5;\n                    p2.y += 0.5;\n                } else if (x1f === x2f) {\n                    if (y1f < y2f) {\n                        p2.y += 1;\n                    } else {\n                        p1.y += 1;\n                    }\n                    p1.x += 0.5;\n                    p2.x += 0.5;\n                } else {\n                    p1.x = x1;\n                    p1.y = y1;\n                    p2.x = x2;\n                    p2.y = y2;\n                }\n            }\n\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\n\n            ctx.beginPath();\n            ctx.moveTo(p1.x, p1.y);\n            ctx.lineTo(p2.x, p2.y);\n            ctx.stroke();\n\n        } else if (shapeObj.type === 'rect') { // --- rect ---\n\n            // floored\n            const x1f = Math.floor(x1);\n            const y1f = Math.floor(y1);\n            const x2f = Math.floor(x2);\n            const y2f = Math.floor(y2);\n\n            if (angleDeg % 90 === 0) {\n                if (shapeObj.fillRgb) {\n                    if (x1 % 1 === 0) {\n                        x1 += 1;\n                    }\n                    if (y1 % 1 === 0) {\n                        y1 += 1;\n                    }\n                    if (x2 % 1 === 0) {\n                        x2 += 1;\n                    }\n                    if (y2 % 1 === 0) {\n                        y2 += 1;\n                    }\n\n                    p1 = {\n                        x: x1 < x2 ? x1f : x2f,\n                        y: y1 < y2 ? y1f : y2f,\n                    };\n                    p2 = {\n                        x: Math.ceil((x1 < x2 ? x2 : x1) - p1.x),\n                        y: Math.ceil((y1 < y2 ? y2 : y1) - p1.y),\n                    };\n                    p2.x = p1.x + p2.x;\n                    p2.y = p1.y + p2.y;\n\n                } else {\n                    if (lineWidth % 2 === 0) {\n                        p1 = {\n                            x: x1f,\n                            y: y1f,\n                        };\n                        p2 = {\n                            x: x2f,\n                            y: y2f,\n                        };\n                    } else {\n                        p1 = {\n                            x: x1f + 0.5,\n                            y: y1f + 0.5,\n                        };\n                        p2 = {\n                            x: x2f + 0.5,\n                            y: y2f + 0.5,\n                        };\n                    }\n                }\n            } else {\n                p1 = {\n                    x: x1,\n                    y: y1,\n                };\n                p2 = {\n                    x: x2,\n                    y: y2,\n                };\n            }\n\n            p1 = BB.rotate(p1.x, p1.y, shapeObj.angleRad / Math.PI * 180);\n            p2 = BB.rotate(p2.x, p2.y, shapeObj.angleRad / Math.PI * 180);\n            p2.x = p2.x - p1.x;\n            p2.y = p2.y - p1.y;\n\n            if (shapeObj.fillRgb) {\n                ctx.fillRect(p1.x, p1.y, p2.x, p2.y);\n            } else {\n                ctx.strokeRect(p1.x, p1.y, p2.x, p2.y);\n            }\n\n        } else {  // --- circle ---\n            p1 = BB.rotate(x1, y1, shapeObj.angleRad / Math.PI * 180);\n            p2 = BB.rotate(x2, y2, shapeObj.angleRad / Math.PI * 180);\n            x = p1.x;\n            y = p1.y;\n            dX = p2.x - p1.x;\n            dY = p2.y - p1.y;\n\n            ctx.beginPath();\n            ctx.ellipse(x + dX / 2, y + dY / 2, Math.abs(dX / 2), Math.abs(dY / 2), 0, 0, Math.PI * 2);\n            if (shapeObj.fillRgb) {\n                ctx.fill();\n            } else {\n                ctx.stroke();\n            }\n        }\n\n\n        ctx.restore();\n\n    } else {\n        throw new Error('unknown shape');\n    }\n}","import {BB} from '../../bb/bb';\nimport {IBounds, IRect} from '../../bb/bb-types';\nimport {IRGBA} from '../kl-types';\n\nexport type TTextFormat = 'left' | 'center' | 'right';\nexport type TTextFont = 'serif' | 'monospace' | 'sans-serif' | 'cursive' | 'fantasy' | string;\n\nexport type TRenderTextParam = {\n    text: string; // text to be drawn. can contain newlines\n\n    x: number;\n    y: number;\n    angleRad: number;\n    size: number; // px\n    align: TTextFormat;\n    isBold: boolean;\n    isItalic: boolean;\n    font: TTextFont;\n    letterSpacing?: number;\n    lineHeight?: number; // em\n    fill?: {\n        color: IRGBA;\n    };\n    stroke?: {\n        color: IRGBA;\n        lineWidth: number;\n    };\n}\n\nfunction textMetricToRect (metrics: TextMetrics, align: TTextFormat): IRect {\n    // fallback for older browsers\n    const ascent = metrics.fontBoundingBoxAscent ?? metrics.actualBoundingBoxAscent;\n    const descent = metrics.fontBoundingBoxDescent ?? metrics.actualBoundingBoxDescent;\n\n    if (align === 'left') {\n        return {\n            x: 0,\n            y: -ascent,\n            width: metrics.width,\n            height: ascent + descent,\n        };\n    }\n    if (align === 'right') {\n        return {\n            x: -metrics.width,\n            y: -ascent,\n            width: metrics.width,\n            height: ascent + descent,\n        };\n    }\n    // center\n    return {\n        x: -metrics.width / 2,\n        y: -ascent,\n        width: metrics.width,\n        height: ascent + descent,\n    };\n}\n\n/**\n * Draws text on a canvas.\n * Return bounds, relative to p.x, p.y.\n *\n * @param canvas\n * @param p\n */\nexport function renderText (canvas: HTMLCanvasElement, p: TRenderTextParam): IRect {\n\n    p = BB.copyObj(p);\n\n    // setup context\n    const ctx = BB.ctx(canvas) as CanvasRenderingContext2D & {letterSpacing: string};\n    ctx.save();\n    ctx.textAlign = p.align;\n    ctx.letterSpacing = p.letterSpacing ? p.letterSpacing + 'px' : '0';\n\n    // font\n    const fontArr = [p.size + 'px ' + (p.font ? p.font : 'sans-serif')];\n    if (p.isBold) {\n        fontArr.unshift('bold');\n    }\n    if (p.isItalic) {\n        fontArr.unshift('italic');\n    }\n    ctx.font = fontArr.join(' ');\n\n    // fill\n    ctx.fillStyle = p.fill ? BB.ColorConverter.toRgbaStr(p.fill.color) : 'transparent';\n\n    // stroke\n    ctx.strokeStyle = p.stroke ? BB.ColorConverter.toRgbaStr(p.stroke.color) : 'transparent';\n    if (p.stroke) {\n        ctx.lineWidth = p.stroke.lineWidth;\n        ctx.lineJoin = 'round';\n    }\n\n    ctx.translate(p.x, p.y);\n    ctx.rotate(-p.angleRad);\n\n\n    const lines = p.text.split('\\n').map(line => line.replaceAll('\\t', '    '));\n\n    // bounds\n    const bounds: IBounds = {\n        x1: 0,\n        y1: 0,\n        x2: 0,\n        y2: 0,\n    };\n    {\n        let isFirst = true;\n        lines.forEach((line, lineIndex) => {\n            const metrics = ctx.measureText(line);\n            const x = 0;\n            const y =  p.size * (p.lineHeight ?? 1) * lineIndex;\n            const mRect = textMetricToRect(metrics, p.align);\n            if (isFirst) {\n                isFirst = false;\n                bounds.x1 = x + mRect.x;\n                bounds.y1 = y + mRect.y;\n                bounds.x2 = x + mRect.x + mRect.width;\n                bounds.y2 = y + mRect.y + mRect.height;\n            } else {\n                bounds.x1 = Math.min(bounds.x1, x + mRect.x);\n                bounds.y1 = Math.min(bounds.y1, y + mRect.y);\n                bounds.x2 = Math.max(bounds.x2, x + mRect.x + mRect.width);\n                bounds.y2 = Math.max(bounds.y2, y + mRect.y + mRect.height);\n            }\n        });\n    }\n\n    // draw stroke\n    lines.forEach((line, lineIndex) => {\n        const x = 0;\n        const y =  p.size * (p.lineHeight ?? 1) * lineIndex;\n        ctx.strokeText(line, x, y);\n    });\n\n    // draw fill\n    lines.forEach((line, lineIndex) => {\n        const x = 0;\n        const y =  p.size * (p.lineHeight ?? 1) * lineIndex;\n        ctx.fillText(line, x, y);\n    });\n\n    ctx.restore();\n    return {\n        x: bounds.x1,\n        y: bounds.y1,\n        width: bounds.x2 - bounds.x1,\n        height: bounds.y2 - bounds.y1,\n    };\n}\n","import {BB} from '../../bb/bb';\nimport {IKlProject} from '../kl-types';\n\nexport function drawProject (project: IKlProject, factor: number): HTMLCanvasElement {\n    const resultCanvas = BB.canvas(\n        Math.max(1, Math.round(project.width * factor)),\n        Math.max(1, Math.round(project.height * factor))\n    );\n    const ctx = BB.ctx(resultCanvas);\n    ctx.save();\n    if (factor > 1) {\n        ctx.imageSmoothingEnabled = false;\n    }\n    for (let i = 0; i < project.layers.length; i++) {\n        const layer = project.layers[i];\n        if (!layer.isVisible || layer.opacity === 0) {\n            continue;\n        }\n        ctx.globalAlpha = layer.opacity;\n        const mixModeStr = layer.mixModeStr;\n        ctx.globalCompositeOperation = mixModeStr !== undefined ? mixModeStr : 'source-over';\n        ctx.drawImage(layer.image, 0, 0, resultCanvas.width, resultCanvas.height);\n    }\n    ctx.restore();\n    return resultCanvas;\n}","import {IGradient, IRGBA} from '../kl-types';\nimport {BB} from '../../bb/bb';\n\n\ntype TOnGradient = (isDone: boolean, x1: number, y1: number, x2: number, y2: number, angleRad: number) => void;\n\n/**\n * Input processor for gradient tool.\n * Coordinates are in canvas space.\n * angleRad is the angle of the canvas.\n */\nexport class GradientTool {\n    private downX: number = 0;\n    private downY: number = 0;\n    private downAngleRad: number = 0;\n    private readonly onGradient: TOnGradient;\n\n    // ---- public ----\n    constructor (\n        p: {\n            onGradient: TOnGradient;\n        }\n    ) {\n        this.onGradient = p.onGradient;\n    }\n\n    onDown (x: number, y: number, angleRad: number): void {\n        this.downX = x;\n        this.downY = y;\n        this.downAngleRad = angleRad;\n    }\n\n    onMove (x: number, y: number): void {\n        this.onGradient(false, this.downX, this.downY, x, y, this.downAngleRad);\n    }\n\n    onUp (x: number, y: number): void {\n        this.onGradient(true, this.downX, this.downY, x, y, this.downAngleRad);\n    }\n}\n\nexport function drawGradient (\n    ctx: CanvasRenderingContext2D,\n    gradientObj: IGradient,\n): void {\n    ctx.save();\n\n    const x1 = gradientObj.x1;\n    const y1 = gradientObj.y1;\n    let x2 = gradientObj.x2;\n    let y2 = gradientObj.y2;\n\n    if (gradientObj.doSnap) {\n        const angleDeg = gradientObj.angleRad * 180 / Math.PI;\n\n        const r1 = BB.rotate(x1, y1, gradientObj.angleRad / Math.PI * 180);\n        const r2 = BB.rotate(x2, y2, gradientObj.angleRad / Math.PI * 180);\n\n        const pAngleDeg = BB.pointsToAngleDeg(r1, r2) + 90;\n        const pAngleDegSnapped = Math.round(pAngleDeg / 45) * 45;\n        const rotated = BB.rotateAround({x: x1, y: y1}, {x: x2, y: y2}, pAngleDegSnapped - pAngleDeg);\n        x2 = rotated.x;\n        y2 = rotated.y;\n\n        // needs to be perfect if p1->p2 aligns with canvas x- or y-axis\n        if ((angleDeg + pAngleDegSnapped) % 90 === 0) {\n            if (Math.round((angleDeg - pAngleDegSnapped) / 90) % 2 === 0) { // up or down\n                x2 = x1;\n            } else { // left or right\n                y2 = y1;\n            }\n        }\n    }\n\n    let baseColor = gradientObj.color1;\n    if (gradientObj.isEraser && gradientObj.doLockAlpha) {\n        baseColor = {r: 255, g: 255, b: 255};\n    }\n    let color1: IRGBA = {\n        ...baseColor,\n        a: gradientObj.opacity,\n    };\n    let color2: IRGBA = {\n        ...baseColor,\n        a: 0,\n    };\n    if (gradientObj.isReversed) {\n        const temp = color1;\n        color1 = color2;\n        color2 = temp;\n    }\n\n    let gradient: CanvasGradient;\n    if (gradientObj.type === 'linear') {\n        gradient = ctx.createLinearGradient(x1, y1, x2, y2);\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color1));\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\n\n    } else if (gradientObj.type === 'linear-mirror') {\n        const d = {\n            x: x2 - x1,\n            y: y2 - y1,\n        };\n        gradient = ctx.createLinearGradient(x1 - d.x,y1 - d.y, x2, y2);\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color2));\n        gradient.addColorStop(0.5, BB.ColorConverter.toRgbaStr(color1));\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\n\n    } else if (gradientObj.type === 'radial') {\n        const r = BB.Vec2.dist(\n            {x: x1, y: y1},\n            {x: x2, y: y2},\n        );\n        gradient = ctx.createRadialGradient(x1, y1, 0, x1, y1, r);\n        gradient.addColorStop(0, BB.ColorConverter.toRgbaStr(color1));\n        gradient.addColorStop(1, BB.ColorConverter.toRgbaStr(color2));\n    }\n\n    ctx.fillStyle = gradient!;\n    if (gradientObj.isEraser) {\n        ctx.globalCompositeOperation = 'destination-out';\n    }\n    if (gradientObj.doLockAlpha) {\n        ctx.globalCompositeOperation = 'source-atop';\n    }\n    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\n\n    ctx.restore();\n}","import {TMixMode} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {TTranslationCode} from '../../../languages/languages';\n\nexport function translateBlending (blendMode?: TMixMode): string {\n    if (!blendMode) {\n        return LANG('layers-blend-normal');\n    }\n\n    const codes: {\n        [key: string]: TTranslationCode;\n    } = {\n        'source-over': 'layers-blend-normal',\n        'darken': 'layers-blend-darken',\n        'multiply': 'layers-blend-multiply',\n        'color-burn': 'layers-blend-color-burn',\n        'lighten': 'layers-blend-lighten',\n        'screen': 'layers-blend-screen',\n        'color-dodge': 'layers-blend-color-dodge',\n        'overlay': 'layers-blend-overlay',\n        'soft-light': 'layers-blend-soft-light',\n        'hard-light': 'layers-blend-hard-light',\n        'difference': 'layers-blend-difference',\n        'exclusion': 'layers-blend-exclusion',\n        'hue': 'layers-blend-hue',\n        'saturation': 'layers-blend-saturation',\n        'color': 'layers-blend-color',\n        'luminosity': 'layers-blend-luminosity',\n    };\n\n    if (!(blendMode in codes)) {\n        throw new Error('unknown blend mode');\n    }\n    return LANG(codes[blendMode]);\n}","import {BB} from '../../../../bb/bb';\nimport {LANG} from '../../../../language/language';\nimport {showModal} from '../../modals/base/showModal';\nimport removeLayerImg from '/src/app/img/ui/remove-layer.svg';\n\n\nexport function renameLayerDialog (\n    parentEl: HTMLElement,\n    currentName: string,\n    callback: (newName: string | undefined) => void\n): void {\n    const div = BB.el();\n\n    const label = BB.el({\n        content: LANG('layers-rename-name') + ':',\n        css: {\n            marginRight: '5px',\n        },\n    });\n\n    const row = BB.el({\n        css: {\n            display: 'flex',\n        },\n    });\n    const input = BB.el({tagName: 'input'});\n    input.value = currentName;\n    input.setAttribute('data-ignore-focus', 'true');\n    const clearBtn = BB.el({\n        tagName: 'button',\n        content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/>',\n        title: LANG('layers-rename-clear'),\n        css: {\n            marginLeft: '10px',\n        },\n        onClick: () => {\n            input.value = '';\n            input.focus();\n        },\n    });\n    const suggestions = [\n        LANG('layers-rename-sketch'),\n        LANG('layers-rename-colors'),\n        LANG('layers-rename-shading'),\n        LANG('layers-rename-lines'),\n        LANG('layers-rename-effects'),\n        LANG('background'),\n        LANG('layers-rename-foreground'),\n    ];\n    const suggestionBtns: HTMLButtonElement[] = [];\n    const row2 = BB.el({\n        css: {\n            display: 'flex',\n            flexWrap: 'wrap',\n            marginTop: '5px',\n            marginLeft: '-5px',\n        },\n    });\n    suggestions.forEach(item => {\n        const btn = BB.el({\n            parent: row2,\n            tagName: 'button',\n            content: item,\n            onClick: () => {\n                input.value = '' + btn.textContent;\n            },\n            css: {\n                margin: '5px 0 0 5px',\n            },\n        });\n        suggestionBtns.push(btn);\n    });\n\n    div.append(label);\n    label.append(row, row2);\n    row.append(input, clearBtn);\n\n    setTimeout(() => {\n        input.focus();\n        input.select();\n    }, 10);\n\n    showModal({\n        target: parentEl,\n        message: `<b>${LANG('layers-rename-title')}</b>`,\n        div: div,\n        buttons: [LANG('layers-rename'), 'Cancel'],\n        primaries: [LANG('layers-rename')],\n        callback: (val) => {\n            BB.destroyEl(clearBtn);\n            suggestionBtns.forEach(item => {\n                BB.destroyEl(item);\n            });\n            suggestionBtns.splice(0, suggestionBtns.length);\n            if (val === LANG('layers-rename')) {\n                callback(input.value);\n            } else {\n                callback(undefined);\n            }\n        },\n        clickOnEnter: LANG('layers-rename'),\n    });\n}","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"remove-layer.4e9b2b7d.svg\";","import {BB} from '../../../../bb/bb';\nimport {LANG} from '../../../../language/language';\nimport {Options} from '../../components/options';\nimport {translateBlending} from '../../../canvas/translate-blending';\nimport {showModal} from '../../modals/base/showModal';\nimport {TMixMode} from '../../../kl-types';\nimport {theme} from '../../../../theme/theme';\n\nexport function mergeLayerDialog (\n    parentEl: HTMLElement,\n    p: {\n        topCanvas: HTMLCanvasElement;\n        bottomCanvas: HTMLCanvasElement;\n        topOpacity: number;\n        mixModeStr: TMixMode;\n        callback: (mode: string) => void;\n    }\n): void {\n    const div = BB.el();\n    div.innerHTML = LANG('layers-merge-description');\n\n    const options = new Options({\n        optionArr: [\n            {id: p.mixModeStr, label: translateBlending(p.mixModeStr)},\n            {id: 'source-in', label: 'source-in'},\n            {id: 'source-out', label: 'source-out'},\n            {id: 'source-atop', label: 'source-atop'},\n            {id: 'destination-in', label: 'destination-in'},\n            {id: 'destination-out', label: 'destination-out'},\n            {id: 'destination-atop', label: 'destination-atop'},\n            {id: 'xor', label: 'xor'},\n        ],\n        initId: p.mixModeStr,\n        onChange: () => {\n            update();\n        },\n        isSmall: true,\n    });\n    options.getElement().style.marginTop = '5px';\n    div.append(options.getElement());\n\n    const thumbDimensions = BB.fitInto(p.topCanvas.width, p.topCanvas.height, 200, 200, 1);\n    const preview = BB.canvas(thumbDimensions.width, thumbDimensions.height);\n    preview.title = LANG('preview');\n    preview.className = 'kl-merge-preview';\n    const spacer = BB.el({\n        content: '<br/>',\n        css: {\n            clear: 'both',\n        },\n    });\n    div.append(spacer, preview);\n\n    function updateCheckerboard (): void {\n        BB.createCheckerDataUrl(4, (url) => {\n            preview.style.backgroundImage = 'url(' + url + ')';\n        }, theme.isDark());\n    }\n    updateCheckerboard();\n    theme.addIsDarkListener(updateCheckerboard);\n\n    const alphaCanvas = BB.copyCanvas(preview);\n    BB.ctx(alphaCanvas).drawImage(p.topCanvas, 0, 0, alphaCanvas.width, alphaCanvas.height);\n    BB.convertToAlphaChannelCanvas(alphaCanvas);\n\n    const update = () => {\n        const ctx = BB.ctx(preview);\n        ctx.save();\n        ctx.clearRect(0, 0, preview.width, preview.height);\n        if (preview.width > p.topCanvas.width) {\n            ctx.imageSmoothingEnabled = false;\n        }\n        ctx.drawImage(p.bottomCanvas, 0, 0, preview.width, preview.height);\n\n        if (options.getValue() === 'as-alpha') {\n            ctx.globalCompositeOperation = 'destination-in';\n            ctx.globalAlpha = p.topOpacity;\n            ctx.drawImage(alphaCanvas, 0, 0, preview.width, preview.height);\n        } else {\n            ctx.globalCompositeOperation = options.getValue() as GlobalCompositeOperation;\n            ctx.globalAlpha = p.topOpacity;\n            ctx.drawImage(p.topCanvas, 0, 0, preview.width, preview.height);\n        }\n        ctx.restore();\n    };\n\n    update();\n\n\n    const keyListener = new BB.KeyListener({\n        onDown: (keyStr: string) => {\n            if (keyStr === 'right') {\n                options.next();\n            }\n            if (keyStr === 'left') {\n                options.previous();\n            }\n        },\n    });\n\n    showModal({\n        target: parentEl,\n        message: `<b>${LANG('layers-merge-modal-title')}</b>`,\n        div: div,\n        buttons: ['Ok', 'Cancel'],\n        clickOnEnter: 'Ok',\n        callback: (val) => {\n            keyListener.destroy();\n            options.destroy();\n            theme.removeIsDarkListener(updateCheckerboard);\n            if (val === 'Ok') {\n                p.callback(options.getValue());\n            }\n        },\n    });\n}","import {c} from '../../../bb/base/c';\nimport {makeUnfocusable} from '../../../bb/base/ui';\n\nexport type TDropdownMenuParams = {\n    button: string | HTMLElement;\n    buttonTitle?: string;\n    items: [string, string][]; // id, label\n    onItemClick: (id: string) => void;\n};\n\nexport class DropdownMenu {\n    private readonly rootElement: HTMLElement;\n    private isExpanded: boolean = false;\n    private readonly onSetEnabled: (id: string, enabled: boolean) => void = () => 0;\n\n    // ---- public ----\n    constructor (p: TDropdownMenuParams) {\n        const button = c('button,w-full,h-full', [p.button]) as HTMLButtonElement;\n        button.onclick = () => {\n            toggle(!this.isExpanded);\n        };\n        if (p.buttonTitle) {\n            button.title = p.buttonTitle;\n        }\n        makeUnfocusable(button);\n\n        const items: HTMLButtonElement[] = [];\n        const itemMap: Record<string, HTMLButtonElement> = {};\n        p.items.forEach(item => {\n            const itemButton = c('button', item[1]) as HTMLButtonElement;\n            makeUnfocusable(itemButton);\n            itemButton.onclick = () => {\n                toggle(false);\n                p.onItemClick(item[0]);\n            };\n            items.push(itemButton);\n            itemMap[item[0]] = itemButton;\n        });\n\n        this.onSetEnabled = (id, enabled) => {\n            itemMap[id].disabled = !enabled;\n        };\n\n        const menu = c(\n            '.kl-dropdown-menu,right-0,top-full,nowrap,hidden',\n            items\n        );\n\n        this.rootElement = c(',pos-relative', [\n            button,\n            menu,\n        ]);\n\n        const toggle = (force: boolean) => {\n            this.isExpanded = force;\n            menu.style.display = this.isExpanded ? 'block' : 'none';\n            if (this.isExpanded) {\n                document.addEventListener('pointerdown', onPointerDown);\n                window.addEventListener('blur', onBlur);\n            } else {\n                document.removeEventListener('pointerdown', onPointerDown);\n                window.removeEventListener('blur', onBlur);\n            }\n        };\n\n        const onPointerDown = (e: PointerEvent) => {\n            const target = e.target as HTMLElement | null;\n            if (button.contains(target) || menu.contains(target)) {\n                return;\n            }\n            toggle(false);\n        };\n\n        const onBlur = () => toggle(false);\n    }\n\n    getElement (): HTMLElement {\n        return this.rootElement;\n    }\n\n    setEnabled (id: string, enabled: boolean): void {\n        this.onSetEnabled(id, enabled);\n    }\n}","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"add-layer.ce1078bb.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"duplicate-layer.3314e3c7.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"merge-layers.19da79a6.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"rename-layer.7c31d4f4.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"caret-down.68d4cd16.svg\";","import {BB} from '../../bb/bb';\nimport {IRGB} from '../kl-types';\n\n/**\n * Overlay for KlCanvasWorkspace.\n * - brush circle\n * - eyedropper circle\n * - compass needle (rotation hud)\n */\nexport class WorkspaceSvgOverlay {\n    private readonly rootElement: SVGElement;\n    private readonly brushCircleOuter: SVGElement;\n    private readonly brushCircleInner: SVGElement;\n    private readonly pickerPreviewBorder: SVGElement;\n    private readonly pickerPreviewCol: SVGElement;\n    private readonly compassSize: number;\n    private readonly compass: SVGElement;\n    private readonly compassInner: SVGElement;\n    private readonly compassBaseCircle: SVGElement;\n    private readonly compassLineCircle: SVGElement;\n    private readonly compassUpperTriangle: SVGElement;\n    private readonly compassLowerTriangle: SVGElement;\n\n    // ---- public ----\n\n    constructor (\n        p: {\n            width: number;\n            height: number;\n        }\n    ) {\n        this.rootElement = BB.createSvg({\n            elementType: 'svg',\n            width: '' + p.width,\n            height: '' + p.height,\n        });\n        BB.css(this.rootElement, {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            pointerEvents: 'none',\n            userSelect: 'none',\n        });\n\n        //brush circles\n        this.brushCircleOuter = BB.createSvg({\n            elementType: 'circle',\n            r: '10',\n            stroke: 'rgba(0,0,0,0.7)',\n            'stroke-width': '1',\n            fill: 'none',\n        });\n        this.brushCircleInner = BB.createSvg({\n            elementType: 'circle',\n            r: '9',\n            stroke: 'rgba(255,255,255,0.7)',\n            'stroke-width': '1',\n            fill: 'none',\n        });\n        this.rootElement.append(this.brushCircleOuter, this.brushCircleInner);\n\n        //color picker preview circle\n        this.pickerPreviewBorder = BB.createSvg({\n            elementType: 'circle',\n            r: '47',\n            stroke: 'black',\n            'stroke-width': '22',\n            fill: 'none',\n        });\n        this.pickerPreviewBorder.style.opacity = '0';\n        this.pickerPreviewCol = BB.createSvg({\n            elementType: 'circle',\n            r: '47',\n            stroke: 'black',\n            'stroke-width': '20',\n            fill: 'none',\n        });\n        this.pickerPreviewCol.style.opacity = '0';\n        this.rootElement.append(this.pickerPreviewBorder, this.pickerPreviewCol);\n\n\n        //rotation compass\n        this.compassSize = 30;\n        this.compass = BB.createSvg({\n            elementType: 'g',\n            transform: 'translate(' + (p.width/2) + ', ' + (p.height/2) + ')',\n        });\n        BB.css(this.compass, {\n            transition: 'opacity 0.25s ease-in-out',\n            opacity: '0',\n        });\n        this.compassInner = BB.createSvg({\n            elementType: 'g',\n            transform: 'rotate(45)',\n        });\n        this.compassBaseCircle = BB.createSvg({\n            elementType: 'circle',\n            fill: 'rgba(0,0,0,0.9)',\n            stroke: 'none',\n            cx: '0',\n            cy: '0',\n            r: '' + this.compassSize,\n        });\n        this.compassLineCircle = BB.createSvg({\n            elementType: 'circle',\n            fill: 'none',\n            stroke: 'rgba(255,255,255,0.75)',\n            'stroke-width': '1',\n            cx: '0',\n            cy: '0',\n            r: '' + (this.compassSize * 0.9),\n        });\n        this.compassUpperTriangle = BB.createSvg({\n            elementType: 'path',\n            fill: '#f00',\n            stroke: 'none',\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,-'+(this.compassSize * 0.9)+' z',\n        });\n        this.compassLowerTriangle = BB.createSvg({\n            elementType: 'path',\n            fill: '#fff',\n            stroke: 'none',\n            d: 'M -'+(this.compassSize * 0.25)+',0 '+(this.compassSize * 0.25)+',0 0,'+(this.compassSize * 0.9)+' z',\n        });\n\n        this.compassInner.append(\n            this.compassBaseCircle,\n            this.compassLineCircle,\n            this.compassUpperTriangle,\n            this.compassLowerTriangle\n        );\n        this.compass.append(this.compassInner);\n        this.rootElement.append(this.compass);\n    }\n\n    getElement (): SVGElement {\n        return this.rootElement;\n    }\n\n    setSize (width: number, height: number): void {\n        this.rootElement.setAttribute('width', '' + width);\n        this.rootElement.setAttribute('height', '' + height);\n        this.compass.setAttribute('transform', 'translate(' + (width/2) + ', ' + (height/2) + ')');\n    }\n\n    updateCursor (p: {\n        x?: number;\n        y?: number;\n        radius?: number;\n        isVisible?: boolean;\n    }): void {\n        if (p.x !== undefined) {\n            this.brushCircleOuter.setAttribute('cx', '' + p.x);\n            this.brushCircleInner.setAttribute('cx', '' + p.x);\n        }\n        if (p.y !== undefined) {\n            this.brushCircleOuter.setAttribute('cy', '' + p.y);\n            this.brushCircleInner.setAttribute('cy', '' + p.y);\n        }\n        if (p.radius !== undefined) {\n            this.brushCircleOuter.setAttribute('r', '' + Math.max(0, p.radius));\n            this.brushCircleInner.setAttribute('r', '' + Math.max(0, p.radius - 1));\n        }\n        if (p.isVisible !== undefined) {\n            this.brushCircleOuter.style.opacity = p.isVisible ? '1' : '0';\n            this.brushCircleInner.style.opacity = p.isVisible ? '1' : '0';\n        }\n    }\n\n    updateColorPreview (p: {\n        x?: number;\n        y?: number;\n        color?: IRGB;\n        isVisible?: boolean;\n    }): void {\n        if (p.x !== undefined) {\n            this.pickerPreviewCol.setAttribute('cx', '' + p.x);\n            this.pickerPreviewBorder.setAttribute('cx', '' + p.x);\n        }\n        if (p.y !== undefined) {\n            this.pickerPreviewCol.setAttribute('cy', '' + p.y);\n            this.pickerPreviewBorder.setAttribute('cy', '' + p.y);\n        }\n        if (p.color) {\n            this.pickerPreviewCol.setAttribute('stroke', BB.ColorConverter.toRgbStr(p.color));\n            const borderColor = BB.testIsWhiteBestContrast(p.color) ? 'rgba(255,255,255,0.5)' : 'rgba(0,0,0,0.5)';\n            this.pickerPreviewBorder.setAttribute('stroke', borderColor);\n        }\n        if (p.isVisible !== undefined) {\n            this.pickerPreviewCol.style.opacity = p.isVisible ? '1' : '0';\n            this.pickerPreviewBorder.style.opacity = p.isVisible ? '1' : '0';\n        }\n    }\n\n    updateCompass (p: {\n        angleDeg?: number;\n        isVisible?: boolean;\n    }): void {\n        if (p.angleDeg !== undefined) {\n            this.compassInner.setAttribute('transform', 'rotate(' + p.angleDeg + ')');\n            this.compassLineCircle.style.opacity = p.angleDeg % 90 === 0 ? '1' : '0';\n        }\n        if (p.isVisible !== undefined) {\n            this.compass.style.opacity = p.isVisible ? '1' : '0';\n        }\n    }\n\n}\n","import {BB} from '../../bb/bb';\nimport {IRGB, ITransform, TDrawEvent} from '../kl-types';\nimport {WorkspaceSvgOverlay} from './workspace-svg-overlay';\nimport {klHistory} from '../history/kl-history';\nimport pickerImg from '/src/app/img/ui/cursor-picker.png';\nimport zoomEwImg from '/src/app/img/ui/cursor-zoom-ew.png';\nimport fillImg from '/src/app/img/ui/cursor-fill.png';\nimport textImg from '/src/app/img/ui/cursor-text.png';\nimport {IBounds, IPressureInput, IVector2D} from '../../bb/bb-types';\nimport {KlCanvas} from '../canvas/kl-canvas';\nimport {KeyListener, TOnKeyDown, TOnKeyUp} from '../../bb/input/key-listener';\nimport {KL} from '../kl';\nimport {LinetoolProcessor} from '../events/linetool-processor';\nimport {PinchZoomer} from '../../bb/input/event-chain/pinch-zoomer';\nimport {DoubleTapper, IDoubleTapperEvent} from '../../bb/input/event-chain/double-tapper';\nimport {NFingerTapper} from '../../bb/input/event-chain/n-finger-tapper';\nimport {EventChain} from '../../bb/input/event-chain/event-chain';\nimport {PointerListener} from '../../bb/input/pointer-listener';\nimport {theme} from '../../theme/theme';\nimport {TVec4} from '../../bb/math/matrix';\nimport {IChainElement} from '../../bb/input/event-chain/event-chain.types';\nimport {ICoalescedPointerEvent} from '../../bb/input/event-chain/coalesced-exploder';\nimport {klConfig} from '../kl-config';\n\nexport interface IViewChangeEvent {\n    changed: ('scale' | 'angle')[];\n    angle: number;\n    scale: number;\n}\n\ntype TModeStr = 'draw' | 'pick' | 'hand' | 'shape' | 'fill' | 'gradient' | 'text'; // | 'transform' | 'select'\n\ntype TInputProcessorKeys = |\n    'draw' |\n    'fill' |\n    'gradient' |\n    'text' |\n    'shape' |\n    'hand' |\n    'spaceHand' |\n    'zoom' |\n    'picker' |\n    'altPicker' |\n    'rotate';\n\ntype TInputProcessorItem = {\n    onPointer: (val: ICoalescedPointerEvent) => void;\n    onKeyDown: TOnKeyDown;\n    onKeyUp: TOnKeyUp;\n}\n\nconst MIN_SCALE = 1 / 16;\nconst MAX_SCALE = Math.pow(2, 7);\nenum TMode {\n    Draw,\n    Hand,\n    HandGrabbing,\n    Pick,\n    Zoom,\n    Rotate,\n    Rotating,\n    Fill,\n    Gradient,\n    Text,\n    Shape,\n}\nconst ANIMATION_SPEED = 0.3; // rate of transition towards targetTransform\n\n/**\n * Work area that displays the KlCanvas.\n * - pan, zoom, rotate (also via multi-touch)\n * - input modes: drawing, hand, pick, fill, text // transform, select\n * - drawing input events\n * - view change events\n * - eyedropper input events (pick)\n * - draws cursor, eyedropper overlay\n *\n * subscribes to klCanvas changes\n * listens to kl history for changes\n * and you can manually trigger redraw\n */\nexport class KlCanvasWorkspace {\n\n    private readonly rootEl: HTMLElement;\n    private klCanvas: KlCanvas;\n    private readonly renderTargetCanvas: HTMLCanvasElement;\n    private readonly renderTargetCtx: CanvasRenderingContext2D;\n    private renderWidth: number;\n    private renderHeight: number;\n    private readonly compositeCanvas: HTMLCanvasElement; // for drawing klcanvas layer composite\n    private readonly compositeCtx: CanvasRenderingContext2D;\n    private doResizeCanvas: boolean;\n    private oldTransformObj: ITransform | null;\n    private targetTransformObj: ITransform; // animation target\n    private highResTransformObj: ITransform; // animated, internal high-res\n    private readonly renderedTransformObj: ITransform; // same as highRes, but rounded - what's actually displayed\n    private cursorPos: IVector2D;\n    private readonly usesCssCursor: boolean;\n    private bgVisible: boolean;\n    private transformIsDirty: boolean;\n    private doAnimateTranslate: boolean;\n    private svgOverlay: WorkspaceSvgOverlay;\n    private readonly emptyCanvas: HTMLCanvasElement;\n    private readonly emptyLightCanvas: HTMLCanvasElement;\n    private keyListener: KeyListener;\n    private currentMode: TMode;\n    private globalMode: TMode;\n    private renderTime: number; // for debugging - average ms per render()\n    private lastDrawEvent: IPressureInput | null; // previous drawing input\n    private linetoolProcessor: LinetoolProcessor;\n    private pointer: IVector2D | null; // position of cursor\n    private isDrawing: boolean;\n    private inputProcessorObj: {\n        [key in TInputProcessorKeys]: TInputProcessorItem;\n    };\n    private currentInputProcessor: TInputProcessorItem | null;\n    private angleIsExtraSticky: boolean;\n    private readonly pinchZoomer: PinchZoomer;\n    private readonly mainDoubleTapper: DoubleTapper;\n    private readonly middleDoubleTapper: DoubleTapper;\n    private readonly twoFingerTap: NFingerTapper;\n    private readonly threeFingerTap: NFingerTapper;\n    private pointerEventChain: EventChain;\n    private pointerListener: PointerListener | undefined;\n    private brushRadius: number;\n    private animationFrameRequested: boolean;\n    private lastRenderedState: number; // KlHistory state - to detect if there are changes to draw\n    private lastRenderTime: number; // ms from performance.now()\n    private hideBrushCursorTimeout: (ReturnType<typeof setTimeout>) | undefined;\n    private readonly onViewChange: (e:  IViewChangeEvent) => void;\n\n    private getRenderedTransform (): ITransform {\n        // rounded x & y so canvas is less blurry.\n        const result = this.renderedTransformObj;\n        result.x = this.highResTransformObj.x;\n        result.y = this.highResTransformObj.y;\n        result.scale = this.highResTransformObj.scale;\n        result.angle = this.highResTransformObj.angle;\n\n        if (result.angle % (Math.PI / 2) === 0 && result.scale % 1 === 0) {\n            result.x = Math.round(result.x);\n            result.y = Math.round(result.y);\n        }\n\n        return result;\n    }\n\n    private updateChangeListener (): void {\n        this.klCanvas.addChangeListener(() => {\n            this.lastRenderedState = -1;\n            this.reqFrame();\n        });\n    }\n\n    private updateCursor (modeInt: TMode, doForce?: boolean): void {\n        if (modeInt === this.currentMode && !doForce) {\n            return;\n        }\n        const oldMode = this.currentMode;\n        this.currentMode = modeInt;\n        this.lastRenderedState = -1;\n        if (this.currentMode === TMode.Draw) {\n            this.rootEl.style.cursor = 'crosshair';\n        } else if (this.currentMode === TMode.Hand) {\n            this.rootEl.style.cursor = 'grab';\n        } else if (this.currentMode === TMode.HandGrabbing) {\n            this.rootEl.style.cursor = 'grabbing';\n        } else if (this.currentMode === TMode.Pick) {\n            this.rootEl.style.cursor = \"url('\" + pickerImg + \"') 0 15, crosshair\";\n        } else if (this.currentMode === TMode.Zoom) {\n            this.rootEl.style.cursor = \"url('\" + zoomEwImg + \"') 7 7, zoom-in\";\n        } else if (this.currentMode === TMode.Rotate) {\n            this.rootEl.style.cursor = 'grab';\n        } else if (this.currentMode === TMode.Rotating) {\n            this.rootEl.style.cursor = 'grabbing';\n        } else if (this.currentMode === TMode.Fill) {\n            this.rootEl.style.cursor = \"url('\" + fillImg + \"') 1 12, crosshair\";\n        } else if (this.currentMode === TMode.Gradient) {\n            this.rootEl.style.cursor = 'crosshair';\n        } else if (this.currentMode === TMode.Text) {\n            this.rootEl.style.cursor = \"url('\" + textImg + \"') 1 12, crosshair\";\n        } else if (this.currentMode === TMode.Shape) {\n            this.rootEl.style.cursor = 'crosshair';\n        }\n\n        if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Text, TMode.Shape].includes(this.globalMode)) {\n            const oldIsHand = [TMode.Hand, TMode.HandGrabbing].includes(oldMode);\n            const currentIsHand = [TMode.Hand, TMode.HandGrabbing].includes(this.currentMode);\n            if (!oldIsHand && currentIsHand) {\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\n            }\n            if (oldIsHand && !currentIsHand) {\n                this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n            }\n        }\n\n        if (this.currentMode !== TMode.Pick) {\n            this.svgOverlay.updateColorPreview({isVisible: false});\n        }\n    }\n\n    /**\n     * returns false if no change of zoom\n     * @param stepNum\n     * @param centerX\n     * @param centerY\n     * @private\n     */\n    private internalZoomByStep (stepNum: number, centerX: number, centerY: number): boolean {\n        const step = Math.log2(this.targetTransformObj.scale);\n\n        let newStep = step / Math.abs(stepNum);\n        newStep += stepNum > 0 ? 1 : -1;\n        newStep = Math.round(newStep);\n        newStep *= Math.abs(stepNum);\n        const newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, Math.pow(2, newStep)));\n\n        //has zoomed?\n        if (newScale === this.targetTransformObj.scale) {\n            return false;\n        }\n\n        const effectiveFactor = newScale / this.targetTransformObj.scale;\n        this.targetTransformObj.scale = newScale;\n\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerX, centerY));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerX, -centerY));\n\n        let origin: TVec4 = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\n        this.targetTransformObj.x = origin[0];\n        this.targetTransformObj.y = origin[1];\n\n        this.transformIsDirty = true;\n\n        return true;\n    }\n\n    /**\n     * mixes two transform objects. modifies A\n     * @param transformA\n     * @param transformB\n     * @param blendFactor 0 -> A, 1 -> B\n     * @private\n     */\n    private mixTransformObj (transformA: ITransform, transformB: ITransform, blendFactor: number): void {\n        if (transformA.angle === transformB.angle) {\n            transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\n            transformA.x = BB.mix(transformA.x, transformB.x, blendFactor);\n            transformA.y = BB.mix(transformA.y, transformB.y, blendFactor);\n            transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\n            return;\n        }\n\n        const w = this.klCanvas.getWidth();\n        const h = this.klCanvas.getHeight();\n\n        // --- determine centerPosA, centerPosB ---\n        const centerPosA = this.canvasToWorkspaceCoord({\n            x: w / 2,\n            y: h / 2,\n        }, transformA);\n        const centerPosB = this.canvasToWorkspaceCoord({\n            x: w / 2,\n            y: h / 2,\n        }, transformB);\n\n        // --- centerPosMixed ---\n        transformA.x = BB.mix(centerPosA.x , centerPosB.x, blendFactor);\n        transformA.y = BB.mix(centerPosA.y , centerPosB.y, blendFactor);\n\n        // --- scale and angle ---\n        transformA.scale = BB.mix(transformA.scale, transformB.scale, blendFactor);\n        transformA.angle = BB.mix(transformA.angle, transformB.angle, blendFactor);\n\n        // --- x and y ---\n        const mixedPos = this.canvasToWorkspaceCoord({\n            x: -w / 2,\n            y: -h / 2,\n        }, transformA);\n        transformA.x = mixedPos.x;\n        transformA.y = mixedPos.y;\n    }\n\n    private render (): void {\n        if (this.doResizeCanvas) {\n            this.doResizeCanvas = false;\n            this.renderTargetCanvas.width = this.renderWidth;\n            this.renderTargetCanvas.height = this.renderHeight;\n        }\n        this.renderContext(this.renderTargetCtx);\n    }\n\n    /**\n     * is the gray background that surrounds canvas visible?\n     * @private\n     */\n    private testBgVisible (): boolean {\n        //bring workspace points (corners of workspace) into canvas coordinate system\n        //then check if any corner point is outside of the canvas -> that means the bg is visible\n\n        const workspacePointArr = [\n            [0, 0], // top left\n            [this.renderWidth, 0], // top right\n            [this.renderWidth, this.renderHeight], // bottom right\n            [0, this.renderHeight], // bottom left\n        ];\n\n        const art = this.getRenderedTransform();\n\n        //setup transformation matrix\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\n\n        //transform points, then test if outside of canvas\n        for (let i = 0; i < workspacePointArr.length; i++) {\n            let coords: TVec4 = [workspacePointArr[i][0], workspacePointArr[i][1], 0, 1];\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n\n            if (\n                !(0 <= coords[0] && coords[0] <= this.klCanvas.getWidth() &&\n                    0 <= coords[1] && coords[1] <= this.klCanvas.getHeight())\n            ){\n                //if not inside -> bg visible\n                return true;\n            }\n        }\n        return false;\n    }\n\n    private renderContext (ctx: CanvasRenderingContext2D): void {\n        const w = this.klCanvas.getWidth();\n        const h = this.klCanvas.getHeight();\n\n        const art = this.getRenderedTransform();\n        const isDark = theme.isDark();\n\n        if (art.scale >= 4 || (art.scale === 1 && art.angle === 0)) {\n            ctx.imageSmoothingEnabled = false;\n        } else {\n            ctx.imageSmoothingEnabled = true;\n            ctx.imageSmoothingQuality  = 'low'; // art.scale >= 1 ? 'low' : 'medium';\n        }\n        //ctx.imageSmoothingEnabled = false;\n        //renderTargetCtx.globalCompositeOperation  = 'multiply';\n\n\n\n        ctx.save();\n        {\n            if (this.bgVisible) {\n                ctx.fillStyle = isDark ? 'rgb(33, 33, 33)' : 'rgb(158,158,158)'; // 'rgb(185,185,185)';\n                ctx.fillRect(0, 0, this.renderWidth, this.renderHeight);\n            } else {\n                ctx.clearRect(0, 0, this.renderWidth, this.renderHeight);\n            }\n\n\n\n            if (this.bgVisible) {\n                ctx.save();\n\n                ctx.translate(art.x, art.y);\n                ctx.scale(art.scale, art.scale);\n                ctx.rotate(art.angle);\n\n                ctx.imageSmoothingEnabled = false;\n\n                //outline\n                const borderSize = 1;\n                ctx.globalAlpha = isDark ? 0.25 : 0.2;\n                ctx.drawImage(\n                    isDark ? this.emptyLightCanvas : this.emptyCanvas,\n                    -borderSize / art.scale,\n                    -borderSize / art.scale,\n                    w + borderSize * 2 / art.scale,\n                    h + borderSize * 2 / art.scale\n                );\n                ctx.globalAlpha = 1;\n\n                //erase\n                ctx.globalCompositeOperation = 'destination-out';\n                ctx.drawImage(this.emptyCanvas, 0, 0, w, h);\n\n                ctx.restore();\n            }\n\n            /*const region = new Path2D();\n            region.rect(80, 10, 20, 130);\n            ctx.clip(region);*/\n\n            ctx.translate(art.x, art.y);\n            ctx.scale(art.scale, art.scale);\n            ctx.rotate(art.angle);\n\n            const layerArr = this.klCanvas.getLayersFast();\n            for (let i = 0; i < layerArr.length; i++) {\n                if (!layerArr[i].isVisible || layerArr[i].opacity === 0) {\n                    continue;\n                }\n\n                ctx.globalAlpha = layerArr[i].opacity;\n                ctx.globalCompositeOperation = layerArr[i].mixModeStr;\n\n                const compositeObj = layerArr[i].canvas.compositeObj;\n                if (compositeObj) {\n                    if (this.compositeCanvas.width !== layerArr[i].canvas.width || this.compositeCanvas.height !== layerArr[i].canvas.height) {\n                        this.compositeCanvas.width = layerArr[i].canvas.width;\n                        this.compositeCanvas.height = layerArr[i].canvas.height;\n                    } else {\n                        this.compositeCtx.clearRect(0, 0, this.compositeCanvas.width, this.compositeCanvas.height);\n                    }\n                    this.compositeCtx.drawImage(layerArr[i].canvas, 0, 0);\n                    compositeObj.draw(this.compositeCtx);\n                    ctx.drawImage(this.compositeCanvas, 0, 0, w, h);\n                } else {\n                    ctx.drawImage(layerArr[i].canvas, 0, 0, w, h);\n                }\n            }\n            ctx.globalAlpha = 1;\n\n\n\n        }\n        ctx.restore();\n\n        // rotation hud\n        if (TMode.Rotate === this.currentMode || TMode.Rotating === this.currentMode) {\n            this.svgOverlay.updateCompass({\n                isVisible: true,\n                angleDeg: art.angle / Math.PI * 180,\n            });\n        } else {\n            this.svgOverlay.updateCompass({\n                isVisible: false,\n            });\n        }\n    }\n\n    private workspaceToCanvasCoord (p: IVector2D): IVector2D {\n        const art = this.getRenderedTransform();\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\n\n        let coords: TVec4 = [p.x, p.y, 0, 1];\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n\n        return {\n            x: coords[0],\n            y: coords[1],\n        };\n    }\n\n    private canvasToWorkspaceCoord (p: IVector2D, transformObj: ITransform): IVector2D {\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(transformObj.x, transformObj.y));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(transformObj.angle));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(transformObj.scale));\n\n        let coords: TVec4 = [p.x, p.y, 0, 1];\n        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n\n        return {\n            x: coords[0],\n            y: coords[1],\n        };\n    }\n\n    private snapAngleRad (angleRad: number, snapDegIncrement: number, maxDistDeg: number): number {\n        let angleDeg = angleRad * 180 / Math.PI;\n        const modDeg = Math.abs(angleDeg % snapDegIncrement);\n        const dist = Math.min(modDeg, snapDegIncrement - modDeg);\n\n        if (dist <= maxDistDeg) {\n            angleDeg = Math.round(angleDeg / snapDegIncrement) * snapDegIncrement;\n        }\n\n        return angleDeg / 180 * Math.PI;\n    }\n\n    /**\n     * angle always in range [-PI, PI]\n     * @param angleRad\n     * @private\n     */\n    private minimizeAngleRad (angleRad: number): number {\n        angleRad = angleRad % (2 * Math.PI);\n        if (angleRad > Math.PI) {\n            angleRad -= 2 * Math.PI;\n        } else if (angleRad < -Math.PI) {\n            angleRad += 2 * Math.PI;\n        }\n        return angleRad;\n    }\n\n    private resetInputProcessor (): void {\n        this.currentInputProcessor = null;\n        this.updateCursor(this.globalMode);\n        this.reqFrame(true);\n    }\n\n    private reqFrame (doRedrawCanvas?: boolean): void {\n        this.animationFrameRequested = true;\n        if (doRedrawCanvas) {\n            this.lastRenderedState = -1;\n        }\n    }\n\n    private updateLoop (): void {\n        window.requestAnimationFrame(() => this.updateLoop());\n        const newState = klHistory.getState();\n        const doRender = this.lastRenderedState < newState;\n\n        //handle variable framerate\n        const nowTime = performance.now();\n        const elapsedFrames = (nowTime - this.lastRenderTime) * 60 / 1000; //how many frames elapsed since last render if fps were 60fps\n        this.lastRenderTime = nowTime;\n\n        if (this.animationFrameRequested || doRender) {\n            this.animationFrameRequested = false;\n            this.checkChange(elapsedFrames);\n        }\n    }\n\n    private checkChange (elapsedFrames: number): void {\n\n        const newState = klHistory.getState();\n        const doRender = this.lastRenderedState < newState ||\n            this.highResTransformObj.scale !== this.targetTransformObj.scale ||\n            this.highResTransformObj.x !== this.targetTransformObj.x ||\n            this.highResTransformObj.y !== this.targetTransformObj.y;\n\n        //update transform\n        if (\n            !this.doAnimateTranslate &&\n            (\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\n            )\n        ) {\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\n            this.highResTransformObj.x = this.targetTransformObj.x;\n            this.highResTransformObj.y = this.targetTransformObj.y;\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\n            if (this.transformIsDirty) {\n                this.transformIsDirty = false;\n                this.bgVisible = this.testBgVisible();\n            }\n\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\n        } else if (\n            (this.highResTransformObj.x === this.targetTransformObj.x || Math.abs(this.highResTransformObj.x - this.targetTransformObj.x) < 0.5) &&\n            (this.highResTransformObj.y === this.targetTransformObj.y || Math.abs(this.highResTransformObj.y - this.targetTransformObj.y) < 0.5) &&\n            (\n                this.highResTransformObj.scale === this.targetTransformObj.scale ||\n                Math.abs(this.highResTransformObj.scale - this.targetTransformObj.scale) < 0.008 * this.targetTransformObj.scale\n            )\n        ) {\n            this.highResTransformObj.scale = this.targetTransformObj.scale;\n            this.highResTransformObj.x = this.targetTransformObj.x;\n            this.highResTransformObj.y = this.targetTransformObj.y;\n            this.highResTransformObj.angle = this.targetTransformObj.angle;\n            this. doAnimateTranslate = false;\n            if (this.transformIsDirty) {\n                this.transformIsDirty = false;\n                this.bgVisible = this.testBgVisible();\n            }\n\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\n        } else {\n            this.reqFrame(); //probably needs another frame\n            const blendFactor = Math.min(1, ANIMATION_SPEED * elapsedFrames);\n            this.mixTransformObj(this.highResTransformObj, this.targetTransformObj, blendFactor);\n            this.bgVisible = true; // spare yourself the calculation\n            this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\n        }\n\n        if (this.pointer && this.currentMode == TMode.Draw && !this.usesCssCursor) {\n            this.svgOverlay.updateCursor({\n                x: this.pointer.x,\n                y: this.pointer.y,\n                isVisible: true,\n            });\n        } else {\n            this.svgOverlay.updateCursor({isVisible: false});\n        }\n\n\n        if (doRender) {\n            //console.log('scale', this.renderedTransform.scale, 'x', this.renderedTransform.x, 'y', this.renderedTransform.y);\n            this.lastRenderedState = newState;\n            const start = performance.now();\n            this.render();\n            this.renderTime = BB.mix(this.renderTime, performance.now() - start, 0.05);\n        }\n        //setTimeout(this.checkChange, 100);\n\n\n\n        if (doRender) {\n\n            //console.log('rendertime ms: ', this.renderTime);\n        }\n\n    }\n\n    // ---- public ----\n\n    constructor (\n        p: {\n            klCanvas: KlCanvas;\n            width: number;\n            height: number;\n            onDraw: (val: TDrawEvent) => void;\n            onPick: (rgb: IRGB, isPointerup: boolean) => void;\n            onFill: (canvasX: number, canvasY: number) => void;\n            onGradient: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\n            onText: (canvasX: number, canvasY: number, angleRad: number) => void;\n            onShape: (type: 'down' | 'up' | 'move', canvasX: number, canvasY: number, angleRad: number) => void;\n            onViewChange: (e:  IViewChangeEvent) => void;\n            onUndo: () => void;\n            onRedo: () => void;\n        }\n    ) {\n        this.rootEl = BB.el({\n            css: {\n                position: 'absolute',\n                left: '0',\n                right: '0',\n                top: '0',\n                bottom: '0',\n                cursor: 'crosshair',\n                userSelect: 'none',\n            },\n        });\n        this.klCanvas = p.klCanvas;\n        this.onViewChange = p.onViewChange;\n        this.renderTargetCanvas = BB.canvas(p.width, p.height);\n        this.renderTargetCtx = BB.ctx(this.renderTargetCanvas);\n        this.renderWidth = p.width;\n        this.renderHeight = p.height;\n        this.compositeCanvas = BB.canvas(1, 1); // for drawing klcanvas layer composite\n        this.compositeCtx = BB.ctx(this.compositeCanvas);\n        this.doResizeCanvas = false;\n        this.oldTransformObj = null;\n        this.targetTransformObj = {\n            x: 0,\n            y: 0,\n            scale: 1,\n            angle: 0,\n        };\n        this.highResTransformObj = {\n            x: 0,\n            y: 0,\n            scale: 1,\n            angle: 0,\n        };\n        this.renderedTransformObj = {} as ITransform;\n        this.cursorPos = {\n            x: 0,\n            y: 0,\n        };\n        this.usesCssCursor = false;\n        this.bgVisible = true;\n        this.transformIsDirty = true;\n        this.doAnimateTranslate = true;\n\n        this.svgOverlay = new WorkspaceSvgOverlay({\n            width: p.width,\n            height: p.height,\n        });\n\n        BB.css(this.renderTargetCanvas, {\n            userSelect: 'none',\n            pointerEvents: 'none',\n        });\n        BB.createCheckerDataUrl(8, (url) => {\n            this.renderTargetCanvas.style.background = 'url(' + url + ')';\n        }, theme.isDark());\n\n        theme.addIsDarkListener(() => {\n            this.renderTargetCanvas.style.background = 'url(' + BB.createCheckerDataUrl(8, undefined, theme.isDark()) + ')';\n            this.lastRenderedState = -1;\n            this.reqFrame();\n        });\n\n        this.rootEl.append(this.renderTargetCanvas, this.svgOverlay.getElement());\n        this.rootEl.addEventListener( 'touchend', (e) => {\n            e.preventDefault();\n            return false;\n        });\n        this.rootEl.addEventListener('contextmenu', (e) => {\n            e.preventDefault();\n            return false;\n        });\n        this.rootEl.addEventListener('dragstart', (e) => {\n            e.preventDefault();\n            return false;\n        });\n\n        this.emptyCanvas = BB.canvas(1, 1);\n        this.emptyLightCanvas = BB.canvas(1, 1);\n        {\n            let ctx = BB.ctx(this.emptyCanvas);\n            ctx.fillRect(0, 0, 1, 1);\n            ctx = BB.ctx(this.emptyLightCanvas);\n            ctx.fillStyle = '#fff';\n            ctx.fillRect(0, 0, 1, 1);\n        }\n\n        this.keyListener = new BB.KeyListener({\n            onDown: (keyStr, event, comboStr, isRepeat) => {\n\n                if (KL.dialogCounter.get() > 0 || BB.isInputFocused(true)) {\n                    return;\n                }\n                if (keyStr === 'alt') {\n                    event.preventDefault();\n                }\n                if (isRepeat) {\n                    return;\n                }\n\n                if (this.currentInputProcessor) {\n                    this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n\n                } else {\n\n                    if ([TMode.Draw, TMode.Pick, TMode.Fill, TMode.Gradient, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'space') {\n                        this.currentInputProcessor = this.inputProcessorObj.spaceHand;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n\n                    if ([TMode.Draw, TMode.Hand, TMode.Fill, TMode.Gradient, TMode.Text, TMode.Shape].includes(this.globalMode) && comboStr === 'alt') {\n                        this.currentInputProcessor = this.inputProcessorObj.altPicker;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n\n                    if (['r', 'shift+r'].includes(comboStr)) {\n                        this.currentInputProcessor = this.inputProcessorObj.rotate;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n\n                    if ('z' === comboStr) {\n                        this.currentInputProcessor = this.inputProcessorObj.zoom;\n                        this.currentInputProcessor.onKeyDown(keyStr, event, comboStr, isRepeat);\n                        return;\n                    }\n\n                }\n\n            },\n            onUp: (keyStr, event, oldComboStr) => {\n                // prevent menu bar in Firefox\n                if (keyStr === 'alt') {\n                    event.preventDefault();\n                }\n\n                if (this.currentInputProcessor) {\n                    this.currentInputProcessor.onKeyUp(keyStr, event, oldComboStr);\n                }\n            },\n        });\n\n        this.updateChangeListener();\n\n        this.currentMode = TMode.Draw;\n        this.globalMode = TMode.Draw;\n\n        this.renderTime = 0;\n\n        this.lastDrawEvent = null;\n\n        this.linetoolProcessor = new LinetoolProcessor({\n            onDraw: (event) => {\n                const getMatrix = () => {\n                    const art = this.getRenderedTransform();\n                    let matrix = BB.Matrix.getIdentity();\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(1/art.scale));\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(-art.angle));\n                    matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-art.x, -art.y));\n                    return matrix;\n                };\n\n                if (event.type === 'line' && !this.lastDrawEvent) {\n                    const matrix = getMatrix();\n                    let coords: TVec4 = [event.x1, event.y1, 0, 1];\n                    coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n                    this.lastDrawEvent = {\n                        x: coords[0],\n                        y: coords[1],\n                        pressure: event.pressure1,\n                    };\n                    return;\n                }\n\n                if ('x' in event || 'x0' in event) {\n\n                    const matrix = getMatrix();\n\n                    if ('x' in event) { //down or move\n                        let coords: TVec4 = [event.x, event.y, 0, 1];\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n                        event.x = coords[0];\n                        event.y = coords[1];\n                    }\n                    if ('x0' in event) { //line\n                        event.x0 = this.lastDrawEvent!.x;\n                        event.y0 = this.lastDrawEvent!.y;\n                        event.pressure0 = this.lastDrawEvent!.pressure;\n                        let coords: TVec4 = [event.x1, event.y1, 0, 1];\n                        coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n                        event.x1 = coords[0];\n                        event.y1 = coords[1];\n\n                        this.lastDrawEvent = {\n                            x: event.x1,\n                            y: event.y1,\n                            pressure: event.pressure1,\n                        };\n                    }\n                }\n\n\n                if (event.type === 'down' || event.type === 'move') {\n                    this.lastDrawEvent = {\n                        x: event.x,\n                        y: event.y,\n                        pressure: event.pressure,\n                    };\n                }\n                p.onDraw(event);\n            },\n        });\n\n        this.pointer = null;\n        this.isDrawing = false;\n\n\n        this.inputProcessorObj = {\n            draw: {\n                onPointer: (val) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Draw);\n\n                    const comboStr = this.keyListener.getComboStr();\n\n                    const event: any = {\n                        scale: this.highResTransformObj.scale,\n                    };\n                    event.shiftIsPressed = comboStr === 'shift';\n                    event.pressure = val.pressure;\n                    event.isCoalesced = !!val.isCoalesced;\n\n                    if (val.type === 'pointerdown') {\n\n                        this.isDrawing = true;\n                        event.type = 'down';\n\n                    } else if (val.button) {\n                        event.type = 'move';\n\n                    } else if (val.type === 'pointerup') {\n\n                        this.isDrawing = false;\n                        event.type = 'up';\n\n                        this.linetoolProcessor.process(event);\n                        this.resetInputProcessor();\n                        return;\n                    } else {\n                        return;\n                    }\n\n                    event.x = val.relX;\n                    event.y = val.relY;\n\n                    this.linetoolProcessor.process(event);\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                },\n            },\n            fill: {\n                onPointer: (event) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Fill);\n\n                    if (event.type === 'pointerdown') {\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n                        p.onFill(Math.floor(coord.x), Math.floor(coord.y));\n\n                    } else if (event.type === 'pointerup') {\n                        this.resetInputProcessor();\n                        return;\n\n                    }\n\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                },\n            },\n            gradient: {\n                onPointer: (event) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Gradient);\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n\n                    if (event.type === 'pointerdown') {\n                        this.isDrawing = true;\n                        p.onGradient('down', coord.x, coord.y, this.renderedTransformObj.angle);\n\n                    } else if (event.type === 'pointermove') {\n                        p.onGradient('move', coord.x, coord.y, this.renderedTransformObj.angle);\n\n                    } else if (event.type === 'pointerup') {\n                        this.isDrawing = false;\n                        p.onGradient('up', coord.x, coord.y, this.renderedTransformObj.angle);\n                        this.resetInputProcessor();\n\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                },\n            },\n            text: {\n                onPointer: (event) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Text);\n\n                    if (event.type === 'pointerdown') {\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n                        p.onText(Math.floor(coord.x), Math.floor(coord.y), this.renderedTransformObj.angle);\n\n                    } else if (event.type === 'pointerup') {\n                        this.resetInputProcessor();\n                        return;\n\n                    }\n\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                },\n            },\n            shape: {\n                onPointer: (event) => {\n\n                    this.reqFrame();\n                    this.updateCursor(TMode.Shape);\n                    const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n\n                    if (event.type === 'pointerdown') {\n                        this.isDrawing = true;\n                        p.onShape('down', coord.x, coord.y, this.renderedTransformObj.angle);\n\n                    } else if (event.type === 'pointermove') {\n                        p.onShape('move', coord.x, coord.y, this.renderedTransformObj.angle);\n\n                    } else if (event.type === 'pointerup') {\n                        this.isDrawing = false;\n                        p.onShape('up', coord.x, coord.y, this.renderedTransformObj.angle);\n                        this.resetInputProcessor();\n\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                },\n            },\n            hand: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Hand);\n                    if (['left', 'middle'].includes(event.button || '')) {\n                        this.updateCursor(TMode.HandGrabbing);\n                        this.targetTransformObj.x += event.dX;\n                        this.targetTransformObj.y += event.dY;\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\n                        this.doAnimateTranslate = false;\n                        this.transformIsDirty = true;\n                        this.reqFrame(true);\n                    } else if (event.type === 'pointerup') {\n                        this.resetInputProcessor();\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                },\n            },\n            spaceHand: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Hand);\n                    if (['left', 'middle'].includes(event.button || '')) {\n                        this.updateCursor(TMode.HandGrabbing);\n                        this.targetTransformObj.x += event.dX;\n                        this.targetTransformObj.y += event.dY;\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\n                        this.doAnimateTranslate = false;\n                        this.transformIsDirty = true;\n                        this.reqFrame(true);\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n                    if (comboStr !== 'space') {\n                        this.resetInputProcessor();\n                    } else {\n                        this.updateCursor(TMode.Hand);\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr) => {\n                    this.resetInputProcessor();\n                },\n            },\n            zoom: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Zoom);\n\n                    if (event.button === 'left' && !event.isCoalesced && event.dX != 0) {\n\n                        const offsetX = event.pageX - event.relX;\n                        const offsetY = event.pageY - event.relY;\n\n                        this.internalZoomByStep(event.dX / 175, event.downPageX! - offsetX, event.downPageY! - offsetY);\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\n                        this.lastRenderedState = -1;\n                        this.reqFrame();\n\n                        this.onViewChange({\n                            changed: ['scale'],\n                            angle: this.targetTransformObj.angle,\n                            scale: this.targetTransformObj.scale,\n                        });\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n                    if (comboStr !== 'z') {\n                        this.resetInputProcessor();\n                    } else {\n                        this.updateCursor(TMode.Zoom);\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr) => {\n                    this.resetInputProcessor();\n                },\n            },\n            picker: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Pick);\n                    if (\n                        (['left', 'right'].includes(event.button || '') && !event.isCoalesced) ||\n                        event.type === 'pointerup'\n                    ) {\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\n                        p.onPick(pickedColor, event.type === 'pointerup');\n                        this.svgOverlay.updateColorPreview({\n                            x: event.relX,\n                            y: event.relY,\n                            color: pickedColor,\n                            isVisible: event.type !== 'pointerup',\n                        });\n\n                        if (event.type === 'pointerup') {\n                            this.resetInputProcessor();\n                        }\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr) => {\n\n                },\n            },\n            altPicker: {\n                onPointer: (event) => {\n                    this.updateCursor(TMode.Pick);\n                    if (\n                        (['left', 'right'].includes(event.button || '') && !event.isCoalesced) ||\n                        event.type === 'pointerup'\n                    ) {\n                        const coord = this.workspaceToCanvasCoord({x: event.relX, y: event.relY});\n                        const pickedColor = this.klCanvas.getColorAt(coord.x, coord.y);\n                        p.onPick(pickedColor, event.type === 'pointerup');\n                        this.svgOverlay.updateColorPreview({\n                            x: event.relX,\n                            y: event.relY,\n                            color: pickedColor,\n                            isVisible: event.type !== 'pointerup',\n                        });\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n                    if (comboStr !== 'alt') {\n                        this.resetInputProcessor();\n                    } else {\n                        this.updateCursor(TMode.Pick);\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr) => {\n                    this.resetInputProcessor();\n                },\n            },\n            rotate: {\n                onPointer: (event) => {\n                    this.updateCursor(event.button === 'left' ? TMode.Rotating : TMode.Rotate);\n\n                    if (event.type === 'pointerdown' && event.button === 'left') {\n                        this.oldTransformObj = BB.copyObj(this.targetTransformObj);\n                    } else if (event.button === 'left' && !event.isCoalesced && this.oldTransformObj) {\n\n\n                        const offsetX = event.pageX - event.relX;\n                        const offsetY = event.pageY - event.relY;\n                        //rotation done around center\n                        const centerObj = {\n                            x: this.renderWidth / 2,\n                            y: this.renderHeight / 2,\n                        };\n\n                        const startAngleRad = BB.Vec2.angle(centerObj, {x: event.downPageX! - offsetX, y: event.downPageY! - offsetY});\n                        const angleRad = BB.Vec2.angle(centerObj, {x: event.pageX - offsetX, y: event.pageY - offsetY});\n                        let dAngleRad = angleRad - startAngleRad;\n\n                        //apply angle\n                        this.targetTransformObj = BB.copyObj(this.oldTransformObj);\n                        this.targetTransformObj.angle += dAngleRad;\n\n                        if (this.keyListener.isPressed('shift')) {\n                            this.targetTransformObj.angle = Math.round(this.targetTransformObj.angle / Math.PI * 8) * Math.PI / 8; //snap the angle to 45/2 degs\n                            dAngleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\n                        }\n\n                        this.targetTransformObj.angle = this.minimizeAngleRad(this.targetTransformObj.angle);\n\n                        //rotate transform.xy\n                        let matrix = BB.Matrix.getIdentity();\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\n                        //matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(effectiveFactor));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(dAngleRad));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\n                        //matrix = multiplyMatrices(matrix, createTranslationMatrix(val.x - val.startX, val.y - val.startY));\n\n                        let origin: TVec4 = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\n                        this.targetTransformObj.x = origin[0];\n                        this.targetTransformObj.y = origin[1];\n\n                        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\n\n                        this.transformIsDirty = true;\n                        this.lastRenderedState = -1;\n                        this.reqFrame();\n\n                        this.onViewChange({\n                            changed: ['angle'],\n                            scale: this.targetTransformObj.scale,\n                            angle: this.targetTransformObj.angle,\n                        });\n\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyDown: (keyStr, event, comboStr, isRepeat) => {\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\n                        this.updateCursor(TMode.Rotate);\n                    } else {\n                        this.resetInputProcessor();\n                    }\n                },\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                onKeyUp: (keyStr, event, oldComboStr) => {\n                    const comboStr = this.keyListener.getComboStr();\n                    if (['r', 'r+shift', 'shift+r', 'r+left', 'r+right', 'r+left+right', 'r+right+left', 'r+up'].includes(comboStr)) {\n                        this.updateCursor(TMode.Rotate);\n                    } else {\n                        this.resetInputProcessor();\n                    }\n                },\n            },\n        };\n        this.currentInputProcessor = null;\n\n\n        this.angleIsExtraSticky = false;\n        this.pinchZoomer = new BB.PinchZoomer({\n            onPinch: (event) => {\n\n                if (event.type === 'move') {\n\n                    if (!this.oldTransformObj) {\n                        this.oldTransformObj = BB.copyObj(this.targetTransformObj);\n                        this.angleIsExtraSticky = this.targetTransformObj.angle % (Math.PI / 2) === 0;\n                    }\n\n                    this.targetTransformObj = BB.copyObj(this.oldTransformObj);\n\n                    event.scale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, this.targetTransformObj.scale * event.scale)) / this.targetTransformObj.scale;\n\n                    this.targetTransformObj.scale *= event.scale;\n                    this.targetTransformObj.angle += event.angleRad;\n                    this.targetTransformObj.angle = this.minimizeAngleRad(\n                        this.snapAngleRad(\n                            this.targetTransformObj.angle,\n                            90,\n                            this.angleIsExtraSticky ? 12 : 4\n                        )\n                    );\n                    if (this.targetTransformObj.angle % (Math.PI / 2) !== 0) {\n                        this.angleIsExtraSticky = false;\n                    }\n                    //targetTransformObj.angle = minimizeAngleRad(snapAngleRad(targetTransformObj.angle, 90, 7));\n                    event.angleRad = this.targetTransformObj.angle - this.oldTransformObj.angle;\n\n                    //calc translation\n                    {\n                        let matrix = BB.Matrix.getIdentity();\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX, event.relY));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createScaleMatrix(event.scale));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(event.angleRad));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-event.relX, -event.relY));\n                        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(event.relX - event.downRelX, event.relY - event.downRelY));\n\n\n                        let origin: TVec4 = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\n                        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\n\n                        this.targetTransformObj.x = origin[0];\n                        this.targetTransformObj.y = origin[1];\n\n                    }\n\n                    this.highResTransformObj = BB.copyObj(this.targetTransformObj);\n\n                    //if (event.scale !== 1) {\n                    this.onViewChange({\n                        changed: ['scale', 'angle'],\n                        scale: this.targetTransformObj.scale,\n                        angle: this.targetTransformObj.angle,\n                    });\n                    //}\n                    this.reqFrame();\n                    this.transformIsDirty = true;\n                    this.lastRenderedState = -1;\n\n\n                } else if (event.type === 'end') {\n                    this.oldTransformObj = null;\n                }\n\n\n            },\n        });\n\n        const onDoubleTap = (event: IDoubleTapperEvent) => {\n            if (this.fitView(true)) {\n                this.lastRenderedState = -1;\n                this.reqFrame();\n            } else {\n                // zoom 2 steps further\n\n                const didZoom = this.internalZoomByStep(\n                    2,\n                    event.relX,\n                    event.relY,\n                );\n                if (didZoom) {\n                    this.onViewChange({\n                        changed: ['scale'],\n                        angle: this.targetTransformObj.angle,\n                        scale: this.targetTransformObj.scale,\n                    });\n                }\n\n                //updateCursor(TMode.Draw, true);\n                this.lastRenderedState = -1;\n            }\n        };\n\n        this.mainDoubleTapper = new BB.DoubleTapper({ onDoubleTap });\n        this.middleDoubleTapper = new BB.DoubleTapper({ onDoubleTap });\n        this.middleDoubleTapper.setAllowedButtonArr(['middle']);\n\n\n        this.twoFingerTap = new BB.NFingerTapper({\n            fingers: 2,\n            onTap: () => {\n                p.onUndo();\n            },\n        });\n        this.threeFingerTap = new BB.NFingerTapper({\n            fingers: 3,\n            onTap: () => {\n                p.onRedo();\n            },\n        });\n\n\n        this.pointerEventChain = new BB.EventChain({\n            chainArr: [\n                this.twoFingerTap as IChainElement,\n                this.threeFingerTap as IChainElement,\n                this.mainDoubleTapper as IChainElement,\n                this.middleDoubleTapper as IChainElement,\n                this.pinchZoomer as IChainElement,\n                new BB.OnePointerLimiter() as IChainElement,\n                new BB.CoalescedExploder() as IChainElement,\n            ],\n        });\n        this.pointerEventChain.setChainOut((event: ICoalescedPointerEvent) => {\n\n            this.cursorPos.x = event.relX;\n            this.cursorPos.y = event.relY;\n            if (event.type === 'pointerup' && event.pointerType === 'touch') {\n                this.pointer = null;\n                this.lastRenderedState = -1;\n                this.reqFrame();\n            } else {\n                if (!this.pointer) {\n                    this.pointer = { x: 0, y: 0 };\n                }\n                this.pointer.x = event.relX;\n                this.pointer.y = event.relY;\n            }\n\n            if (this.currentInputProcessor) {\n                this.currentInputProcessor.onPointer(event);\n\n            } else {\n\n                const comboStr = this.keyListener.getComboStr();\n\n                if (this.globalMode === TMode.Draw) {\n\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.draw;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Draw);\n                        this.reqFrame();\n                    }\n\n                } else if (this.globalMode === TMode.Hand) {\n\n                    if (event.type === 'pointerdown' && ['left', 'middle'].includes(event.button || '')) {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Hand);\n                    }\n\n                } else if (this.globalMode === TMode.Pick) {\n\n                    if (event.type === 'pointerdown' && ['left', 'right'].includes(event.button || '')) {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Pick);\n                    }\n\n                } else if (this.globalMode === TMode.Fill) {\n\n                    if (event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.fill;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Fill);\n                        this.reqFrame();\n                    }\n\n                } else if (this.globalMode === TMode.Gradient) {\n\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.gradient;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Gradient);\n                        this.reqFrame();\n                    }\n\n                } else if (this.globalMode === TMode.Text) {\n\n                    if (event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.text;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Text);\n                        this.reqFrame();\n                    }\n\n                } else if (this.globalMode === TMode.Shape) {\n\n                    if (['', 'shift', 'ctrl'].includes(comboStr) && event.type === 'pointerdown' && event.button === 'left') {\n                        this.currentInputProcessor = this.inputProcessorObj.shape;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'right') {\n                        this.currentInputProcessor = this.inputProcessorObj.picker;\n                        this.currentInputProcessor.onPointer(event);\n                    } else if ([''].includes(comboStr) && event.type === 'pointerdown' && event.button === 'middle') {\n                        this.currentInputProcessor = this.inputProcessorObj.hand;\n                        this.currentInputProcessor.onPointer(event);\n                    } else {\n                        this.updateCursor(TMode.Shape);\n                        this.reqFrame();\n                    }\n\n                }\n\n\n            }\n\n        });\n\n        //prevent ctrl scroll -> zooming page\n        this.rootEl.addEventListener('wheel', (event) => {\n            event.preventDefault();\n        });\n\n\n        setTimeout(() => {\n            this.pointerListener = new BB.PointerListener({\n                target: this.rootEl,\n                fixScribble: true,\n                onPointer: (e) => {\n                    if (e.type === 'pointerdown' && e.button === 'middle') {\n                        try {\n                            e.eventPreventDefault();\n                        } catch (e) {\n                            /* empty */\n                        }\n                    }\n                    // prevent manual slider input keeping focus on iPad\n                    if (e.type === 'pointerdown') {\n                        BB.unfocusAnyInput();\n                    }\n                    /*if (e.type === 'pointermove') {\n                        BB.throwOut(JSON.stringify(e));\n                    }*/\n\n                    this.pointerEventChain.chainIn(e);\n                },\n                onWheel: (wheelEvent) => {\n\n                    if (this.isDrawing) {\n                        return;\n                    }\n\n                    this.reqFrame();\n                    const didZoom = this.internalZoomByStep(\n                        -wheelEvent.deltaY / (this.keyListener.isPressed('shift') ? 8 : 2),\n                        wheelEvent.relX,\n                        wheelEvent.relY\n                    );\n                    if (didZoom) {\n                        this.onViewChange({\n                            changed: ['scale'],\n                            angle: this.targetTransformObj.angle,\n                            scale: this.targetTransformObj.scale,\n                        });\n                    }\n\n                    //updateCursor(TMode.Draw, true);\n                    this.lastRenderedState = -1;\n\n\n                },\n                onEnterLeave: (isOver) => {\n                    if (!isOver) {\n                        if (!this.isDrawing) {\n                            this.pointer = null;\n                            this.lastRenderedState = -1;\n                        }\n                    }\n                },\n                maxPointers: 4,\n            });\n        }, 1);\n\n        this.brushRadius = 1;\n\n        this.animationFrameRequested = false;\n\n\n\n\n        //setup rendering\n        this.lastRenderedState = -2;\n        this.lastRenderTime = performance.now();\n\n        window.requestAnimationFrame(() => this.updateLoop());\n\n        this.resetOrFitView();\n    }\n\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setCanvas (klC: KlCanvas): void {\n        this.klCanvas = klC;\n        this.lastDrawEvent = null;\n        this.resetView();\n\n        this.updateChangeListener();\n\n        this.lastRenderedState = -1;\n        this.reqFrame();\n    }\n\n    /**\n     * set size of workspace area in pixels\n     * @param width\n     * @param height\n     */\n    setSize (width: number, height: number): void {\n        const oldWidth = this.renderWidth;\n        const oldHeight = this.renderHeight;\n\n        if (width === oldWidth && height === oldHeight) {\n            return;\n        }\n\n        this.doResizeCanvas = true;\n        this.renderWidth = width;\n        this.renderHeight = height;\n\n        this.svgOverlay.setSize(width, height);\n\n        this.targetTransformObj.x += (width - oldWidth) / 2;\n        this.targetTransformObj.y += (height - oldHeight) / 2;\n\n        this.highResTransformObj.x = this.targetTransformObj.x;\n        this.highResTransformObj.y = this.targetTransformObj.y;\n\n        this.bgVisible = this.testBgVisible();\n\n        this.lastRenderedState = -1;\n        this.reqFrame();\n    }\n\n    setMode (modeStr: TModeStr): void {\n        //only sets the base mode\n        if (modeStr === 'draw') {\n            this.globalMode = TMode.Draw;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'fill') {\n            this.globalMode = TMode.Fill;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'gradient') {\n            this.globalMode = TMode.Gradient;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'text') {\n            this.globalMode = TMode.Text;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'shape') {\n            this.globalMode = TMode.Shape;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n        if (modeStr === 'hand') {\n            this.globalMode = TMode.Hand;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['mouse', 'pen', 'touch']);\n        }\n        if (modeStr === 'pick') {\n            this.globalMode = TMode.Pick;\n            this.mainDoubleTapper.setAllowedPointerTypeArr(['touch']);\n        }\n    }\n\n    getMode (): TModeStr {\n        if (this.globalMode === TMode.Draw) {\n            return 'draw';\n        }\n        if (this.globalMode === TMode.Fill) {\n            return 'fill';\n        }\n        if (this.globalMode === TMode.Gradient) {\n            return 'gradient';\n        }\n        if (this.globalMode === TMode.Text) {\n            return 'text';\n        }\n        if (this.globalMode === TMode.Shape) {\n            return 'shape';\n        }\n        if (this.globalMode === TMode.Hand) {\n            return 'hand';\n        }\n        if (this.globalMode === TMode.Pick) {\n            return 'pick';\n        }\n        throw new Error('unknown globalMode');\n    }\n\n    setCursorSize (diameter: number): void {\n        this.brushRadius = diameter / 2;\n\n        this.svgOverlay.updateCursor({radius: this.brushRadius * this.highResTransformObj.scale});\n\n        if (this.pointer === null) {\n            this.hideBrushCursorTimeout && clearTimeout(this.hideBrushCursorTimeout);\n\n            this.svgOverlay.updateCursor({\n                x: this.renderWidth / 2,\n                y: this.renderHeight / 2,\n                isVisible: true,\n            });\n\n            this.hideBrushCursorTimeout = setTimeout(() => {\n                if (this.pointer !== null) {\n                    return;\n                }\n                this.svgOverlay.updateCursor({isVisible: false});\n            }, 500);\n        }\n    }\n\n    zoomByStep (stepNum: number): void {\n        if (!this.internalZoomByStep(stepNum, this.renderWidth / 2, this.renderHeight / 2)) {\n            return;\n        }\n\n        this.lastRenderedState = -1;\n        this.reqFrame();\n\n        this.onViewChange({\n            changed: ['scale'],\n            angle: this.targetTransformObj.angle,\n            scale: this.targetTransformObj.scale,\n        });\n    }\n\n    resetView (doAnimate?: boolean): void {\n        this.targetTransformObj.scale = 1;\n        this.targetTransformObj.angle = 0;\n\n        this.targetTransformObj.x = (this.renderWidth - this.klCanvas.getWidth()) / 2;\n        this.targetTransformObj.y = (this.renderHeight - this.klCanvas.getHeight()) / 2;\n\n        if (doAnimate) {\n            this.doAnimateTranslate = true;\n            this.transformIsDirty = true;\n        } else {\n            this.highResTransformObj = BB.copyObj(this.targetTransformObj);\n        }\n\n        this.bgVisible = this.testBgVisible();\n        this.reqFrame();\n\n        if (doAnimate) {\n            this.onViewChange({\n                changed: ['scale', 'angle'],\n                scale: this.targetTransformObj.scale,\n                angle: this.targetTransformObj.angle,\n            });\n        }\n    }\n\n    /**\n     * fit into view. center. snap angle. padding\n     * returns true if transform changes\n     */\n    fitView (doAnimate?: boolean): boolean {\n        // determine new transform\n        const newAngle = this.snapAngleRad(this.targetTransformObj.angle, 90, 90);\n\n        //calc width and height of bounds\n        const canvasPointsArr = [\n            [0, 0], // top left\n            [this.klCanvas.getWidth(), 0], // top right\n            [this.klCanvas.getWidth(), this.klCanvas.getHeight()], // bottom right\n            [0, this.klCanvas.getHeight()], // bottom left\n            [this.klCanvas.getWidth() / 2, this.klCanvas.getHeight() / 2], // center\n        ];\n\n        //setup transformation matrix\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(newAngle));\n\n        //rotate points\n        for (let i = 0; i < canvasPointsArr.length; i++) {\n            let coords: TVec4 = [canvasPointsArr[i][0], canvasPointsArr[i][1], 0, 1];\n            coords = BB.Matrix.multiplyMatrixAndPoint(matrix, coords);\n            canvasPointsArr[i][0] = coords[0];\n            canvasPointsArr[i][1] = coords[1];\n        }\n\n        const boundsObj: Partial<IBounds> = {};\n        for (let i = 0; i < canvasPointsArr.length; i++) {\n            if (boundsObj.x1 === undefined || canvasPointsArr[i][0] < boundsObj.x1) {\n                boundsObj.x1 = canvasPointsArr[i][0];\n            }\n            if (boundsObj.y1 === undefined || canvasPointsArr[i][1] < boundsObj.y1) {\n                boundsObj.y1 = canvasPointsArr[i][1];\n            }\n            if (boundsObj.x2 === undefined || canvasPointsArr[i][0] > boundsObj.x2) {\n                boundsObj.x2 = canvasPointsArr[i][0];\n            }\n            if (boundsObj.y2 === undefined || canvasPointsArr[i][1] > boundsObj.y2) {\n                boundsObj.y2 = canvasPointsArr[i][1];\n            }\n        }\n        const boundsWidth = boundsObj.x2! - boundsObj.x1!;\n        const boundsHeight = boundsObj.y2! - boundsObj.y1!;\n\n        //fit bounds\n        const padding = 0;\n        const { width: fitWidth } = BB.fitInto(\n            boundsWidth,\n            boundsHeight, \n            this.renderWidth - padding, \n            this.renderHeight - padding, \n            1\n        );\n\n        //determine scale\n        const factor = Math.min(MAX_SCALE, fitWidth / boundsWidth);\n\n        const newTargetTransformObj = {\n            angle: newAngle,\n            x: (this.renderWidth / 2) - (canvasPointsArr[4][0] - canvasPointsArr[0][0]) * factor,\n            y: (this.renderHeight / 2) - (canvasPointsArr[4][1] - canvasPointsArr[0][1]) * factor,\n            scale: factor,\n        };\n\n        if (\n            newTargetTransformObj.angle === this.targetTransformObj.angle &&\n            Math.abs(newTargetTransformObj.x - this.targetTransformObj.x) < 0.0000000001 &&\n            Math.abs(newTargetTransformObj.y - this.targetTransformObj.y) < 0.0000000001 &&\n            newTargetTransformObj.scale === this.targetTransformObj.scale\n        ) {\n            return false;\n        }\n        this.targetTransformObj = newTargetTransformObj;\n\n        if (doAnimate) {\n            this.doAnimateTranslate = true;\n        } else {\n            this.highResTransformObj = BB.copyObj(this.targetTransformObj);\n        }\n        this.transformIsDirty = true;\n        this.reqFrame();\n\n        if (doAnimate) {\n            this.onViewChange({\n                changed: ['scale', 'angle'],\n                scale: this.targetTransformObj.scale,\n                angle: this.targetTransformObj.angle,\n            });\n        }\n        return true;\n    }\n\n    /**\n     * let the workspace decide what is best. E.g. if it's pixel art, Fit might be better.\n     */\n    resetOrFitView (): void {\n        const threshold = 4; // >= 400% zoom. pixelated, not blurry\n        if (\n            !klConfig.disableAutoFit &&\n            this.klCanvas.getWidth() <= this.renderWidth / threshold &&\n            this.klCanvas.getHeight() <= this.renderHeight / threshold\n        ) {\n            this.fitView();\n        } else {\n            this.resetView();\n        }\n    }\n\n    setAngle (angleDeg: number, isRelative?: boolean): void {\n        //rotation done around center\n        const centerObj = {\n            x: this.renderWidth / 2,\n            y: this.renderHeight / 2,\n        };\n\n        const oldAngleRad = this.targetTransformObj.angle;\n        const angleRad = angleDeg / 180 * Math.PI;\n\n        if (isRelative) {\n            this.targetTransformObj.angle += angleRad;\n        } else {\n            this.targetTransformObj.angle = angleRad;\n        }\n\n        this.targetTransformObj.angle = this.minimizeAngleRad(\n            this.snapAngleRad(\n                this.targetTransformObj.angle,\n                90,\n                4\n            )\n        );\n\n        //rotate transform.xy\n        let matrix = BB.Matrix.getIdentity();\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(centerObj.x, centerObj.y));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createRotationMatrix(this.targetTransformObj.angle - oldAngleRad));\n        matrix = BB.Matrix.multiplyMatrices(matrix, BB.Matrix.createTranslationMatrix(-centerObj.x, -centerObj.y));\n\n        let origin: TVec4 = [this.targetTransformObj.x, this.targetTransformObj.y, 0, 1];\n        origin = BB.Matrix.multiplyMatrixAndPoint(matrix, origin);\n        this.targetTransformObj.x = origin[0];\n        this.targetTransformObj.y = origin[1];\n\n        this.highResTransformObj = BB.copyObj(this.targetTransformObj);\n        this.transformIsDirty = true;\n        this.reqFrame(true);\n    }\n\n    /**\n     * translate canvas by viewport pixels\n     * @param tx\n     * @param ty\n     */\n    translateView (tx: number, ty: number): void {\n        const scale = 40;\n\n        this.targetTransformObj.x += tx * scale;\n        this.targetTransformObj.y += ty * scale;\n\n        this.transformIsDirty = true;\n        this.doAnimateTranslate = true;\n        this.reqFrame(true);\n    }\n\n    getIsDrawing (): boolean {\n        return this.isDrawing;\n    }\n\n    getScale (): number {\n        return this.targetTransformObj.scale;\n    }\n\n    getAngleDeg (): number {\n        return this.targetTransformObj.angle * 180 / Math.PI;\n    }\n\n    getMaxScale (): number {\n        return MAX_SCALE;\n    }\n\n    getMinScale (): number {\n        return MIN_SCALE;\n    }\n\n    requestFrame (): void {\n        this.lastRenderedState = -1;\n        this.reqFrame();\n    }\n\n    setLastDrawEvent (x?: number, y?: number, pressure?: number): void {\n        if (x === undefined) {\n            this.lastDrawEvent = null;\n            return;\n        }\n\n        if (!this.lastDrawEvent) {\n            this.lastDrawEvent = {x: 0, y: 0, pressure: 0};\n        }\n        this.lastDrawEvent.x = x;\n        this.lastDrawEvent.y = y!;\n        this.lastDrawEvent.pressure = pressure!;\n    }\n\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"cursor-picker.dc155349.png\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"cursor-zoom-ew.9ecaf1c2.png\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"cursor-fill.999c4916.png\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"cursor-text.582bc0db.png\";","import {IDrawDownEvent, IDrawMoveEvent, IDrawUpEvent, TDrawEvent} from '../kl-types';\nimport {BB} from '../../bb/bb';\n\nconst DIR_X = 0;\nconst DIR_Y = 1;\n\n/**\n * Not really and event chain element. but pretty similar.\n *\n * Processes draw input events. When shift held -> linetool\n * line events - what KlCanvasWorkspace passes onDraw(e)\n *\n * pass input in with process(drawEvent)\n *\n * modifies draw event to include such events:\n * {\n *     type: 'line',\n *     x0: null, // you have to fill that in\n *     y0: null, // you have to fill that in\n *     pressure0: null, // you have to fill that in\n *     x1: number,\n *     y1: number,\n *     pressure1: number\n * }\n */\nexport class LinetoolProcessor {\n\n    private readonly onDraw: (drawEvent: TDrawEvent) => void;\n    private downEvent: IDrawDownEvent | null = null;\n    private eventQueue: (IDrawDownEvent | IDrawMoveEvent | IDrawUpEvent)[] = [];\n    private direction: 0 | 1 | null = null;\n\n    // --- public ---\n    constructor (\n        p : {\n            onDraw: (drawEvent: TDrawEvent) => void;\n        }\n    ) {\n        this.onDraw = p.onDraw;\n    }\n\n    process (event: IDrawDownEvent | IDrawMoveEvent | IDrawUpEvent): void {\n        if (event.type === 'down') {\n            this.downEvent = event;\n            this.direction = null;\n\n            if (event.shiftIsPressed) {\n\n                this.onDraw({\n                    type: 'line',\n                    x0: null,\n                    y0: null,\n                    pressure0: null,\n                    x1: event.x,\n                    y1: event.y,\n                    pressure1: event.pressure,\n                });\n\n                this.eventQueue.push(event);\n                return;\n            }\n\n        }\n\n        if (event.type === 'move' && this.downEvent) {\n\n            if (event.shiftIsPressed) {\n\n                if (this.direction === null) {\n                    const dX = Math.abs(event.x - this.downEvent.x);\n                    const dY = Math.abs(event.y - this.downEvent.y);\n\n                    if (dX > 5 || dY > 5) {\n                        this.direction = dX > dY ? DIR_X : DIR_Y;\n\n                        for (let i = 0; i < this.eventQueue.length; i++) {\n                            const e = this.eventQueue[i];\n                            if (e.type !== 'up') {\n                                if (this.direction === DIR_X) {\n                                    e.y = this.downEvent.y;\n                                } else {\n                                    e.x = this.downEvent.x;\n                                }\n                            }\n                            this.onDraw(BB.copyObj(e));\n                        }\n                        this.eventQueue = [];\n                    }\n                }\n\n                if (this.direction === null) {\n                    this.eventQueue.push(event);\n                    return;\n                }\n\n                if (this.direction === DIR_X) {\n                    event.y = this.downEvent.y;\n                } else {\n                    event.x = this.downEvent.x;\n                }\n\n            } else {\n                if (this.eventQueue.length > 0) {\n                    for (let i = 0; i < this.eventQueue.length; i++) {\n                        this.onDraw(BB.copyObj(this.eventQueue[i]));\n                    }\n                    this.eventQueue = [];\n                }\n            }\n\n        }\n\n        if (event.type === 'up') {\n            this.eventQueue = [];\n            this.downEvent = null;\n        }\n\n        this.onDraw(BB.copyObj(event));\n    }\n}\n","\ntype TKlConfig = {\n    filenameBase: string; // part of filename when downloading drawing\n    disableAutoFit?: boolean;\n};\n\nexport const klConfig: TKlConfig = {\n    filenameBase: 'Klecks',\n};\n","import {BB} from '../../bb/bb';\nimport {IKlBasicLayer} from '../kl-types';\nimport {theme} from '../../theme/theme';\n\n/**\n * preview of image with layers. can do mix modes and opacity.\n * creates a canvas.\n */\nexport class KlCanvasPreview {\n\n    private readonly canvas: HTMLCanvasElement;\n    private readonly ctx: CanvasRenderingContext2D | null;\n    private readonly layers: IKlBasicLayer[];\n    private readonly updateCheckerboard: () => void;\n\n    // --- public ---\n    constructor (\n        p: {\n            width: number;\n            height: number;\n            layers: IKlBasicLayer[]; // items can be changed after the fact - but not the object\n        }\n    ) {\n        this.layers = p.layers;\n\n        const scale = p.width / p.layers[0].image.width;\n        const width = scale > 1 ? p.layers[0].image.width : p.width;\n        const height = scale > 1 ? p.layers[0].image.height : p.height;\n\n        this.canvas = BB.canvas(width, height);\n        this.updateCheckerboard = () => {\n            this.canvas.style.backgroundImage = 'url(' + BB.createCheckerDataUrl(8, undefined, theme.isDark()) + ')';\n        };\n        this.updateCheckerboard();\n        this.ctx = BB.ctx(this.canvas);\n\n        BB.css(this.canvas, {\n            width: '100%',\n            height: '100%',\n            imageRendering: scale > 1 ? 'pixelated' : undefined,\n        });\n\n        setTimeout(() => this.render(), 0);\n        theme.addIsDarkListener(this.updateCheckerboard);\n    }\n\n    getElement (): HTMLCanvasElement {\n        return this.canvas;\n    }\n\n    render (): void {\n        if (!this.ctx) {\n            return;\n        }\n\n        this.ctx.save();\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        for (let i = 0; i < this.layers.length; i++) {\n            const layer = this.layers[i];\n            if (!layer.isVisible || layer.opacity === 0) {\n                continue;\n            }\n            this.ctx.globalAlpha = this.layers[i].opacity;\n            this.ctx.globalCompositeOperation = this.layers[i].mixModeStr as GlobalCompositeOperation;\n            if (this.canvas.width > this.layers[i].image.width) {\n                this.ctx.imageSmoothingEnabled = false;\n            }\n            this.ctx.drawImage(this.layers[i].image, 0, 0, this.canvas.width, this.canvas.height);\n        }\n        this.ctx.restore();\n    }\n\n    destroy (): void {\n        theme.removeIsDarkListener(this.updateCheckerboard);\n    }\n}\n","import {BB} from '../../../bb/bb';\nimport rotateImg from '/src/app/img/ui/cursor-rotate.png';\nimport {KeyListener} from '../../../bb/input/key-listener';\nimport {IVector2D} from '../../../bb/bb-types';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\nimport {\n    copyTransform,\n    IFreeTransform,\n    snapToPixel,\n    TFreeTransformCorner,\n    TFreeTransformEdge,\n    toImageSpace,\n    toTransformSpace,\n} from './free-transform-utils';\n\n/**\n * Free Transform UI\n * rotate, scale, translate\n *\n * - if rotation is multiple of 90 it will snap to pixels, to be more useful for pixel art\n * - when rotation goes from non-multiple of 90 to a multiple, it will snap position and width height to pixels\n * - transform.x, transform.y can sit between pixels (by 0.5) if width or height is odd number.\n *      - this is what complicates things\n * - if transform region small, corner grips move out of the way\n *\n * iX iY, iP.x, iP.y - i indicates image space\n * tX tY, tP.x, tP.y - t indicates transform space\n *\n * Not sure if it can be used for navigable canvas. (especially if canvas rotates view)\n * Probably can't be extended for distort. Needs a different approach.\n *\n * --- DOM structure ---\n * rootEl {\n * \ttransEl [\n * \t\tboundsEl\n * \t\tedges[]\n * \t\tcorners[] - round grips in the corner of transform region\n * \t\tangleGrip\n * \t]\n * }\n *\n */\nexport class FreeTransform {\n\n    // --- private ---\n    private readonly value: IFreeTransform; // coordinates and dimensions of transformation\n    private isConstrained: boolean;\n    private ratio: number; // aspect ratio of transform\n    private viewportTransform: {scale: number; x: number; y: number};\n    private readonly scaled = { // scaled coordinates and dimensions for screen space\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0,\n        corners: [{x: 0, y: 0}], // in transform space\n    };\n    private readonly minSnapDist = 7; // minimal snapping distance in px screen space\n    private snappingEnabled: boolean;\n    private readonly snapX: number[];\n    private readonly snapY: number[];\n    private readonly callback: (transform: IFreeTransform) => void;\n\n\n    private readonly cornerCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\n    private readonly gripSize = 16;\n    private readonly edgeSize = 10;\n\n    private readonly rootEl: HTMLElement; // sits at origin of image\n    private readonly transEl: HTMLElement; // at middle of transform. rotates\n    private readonly boundsEl: HTMLElement; // draggable bounds rectangle with outline\n    private readonly corners: TFreeTransformCorner[] = [];\n    private keyListener: KeyListener;\n    private boundsPointerListener: PointerListener; // BB.PointerListener\n    private anglePointerListener: PointerListener; // BB.PointerListener\n    private readonly edges: TFreeTransformEdge[] = [];\n    private readonly angleGrip: {\n        el: HTMLElement;\n        x: number; // transform space\n        y: number;\n        snap: boolean;\n        updateDOM: () => void;\n    };\n\n    private updateScaled (): void {\n        this.scaled.x = this.value.x * this.viewportTransform.scale;\n        this.scaled.y = this.value.y * this.viewportTransform.scale;\n        this.scaled.width = this.value.width * this.viewportTransform.scale;\n        this.scaled.height = this.value.height * this.viewportTransform.scale;\n        this.scaled.corners = this.corners.map((item) => {\n            return {x: item.x * this.viewportTransform.scale, y: item.y * this.viewportTransform.scale};\n        });\n    }\n\n    /**\n     * Returns snapped point, if ix, iy snaps. If no snapping, returns point unchanged.\n     * both in image space\n     *\n     * @param iX - image space\n     * @param iY - image space\n     * @private\n     */\n    private snapCorner (iX: number, iY: number): IVector2D {\n        if (!this.snappingEnabled) {\n            return {x: iX, y: iY};\n        }\n        let dist: number;\n        const snap: {\n            x?: number;\n            y?: number;\n            dist: {\n                x?: number;\n                y?: number;\n            };\n        } = {\n            x: undefined,\n            y: undefined,\n            dist: {\n                x: undefined,\n                y: undefined,\n            },\n        };\n        for (let e = 0; e < this.snapX.length; e++) {\n            dist = Math.abs(iX - this.snapX[e]);\n            if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                if (snap.x === undefined || dist < snap.dist.x!) {\n                    snap.x = this.snapX[e];\n                    snap.dist.x = dist;\n                }\n            }\n        }\n        for (let e = 0; e < this.snapY.length; e++) {\n            dist = Math.abs(iY - this.snapY[e]);\n            if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                if (snap.y === undefined || dist < snap.dist.y!) {\n                    snap.y = this.snapY[e];\n                    snap.dist.y = dist;\n                }\n            }\n        }\n\n        if (snap.x === undefined && snap.y === undefined) {\n            return {\n                x: iX,\n                y: iY,\n            };\n        }\n        return {\n            x: snap.x ?? iX,\n            y: snap.y ?? iY,\n        };\n    }\n\n    /**\n     * If constrained return nearest corner pos that fits aspect ratio\n     *\n     * @param cornerIndex\n     * @param iX\n     * @param iY\n     * @private\n     */\n    private constrainCorner (cornerIndex: number, iX: number, iY: number): IVector2D {\n        if (!this.isConstrained) {\n            return {\n                x: iX,\n                y: iY,\n            };\n        }\n        const flip = this.value.width * this.value.height < 0 ? -1 : 1;\n        return BB.projectPointOnLine(\n            {x: this.value.x, y: this.value.y},\n            toImageSpace(this.ratio, flip * ([0, 2].includes(cornerIndex) ? 1 : -1), this.value),\n            {x: iX, y: iY}\n        );\n    }\n\n    /**\n     * Update corners according to width height.\n     * Not their DOM.\n     */\n    private updateCornerPositions (): void {\n        this.corners[0].x = (-this.value.width / 2); // top left\n        this.corners[0].y = (-this.value.height / 2);\n\n        this.corners[1].x = (this.value.width / 2); // top right\n        this.corners[1].y = (-this.value.height / 2);\n\n        this.corners[2].x = (this.value.width / 2); // bottom right\n        this.corners[2].y = (this.value.height / 2);\n\n        this.corners[3].x = (-this.value.width / 2); // bottom left\n        this.corners[3].y = (this.value.height / 2);\n    }\n\n    /**\n     * If constrained and dragging an edge, restore aspect ratio\n     * Updates corner positions.\n     *\n     * @param widthChanged\n     * @param heightChanged\n     * @private\n     */\n    private restoreRatio (widthChanged: boolean, heightChanged: boolean): void {\n        if (!this.isConstrained) {\n            return;\n        }\n        const angle90 = Math.abs(this.value.angleDeg) % 90 === 0;\n        const whSwapped = Math.abs(this.value.angleDeg - 90) % 180 === 0;\n        if (heightChanged && !widthChanged) {\n            const newHeight = Math.abs(this.corners[3].y - this.corners[0].y);\n            let newWidth = this.ratio * newHeight;\n            if (angle90) {\n                newWidth = (whSwapped ? this.value.y % 1 : this.value.x % 1) === 0 ?\n                    BB.roundEven(newWidth) : BB.roundUneven(newWidth);\n            }\n            if (this.corners[1].x - this.corners[0].x < 0) {\n                newWidth *= -1;\n            }\n            this.corners[0].x = -newWidth / 2;\n            this.corners[3].x = -newWidth / 2;\n            this.corners[1].x = newWidth / 2;\n            this.corners[2].x = newWidth / 2;\n        }\n        if (!heightChanged && widthChanged) {\n            const newWidth = Math.abs(this.corners[0].x - this.corners[1].x);\n            let newHeight = newWidth / this.ratio;\n            if (angle90) {\n                newHeight = (whSwapped ? this.value.x % 1 : this.value.y % 1) === 0  ?\n                    BB.roundEven(newHeight) : BB.roundUneven(newHeight);\n            }\n            if (this.corners[3].y - this.corners[0].y < 0) {\n                newHeight *= -1;\n            }\n            this.corners[0].y = -newHeight / 2;\n            this.corners[1].y = -newHeight / 2;\n            this.corners[2].y = newHeight / 2;\n            this.corners[3].y = newHeight / 2;\n        }\n    }\n\n\n    /**\n     * update transform based on corners\n     * @private\n     */\n    private updateTransformViaCorners (): void {\n\n        // calc transform center in image space\n        const rot = BB.rotateAround(\n            {x: 0, y: 0},\n            {\n                x: (this.corners[0].x + this.corners[1].x) / 2,\n                y: (this.corners[0].y + this.corners[3].y) / 2,\n            },\n            this.value.angleDeg\n        );\n        this.value.x = rot.x + this.value.x;\n        this.value.y = rot.y + this.value.y;\n\n        // update size\n        this.value.width = this.corners[1].x - this.corners[0].x;\n        this.value.height = this.corners[3].y - this.corners[0].y;\n\n        // new center means corners changed their position\n        this.updateCornerPositions();\n\n        this.updateDOM();\n    }\n\n    /**\n     * updates DOM according to transform\n     * @param skipCallback\n     */\n    private updateDOM (skipCallback?: boolean): void {\n        this.updateScaled();\n\n        BB.css(this.transEl, {\n            left: (this.viewportTransform.x + this.scaled.x) + 'px',\n            top: (this.viewportTransform.y + this.scaled.y) + 'px',\n            transformOrigin: '0 0',\n            transform: 'rotate(' + this.value.angleDeg + 'deg)',\n        });\n\n        BB.css(this.boundsEl, {\n            width: Math.abs(this.scaled.width) + 'px',\n            height: Math.abs(this.scaled.height) + 'px',\n            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\n            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\n        });\n\n        this.corners[0].updateDOM();\n        this.corners[1].updateDOM();\n        this.corners[2].updateDOM();\n        this.corners[3].updateDOM();\n\n        this.edges[0].updateDOM();\n        this.edges[1].updateDOM();\n        this.edges[2].updateDOM();\n        this.edges[3].updateDOM();\n\n\n        this.angleGrip.x = 0;\n        this.angleGrip.y = (-Math.abs(this.value.height * this.viewportTransform.scale) / 2) - 20;\n        this.angleGrip.updateDOM();\n        if (!skipCallback) {\n            if (this.callback) { // why should updateDOM trigger the callback?\n                this.callback(copyTransform(this.value));\n            }\n        }\n    }\n\n\n\n    // --- public ---\n    constructor (\n        params: {\n            x: number; // center of transform region. image space\n            y: number;\n            width: number; // size of transform region. image space\n            height: number;\n            angleDeg: number; // angle of transform region. degrees\n\n            isConstrained: boolean; // proportions constrained\n            snapX: number[]; // where snapping along X axis. image space\n            snapY: number[]; // where snapping along X axis. image space\n            viewportTransform: {scale: number; x: number; y: number};\n            callback: (transform: IFreeTransform) => void;\n        }\n    ) {\n        this.viewportTransform = {...params.viewportTransform};\n        this.value = { // coordinates and dimensions of transformation\n            x: params.x,\n            y: params.y,\n            width: params.width,\n            height: params.height,\n            angleDeg: params.angleDeg,\n        };\n\n        this.isConstrained = params.isConstrained;\n\n        this.snapX = params.snapX;\n        this.snapY = params.snapY;\n        this.callback = params.callback;\n        this.snappingEnabled = true;\n        this.ratio = this.value.width / this.value.height;\n\n        this.rootEl = BB.el({\n            className: 'kl-free-transform',\n            css: {\n                userSelect: 'none',\n            },\n        });\n        this.transEl = BB.el({\n            parent: this.rootEl,\n            css: {\n                position: 'absolute',\n            },\n        });\n\n        this.boundsEl = BB.el({\n            css: {\n                position: 'absolute',\n                cursor: 'move',\n                boxShadow: 'rgba(255, 255, 255, 0.5) 0 0 0 1px inset, rgba(0, 0, 0, 0.5) 0 0 0 1px',\n            },\n        });\n\n        const pointerRemainder = {\n            x: 0,\n            y: 0,\n        };\n        function resetRemainder (): void {\n            pointerRemainder.x = 0;\n            pointerRemainder.y = 0;\n        }\n        this.keyListener = new BB.KeyListener({});\n\n        let boundsStartP = {\n            x: 0,\n            y: 0,\n        };\n        this.boundsPointerListener = new BB.PointerListener({\n            target: this.boundsEl,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointerdown') {\n                    boundsStartP = {x: this.value.x, y: this.value.y};\n                }\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    this.value.x = boundsStartP.x + (event.pageX - event.downPageX!) / this.viewportTransform.scale;\n                    this.value.y = boundsStartP.y + (event.pageY - event.downPageY!) / this.viewportTransform.scale;\n\n\n                    let dist: number;\n                    let snap: {\n                        x?: number;\n                        y?: number;\n                        distX: number;\n                        distY: number;\n                    } = {\n                        distX: -1,\n                        distY: -1,\n                    };\n                    if (this.snappingEnabled) {\n                        let i;\n                        for (i = 0; i < this.snapX.length; i++) {\n                            dist = Math.abs(this.value.x - this.snapX[i]);\n                            if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                                if (snap.x === undefined || dist < snap.distX) {\n                                    snap.x = this.snapX[i];\n                                    snap.distX = dist;\n                                }\n                            }\n                        }\n                        for (i = 0; i < this.snapY.length; i++) {\n                            dist = Math.abs(this.value.y - this.snapY[i]);\n                            if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                                if (snap.y === undefined || dist < snap.distY) {\n                                    snap.y = this.snapY[i];\n                                    snap.distY = dist;\n                                }\n                            }\n                        }\n\n                        let iP;\n                        for (i = 0; i < 4; i++) {\n                            iP = toImageSpace(this.corners[i].x, this.corners[i].y, this.value);\n                            let j;\n                            for (j = 0; j < this.snapX.length; j++) {\n                                dist = Math.abs(iP.x - this.snapX[j]);\n                                if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                                    if (snap.x === undefined || dist < snap.distX) {\n                                        snap.x = this.snapX[j] - (iP.x - this.value.x);\n                                        snap.distX = dist;\n                                    }\n                                }\n                            }\n                            for (j = 0; j < this.snapY.length; j++) {\n                                dist = Math.abs(iP.y - this.snapY[j]);\n                                if (dist < this.minSnapDist / this.viewportTransform.scale) {\n                                    if (snap.y === undefined || dist < snap.distY) {\n                                        snap.y = this.snapY[j] - (iP.y - this.value.y);\n                                        snap.distY = dist;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    if (this.keyListener.getComboStr() === 'shift') {\n                        let projected = BB.projectPointOnLine(\n                            {x: 0, y: boundsStartP.y},\n                            {x: 10, y: boundsStartP.y},\n                            {x: this.value.x, y: this.value.y});\n                        let dist = BB.dist(projected.x, projected.y, this.value.x, this.value.y);\n                        snap = {\n                            x: projected.x,\n                            y: projected.y,\n                            distX: dist,\n                            distY: dist,\n                        };\n\n                        projected = BB.projectPointOnLine(\n                            {x: boundsStartP.x, y: 0},\n                            {x: boundsStartP.x, y: 10},\n                            {x: this.value.x, y: this.value.y});\n                        dist = BB.dist(projected.x, projected.y, this.value.x, this.value.y);\n                        if (dist < snap.distX) {\n                            snap = {\n                                x: projected.x,\n                                y: projected.y,\n                                distX: dist,\n                                distY: dist,\n                            };\n                        }\n\n                        projected = BB.projectPointOnLine(\n                            {x: boundsStartP.x, y: boundsStartP.y},\n                            {x: boundsStartP.x + 1, y: boundsStartP.y + 1},\n                            {x: this.value.x, y: this.value.y});\n                        dist = BB.dist(projected.x, projected.y, this.value.x, this.value.y);\n                        if (dist < snap.distX) {\n                            snap = {\n                                x: projected.x,\n                                y: projected.y,\n                                distX: dist,\n                                distY: dist,\n                            };\n                        }\n\n                        projected = BB.projectPointOnLine(\n                            {x: boundsStartP.x, y: boundsStartP.y},\n                            {x: boundsStartP.x + 1, y: boundsStartP.y - 1},\n                            {x: this.value.x, y: this.value.y});\n                        dist = BB.dist(projected.x, projected.y, this.value.x, this.value.y);\n                        if (dist < snap.distX) {\n                            snap = {\n                                x: projected.x,\n                                y: projected.y,\n                                distX: dist,\n                                distY: dist,\n                            };\n                        }\n                    }\n                    if (snap.x != undefined) {\n                        this.value.x = snap.x;\n                    }\n                    if (snap.y != undefined) {\n                        this.value.y = snap.y;\n                    }\n\n                    // snap to pixels\n                    if (Math.abs(this.value.angleDeg) % 90 === 0) {\n                        snapToPixel(this.value);\n                        this.updateCornerPositions();\n                    }\n\n                    this.updateDOM();\n                }\n            },\n        });\n\n        for (let i = 0; i < 4; i++) {\n            ((i) => {\n                const g = this.corners[i] = {\n                    i: i,\n                    el: BB.el({\n                        css: {\n                            width: this.gripSize + 'px',\n                            height: this.gripSize + 'px',\n                            background: '#fff',\n                            /*background: [\n                                '#ff0000',\n                                '#00ff00',\n                                '#0000ff',\n                                '#ff00ff',\n                            ][i],*/\n                            borderRadius: this.gripSize + 'px',\n                            position: 'absolute',\n                            border: '2px solid #000',\n                        },\n                    }) as HTMLElement,\n                    x: 0,\n                    y: 0,\n                    virtualPos: {\n                        x: 0,\n                        y: 0,\n                    },\n                } as TFreeTransformCorner;\n                g.updateDOM = (): void => {\n\n                    // grip position\n                    // if it gets small: slightly offset grips, so easier to handle\n                    const offsetArr = [[-1, -1], [1, -1], [1, 1], [-1, 1]].map(item => {\n                        item[0] *= this.value.width > 0 ? 1 : -1;\n                        item[1] *= this.value.height > 0 ? 1 : -1;\n                        return item;\n                    });\n                    const tinyOffset = Math.abs(this.scaled.width) < 20 || Math.abs(this.scaled.height) < 20 ? 10 : 0;\n\n                    BB.css(g.el, {\n                        left: (this.scaled.corners[g.i].x - this.gripSize / 2 + offsetArr[i][0] * tinyOffset) + 'px',\n                        top: (this.scaled.corners[g.i].y - this.gripSize / 2 + offsetArr[i][1] * tinyOffset) + 'px',\n                    });\n\n\n                    // cursor\n                    let angle = BB.pointsToAngleDeg(\n                        {\n                            x: this.value.x,\n                            y: this.value.y,\n                        },\n                        toImageSpace(g.x, g.y, this.value),\n                    ) + 135; // offset so nw is 0\n                    while (angle < 0) {\n                        angle += 360;\n                    }\n                    const index = Math.round(angle / 45) % this.cornerCursors.length;\n                    BB.css(g.el, {\n                        cursor: this.cornerCursors[index] + '-resize',\n                    });\n                };\n\n                g.pointerListener = new BB.PointerListener({\n                    target: this.corners[i].el,\n                    fixScribble: true,\n                    onPointer: (event) => {\n                        event.eventPreventDefault();\n                        if (event.type === 'pointerdown' && event.button === 'left') {\n                            this.corners[i].virtualPos = toImageSpace(this.corners[i].x, this.corners[i].y, this.value);\n\n                        } else if (event.type === 'pointermove' && event.button === 'left') {\n                            this.corners[i].virtualPos.x += event.dX / this.viewportTransform.scale;\n                            this.corners[i].virtualPos.y += event.dY / this.viewportTransform.scale;\n\n                            let iP = {\n                                x: this.corners[i].virtualPos.x,\n                                y: this.corners[i].virtualPos.y,\n                            };\n                            iP = this.constrainCorner(i, iP.x, iP.y);\n                            if (!this.isConstrained) {\n                                iP = this.snapCorner(iP.x, iP.y);\n                            }\n\n                            if (Math.abs(this.value.angleDeg) % 90 === 0) {\n                                iP.x = Math.round(iP.x);\n                                iP.y = Math.round(iP.y);\n                            }\n\n                            const tP = toTransformSpace(iP.x, iP.y, this.value);\n\n                            const dX = tP.x - this.corners[i].x;\n                            const dY = tP.y - this.corners[i].y;\n                            this.corners[i].x = tP.x;\n                            this.corners[i].y = tP.y;\n\n                            let indexes: number[] = [];\n                            if (i === 0) { // top left\n                                indexes = [3, 1, 2];\n                            } else if (i === 1) { // top right\n                                indexes = [2, 0, 3];\n                            } else if (i === 2) { // bottom right\n                                indexes = [1, 3, 0];\n                            } else if (i === 3) { // bottom left\n                                indexes = [0, 2, 1];\n                            }\n\n                            this.corners[indexes[0]].x = this.corners[i].x;\n                            this.corners[indexes[1]].y = this.corners[i].y;\n                            if (this.keyListener.isPressed('shift')) {\n                                this.corners[indexes[2]].x -= dX;\n                                this.corners[indexes[2]].y -= dY;\n                                this.corners[indexes[1]].x = this.corners[indexes[2]].x;\n                                this.corners[indexes[0]].y = this.corners[indexes[2]].y;\n                            }\n\n                            this.updateTransformViaCorners();\n\n                        }\n                    },\n                });\n\n            })(i);\n        }\n\n        this.updateCornerPositions();\n        this.updateScaled();\n\n        let isInverted: boolean;\n        for (let i = 0; i < 4; i++) {\n            ((i): void => {\n                this.edges[i] = {\n                    el: BB.el({\n                        css: {\n                            width: this.edgeSize + 'px',\n                            height: this.edgeSize + 'px',\n                            /*background: [\n                                '#ff000044',\n                                '#00ff0044',\n                                '#0000ff44',\n                                '#ff00ff44',\n                            ][i],*/\n                            position: 'absolute',\n                        },\n                    }) as HTMLElement,\n                } as TFreeTransformEdge;\n                const g = this.edges[i];\n                g.updateDOM = () => {\n                    if (i === 0) {\n                        BB.css(g.el, {\n                            left: Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\n                            top: (Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) - this.edgeSize) + 'px',\n                            width: Math.abs(this.scaled.width) + 'px',\n                            height: this.edgeSize + 'px',\n                        });\n                    } else if (i === 1) {\n                        BB.css(g.el, {\n                            left: Math.max(this.scaled.corners[0].x, this.scaled.corners[1].x) + 'px',\n                            top: Math.min(this.scaled.corners[1].y, this.scaled.corners[2].y) + 'px',\n                            width: this.edgeSize + 'px',\n                            height: Math.abs(this.scaled.height) + 'px',\n                        });\n                    } else if (i === 2) {\n                        BB.css(g.el, {\n                            left: Math.min(this.scaled.corners[3].x, this.scaled.corners[2].x) + 'px',\n                            top: Math.max(this.scaled.corners[0].y,this.scaled.corners[3].y) + 'px',\n                            width: Math.abs(this.scaled.width) + 'px',\n                            height: this.edgeSize + 'px',\n                        });\n                    } else if (i === 3) {\n                        BB.css(g.el, {\n                            left: (Math.min(this.scaled.corners[0].x, this.scaled.corners[1].x) - this.edgeSize) + 'px',\n                            top: Math.min(this.scaled.corners[0].y, this.scaled.corners[3].y) + 'px',\n                            width: this.edgeSize + 'px',\n                            height: Math.abs(this.scaled.height) + 'px',\n                        });\n                    }\n                    let angleOffset = Math.round(this.value.angleDeg / 45);\n                    while (angleOffset < 0) {\n                        angleOffset += 8;\n                    }\n                    angleOffset = (i * 2 + 1 + angleOffset) % this.cornerCursors.length;\n                    g.el.style.cursor = this.cornerCursors[angleOffset] + '-resize';\n\n                };\n\n                const isVertical = [0, 2].includes(i);\n                g.pointerListener = new BB.PointerListener({\n                    target: this.edges[i].el,\n                    fixScribble: true,\n                    onPointer: (event) => {\n                        event.eventPreventDefault();\n                        if (event.type === 'pointerdown' && event.button === 'left') {\n                            if (isVertical) { // top bottom\n                                isInverted = this.corners[0].y >= this.corners[3].y;\n                            } else { // left right\n                                isInverted = this.corners[0].x >= this.corners[1].x;\n                            }\n                            resetRemainder();\n                        }\n                        if (event.type === 'pointermove' && event.button === 'left') {\n                            const tfD = BB.rotateAround({x: 0, y: 0},\n                                {x: event.dX / this.viewportTransform.scale, y: event.dY / this.viewportTransform.scale},\n                                -this.value.angleDeg);\n                            let ti = {\n                                dX: tfD.x,\n                                dY: tfD.y,\n                            };\n                            if (Math.abs(this.value.angleDeg) % 90 === 0) {\n                                ti = BB.intDxy(pointerRemainder, tfD.x, tfD.y);\n                            }\n\n                            let indexes: number[] = [];\n                            if (i === 0) { // top\n                                indexes = [2, 3, 0, 1];\n                            } else if (i === 1) { // right\n                                indexes = [0, 3, 1, 2];\n                            } else if (i === 2) { // bottom\n                                indexes = [0, 1, 2, 3];\n                            } else if (i === 3) { // left\n                                indexes = [1, 2, 0, 3];\n                            }\n\n                            const dimension = isVertical ? 'y' : 'x';\n                            const d = isVertical ? ti.dY : ti.dX;\n\n                            if (isInverted) {\n                                this.corners[indexes[0]][dimension] += d;\n                                this.corners[indexes[1]][dimension] += d;\n                            } else {\n                                this.corners[indexes[2]][dimension] += d;\n                                this.corners[indexes[3]][dimension] += d;\n                            }\n                            if (this.keyListener.isPressed('shift')) {\n                                if (isInverted) {\n                                    this.corners[indexes[2]][dimension] -= d;\n                                    this.corners[indexes[3]][dimension] -= d;\n                                } else {\n                                    this.corners[indexes[0]][dimension] -= d;\n                                    this.corners[indexes[1]][dimension] -= d;\n                                }\n                            }\n\n                            if (isVertical) { // top bottom\n                                this.restoreRatio(false, true);\n                            } else { // left right\n                                this.restoreRatio(true, false);\n                            }\n\n                            this.updateTransformViaCorners();\n\n                        }\n                    },\n                });\n\n            })(i);\n        }\n\n        this.angleGrip = {\n            el: BB.el({\n                css: {\n                    cursor: 'url(' + rotateImg + ') 10 10, move',\n                    width: this.gripSize + 'px',\n                    height: this.gripSize + 'px',\n                    background: '#0ff',\n                    borderRadius: this.gripSize + 'px',\n                    position: 'absolute',\n                    boxShadow: 'inset 0 0 0 2px #000',\n                },\n            }),\n            x: 0,\n            y: 0,\n            snap: false,\n            updateDOM: () => {\n                BB.css(this.angleGrip.el, {\n                    left: (this.angleGrip.x - this.gripSize / 2) + 'px',\n                    top: (this.angleGrip.y - this.gripSize / 2) + 'px',\n                });\n            },\n        };\n        BB.el({\n            parent: this.angleGrip.el,\n            css: {\n                width: '2px',\n                height: '13px',\n                left: (this.gripSize / 2 - 1) + 'px',\n                top: this.gripSize + 'px',\n                background: '#0ff',\n                position: 'absolute',\n            },\n        });\n\n        this.anglePointerListener = new BB.PointerListener({\n            target: this.angleGrip.el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n\n                    const bounds = this.rootEl.getBoundingClientRect();\n                    const offset = {\n                        x: bounds.left - this.rootEl.scrollLeft + this.viewportTransform.x,\n                        y: bounds.top - this.rootEl.scrollTop + this.viewportTransform.y,\n                    };\n                    const iP = {\n                        x: (event.clientX - offset.x) / this.viewportTransform.scale,\n                        y: (event.clientY - offset.y) / this.viewportTransform.scale,\n                    };\n\n                    const a = BB.pointsToAngleDeg({x: this.value.x, y: this.value.y}, iP) + 90;\n                    this.value.angleDeg = a;\n                    const snapDeg = Math.round(a / 360 * 8) * 45;\n                    if (this.keyListener.getComboStr() === 'shift') {\n                        this.value.angleDeg = snapDeg;\n                    } else if (this.snappingEnabled && Math.abs(snapDeg - a) < 8) {\n                        this.value.angleDeg = snapDeg;\n                    }\n                    this.updateDOM();\n\n                }\n                if (event.type === 'pointerup') {\n                    if (Math.abs(this.value.angleDeg) % 90 === 0) {\n                        snapToPixel(this.value);\n                        this.updateCornerPositions();\n                        this.updateDOM();\n                    }\n                }\n            },\n        });\n\n        snapToPixel(this.value);\n        this.updateDOM(true);\n        BB.append(this.transEl, [\n            this.boundsEl,\n            this.edges[0].el,\n            this.edges[1].el,\n            this.edges[2].el,\n            this.edges[3].el,\n            this.corners[0].el,\n            this.corners[1].el,\n            this.corners[2].el,\n            this.corners[3].el,\n            this.angleGrip.el,\n        ]);\n\n\n    }\n\n\n\n    getValue (): IFreeTransform {\n        return copyTransform(this.value);\n    }\n\n    setIsConstrained (b: boolean): void {\n        this.isConstrained = b;\n        if (b && this.value.width !== 0 && this.value.height !== 0) {\n            this.ratio = Math.abs(this.value.width / this.value.height);\n        }\n    }\n\n    setSnapping (b: boolean): void {\n        this.snappingEnabled = b;\n    }\n\n    setPos (p: IVector2D): void {\n        this.value.x = p.x;\n        this.value.y = p.y;\n        this.updateDOM(true);\n    }\n\n    move (dX: number, dY: number): void {\n        this.value.x += dX;\n        this.value.y += dY;\n        this.updateDOM(false);\n    }\n\n    setSize (w: number, h: number): void {\n        this.value.width = w;\n        this.value.height = h;\n        if (Math.abs(this.value.angleDeg) % 90 === 0) {\n            snapToPixel(this.value);\n        }\n        this.updateCornerPositions();\n        this.updateDOM(false);\n    }\n\n    setAngleDeg (a: number): void {\n        this.value.angleDeg = a;\n        if (Math.abs(this.value.angleDeg) % 90 === 0) {\n            snapToPixel(this.value);\n            this.updateCornerPositions();\n        }\n        this.updateDOM(true);\n    }\n\n    setViewportTransform (transform: { scale: number; x: number; y: number }): void {\n        this.viewportTransform = transform;\n        this.updateScaled();\n        this.updateDOM();\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getRatio (): number {\n        return this.ratio;\n    }\n\n    destroy (): void {\n        this.keyListener.destroy();\n        this.boundsPointerListener.destroy();\n        this.corners.forEach(item => item.pointerListener.destroy());\n        this.edges.forEach(item => item.pointerListener.destroy());\n        this.anglePointerListener.destroy();\n    }\n\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"cursor-rotate.4dea8425.png\";","import {IVector2D} from '../../../bb/bb-types';\nimport {BB} from '../../../bb/bb';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\n\nexport interface IFreeTransform {\n    x: number; // center of transform region. image space\n    y: number;\n    width: number; // size of transform region. image space\n    height: number;\n    angleDeg: number; // angle of transform region. degrees\n}\n\n\nexport type TFreeTransformCorner = {\n    i: number; // index in corners array\n    el: HTMLElement; // draggable corner circle in DOM\n    x: number; // unscaled position (transform space)\n    y: number;\n    virtualPos: IVector2D; // unscaled temporary position (image space)\n    updateDOM: () => void; // update styling in DOM\n    pointerListener: PointerListener;\n};\n\nexport type TFreeTransformEdge = { // derive position from corners\n    el: HTMLElement;\n    updateDOM: () => void;\n    pointerListener: PointerListener;\n};\n\n/**\n * snap entire transform to pixel grid. changes transform\n *\n * for x y:\n * If a dimension has an even size, it be an integer.\n * If it's uneven, it's sits exactly half way between two pixels.\n *\n * @param transform\n */\nexport function snapToPixel (transform: IFreeTransform): void {\n    if (Math.abs(transform.angleDeg) % 90 !== 0) {\n        return;\n    }\n\n    transform.width = Math.round(transform.width);\n    transform.height = Math.round(transform.height);\n    // 0 is original orientation.\n    // At 90 and 270 width and height become swapped due to different orientation.\n    const whSwapped = Math.abs(transform.angleDeg - 90) % 180 === 0;\n    transform.x = ((whSwapped ? transform.height : transform.width) % 2 === 0) ? Math.round(transform.x) : Math.round(transform.x - 0.5) + 0.5;\n    transform.y = ((whSwapped ? transform.width : transform.height) % 2 === 0)  ? Math.round(transform.y) : Math.round(transform.y - 0.5) + 0.5;\n}\n\nexport function copyTransform (transform: IFreeTransform): IFreeTransform {\n    return {\n        x: transform.x,\n        y: transform.y,\n        width: transform.width,\n        height: transform.height,\n        angleDeg: transform.angleDeg,\n    };\n}\n\n/**\n * image space to transform space\n * - origin of transform space is at center of transform bounds.\n * - same scale as image space. -> one unit is x: 1/width, y: 1/height\n * - up is where transform points up\n * - x goes right\n * - y goes down\n * @param x\n * @param y\n * @param transform\n */\nexport function toTransformSpace (x: number, y: number, transform: IFreeTransform): IVector2D {\n    let px, py;\n    px = x - transform.x;\n    py = y - transform.y;\n\n    const rot = BB.rotateAround({x: 0, y: 0},\n        {x: px, y: py},\n        -transform.angleDeg);\n    px = rot.x;\n    py = rot.y;\n\n    return {\n        x: px,\n        y: py,\n    };\n}\n\n/**\n * transform space to image space\n * @param x\n * @param y\n * @param transform\n */\nexport function toImageSpace (x: number, y: number, transform: IFreeTransform): IVector2D {\n    const rot = BB.rotateAround({x: 0, y: 0},\n        {x: x, y: y},\n        transform.angleDeg);\n    return {\n        x: rot.x + transform.x,\n        y: rot.y + transform.y,\n    };\n}\n","import {BB} from '../../../bb/bb';\nimport {FreeTransform} from './free-transform';\nimport {IKlBasicLayer} from '../../kl-types';\nimport {IRect} from '../../../bb/bb-types';\nimport {Preview} from '../project-viewport/preview';\nimport {TProjectViewportProject} from '../project-viewport/project-viewport';\nimport {css} from '@emotion/css/dist/emotion-css.cjs';\nimport {IFreeTransform} from './free-transform-utils';\n\n/**\n * a basic canvas where you can transform one layer(move around, rotate, scale)\n */\nexport class FreeTransformCanvas {\n\n    private readonly rootEl: HTMLElement;\n    private readonly freeTransform: FreeTransform;\n    private readonly layers: IKlBasicLayer[];\n    private readonly transformIndex: number;\n    private readonly imageWidth: number;\n    private readonly imageHeight: number;\n    private readonly initTransform: IRect;\n    private readonly previewLayerArr: TProjectViewportProject['layers'];\n    private readonly preview: Preview;\n    private readonly previewCanvas: HTMLCanvasElement;\n\n    private updatePreview (): void {\n        const transform = this.freeTransform.getValue();\n\n        const ctx = BB.ctx((this.previewCanvas));\n        ctx.save();\n        ctx.clearRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n        BB.drawTransformedImageWithBounds(\n            ctx,\n            this.layers[this.transformIndex].image,\n            transform,\n            undefined,\n            BB.testShouldPixelate(\n                transform,\n                transform.width / this.initTransform.width,\n                transform.height / this.initTransform.height\n            ),\n        );\n        ctx.restore();\n        this.preview.render();\n    }\n\n\n    // ---- public ----\n    constructor (\n        p: {\n            elementWidth: number;\n            elementHeight: number;\n            imageWidth: number;\n            imageHeight: number;\n            layers: IKlBasicLayer[];\n            transformIndex: number;\n        }\n    ) {\n        this.imageWidth = p.imageWidth;\n        this.imageHeight = p.imageHeight;\n\n        this.rootEl = BB.el({\n            className: 'kl-preview-wrapper',\n            css: {\n                width: p.elementWidth + 'px',\n                height: p.elementHeight + 'px',\n            },\n        });\n        this.rootEl.oncontextmenu = () => {\n            return false;\n        };\n        this.layers = p.layers;\n        this.transformIndex = p.transformIndex;\n\n        this.previewLayerArr = this.layers.map(item => {\n            return {\n                image: item.image,\n                isVisible: item.isVisible,\n                mixModeStr: item.mixModeStr ?? 'source-over',\n                opacity: item.opacity,\n                hasClipping: false,\n            };\n        });\n        this.previewCanvas = BB.canvas(this.imageWidth, this.imageHeight);\n        this.previewLayerArr[this.previewLayerArr.length - 1].image = this.previewCanvas;\n\n        this.preview = new Preview({\n            width: p.elementWidth,\n            height: p.elementHeight,\n            project: {\n                width: p.imageWidth,\n                height: p.imageHeight,\n                layers: this.previewLayerArr,\n            },\n            hasEditMode: true,\n            onModeChange: (m) => {\n                this.freeTransform.getElement().style.pointerEvents = m === 'edit' ? '' : 'none';\n                this.freeTransform.getElement().style.opacity = m === 'edit' ? '' : '0.5';\n            },\n            onTransformChange: (transform) => {\n                this.freeTransform.setViewportTransform(transform);\n            },\n            padding: 30,\n        });\n        this.preview.getElement().classList.add(css({\n            overflow: 'hidden',\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        }));\n        this.rootEl.append(this.preview.getElement());\n\n        {\n            this.initTransform = {\n                x: this.imageWidth / 2,\n                y: this.imageHeight / 2,\n                width: this.layers[this.transformIndex].image.width,\n                height: this.layers[this.transformIndex].image.height,\n            };\n            this.freeTransform = new FreeTransform({\n                x: this.initTransform.x,\n                y: this.initTransform.y,\n                width: this.initTransform.width,\n                height: this.initTransform.height,\n                angleDeg: 0,\n                isConstrained: true,\n                snapX: [0, this.imageWidth],\n                snapY: [0, this.imageHeight],\n                viewportTransform: this.preview.getTransform(),\n                callback: () => {\n                    this.updatePreview();\n                },\n            });\n            this.preview.getElement().append(this.freeTransform.getElement());\n        }\n        BB.css(this.freeTransform.getElement(), {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n        });\n        setTimeout(() => this.updatePreview(), 0);\n    }\n\n\n    // ---- interface ----\n    move (dX: number, dY: number): void {\n        this.freeTransform.move(dX, dY);\n    }\n\n    reset (): void {\n        const w = this.layers[this.transformIndex].image.width;\n        const h = this.layers[this.transformIndex].image.height;\n\n        this.freeTransform.setSize(w, h);\n        this.freeTransform.setPos({x: w / 2, y: h / 2});\n        this.freeTransform.setAngleDeg(0);\n        this.updatePreview();\n    }\n\n    setTransformFit (): void {\n\n        const fit = BB.fitInto(\n            this.layers[this.transformIndex].image.width,\n            this.layers[this.transformIndex].image.height,\n            this.imageWidth,\n            this.imageHeight,\n            1\n        );\n\n        this.freeTransform.setSize(fit.width, fit.height);\n        this.freeTransform.setPos({x: fit.width / 2, y: fit.height / 2});\n        this.freeTransform.setAngleDeg(0);\n        this.updatePreview();\n    }\n\n    setTransformCenter (): void {\n        this.freeTransform.setPos({x: this.imageWidth / 2, y: this.imageHeight / 2});\n        this.freeTransform.setAngleDeg(0);\n        this.updatePreview();\n    }\n\n    /**\n     * gives you the transformation in the original scale\n     */\n    getTransformation (): IFreeTransform {\n        return this.freeTransform.getValue();\n    }\n\n    getIsPixelated (): boolean {\n        const transform = this.freeTransform.getValue();\n        return BB.testShouldPixelate(\n            transform,\n            transform.width / this.initTransform.width,\n            transform.height / this.initTransform.height\n        );\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    destroy (): void {\n        this.freeTransform.destroy();\n        this.preview.destroy();\n        BB.freeCanvas(this.previewCanvas);\n    }\n}\n","export {\n  cache,\n  css,\n  cx,\n  flush,\n  getRegisteredStyles,\n  hydrate,\n  injectGlobal,\n  keyframes,\n  merge,\n  sheet\n} from \"./emotion-css.cjs.js\";\n","'use strict';\n\nif (process.env.NODE_ENV === \"production\") {\n  module.exports = require(\"./emotion-css.cjs.prod.js\");\n} else {\n  module.exports = require(\"./emotion-css.cjs.dev.js\");\n}\n","import {BB} from '../../../bb/bb';\nimport {IRect, IVector2D} from '../../../bb/bb-types';\nimport {KeyListener} from '../../../bb/input/key-listener';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\n\n\ntype TUpdateElement = {\n    el: HTMLElement;\n    update: () => void;\n};\n\n/**\n * Interactive preview for crop filter. Corners and edges can be dragged.\n * the div that you append this to must be relative\n */\nexport class Cropper {\n\n    private readonly rootEl: HTMLElement;\n    private x: number;\n    private y: number;\n    private width: number;\n    private height: number;\n    private scale: number;\n    private readonly grips: IVector2D[]; // aka corner coordinates\n    private readonly edges: TUpdateElement[];\n    private readonly cornerElArr: TUpdateElement[];\n    private readonly darken: TUpdateElement[];\n    private readonly outline: TUpdateElement;\n    private readonly thirdsHorizontal: TUpdateElement;\n    private readonly thirdsVertical: TUpdateElement;\n    private readonly keyListener: KeyListener;\n    private readonly pointerRemainder: IVector2D;\n\n    private readonly outlinePointerListener: PointerListener;\n\n    private readonly corner0PointerListener: PointerListener;\n    private readonly corner1PointerListener: PointerListener;\n    private readonly corner2PointerListener: PointerListener;\n    private readonly corner3PointerListener: PointerListener;\n\n    private readonly edge0PointerListener: PointerListener;\n    private readonly edge1PointerListener: PointerListener;\n    private readonly edge2PointerListener: PointerListener;\n    private readonly edge3PointerListener: PointerListener;\n\n    private readonly callback: (val: IRect) => void;\n\n    private update (): void {\n        this.edges[0].update();\n        this.edges[1].update();\n        this.edges[2].update();\n        this.edges[3].update();\n        this.cornerElArr[0].update();\n        this.cornerElArr[1].update();\n        this.cornerElArr[2].update();\n        this.cornerElArr[3].update();\n        this.darken[0].update();\n        this.darken[1].update();\n        this.darken[2].update();\n        this.darken[3].update();\n        this.outline.update();\n        this.thirdsHorizontal.update();\n        this.thirdsVertical.update();\n    }\n\n    private commit (): void {\n        this.pointerRemainder.x = 0;\n        this.pointerRemainder.y = 0;\n        this.callback(this.getTransform());\n    }\n\n\n\n    // ---- public ----\n    constructor (\n        params: {\n            x: number; // int, pos in relation to image\n            y: number; // int\n            width: number; // int\n            height: number; // int\n            maxW: number;\n            maxH: number;\n            scale: number; // float, zoom\n            callback: (val: IRect) => void;\n        }\n    ) {\n\n        this.x = params.x;\n        this.y = params.y;\n        this.width = params.width;\n        this.height = params.height;\n        this.scale = params.scale;\n        this.callback = params.callback;\n\n        const maxW = params.maxW;\n        const maxH = params.maxW;\n        this.rootEl = BB.el();\n        const gripCursors = ['nw', 'n', 'ne', 'e', 'se', 's', 'sw', 'w'];\n\n        this.keyListener = new BB.KeyListener({});\n\n        BB.css(this.rootEl, {\n            position: 'absolute',\n            left: (this.x * this.scale) + 'px',\n            top: (this.y * this.scale) + 'px',\n        });\n\n        this.outline = {\n            el: BB.el({\n                css: {\n                    position: 'absolute',\n                    border: '1px dashed #fff',\n                    cursor: 'move',\n                },\n            }),\n            update: () => {\n                BB.css(this.outline.el, {\n                    left: (this.grips[0].x * this.scale - 1) + 'px',\n                    top: (this.grips[0].y * this.scale - 1) + 'px',\n                    width: ((this.grips[2].x - this.grips[0].x) * this.scale) + 'px',\n                    height: ((this.grips[2].y - this.grips[0].y) * this.scale) + 'px',\n                });\n            },\n        };\n\n        this.pointerRemainder = { // needs to be reset after dragging complete\n            x: 0,\n            y: 0,\n        };\n        this.outlinePointerListener = new BB.PointerListener({\n            target: this.outline.el,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n\n                    this.grips[0].x += dX;\n                    this.grips[0].y += dY;\n                    this.grips[1].x += dX;\n                    this.grips[1].y += dY;\n                    this.grips[2].x += dX;\n                    this.grips[2].y += dY;\n                    this.grips[3].x += dX;\n                    this.grips[3].y += dY;\n\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n\n        this.thirdsHorizontal = {\n            el: BB.el({\n                css: {\n                    position: 'absolute',\n                    borderTop: '1px solid #0ff',\n                    borderBottom: '1px solid #0ff',\n                },\n            }),\n            update: () => {\n                BB.css(this.thirdsHorizontal.el, {\n                    left: (this.grips[0].x * this.scale) + 'px',\n                    top: ((this.grips[0].y + (this.grips[2].y - this.grips[0].y) / 3) * this.scale) + 'px',\n                    width: ((this.grips[2].x - this.grips[0].x) * this.scale) + 'px',\n                    height: ((this.grips[2].y - this.grips[0].y) / 3 * this.scale) + 'px',\n                });\n            },\n        };\n\n        this.thirdsVertical = {\n            el: BB.el({\n                css: {\n                    position: 'absolute',\n                    borderLeft: '1px solid #0ff',\n                    borderRight: '1px solid #0ff',\n                },\n            }),\n            update: () => {\n                BB.css(this.thirdsVertical.el, {\n                    left: ((this.grips[0].x + (this.grips[2].x - this.grips[0].x) / 3) * this.scale) + 'px',\n                    top: (this.grips[0].y * this.scale) + 'px',\n                    width: ((this.grips[2].x - this.grips[0].x) / 3 * this.scale) + 'px',\n                    height: ((this.grips[2].y - this.grips[0].y) * this.scale) + 'px',\n                });\n            },\n        };\n\n        const gripSize = 40;\n        const gripOverlay = 10;\n\n        this.grips = [\n            {x: 0, y: 0}, // top left\n            {x: this.width, y: 0}, // top right\n            {x: this.width, y: this.height}, // bottom right\n            {x: 0, y: this.height}, //bottom left\n        ];\n\n        const transformTop = (dY: number) => {\n            this.grips[0].y += dY;\n            this.grips[0].y = BB.clamp(this.grips[0].y, this.grips[3].y - maxH, this.grips[3].y - 1);\n            this.grips[1].y = this.grips[0].y;\n        };\n        const transformRight = (dX: number) => {\n            this.grips[1].x += dX;\n            this.grips[1].x = BB.clamp(this.grips[1].x, this.grips[0].x + 1, this.grips[0].x + maxW);\n            this.grips[2].x = this.grips[1].x;\n        };\n        const transformBottom = (dY: number) => {\n            this.grips[2].y += dY;\n            this.grips[2].y = BB.clamp(this.grips[2].y, this.grips[1].y + 1, this.grips[1].y + maxH);\n            this.grips[3].y = this.grips[2].y;\n        };\n        const transformLeft = (dX: number) => {\n            this.grips[0].x += dX;\n            this.grips[0].x = BB.clamp(this.grips[0].x, this.grips[1].x - maxW, this.grips[1].x - 1);\n            this.grips[3].x = this.grips[0].x;\n        };\n\n\n\n\n        this.edges = [];\n        for (let i = 0; i < 4; i++) {\n            ((i) => {\n\n                const el = BB.el({\n                    css: {\n                        width: gripSize + 'px',\n                        height: gripSize + 'px',\n                        //background: '#0f0',\n                        position: 'absolute',\n                    },\n                });\n\n                const update = () => {\n                    if (i === 0) { //top\n                        BB.css(el, {\n                            left: (this.grips[0].x * this.scale + gripOverlay) + 'px',\n                            top: (this.grips[0].y * this.scale - gripSize * 2 + gripOverlay) + 'px',\n                            width: ((this.grips[1].x - this.grips[0].x) * this.scale - gripOverlay * 2) + 'px',\n                            height: (gripSize * 2) + 'px',\n                        });\n                    } else if (i === 1) { //right\n                        BB.css(el, {\n                            left: (this.grips[1].x * this.scale - gripOverlay) + 'px',\n                            top: (this.grips[1].y * this.scale + gripOverlay) + 'px',\n                            width: (gripSize * 2) + 'px',\n                            height: ((this.grips[2].y - this.grips[1].y) * this.scale - gripOverlay * 2) + 'px',\n                        });\n                    } else if (i === 2) { //bottom\n                        BB.css(el, {\n                            left: (this.grips[3].x * this.scale + gripOverlay) + 'px',\n                            top: (this.grips[3].y * this.scale - gripOverlay) + 'px',\n                            width: ((this.grips[2].x - this.grips[3].x) * this.scale - gripOverlay * 2) + 'px',\n                            height: (gripSize * 2) + 'px',\n                        });\n                    } else if (i === 3) { //left\n                        BB.css(el, {\n                            left: (this.grips[0].x * this.scale - gripSize * 2 + gripOverlay) + 'px',\n                            top: (this.grips[0].y * this.scale + gripOverlay) + 'px',\n                            width: (gripSize * 2) + 'px',\n                            height: ((this.grips[3].y - this.grips[0].y) * this.scale - gripOverlay * 2) + 'px',\n                        });\n                    }\n                    const angleOffset = i * 2 + 1;\n                    el.style.cursor = gripCursors[angleOffset] + '-resize';\n\n                };\n\n                this.edges[i] = {\n                    el,\n                    update,\n                };\n            })(i);\n        }\n\n        this.darken = [];\n        for (let i = 0; i < 4; i++) {\n            ((i) => {\n                const g = BB.el({\n                    css: {\n                        position: 'absolute',\n                        background: '#000',\n                        opacity: '0.5',\n                    },\n                });\n                const update = () => {\n                    if (i === 0) {\n                        BB.css(g, {\n                            left: (this.grips[0].x * this.scale) + 'px',\n                            top: (this.grips[0].y * this.scale - 8000) + 'px',\n                            width: ((this.grips[1].x - this.grips[0].x) * this.scale) + 'px',\n                            height: '8000px',\n                        });\n                    } else if (i === 1) {\n                        BB.css(g, {\n                            left: (this.grips[1].x * this.scale) + 'px',\n                            top: (this.grips[1].y * this.scale - 8000) + 'px',\n                            width: '8000px',\n                            height: 16000 + 'px',\n                        });\n                    } else if (i === 2) {\n                        BB.css(g, {\n                            left: (this.grips[3].x * this.scale) + 'px',\n                            top: (this.grips[3].y * this.scale) + 'px',\n                            width: ((this.grips[2].x - this.grips[3].x) * this.scale) + 'px',\n                            height: '8000px',\n                        });\n                    } else if (i === 3) {\n                        BB.css(g, {\n                            left: (this.grips[0].x * this.scale - 8000) + 'px',\n                            top: (this.grips[0].y * this.scale - 8000) + 'px',\n                            width: '8000px',\n                            height: 16000 + 'px',\n                        });\n                    }\n\n                };\n\n                this.darken[i] = {\n                    el: g,\n                    update,\n                };\n            })(i);\n        }\n\n        this.edge0PointerListener = new BB.PointerListener({\n            target: this.edges[0].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const {dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformTop(dY);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformBottom(-dY);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n        this.edge1PointerListener = new BB.PointerListener({\n            target: this.edges[1].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformRight(dX);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformLeft(-dX);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n        this.edge2PointerListener = new BB.PointerListener({\n            target: this.edges[2].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformBottom(dY);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformTop(-dY);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n        this.edge3PointerListener = new BB.PointerListener({\n            target: this.edges[3].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformLeft(dX);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformRight(-dX);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n\n\n        this.cornerElArr = [];\n        (() => {\n            for (let i = 0; i < 4; i++) {\n                ((i) => {\n                    const g = BB.el({\n                        css: {\n                            //background: '#f00',\n                            width: (gripSize * 2) + 'px',\n                            height: (gripSize * 2) + 'px',\n                            position: 'absolute',\n                            cursor: ['nwse-resize', 'nesw-resize'][i % 2],\n                        },\n                    });\n\n                    const update = () => {\n                        if (i === 0) { //top left\n                            BB.css(g, {\n                                left: (this.grips[0].x * this.scale - gripSize * 2 + gripOverlay) + 'px',\n                                top: (this.grips[0].y * this.scale - gripSize * 2 + gripOverlay) + 'px',\n                            });\n                        } else if (i === 1) { //top right\n                            BB.css(g, {\n                                left: (this.grips[1].x * this.scale - gripOverlay) + 'px',\n                                top: (this.grips[1].y * this.scale - gripSize * 2 + gripOverlay) + 'px',\n                            });\n                        } else if (i === 2) { //bottom right\n                            BB.css(g, {\n                                left: (this.grips[1].x * this.scale - gripOverlay) + 'px',\n                                top: (this.grips[2].y * this.scale - gripOverlay) + 'px',\n                            });\n                        } else if (i === 3) { //bottom left\n                            BB.css(g, {\n                                left: (this.grips[0].x * this.scale - gripSize * 2 + gripOverlay) + 'px',\n                                top: (this.grips[2].y * this.scale - gripOverlay) + 'px',\n                            });\n                        }\n                    };\n\n                    this.cornerElArr[i] = {\n                        el: g,\n                        update,\n                    };\n                })(i);\n            }\n        })();\n        //top left\n        this.corner0PointerListener = new BB.PointerListener({\n            target: this.cornerElArr[0].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformLeft(dX);\n                    transformTop(dY);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformRight(-dX);\n                        transformBottom(-dY);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n        //top right\n        this.corner1PointerListener = new BB.PointerListener({\n            target: this.cornerElArr[1].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformRight(dX);\n                    transformTop(dY);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformLeft(-dX);\n                        transformBottom(-dY);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n        //bottom right\n        this.corner2PointerListener = new BB.PointerListener({\n            target: this.cornerElArr[2].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformRight(dX);\n                    transformBottom(dY);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformLeft(-dX);\n                        transformTop(-dY);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n        //bottom left\n        this.corner3PointerListener = new BB.PointerListener({\n            target: this.cornerElArr[3].el,\n            fixScribble: true,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.type === 'pointermove' && event.button === 'left') {\n                    const {dX, dY} = BB.intDxy(this.pointerRemainder, event.dX / this.scale, event.dY / this.scale);\n                    transformLeft(dX);\n                    transformBottom(dY);\n                    if (this.keyListener.isPressed('shift')) {\n                        transformRight(-dX);\n                        transformTop(-dY);\n                    }\n                    this.update();\n                }\n                if (event.type === 'pointerup') {\n                    this.commit();\n                }\n            },\n        });\n\n\n        this.rootEl.append(\n            this.darken[1].el,\n            this.darken[0].el,\n            this.darken[2].el,\n            this.darken[3].el,\n            this.thirdsHorizontal.el,\n            this.thirdsVertical.el,\n            this.outline.el,\n\n            this.edges[1].el,\n            this.edges[0].el,\n            this.edges[2].el,\n            this.edges[3].el,\n\n            this.cornerElArr[0].el,\n            this.cornerElArr[1].el,\n            this.cornerElArr[2].el,\n            this.cornerElArr[3].el,\n        );\n\n        this.update();\n\n    }\n\n    // ---- interface ----\n    getTransform (): IRect {\n        this.grips[1].x -= this.grips[0].x;\n        this.grips[1].y -= this.grips[0].y;\n        this.grips[2].x -= this.grips[0].x;\n        this.grips[2].y -= this.grips[0].y;\n        this.grips[3].x -= this.grips[0].x;\n        this.grips[3].y -= this.grips[0].y;\n        this.x += this.grips[0].x;\n        this.y += this.grips[0].y;\n        this.grips[0].x = 0;\n        this.grips[0].y = 0;\n        return {\n            x: this.x,\n            y: this.y,\n            width: this.grips[1].x,\n            height: this.grips[2].y,\n        };\n    }\n\n    setTransform (p: IRect): void {\n        this.x = p.x;\n        this.y = p.y;\n        this.width = p.width;\n        this.height = p.height;\n\n        BB.css(this.rootEl, {\n            left: (this.x * this.scale) + 'px',\n            top: (this.y * this.scale) + 'px',\n        });\n\n        this.grips[0].x = 0;\n        this.grips[0].y = 0;\n        this.grips[1].x = this.width;\n        this.grips[1].y = 0;\n        this.grips[2].x = this.width;\n        this.grips[2].y = this.height;\n        this.grips[3].x = 0;\n        this.grips[3].y = this.height;\n\n        this.update();\n        this.commit();\n    }\n\n    setScale (s: number): void {\n        this.scale = s;\n        BB.css(this.rootEl, {\n            left: (this.x * this.scale) + 'px',\n            top: (this.y * this.scale) + 'px',\n        });\n        this.update();\n    }\n\n    showThirds (b: boolean): void {\n\n        this.thirdsHorizontal.el.style.display = b ? 'block' : 'none';\n        this.thirdsVertical.el.style.display = b ? 'block' : 'none';\n\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    destroy (): void {\n        this.keyListener.destroy();\n        this.outlinePointerListener.destroy();\n        this.corner0PointerListener.destroy();\n        this.corner1PointerListener.destroy();\n        this.corner2PointerListener.destroy();\n        this.corner3PointerListener.destroy();\n        this.edge0PointerListener.destroy();\n        this.edge1PointerListener.destroy();\n        this.edge2PointerListener.destroy();\n        this.edge3PointerListener.destroy();\n    }\n}\n\n","import {BB} from '../../../bb/bb';\nimport {klHistory} from '../../history/kl-history';\nimport {LANG} from '../../../language/language';\nimport {TKlCanvasLayer, TUiLayout} from '../../kl-types';\nimport {ISize2D} from '../../../bb/bb-types';\nimport {theme} from '../../../theme/theme';\nimport {KlCanvasLayer} from '../../canvas/kl-canvas';\nimport {throwIfNull} from '../../../bb/base/base';\n\n\n/**\n * Previews currently active layer\n * thumbnail (hover shows bigger preview), layername, opacity\n *\n * internally listens to kl history. updates when there's a change.\n * but you need to update it when the active layer changed. (different canvas object)\n *\n * update visibility for performance\n */\nexport class LayerPreview {\n\n    private readonly rootEl: HTMLElement;\n    private readonly contentWrapperEl: HTMLElement;\n    private readonly height: number;\n    private layerObj: TKlCanvasLayer | undefined;\n    private isVisible: boolean;\n    private uiState: TUiLayout;\n\n    private readonly checkEl: HTMLInputElement;\n\n    private readonly nameLabelEl: HTMLElement;\n    private readonly opacityEl: HTMLElement;\n    private lastDrawnSize: ISize2D;\n    private lastDrawnState: number; // from KlHistory\n\n    private readonly canvasSize: number;\n    private readonly canvas: HTMLCanvasElement;\n    private readonly canvasCtx: CanvasRenderingContext2D;\n\n    private animationCount: number; // >0 means it's animating\n    private readonly animationLength: number;\n\n    private readonly animationCanvas: HTMLCanvasElement;\n    private readonly animationCanvasCtx: CanvasRenderingContext2D;\n    private animationCanvasCheckerPattern: CanvasPattern = {} as CanvasPattern;\n\n    private largeCanvasIsVisible: boolean;\n    private readonly largeCanvasWrapper: HTMLElement;\n    private readonly largeCanvasSize: number;\n    private readonly largeCanvas: HTMLCanvasElement;\n    private readonly largeCanvasCtx: CanvasRenderingContext2D;\n    private largeCanvasCheckerPattern: CanvasPattern = {} as CanvasPattern;\n\n\n    private updateCheckerPatterns (): void {\n        const checker = BB.createCheckerCanvas(4, theme.isDark());\n        this.animationCanvasCheckerPattern = throwIfNull(this.animationCanvasCtx.createPattern(checker, 'repeat'));\n        this.largeCanvasCheckerPattern = throwIfNull(this.canvasCtx.createPattern(checker, 'repeat'));\n    }\n    \n    private animate (): void {\n        if (this.animationCount === 0) {\n            return;\n        }\n\n        this.animationCount--;\n\n        this.canvasCtx.save();\n        this.canvasCtx.globalAlpha = Math.pow((this.animationLength - this.animationCount) / this.animationLength, 2);\n        this.canvasCtx.drawImage(this.animationCanvas, 0, 0);\n        this.canvasCtx.restore();\n\n        if (this.animationCount > 0) {\n            requestAnimationFrame(() => this.animate());\n        }\n    }\n\n    /**\n     * is always instant\n     */\n    private drawLargeCanvas (): void {\n\n        if (!this.largeCanvasIsVisible || !this.layerObj) {\n            return;\n        }\n\n        const layerCanvas = this.layerObj.context.canvas;\n\n        const canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, this.largeCanvasSize, this.largeCanvasSize, 1);\n        this.largeCanvas.width = Math.round(canvasDimensions.width);\n        this.largeCanvas.height = Math.round(canvasDimensions.height);\n        this.largeCanvasCtx.save();\n        if (this.largeCanvas.width > layerCanvas.width) {\n            this.largeCanvasCtx.imageSmoothingEnabled = false;\n        } else {\n            this.largeCanvasCtx.imageSmoothingEnabled = true;\n            this.largeCanvasCtx.imageSmoothingQuality = 'high';\n        }\n        this.largeCanvasCtx.fillStyle = this.largeCanvasCheckerPattern;\n        this.largeCanvasCtx.fillRect(0, 0, this.largeCanvas.width, this.largeCanvas.height);\n        this.largeCanvasCtx.drawImage(layerCanvas, 0, 0, this.largeCanvas.width, this.largeCanvas.height);\n        this.largeCanvasCtx.restore();\n\n        const bounds = this.rootEl.getBoundingClientRect();\n        BB.css(this.largeCanvasWrapper, {\n            top: Math.max(10, (bounds.top + this.height / 2 - this.largeCanvas.height / 2)) + 'px',\n        });\n\n    }\n\n    private draw (isInstant: boolean): void {\n        if (!this.isVisible || !this.layerObj) {\n            return;\n        }\n\n        const layerIsVisible = this.layerObj.isVisible;\n        this.checkEl.parentElement!.title = layerIsVisible ? LANG('layers-active-layer-visible') : LANG('layers-active-layer-hidden');\n        this.checkEl.checked = layerIsVisible;\n        this.checkEl.style.boxShadow = layerIsVisible ? '' : '0 0 0 1px red';\n\n        this.nameLabelEl.textContent = this.layerObj.name;\n        if (this.layerObj.isVisible) {\n            this.opacityEl.innerHTML = LANG('opacity') + '<br>' + Math.round(this.layerObj.opacity * 100) + '%';\n        } else {\n            this.opacityEl.innerHTML = LANG('opacity') + '<br><s>' + Math.round(this.layerObj.opacity * 100) + '%</s>';\n        }\n\n        const layerCanvas = this.layerObj.context.canvas;\n\n        if (layerCanvas.width !== this.lastDrawnSize.width || layerCanvas.height !== this.lastDrawnSize.height) {\n            const canvasDimensions = BB.fitInto(layerCanvas.width, layerCanvas.height, this.canvasSize, this.canvasSize, 1);\n            this.canvas.width = Math.round(canvasDimensions.width);\n            this.canvas.height = Math.round(canvasDimensions.height);\n\n            isInstant = true;\n        }\n\n        this.animationCanvas.width = this.canvas.width;\n        this.animationCanvas.height = this.canvas.height;\n\n        this.animationCanvasCtx.save();\n        this.animationCanvasCtx.imageSmoothingEnabled = false;\n        this.animationCanvasCtx.fillStyle = this.animationCanvasCheckerPattern;\n        this.animationCanvasCtx.fillRect(0, 0, this.animationCanvas.width, this.animationCanvas.height);\n        this.animationCanvasCtx.drawImage(layerCanvas, 0, 0, this.animationCanvas.width, this.animationCanvas.height);\n        this.animationCanvasCtx.restore();\n\n        if (isInstant) {\n            this.animationCount = 0;\n            this.canvasCtx.save();\n            this.canvasCtx.drawImage(this.animationCanvas, 0, 0);\n            this.canvasCtx.restore();\n\n        } else {\n            this.animationCount = this.animationLength;\n            this.animate();\n\n        }\n\n        this.drawLargeCanvas();\n\n        this.lastDrawnState = klHistory.getState();\n        this.lastDrawnSize.width = layerCanvas.width;\n        this.lastDrawnSize.height = layerCanvas.height;\n    }\n\n\n    // ---- public ----\n    constructor (\n        p: {\n            onClick: () => void; // when clicking on layer name\n            klRootEl: HTMLElement;\n            uiState: TUiLayout;\n        }\n    ) {\n        // internally redraws with in an interval. checks history is something changed\n        // this update will be animated\n        // it will not be animated if the resolution changed\n        // also redraws when you call updateLayer - not animated\n\n        // syncs via updateLayer, and internally updates layer opacity via a hack\n\n        this.rootEl = BB.el({\n            className: 'kl-layer-preview',\n        });\n        this.isVisible = true;\n        this.height = 40;\n        this.canvasSize = this.height - 10;\n        this.largeCanvasSize = 300;\n        this.lastDrawnState = -2;\n        this.lastDrawnSize = {\n            width: 0,\n            height: 0,\n        };\n        this.animationCanvas = BB.canvas(); // to help animate the transition\n        this.animationCanvasCtx = BB.ctx(this.animationCanvas);\n        this.animationLength = 30;\n        this.animationCount = 0;\n        this.largeCanvasIsVisible = false;\n        let largeCanvasAnimationTimeout: ReturnType<typeof setTimeout>;\n        const largeCanvasAnimationDurationMs = 300;\n        this.uiState = p.uiState;\n\n\n        // --- setup dom ---\n        this.contentWrapperEl = BB.el({\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                height: this.height + 'px',\n            },\n        });\n\n\n        const checkWrapper = BB.el({\n            css: {\n                display: 'flex',\n                justifyContent: 'flex-end',\n                alignItems: 'center',\n                width: '23px',\n                flexShrink: '0',\n            },\n        });\n        this.checkEl = BB.el({\n            parent: checkWrapper,\n            tagName: 'input',\n            css: {\n                pointerEvents: 'none',\n            },\n            custom: {\n                type: 'checkbox',\n                disabled: 'true',\n            },\n        });\n\n        const canvasWrapperEl = BB.el({\n            css: {\n                //background: '#f00',\n                minWidth: this.height + 'px',\n                height: this.height + 'px',\n                display: 'flex',\n                justifyContent: 'center',\n                alignItems: 'center',\n            },\n        });\n        this.canvas = BB.canvas(this.canvasSize, this.canvasSize);\n        this.canvasCtx = BB.ctx(this.canvas);\n        this.canvas.title = LANG('layers-active-layer');\n        const nameWrapper = BB.el({\n            css: {\n                //background: '#ff0',\n                flexGrow: '1',\n                paddingLeft: '10px',\n                fontSize: '13px',\n                overflow: 'hidden',\n                position: 'relative',\n            },\n        });\n        this.nameLabelEl = BB.el({\n            content: '',\n            css: {\n                cssFloat: 'left',\n                whiteSpace: 'nowrap',\n            },\n        });\n        const clickableEl = BB.el({\n            css: {\n                // background: 'rgba(0,255,0,0.6)',\n                position: 'absolute',\n                left: '10px',\n                top: '0',\n                width: '90px',\n                height: '100%',\n            },\n        });\n        if (p.onClick) {\n            clickableEl.addEventListener('click', () => p.onClick());\n            this.canvas.addEventListener('click', () => p.onClick());\n            checkWrapper.addEventListener('click', () => p.onClick());\n        }\n        this.opacityEl = BB.el({\n            content: LANG('opacity') + '<br>100%',\n            css: {\n                minWidth: '60px',\n                fontSize: '12px',\n                textAlign: 'center',\n            },\n        });\n\n        this.largeCanvasWrapper = BB.el({\n            onClick: BB.handleClick,\n            css: {\n                pointerEvents: 'none',\n                background: '#fff',\n                position: 'absolute',\n                right: '280px',\n                top: '10px',\n                border: '1px solid #aaa',\n                boxShadow: '1px 1px 3px rgba(0,0,0,0.3)',\n                transition: 'opacity '+largeCanvasAnimationDurationMs+'ms ease-in-out',\n                userSelect: 'none',\n                display: 'block',\n                webkitTouchCallout: 'none',\n            },\n        });\n        this.largeCanvas = BB.canvas(this.largeCanvasSize, this.largeCanvasSize);\n        this.largeCanvasWrapper.append(this.largeCanvas);\n        this.largeCanvasCtx = BB.ctx(this.largeCanvas);\n        BB.css(this.largeCanvas, {\n            display: 'block',\n        });\n\n\n        canvasWrapperEl.append(this.canvas);\n        nameWrapper.append(this.nameLabelEl, clickableEl);\n        this.contentWrapperEl.append(checkWrapper, canvasWrapperEl, nameWrapper, this.opacityEl);\n        this.rootEl.append(this.contentWrapperEl);\n\n\n        this.updateCheckerPatterns();\n        theme.addIsDarkListener(() => {\n            this.updateCheckerPatterns();\n            this.draw(true);\n        });\n\n\n\n        // --- update logic ---\n\n        // cross-fade done via 2 canvases (old and new state)\n        // both have checkerboard background drawn on them, both fully opaque\n        // -> no \"lighter\" is needed for accurate cross-fading\n\n        setInterval(() => {\n\n            if (!this.layerObj) {\n                return;\n            }\n\n            const currentState = klHistory.getState();\n            if (currentState === this.lastDrawnState) {\n                return;\n            }\n\n            //update opacity w hack\n            this.layerObj.opacity = (this.layerObj.context.canvas as KlCanvasLayer).opacity;\n\n            this.draw(false);\n\n        }, 2000);\n        \n\n        const removeLargeCanvas = () => {\n            this.largeCanvasWrapper.remove();\n        };\n\n        const showLargeCanvas = (b: boolean) => {\n            if (this.largeCanvasIsVisible === b) {\n                return;\n            }\n\n            clearTimeout(largeCanvasAnimationTimeout);\n            this.largeCanvasIsVisible = b;\n\n            if (b) {\n                largeCanvasAnimationTimeout = setTimeout(() => {\n                    this.drawLargeCanvas();\n                    this.largeCanvasWrapper.style.opacity = '0';\n                    p.klRootEl.append(this.largeCanvasWrapper);\n                    setTimeout(() => {\n                        this.largeCanvasWrapper.style.opacity = '1';\n                    }, 20);\n                }, 250);\n\n            } else {\n                this.largeCanvasWrapper.style.opacity = '0';\n                largeCanvasAnimationTimeout = setTimeout(removeLargeCanvas, largeCanvasAnimationDurationMs + 20);\n            }\n\n        };\n\n        const pointerListener = new BB.PointerListener({\n            target: this.canvas,\n            onEnterLeave: (b) => {\n                showLargeCanvas(b);\n            },\n        });\n    }\n\n    // ---- interface ----\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsVisible (b: boolean): void {\n        if (this.isVisible === b) {\n            return;\n        }\n        this.isVisible = b;\n        this.contentWrapperEl.style.display = this.isVisible ? 'flex' : 'none';\n        this.rootEl.style.marginBottom = this.isVisible ? '' : '10px';\n\n        const currentState = klHistory.getState();\n        if (b && this.lastDrawnState !== currentState) {\n            this.draw(true);\n        }\n    }\n\n    //when the layer might have changed\n    setLayer (klCanvasLayerObj: TKlCanvasLayer): void {\n        this.layerObj = klCanvasLayerObj;\n        this.draw(true);\n    }\n\n    setUiState (stateStr: TUiLayout): void {\n        this.uiState = stateStr;\n\n        if (this.uiState === 'left') {\n            BB.css(this.largeCanvasWrapper, {\n                left: '280px',\n                right: '',\n            });\n        } else {\n            BB.css(this.largeCanvasWrapper, {\n                left: '',\n                right: '280px',\n            });\n        }\n    }\n\n}\n","import {BB} from '../../../bb/bb';\nimport {FreeTransformCanvas} from '../components/free-transform-canvas';\nimport {showModal} from './base/showModal';\nimport {KlCanvas} from '../../canvas/kl-canvas';\nimport {IKlBasicLayer} from '../../kl-types';\nimport {LANG} from '../../../language/language';\nimport {testIsSmall} from '../utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth} from '../utils/preview-size';\n\nexport function showImportAsLayerDialog (\n    params: {\n        target: HTMLElement;\n        klCanvas: KlCanvas;\n        importImage: HTMLImageElement | HTMLCanvasElement;\n        callback: (\n            p?: {x: number; y: number; width:number; height: number; angleDeg: number},\n            isPixelated?: boolean\n        ) => void;\n    }\n): void {\n\n    const div = document.createElement('div');\n    BB.appendTextDiv(div, LANG('import-as-layer-description'));\n    if (params.klCanvas.isLayerLimitReached()) {\n        const noteEl = BB.el({\n            content: LANG('import-as-layer-limit-reached'),\n            css: {\n                background: '#ff0',\n                padding: '10px',\n                marginTop: '5px',\n                marginBottom: '5px',\n                border: '1px solid #e7d321',\n                borderRadius: '5px',\n            },\n        });\n        div.append(noteEl);\n    }\n    const isSmall = testIsSmall();\n\n    const buttonRowEl = BB.el({\n        css: {\n            display: 'flex',\n        },\n    });\n    const originalSizeBtn = BB.el({\n        tagName: 'button',\n        content: '1:1',\n        css: {\n            marginRight: '10px',\n        },\n        onClick: function () {\n            freeTransformCanvas.reset();\n        },\n    });\n    const fitSizeBtn = BB.el({\n        tagName: 'button',\n        content: LANG('import-as-layer-fit'),\n        css: {\n            marginRight: '10px',\n        },\n        onClick: function () {\n            freeTransformCanvas.setTransformFit();\n        },\n    });\n    const centerBtn = BB.el({\n        tagName: 'button',\n        content: LANG('center'),\n        css: {\n            marginRight: '10px',\n        },\n        onClick: function () {\n            freeTransformCanvas.setTransformCenter();\n        },\n    });\n    buttonRowEl.append(originalSizeBtn, fitSizeBtn, centerBtn);\n    div.append(buttonRowEl);\n\n\n\n    const layers: IKlBasicLayer[] = [];\n    {\n        const klCanvasLayerArr = params.klCanvas.getLayers();\n        for (let i = 0; i < klCanvasLayerArr.length; i++) {\n            layers.push({\n                image: klCanvasLayerArr[i].context.canvas,\n                isVisible: klCanvasLayerArr[i].isVisible,\n                opacity: klCanvasLayerArr[i].opacity,\n                mixModeStr: klCanvasLayerArr[i].mixModeStr,\n            });\n        }\n    }\n    layers.push({\n        image: params.importImage,\n        isVisible: true,\n        opacity: 1,\n        mixModeStr: 'source-over',\n    });\n\n\n    const freeTransformCanvas = new FreeTransformCanvas({\n        elementWidth: getPreviewWidth(isSmall),\n        elementHeight: getPreviewHeight(isSmall) + 50,\n        imageWidth: params.klCanvas.getLayerContext(0)!.canvas.width,\n        imageHeight: params.klCanvas.getLayerContext(0)!.canvas.height,\n        layers: layers,\n        transformIndex: layers.length - 1,\n    });\n    BB.css(freeTransformCanvas.getElement(), {\n        marginTop: '10px',\n        marginLeft: '-20px',\n    });\n    div.append(freeTransformCanvas.getElement());\n\n    function move (x: number, y: number): void {\n        freeTransformCanvas.move(x, y);\n    }\n\n    const keyListener = new BB.KeyListener({\n        onDown: function (keyStr) {\n            if (keyStr === 'left') {\n                move(-1, 0);\n            }\n            if (keyStr === 'right') {\n                move(1, 0);\n            }\n            if (keyStr === 'up') {\n                move(0, -1);\n            }\n            if (keyStr === 'down') {\n                move(0, 1);\n            }\n        },\n    });\n\n    showModal({\n        target: params.target,\n        message: `<b>${LANG('import-as-layer-title')}</b>`,\n        div: div,\n        style: isSmall ? undefined : {\n            width: '540px',\n        },\n        buttons: ['Ok', 'Cancel'],\n        clickOnEnter: 'Ok',\n        callback: function (buttonStr) {\n            keyListener.destroy();\n            freeTransformCanvas.destroy();\n            BB.destroyEl(originalSizeBtn);\n            BB.destroyEl(fitSizeBtn);\n            BB.destroyEl(centerBtn);\n            if (buttonStr === 'Ok') {\n                params.callback(freeTransformCanvas.getTransformation(), freeTransformCanvas.getIsPixelated());\n            } else {\n                params.callback();\n            }\n        },\n    });\n\n}","\nexport function testIsSmall (): boolean {\n    return window.innerWidth < 550;\n}","\nexport const smallPreview = {\n    width: 340,\n    height: 220,\n};\n\nexport const mediumPreview = {\n    width: 540,\n    height: 300,\n};\n\nexport function getPreviewWidth (isSmall: boolean): number {\n    return isSmall ? smallPreview.width : mediumPreview.width;\n}\n\nexport function getPreviewHeight (isSmall: boolean): number {\n    return isSmall ? smallPreview.height : mediumPreview.height;\n}","import {BB} from '../../../bb/bb';\n\ntype TDropOption = 'default' | 'layer' | 'image';\n\n/**\n * Not really generalized. UI when you drag/drop an image into window.\n * The moment you create it, it will listen.\n * */\nexport class KlImageDropper {\n\n    private readonly rootEl: HTMLElement;\n\n    // ---- public ----\n    constructor (\n        p: {\n            onDrop: (files: FileList, optionStr: TDropOption) => void;\n            target: HTMLElement;\n            enabledTest: () => boolean;\n        }\n    ) {\n        //set up DOM\n        this.rootEl = BB.el({\n            content: 'Drop to import',\n            css: {\n                paddingTop: '100px',\n                position: 'fixed',\n                left: '0',\n                top: '0',\n                width: '100%',\n                height: '100%',\n                background: 'rgba(50, 50, 50, 0.7)',\n                color: '#fff',\n                textShadow: '2px 2px #000',\n                textAlign: 'center',\n                fontSize: '25px',\n            },\n        });\n        const wrapperEl = BB.el({\n            css: {\n                'marginTop': '50px',\n                'display': 'flex',\n                'justifyContent': 'center',\n            },\n        });\n        const optionStyle = {\n            width: '200px',\n            padding: '50px',\n            margin: '10px',\n            //opacity: 0.5,\n            borderRadius: '20px',\n            border: '1px dashed #fff',\n            background: '#00aefe',\n            fontWeight: 'bold',\n        };\n        const optionLayerEl = BB.el({\n            content: 'As Layer',\n            css: optionStyle,\n        });\n        const optionImageEl = BB.el({\n            content: 'As New Image',\n            css: optionStyle,\n        });\n\n        this.rootEl.append(wrapperEl);\n        wrapperEl.append(optionLayerEl, optionImageEl);\n\n\n        let rootCounter = 0;\n        let optionLayerCounter = 0;\n        let optionImageCounter = 0;\n\n        const destroy = () => {\n            rootCounter = 0;\n            optionLayerCounter = 0;\n            optionImageCounter = 0;\n            this.rootEl.remove();\n        };\n\n        /**\n         * check, can drop content be imported\n         */\n        const testAcceptType = (event: DragEvent): boolean => {\n            return !!event.dataTransfer && !event.dataTransfer.types.includes('text/plain');\n        };\n\n        const updateOptions = () => {\n            const boxShadow = '0 0 20px 4px #fff';\n            if (optionLayerCounter > 0) {\n                optionLayerEl.style.boxShadow = boxShadow;\n                optionImageEl.style.boxShadow = '';\n            } else if (optionImageCounter > 0) {\n                optionLayerEl.style.boxShadow = '';\n                optionImageEl.style.boxShadow = boxShadow;\n            } else {\n                optionLayerEl.style.boxShadow = '';\n                optionImageEl.style.boxShadow = '';\n            }\n        };\n\n        optionLayerEl.addEventListener('dragenter', () => {\n            optionLayerCounter++;\n            updateOptions();\n        });\n        optionLayerEl.addEventListener('dragleave', () => {\n            optionLayerCounter--;\n            updateOptions();\n        });\n        optionImageEl.addEventListener('dragenter', () => {\n            optionImageCounter++;\n            updateOptions();\n        });\n        optionImageEl.addEventListener('dragleave', () => {\n            optionImageCounter--;\n            updateOptions();\n        });\n\n\n        const rootDragOver = (event: DragEvent): void => {\n            if (!testAcceptType(event)) {\n                return;\n            }\n            event.stopPropagation();\n            event.preventDefault();\n        };\n\n        const rootDragEnter = (event: DragEvent): void => {\n            if (!p.enabledTest() || !testAcceptType(event)) {\n                return;\n            }\n            if (rootCounter === 0) {\n                p.target.append(this.rootEl);\n            }\n            rootCounter++;\n        };\n\n        const rootDragLeave = (event: DragEvent): void => {\n            if (!testAcceptType(event) || rootCounter === 0) {\n                return;\n            }\n            rootCounter = Math.max(0, rootCounter - 1);\n            if (rootCounter === 0) {\n                this.rootEl.remove();\n            }\n        };\n\n        const rootDrop = (event: DragEvent): void => {\n            if (!testAcceptType(event) || !event.dataTransfer || event.dataTransfer.files.length === 0) {\n                destroy();\n                return;\n            }\n            event.stopPropagation();\n            event.preventDefault();\n\n            let optionStr: TDropOption = 'default';\n            if (optionLayerCounter > 0) {\n                optionStr = 'layer';\n            } else if (optionImageCounter > 0) {\n                optionStr = 'image';\n            }\n\n            p.onDrop(event.dataTransfer.files, optionStr);\n\n\n            if (rootCounter > 0) {\n                this.rootEl.remove();\n            }\n            rootCounter = 0;\n            optionLayerCounter = 0;\n            optionImageCounter = 0;\n            updateOptions();\n        };\n\n        window.addEventListener('dragover', rootDragOver, false);\n        window.addEventListener('dragenter', rootDragEnter, false);\n        window.addEventListener('dragleave', rootDragLeave, false);\n        window.addEventListener('drop', rootDrop, false);\n\n        // if something goes wrong and you're stuck with overlay\n        this.rootEl.addEventListener('pointerdown', () => {\n            destroy();\n        });\n        const keyListener = new BB.KeyListener({\n            onDown: (keyStr) => {\n                if (rootCounter > 0 && keyStr === 'esc') {\n                    destroy();\n                }\n            },\n        });\n    }\n\n    // ---- interface ----\n}\n","import {BB} from '../../../bb/bb';\nimport {KlColorSliderSmall} from './kl-color-slider-small';\nimport {KlSlider} from './kl-slider';\nimport {BrushSettingService, TBrushSettingEmit} from '../../brushes-ui/brush-setting-service';\nimport {LANG} from '../../../language/language';\nimport {IRGB} from '../../kl-types';\nimport {IVector2D} from '../../../bb/bb-types';\n\n/**\n * Compressed HUD toolspace. When you hold ctrl+alt.\n * small color picker, brush settings\n */\nexport class OverlayToolspace {\n\n    private readonly rootEl: HTMLElement;\n\n    // ---- public ----\n    constructor (\n        p: {\n            brushSettingService: BrushSettingService; // to sync with outside\n            enabledTest: () => boolean; // calls to see if it's allowed to show\n        }\n    ) {\n        const sizeObj = {\n            width: 150,\n            svHeight: 90,\n            hHeight: 20,\n            sliderHeight: 25,\n        };\n\n        let isVisible = false;\n        this.rootEl = BB.el({\n            className: 'kl-overlay-toolspace',\n        });\n        const queuedObj: {\n            color: IRGB | null;\n            size: number | null;\n            opacity: number | null;\n        } = {\n            color: null,\n            size: null,\n            opacity: null,\n        };\n\n\n        // --- inputs ---\n\n        //color selection\n        const colorEl = BB.el({\n            parent: this.rootEl,\n            className: 'kl-overlay-toolspace__color',\n        });\n        const colorSlider = new KlColorSliderSmall({\n            width: sizeObj.width,\n            heightSV: sizeObj.svHeight,\n            heightH: sizeObj.hHeight,\n            color: p.brushSettingService.getColor(),\n            callback: (rgbObj: IRGB) => {\n                selectedColorEl.style.backgroundColor = 'rgb(' + rgbObj.r + ',' + rgbObj.g + ',' + rgbObj.b + ')';\n                p.brushSettingService.setColor(rgbObj, subscriptionFunc);\n            },\n        });\n        const selectedColorEl = BB.el({\n            css: {\n                width: sizeObj.width + 'px',\n                height: sizeObj.hHeight + 'px',\n                pointerEvents: 'none',\n            },\n        });\n        {\n            const initialColor = p.brushSettingService.getColor();\n            selectedColorEl.style.backgroundColor = 'rgb(' + initialColor.r + ',' + initialColor.g + ',' + initialColor.b + ')';\n        }\n\n        colorEl.append(selectedColorEl, colorSlider.getElement());\n\n\n        const updateColor = (rgbObj: IRGB) => {\n            colorSlider.setColor(rgbObj);\n            selectedColorEl.style.backgroundColor = 'rgb(' + rgbObj.r + ',' + rgbObj.g + ',' + rgbObj.b + ')';\n        };\n\n\n\n        //brushsize slider\n\n        const sizeSlider = new KlSlider({\n            label: LANG('brush-size'),\n            width: sizeObj.width,\n            height: sizeObj.sliderHeight,\n            min: 0,\n            max: 500,\n            value: 50,\n            resolution: 225,\n            eventResMs: 1000 / 30,\n            toDisplayValue: (val) => val * 2,\n            toValue: (displayValue) => displayValue / 2,\n            onChange: (v) => {\n                p.brushSettingService.setSize(v);\n            },\n            formatFunc: (displayValue) => {\n                if (displayValue < 10) {\n                    return BB.round(displayValue, 1);\n                } else {\n                    return Math.round(displayValue);\n                }\n            },\n        });\n        BB.css(sizeSlider.getElement(), {\n            marginTop: '2px',\n        });\n\n        const opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: sizeObj.width,\n            height: sizeObj.sliderHeight,\n            min: 0,\n            max: 1,\n            value: 1,\n            resolution: 225,\n            eventResMs: 1000 / 30,\n            toDisplayValue: (val) => val * 100,\n            toValue: (displayValue) => displayValue / 100,\n            onChange: (v) => {\n                p.brushSettingService.setOpacity(v);\n            },\n        });\n        BB.css(opacitySlider.getElement(), {\n            margin: '2px 0',\n        });\n        this.rootEl.append(sizeSlider.getElement(), opacitySlider.getElement());\n\n\n\n        // --- general setup ---\n\n        const subscriptionFunc = (event: TBrushSettingEmit) => {\n            if (event.type === 'color') {\n                if (!isVisible) {\n                    queuedObj.color = event.value;\n                } else {\n                    updateColor(event.value);\n                }\n            }\n            if (event.type === 'size') {\n                if (!isVisible) {\n                    queuedObj.size = event.value;\n                } else {\n                    sizeSlider.setValue(event.value);\n                }\n            }\n            if (event.type === 'opacity') {\n                if (!isVisible) {\n                    queuedObj.opacity = event.value;\n                } else {\n                    opacitySlider.setValue(event.value);\n                }\n            }\n            if (event.type === 'sliderConfig') {\n                sizeSlider.update(event.value.sizeSlider);\n                opacitySlider.update(event.value.opacitySlider);\n            }\n        };\n        p.brushSettingService.subscribe(subscriptionFunc);\n        {\n            const sliderConfig = p.brushSettingService.getSliderConfig();\n            sizeSlider.update(sliderConfig.sizeSlider);\n            opacitySlider.update(sliderConfig.opacitySlider);\n            sizeSlider.setValue(p.brushSettingService.getSize());\n            opacitySlider.setValue(p.brushSettingService.getOpacity());\n        }\n\n        const updateUI = () => {\n\n            // unfocus manual slider input\n            BB.unfocusAnyInput();\n\n            this.rootEl.style.display = isVisible ? 'block' : 'none';\n            if (isVisible && mousePos) {\n                BB.css(this.rootEl, {\n                    left: (mousePos.x - Math.round(sizeObj.width / 2)) + 'px',\n                    top: (mousePos.y - Math.round(sizeObj.svHeight + sizeObj.hHeight * 3 / 2)) + 'px',\n                });\n            }\n        };\n\n        let mousePos: IVector2D | null = null;\n        document.addEventListener('pointermove', (event) => {\n            mousePos = {\n                x: event.pageX,\n                y: event.pageY,\n            };\n        });\n\n        const keyListener = new BB.KeyListener({\n            onDown: (keyStr, event, comboStr, isRepeat) => {\n                if (isRepeat) {\n                    return;\n                }\n                if (isVisible) {\n                    isVisible = false;\n                    updateUI();\n                    return;\n                }\n\n                if (!p.enabledTest() || !mousePos) {\n                    return;\n                }\n\n                if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(comboStr)) {\n                    event.preventDefault();\n                    isVisible = true;\n\n                    if (queuedObj.color !== null) {\n                        updateColor(queuedObj.color);\n                        queuedObj.color = null;\n                    }\n                    if (queuedObj.size !== null) {\n                        sizeSlider.setValue(queuedObj.size);\n                        queuedObj.size = null;\n                    }\n                    if (queuedObj.opacity !== null) {\n                        opacitySlider.setValue(queuedObj.opacity);\n                        queuedObj.opacity = null;\n                    }\n\n                    updateUI();\n                }\n\n            },\n            onUp: (keyStr, event, oldComboStr) => {\n                if (['ctrl+alt', 'cmd+alt', 'alt+ctrl', 'alt+cmd'].includes(oldComboStr) && isVisible) {\n                    isVisible = false;\n                    colorSlider.end();\n                    updateUI();\n                }\n            },\n            onBlur: () => {\n                if (isVisible) {\n                    isVisible = false;\n                    colorSlider.end();\n                    updateUI();\n                }\n            },\n        });\n    }\n\n    // ---- interface ----\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n}","import {BB} from '../../../bb/bb';\nimport klecksLogoImg from '/src/app/img/klecks-logo.png';\nimport newImageImg from '/src/app/img/ui/new-image.svg';\nimport importImg from '/src/app/img/ui/import.svg';\nimport exportImg from '/src/app/img/ui/export.svg';\nimport shareImg from '/src/app/img/ui/share.svg';\nimport helpImg from '/src/app/img/ui/help.svg';\nimport {LANG} from '../../../language/language';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\n\n\n/**\n * Topmost row of buttons in toolspace (with the app logo)\n */\nexport class ToolspaceTopRow {\n    \n    private readonly rootEl: HTMLElement;\n    \n    // ---- public ----\n    constructor (\n        p: {\n            logoImg: string;\n            onLogo: () => void;\n            onNew: () => void;\n            onImport: () => void;\n            onSave: () => void;\n            onShare: () => void;\n            onHelp: () => void;\n        }\n    ) {\n        this.rootEl = BB.el({\n            className: 'kl-toolspace-row',\n            css: {\n                height: '36px',\n                display: 'flex',\n            },\n        });\n\n        function createButton (\n            p: {\n                onClick: () => void;\n                title: string;\n                image: string;\n                contain: boolean;\n                extraPadding?: number;\n                darkInvert?: boolean;\n            }\n        ): {\n            el: HTMLElement;\n            pointerListener: PointerListener;\n        } {\n            const padding = 6 + (p.extraPadding ? p.extraPadding : 0);\n            const el = BB.el({\n                className: 'toolspace-row-button nohighlight',\n                title: p.title,\n                onClick: p.onClick,\n                css: {\n                    padding: p.contain ? padding + 'px 0' : '',\n                },\n            });\n            const im = BB.el({\n                className: p.darkInvert ? 'dark-invert' : undefined,\n                css: {\n                    backgroundImage: 'url(\\'' + p.image + '\\')',\n                    backgroundRepeat: 'no-repeat',\n                    backgroundPosition: 'center',\n                    backgroundSize: p.contain ? 'contain' : '',\n                    //filter: 'grayscale(1)',\n                    height: '100%',\n                },\n            });\n            im.style.pointerEvents = 'none';\n            el.append(im);\n            const pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\n                target: el,\n                onEnterLeave: function (isOver) {\n                    el.classList.toggle('toolspace-row-button-hover', isOver);\n                },\n            });\n            return {\n                el,\n                pointerListener,\n            };\n        }\n\n        const logoButton = createButton({\n            onClick: p.onLogo,\n            title: LANG('home'),\n            image: p.logoImg ? p.logoImg : klecksLogoImg,\n            contain: true,\n            darkInvert: true,\n        });\n        logoButton.el.classList.add('kl-tool-row-border-right');\n        BB.css(logoButton.el, {\n            width: '46px',\n        });\n        const newButton = createButton({\n            onClick: p.onNew,\n            title: LANG('file-new'),\n            image: newImageImg,\n            extraPadding: 1,\n            contain: true,\n        });\n        const importButton = createButton({\n            onClick: p.onImport,\n            title: LANG('file-import'),\n            image: importImg,\n            extraPadding: 1,\n            contain: true,\n        });\n        const saveButton = createButton({\n            onClick: p.onSave,\n            title: LANG('file-save'),\n            image: exportImg,\n            extraPadding: 1,\n            contain: true,\n        });\n\n        let shareButton = null;\n        if (BB.canShareFiles()) {\n            shareButton = createButton({\n                onClick: p.onShare,\n                title: LANG('file-share'),\n                image: shareImg,\n                contain: true,\n                darkInvert: true,\n            });\n        }\n        const helpButton = createButton({\n            onClick: p.onHelp,\n            title: LANG('help'),\n            image: helpImg,\n            contain: true,\n            darkInvert: true,\n        });\n\n        BB.append(this.rootEl, [\n            logoButton.el,\n            newButton.el,\n            importButton.el,\n            saveButton.el,\n            shareButton ? shareButton.el : undefined,\n            helpButton.el,\n        ]);\n    }\n    \n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"klecks-logo.2dcce02e.png\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"new-image.2d692480.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"import.7a68c844.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"export.2deb9ff8.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"share.454898d1.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"help.208e9032.svg\";","import {BB} from '../../../bb/bb';\nimport {dialogCounter} from '../modals/modal-count';\nimport toolPaintImg from '/src/app/img/ui/tool-paint.svg';\nimport toolFillImg from '/src/app/img/ui/tool-fill.svg';\nimport toolGradientImg from '/src/app/img/ui/tool-gradient.svg';\nimport toolTextImg from '/src/app/img/ui/tool-text.svg';\nimport toolShapeImg from '/src/app/img/ui/tool-shape.svg';\nimport caretDownImg from '/src/app/img/ui/caret-down.svg';\nimport {LANG} from '../../../language/language';\nimport {TToolType} from '../../kl-types';\n\n\ntype TDropdownButton = {\n    wrapper: HTMLElement;\n    show: (b: boolean) => void;\n    setIsSmall: (b: boolean) => void;\n};\n\n/**\n * Toolrow Dropdown. The button where you select: brush, fill, select, transform, etc.\n */\nexport class ToolDropdown {\n\n    private readonly rootEl: HTMLElement;\n    private readonly activeButton: HTMLElement;\n    private readonly smallMargin: string = '6px 0';\n    private readonly optionArr: TToolType[] = ['draw', 'fill', 'gradient', 'text', 'shape'];\n    private readonly dropdownBtnArr: TDropdownButton[];\n    private readonly arrowButton: HTMLElement;\n    private isActive: boolean;\n    private currentActiveIndex: number;\n    private readonly titleArr: string[];\n    private activeButtonIm: HTMLElement;\n    private readonly imArr;\n\n    private updateButton () {\n        this.activeButton.title = this.titleArr[this.currentActiveIndex];\n        this.activeButtonIm.style.backgroundImage = 'url(\\'' + this.imArr[this.currentActiveIndex] + '\\')';\n    }\n\n\n\n    // ---- public ----\n    constructor (\n        p: {\n            onChange: (activeStr: TToolType) => void;\n        }\n    ) {\n        this.imArr = [\n            toolPaintImg,\n            toolFillImg,\n            toolGradientImg,\n            toolTextImg,\n            toolShapeImg,\n        ];\n        this.titleArr = [\n            `${LANG('tool-brush')} [B]`,\n            `${LANG('tool-paint-bucket')} [G]`,\n            `${LANG('tool-gradient')} [G]`,\n            `${LANG('tool-text')} [T]`,\n            `${LANG('tool-shape')} [U]`,\n        ];\n        this.currentActiveIndex = 0;\n        this.isActive = true;\n        let isOpen = false;\n\n        //preload images\n        setTimeout(() => {\n            for (let i = 1; i < this.imArr.length; i++) {\n                const im = new Image();\n                im.src = this.imArr[i];\n            }\n        }, 100);\n\n        this.rootEl = BB.el({\n            css: {\n                position: 'relative',\n                flexGrow: '1',\n            },\n        });\n\n        let openTimeout: ReturnType<typeof setTimeout>;\n        let isDragging = false;\n        let startX: number;\n        let startY: number;\n        let pointerListener;\n        if (BB.hasPointerEvents) {\n            pointerListener = new BB.PointerListener({\n                target: this.rootEl,\n                onPointer: (event) => {\n                    if (event.type === 'pointerdown') {\n                        if (isOpen) {\n                            return;\n                        }\n\n                        openTimeout = setTimeout(() => {\n                            showDropdown();\n                        }, 400);\n                        isDragging = true;\n                        startX = event.pageX;\n                        startY = event.pageY;\n\n                    } else if (event.type === 'pointermove') {\n                        if (isDragging && !isOpen && BB.dist(startX, startY, event.pageX, event.pageY) > 5) {\n                            clearTimeout(openTimeout);\n                            showDropdown();\n                        }\n\n                    } else if (event.type === 'pointerup') {\n                        clearTimeout(openTimeout);\n                        if (isOpen && isDragging) {\n                            const target = document.elementFromPoint(event.pageX, event.pageY);\n                            for (let i = 0; i < this.dropdownBtnArr.length; i++) {\n                                if (target === this.dropdownBtnArr[i].wrapper) {\n                                    closeDropdown();\n                                    this.isActive = true;\n                                    this.currentActiveIndex = i;\n                                    this.updateButton();\n                                    p.onChange(this.optionArr[this.currentActiveIndex]);\n                                    break;\n                                }\n                            }\n                        }\n                        isDragging = false;\n                    }\n                },\n            });\n        }\n\n        this.activeButton = BB.el({\n            parent: this.rootEl,\n            className: 'toolspace-row-button nohighlight toolspace-row-button-activated',\n            title: this.titleArr[this.currentActiveIndex],\n            onClick: (e) => {\n                if (this.isActive && !isOpen) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    showDropdown();\n                    return;\n                }\n\n                this.isActive = true;\n                p.onChange(this.optionArr[this.currentActiveIndex]);\n                if (isOpen) {\n                    closeDropdown();\n                }\n            },\n            css: {\n                padding: '10px 0',\n                pointerEvents: 'auto',\n                height: '100%',\n                boxSizing: 'border-box',\n            },\n        });\n\n        this.activeButtonIm = BB.el({\n            parent: this.activeButton,\n            className: 'dark-invert',\n            css: {\n                backgroundRepeat: 'no-repeat',\n                backgroundPosition: 'center',\n                backgroundSize: 'contain',\n                width: 'calc(100% - 7px)',\n                height: '100%',\n                pointerEvents: 'none',\n                opacity: '0.75',\n            },\n        });\n\n        this.arrowButton = BB.el({\n            parent: this.activeButton,\n            className: 'dark-invert',\n            css: {\n                position: 'absolute',\n                right: '1px',\n                bottom: '1px',\n                width: '18px',\n                height: '18px',\n                //background: '#aaa',\n                //borderRadius: '2px',\n                cursor: 'pointer',\n\n                backgroundImage: 'url(\\'' + caretDownImg + '\\')',\n                backgroundRepeat: 'no-repeat',\n                backgroundPosition: 'center',\n                backgroundSize: '60%',\n            },\n            title: 'More Tools',\n            onClick: (e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                showDropdown();\n            },\n        });\n\n\n        const overlay = BB.el({\n            css: {\n                position: 'absolute',\n                //background: 'rgba(255,0,0,0.5)',\n                left: '0',\n                top: '0',\n                right: '0',\n                bottom: '0',\n            },\n        });\n        const overlayPointerListener = new BB.PointerListener({\n            target: overlay,\n            onPointer: (e) => {\n                if (e.type === 'pointerdown') {\n                    e.eventPreventDefault();\n                    closeDropdown();\n                }\n            },\n        });\n\n        const dropdownWrapper = BB.el({\n            className: 'tool-dropdown-wrapper',\n            css: {\n                position: 'absolute',\n                width: '100%',\n                height: (100 * (this.optionArr.length - 1)) + '%',\n                top: '100%',\n                left: '0',\n                zIndex: '1',\n                boxSizing: 'border-box',\n                cursor: 'pointer',\n                transition: 'height 0.1s ease-in-out, opacity 0.1s ease-in-out',\n                borderBottomLeftRadius: '5px',\n                borderBottomRightRadius: '5px',\n                overflow: 'hidden',\n            },\n        });\n\n        this.dropdownBtnArr = [];\n\n        const createDropdownButton = (\n            p: {\n                index: number;\n                id: TToolType;\n                image: string;\n                title: string;\n                onClick: (index: number) => void;\n            }\n        ): TDropdownButton => {\n            const wrapper = BB.el({\n                parent: dropdownWrapper,\n                className: 'tool-dropdown-button',\n                title: p.title,\n                css: {\n                    padding: '10px 0',\n                    height: (100 / (this.optionArr.length - 1)) + '%',\n                    boxSizing: 'border-box',\n                },\n                onClick: (e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    p.onClick(p.index);\n                },\n            });\n\n            BB.el({\n                parent: wrapper,\n                className: 'dark-invert',\n                css: {\n                    backgroundImage: 'url(\\'' + p.image + '\\')',\n                    backgroundRepeat: 'no-repeat',\n                    backgroundPosition: 'center',\n                    backgroundSize: 'contain',\n                    height: '100%',\n                    pointerEvents: 'none',\n                    opacity: '0.75',\n                },\n            });\n\n            // --- interface ---\n            const show = (b: boolean) => {\n                wrapper.style.display = b ? 'block' : 'none';\n            };\n\n            const setIsSmall = (b: boolean) => {\n                wrapper.style.padding = b ? this.smallMargin : '10px 0';\n            };\n\n            return {\n                wrapper,\n                show,\n                setIsSmall,\n            };\n        };\n\n        const onClickDropdownBtn = (index: number) => {\n            closeDropdown();\n\n            this.isActive = true;\n            this.currentActiveIndex = index;\n\n            this.updateButton();\n\n            p.onChange(this.optionArr[this.currentActiveIndex]);\n        };\n\n        for (let i = 0; i < this.optionArr.length; i++) {\n            this.dropdownBtnArr.push(createDropdownButton({\n                index: i,\n                id: this.optionArr[i],\n                image: this.imArr[i],\n                title: this.titleArr[i],\n                onClick: onClickDropdownBtn,\n            }));\n        }\n\n        const showDropdown = () => {\n            dialogCounter.increase(0.5);\n            isOpen = true;\n\n            for (let i = 0; i < this.optionArr.length; i++) {\n                this.dropdownBtnArr[i].show(this.currentActiveIndex !== i);\n            }\n\n            this.arrowButton.style.display = 'none';\n            this.rootEl.style.zIndex = '1';\n            document.body.append(overlay);\n            this.rootEl.append(dropdownWrapper);\n        };\n\n        const closeDropdown = () => {\n            dialogCounter.decrease(0.5);\n            isOpen = false;\n            this.arrowButton.style.removeProperty('display');\n            this.rootEl.style.removeProperty('z-index');\n            overlay.remove();\n            dropdownWrapper.remove();\n        };\n\n        this.updateButton();\n    }\n\n    // ---- interface ----\n\n    setIsSmall (b: boolean): void {\n        this.activeButton.style.padding = b ? this.smallMargin : '10px 0';\n        for (let i = 0; i < this.optionArr.length; i++) {\n            this.dropdownBtnArr[i].setIsSmall(b);\n        }\n        if (b) {\n            this.arrowButton.style.width = '14px';\n            this.arrowButton.style.height = '14px';\n        } else {\n            this.arrowButton.style.width = '18px';\n            this.arrowButton.style.height = '18px';\n        }\n    }\n\n    setActive (activeStr: TToolType): void {\n        if (this.optionArr.includes(activeStr)) {\n            this.isActive = true;\n            for (let i = 0; i < this.optionArr.length; i++) {\n                if (this.optionArr[i] === activeStr) {\n                    this.currentActiveIndex = i;\n                    break;\n                }\n            }\n            this.activeButton.classList.add('toolspace-row-button-activated');\n            this.updateButton();\n        } else {\n            this.isActive = false;\n            this.activeButton.classList.remove('toolspace-row-button-activated');\n        }\n    }\n\n    getActive (): TToolType {\n        return this.optionArr[this.currentActiveIndex];\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"tool-paint.f73a8943.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"tool-fill.3358320a.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"tool-gradient.64486254.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"tool-text.1cbd0325.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"tool-shape.3de78c3f.svg\";","import {BB} from '../../../bb/bb';\nimport {ToolDropdown} from './tool-dropdown';\nimport toolHandImg from '/src/app/img/ui/tool-hand.svg';\nimport toolZoomInImg from '/src/app/img/ui/tool-zoom-in.svg';\nimport toolZoomOutImg from '/src/app/img/ui/tool-zoom-out.svg';\nimport toolUndoImg from '/src/app/img/ui/tool-undo.svg';\nimport {LANG} from '../../../language/language';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\nimport {TToolType} from '../../kl-types';\n\n\ntype TBaseToolRowButton = {\n    el: HTMLElement;\n};\n\ntype TToolRowButton = TBaseToolRowButton & {\n    pointerListener: PointerListener;\n    setIsSmall: (b: boolean) => void;\n};\n\ntype TToolRowTriangleButton = TBaseToolRowButton & {\n    setIsEnabledLeft: (b: boolean) => void;\n    setIsEnabledRight: (b: boolean) => void;\n    leftPointerListener: PointerListener;\n    rightPointerListener: PointerListener;\n};\n\n/**\n * Row of buttons in toolspace. image-operations (draw, hand), zoom, undo/redo\n * Need to do syncing. So tool is correct, and zoom/undo/redo buttons are properly enabled/disabled\n * heights: 54px tall, 36px small -> via setIsSmall\n */\nexport class ToolspaceToolRow {\n\n    private readonly rootEl: HTMLElement;\n    private readonly toolDropdown: ToolDropdown;\n    private readonly handButton: TToolRowButton;\n    private readonly zoomInButton: TToolRowButton;\n    private readonly zoomOutButton: TToolRowButton;\n    private readonly undoButton: TToolRowButton;\n    private readonly redoButton: TToolRowButton;\n    private readonly zoomInNOutButton: TToolRowTriangleButton;\n    private readonly undoNRedoButton: TToolRowTriangleButton;\n    private currentActiveStr: TToolType;\n    private readonly onActivate: (activeStr: TToolType) => void;\n\n\n    // ---- public ----\n\n    constructor (\n        p: {\n            onActivate: (activeStr: TToolType) => void; // clicking on tool button - activating it\n            onZoomIn: () => void;\n            onZoomOut: () => void;\n            onUndo: () => void;\n            onRedo: () => void;\n        }\n    ) {\n        this.rootEl = BB.el( {\n            className: 'kl-toolspace-row',\n            css: {\n                height: '54px',\n                display: 'flex',\n            },\n        });\n\n        this.onActivate = p.onActivate;\n        this.currentActiveStr = 'draw'; // 'draw' | 'hand' | 'fill'\n\n\n        const createButton = (p: {\n            onClick: () => void;\n            image: string;\n            contain: boolean;\n            doLighten?: boolean;\n            doMirror?: boolean;\n        }): TToolRowButton => {\n\n            const smallMargin = p.doLighten ? '6px 0' : '8px 0';\n\n            const el = BB.el({\n                className: 'toolspace-row-button nohighlight',\n                //title: p.title,\n                onClick: p.onClick,\n                css: {\n                    padding: p.contain ? '10px 0' : '',\n                },\n            });\n            const im = BB.el({\n                className: 'dark-invert',\n                css: {\n                    backgroundImage: 'url(\\'' + p.image + '\\')',\n                    backgroundRepeat: 'no-repeat',\n                    backgroundPosition: 'center',\n                    backgroundSize: p.contain ? 'contain' : '',\n                    //filter: 'grayscale(1)',\n                    height: '100%',\n                    transform: p.doMirror ? 'scale(-1, 1)' : '',\n                    pointerEvents: 'none',\n                    opacity: p.doLighten ? '0.75' : '1',\n                },\n            });\n            el.append(im);\n            const pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\n                target: el,\n                onEnterLeave: (isOver) => {\n                    el.classList.toggle('toolspace-row-button-hover', isOver);\n                },\n            });\n            const setIsSmall = (b: boolean) => {\n                el.style.padding = p.contain ? (b ? smallMargin : '10px 0') : '';\n            };\n            return {\n                el,\n                pointerListener,\n                setIsSmall,\n            };\n        };\n\n\n        const createTriangleButton = (p: {\n            onLeft: () => void;\n            onRight: () => void;\n            leftImage: string;\n            rightImage: string | null;\n        }): TToolRowTriangleButton => { // because IE and Edge don't support clip path\n\n            const result = BB.el({\n                css: {\n                    flexGrow: '1',\n                    position: 'relative',\n                },\n            });\n\n            const svg = BB.createSvg({\n                elementType: 'svg',\n                width: '67px', // can't think of a way doing with percentage\n                height: '54px',\n                viewBox: '0 0 100 100',\n                preserveAspectRatio: 'none',\n            });\n            BB.css(svg, {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n            });\n\n            const blurRadius = 10;\n            const blurOffsetX = 2;\n            const blurOffsetY = 2;\n\n            const defs = BB.createSvg( { // inset shadow via svg\n                elementType: 'defs',\n                childrenArr: [\n                    {\n                        elementType: 'filter',\n                        id: 'innershadow',\n                        x0: '-50%',\n                        y0: '-50%',\n                        width: '200%',\n                        height: '200%',\n                        childrenArr: [\n                            {\n                                elementType: 'feGaussianBlur',\n                                in: 'SourceAlpha',\n                                stdDeviation: '' + blurRadius,\n                                result: 'blur',\n                            }, {\n                                elementType: 'feOffset',\n                                dx: '' + blurOffsetX,\n                                dy: '' + blurOffsetY,\n                            }, {\n                                elementType: 'feComposite',\n                                in2: 'SourceAlpha',\n                                operator: 'arithmetic',\n                                k2: '-1',\n                                k3: '1',\n                                result: 'shadowDiff',\n                            },\n\n                            {\n                                elementType: 'feFlood',\n                                'flood-color': '#000',\n                                'flood-opacity': '0.2',\n                            }, {\n                                elementType: 'feComposite',\n                                in2: 'shadowDiff',\n                                operator: 'in',\n                            }, {\n                                elementType: 'feComposite',\n                                in2: 'SourceGraphic',\n                                operator: 'over',\n                                result: 'firstfilter',\n                            },\n\n                            {\n                                elementType: 'feGaussianBlur',\n                                in: 'firstfilter',\n                                stdDeviation: '' + blurRadius,\n                                result: 'blur2',\n                            }, {\n                                elementType: 'feOffset',\n                                dx: '' + blurOffsetX,\n                                dy: '' + blurOffsetY,\n                            }, {\n                                elementType: 'feComposite',\n                                in2: 'firstfilter',\n                                operator: 'arithmetic',\n                                k2: '-1',\n                                k3: '1',\n                                result: 'shadowDiff',\n                            },\n\n                            {\n                                elementType: 'feFlood',\n                                'flood-color': '#000',\n                                'flood-opacity': '0.2',\n                            }, {\n                                elementType: 'feComposite',\n                                in2: 'shadowDiff',\n                                operator: 'in',\n                            }, {\n                                elementType: 'feComposite',\n                                in2: 'firstfilter',\n                                operator: 'over',\n                            },\n                        ],\n                    },\n                ],\n            });\n\n\n            const svgTriangleLeft = BB.createSvg({\n                elementType: 'path',\n                'vector-effect': 'non-scaling-stroke',\n                d: 'M0,0 L 100,0 0,100 z',\n                fill: 'rgba(0,0,0,0)',\n                class: 'toolspace-svg-triangle-button',\n            });\n            svgTriangleLeft.onclick = () => {\n                p.onLeft();\n                svgTriangleLeft.classList.remove('toolspace-svg-triangle-button-hover');\n            };\n\n            const svgTriangleRight = BB.createSvg({\n                elementType: 'path',\n                'vector-effect': 'non-scaling-stroke',\n                d: 'M100,100 L 100,0 0,100 z',\n                fill: 'rgba(0,0,0,0)',\n                class: 'toolspace-svg-triangle-button',\n            });\n            svgTriangleRight.onclick = () => {\n                p.onRight();\n                svgTriangleRight.classList.remove('toolspace-svg-triangle-button-hover');\n            };\n\n            // because :hover causes problems w touch\n            const leftPointerListener = new BB.PointerListener({\n                target: svgTriangleLeft,\n                onEnterLeave: (isOver) => {\n                    svgTriangleLeft.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\n                },\n            });\n            const rightPointerListener = new BB.PointerListener({\n                target: svgTriangleRight,\n                onEnterLeave: (isOver) => {\n                    svgTriangleRight.classList.toggle('toolspace-svg-triangle-button-hover', isOver);\n                },\n            });\n\n\n            svg.append(defs, svgTriangleLeft, svgTriangleRight);\n            result.append(svg);\n\n\n            const leftIm = BB.el({\n                parent: result,\n                className: 'dark-invert',\n                css: {\n                    backgroundImage: 'url(\\'' + p.leftImage + '\\')',\n                    backgroundRepeat: 'no-repeat',\n                    backgroundSize: 'contain',\n                    width: '20px',\n                    height: '20px',\n                    position: 'absolute',\n                    left: '10px',\n                    top: '8px',\n                    //transform: p.doMirror ? 'scale(-1, 1)' : '',\n                    pointerEvents: 'none',\n                },\n            });\n            result.append(leftIm);\n\n\n            const rightIm = BB.el({\n                parent: result,\n                className: 'dark-invert',\n                css: {\n                    backgroundImage: 'url(\\'' + (p.rightImage ? p.rightImage : p.leftImage) + '\\')',\n                    backgroundRepeat: 'no-repeat',\n                    backgroundSize: 'contain',\n                    width: '20px',\n                    height: '20px',\n                    position: 'absolute',\n                    right: '10px',\n                    bottom: '8px',\n                    transform: p.rightImage ? '' : 'scale(-1, 1)',\n                    pointerEvents: 'none',\n                },\n            });\n\n\n\n\n\n            const setIsEnabledLeft = (b: boolean) => {\n                svgTriangleLeft.classList.toggle('toolspace-row-button-disabled', !b);\n                leftIm.classList.toggle('toolspace-row-button-disabled', !b);\n            };\n\n            const setIsEnabledRight = (b: boolean) => {\n                svgTriangleRight.classList.toggle('toolspace-row-button-disabled', !b);\n                rightIm.classList.toggle('toolspace-row-button-disabled', !b);\n            };\n\n            return {\n                el: result,\n                setIsEnabledLeft,\n                setIsEnabledRight,\n                leftPointerListener,\n                rightPointerListener,\n            };\n        };\n\n        this.toolDropdown = new ToolDropdown({\n            onChange: (activeStr) => {\n                this.setActive(activeStr, true);\n            },\n        });\n        this.rootEl.append(this.toolDropdown.getElement());\n\n        this.handButton = createButton({\n            onClick: () => {\n                this.setActive('hand', true);\n            },\n            image: toolHandImg,\n            contain: true,\n            doLighten: true,\n        });\n        this.handButton.el.classList.add('kl-tool-row-border-right');\n        this.handButton.el.title = LANG('tool-hand');\n        this.rootEl.append(this.handButton.el);\n\n        this.zoomInNOutButton = createTriangleButton({\n            onLeft: p.onZoomIn,\n            onRight: p.onZoomOut,\n            leftImage: toolZoomInImg,\n            rightImage: toolZoomOutImg,\n        });\n        this.zoomInNOutButton.el.title = LANG('tool-zoom');\n        this.rootEl.append(this.zoomInNOutButton.el);\n\n        this.zoomInButton = createButton({\n            onClick: p.onZoomIn,\n            image: toolZoomInImg,\n            contain: true,\n        });\n        this.zoomInButton.el.title = LANG('zoom-in');\n        this.rootEl.append(this.zoomInButton.el);\n\n        this.zoomOutButton = createButton({\n            onClick: p.onZoomOut,\n            image: toolZoomOutImg,\n            contain: true,\n        });\n        this.zoomOutButton.el.title = LANG('zoom-out');\n        this.rootEl.append(this.zoomOutButton.el);\n\n        this.undoNRedoButton = createTriangleButton({\n            onLeft: p.onUndo,\n            onRight: p.onRedo,\n            leftImage: toolUndoImg,\n            rightImage: null,\n        });\n        this.undoNRedoButton.el.title = LANG('undo') + '/' + LANG('redo');\n        this.undoNRedoButton.setIsEnabledLeft(false);\n        this.undoNRedoButton.setIsEnabledRight(false);\n        this.rootEl.append(this.undoNRedoButton.el);\n\n        this.undoButton = createButton({\n            onClick: p.onUndo,\n            image: toolUndoImg,\n            contain: true,\n        });\n        this.undoButton.el.title = LANG('undo');\n        this.undoButton.el.classList.add('toolspace-row-button-disabled');\n        this.rootEl.append(this.undoButton.el);\n\n        this.redoButton = createButton({\n            onClick: p.onRedo,\n            image: toolUndoImg,\n            contain: true,\n            doMirror: true,\n        });\n        this.redoButton.el.title = LANG('redo');\n        this.redoButton.el.classList.add('toolspace-row-button-disabled');\n        this.rootEl.append(this.redoButton.el);\n\n        this.zoomInButton.el.style.display = 'none';\n        this.zoomOutButton.el.style.display = 'none';\n        this.undoButton.el.style.display = 'none';\n        this.redoButton.el.style.display = 'none';\n    }\n\n    // ---- interface ----\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsSmall (b: boolean): void {\n        BB.css(this.rootEl, {\n            height: b ? '36px' : '54px',\n        });\n\n        this.toolDropdown.setIsSmall(b);\n        this.handButton.setIsSmall(b);\n        this.zoomInButton.setIsSmall(b);\n        this.zoomOutButton.setIsSmall(b);\n        this.undoButton.setIsSmall(b);\n        this.redoButton.setIsSmall(b);\n\n        if (b) {\n            this.zoomInNOutButton.el.style.display = 'none';\n            this.undoNRedoButton.el.style.display = 'none';\n            this.zoomInButton.el.style.display = 'block';\n            this.zoomOutButton.el.style.display = 'block';\n            this.undoButton.el.style.display = 'block';\n            this.redoButton.el.style.display = 'block';\n        } else {\n            this.zoomInNOutButton.el.style.display = 'block';\n            this.undoNRedoButton.el.style.display = 'block';\n            this.zoomInButton.el.style.display = 'none';\n            this.zoomOutButton.el.style.display = 'none';\n            this.undoButton.el.style.display = 'none';\n            this.redoButton.el.style.display = 'none';\n        }\n\n    }\n\n    setEnableZoomIn (b: boolean): void {\n        this.zoomInButton.el.classList.toggle('toolspace-row-button-disabled', !b);\n        this.zoomInNOutButton.setIsEnabledLeft(b);\n    }\n\n    setEnableZoomOut (b: boolean): void {\n        this.zoomOutButton.el.classList.toggle('toolspace-row-button-disabled', !b);\n        this.zoomInNOutButton.setIsEnabledRight(b);\n    }\n\n    setEnableUndo (b: boolean): void {\n        this.undoButton.el.classList.toggle('toolspace-row-button-disabled', !b);\n        this.undoNRedoButton.setIsEnabledLeft(b);\n    }\n\n    setEnableRedo (b: boolean): void {\n        this.redoButton.el.classList.toggle('toolspace-row-button-disabled', !b);\n        this.undoNRedoButton.setIsEnabledRight(b);\n    }\n\n    setActive (activeStr: TToolType, doEmit?: boolean): void {\n        if (this.currentActiveStr === activeStr) {\n            return;\n        }\n\n        this.currentActiveStr = activeStr;\n\n        this.toolDropdown.setActive(this.currentActiveStr);\n        this.handButton.el.classList.toggle('toolspace-row-button-activated', this.currentActiveStr === 'hand');\n\n        if (doEmit) {\n            this.onActivate(this.currentActiveStr);\n        }\n    }\n\n    getActive (): TToolType {\n        return this.currentActiveStr;\n    }\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"tool-undo.540bf765.svg\";","import {BB} from '../../../bb/bb';\nimport {Select} from './select';\nimport {LANG} from '../../../language/language';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\n\n/**\n * Ui to select stabilizer level. 4 options. returned as 0-3\n */\nexport class ToolspaceStabilizerRow {\n\n    private readonly rootEl: HTMLElement;\n    private readonly pointerListener: PointerListener;\n\n    // ---- public ----\n    constructor (\n        p: {\n            smoothing: number; // initial level [0,3]\n            onSelect: (level: number) => void; // [0-3], when level changes\n        }\n    ) {\n        this.rootEl = BB.el({\n            tagName: 'label',\n            className: 'kl-stabilizer',\n            content: LANG('stabilizer') + '&nbsp;',\n            title: LANG('stabilizer-title'),\n        });\n\n        const strengthSelect = new Select({\n            optionArr: [\n                ['0', '0'],\n                ['1', '1'],\n                ['2', '2'],\n                ['3', '3'],\n                ['4', '4'],\n                ['5', '5'],\n            ],\n            initValue: '' + p.smoothing,\n            onChange: function (val) {\n                p.onSelect(parseInt(val));\n            },\n        });\n        this.rootEl.append(strengthSelect.getElement());\n\n        this.pointerListener = new BB.PointerListener({\n            target: this.rootEl,\n            onWheel: function (e) {\n                strengthSelect.setDeltaValue(e.deltaY);\n            },\n        });\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n}\n\n","import {BB} from '../../../bb/bb';\nimport invertedBorderImg from '/src/app/img/ui/inverted-border.svg';\nimport {IKeyStringOptional} from '../../../bb/bb-types';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\n\n\n// type all functions\n\n\ntype TTabInit = {\n    id: string; // e.g. 'draw',\n    label?: string;\n    image?: string; // background image\n    title?: string;\n    isVisible?: boolean; // default is true\n    onOpen: () => void;\n    onClose: () => void;\n    css?: IKeyStringOptional;\n};\n\ntype TTab = {\n    id: string;\n    isVisible: boolean;\n    onOpen: () => void;\n    onClose: () => void;\n    update: (activeTab: TTab) => void;\n    el: HTMLElement;\n    pointerListener: PointerListener;\n};\n\n\n/**\n * row of tabs. uses css class .tabrow__tab\n */\nexport class TabRow {\n\n    private readonly rootEl: HTMLElement;\n    private readonly tabArr: TTab[];\n    private activeTab: TTab;\n    private readonly roundRight: HTMLElement;\n    private readonly roundLeft: HTMLElement;\n    \n    \n    // update\n    update (): void {\n        for (let i = 0; i < this.tabArr.length; i++) {\n            this.tabArr[i].update(this.activeTab);\n        }\n    }\n    \n    // ---- public ----\n    constructor (\n        p: {\n            initialId: string; // e.g. 'draw'\n            useAccent?: boolean;\n            tabArr: TTabInit[];\n            height?: number;\n        }\n    ) {\n        const height = p.height ?? 35;\n        this.rootEl = BB.el({\n            className: 'tabrow',\n            css: {\n                height: (height + 1) + 'px',\n            },\n        });\n\n        this.tabArr = []; //creates its own internal arr\n\n        const roundSize = 10;\n        this.roundRight = BB.el({\n            css: {\n                width: roundSize + 'px',\n                height: roundSize + 'px',\n                backgroundImage: `url('${invertedBorderImg}')`,\n                backgroundSize: 'cover',\n                position: 'absolute',\n                right: -roundSize + 'px',\n                bottom: '0',\n                pointerEvents: 'none',\n            },\n        });\n        this.roundLeft = BB.el({\n            css: {\n                width: roundSize + 'px',\n                height: roundSize + 'px',\n                backgroundImage: `url('${invertedBorderImg}')`,\n                backgroundSize: 'cover',\n                position: 'absolute',\n                left: -roundSize + 'px',\n                bottom: '0',\n                transform: 'scale(-1,1)',\n                pointerEvents: 'none',\n            },\n        });\n\n        const createTab = (pTabObj: TTabInit, initialId: string, useAccent: boolean): TTab => {\n            const isVisible = ('isVisible' in pTabObj && pTabObj.isVisible !== undefined) ? pTabObj.isVisible : true;\n            const result: TTab = {\n                id: pTabObj.id,\n                isVisible: isVisible,\n                onOpen: pTabObj.onOpen,\n                onClose: pTabObj.onClose,\n                update: (openedTabObj: TTab) => {\n                    result.el.className = openedTabObj === result ? (useAccent ? 'tabrow__tab tabrow__tab--opened-accented' : 'tabrow__tab tabrow__tab--opened') : 'tabrow__tab';\n                    result.el.style.display = result.isVisible ? 'block' : 'none';\n                },\n                el: BB.el({\n                    parent: this.rootEl,\n                    content: 'label' in pTabObj ? pTabObj.label : '',\n                    title: 'title' in pTabObj ? pTabObj.title : undefined,\n                    className: initialId === pTabObj.id ? (useAccent ? 'tabrow__tab tabrow__tab--opened-accented' : 'tabrow__tab tabrow__tab--opened') : 'tabrow__tab',\n                    css: {\n                        lineHeight: height + 'px',\n                        display: isVisible ? 'block' : 'none',\n                        zIndex: '0',\n                    },\n                    onClick: () => {\n                        if (this.activeTab === result) {\n                            return;\n                        }\n                        this.open(result.id);\n                    },\n                }),\n                pointerListener: {} as PointerListener,\n            };\n            if ('image' in pTabObj) {\n\n                BB.el({\n                    tagName: 'span',\n                    parent: result.el,\n                    className: 'dark-invert',\n                    css: {\n                        backgroundImage: `url(\"${pTabObj.image}\")`,\n                        backgroundSize: 'contain',\n                        backgroundPosition: 'center',\n                        backgroundRepeat: 'no-repeat',\n                        display: 'flex',\n                        height: (height - 7) + 'px',\n                        justifyContent: 'center',\n                        margin: '4px auto',\n                    },\n                });\n            }\n            if ('css' in pTabObj && pTabObj.css !== undefined) {\n                BB.css(result.el, pTabObj.css);\n            }\n\n            result.pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\n                target: result.el,\n                onEnterLeave: (isOver) => {\n                    result.el.classList.toggle('tabrow__tab-hover', isOver);\n                },\n            });\n\n            if (initialId === result.id) {\n                result.onOpen();\n                result.el.append(this.roundRight, this.roundLeft);\n            } else {\n                result.onClose();\n            }\n\n            return result;\n        };\n\n        let initTabObj = null;\n        for (let i = 0; i < p.tabArr.length; i++) {\n            const tab = createTab(p.tabArr[i], p.initialId, p.useAccent || false);\n            if (tab.id === p.initialId) {\n                initTabObj = tab;\n            }\n            this.tabArr.push(tab);\n        }\n        if (!initTabObj) {\n            throw 'invalid initialId';\n        }\n        this.activeTab = initTabObj;\n    }\n\n    // ---- interface ----\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    open (tabId: string): void {\n        for (let i = 0; i < this.tabArr.length; i++) {\n            if (this.tabArr[i].id === tabId) {\n                if (this.activeTab === this.tabArr[i]) { // already open\n                    return;\n                }\n                this.activeTab.onClose();\n                this.activeTab = this.tabArr[i];\n                this.activeTab.onOpen();\n                this.activeTab.el.append(this.roundRight, this.roundLeft);\n                this.update();\n                return;\n            }\n        }\n        throw 'TabRow.open - invalid tabId';\n    }\n\n    getOpenedTabId (): string {\n        return '' + this.activeTab.id;\n    }\n\n    setIsVisible (tabId: string, isVisible: boolean): void {\n        for (let i = 0; i < this.tabArr.length; i++) {\n            if (this.tabArr[i].id === tabId) {\n                this.tabArr[i].isVisible = isVisible;\n                this.update();\n                return;\n            }\n        }\n        throw 'TabRow.setIsVisible - invalid tabId';\n    }\n\n    destroy (): void {\n        this.tabArr.forEach(item => {\n            BB.destroyEl(item.el);\n            item.pointerListener.destroy();\n        });\n    }\n}\n\n\n","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"inverted-border.3353c7f3.svg\";","import {BB} from '../../../bb/bb';\nimport angleImg from '/src/app/img/ui/angle.svg';\nimport rotateImg from '/src/app/img/ui/edit-rotate.svg';\nimport {LANG} from '../../../language/language';\n\n/**\n * Ui, when hand tool tab is open.\n */\nexport class HandUi {\n\n    private readonly rootEl: HTMLElement;\n    private readonly onAngleChange: (angleDeg: number, isRelative?: boolean) => void;\n    private isVisible: boolean = true;\n    private scale: number;\n    private angleDeg: number;\n    private readonly scaleEl: HTMLElement;\n    private readonly angleEl: HTMLElement;\n    private readonly angleIm: HTMLImageElement;\n\n\n    private updateUi (): void {\n        this.scaleEl.innerHTML = Math.round(this.scale * 100) + '%';\n        this.angleEl.innerHTML =  Math.round(this.angleDeg) + '';\n\n        this.angleIm.style.transform = 'rotate(' + this.angleDeg + 'deg)';\n        if (this.angleDeg % 90 === 0) {\n            this.angleIm.style.boxShadow = 'inset 0 0 0 1px rgba(255,255,255, 1), 0 0 0 1px rgba(0, 0, 0, 0.3)';\n        } else {\n            this.angleIm.style.boxShadow = '';\n        }\n    }\n\n\n    // ---- public ----\n\n    constructor (\n        p: {\n            scale: number; // initial value\n            angleDeg: number; // initial value\n            onReset: () => void;\n            onFit: () => void;\n            onAngleChange: (angleDeg: number, isRelative?: boolean) => void;\n        }\n    ) {\n        this.rootEl = BB.el({\n            css: {\n                margin: '10px',\n            },\n        });\n        this.scale = p.scale;\n        this.angleDeg = p.angleDeg;\n        this.onAngleChange = p.onAngleChange;\n\n        const row1 = BB.el({\n            css: {\n                marginBottom: '10px',\n                display: 'flex',\n            },\n        });\n        const row2 = BB.el({\n            css: {\n                display: 'flex',\n                marginBottom: '10px',\n            },\n        });\n        const row3 = BB.el({\n            css: {\n                display: 'flex',\n            },\n        });\n        this.rootEl.append(row1, row2, row3);\n\n\n        this.scaleEl = BB.el({\n            css: {\n                width: '55px',\n                userSelect: 'none',\n            },\n        });\n        row1.append(this.scaleEl);\n\n        this.angleIm = new Image();\n        this.angleIm.src = angleImg;\n        BB.css(this.angleIm, {\n            verticalAlign: 'bottom',\n            width: '20px',\n            height: '20px',\n            marginRight: '5px',\n            borderRadius: '10px',\n            background: 'rgba(0,0,0,0.2)',\n            userSelect: 'none',\n        });\n        row1.append(this.angleIm);\n\n        this.angleEl = BB.el({\n            parent: row1,\n            css: {\n                userSelect: 'none',\n            },\n        });\n\n        this.updateUi();\n\n\n        const resetButton = BB.el({\n            tagName: 'button',\n            content: LANG('hand-reset'),\n            onClick: p.onReset,\n        });\n        BB.makeUnfocusable(resetButton);\n\n        const fitButton = BB.el({\n            tagName: 'button',\n            content: LANG('hand-fit'),\n            css: {\n                marginLeft: '10px',\n            },\n            onClick: p.onFit,\n        });\n        BB.makeUnfocusable(fitButton);\n        row2.append(resetButton, fitButton);\n\n        const leftRotateButton = BB.el({\n            tagName: 'button',\n            content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\" style=\"transform: scale(-1, 1)\"/>',\n            onClick: function () {\n                p.onAngleChange(-15, true);\n            },\n        });\n        BB.makeUnfocusable(leftRotateButton);\n\n        const resetAngleButton = BB.el({\n            tagName: 'button',\n            content: '0',\n            css: {\n                marginLeft: '10px',\n            },\n            onClick: function () {\n                p.onAngleChange(0);\n            },\n        });\n        BB.makeUnfocusable(resetAngleButton);\n\n        const rightRotateButton = BB.el({\n            tagName: 'button',\n            content: '<img height=\"20\" src=\"' + rotateImg + '\" alt=\"Rotate\"/>',\n            css: {\n                marginLeft: '10px',\n            },\n            onClick: function () {\n                p.onAngleChange(15, true);\n            },\n        });\n        BB.makeUnfocusable(rightRotateButton);\n        row3.append(leftRotateButton, resetAngleButton, rightRotateButton);\n\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsVisible (pIsVisible: boolean): void {\n        this.isVisible = !!pIsVisible;\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\n        if (this.isVisible) {\n            this.updateUi();\n        }\n    }\n\n    update (pScale: number, pAngleDeg: number): void {\n        this.scale = pScale;\n        this.angleDeg = pAngleDeg;\n        if (this.isVisible) {\n            this.updateUi();\n        }\n    }\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"edit-rotate.fd0e572a.svg\";","import {BB} from '../../../bb/bb';\nimport {KlSlider} from '../components/kl-slider';\nimport {Select} from '../components/select';\nimport {Checkbox} from '../components/checkbox';\nimport {LANG} from '../../../language/language';\nimport {TFillSampling} from '../../kl-types';\nimport {KlColorSlider} from '../components/kl-color-slider';\n\n/**\n * Paint Bucket tab contents (color slider, opacity slider, etc)\n */\nexport class FillUi {\n\n    private readonly rootEl: HTMLElement;\n    private isVisible: boolean;\n    private readonly colorDiv: HTMLElement;\n    private readonly colorSlider: KlColorSlider;\n    private readonly toleranceSlider: KlSlider;\n    private readonly opacitySlider: KlSlider;\n    private readonly modeSelect: Select<string>;\n    private readonly growSelect: Select<string>;\n    private isContiguous: boolean;\n    private readonly eraserToggle: Checkbox;\n\n\n    // ---- public ----\n\n    constructor (\n        p: {\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\n        }\n    ) {\n        this.rootEl = BB.el({\n            css: {\n                margin: '10px',\n            },\n        });\n        this.isVisible = true;\n\n        this.colorDiv = BB.el({\n            parent: this.rootEl,\n            css: {\n                marginBottom: '10px',\n            },\n        });\n\n        this.colorSlider = p.colorSlider;\n\n        this.opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: 250,\n            height: 30,\n            min: 1 / 100,\n            max: 1,\n            value: 1,\n            toValue: (displayValue) => displayValue / 100,\n            toDisplayValue: (value) => value * 100,\n        });\n        this.rootEl.append(this.opacitySlider.getElement());\n\n        this.toleranceSlider = new KlSlider({\n            label: LANG('bucket-tolerance'),\n            width: 250,\n            height: 30,\n            min: 0,\n            max: 255,\n            value: 20 * (255 / 100),\n            toValue: (displayValue) => displayValue * (255 / 100),\n            toDisplayValue: (value) => value / (255 / 100),\n        });\n        BB.css(this.toleranceSlider.getElement(), {\n            marginTop: '10px',\n        });\n        this.rootEl.append(this.toleranceSlider.getElement());\n\n        const selectRow = BB.el({\n            parent: this.rootEl,\n            css: {\n                display: 'flex',\n                marginTop: '10px',\n            },\n        });\n\n        const modeWrapper = BB.el({\n            content: LANG('bucket-sample') + '&nbsp;',\n            title: LANG('bucket-sample-title'),\n            css: {\n                fontSize: '15px',\n            },\n        });\n        this.modeSelect = new Select({\n            optionArr: [\n                ['all', LANG('bucket-sample-all')],\n                ['current', LANG('bucket-sample-active')],\n                ['above', LANG('bucket-sample-above')],\n            ],\n            initValue: 'all',\n        });\n        const modePointerListener = new BB.PointerListener({\n            target: this.modeSelect.getElement(),\n            onWheel: (e) => {\n                this.modeSelect.setDeltaValue(e.deltaY);\n            },\n        });\n        modeWrapper.append(this.modeSelect.getElement());\n        selectRow.append(modeWrapper);\n\n        const growWrapper = BB.el({\n            content: LANG('bucket-grow') + '&nbsp;',\n            title: LANG('bucket-grow-title'),\n            css: {\n                fontSize: '15px',\n                marginLeft: '10px',\n            },\n        });\n        this.growSelect = new Select({\n            optionArr: [\n                ['0', '0'],\n                ['1', '1'],\n                ['2', '2'],\n                ['3', '3'],\n                ['4', '4'],\n                ['5', '5'],\n                ['6', '6'],\n                ['7', '7'],\n            ],\n            initValue: '0',\n        });\n        const growPointerListener = new BB.PointerListener({\n            target: this.growSelect.getElement(),\n            onWheel: (e) => {\n                this.growSelect.setDeltaValue(e.deltaY);\n            },\n        });\n        growWrapper.append(this.growSelect.getElement());\n        selectRow.append(growWrapper);\n\n\n        this.isContiguous = true;\n        const contiguousToggle = new Checkbox({\n            init: true,\n            label: LANG('bucket-contiguous'),\n            title: LANG('bucket-contiguous-title'),\n            callback: (b) => {\n                this.isContiguous = b;\n            },\n            css: {\n                paddingRight: '5px',\n                display: 'inline-block',\n                width: '50%',\n            },\n        });\n\n        this.eraserToggle = new Checkbox({\n            init: false,\n            label: LANG('eraser'),\n            css: {\n\n                paddingRight: '5px',\n                display: 'inline-block',\n                width: '50%',\n            },\n        });\n\n        this.rootEl.append(BB.el({\n            content: [\n                contiguousToggle.getElement(),\n                this.eraserToggle.getElement(),\n            ],\n            css: {\n                display: 'flex',\n                marginTop: '10px',\n            },\n        }));\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsVisible (pIsVisible: boolean): void {\n        this.isVisible = !!pIsVisible;\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\n        if (this.isVisible) {\n            this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\n        }\n    }\n\n    /**\n     * [0, 1]\n     */\n    getTolerance (): number {\n        return this.toleranceSlider.getValue();\n    }\n\n    getOpacity (): number {\n        return this.opacitySlider.getValue();\n    }\n\n    getSample (): TFillSampling {\n        return this.modeSelect.getValue() as TFillSampling;\n    }\n\n    getGrow (): number {\n        return parseInt(this.growSelect.getValue(), 10);\n    }\n\n    getContiguous (): boolean {\n        return this.isContiguous;\n    }\n\n    getIsEraser (): boolean {\n        return this.eraserToggle.getValue();\n    }\n\n}\n","import {BB} from '../../../bb/bb';\nimport {LANG} from '../../../language/language';\nimport {KlColorSlider} from '../components/kl-color-slider';\n\n/**\n * Text Tool tab contents (color slider)\n */\nexport class TextUi {\n\n    private readonly rootEl: HTMLElement;\n    private readonly colorDiv: HTMLElement;\n    private isVisible: boolean = true;\n    private readonly colorSlider: KlColorSlider;\n\n    // ---- public ----\n\n    constructor (\n        p: {\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\n        }\n    ) {\n        this.rootEl = BB.el({\n            css: {\n                margin: '10px',\n            },\n        });\n        this.colorSlider = p.colorSlider;\n\n        this.colorDiv = BB.el({\n            parent: this.rootEl,\n            css: {\n                marginBottom: '10px',\n            },\n        });\n\n        const hint = BB.el({\n            parent: this.rootEl,\n            content: LANG('text-instruction'),\n        });\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsVisible (pIsVisible: boolean): void {\n        this.isVisible = !!pIsVisible;\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\n        if (this.isVisible) {\n            this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\n        }\n    }\n}\n","import {BB} from '../../../bb/bb';\nimport {Options} from '../components/options';\nimport {Checkbox} from '../components/checkbox';\nimport {KlSlider} from '../components/kl-slider';\nimport {LANG} from '../../../language/language';\nimport {TShapeToolMode, TShapeToolType} from '../../kl-types';\nimport {KlColorSlider} from '../components/kl-color-slider';\n\n/**\n * Shape Tool tab contents\n */\nexport class ShapeUi {\n\n    private readonly rootEl: HTMLElement;\n    private isVisible: boolean;\n    private readonly colorDiv: HTMLElement;\n    private readonly colorSlider: KlColorSlider;\n    private shape: TShapeToolType = 'rect';\n    private mode: TShapeToolMode = 'stroke';\n    private readonly eraserToggle: Checkbox;\n    private readonly opacitySlider: KlSlider;\n    private readonly lineWidthSlider: KlSlider;\n    private readonly outwardsToggle: Checkbox;\n    private readonly fixedToggle: Checkbox;\n    private readonly snapToggle:Checkbox;\n    private readonly lockAlphaToggle: Checkbox;\n\n\n    // ---- public ----\n\n    constructor (\n        p: {\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\n        }\n    ) {\n        this.rootEl = BB.el({\n            css: {\n                margin: '10px',\n            },\n        });\n        this.isVisible = true;\n\n        this.colorDiv = BB.el({\n            parent: this.rootEl,\n            css: {\n                marginBottom: '10px',\n            },\n        });\n\n        this.colorSlider = p.colorSlider;\n\n        const previewSize = 35;\n        const previewPadding = 8;\n\n\n        const rectStrokeSvgRect = BB.createSvg({\n            elementType: 'rect',\n            x: '' + previewPadding,\n            width: '' + (previewSize - previewPadding * 2),\n        });\n        const rectStrokeSvg = BB.createSvg({\n            elementType: 'svg',\n            width: '' + previewSize,\n            height: '' + previewSize,\n        });\n        rectStrokeSvg.classList.add('dark-invert');\n        rectStrokeSvg.append(rectStrokeSvgRect);\n        BB.css(rectStrokeSvg, {\n            display: 'block',\n        });\n\n        const rectFilledSvgRect = BB.createSvg({\n            elementType: 'rect',\n            x: '' + previewPadding,\n            width: '' + (previewSize - previewPadding * 2),\n        });\n        const rectFilledSvg = BB.createSvg({\n            elementType: 'svg',\n            width: '' + previewSize,\n            height: '' + previewSize,\n        });\n        rectFilledSvg.classList.add('dark-invert');\n        rectFilledSvg.append(rectFilledSvgRect);\n        BB.css(rectFilledSvg, {\n            display: 'block',\n        });\n\n\n        const ellipseStrokeSvgEllipse = BB.createSvg({\n            elementType: 'ellipse',\n            cx: '' + (previewSize / 2),\n            cy: '' + (previewSize / 2),\n            rx: '' + (previewSize / 2 - previewPadding),\n        });\n        const ellipseStrokeSvg = BB.createSvg({\n            elementType: 'svg',\n            width: '' + previewSize,\n            height: '' + previewSize,\n        });\n        ellipseStrokeSvg.classList.add('dark-invert');\n        ellipseStrokeSvg.append(ellipseStrokeSvgEllipse);\n        BB.css(ellipseStrokeSvg, {\n            display: 'block',\n        });\n\n        const ellipseFilledSvgEllipse = BB.createSvg({\n            elementType: 'ellipse',\n            cx: '' + (previewSize / 2),\n            cy: '' + (previewSize / 2),\n            rx: '' + (previewSize / 2 - previewPadding),\n        });\n        const ellipseFilledSvg = BB.createSvg({\n            elementType: 'svg',\n            width: '' + previewSize,\n            height: '' + previewSize,\n        });\n        ellipseFilledSvg.classList.add('dark-invert');\n        ellipseFilledSvg.append(ellipseFilledSvgEllipse);\n        BB.css(ellipseFilledSvg, {\n            display: 'block',\n        });\n\n\n        const lineSvgLine = BB.createSvg({\n            elementType: 'line',\n            x1: '' + previewPadding,\n            x2: '' + (previewSize - previewPadding),\n        });\n        const lineSvg = BB.createSvg({\n            elementType: 'svg',\n            width: '' + previewSize,\n            height: '' + previewSize,\n        });\n        lineSvg.classList.add('dark-invert');\n        lineSvg.append(lineSvgLine);\n        BB.css(lineSvg, {\n            display: 'block',\n        });\n\n        const updatePreviews = () => {\n            const strokeWidth = BB.clamp(Math.round(this.lineWidthSlider.getValue() / 10), 1, 10) + 'px';\n\n            const squish = 1.35;\n\n            BB.css(rectStrokeSvgRect, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\n            BB.css(rectFilledSvgRect, { fill: 'black', stroke: 'none' });\n\n            BB.css(ellipseStrokeSvgEllipse, { fill: 'none', stroke: 'black', strokeWidth: strokeWidth });\n            BB.css(ellipseFilledSvgEllipse, { fill: 'black', stroke: 'none' });\n\n            BB.css(\n                lineSvgLine,\n                { fill: 'none', stroke: 'black', strokeWidth: strokeWidth }\n            );\n\n            if (this.fixedToggle.getValue()) {\n                rectStrokeSvgRect.setAttribute('y', '' + previewPadding);\n                rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\n                rectFilledSvgRect.setAttribute('y', '' + previewPadding);\n                rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * 2));\n\n                ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\n                ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding));\n            } else {\n                rectStrokeSvgRect.setAttribute('y', '' + (previewPadding * squish));\n                rectStrokeSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\n                rectFilledSvgRect.setAttribute('y', '' + (previewPadding * squish));\n                rectFilledSvgRect.setAttribute('height', '' + (previewSize - previewPadding * squish * 2));\n\n                ellipseStrokeSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\n                ellipseFilledSvgEllipse.setAttribute('ry', '' + (previewSize / 2 - previewPadding * squish));\n            }\n\n            if (this.snapToggle.getValue()) {\n                lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding));\n                lineSvgLine.setAttribute('y2', '' + previewPadding);\n            } else {\n                lineSvgLine.setAttribute('y1', '' + (previewSize - previewPadding * squish));\n                lineSvgLine.setAttribute('y2', '' + (previewPadding * squish));\n            }\n        };\n\n        const row1 = BB.el({\n            parent: this.rootEl,\n            css: {\n                display: 'flex',\n                justifyContent: 'space-between',\n                alignItems: 'start',\n            },\n        });\n\n        const shapeOptions = new Options({\n            optionArr: [\n                {\n                    id: 'rect-stroke',\n                    label: rectStrokeSvg,\n                    title: LANG('shape-rect') + ' ' + LANG('shape-stroke'),\n                },\n                {\n                    id: 'ellipse-stroke',\n                    label: ellipseStrokeSvg,\n                    title: LANG('shape-ellipse') + ' ' + LANG('shape-stroke'),\n                },\n                {\n                    id: 'line',\n                    label: lineSvg,\n                    title: LANG('shape-line'),\n                },\n                {\n                    id: 'rect-fill',\n                    label: rectFilledSvg,\n                    title: LANG('shape-rect') + ' ' + LANG('shape-fill'),\n                },\n                {\n                    id: 'ellipse-fill',\n                    label: ellipseFilledSvg,\n                    title: LANG('shape-ellipse') + ' ' + LANG('shape-fill'),\n                },\n            ],\n            initId: this.shape + ' ' + this.mode,\n            onChange: (id) => {\n                const split = id.split('-');\n                this.shape = split[0] as TShapeToolType;\n                this.mode = split[1] as TShapeToolMode;\n\n                BB.css(this.fixedToggle.getElement(), {\n                    display: this.shape === 'line' ? 'none' : '',\n                });\n                BB.css(this.snapToggle.getElement(), {\n                    display: this.shape === 'line' ? '' : 'none',\n                });\n                BB.css(this.lineWidthSlider.getElement(), {\n                    display: (this.shape !== 'line' && this.mode === 'fill') ? 'none' : '',\n                });\n            },\n            changeOnInit: true,\n        });\n        shapeOptions.getElement().style.width = '120px';\n        row1.append(shapeOptions.getElement());\n\n        this.eraserToggle = new Checkbox({\n            init: false,\n            label: LANG('eraser'),\n            callback: () => {\n                updatePreviews();\n            },\n        });\n\n        this.lockAlphaToggle = new Checkbox({\n            init: false,\n            label: LANG('lock-alpha'),\n            title: LANG('lock-alpha-title'),\n            doHighlight: true,\n        });\n        this.lockAlphaToggle.getElement().style.marginTop = '10px';\n\n        row1.append(BB.el({\n            content: [\n                this.eraserToggle.getElement(),\n                this.lockAlphaToggle.getElement(),\n            ],\n        }));\n\n        this.lineWidthSlider = new KlSlider({\n            label: LANG('shape-line-width'),\n            width: 250,\n            height: 30,\n            min: 1,\n            max: 200,\n            value: 4,\n            curve: 'quadratic',\n            onChange: () => {\n                updatePreviews();\n            },\n        });\n        BB.css(this.lineWidthSlider.getElement(), {\n            marginTop: '10px',\n        });\n        this.rootEl.append(this.lineWidthSlider.getElement());\n\n        this.opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: 250,\n            height: 30,\n            min: 1 / 100,\n            max: 1,\n            value: 1,\n            toValue: (displayValue) => displayValue / 100,\n            toDisplayValue: (value) => value * 100,\n        });\n        BB.css(this.opacitySlider.getElement(), {\n            marginTop: '10px',\n        });\n        this.rootEl.append(this.opacitySlider.getElement());\n\n        const row2 = BB.el({\n            parent: this.rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginTop: '10px',\n            },\n        });\n\n        this.outwardsToggle = new Checkbox({\n            init: false,\n            label: LANG('shape-outwards'),\n            css: {\n                width: '50%',\n                marginRight: '10px',\n            },\n        });\n        row2.append(this.outwardsToggle.getElement());\n\n        this.fixedToggle = new Checkbox({\n            init: false,\n            label: LANG('shape-fixed'),\n            callback: () => {\n                updatePreviews();\n            },\n            css: {\n                flexGrow: '1',\n            },\n        });\n        row2.append(this.fixedToggle.getElement());\n\n        this.snapToggle = new Checkbox({\n            init: false,\n            label: LANG('angle-snap'),\n            title: LANG('angle-snap-title'),\n            callback: () => {\n                updatePreviews();\n            },\n            css: {\n                flexGrow: '1',\n            },\n        });\n        row2.append(this.snapToggle.getElement());\n\n\n        updatePreviews();\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsVisible (pIsVisible: boolean): void {\n        this.isVisible = !!pIsVisible;\n        this.rootEl.style.display = this.isVisible ? 'block' : 'none';\n        if (this.isVisible) {\n            this.colorDiv.append(this.colorSlider.getElement());\n            this.colorDiv.append(this.colorSlider.getOutputElement());\n            //update();\n        }\n    }\n\n    getShape (): TShapeToolType {\n        return this.shape;\n    }\n\n    getMode (): TShapeToolMode {\n        return this.mode;\n    }\n\n    getIsEraser (): boolean {\n        return this.eraserToggle.getValue();\n    }\n\n    getOpacity (): number {\n        return this.opacitySlider.getValue();\n    }\n\n    getLineWidth (): number {\n        return this.lineWidthSlider.getValue();\n    }\n\n    getIsOutwards (): boolean {\n        return this.outwardsToggle.getValue();\n    }\n\n    getIsFixed (): boolean {\n        return this.fixedToggle.getValue();\n    }\n\n    getIsSnap (): boolean {\n        return this.snapToggle.getValue();\n    }\n\n    getDoLockAlpha (): boolean {\n        return this.lockAlphaToggle.getValue();\n    }\n}\n","import {BB} from '../../../bb/bb';\nimport {Select} from '../components/select';\nimport {ColorOptions} from '../components/color-options';\nimport {showModal} from './base/showModal';\nimport {LANG} from '../../../language/language';\nimport {IRGB, IRGBA} from '../../kl-types';\nimport {ISize2D} from '../../../bb/bb-types';\nimport {table} from '../components/table';\nimport {ERASE_COLOR} from '../../brushes/erase-color';\nimport {theme} from '../../../theme/theme';\n\nexport function newImageDialog (\n    p: {\n        currentColor: IRGB; // current color\n        secondaryColor: IRGB;\n        maxCanvasSize: number;\n        canvasWidth: number; // current canvas size\n        canvasHeight: number; // current canvas size\n        workspaceWidth: number;\n        workspaceHeight: number;\n        onConfirm: (width: number, height: number, color: IRGBA) => void;\n        onCancel: () => void;\n    }\n): void {\n\n    const currentColor = p.currentColor;\n    const secondaryColor = p.secondaryColor;\n    const maxCanvasSize = p.maxCanvasSize;\n    const canvasWidth = p.canvasWidth;\n    const canvasHeight = p.canvasHeight;\n    const workspaceWidth = p.workspaceWidth;\n    const workspaceHeight = p.workspaceHeight;\n    const onConfirm = p.onConfirm;\n    const onCancel = p.onCancel;\n\n    function createRatioSize (ratioX: number, ratioY: number, width: number, height: number, padding: number): ISize2D {\n        return BB.fitInto(\n            ratioX,\n            ratioY,\n            Math.min(maxCanvasSize, width - padding), Math.min(maxCanvasSize, height - padding),\n            1\n        );\n    }\n\n    const newImDiv = BB.el();\n    const widthInput = BB.el({tagName: 'input'});\n    const unitStyle = {\n        color: '#888',\n        fontSize: '12px',\n        marginLeft: '5px',\n    };\n    const widthUnit = BB.el({\n        textContent: LANG('new-px'),\n        css: unitStyle,\n    });\n    const heightInput = BB.el({tagName: 'input'});\n    const heightUnit = BB.el({\n        textContent: LANG('new-px'),\n        css: unitStyle,\n    });\n\n    widthInput.setAttribute('data-ignore-focus', 'true');\n    heightInput.setAttribute('data-ignore-focus', 'true');\n\n    widthInput.type = 'number';\n    widthInput.min = '1';\n    widthInput.max = '' + maxCanvasSize;\n    BB.css(widthInput, {\n        width: '70px',\n    });\n\n    heightInput.type = 'number';\n    heightInput.min = '1';\n    heightInput.max = '' + maxCanvasSize;\n    heightInput.style.width = '70px';\n    widthInput.value = '' + canvasWidth;\n    heightInput.value = '' + canvasHeight;\n    widthInput.onclick = (): void => {\n        widthInput.focus();\n        updateRatio();\n    };\n    heightInput.onclick = (): void => {\n        heightInput.focus();\n        updateRatio();\n    };\n\n\n    const sizeTable = table([\n        [\n            LANG('width') + ':&nbsp;',\n            widthInput,\n            widthUnit,\n        ],\n        [\n            BB.el({css: {height: '5px'}}),\n            '',\n            '',\n        ],\n        [\n            LANG('height') + ':&nbsp;',\n            heightInput,\n            heightUnit,\n        ],\n    ]);\n    BB.css(sizeTable, {\n        marginBottom: '10px',\n    });\n\n\n    const ratioWrapper = BB.el({\n        css: {\n            marginTop: '5px',\n            color: '#888',\n        },\n    });\n\n    const templateWrapper = BB.el();\n    //BB.appendTextDiv(templateWrapper, \"Preset Resolutions: <br />\");\n    const presetFitBtn = BB.el({tagName: 'button'});\n    templateWrapper.style.marginBottom = '10px';\n    const presetCurrentBtn = BB.el({tagName: 'button'});\n    const presetSquareBtn = BB.el({tagName: 'button'});\n    const presetLandscapeBtn = BB.el({tagName: 'button'});\n    const presetPortraitBtn = BB.el({tagName: 'button'});\n    const presetOversizeBtn = BB.el({tagName: 'button'});\n\n    presetCurrentBtn.textContent = LANG('new-current');\n    presetFitBtn.textContent = LANG('new-fit');\n    presetOversizeBtn.textContent = LANG('new-oversize');\n    presetLandscapeBtn.textContent = LANG('new-landscape');\n    presetPortraitBtn.textContent = LANG('new-portrait');\n    presetSquareBtn.textContent = LANG('new-square');\n\n    presetCurrentBtn.style.marginRight = '5px';\n    presetFitBtn.style.marginRight = '5px';\n    presetOversizeBtn.style.marginRight = '5px';\n    presetLandscapeBtn.style.marginTop = '5px';\n    presetLandscapeBtn.style.marginRight = '5px';\n    presetPortraitBtn.style.marginTop = '5px';\n    presetPortraitBtn.style.marginRight = '5px';\n\n    templateWrapper.append(\n        presetCurrentBtn,\n        presetFitBtn,\n        presetOversizeBtn,\n        presetSquareBtn,\n        presetLandscapeBtn,\n        presetPortraitBtn\n    );\n\n    const templatePadding = 0;\n\n    presetCurrentBtn.onclick = function (): void {\n        widthInput.value = '' + canvasWidth;\n        heightInput.value = '' + canvasHeight;\n        updateRatio();\n    };\n    presetFitBtn.onclick = function (): void {\n        widthInput.value = '' + workspaceWidth;\n        heightInput.value = '' + workspaceHeight;\n        updateRatio();\n    };\n    presetOversizeBtn.onclick = function (): void {\n        widthInput.value = '' + (workspaceWidth + 500);\n        heightInput.value = '' + (workspaceHeight + 500);\n        updateRatio();\n    };\n    presetSquareBtn.onclick = function (): void {\n        const sizeObj = createRatioSize(1, 1, workspaceWidth, workspaceHeight, templatePadding);\n        widthInput.value = '' + Math.round(sizeObj.width);\n        heightInput.value = '' + Math.round(sizeObj.height);\n        updateRatio();\n    };\n    presetLandscapeBtn.onclick = function (): void {\n        const sizeObj = createRatioSize(4, 3, workspaceWidth, workspaceHeight, templatePadding);\n        widthInput.value = '' + Math.round(sizeObj.width);\n        heightInput.value = '' + Math.round(sizeObj.height);\n        updateRatio();\n    };\n    presetPortraitBtn.onclick = function (): void {\n        const sizeObj = createRatioSize(3, 4, workspaceWidth, workspaceHeight, templatePadding);\n        widthInput.value = '' + Math.round(sizeObj.width);\n        heightInput.value = '' + Math.round(sizeObj.height);\n        updateRatio();\n    };\n\n    const select = new Select({\n        isFocusable: true,\n        optionArr: [\n            ['screen', LANG('new-screen')],\n            ['16 9', LANG('new-video') + ' 16:9'],\n            ['3 2', '3:2'],\n            ['5 3', '5:3'],\n            ['2 1', '2:1'],\n            ['paper', LANG('new-din-paper') + ' 2:1'],\n            ['9 16', '9:16'],\n            ['2 3', '2:3'],\n            ['3 5', '3:5'],\n            ['1 2', '1:2'],\n            ['1 1.4142135623730951', '1:2'],\n        ],\n        onChange: function (val): void {\n            if (val === 'screen') {\n                widthInput.value = '' + window.screen.width;\n                heightInput.value = '' + window.screen.height;\n            } else if (val === 'paper') {\n                const sizeObj = createRatioSize(Math.sqrt(2), 1, workspaceWidth, workspaceHeight, templatePadding);\n                widthInput.value = '' + Math.round(sizeObj.width);\n                heightInput.value = '' + Math.round(sizeObj.height);\n            } else {\n                const split = val.split(' ');\n                const sizeObj = createRatioSize(parseFloat(split[0]), parseFloat(split[1]), workspaceWidth, workspaceHeight, templatePadding);\n                widthInput.value = '' + Math.round(sizeObj.width);\n                heightInput.value = '' + Math.round(sizeObj.height);\n            }\n            updateRatio();\n            select.setValue(undefined);\n        },\n    });\n    setTimeout(() => {\n        // safari: not empty without also setting it to null via timeout\n        select.setValue(undefined);\n    }, 0);\n    BB.css(select.getElement(), {\n        width: '80px',\n    });\n    templateWrapper.append(select.getElement());\n\n\n\n    let backgroundRGBA = {r: 255, g: 255, b: 255, a: 1};\n\n    const colorOptionsArr = [\n        {r: 255, g: 255, b: 255, a: 1},\n        {r: 0, g: 0, b: 0, a: 1},\n        {r: 0, g: 0, b: 0, a: 0},\n        {\n            r: currentColor.r,\n            g: currentColor.g,\n            b: currentColor.b,\n            a: 1,\n        },\n        {\n            r: secondaryColor.r,\n            g: secondaryColor.g,\n            b: secondaryColor.b,\n            a: 1,\n        },\n    ];\n    let initColorIndex = 0;\n    if (theme.isDark()) {\n        colorOptionsArr.forEach((item, index) => {\n            if (item.r === ERASE_COLOR && item.g === ERASE_COLOR && item.b === ERASE_COLOR) {\n                initColorIndex = index;\n                backgroundRGBA = item;\n            }\n        });\n    }\n\n    const colorOptions = new ColorOptions({\n        colorArr: colorOptionsArr,\n        initialIndex: initColorIndex,\n        onChange: function (rgbaObj): void {\n            backgroundRGBA = rgbaObj!;\n            preview.style.backgroundColor = 'rgba(' + rgbaObj!.r + ',' + rgbaObj!.g + ',' + rgbaObj!.b + ', ' + rgbaObj!.a + ')';\n        },\n    });\n\n    const previewWrapper = BB.el({\n        className: 'kl-transparent-preview',\n        css: {\n            boxSizing: 'border-box',\n            width: '340px',\n            height: '140px',\n            display: 'table',\n            padding: '10px',\n            marginTop: '10px',\n            marginLeft: '-20px',\n        },\n    });\n    const preview = BB.el({\n        className: 'kl-transparent-preview__canvas',\n        css: {\n            width: 200 + 'px',\n            height: 100 + 'px',\n            backgroundColor: 'rgba(' + backgroundRGBA.r + ',' + backgroundRGBA.g + ',' + backgroundRGBA.b + ', ' + backgroundRGBA.a + ')',\n            marginLeft: 'auto',\n            marginRight: 'auto',\n            color: '#aaa',\n            fontSize: '16px',\n            fontWeight: 'bold',\n            textAlign: 'center',\n            verticalAlign: 'center',\n            display: 'table',\n            overflow: 'hidden',\n        },\n    });\n    BB.el({\n        parent: previewWrapper,\n        content: preview,\n        css: {\n            display: 'table-cell',\n            verticalAlign: 'middle',\n        },\n    });\n    BB.el({\n        parent: preview,\n        css: {\n            display: 'table-cell',\n            verticalAlign: 'middle',\n        },\n    });\n\n    function updateRatio (): void {\n        widthInput.value = '' + Math.min(maxCanvasSize, parseInt(widthInput.value));\n        heightInput.value = '' + Math.min(maxCanvasSize, parseInt(heightInput.value));\n\n        function hcf (u: number, v: number): number {\n            let U = u, V = v;\n            // eslint-disable-next-line no-constant-condition\n            while (true) {\n                if (!(U %= V)) {\n                    return V;\n                }\n                if (!(V %= U)) {\n                    return U;\n                }\n            }\n        }\n\n        let w = parseInt(widthInput.value);\n        let h = parseInt(heightInput.value);\n        if (w < 1 || w > maxCanvasSize || h < 1 || h > maxCanvasSize) {\n            if (w > maxCanvasSize) {\n                w = maxCanvasSize;\n            } else if (h > maxCanvasSize) {\n                h = maxCanvasSize;\n            }\n\n            widthInput.value = '' + w;\n            heightInput.value = '' + h;\n        }\n\n        //generated canvas size doesn't always match ratio. so check if a common ratio is very close\n        const commonRatios = [\n            [1, 2], [2, 1],\n            [2, 3], [3, 2],\n            [3, 4], [4, 3],\n            [4, 5], [5, 4],\n            [16, 9], [9, 16],\n            [3, 2], [2, 3],\n            [5, 3], [3, 5],\n            [2, 1], [1, 2],\n            [1.414, 1], [1, 1.414],\n        ];\n        const reducedArr = BB.reduce(w, h);\n        let closestRatio = commonRatios[0];\n        let closestDistance = Math.abs(commonRatios[0][0] / commonRatios[0][1] - reducedArr[0] / reducedArr[1]);\n        for (let i = 0; i < commonRatios.length; i++) {\n            if (Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]) < closestDistance) {\n                closestRatio = commonRatios[i];\n                closestDistance = Math.abs(commonRatios[i][0] / commonRatios[i][1] - reducedArr[0] / reducedArr[1]);\n            }\n        }\n        //display ratio\n        if (closestDistance > 0 && closestDistance < 0.005) {\n            ratioWrapper.innerText = LANG('new-ratio') + ': ~' + closestRatio[0] + ':' + closestRatio[1];\n        } else {\n            ratioWrapper.innerText = LANG('new-ratio') + ': ' + reducedArr[0] + ':' + reducedArr[1];\n        }\n\n        const realw = w;\n        const T = hcf(w, h);\n        w /= T;\n        h /= T;\n        w *= 260;\n        h *= 260;\n        if (w > 260) {\n            h = 260 / w * h;\n            w = 260;\n        }\n        if (h > 100) {\n            w = 100 / h * w;\n            h = 100;\n\n        }\n\n        preview.style.width = w + 'px';\n        preview.style.height = h + 'px';\n        BB.createCheckerDataUrl(parseInt('' + (30 * (w / realw))), function (url) {\n            previewWrapper.style.background = 'url(' + url + ')';\n        }, theme.isDark());\n    }\n    theme.addIsDarkListener(updateRatio);\n\n    widthInput.onchange = (): void => {\n        if (widthInput.value === '' || parseInt(widthInput.value) < 0) {\n            widthInput.value = '1';\n        }\n        updateRatio();\n    };\n    widthInput.onkeyup = (): void => {\n        updateRatio();\n    };\n    heightInput.onchange = (): void => {\n        if (heightInput.value === '' || parseFloat(heightInput.value) < 0) {\n            heightInput.value = '1';\n        }\n        updateRatio();\n    };\n    heightInput.onkeyup = (): void => {\n        updateRatio();\n    };\n    updateRatio();\n\n    newImDiv.append(templateWrapper);\n    const secondRow = BB.el({\n        parent: newImDiv,\n        css: {\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'flex-end',\n        },\n    });\n    const secondRowLeft = BB.el({\n        parent: secondRow,\n    });\n    secondRowLeft.append(sizeTable, ratioWrapper);\n    secondRow.append(colorOptions.getElement());\n\n    newImDiv.append(previewWrapper);\n\n    showModal({\n        target: document.body,\n        message: `<b>${LANG('new-title')}</b>`,\n        div: newImDiv,\n        buttons: ['Ok', 'Cancel'],\n        callback: function (result) {\n            BB.unsetEventHandler(widthInput, 'onclick', 'onchange', 'onkeyup');\n            BB.unsetEventHandler(widthInput, 'onclick', 'onchange', 'onkeyup');\n\n            BB.unsetEventHandler(presetCurrentBtn, 'onclick');\n            BB.unsetEventHandler(presetFitBtn, 'onclick');\n            BB.unsetEventHandler(presetOversizeBtn, 'onclick');\n            BB.unsetEventHandler(presetSquareBtn, 'onclick');\n            BB.unsetEventHandler(presetLandscapeBtn, 'onclick');\n            BB.unsetEventHandler(presetPortraitBtn, 'onclick');\n\n            select.destroy();\n            colorOptions.destroy();\n            theme.removeIsDarkListener(updateRatio);\n\n            if (\n                result === 'Cancel'\n                || parseInt(widthInput.value) <= 0\n                || parseInt(heightInput.value) <= 0\n                || isNaN(parseInt(widthInput.value))\n                || isNaN(parseInt(heightInput.value))\n            ) {\n                onCancel();\n                return;\n            }\n            onConfirm(\n                parseInt(widthInput.value),\n                parseInt(heightInput.value),\n                backgroundRGBA\n            );\n        },\n        clickOnEnter: 'Ok',\n    });\n\n}","import {BB} from '../../../bb/bb';\n\nexport function table (\n    data: (HTMLElement | string)[][],\n    cellProps?: Record<string, {rowspan: number}>, // {'0.2': {...}} -> row 1, col 3\n): HTMLElement {\n    const result = BB.el({\n        tagName: 'table',\n        className: 'kl-table',\n    });\n    data.forEach((row, rowIndex) => {\n        const rowEl = BB.el({\n            tagName: 'tr',\n        });\n        rowEl.append(...row.map((el, colIndex) => {\n            const cellEl = BB.el({\n                tagName: 'td',\n                content: el,\n            });\n\n            const key = rowIndex + '.' + colIndex;\n            if (cellProps !== undefined && key in cellProps) {\n                cellEl.rowSpan = cellProps[key].rowspan;\n            }\n\n            return cellEl;\n        }));\n        result.append(rowEl);\n    });\n    return result;\n}","import {BB} from '../../../bb/bb';\nimport collapseImg from '/src/app/img/ui/ui-collapse.svg';\nimport {LANG} from '../../../language/language';\nimport {TUiLayout} from '../../kl-types';\n\n/**\n * button that allows to collapse toolspace (for mobile)\n */\nexport class ToolspaceCollapser {\n\n    private readonly rootEl: HTMLElement;\n    private directionStr: TUiLayout;\n    private readonly icon: HTMLElement;\n    private stateIsOpen: boolean;\n\n\n    private update (): void {\n        if (this.directionStr === 'left') {\n            this.icon.style.transform = this.stateIsOpen ? 'rotate(180deg)' : '';\n        } else {\n            this.icon.style.transform = this.stateIsOpen ? '' : 'rotate(180deg)';\n        }\n    }\n\n    // ---- public ----\n    constructor (\n        p: {\n            onChange: () => void;\n        }\n    ) {\n        this.stateIsOpen = true;\n        this.directionStr = 'right';\n\n        this.rootEl = BB.el({\n            className: 'kl-toolspace-toggle',\n            css: {\n                width: '36px',\n                height: '36px',\n                background: 'rgba(100, 100, 100, 0.9)',\n                color: '#fff',\n                position: 'absolute',\n                top: '0',\n                textAlign: 'center',\n                lineHeight: '36px',\n                cursor: 'pointer',\n                userSelect: 'none',\n                padding: '6px',\n                boxSizing: 'border-box',\n            },\n            title: LANG('toggle-show-tools'),\n            onClick: (e) => {\n                e.preventDefault();\n                this.stateIsOpen = !this.stateIsOpen;\n                this.update();\n                p.onChange();\n            },\n        });\n\n        this.icon = BB.el({\n            parent: this.rootEl,\n            css: {\n                backgroundImage: `url(${collapseImg})`,\n                width: '100%',\n                height: '100%',\n                backgroundSize: 'contain',\n                backgroundRepeat: 'no-repeat',\n                backgroundPosition: 'center',\n                userSelect: 'none',\n            },\n        });\n        this.rootEl.oncontextmenu = () => {\n            return false;\n        };\n    }\n\n    // ---- interface ----\n\n    isOpen (): boolean {\n        return this.stateIsOpen;\n    }\n\n    setDirection (dirStr: TUiLayout): void {\n        this.directionStr = dirStr;\n        this.update();\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"ui-collapse.2b5dfc6a.svg\";","import {BB} from '../../../../bb/bb';\nimport { TRenderTextParam} from '../../../image-operations/render-text';\nimport {showModal} from '../base/showModal';\nimport {IRGB} from '../../../kl-types';\nimport {KlCanvas} from '../../../canvas/kl-canvas';\nimport {LANG} from '../../../../language/language';\nimport {TextToolFillUI} from './text-tool-fill-ui';\nimport {TextToolFontUI} from './text-tool-font-ui';\nimport {TextToolStrokeUI} from './text-tool-stroke-ui';\nimport {TextToolTextUI} from './text-tool-text-ui';\nimport {TextToolViewportUI} from './text-tool-viewport-ui';\nimport * as classes from './text-tool-dialog.module.scss';\nimport {c} from '../../../../bb/base/c';\nimport {css} from '@emotion/css';\nimport {TabRow} from '../../components/tab-row';\n\nexport function textToolDialog (\n    p: {\n        klCanvas: KlCanvas;\n        layerIndex: number;\n        primaryColor: IRGB;\n        secondaryColor: IRGB;\n\n        text: TRenderTextParam;\n        onConfirm: (confirmP: TRenderTextParam) => void;\n\n    }\n): void {\n    const rootEl = BB.el({});\n    let text = BB.copyObj(p.text);\n\n    const viewportWrapper = BB.el({\n        className: classes.viewportWrapper,\n    });\n\n    const viewportUI = new TextToolViewportUI({\n        text: text,\n        klCanvas: p.klCanvas,\n        layerIndex: p.layerIndex,\n        onDragEnd: () => tabs.getOpenedTabId() === 'text' ? textUI.focus() : 0,\n    });\n    viewportUI.render();\n\n    function onUpdate (p: Partial<TRenderTextParam>) {\n        text = {\n            ...text,\n            ...p,\n        };\n        viewportUI.setText(text);\n    }\n\n    const fontUI = new TextToolFontUI({\n        ...text,\n        onUpdate: (p) => {\n            onUpdate(p);\n        },\n    });\n\n    const colorWrapper = BB.el({\n        css: {\n            display: 'flex',\n            gap: '10px',\n            flexDirection: 'column',\n        },\n    });\n    const fillUI = new TextToolFillUI({\n        fill: text.fill,\n        primaryColor: p.primaryColor,\n        secondaryColor: p.secondaryColor,\n        onUpdate: (p) => {\n            onUpdate(p);\n        },\n    });\n    const strokeUI = new TextToolStrokeUI({\n        stroke: text.stroke,\n        primaryColor: p.primaryColor,\n        secondaryColor: p.secondaryColor,\n        onUpdate: (p) => {\n            onUpdate(p);\n        },\n    });\n    const textUI = new TextToolTextUI({\n        text: text.text,\n        onUpdate: (p) => {\n            p.text !== undefined && modal.setIgnoreBackground(p.text.length > 0);\n            onUpdate(p);\n        },\n    });\n\n    const tabs = new TabRow({\n        initialId: 'text',\n        height: 40,\n        tabArr: [\n            {\n                id: 'text',\n                label: LANG('text-text'),\n                onOpen: () => {\n                    textUI.getElement().style.display = '';\n                    textUI.focus();\n                },\n                onClose: () => {\n                    textUI.getElement().style.display = 'none';\n                },\n            },\n            {\n                id: 'font',\n                label: LANG('text-font'),\n                onOpen: () => {\n                    fontUI.getElement().style.display = 'flex';\n                },\n                onClose: () => {\n                    fontUI.getElement().style.display = 'none';\n                },\n            },\n            {\n                id: 'color',\n                label: LANG('text-color'),\n                onOpen: () => {\n                    colorWrapper.style.display = 'flex';\n                },\n                onClose: () => {\n                    colorWrapper.style.display = 'none';\n                },\n            },\n        ],\n    });\n    tabs.getElement().classList.add(css({\n        minWidth: '200px',\n        maxWidth: '500px',\n        flexGrow: '1',\n        borderBottom: 'none !important',\n    }));\n\n    const viewportInputsCss = css({\n        position: 'relative',\n        '>*': {\n            position: 'absolute',\n            right: 0,\n            top: 10,\n        },\n    });\n\n    const tabWrapperCss = css({\n        display: 'flex',\n        justifyContent: 'space-between',\n        flexDirection: 'row-reverse',\n        flexWrap: 'wrap',\n        marginTop: '10px',\n        marginLeft: '-20px',\n        marginRight: '-20px',\n        padding: '0 20px',\n        '@media (min-width: 700px) and (min-height: 700px)': {\n            display: 'none !important',\n        },\n    });\n\n\n\n    const inputsCss = css({\n        minHeight: 72,\n        marginTop: '10px',\n        '@media (min-width: 700px) and (min-height: 700px)': {\n            display: 'flex',\n            flexDirection: 'column',\n            gap: '10px',\n            '>*': {\n                display: 'flex !important',\n            },\n        },\n    });\n\n    rootEl.append(c('', [\n        c(viewportWrapper, [viewportUI.getElement()]),\n        c('.' + viewportInputsCss, [viewportUI.getInputsElement()]),\n        c('.tabrow.' + tabWrapperCss, [\n            c(',w-240,h-40'),\n            tabs.getElement(),\n        ]),\n\n        c('.' + inputsCss, [\n            c(colorWrapper, [\n                fillUI.getElement(),\n                strokeUI.getElement(),\n            ]),\n            fontUI.getElement(),\n            textUI.getElement(),\n        ]),\n    ]));\n\n\n\n    const onResize = () => {\n        const b = viewportWrapper.getBoundingClientRect();\n        const w = Math.ceil(b.width);\n        const h = Math.ceil(b.height);\n        viewportUI.setSize(w, h);\n    };\n    window.addEventListener('resize', onResize);\n    setTimeout(() => {\n        onResize();\n    });\n    setTimeout(() => {\n        textUI.focus();\n    }, 100);\n\n\n    // prevent mobile keyboards scrolling page\n    function onScroll (): void {\n        window.scrollTo(0, 0);\n    }\n    window.addEventListener('scroll', onScroll);\n\n    const onModalExit = (val: string) => {\n        window.removeEventListener('resize', onResize);\n        window.removeEventListener('scroll', onScroll);\n        viewportUI.destroy();\n        fontUI.destroy();\n        fillUI.destroy();\n        strokeUI.destroy();\n        textUI.destroy();\n        tabs.destroy();\n\n        if (val === 'Ok') {\n            p.onConfirm({\n                ...viewportUI.getValues(),\n                ...fontUI.getValues(),\n                ...fillUI.getValues(),\n                ...strokeUI.getValues(),\n                ...textUI.getValues(),\n            });\n        }\n    };\n\n\n    const modal = showModal({\n        target: document.body,\n        message: `<b>${LANG('text-title')}</b>`,\n        div: rootEl,\n        buttons: ['Ok', 'Cancel'],\n        ignoreBackground: p.text.text.length > 0,\n        callback: onModalExit,\n        style: {\n            width: 'calc(100% - 50px)',\n            maxWidth: '1000px',\n            minWidth: '300px',\n            boxSizing: 'border-box',\n        },\n        clickOnEnter: 'Ok',\n    });\n}\n","import {TRenderTextParam} from '../../../image-operations/render-text';\nimport {IRGB, IRGBA} from '../../../kl-types';\nimport {ColorOptions} from '../../components/color-options';\nimport {KlSlider} from '../../components/kl-slider';\nimport {LANG} from '../../../../language/language';\nimport {c} from '../../../../bb/base/c';\nimport {createSvg} from '../../../../bb/base/base';\n\ntype TFillParams = Pick<\n    TRenderTextParam,\n    'fill'\n>;\n\nexport type TFillUIParams = TFillParams & {\n    primaryColor: IRGB;\n    secondaryColor: IRGB;\n    onUpdate: (v: Partial<TFillParams>) => void;\n};\n\nexport class TextToolFillUI {\n    private readonly rootEl: HTMLElement;\n\n    private readonly colorOptions: ColorOptions;\n    private readonly opacitySlider: KlSlider;\n\n\n    // ---- public ----\n    constructor (p: TFillUIParams) {\n\n        const emit = (): void => {\n            p.onUpdate(this.getValues());\n        };\n\n        const colorOptionsArr: (IRGBA | null)[] = [\n            null,\n            p.fill ? {\n                ...p.fill.color,\n                a: 1,\n            } : null,\n            {\n                ...p.primaryColor,\n                a: 1,\n            },\n            {\n                ...p.secondaryColor,\n                a: 1,\n            },\n            {r: 0, g: 0, b: 0, a: 1},\n            {r: 255, g: 255, b: 255, a: 1},\n        ];\n\n        this.colorOptions = new ColorOptions({\n            colorArr: colorOptionsArr,\n            initialIndex: p.fill ? 1 : 0,\n            title: LANG('shape-fill'),\n            onChange: (c) => {\n                this.opacitySlider.getElement().style.display = c !== null ? '' : 'none';\n                emit();\n            },\n        });\n\n        this.opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: 150,\n            height: 30,\n            min: 1 / 100,\n            max: 1,\n            value: p.fill ? p.fill.color.a : 1,\n            resolution: 225,\n            eventResMs: 1000 / 30,\n            toValue: (displayValue) => displayValue / 100,\n            toDisplayValue: (value) => value * 100,\n            onChange: () => emit(),\n        });\n        this.opacitySlider.getElement().style.display = p.fill ? '' : 'none';\n\n        const svg = createSvg({\n            elementType: 'svg',\n            class: 'dark-invert',\n            width: '25px',\n            height: '25px',\n            viewBox: '0 0 30 30',\n\n            childrenArr: [\n                {\n                    elementType: 'polyline',\n                    points: '0,0 30,0 30,8 19,8 19,30 11,30 11,8 0,8 0,0 1,0',\n                    'transform-origin': '15px 15px',\n                    transform: 'scale(0.8)',\n                    fill: '#000c',\n                },\n            ],\n        });\n\n        this.rootEl = c(',flex,gap-10,items-center,flexWrap,minh-30', [\n            svg,\n            this.colorOptions.getElement(),\n            this.opacitySlider.getElement(),\n        ]);\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValues (): TFillParams {\n        const c = this.colorOptions.getValue();\n        if (c === null || c?.a === 0) {\n            return {\n                fill: undefined,\n            };\n        }\n        const color = {\n            ...c,\n            a: this.opacitySlider.getValue(),\n        };\n        return {\n            fill: {\n                color,\n            },\n        };\n    }\n\n    destroy (): void {\n        this.colorOptions.destroy();\n        this.opacitySlider.destroy();\n    }\n}","import {BB} from '../../../../bb/bb';\nimport {TRenderTextParam, TTextFormat} from '../../../image-operations/render-text';\nimport {Input} from '../../components/input';\nimport {LANG} from '../../../../language/language';\nimport {ImageRadioList} from '../../components/image-radio-list';\nimport alignLeftImg from '/src/app/img/ui/align-left.svg';\nimport alignCenterImg from '/src/app/img/ui/align-center.svg';\nimport alignRightImg from '/src/app/img/ui/align-right.svg';\nimport typoItalicImg from '/src/app/img/ui/typo-italic.svg';\nimport typoBoldImg from '/src/app/img/ui/typo-bold.svg';\nimport {ImageToggle} from '../../components/image-toggle';\nimport {Select} from '../../components/select';\nimport {c} from '../../../../bb/base/c';\nimport {PointerListener} from '../../../../bb/input/pointer-listener';\nimport {fonts} from '../../../../../fonts/fonts';\n\ntype TFontParams = Pick<\n    TRenderTextParam,\n    'font' | 'size' | 'letterSpacing' | 'lineHeight' | 'align' | 'isItalic' | 'isBold'\n>;\n\nexport type TFontUIParams = TFontParams & {\n    onUpdate: (v: Partial<TFontParams>) => void;\n};\n\n\nconst importedFonts: {\n    fontFamily: string;\n    fontName: string; // visible to user\n}[] = [\n    {fontFamily: 'sans-serif', fontName: 'Sans-serif'},\n    {fontFamily: 'serif', fontName: 'Serif'},\n    {fontFamily: 'monospace', fontName: 'Monospace'},\n    {fontFamily: 'cursive', fontName: 'Cursive'},\n    {fontFamily: 'fantasy', fontName: 'Fantasy'},\n    ...fonts.map(item => {\n        return {\n            fontFamily: item.name,\n            fontName: item.name,\n        };\n    }),\n];\n\nlet didLoadBundledFonts = false;\nasync function loadBundledFonts (): Promise<void> {\n    if (didLoadBundledFonts) {\n        return;\n    }\n    didLoadBundledFonts = true;\n    const promises: Promise<void>[] = [];\n    for (let i = 0; i < fonts.length; i++) {\n        promises.push((async () => {\n            const item = fonts[i];\n            const response = await fetch(item.url);\n            const buffer = await response.arrayBuffer();\n            const font = new FontFace(item.name, buffer);\n            document.fonts.add(font);\n        })());\n    }\n    await Promise.all(promises);\n}\n\nexport class TextToolFontUI {\n    private readonly rootEl: HTMLElement;\n\n    private readonly fontSelect: Select<string>;\n    private readonly fontPointerListener: PointerListener;\n\n    private readonly importButton: HTMLButtonElement;\n\n    private readonly sizeInput: Input;\n    private readonly lineHeightInput: Input;\n    private readonly letterSpacingInput: Input;\n\n    private readonly alignRadioList: ImageRadioList<TTextFormat>;\n    private readonly italicToggle: ImageToggle;\n    private readonly boldToggle: ImageToggle;\n\n    private readonly onUpdate: (v: Partial<TFontParams>) => void;\n    private readonly onFocus: () => void;\n\n    // only load fonts when interacting with the font input\n    private loadBundledFonts (): void {\n        !didLoadBundledFonts && loadBundledFonts().then(() => {\n            this.onUpdate({\n                font: this.fontSelect.getValue(),\n            });\n        });\n    }\n\n    private importFont (): void {\n        const input = document.createElement('input');\n        input.type = 'file';\n        input.multiple = true;\n        input.accept = '.ttf, .otf, .woff, .woff2, .eot';\n        input.focus();\n        input.click();\n        input.onchange = async () => {\n            if (!input.files || input.files.length === 0) {\n                return;\n            }\n            let toSelect: string | undefined = undefined;\n\n            const fontFamilies = importedFonts.map(i => i.fontFamily);\n            for (let i = 0; i < input.files.length; i++) {\n                const file = input.files[i];\n                const fontName = 'kl-' + importedFonts.length;\n                if (fontFamilies.includes(fontName)) {\n                    continue;\n                }\n                if (!toSelect) {\n                    toSelect = fontName;\n                    this.importButton.disabled = true;\n                    this.importButton.innerText = LANG('loading');\n                }\n\n                const split = file.name.split('.');\n                split.pop();\n\n                importedFonts.push({\n                    fontFamily: fontName,\n                    fontName: split.join('.'),\n                });\n                const font = new FontFace(fontName, await file.arrayBuffer());\n                document.fonts.add(font);\n            }\n\n            // update font selection\n            setTimeout(() => {\n                this.fontSelect.setOptionArr(importedFonts.map(i => {\n                    return [\n                        i.fontFamily,\n                        i.fontName,\n                        {\n                            css: {\n                                fontFamily: i.fontFamily,\n                                fontSize: '1.2em',\n                            },\n                        },\n                    ];\n                }));\n                this.fontSelect.setValue(toSelect);\n                this.onUpdate({\n                    font: toSelect,\n                });\n                this.importButton.disabled = false;\n                this.importButton.innerText = LANG('file-import');\n            });\n        };\n    }\n\n\n    // ---- public ----\n    constructor (p: TFontUIParams) {\n        this.onUpdate = p.onUpdate;\n\n        this.fontSelect = new Select<string>({\n            initValue: p.font,\n            optionArr: importedFonts.map(i => {\n                return [\n                    i.fontFamily,\n                    i.fontName,\n                    {\n                        css: {\n                            fontFamily: i.fontFamily,\n                            fontSize: '1.2em',\n                        },\n                    },\n                ];\n            }),\n            isFocusable: true,\n            css: {\n                width: '180px',\n            },\n            onChange: (v) => {\n                this.loadBundledFonts();\n                p.onUpdate({\n                    font: v,\n                });\n            },\n        });\n        this.onFocus = () => this.loadBundledFonts();\n        this.fontSelect.getElement().addEventListener('focus', this.onFocus);\n        this.fontPointerListener = new BB.PointerListener({\n            target: this.fontSelect.getElement(),\n            onWheel: (e) => this.fontSelect.setDeltaValue(e.deltaY),\n        });\n\n        this.importButton = BB.el({\n            tagName: 'button',\n            content: LANG('file-import'),\n            onClick: () => {\n                this.importFont();\n            },\n        });\n\n        const sizeLabel = BB.el({\n            content: '<div><span style=\"font-size: 0.6em; margin-right: -1px\">A</span>A</div>',\n            css: {\n                width: '25px',\n                height: '25px',\n                display: 'flex',\n                justifyContent: 'center',\n                alignItems: 'center',\n                fontSize: '1.2em',\n                userSelect: 'none',\n            },\n        });\n        this.sizeInput = new Input({\n            title: LANG('text-size'),\n            type: 'number',\n            min: 0,\n            max: 1000,\n            init: p.size,\n            onChange: (v) => {\n                p.onUpdate({\n                    size: parseFloat(v),\n                });\n            },\n            doResetIfInvalid: true,\n            doScrollWithoutFocus: true,\n            css: {\n                width: '70px',\n            },\n        });\n\n        this.lineHeightInput = new Input({\n            label: LANG('text-line-height'),\n            type: 'number',\n            min: 0,\n            max: 10,\n            step: 0.1,\n            init: p.lineHeight ?? 1,\n            onChange: (v) => {\n                p.onUpdate({\n                    lineHeight: parseFloat(v),\n                });\n            },\n            doResetIfInvalid: true,\n            doScrollWithoutFocus: true,\n            css: {\n                width: '60px',\n            },\n        });\n\n        this.letterSpacingInput = new Input({\n            label: LANG('text-letter-spacing'),\n            type: 'number',\n            min: -100,\n            max: 100,\n            init: p.letterSpacing ?? 0,\n            onChange: (v) => {\n                p.onUpdate({\n                    letterSpacing: parseFloat(v),\n                });\n            },\n            doResetIfInvalid: true,\n            doScrollWithoutFocus: true,\n            css: {\n                width: '60px',\n            },\n        });\n\n\n\n        this.alignRadioList = new ImageRadioList<TTextFormat>({\n            optionArr: [\n                {\n                    id: 'left',\n                    title: LANG('text-left'),\n                    image: alignLeftImg,\n                    darkInvert: true,\n                },\n                {\n                    id: 'center',\n                    title: LANG('text-center'),\n                    image: alignCenterImg,\n                    darkInvert: true,\n                },\n                {\n                    id: 'right',\n                    title: LANG('text-right'),\n                    image: alignRightImg,\n                    darkInvert: true,\n                },\n            ],\n            initId: p.align,\n            onChange: (v) => p.onUpdate({\n                align: v,\n            }),\n        });\n\n        this.italicToggle = new ImageToggle({\n            image: typoItalicImg,\n            title: LANG('text-italic'),\n            initValue: p.isItalic,\n            onChange: (v) => p.onUpdate({\n                isItalic: v,\n            }),\n            darkInvert: true,\n        });\n\n        this.boldToggle = new ImageToggle({\n            image: typoBoldImg,\n            title: LANG('text-bold'),\n            initValue: p.isBold,\n            onChange: (v) => p.onUpdate({\n                isBold: v,\n            }),\n            darkInvert: true,\n        });\n\n        this.rootEl = c(',flex,flexWrap,gap-10-15,items-center', [\n            c(',flex,gap-5,items-center', [\n                sizeLabel,\n                this.sizeInput.getElement(),\n            ]),\n            c(',flex,gap-5', [\n                this.fontSelect.getElement(),\n                this.importButton,\n            ]),\n            c(',flex,gap-7', [\n                this.alignRadioList.getElement(),\n                this.italicToggle.getElement(),\n                this.boldToggle.getElement(),\n            ]),\n            this.letterSpacingInput.getElement(),\n            this.lineHeightInput.getElement(),\n        ]);\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValues (): TFontParams {\n        return {\n            font: this.fontSelect.getValue(),\n            size: +this.sizeInput.getValue(),\n            letterSpacing: +this.letterSpacingInput.getValue(),\n            lineHeight: +this.lineHeightInput.getValue(),\n            align: this.alignRadioList.getValue(),\n            isItalic: this.italicToggle.getValue(),\n            isBold: this.boldToggle.getValue(),\n        };\n    }\n\n    destroy (): void {\n        this.fontPointerListener.destroy();\n        this.fontSelect.getElement().removeEventListener('focus', this.onFocus);\n        this.fontSelect.destroy();\n        BB.destroyEl(this.importButton);\n        this.sizeInput.destroy();\n        this.lineHeightInput.destroy();\n        this.letterSpacingInput.destroy();\n        this.alignRadioList.destroy();\n        this.italicToggle.destroy();\n        this.boldToggle.destroy();\n    }\n}","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"align-left.4876a845.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"align-center.6f56d4bd.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"align-right.1521d61c.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"typo-italic.7ab32910.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"typo-bold.5c790c89.svg\";","import fontCaveat from 'url:./Caveat-Regular.woff2';\nimport fontClimateCrisis from 'url:./ClimateCrisis-Regular-VariableFont_YEAR.woff2';\nimport fontCorrectionBrush from 'url:./CorrectionBrush.woff2';\nimport fontDancingScript from 'url:./DancingScript-Regular.woff2';\nimport fontDiabolik from 'url:./Diabolik-Regular-VF.woff2';\nimport fontFreckleFace from 'url:./FreckleFace-Regular.woff2';\nimport fontGloock from 'url:./Gloock-Regular.woff2';\nimport fontPacha from 'url:./Pacha.woff2';\nimport fontGochiHand from 'url:./GochiHand-Regular.woff2';\nimport fontPassionOne from 'url:./PassionOne-Bold.woff2';\nimport fontPixeloidSans from 'url:./PixeloidSans.woff2';\nimport fontPlaypenSans from 'url:./PlaypenSans-Thin.woff2';\nimport fontQuicksandLight from 'url:./Quicksand-Light.woff2';\nimport fontSilkscreen from 'url:./Silkscreen-Regular.woff2';\nimport fontTehroc from 'url:./Tehroc-Regular.woff2';\nimport fontYunga from 'url:./YUNGA-Display.woff2';\n\nexport const fonts: {\n    name: string;\n    url: string;\n}[] = [\n    { name: 'Caveat', url: fontCaveat },\n    { name: 'ClimateCrisis', url: fontClimateCrisis },\n    { name: 'CorrectionBrush', url: fontCorrectionBrush },\n    { name: 'DancingScript', url: fontDancingScript },\n    { name: 'Diabolik', url: fontDiabolik },\n    { name: 'FreckleFace', url: fontFreckleFace },\n    { name: 'Gloock', url: fontGloock },\n    { name: 'GochiHand', url: fontGochiHand },\n    { name: 'Pacha', url: fontPacha },\n    { name: 'PassionOne', url: fontPassionOne },\n    { name: 'PixeloidSans', url: fontPixeloidSans },\n    { name: 'PlaypenSans', url: fontPlaypenSans },\n    { name: 'Quicksand', url: fontQuicksandLight },\n    { name: 'Silkscreen', url: fontSilkscreen },\n    { name: 'Tehroc', url: fontTehroc },\n    { name: 'YUNGA', url: fontYunga },\n];\n\n","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"Caveat-Regular.2fe80bbd.woff2\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"ClimateCrisis-Regular-VariableFont_YEAR.3ad02523.woff2\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"CorrectionBrush.a69973aa.woff2\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"DancingScript-Regular.ef2fe647.woff2\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"Diabolik-Regular-VF.f4eeb79e.woff2\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"FreckleFace-Regular.05946539.woff2\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"Gloock-Regular.60f8f765.woff2\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"Pacha.08c8457a.woff2\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"GochiHand-Regular.c45792b0.woff2\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"PassionOne-Bold.9e08b0dc.woff2\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"PixeloidSans.bc292131.woff2\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"PlaypenSans-Thin.314b29a4.woff2\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"Quicksand-Light.1f0c44a2.woff2\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"Silkscreen-Regular.cef2b4cb.woff2\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"Tehroc-Regular.4540047b.woff2\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"YUNGA-Display.30c04a15.woff2\";","import {BB} from '../../../../bb/bb';\nimport {TRenderTextParam} from '../../../image-operations/render-text';\nimport {IRGB, IRGBA} from '../../../kl-types';\nimport {ColorOptions} from '../../components/color-options';\nimport {KlSlider} from '../../components/kl-slider';\nimport {LANG} from '../../../../language/language';\nimport {c} from '../../../../bb/base/c';\nimport {createSvg} from '../../../../bb/base/base';\n\ntype TStrokeParams = Pick<\n    TRenderTextParam,\n    'stroke'\n>;\n\nexport type TStrokeUIParams = TStrokeParams & {\n    primaryColor: IRGB;\n    secondaryColor: IRGB;\n    onUpdate: (v: Partial<TStrokeParams>) => void;\n};\n\nexport class TextToolStrokeUI {\n    private readonly rootEl: HTMLElement;\n\n    private readonly colorOptions: ColorOptions;\n    private readonly opacitySlider: KlSlider;\n    private readonly lineWidthSlider: KlSlider;\n\n\n\n    // ---- public ----\n    constructor (p: TStrokeUIParams) {\n\n\n\n        this.rootEl = BB.el({\n            css: {\n                boxShadow: '0 0 0 1px #aaa',\n            },\n        });\n\n        const emit = (): void => {\n            p.onUpdate(this.getValues());\n        };\n\n        const colorOptionsArr: (IRGBA | null)[] = [\n            null,\n            p.stroke ? {\n                ...p.stroke.color,\n                a: 1,\n            } : null,\n            {\n                ...p.secondaryColor,\n                a: 1,\n            },\n            {\n                ...p.primaryColor,\n                a: 1,\n            },\n            {r: 255, g: 255, b: 255, a: 1},\n            {r: 0, g: 0, b: 0, a: 1},\n        ];\n\n        this.colorOptions = new ColorOptions({\n            colorArr: colorOptionsArr,\n            initialIndex: p.stroke ? 1 : 0,\n            title: LANG('shape-stroke'),\n            onChange: (c) => {\n                this.opacitySlider.getElement().style.display = c !== null ? '' : 'none';\n                this.lineWidthSlider.getElement().style.display = c !== null ? '' : 'none';\n                emit();\n            },\n        });\n\n        this.opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: 150,\n            height: 30,\n            min: 1 / 100,\n            max: 1,\n            value: p.stroke ? p.stroke.color.a : 1,\n            resolution: 225,\n            eventResMs: 1000 / 30,\n            toValue: (displayValue) => displayValue / 100,\n            toDisplayValue: (value) => value * 100,\n            onChange: () => emit(),\n        });\n\n        this.lineWidthSlider = new KlSlider({\n            label: LANG('shape-line-width'),\n            width: 150,\n            height: 30,\n            min: 0.5,\n            max: 100,\n            value: p.stroke ? p.stroke.lineWidth : 2,\n            eventResMs: 1000 / 30,\n            curve: 'quadratic',\n            onChange: () => emit(),\n        });\n\n        this.opacitySlider.getElement().style.display = p.stroke ? '' : 'none';\n        this.lineWidthSlider.getElement().style.display = p.stroke ? '' : 'none';\n\n        const svg = createSvg({\n            elementType: 'svg',\n            class: 'dark-invert',\n            width: '25px',\n            height: '25px',\n            viewBox: '0 0 30 30',\n\n            childrenArr: [\n                {\n                    elementType: 'polyline',\n                    points: '0,0 30,0 30,8 19,8 19,30 11,30 11,8 0,8 0,0 1,0',\n                    fill: 'none',\n                    stroke: '#000c',\n                    'stroke-width': '3',\n                    'transform-origin': '15px 15px',\n                    transform: 'scale(0.8)',\n                },\n            ],\n        });\n\n        this.rootEl = c(',flex,gap-10,items-center,flexWrap,minh-30', [\n            svg,\n            this.colorOptions.getElement(),\n            this.opacitySlider.getElement(),\n            this.lineWidthSlider.getElement(),\n        ]);\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValues (): TStrokeParams {\n        const c = this.colorOptions.getValue();\n        if (c === null || c?.a === 0) {\n            return {\n                stroke: undefined,\n            };\n        }\n        const color = {\n            ...c,\n            a: this.opacitySlider.getValue(),\n        };\n        return {\n            stroke: {\n                color,\n                lineWidth: this.lineWidthSlider.getValue(),\n            },\n        };\n    }\n\n    destroy (): void {\n        this.colorOptions.destroy();\n        this.opacitySlider.destroy();\n        this.lineWidthSlider.destroy();\n    }\n}","import {TRenderTextParam} from '../../../image-operations/render-text';\nimport {BB} from '../../../../bb/bb';\nimport {LANG} from '../../../../language/language';\nimport {c} from '../../../../bb/base/c';\n\ntype TTextParams = Pick<\n    TRenderTextParam,\n    'text'\n>;\n\nexport type TTextUIParams = TTextParams & {\n    onUpdate: (v: Partial<TTextParams>) => void;\n};\n\nexport class TextToolTextUI {\n    private readonly rootEl: HTMLElement;\n\n    private readonly textInput: HTMLTextAreaElement;\n    private lastEmittedText: string;\n    private readonly onUpdate: (v: Partial<TTextParams>) => void;\n\n    private readonly onInput = (): void => {\n        this.emit();\n    };\n\n    private emit (): void {\n        const text = this.textInput.value;\n        if (text === this.lastEmittedText) {\n            return;\n        }\n        this.lastEmittedText = text;\n        this.onUpdate({\n            text,\n        });\n    }\n\n    // ---- public ----\n    constructor (p: TTextUIParams) {\n        this.lastEmittedText = p.text;\n        this.onUpdate = p.onUpdate;\n\n        this.rootEl = c('');\n\n        this.textInput = BB.el({\n            tagName: 'textarea',\n            parent: this.rootEl,\n            content: p.text,\n            custom: {\n                placeholder: LANG('text-placeholder'),\n            },\n            css: {\n                whiteSpace: 'pre',\n                overflow: 'auto',\n                width: '100%',\n                height: '70px',\n                resize: 'vertical',\n            },\n            onChange: () => {\n                this.emit();\n            },\n        });\n\n        this.textInput.addEventListener('input', this.onInput);\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getValues (): TTextParams {\n        return {\n            text: this.textInput.value,\n        };\n    }\n\n    focus (): void {\n        this.textInput.focus();\n    }\n\n    destroy (): void {\n        BB.destroyEl(this.textInput);\n        this.textInput.removeEventListener('input', this.onInput);\n    }\n}","import {BB} from '../../../../bb/bb';\nimport {throwIfNull} from '../../../../bb/base/base';\nimport {theme} from '../../../../theme/theme';\nimport {renderText, TRenderTextParam} from '../../../image-operations/render-text';\nimport {KlCanvas} from '../../../canvas/kl-canvas';\nimport {KlSlider} from '../../components/kl-slider';\nimport {PointerListener} from '../../../../bb/input/pointer-listener';\nimport {LANG} from '../../../../language/language';\nimport toolZoomInImg from '/src/app/img/ui/tool-zoom-in.svg';\nimport toolZoomOutImg from '/src/app/img/ui/tool-zoom-out.svg';\nimport {c} from '../../../../bb/base/c';\nimport {IVector2D} from '../../../../bb/bb-types';\nimport {KeyListener} from '../../../../bb/input/key-listener';\n\ntype TViewportParams = Pick<\n    TRenderTextParam,\n    'x' | 'y' | 'angleRad'\n>;\n\ntype TViewportUIParams = {\n    text: TRenderTextParam;\n    klCanvas: KlCanvas;\n    layerIndex: number;\n    onDragEnd: () => void;\n};\n\nexport class TextToolViewportUI {\n\n    private readonly rootEl: HTMLElement;\n    private readonly inputsRootEl: HTMLElement;\n    private readonly previewWrapper: HTMLElement;\n    private text: TRenderTextParam;\n    private offset: IVector2D = {x: 0, y: 0};\n    private interval: ReturnType<typeof setInterval> | undefined;\n\n    private width: number;\n    private height: number;\n    private zoomFac: number = 0;\n    private scale: number = 1;\n\n    private readonly layerArr: ReturnType<KlCanvas['getLayersFast']> = [];\n    private readonly layerIndex: number;\n\n    private readonly textCanvas: HTMLCanvasElement;\n    private readonly textCtx: CanvasRenderingContext2D;\n\n    private readonly targetCanvas: HTMLCanvasElement;\n    private readonly targetCtx: CanvasRenderingContext2D;\n\n    private readonly layersCanvas: HTMLCanvasElement;\n    private readonly layersCtx: CanvasRenderingContext2D;\n\n    private readonly previewCanvas: HTMLCanvasElement;\n    private readonly previewCtx: CanvasRenderingContext2D;\n\n    private readonly emptyCanvas: HTMLCanvasElement;\n    private readonly emptyCanvasLight: HTMLCanvasElement;\n\n    private checkerPattern: CanvasPattern;\n\n    private readonly rotationSlider: KlSlider;\n    private readonly zoomInBtn: HTMLButtonElement;\n    private readonly zoomOutBtn: HTMLButtonElement;\n\n    private readonly eventCapture: HTMLElement;\n\n    private readonly previewPointerListener: PointerListener;\n    private readonly keyListener: KeyListener;\n\n    private readonly onDarkChange = () => {\n        this.checkerPattern = throwIfNull(this.previewCtx.createPattern(BB.createCheckerCanvas(8, theme.isDark()), 'repeat'));\n        this.render();\n    };\n\n    private canZoom (d: number): boolean {\n        return this.zoomFac !== Math.min(2, Math.max(-2, this.zoomFac + d));\n    }\n\n    private changeZoomFac (d: number): void {\n        this.zoomFac = Math.min(2, Math.max(-2, this.zoomFac + d));\n        this.render();\n        this.zoomInBtn.disabled = !this.canZoom(1);\n        this.zoomOutBtn.disabled = !this.canZoom(-1);\n    }\n\n    /** Move text by x y **/\n    private move (x: number, y: number): void {\n        const rotated = BB.rotate(x, y, -this.rotationSlider.getValue() / Math.PI * 180);\n        this.text.x += rotated.x / this.scale;\n        this.text.y += rotated.y / this.scale;\n        this.render();\n    }\n\n\n    // ---- public ----\n    constructor (p: TViewportUIParams) {\n        this.rootEl = c();\n        this.text = p.text;\n        this.layerIndex = p.layerIndex;\n\n        const isSmallWidth = window.innerWidth < 550;\n        const isSmallHeight = window.innerHeight < 630;\n\n        // --- preview ---\n        // Text drawn on klCanvas-sized canvas: textCanvas\n        // LayerArr[target].canvas & textCanvas then drawn on targetCanvas\n        //      they are transformed. canvas size of final preview\n        // All layers and targetCanvas drawn on layersCanvas. transformed and size of final preview\n        // Checkerboard, layersCanvas, and outline then drawn on previewCanvas\n\n        this.width = isSmallWidth ? 340 : 540;\n        this.height = isSmallWidth ? (isSmallHeight ? 210 : 260) : (isSmallHeight ? 230 : 350);\n\n        this.layerArr = p.klCanvas.getLayersFast();\n        this.textCanvas = BB.canvas(p.klCanvas.getWidth(), p.klCanvas.getHeight());\n        this.textCtx = BB.ctx(this.textCanvas);\n        this.targetCanvas = BB.canvas(this.width, this.height);\n        this.targetCtx = BB.ctx(this.targetCanvas);\n        this.layersCanvas = BB.canvas(this.width, this.height);\n        this.layersCtx = BB.ctx(this.layersCanvas);\n        this.previewCanvas = BB.canvas(this.width, this.height); // the one that is visible\n        this.previewCtx = BB.ctx(this.previewCanvas);\n        BB.css(this.previewCanvas, {\n            display: 'block',\n        });\n        this.previewWrapper = BB.el({\n            parent: this.rootEl,\n            css: {\n                position: 'relative',\n                width: this.width + 'px',\n                cursor: 'move',\n                touchAction: 'none',\n            },\n        });\n        BB.el({ // inset shadow on preview\n            parent: this.previewWrapper,\n            className: 'kl-text-preview-wrapper',\n        });\n        this.previewWrapper.append(this.previewCanvas);\n        this.checkerPattern = throwIfNull(this.previewCtx.createPattern(BB.createCheckerCanvas(8, theme.isDark()), 'repeat'));\n        this.emptyCanvas = BB.canvas(1, 1);\n        this.emptyCanvasLight = BB.canvas(1, 1);\n        {\n            let ctx = BB.ctx(this.emptyCanvas);\n            ctx.fillRect(0, 0, 1, 1);\n\n            ctx = BB.ctx(this.emptyCanvasLight);\n            ctx.fillStyle = '#fff';\n            ctx.fillRect(0, 0, 1, 1);\n        }\n\n        theme.addIsDarkListener(this.onDarkChange);\n\n        this.previewCanvas.oncontextmenu = (e) => e.preventDefault();\n        let dragged = false;\n        let isDown = false;\n        let offsetDragged = false;\n        this.previewPointerListener = new BB.PointerListener({\n            target: this.previewCanvas,\n            onPointer: (e) => {\n\n                // drag detect\n                if (e.type === 'pointerdown') {\n                    dragged = false;\n                    isDown = true;\n                }\n                if (e.type === 'pointermove' && isDown) {\n                    dragged = true;\n                }\n                if (e.type === 'pointerup') {\n                    if (isDown && dragged && e.pointerType === 'mouse') {\n                        // With touch/pen it would be annoying to focus again,\n                        // because it probably pops out the keyboard.\n                        p.onDragEnd();\n                    }\n                    dragged = false;\n                    isDown = false;\n                }\n\n\n\n                if (e.type === 'pointermove' && e.button === 'left') {\n                    e.eventPreventDefault();\n                    this.offset = {x: 0, y: 0};\n                    this.move(-e.dX, -e.dY);\n                }\n                if (e.type === 'pointerdown' && e.button === 'right') {\n                    document.body.append(this.eventCapture);\n                }\n                if (e.type === 'pointerup') {\n                    setTimeout(() => this.eventCapture.remove(), 20);\n                }\n                if (e.type === 'pointermove' && e.button === 'right') {\n                    offsetDragged = true;\n                    e.eventPreventDefault();\n                    this.offset.x -= e.dX;\n                    this.offset.y -= e.dY;\n                    this.render();\n                }\n                if (e.type === 'pointerup' && offsetDragged) {\n                    let count = 0;\n                    this.interval = setInterval(() => {\n                        if (count > 8) {\n                            clearInterval(this.interval);\n                            this.offset = {x: 0, y: 0};\n                            this.render();\n                        }\n                        this.offset = {x: this.offset.x * 0.6, y: this.offset.y * 0.6};\n                        this.render();\n                        count++;\n                    }, 10);\n\n                    this.offset = {x: this.offset.x * 0.6, y: this.offset.y * 0.6};\n                    this.render();\n                }\n            },\n            onWheel: (e) => {\n                this.changeZoomFac(-e.deltaY);\n            },\n        });\n\n        const wheelPrevent = (event: WheelEvent): void => event.preventDefault();\n        this.previewCanvas.addEventListener('wheel', wheelPrevent);\n\n\n        this.rotationSlider = new KlSlider({\n            label: LANG('filter-transform-rotation'),\n            width: 150,\n            height: 30,\n            min: -Math.PI,\n            max: Math.PI,\n            value: p.text.angleRad,\n            resolution: 225,\n            // eventResMs: 1000 / 30,\n            toValue: (deg) => deg * Math.PI / 180,\n            toDisplayValue: (rad) => rad / Math.PI * 180,\n            onChange: () => {\n                this.offset = {x: 0, y: 0};\n                this.render();\n            },\n            unit: '',\n        });\n\n        this.zoomInBtn = BB.el({\n            tagName: 'button',\n            content: `<img height=\"20\" src=\"${toolZoomInImg}\">`,\n            title: LANG('zoom-in'),\n            onClick: () => this.changeZoomFac(1),\n            css: {\n                fontWeight: 'bold',\n            },\n        });\n        this.zoomOutBtn = BB.el({\n            tagName: 'button',\n            content: `<img height=\"20\" src=\"${toolZoomOutImg}\">`,\n            title: LANG('zoom-out'),\n            onClick: () => this.changeZoomFac(-1),\n            css: {\n                fontWeight: 'bold',\n            },\n        });\n\n        this.eventCapture = BB.el({\n            css: {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                right: '0',\n                bottom: '0',\n                zIndex: '999',\n                cursor: 'move',\n            },\n        });\n        this.eventCapture.oncontextmenu = (e) => e.preventDefault();\n\n        this.keyListener = new BB.KeyListener({\n            onDown: (keyStr) => {\n                if (BB.isInputFocused(true)) {\n                    return;\n                }\n                const factor = this.keyListener.isPressed('shift') ? 4 : 1;\n                if (keyStr === 'left') {\n                    this.move(-factor, 0);\n                }\n                if (keyStr === 'right') {\n                    this.move(factor, 0);\n                }\n                if (keyStr === 'up') {\n                    this.move(0, -factor);\n                }\n                if (keyStr === 'down') {\n                    this.move(0, factor);\n                }\n            },\n        });\n\n        this.inputsRootEl = c(',flex,gap-5', [\n            this.rotationSlider.getElement(),\n            c(),\n            this.zoomInBtn,\n            this.zoomOutBtn,\n        ]);\n    }\n\n    render (): void {\n        // try to draw very much like klCanvasWorkspace\n\n        const angleRad = this.rotationSlider.getValue();\n\n        // --- draw text ---\n        this.textCtx.clearRect(0, 0, this.textCanvas.width, this.textCanvas.height);\n        const bounds = renderText(this.textCanvas, {\n            ...this.text,\n            x: this.text.x,\n            y: this.text.y,\n            angleRad: this.rotationSlider.getValue(),\n        });\n\n        // transform offset\n        const transformedOffset = BB.Vec2.mul(\n            BB.rotate(this.offset.x, this.offset.y, -angleRad / Math.PI * 180),\n            1 / this.scale,\n        );\n\n        // --- determine transformation of viewport ---\n        // text should always be visible\n        bounds.width = Math.max(bounds.width, 1);\n        bounds.height = Math.max(bounds.height, 1);\n        const rotatedXY = BB.rotate(bounds.x, bounds.y, -angleRad / Math.PI * 180);\n        const rotatedWH = BB.rotate(bounds.width, bounds.height, -angleRad / Math.PI * 180);\n        const centerX = this.text.x + rotatedXY.x + rotatedWH.x / 2 + transformedOffset.x;\n        const centerY = this.text.y + rotatedXY.y + rotatedWH.y / 2 + transformedOffset.y;\n\n        const padding = 100;\n        const fitBounds = BB.fitInto(\n            bounds.width, bounds.height,\n            this.width - padding,\n            this.height - padding\n        );\n        this.scale = Math.min(1, fitBounds.width / bounds.width);\n        this.scale = Math.min(4, this.scale * Math.pow(2, this.zoomFac));\n\n\n        // --- compose text and target layer ---\n        this.targetCtx.save();\n\n        if (this.scale >= 4) {\n            this.targetCtx.imageSmoothingEnabled = false;\n        } else {\n            this.targetCtx.imageSmoothingEnabled = true;\n            this.targetCtx.imageSmoothingQuality  = this.scale >= 1 ? 'low' : 'medium';\n        }\n\n        this.targetCtx.clearRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n        this.targetCtx.translate(this.width / 2, this.height / 2);\n        this.targetCtx.scale(this.scale, this.scale);\n        this.targetCtx.rotate(angleRad);\n        this.targetCtx.drawImage(this.layerArr[this.layerIndex].canvas, -centerX, -centerY);\n        this.targetCtx.drawImage(this.textCanvas, -centerX, -centerY);\n        this.targetCtx.restore();\n\n        const isDark = theme.isDark();\n\n        // --- layers ---\n        this.layersCtx.save();\n\n        this.layersCtx.fillStyle = isDark ? 'rgb(33,33,33)' : 'rgb(158,158,158)';\n        this.layersCtx.fillRect(0, 0, this.width, this.height);\n\n        { // bg\n            this.layersCtx.save();\n\n            this.layersCtx.translate(this.width / 2, this.height / 2);\n            this.layersCtx.scale(this.scale, this.scale);\n            this.layersCtx.rotate(angleRad);\n\n            this.layersCtx.imageSmoothingEnabled = false;\n\n            //outline\n            const borderSize = 1 / this.scale;\n            this.layersCtx.globalAlpha = isDark ? 0.25 : 0.2;\n            this.layersCtx.drawImage(\n                isDark ? this.emptyCanvasLight : this.emptyCanvas,\n                -centerX - borderSize,\n                -centerY - borderSize,\n                this.textCanvas.width + borderSize * 2,\n                this.textCanvas.height + borderSize * 2,\n            );\n            this.layersCtx.globalAlpha = 1;\n\n            //erase\n            this.layersCtx.globalCompositeOperation = 'destination-out';\n            this.layersCtx.drawImage(this.emptyCanvas, -centerX, -centerY, this.textCanvas.width, this.textCanvas.height);\n\n            this.layersCtx.restore();\n        }\n\n        { // individual layers\n\n            if (this.scale >= 4) {\n                this.layersCtx.imageSmoothingEnabled = false;\n            } else {\n                this.layersCtx.imageSmoothingEnabled = true;\n                this.layersCtx.imageSmoothingQuality  = this.scale >= 1 ? 'low' : 'medium';\n            }\n\n            // layers below\n            this.layersCtx.save();\n            this.layersCtx.translate(this.width / 2, this.height / 2);\n            this.layersCtx.scale(this.scale, this.scale);\n            this.layersCtx.rotate(angleRad);\n            for (let i = 0; i < this.layerIndex; i++) {\n                if (this.layerArr[i].isVisible && this.layerArr[i].opacity > 0) {\n                    this.layersCtx.globalAlpha = this.layerArr[i].opacity;\n                    this.layersCtx.globalCompositeOperation = this.layerArr[i].mixModeStr;\n                    this.layersCtx.drawImage(this.layerArr[i].canvas, -centerX, -centerY);\n                }\n            }\n            this.layersCtx.restore();\n\n            // target layer\n            this.layersCtx.globalAlpha = (\n                this.layerArr[this.layerIndex].opacity *\n                (this.layerArr[this.layerIndex].isVisible ? 1 : 0)\n            );\n            this.layersCtx.globalCompositeOperation = this.layerArr[this.layerIndex].mixModeStr;\n            this.layersCtx.drawImage(this.targetCanvas, 0, 0);\n\n            // layers above\n            this.layersCtx.save();\n            this.layersCtx.translate(this.width / 2, this.height / 2);\n            this.layersCtx.scale(this.scale, this.scale);\n            this.layersCtx.rotate(angleRad);\n            for (let i = this.layerIndex + 1; i < this.layerArr.length; i++) {\n                if (this.layerArr[i].isVisible && this.layerArr[i].opacity > 0) {\n                    this.layersCtx.globalAlpha = this.layerArr[i].opacity;\n                    this.layersCtx.globalCompositeOperation = this.layerArr[i].mixModeStr;\n                    this.layersCtx.drawImage(this.layerArr[i].canvas, -centerX, -centerY);\n                }\n            }\n            this.layersCtx.restore();\n\n        }\n\n        this.layersCtx.restore();\n\n\n\n        // --- final composite ---\n        this.previewCtx.save();\n        this.previewCtx.fillStyle = this.checkerPattern;\n        this.previewCtx.fillRect(0, 0, this.previewCanvas.width, this.previewCanvas.height);\n        this.previewCtx.drawImage(this.layersCanvas, 0, 0);\n        this.previewCtx.restore();\n\n        // bounds\n        this.previewCtx.save();\n        this.previewCtx.globalCompositeOperation = 'difference';\n        this.previewCtx.strokeStyle = '#fff';\n        this.previewCtx.lineWidth = 0.5;\n        this.previewCtx.translate(-this.offset.x, -this.offset.y);\n        this.previewCtx.strokeRect(\n            Math.round(this.width / 2 - (bounds.width / 2) * this.scale) + 0.5,\n            Math.round(this.height / 2 - (bounds.height / 2) * this.scale) + 0.5,\n            Math.round(bounds.width * this.scale),\n            Math.round(bounds.height * this.scale)\n        );\n        this.previewCtx.restore();\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    getInputsElement (): HTMLElement {\n        return this.inputsRootEl;\n    }\n\n    getValues (): TViewportParams {\n        return {\n            x: this.text.x,\n            y: this.text.y,\n            angleRad: this.rotationSlider.getValue(),\n        };\n    }\n\n    setText (text: Omit<TRenderTextParam, 'x' | 'y' | 'angleRad'>): void {\n        const x = this. text.x;\n        const y = this. text.y;\n        const angleRad = this. text.angleRad;\n        this.text = {\n            ...text,\n            x,\n            y,\n            angleRad,\n        };\n        this.render();\n    }\n\n    setSize (width: number, height: number): void {\n        if (width === this.width && height === this.height) {\n            return;\n        }\n\n        this.width = width;\n        this.height = height;\n\n        this.targetCanvas.width = this.width;\n        this.targetCanvas.height = this.height;\n\n        this.layersCanvas.width = this.width;\n        this.layersCanvas.height = this.height;\n\n        this.previewCanvas.width = this.width;\n        this.previewCanvas.height = this.height;\n\n        this.previewWrapper.style.width = this.width + 'px';\n\n        this.render();\n    }\n\n    destroy (): void {\n        BB.destroyEl(this.rootEl);\n        BB.destroyEl(this.inputsRootEl);\n        BB.destroyEl(this.previewWrapper);\n        clearInterval(this.interval);\n\n        this.rotationSlider.destroy();\n        BB.destroyEl(this.zoomInBtn);\n        BB.destroyEl(this.zoomOutBtn);\n        this.eventCapture.remove();\n        this.previewPointerListener.destroy();\n        this.keyListener.destroy();\n        theme.removeIsDarkListener(this.onDarkChange);\n    }\n}","\n.viewportWrapper {\n  margin-left: -20px;\n  box-shadow: rgba(0, 0, 0, 0.2) 0 1px, rgba(0, 0, 0, 0.2) 0 -1px;\n  width: calc(100% + 40px);\n  height: calc(100vh - 400px);\n  min-height: 200px;\n  max-height: 600px;\n  overflow: hidden;\n}\n\n:global(body.kl-theme-dark) {\n  .viewportWrapper {\n    box-shadow: 0 1px #636363, 0 -1px #636363;\n  }\n}\n","import {BB} from '../../../bb/bb';\nimport {CropCopy} from '../components/crop-copy';\nimport {Checkbox} from '../components/checkbox';\nimport {showModal} from './base/showModal';\nimport {LANG} from '../../../language/language';\nimport {IKeyString, IRect} from '../../../bb/bb-types';\nimport {IKlPsd, TKlPsdError} from '../../kl-types';\n\n/**\n * Shows first dialog when importing an image.\n * Where you can crop, and select import as layer or as image.\n */\nexport function showImportImageDialog (\n    p: {\n        image: IKlPsd | {\n            type: 'image';\n            width: number;\n            height: number;\n            canvas: HTMLImageElement | HTMLCanvasElement;\n        };\n        maxSize: number;\n        target: HTMLElement;\n        callback: (\n            val: {\n                type: 'as-image' | 'as-layer';\n                image: HTMLImageElement | HTMLCanvasElement;\n            } | {\n                type: 'as-image-psd';\n                image: IKlPsd;\n                cropObj: IRect;\n            } | {\n                type: 'cancel';\n            }\n        ) => void;\n    }\n): void {\n    const rootEl = BB.el();\n    const isSmall = window.innerWidth < 550 || window.innerHeight < 550;\n    const style: IKeyString = isSmall ? {} : { width: '540px' };\n\n    const resolutionEl = BB.el({\n        css: {\n            marginTop: '10px',\n            textAlign: 'center',\n            color: '#888',\n            lineHeight: '20px',\n        },\n    });\n\n    const cropCopy = new CropCopy({\n        width: isSmall ? 340 : 540,\n        height: isSmall ? 300 : 400,\n        canvas: p.image.canvas,\n        isNotCopy: true,\n        onChange: (width, height): void => {\n            if (!resolutionEl) {\n                return;\n            }\n            updateResolution(width, height);\n        },\n    });\n    BB.css(cropCopy.getEl(), {\n        marginLeft: '-20px',\n    });\n    cropCopy.getEl().title = LANG('crop-drag-to-crop');\n\n    rootEl.append(cropCopy.getEl(), resolutionEl);\n\n    function updateResolution (w: number, h: number): void {\n        const fit = BB.fitInto(w, h, p.maxSize, p.maxSize);\n\n        if (fit.width < w) {\n            resolutionEl.innerHTML = `<span class=\"kl-text-error\">${w} X ${h}</span>  ${Math.round(fit.width)} X ${Math.round(fit.height)}`;\n            resolutionEl.title = LANG('import-too-large');\n        } else {\n            resolutionEl.innerHTML = `${w} X ${h}`;\n            resolutionEl.title = '';\n        }\n    }\n    updateResolution(p.image.width, p.image.height);\n\n\n    let doFlatten = false;\n    function showWarnings (psdWarningArr: TKlPsdError[]): void {\n        const contentArr = [];\n        const warningMap = {\n            'mask': 'Masks not supported. Mask was applied.',\n            'clipping': 'Clipping not supported. Clipping layers were merged.',\n            'group': 'Groups not supported. Layers were ungrouped.',\n            'adjustment': 'Adjustment layers not supported.',\n            'layer-effect': 'Layer effects not supported.',\n            'smart-object': 'Smart objects not supported.',\n            'blend-mode': 'Unsupported layer blend mode.',\n            'bits-per-channel': 'Unsupported color depth. Only 8bit per channel supported.',\n        };\n        for (let i = 0; i < psdWarningArr.length; i++) {\n            contentArr.push('- ' + warningMap[psdWarningArr[i]]);\n        }\n        alert(contentArr.join('\\n'));\n    }\n\n    let flattenCheckbox: Checkbox;\n    let warningsEl: HTMLElement | undefined;\n    if (p.image.type === 'psd') {\n        if (p.image.layers) {\n            flattenCheckbox = new Checkbox({\n                init: doFlatten,\n                label: LANG('import-flatten'),\n                callback: (b): void => {\n                    doFlatten = b;\n                },\n            });\n            rootEl.append(flattenCheckbox.getElement());\n\n            if (p.image.warningArr) {\n                const noteEl = BB.el({\n                    className: 'kl-import-note',\n                    content: LANG('import-psd-limited-support'),\n                });\n                const warnings = p.image.warningArr;\n                warningsEl = BB.el({\n                    parent: noteEl,\n                    tagName: 'a',\n                    content: 'Details',\n                    css: { marginLeft: '5px'},\n                    onClick: () => showWarnings(warnings),\n                });\n                rootEl.append(noteEl);\n            }\n        } else {\n            const noteEl = BB.el({\n                className: 'kl-import-note',\n                content: LANG('import-psd-unsupported'),\n            });\n            rootEl.append(noteEl);\n        }\n    }\n\n    function callback (result: string): void {\n        const croppedImage = cropCopy.getCroppedCanvas();\n        const cropRect = cropCopy.getRect();\n        const isCropped = p.image.width !== cropRect.width && p.image.height !== cropRect.height;\n        cropCopy.destroy();\n        BB.destroyEl(warningsEl);\n        if (flattenCheckbox) {\n            flattenCheckbox.destroy();\n        }\n\n        if (result === LANG('import-btn-as-layer')) {\n            p.callback({\n                type: 'as-layer',\n                image: isCropped ? croppedImage : p.image.canvas,\n            });\n            if (!isCropped) {\n                BB.freeCanvas(croppedImage);\n            }\n        } else if (result === LANG('import-btn-as-image')) {\n            if (p.image.type === 'psd') {\n                if (doFlatten) {\n                    delete p.image.layers;\n                }\n                p.callback({\n                    type: 'as-image-psd',\n                    image: p.image,\n                    cropObj: cropRect,\n                });\n                BB.freeCanvas(croppedImage);\n            } else if (p.image.type === 'image') {\n                p.callback({\n                    type: 'as-image',\n                    image: croppedImage,\n                });\n            }\n        } else {\n            p.callback({\n                type: 'cancel',\n            });\n            BB.freeCanvas(croppedImage);\n        }\n    }\n    showModal({\n        target: p.target,\n        message: `<b>${LANG('import-title')}</b>`,\n        div: rootEl,\n        style,\n        buttons: [LANG('import-btn-as-layer'), LANG('import-btn-as-image'), 'Cancel'],\n        primaries: [LANG('import-btn-as-layer'), LANG('import-btn-as-image')],\n        callback,\n        autoFocus: 'As Image',\n    });\n}","import {createCanvas} from '../../bb/base/create-canvas';\nimport {BlendMode, Layer, Psd} from 'ag-psd/dist/psd';\nimport {IKlProject, IKlPsd, TKlPsdError, TKlPsdLayer, TMixMode} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {MAX_LAYERS} from '../canvas/kl-canvas';\nimport {BB} from '../../bb/bb';\nimport {throwIfUndefined} from '../../bb/base/base';\n\nlet kl2PsdMap: Record<TMixMode, BlendMode>;\nlet psd2KlMap: Record<BlendMode, TMixMode>;\n\nfunction init (): void {\n    if (kl2PsdMap) {\n        return;\n    }\n    kl2PsdMap = {\n        'source-over': 'normal',\n\n        'darken': 'darken',\n        'multiply': 'multiply',\n        'color-burn': 'color burn',\n\n        'lighten': 'lighten',\n        'screen': 'screen',\n        'color-dodge': 'color dodge',\n\n        'overlay': 'overlay',\n        'soft-light': 'soft light',\n        'hard-light': 'hard light',\n\n        'difference': 'difference',\n        'exclusion': 'exclusion',\n\n        'hue': 'hue',\n        'saturation': 'saturation',\n        'color': 'color',\n        'luminosity': 'luminosity',\n    };\n    psd2KlMap = Object.fromEntries(Object.entries(kl2PsdMap).map(a => a.reverse()));\n}\n\nexport function blendPsdToKl (str: BlendMode): TMixMode {\n    init();\n    return psd2KlMap[str];\n}\n\nexport function blendKlToPsd (str: TMixMode): BlendMode {\n    init();\n    return kl2PsdMap[str];\n}\n\n\n/**\n * Converts ag-psd object into something that KlCanvas can represent\n * @param psdObj\n */\nexport function readPsd (psdObj: Psd): IKlPsd {\n    if (!psdObj.canvas) {\n        throw new Error('psdObj.canvas undefined');\n    }\n    const result: IKlPsd = {\n        type: 'psd',\n        canvas: psdObj.canvas,\n        width: psdObj.width,\n        height: psdObj.height,\n    };\n\n    function addWarning (warningStr: TKlPsdError): void {\n        if (!result.warningArr) {\n            result.warningArr = [];\n        }\n        if (result.warningArr.includes(warningStr)) {\n            return;\n        }\n        result.warningArr.push(warningStr);\n    }\n\n    function getMixModeStr (blendMode: BlendMode): TMixMode {\n        let mixModeStr: TMixMode = blendPsdToKl(blendMode);\n        if (!mixModeStr) {\n            addWarning('blend-mode');\n            mixModeStr = 'source-over';\n        }\n        return mixModeStr;\n    }\n\n    if (psdObj.bitsPerChannel !== 8) {\n        addWarning('bits-per-channel');\n    }\n\n    if (!psdObj.children) {\n        result.error = true;\n        return result;\n    }\n\n    // count resulting layers\n    const maxLayers = MAX_LAYERS;\n    let layerCount = 0;\n    function countWithinGroup (groupObj: Layer): number {\n        let result = 0;\n        if (groupObj.blendMode) {\n            const mixModeStr = blendPsdToKl(groupObj.blendMode);\n            if (mixModeStr && mixModeStr !== 'source-over') {\n                return 1;\n            }\n        }\n        if (groupObj.children) {\n            for (let i = 0; i < groupObj.children.length; i++) {\n                const item = groupObj.children[i];\n                if (item.clipping || item.adjustment) {\n                    continue;\n                }\n\n                if (item.children) {\n                    addWarning('group');\n                    result += countWithinGroup(item);\n                } else {\n                    result++;\n                }\n            }\n        }\n        return result;\n    }\n    layerCount += countWithinGroup(psdObj);\n    if (layerCount > maxLayers) {\n        result.error = true;\n        return result;\n    }\n\n    result.layers = [];\n\n    function prepareMask (maskCanvas: HTMLCanvasElement, defaultColor: number): void {\n        const groupMaskCtx = BB.ctx(maskCanvas);\n        const imData = groupMaskCtx.getImageData(0, 0, maskCanvas.width, maskCanvas.height);\n        if (defaultColor === 0) {\n            for (let i = 0; i < imData.data.length; i += 4) {\n                imData.data[i + 3] = imData.data[i];\n            }\n        } else {\n            for (let i = 0; i < imData.data.length; i += 4) {\n                imData.data[i + 3] = 255 - imData.data[i];\n            }\n        }\n        groupMaskCtx.putImageData(imData, 0, 0);\n    }\n\n    function convertGroup (psdGroupObj: Layer): TKlPsdLayer[] {\n\n        let resultArr: TKlPsdLayer[] = [];\n        const groupIsVisible = !psdGroupObj.hidden;\n        const groupOpacity = throwIfUndefined(psdGroupObj.opacity, 'groupOpacity is undefined');\n        const groupMixModeStr = getMixModeStr(psdGroupObj.blendMode!);\n        let groupCanvas;\n        let groupCtx;\n        if (groupMixModeStr !== 'source-over') {\n            groupCanvas = createCanvas(result.width, result.height);\n            groupCtx = BB.ctx(groupCanvas);\n        }\n\n        // prepare group mask\n        if (psdGroupObj.mask) {\n            addWarning('mask');\n            prepareMask(psdGroupObj.mask.canvas!, psdGroupObj.mask.defaultColor!);\n        }\n\n        if (psdGroupObj.children) {\n            for (let i = 0; i < psdGroupObj.children.length; i++) {\n                const item = psdGroupObj.children[i];\n                if (item.clipping) {\n                    continue;\n                }\n                if (item.adjustment) {\n                    addWarning('adjustment');\n                    continue;\n                }\n\n                const hasClipping = (item.children || item.canvas) && psdGroupObj.children[i + 1] && psdGroupObj.children[i + 1].clipping;\n                if (hasClipping) {\n                    addWarning('clipping');\n                }\n\n                if (item.children) {\n                    const convertedChildGroupItems = convertGroup(item);\n\n                    for (let e = 0; e < convertedChildGroupItems.length; e++) {\n                        const innerItem = convertedChildGroupItems[e];\n                        const innerCtx = BB.ctx(innerItem.image);\n\n                        // clipping\n                        if (hasClipping) {\n                            const clippingCanvas = createCanvas(result.width, result.height);\n                            const clippingCtx = BB.ctx(clippingCanvas);\n                            clippingCtx.drawImage(innerItem.image, 0, 0);\n\n                            for (let f = i + 1; f < psdGroupObj.children.length && psdGroupObj.children[f].clipping; f++) {\n                                const clippingItem = psdGroupObj.children[f];\n                                if (clippingItem.opacity === 0 || clippingItem.hidden) {\n                                    continue;\n                                }\n                                if (clippingItem.blendMode === undefined) {\n                                    throw new Error('clippingItem.blendMode undefined');\n                                }\n                                if (clippingItem.opacity === undefined) {\n                                    throw new Error('clippingItem.opacity undefined');\n                                }\n                                if (clippingItem.canvas === undefined) {\n                                    throw new Error('clippingItem.canvas undefined');\n                                }\n                                if (clippingItem.left === undefined) {\n                                    throw new Error('clippingItem.left undefined');\n                                }\n                                if (clippingItem.top === undefined) {\n                                    throw new Error('clippingItem.top undefined');\n                                }\n                                clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\n                                clippingCtx.globalAlpha = clippingItem.opacity;\n                                clippingCtx.drawImage(clippingItem.canvas, clippingItem.left, clippingItem.top);\n                            }\n\n                            innerCtx.globalCompositeOperation = 'source-atop';\n                            innerCtx.drawImage(clippingCanvas, 0, 0);\n                        }\n\n\n\n                        // group mask\n                        if (psdGroupObj.mask) {\n                            innerCtx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\n                            if (psdGroupObj.mask.canvas === undefined) {\n                                throw new Error('psdGroupObj.mask.canvas undefined');\n                            }\n                            if (psdGroupObj.mask.left === undefined) {\n                                throw new Error('psdGroupObj.mask.left undefined');\n                            }\n                            if (psdGroupObj.mask.top === undefined) {\n                                throw new Error('psdGroupObj.mask.top undefined');\n                            }\n                            innerCtx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\n                        }\n\n                        if (groupCanvas) {\n                            if (groupCtx === undefined) {\n                                throw new Error('groupCtx undefined');\n                            }\n                            groupCtx.globalCompositeOperation = innerItem.mixModeStr;\n                            groupCtx.globalAlpha = innerItem.opacity;\n                            groupCtx.drawImage(innerItem.image, 0, 0);\n\n                        } else {\n                            innerItem.opacity = innerItem.opacity * groupOpacity;\n                            resultArr.push(innerItem);\n                        }\n                    }\n\n                    continue;\n                }\n\n                const canvas = createCanvas(result.width, result.height);\n                const ctx = BB.ctx(canvas);\n                if (item.canvas) { // if a layer is empty it has no canvas\n                    if (item.top === undefined) {\n                        throw new Error('item.top undefined');\n                    }\n                    if (item.left === undefined) {\n                        throw new Error('item.left undefined');\n                    }\n                    ctx.drawImage(item.canvas, item.left, item.top);\n                }\n\n                // effects\n                if (item.effects) {\n                    addWarning('layer-effect');\n                }\n\n                // mask\n                if (item.mask) {\n                    addWarning('mask');\n                    if (item.mask.canvas === undefined) {\n                        throw new Error('item.mask.canvas undefined');\n                    }\n                    if (item.mask.defaultColor === undefined) {\n                        throw new Error('item.mask.defaultColor undefined');\n                    }\n                    if (item.mask.left === undefined) {\n                        throw new Error('item.mask.left undefined');\n                    }\n                    if (item.mask.top === undefined) {\n                        throw new Error('item.mask.top undefined');\n                    }\n                    prepareMask(item.mask.canvas, item.mask.defaultColor);\n\n                    ctx.globalCompositeOperation = item.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\n                    ctx.drawImage(item.mask.canvas, item.mask.left, item.mask.top);\n                }\n\n                // clipping\n                if (hasClipping) {\n                    if (item.right === undefined) {\n                        throw new Error('item.right undefined');\n                    }\n                    if (item.left === undefined) {\n                        throw new Error('item.left undefined');\n                    }\n                    if (item.bottom === undefined) {\n                        throw new Error('item.bottom undefined');\n                    }\n                    if (item.top === undefined) {\n                        throw new Error('item.top undefined');\n                    }\n                    if (item.canvas === undefined) {\n                        throw new Error('item.canvas undefined');\n                    }\n                    const clippingCanvas = createCanvas(item.right - item.left, item.bottom - item.top);\n                    const clippingCtx = BB.ctx(clippingCanvas);\n                    clippingCtx.drawImage(item.canvas, 0, 0);\n\n                    for (let e = i + 1; e < psdGroupObj.children.length && psdGroupObj.children[e].clipping; e++) {\n                        const clippingItem = psdGroupObj.children[e];\n                        if (clippingItem.opacity === 0 || clippingItem.hidden) {\n                            continue;\n                        }\n                        if (clippingItem.blendMode === undefined) {\n                            throw new Error('clippingItem.blendMode undefined');\n                        }\n                        if (clippingItem.opacity === undefined) {\n                            throw new Error('clippingItem.opacity undefined');\n                        }\n                        if (clippingItem.canvas === undefined) {\n                            throw new Error('clippingItem.canvas undefined');\n                        }\n                        if (clippingItem.left === undefined) {\n                            throw new Error('clippingItem.left undefined');\n                        }\n                        if (clippingItem.top === undefined) {\n                            throw new Error('clippingItem.top undefined');\n                        }\n                        clippingCtx.globalCompositeOperation = getMixModeStr(clippingItem.blendMode);\n                        clippingCtx.globalAlpha = clippingItem.opacity;\n                        clippingCtx.drawImage(clippingItem.canvas, clippingItem.left - item.left, clippingItem.top - item.top);\n                    }\n\n                    ctx.globalCompositeOperation = 'source-atop';\n                    ctx.drawImage(clippingCanvas, item.left, item.top);\n                }\n\n                // group mask\n                if (psdGroupObj.mask) {\n                    ctx.globalCompositeOperation = psdGroupObj.mask.defaultColor === 0 ? 'destination-in' : 'destination-out';\n                    if (psdGroupObj.mask.canvas === undefined) {\n                        throw new Error('psdGroupObj.mask.canvas undefined');\n                    }\n                    if (psdGroupObj.mask.left === undefined) {\n                        throw new Error('psdGroupObj.mask.left undefined');\n                    }\n                    if (psdGroupObj.mask.top === undefined) {\n                        throw new Error('psdGroupObj.mask.top undefined');\n                    }\n                    ctx.drawImage(psdGroupObj.mask.canvas, psdGroupObj.mask.left, psdGroupObj.mask.top);\n                }\n\n                if (item.blendMode === undefined) {\n                    throw new Error('item.blendMode undefined');\n                }\n                if (item.hidden  === undefined) {\n                    throw new Error('item.hidden  undefined');\n                }\n                if (item.opacity === undefined) {\n                    throw new Error('item.opacity undefined');\n                }\n\n                if (groupCanvas && groupCtx) {\n                    if (groupOpacity > 0) {\n                        groupCtx.globalCompositeOperation = getMixModeStr(item.blendMode);\n                        groupCtx.globalAlpha = item.hidden ? 0 : item.opacity;\n                        groupCtx.drawImage(canvas, 0, 0);\n                    }\n\n                } else {\n                    if (item.name === undefined) {\n                        throw new Error('item.name undefined');\n                    }\n                    resultArr.push({\n                        name: item.name,\n                        isVisible: !item.hidden && groupIsVisible,\n                        opacity: item.opacity * groupOpacity,\n                        mixModeStr: getMixModeStr(item.blendMode),\n                        image: canvas,\n                    });\n                }\n            }\n        }\n\n        if (groupCanvas) {\n            if (psdGroupObj.name === undefined) {\n                throw new Error('psdGroupObj.name undefined');\n            }\n            resultArr = [\n                {\n                    name: psdGroupObj.name,\n                    isVisible: groupIsVisible,\n                    opacity: groupOpacity,\n                    mixModeStr: groupMixModeStr,\n                    image: groupCanvas,\n                },\n            ];\n        }\n\n        return resultArr;\n    }\n\n    result.layers = convertGroup({\n        name: 'root',\n        opacity: 1,\n        blendMode: 'normal',\n        children: psdObj.children,\n    });\n\n    return result;\n}\n\nexport function klPsdToKlProject (klPsd: IKlPsd): IKlProject {\n    // only share references to Canvas elements\n    const result: IKlProject = {\n        width: klPsd.width,\n        height: klPsd.height,\n        layers: [],\n    };\n    if (klPsd.layers) {\n        result.layers = klPsd.layers.map(item => {\n            return {\n                name: item.name,\n                isVisible: item.isVisible,\n                opacity: item.opacity,\n                mixModeStr: item.mixModeStr,\n                image: item.image,\n            };\n        });\n    } else {\n        // flattened\n        result.layers = [{\n            name: LANG('background'),\n            isVisible: true,\n            opacity: 1,\n            mixModeStr: 'source-over',\n            image: klPsd.canvas,\n        }];\n    }\n    return result;\n}","import {IKlStorageProject} from '../kl-types';\n\nconst indexedDbIsSupported = !!window.indexedDB;\nlet dbNameStr = 'Klecks';\nconst storageNameStr = 'ProjectStore';\n\nexport function setDbName (name: string): void {\n    dbNameStr = '' + name;\n}\n\n/**\n * connects to db dbNameStr, then executes transaction on storageNameStr storage\n * with index 'id'\n *\n * @param actionFunction what to execute during transaction\n * @param successCallback on successful transaction\n * @param errorCallback on error\n */\nfunction execIndexedDBTransaction (\n    actionFunction: (storeObj: IDBObjectStore) => void,\n    successCallback: () => void,\n    errorCallback: (errorStr: string) => void,\n): void {\n\n    let hasFinished = false;\n\n    function onSuccess (): void {\n        if (hasFinished) {\n            return;\n        }\n        hasFinished = true;\n        successCallback();\n    }\n\n    function onError (errorStr: string): void {\n        if (hasFinished) {\n            return;\n        }\n        hasFinished = true;\n        errorCallback(errorStr);\n    }\n\n    if (!indexedDbIsSupported) {\n        setTimeout(function () {\n            onError('no indexed db available');\n        }, 0);\n        return;\n    }\n    let requestObj: IDBOpenDBRequest;\n\n    try {\n        requestObj = window.indexedDB.open(dbNameStr, 1);\n    } catch (e) {\n        onError((e as {message: string}).message);\n        return;\n    }\n\n    requestObj.onupgradeneeded = function (): void {\n        try {\n            const db: IDBDatabase = requestObj.result;\n            const store = db.createObjectStore(storageNameStr, {keyPath: 'id'});\n            store.createIndex('id', 'id', {unique: true});\n        } catch (e) {\n            onError((e as {message: string}).message);\n        }\n    };\n    requestObj.onerror = function (): void {\n        onError('indexedDB.open failed, ' + requestObj.error);\n    };\n    requestObj.onsuccess = function (): void {\n        let databaseObj: IDBDatabase;\n        let transactionObj: IDBTransaction;\n        let storeObj: IDBObjectStore;\n\n        try {\n            databaseObj = requestObj.result;\n            if (!databaseObj.objectStoreNames.contains(storageNameStr)) {\n                //someone maybe messed with the db, or creation failed earlier\n                //it's broken -> destroy\n                window.indexedDB.deleteDatabase(dbNameStr);\n                onError('object store ' + storageNameStr + ' missing. destroying db');\n                return;\n            }\n            transactionObj = databaseObj.transaction(storageNameStr, 'readwrite');\n            storeObj = transactionObj.objectStore(storageNameStr);\n            storeObj.index('id');\n        } catch (e) {\n            onError((e as {message: string}).message);\n            return;\n        }\n\n        databaseObj.onerror = function (): void {\n            onError('database error, ' + (databaseObj as IDBDatabase & {error: string}).error);\n        };\n\n        try {\n            actionFunction(storeObj);\n        } catch (e) {\n            onError((e as {message: string}).message);\n            return;\n        }\n\n        transactionObj.oncomplete = function (): void {\n            onSuccess();\n            databaseObj.close();\n        };\n        transactionObj.onerror = function (): void {\n            onError('transaction error, ' + transactionObj.error);\n        };\n    };\n}\n\nexport function getKlProjectObj (\n    successCallback: (result: undefined | IKlStorageProject) => void,\n    errorCallback: (error: string) => void,\n): void {\n    if (indexedDbIsSupported) {\n        let query: IDBRequest<undefined | IKlStorageProject>;\n        execIndexedDBTransaction(function (storeObj) {\n            query = storeObj.get(1);\n        }, function () {\n            successCallback(query.result);\n        }, function (errorStr) {\n            errorCallback('execIndexedDBTransaction error, ' + errorStr);\n        });\n    } else {\n        successCallback(undefined);\n    }\n}\n\n/**\n * stores a project into id = 1 in database:dbNameStr > storage: storageNameStr\n */\nexport function storeKlProjectObj (\n    storageProject: IKlStorageProject,\n    successCallback: () => void,\n    errorCallback: (error: string) => void,\n): void {\n    execIndexedDBTransaction(function (storeObj) {\n        storeObj.put(storageProject);\n    }, function () {\n        successCallback();\n    }, function (errorStr) {\n        errorCallback(errorStr);\n    });\n\n}\n\n/**\n * deletes stored project, by removing id = 1 from database:dbNameStr > storage: storageNameStr\n */\nexport function clear (\n    successCallback: () => void,\n    errorCallback: (error: string) => void,\n): void {\n    execIndexedDBTransaction(function (storeObj) {\n        storeObj.delete(1);\n    }, function () {\n        successCallback();\n    }, function (error) {\n        errorCallback(error);\n    });\n\n}\n","import {IFilter} from '../kl-types';\nimport glBrightnessContrastImg from '/src/app/img/ui/edit-brightness-contrast.svg';\nimport cropExtendImg from '/src/app/img/ui/edit-crop.svg';\nimport glCurvesImg from '/src/app/img/ui/edit-curves.svg';\nimport flipImg from '/src/app/img/ui/edit-flip.svg';\nimport glHueSaturationImg from '/src/app/img/ui/edit-hue-saturation.svg';\nimport invertImg from '/src/app/img/ui/edit-invert.png';\nimport glPerspectiveImg from '/src/app/img/ui/edit-perspective.svg';\nimport resizeImg from '/src/app/img/ui/edit-resize.svg';\nimport rotateImg from '/src/app/img/ui/edit-rotate.svg';\nimport glTiltShiftImg from '/src/app/img/ui/edit-tilt-shift.png';\nimport toAlphaImg from '/src/app/img/ui/edit-to-alpha.svg';\nimport transformImg from '/src/app/img/ui/edit-transform.svg';\nimport glBlurImg from '/src/app/img/ui/edit-triangle-blur.png';\nimport glUnsharpMaskImg from '/src/app/img/ui/edit-unsharp-mask.png';\nimport gridImg from '/src/app/img/ui/edit-grid.svg';\nimport noiseImg from '/src/app/img/ui/edit-noise.svg';\nimport patternImg from '/src/app/img/ui/edit-pattern.svg';\nimport vanishPointImg from '/src/app/img/ui/edit-vanish-point.svg';\nimport distortImg from '/src/app/img/ui/edit-distort.svg';\nimport {THistoryEntryG} from '../history/kl-history';\n\nexport type TFilterHistoryEntry<Filter extends string, Input> = THistoryEntryG<['filter', Filter], 'apply', [{ input: Input }]>;\n\nexport const filterLibStatus = {\n    isLoaded: false,\n};\nexport const filterLib: {\n    [key:string]: IFilter;\n} = {\n    brightnessContrast: {\n        lang: {\n            name: 'filter-bright-contrast-title',\n            button: 'filter-bright-contrast',\n            description: 'filter-bright-contrast-description',\n        },\n        icon: glBrightnessContrastImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true,\n    },\n    cropExtend: {\n        lang: {\n            name: 'filter-crop-title',\n            button: 'filter-crop-extend',\n            description: 'filter-crop-description',\n        },\n        icon: cropExtendImg,\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false,\n    },\n    curves: {\n        lang: {\n            name: 'filter-curves-title',\n            button: 'filter-curves',\n            description: 'filter-curves-description',\n        },\n        icon: glCurvesImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true,\n    },\n    distort: {\n        lang: {\n            name: 'filter-distort',\n            button: 'filter-distort',\n            description: 'filter-distort-description',\n        },\n        icon: distortImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true,\n    },\n    flip: {\n        lang: {\n            name: 'filter-flip-title',\n            button: 'filter-flip',\n            description: 'filter-flip-description',\n        },\n        icon: flipImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    hueSaturation: {\n        lang: {\n            name: 'filter-hue-sat-title',\n            button: 'filter-hue-sat',\n            description: 'filter-hue-sat-description',\n        },\n        icon: glHueSaturationImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true,\n    },\n    invert: {\n        lang: {\n            name: 'filter-invert',\n            button: 'filter-invert',\n        },\n        icon: invertImg,\n        updatePos: false,\n        isInstant: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true,\n    },\n    perspective: {\n        lang: {\n            name: 'filter-perspective-title',\n            button: 'filter-perspective',\n            description: 'filter-perspective-description',\n        },\n        icon: glPerspectiveImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true,\n    },\n    resize: {\n        lang: {\n            name: 'filter-resize-title',\n            button: 'filter-resize',\n            description: 'filter-resize-description',\n        },\n        icon: resizeImg,\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false,\n    },\n    rotate: {\n        lang: {\n            name: 'filter-rotate-title',\n            button: 'filter-rotate',\n            description: 'filter-rotate-description',\n        },\n        icon: rotateImg,\n        updatePos: true,\n        getDialog: null,\n        apply: null,\n        inEmbed: false,\n    },\n    tiltShift: {\n        lang: {\n            name: 'filter-tilt-shift-title',\n            button: 'filter-tilt-shift',\n            description: 'filter-tilt-shift-description',\n        },\n        icon: glTiltShiftImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true,\n    },\n    toAlpha: {\n        lang: {\n            name: 'filter-to-alpha-title',\n            button: 'filter-to-alpha',\n            description: 'filter-to-alpha-description',\n        },\n        icon: toAlphaImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true,\n    },\n    transform: {\n        lang: {\n            name: 'filter-transform-title',\n            button: 'filter-transform',\n            description: 'filter-transform-description',\n        },\n        icon: transformImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    blur: {\n        lang: {\n            name: 'filter-triangle-blur-title',\n            button: 'filter-triangle-blur',\n            description: 'filter-triangle-blur-description',\n        },\n        icon: glBlurImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true,\n    },\n    unsharpMask: {\n        lang: {\n            name: 'filter-unsharp-mask-title',\n            button: 'filter-unsharp-mask',\n            description: 'filter-unsharp-mask-description',\n        },\n        icon: glUnsharpMaskImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        darkNoInvert: true,\n        webGL: true,\n    },\n    grid: {\n        lang: {\n            name: 'filter-grid',\n            button: 'filter-grid',\n            description: 'filter-grid-description',\n        },\n        icon: gridImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    noise: {\n        lang: {\n            name: 'filter-noise',\n            button: 'filter-noise',\n            description: 'filter-noise-description',\n        },\n        icon: noiseImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n        webGL: true,\n    },\n    pattern: {\n        lang: {\n            name: 'filter-pattern',\n            button: 'filter-pattern',\n            description: 'filter-pattern-description',\n        },\n        icon: patternImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n    vanishPoint: {\n        lang: {\n            name: 'filter-vanish-point-title',\n            button: 'filter-vanish-point',\n            description: 'filter-vanish-point-description',\n        },\n        icon: vanishPointImg,\n        updatePos: false,\n        getDialog: null,\n        apply: null,\n        inEmbed: true,\n    },\n};\n","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"edit-brightness-contrast.8430cb26.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"edit-curves.bbdb97b2.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"edit-flip.00fd2c6b.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"edit-hue-saturation.6e36cf05.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"edit-invert.f5d05ba3.png\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"edit-perspective.e23100db.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"edit-resize.56391e2b.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"edit-tilt-shift.f8ae88b3.png\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"edit-to-alpha.f7a2065a.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"edit-transform.c8795430.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"edit-triangle-blur.d2c20f1d.png\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"edit-unsharp-mask.f1520547.png\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"edit-grid.e900ce7b.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"edit-noise.51bd751c.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"edit-pattern.1a06e094.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"edit-vanish-point.fc5858e4.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"edit-distort.bdb643f2.svg\";","import {PenBrush} from './pen-brush';\nimport {BlendBrush} from './blend-brush';\nimport {SketchyBrush} from './sketchy-brush';\nimport {PixelBrush} from './pixel-brush';\nimport {EraserBrush} from './eraser-brush';\nimport {SmudgeBrush} from './smudge-brush';\nimport {ChemyBrush} from './chemy-brush';\n\nexport type TBrush = |\n    PenBrush |\n    BlendBrush |\n    SketchyBrush |\n    PixelBrush |\n    ChemyBrush |\n    SmudgeBrush |\n    EraserBrush;\n\nexport const brushes = {\n    PenBrush,\n    BlendBrush,\n    SketchyBrush,\n    PixelBrush,\n    ChemyBrush,\n    SmudgeBrush,\n    EraserBrush,\n};\n","import {BB} from '../../bb/bb';\nimport {alphaImArr} from './brushes-common';\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\nimport {KL} from '../kl';\nimport {IRGB, TPressureInput} from '../kl-types';\nimport {BezierLine} from '../../bb/math/line';\n\nexport interface IPenBrushHistoryEntry extends IHistoryEntry {\n    tool: ['brush', 'PenBrush'];\n    actions: THistoryInnerActions<PenBrush>[];\n}\n\nconst ALPHA_CIRCLE = 0;\nconst ALPHA_CHALK = 1;\nconst ALPHA_CAL = 2; // calligraphy\nconst ALPHA_SQUARE = 3;\n\nconst TWO_PI = 2 * Math.PI;\n\nexport class PenBrush {\n\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\n    private historyEntry: IPenBrushHistoryEntry | undefined;\n\n    private settingHasOpacityPressure: boolean = false;\n    private settingHasSizePressure: boolean = true;\n    private settingSize: number = 2;\n    private settingSpacing: number = 0.8489;\n    private settingOpacity: number = 1;\n    private settingColor: IRGB = {} as IRGB;\n    private settingColorStr: string = '';\n    private settingAlphaId: number = ALPHA_CIRCLE;\n    private settingLockLayerAlpha: boolean = false;\n\n    private hasDrawnDot: boolean = false;\n    private lineToolLastDot: number = 0;\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\n    private lastInput2: TPressureInput = {x: 0, y: 0, pressure: 0};\n    private inputArr: TPressureInput[] = [];\n    private inputIsDrawing: boolean = false;\n    private bezierLine: BezierLine | null = null;\n\n    // mipmapping\n    private readonly alphaCanvas128: HTMLCanvasElement = BB.canvas(128, 128);\n    private readonly alphaCanvas64: HTMLCanvasElement = BB.canvas(64, 64);\n    private readonly alphaCanvas32: HTMLCanvasElement = BB.canvas(32, 32);\n    private readonly alphaOpacityArr: number[] = [1, 0.9, 1, 1];\n\n\n    private updateAlphaCanvas () {\n        if (this.settingAlphaId === ALPHA_CIRCLE || this.settingAlphaId === ALPHA_SQUARE) {\n            return;\n        }\n\n        const instructionArr: [HTMLCanvasElement, number][] = [\n            [this.alphaCanvas128, 128],\n            [this.alphaCanvas64, 64],\n            [this.alphaCanvas32, 32],\n        ];\n\n        let ctx;\n\n        for (let i = 0; i < instructionArr.length; i++) {\n            ctx = BB.ctx((instructionArr[i][0] as any));\n\n            ctx.save();\n            ctx.clearRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\n\n            ctx.fillStyle = 'rgba(' + this.settingColor.r\n                + ', ' + this.settingColor.g\n                + ', ' + this.settingColor.b\n                + ', ' + this.alphaOpacityArr[this.settingAlphaId] + ')';\n            ctx.fillRect(0, 0, instructionArr[i][1], instructionArr[i][1]);\n\n            ctx.globalCompositeOperation = 'destination-in';\n            ctx.imageSmoothingQuality = 'high';\n            ctx.drawImage(alphaImArr[this.settingAlphaId], 0, 0, instructionArr[i][1], instructionArr[i][1]);\n\n            ctx.restore();\n        }\n    }\n\n    private calcOpacity (pressure: number): number {\n        return this.settingOpacity * (this.settingHasOpacityPressure ? pressure * pressure : 1);\n    }\n\n    /**\n     * @param x\n     * @param y\n     * @param size\n     * @param opacity\n     * @param angle\n     * @param before - [x, y, size, opacity, angle] the drawDot call before\n     */\n    private drawDot (\n        x: number,\n        y:number,\n        size: number,\n        opacity: number,\n        angle?: number,\n        before?: [number, number, number, number, (number | undefined)]\n    ): void {\n        if (size <= 0) {\n            return;\n        }\n\n        if (this.settingLockLayerAlpha) {\n            this.context.globalCompositeOperation = 'source-atop';\n        }\n\n        if (!before || before[3] !== opacity) {\n            this.context.globalAlpha = opacity;\n        }\n\n        if (!before && (this.settingAlphaId === ALPHA_CIRCLE || this.settingAlphaId === ALPHA_SQUARE)) {\n            this.context.fillStyle = this.settingColorStr;\n        }\n\n        if (this.settingAlphaId === ALPHA_CIRCLE) {\n            this.context.beginPath();\n            this.context.arc(x, y, size, 0, TWO_PI);\n            this.context.closePath();\n            this.context.fill();\n            this.hasDrawnDot = true;\n\n        } else if (this.settingAlphaId === ALPHA_SQUARE) {\n            if (angle !== undefined) {\n                this.context.save();\n                this.context.translate(x, y);\n                this.context.rotate(angle / 180 * Math.PI);\n                this.context.fillRect(-size, -size, size * 2, size * 2);\n                this.context.restore();\n                this.hasDrawnDot = true;\n            }\n\n        } else { // other brush alphas\n            this.context.save();\n            this.context.translate(x, y);\n            let targetMipmap = this.alphaCanvas128;\n            if (size <= 32 && size > 16) {\n                targetMipmap = this.alphaCanvas64;\n            } else if (size <= 16) {\n                targetMipmap = this.alphaCanvas32;\n            }\n            this.context.scale(size, size);\n            if (this.settingAlphaId === ALPHA_CHALK) {\n                this.context.rotate(((x + y) * 53123) % TWO_PI); // without mod it sometimes looks different\n            }\n            this.context.drawImage(targetMipmap, -1, -1, 2, 2);\n\n            this.context.restore();\n            this.hasDrawnDot = true;\n        }\n    }\n\n    // continueLine\n    private continueLine (\n        x: number | null,\n        y: number | null,\n        size: number,\n        pressure: number,\n    ): void {\n        if (this.bezierLine === null) {\n            this.bezierLine = new BB.BezierLine();\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, () => {});\n        }\n\n        const drawArr: [number, number, number, number, (number | undefined)][] = []; //draw instructions. will be all drawn at once\n\n        const dotCallback = (val: {\n            x: number;\n            y: number;\n            t: number;\n            angle?: number;\n            dAngle: number;\n        }): void => {\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\n            const localOpacity = this.calcOpacity(localPressure);\n            const localSize = Math.max(0.1, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\n            drawArr.push([val.x, val.y, localSize, localOpacity, val.angle]);\n        };\n\n        const localSpacing = size * this.settingSpacing;\n        if (x === null || y === null) {\n            this.bezierLine.addFinal(localSpacing, dotCallback);\n        } else {\n            this.bezierLine.add(x, y, localSpacing, dotCallback);\n        }\n\n        // execute draw instructions\n        this.context.save();\n        let before: typeof drawArr[number] | undefined = undefined;\n        for (let i = 0; i < drawArr.length; i++) {\n            const item = drawArr[i];\n            this.drawDot(item[0], item[1], item[2], item[3], item[4], before);\n            before = item;\n        }\n        this.context.restore();\n    }\n\n\n    // ---- public ----\n    constructor () {}\n\n    // ---- interface ----\n\n    startLine (x: number, y: number, p: number): void {\n        this.historyEntry = {\n            tool: ['brush', 'PenBrush'],\n            actions: [\n                {\n                    action: 'opacityPressure',\n                    params: [this.settingHasOpacityPressure],\n                },\n                {\n                    action: 'sizePressure',\n                    params: [this.settingHasSizePressure],\n                },\n                {\n                    action: 'setSize',\n                    params: [this.settingSize],\n                },\n                {\n                    action: 'setSpacing',\n                    params: [this.settingSpacing],\n                },\n                {\n                    action: 'setOpacity',\n                    params: [this.settingOpacity],\n                },\n                {\n                    action: 'setColor',\n                    params: [this.settingColor],\n                },\n                {\n                    action: 'setAlpha',\n                    params: [this.settingAlphaId],\n                },\n                {\n                    action: 'setLockAlpha',\n                    params: [this.settingLockLayerAlpha],\n                },\n            ],\n        };\n\n        p = BB.clamp(p, 0, 1);\n        const localOpacity = this.calcOpacity(p);\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\n\n        this.hasDrawnDot = false;\n\n        this.inputIsDrawing = true;\n        this.context.save();\n        this.drawDot(x, y, localSize, localOpacity);\n        this.context.restore();\n\n        this.lineToolLastDot = localSize * this.settingSpacing;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2.pressure = p;\n\n        this.inputArr = [{\n            x,\n            y,\n            pressure: p,\n        }];\n\n        this.historyEntry.actions!.push({\n            action: 'startLine',\n            params: [x, y, p],\n        });\n    }\n\n    goLine (x: number, y: number, p: number): void {\n        if (!this.inputIsDrawing) {\n            return;\n        }\n        this.historyEntry!.actions!.push({\n            action: 'goLine',\n            params: [x, y, p],\n        });\n\n        const pressure = BB.clamp(p, 0, 1);\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n\n        this.context.save();\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\n\n        /*context.fillStyle = 'red';\n        context.fillRect(Math.floor(x), Math.floor(y - 10), 1, 20);\n        context.fillRect(Math.floor(x - 10), Math.floor(y), 20, 1);*/\n\n        this.context.restore();\n\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput2.pressure = this.lastInput.pressure;\n        this.lastInput.pressure = pressure;\n\n        this.inputArr.push({\n            x,\n            y,\n            pressure: p,\n        });\n    }\n\n    endLine (x: number, y: number): void {\n\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n        this.context.save();\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\n        this.context.restore();\n\n        this.inputIsDrawing = false;\n\n        if (this.settingAlphaId === ALPHA_SQUARE && !this.hasDrawnDot) {\n            // find max pressure input, use that one\n            let maxInput = this.inputArr[0];\n            this.inputArr.forEach(item => {\n                if (item.pressure > maxInput.pressure) {\n                    maxInput = item;\n                }\n            });\n\n            this.context.save();\n            const p = BB.clamp(maxInput.pressure, 0, 1);\n            const localOpacity = this.calcOpacity(p);\n            this.drawDot(maxInput.x, maxInput.y, localSize, localOpacity, 0);\n            this.context.restore();\n        }\n\n        this.bezierLine = null;\n\n        if (this.historyEntry) {\n            this.historyEntry.actions!.push({\n                action: 'endLine',\n                params: [x, y],\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n\n        this.hasDrawnDot = false;\n        this.inputArr = [];\n    }\n\n\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\n        this.lastInput.x = x2;\n        this.lastInput.y = y2;\n        this.lastInput.pressure = 1;\n\n        if (this.inputIsDrawing || x1 === undefined) {\n            return;\n        }\n\n        const angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        const eX = (x2 - x1) / mouseDist;\n        const eY = (y2 - y1) / mouseDist;\n        let loopDist;\n        const bdist = this.settingSize * this.settingSpacing;\n        this.lineToolLastDot = this.settingSize * this.settingSpacing;\n        this.context.save();\n        for (loopDist = this.lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\n            this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.settingSize, this.settingOpacity, angle);\n        }\n        this.context.restore();\n\n\n        const historyEntry: IPenBrushHistoryEntry = {\n            tool: ['brush', 'PenBrush'],\n            actions: [\n                {\n                    action: 'opacityPressure',\n                    params: [this.settingHasOpacityPressure],\n                },\n                {\n                    action: 'sizePressure',\n                    params: [this.settingHasSizePressure],\n                },\n                {\n                    action: 'setSize',\n                    params: [this.settingSize],\n                },\n                {\n                    action: 'setSpacing',\n                    params: [this.settingSpacing],\n                },\n                {\n                    action: 'setOpacity',\n                    params: [this.settingOpacity],\n                },\n                {\n                    action: 'setColor',\n                    params: [this.settingColor],\n                },\n                {\n                    action: 'setAlpha',\n                    params: [this.settingAlphaId],\n                },\n                {\n                    action: 'setLockAlpha',\n                    params: [this.settingLockLayerAlpha],\n                },\n                {\n                    action: 'drawLineSegment',\n                    params: [x1, y1, x2, y2],\n                },\n            ],\n        };\n        this.history.push(historyEntry);\n    }\n\n    //IS\n    isDrawing (): boolean {\n        return this.inputIsDrawing;\n    }\n\n    //SET\n    setAlpha (a: number): void {\n        if (this.settingAlphaId === a) {\n            return;\n        }\n        this.settingAlphaId = a;\n        this.updateAlphaCanvas();\n    }\n\n    setColor (c: IRGB): void {\n        if (this.settingColor === c) {\n            return;\n        }\n        this.settingColor = {r: c.r, g: c.g, b: c.b};\n        this.settingColorStr = 'rgb(' + this.settingColor.r + ',' + this.settingColor.g + ',' + this.settingColor.b + ')';\n        this.updateAlphaCanvas();\n    }\n\n    setContext (c: CanvasRenderingContext2D): void {\n        this.context = c;\n    }\n\n    setHistory (l: KlHistoryInterface): void {\n        this.history = l;\n    }\n\n    setSize (s: number): void {\n        this.settingSize = s;\n    }\n\n    setOpacity (o: number): void {\n        this.settingOpacity = o;\n    }\n\n    setSpacing (s: number): void {\n        this.settingSpacing = s;\n    }\n\n    sizePressure (b: boolean): void {\n        this.settingHasSizePressure = b;\n    }\n\n    opacityPressure (b: boolean): void {\n        this.settingHasOpacityPressure = b;\n    }\n\n    setLockAlpha (b: boolean): void {\n        this.settingLockLayerAlpha = b;\n    }\n\n    //GET\n    getSpacing (): number {\n        return this.settingSpacing;\n    }\n\n    getSize (): number {\n        return this.settingSize;\n    }\n\n    getOpacity (): number {\n        return this.settingOpacity;\n    }\n\n    getLockAlpha (): boolean {\n        return this.settingLockLayerAlpha;\n    }\n\n}\n\n","import {genBrushAlpha01, genBrushAlpha02} from './alphas/brush-alphas';\n\nexport const alphaImArr: HTMLCanvasElement[] = []; //used by default brush\nalphaImArr[1] = genBrushAlpha01(128);\nalphaImArr[2] = genBrushAlpha02(128);","import {BB} from '../../../bb/bb';\nimport {noise} from '../../../bb/math/perlin';\nimport {IVector2D} from '../../../bb/bb-types';\n\n// chalk\nexport function genBrushAlpha01 (w: number): HTMLCanvasElement {\n\n    const scaleFac = w / 500;\n    const h = w;\n    const canvas = BB.canvas(w, h);\n    const ctx = BB.ctx(canvas);\n    const imData = ctx.createImageData(w, h);\n    for (let x = 0; x < w; x++) {\n        for (let y = 0; y < h; y++) {\n            const i = (y * w + x) * 4;\n\n            // base noise\n            const sFac2 = scaleFac + noise.simplex2(x / 50 / scaleFac, y / 50 / scaleFac) * 0.04;\n            let noisePattern = 100 + (noise.simplex2(x / 50 / sFac2, y / 50 / sFac2) + 1) / 2 * 100;\n            noisePattern -= (noise.simplex2(x / 10 / scaleFac, y / 10 / scaleFac) + 1) / 2 * 100;\n\n            // fade out in circular shape\n            const centerDist = BB.dist(w / 2, h / 2, x, y);\n            const falloff = BB.clamp(\n                1 - ((centerDist - (w / 2.5)) / (w / 14) + noise.simplex2(x / 22 / sFac2, y / 22 / sFac2)),\n                0,\n                1);\n            noisePattern = noisePattern * falloff;\n\n            // make the middle darker\n            const falloff2 = BB.clamp(1 - centerDist / w, 0, 1) * 2;\n            noisePattern = noisePattern * falloff2;\n\n            imData.data[i] = 0;\n            imData.data[i + 1] = 0;\n            imData.data[i + 2] = 0;\n            imData.data[i + 3] = BB.clamp(noisePattern, 0, 255);\n        }\n    }\n\n    ctx.putImageData(imData, 0, 0);\n    return canvas;\n}\n\n// https://www.shadertoy.com/view/3tdSDj\nfunction udSegment ( p: IVector2D, a: IVector2D, b: IVector2D ): number {\n    const ba = BB.Vec2.sub(b, a);\n    const pa = BB.Vec2.sub(p, a);\n    const h = BB.clamp( BB.Vec2.dot(pa,ba) / BB.Vec2.dot(ba,ba), 0.0, 1.0 );\n    return BB.Vec2.len(BB.Vec2.sub(pa, BB.Vec2.mul(ba, h)));\n}\n\n// calligraphy\nexport function genBrushAlpha02 (w: number): HTMLCanvasElement {\n\n    const pDist = 1 / 4;\n    let centerSize = 2 / 3;\n    let transitionSize = 1 / 3;\n    centerSize *= pDist;\n    transitionSize *= pDist;\n    const p1 = {x: pDist * w, y: w - (w * pDist)};\n    const p2 = {x: w - (w * pDist), y: pDist * w};\n\n    const h = w;\n    const canvas = BB.canvas(w, h);\n    const ctx = BB.ctx(canvas);\n    const imData = ctx.createImageData(w, h);\n    for (let x = 0; x < w; x++) {\n        for (let y = 0; y < h; y++) {\n            const i = (y * w + x) * 4;\n\n            let col = udSegment({x: x, y: y}, p1, p2);\n\n            col = BB.clamp(\n                255 - ((col - (w * centerSize)) / (w * transitionSize) * 255),\n                0,\n                255\n            );\n\n            imData.data[i] = 0;\n            imData.data[i + 1] = 0;\n            imData.data[i + 2] = 0;\n            imData.data[i + 3] = col;\n        }\n    }\n\n    ctx.putImageData(imData, 0, 0);\n    return canvas;\n}","/*\n * A speed-improved perlin and simplex noise algorithms for 2D.\n *\n * Based on example code by Stefan Gustavson (stegu@itn.liu.se).\n * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\n * Better rank ordering method by Stefan Gustavson in 2012.\n * Converted to Javascript by Joseph Gentle.\n *\n * Version 2012-03-09\n *\n * This code was placed in the public domain by its original author,\n * Stefan Gustavson. You may use it as you see fit, but\n * attribution is appreciated.\n *\n */\n\nconst myModule = {} as any;\n\nclass Grad {\n    constructor (public x: number, public y: number, public z:number) {}\n\n    dot2 (x: number, y: number): number {\n        return this.x*x + this.y*y;\n    }\n}\n/*\nGrad.prototype.dot3 = function(x, y, z) {\n    return this.x*x + this.y*y + this.z*z;\n};*/\n\nconst grad3 = [new Grad(1,1,0),new Grad(-1,1,0),new Grad(1,-1,0),new Grad(-1,-1,0),\n    new Grad(1,0,1),new Grad(-1,0,1),new Grad(1,0,-1),new Grad(-1,0,-1),\n    new Grad(0,1,1),new Grad(0,-1,1),new Grad(0,1,-1),new Grad(0,-1,-1)];\n\nconst p = [151,160,137,91,90,15,\n    131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,\n    190, 6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,\n    88,237,149,56,87,174,20,125,136,171,168, 68,175,74,165,71,134,139,48,27,166,\n    77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,\n    102,143,54, 65,25,63,161, 1,216,80,73,209,76,132,187,208, 89,18,169,200,196,\n    135,130,116,188,159,86,164,100,109,198,173,186, 3,64,52,217,226,250,124,123,\n    5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,\n    223,183,170,213,119,248,152, 2,44,154,163, 70,221,153,101,155,167, 43,172,9,\n    129,22,39,253, 19,98,108,110,79,113,224,232,178,185, 112,104,218,246,97,228,\n    251,34,242,193,238,210,144,12,191,179,162,241, 81,51,145,235,249,14,239,107,\n    49,192,214, 31,181,199,106,157,184, 84,204,176,115,121,50,45,127, 4,150,254,\n    138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];\n// To remove the need for index wrapping, double the permutation table length\nconst perm = new Array(512);\nconst gradP = new Array(512);\n\n// This isn't a very good seeding function, but it works ok. It supports 2^16\n// different seed values. Write something better if you need more seeds.\nmyModule.seed = function (seed: number): void {\n    if (seed > 0 && seed < 1) {\n        // Scale the seed out\n        seed *= 65536;\n    }\n\n    seed = Math.floor(seed);\n    if (seed < 256) {\n        seed |= seed << 8;\n    }\n\n    for (let i = 0; i < 256; i++) {\n        let v;\n        if (i & 1) {\n            v = p[i] ^ (seed & 255);\n        } else {\n            v = p[i] ^ ((seed>>8) & 255);\n        }\n\n        perm[i] = perm[i + 256] = v;\n        gradP[i] = gradP[i + 256] = grad3[v % 12];\n    }\n};\n\nmyModule.seed(0);\n\n/*\nfor (let i=0; i<256; i++) {\n  perm[i] = perm[i + 256] = p[i];\n  gradP[i] = gradP[i + 256] = grad3[perm[i] % 12];\n}*/\n\n// Skewing and unskewing factors for 2, 3, and 4 dimensions\nconst F2 = 0.5*(Math.sqrt(3)-1);\nconst G2 = (3-Math.sqrt(3))/6;\n\n/*let F3 = 1/3;\nlet G3 = 1/6;*/\n\n// 2D simplex noise\nmyModule.simplex2 = function (xin: number, yin: number): number {\n    let n0, n1, n2; // Noise contributions from the three corners\n    // Skew the input space to determine which simplex cell we're in\n    const s = (xin+yin)*F2; // Hairy factor for 2D\n    let i = Math.floor(xin+s);\n    let j = Math.floor(yin+s);\n    const t = (i+j)*G2;\n    const x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\n    const y0 = yin-j+t;\n    // For the 2D case, the simplex shape is an equilateral triangle.\n    // Determine which simplex we are in.\n    let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\n    if (x0>y0) { // lower triangle, XY order: (0,0)->(1,0)->(1,1)\n        i1=1; j1=0;\n    } else {    // upper triangle, YX order: (0,0)->(0,1)->(1,1)\n        i1=0; j1=1;\n    }\n    // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\n    // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\n    // c = (3-sqrt(3))/6\n    const x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\n    const y1 = y0 - j1 + G2;\n    const x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\n    const y2 = y0 - 1 + 2 * G2;\n    // Work out the hashed gradient indices of the three simplex corners\n    i &= 255;\n    j &= 255;\n    const gi0 = gradP[i+perm[j]];\n    const gi1 = gradP[i+i1+perm[j+j1]];\n    const gi2 = gradP[i+1+perm[j+1]];\n    // Calculate the contribution from the three corners\n    let t0 = 0.5 - x0*x0-y0*y0;\n    if (t0<0) {\n        n0 = 0;\n    } else {\n        t0 *= t0;\n        n0 = t0 * t0 * gi0.dot2(x0, y0);  // (x,y) of grad3 used for 2D gradient\n    }\n    let t1 = 0.5 - x1*x1-y1*y1;\n    if (t1<0) {\n        n1 = 0;\n    } else {\n        t1 *= t1;\n        n1 = t1 * t1 * gi1.dot2(x1, y1);\n    }\n    let t2 = 0.5 - x2*x2-y2*y2;\n    if (t2<0) {\n        n2 = 0;\n    } else {\n        t2 *= t2;\n        n2 = t2 * t2 * gi2.dot2(x2, y2);\n    }\n    // Add contributions from each corner to get the final noise value.\n    // The result is scaled to return values in the interval [-1,1].\n    return 70 * (n0 + n1 + n2);\n};\n/*\n// 3D simplex noise\nmyModule.simplex3 = function(xin, yin, zin) {\n    let n0, n1, n2, n3; // Noise contributions from the four corners\n\n    // Skew the input space to determine which simplex cell we're in\n    let s = (xin+yin+zin)*F3; // Hairy factor for 2D\n    let i = Math.floor(xin+s);\n    let j = Math.floor(yin+s);\n    let k = Math.floor(zin+s);\n\n    let t = (i+j+k)*G3;\n    let x0 = xin-i+t; // The x,y distances from the cell origin, unskewed.\n    let y0 = yin-j+t;\n    let z0 = zin-k+t;\n\n    // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\n    // Determine which simplex we are in.\n    let i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\n    let i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\n    if (x0 >= y0) {\n        if (y0 >= z0)      { i1=1; j1=0; k1=0; i2=1; j2=1; k2=0; }\n        else if (x0 >= z0) { i1=1; j1=0; k1=0; i2=1; j2=0; k2=1; }\n        else              { i1=0; j1=0; k1=1; i2=1; j2=0; k2=1; }\n    } else {\n        if (y0 < z0)      { i1=0; j1=0; k1=1; i2=0; j2=1; k2=1; }\n        else if (x0 < z0) { i1=0; j1=1; k1=0; i2=0; j2=1; k2=1; }\n        else             { i1=0; j1=1; k1=0; i2=1; j2=1; k2=0; }\n    }\n    // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\n    // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\n    // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\n    // c = 1/6.\n    let x1 = x0 - i1 + G3; // Offsets for second corner\n    let y1 = y0 - j1 + G3;\n    let z1 = z0 - k1 + G3;\n\n    let x2 = x0 - i2 + 2 * G3; // Offsets for third corner\n    let y2 = y0 - j2 + 2 * G3;\n    let z2 = z0 - k2 + 2 * G3;\n\n    let x3 = x0 - 1 + 3 * G3; // Offsets for fourth corner\n    let y3 = y0 - 1 + 3 * G3;\n    let z3 = z0 - 1 + 3 * G3;\n\n    // Work out the hashed gradient indices of the four simplex corners\n    i &= 255;\n    j &= 255;\n    k &= 255;\n    let gi0 = gradP[i+   perm[j+   perm[k   ]]];\n    let gi1 = gradP[i+i1+perm[j+j1+perm[k+k1]]];\n    let gi2 = gradP[i+i2+perm[j+j2+perm[k+k2]]];\n    let gi3 = gradP[i+ 1+perm[j+ 1+perm[k+ 1]]];\n\n    // Calculate the contribution from the four corners\n    let t0 = 0.6 - x0*x0 - y0*y0 - z0*z0;\n    if (t0<0) {\n        n0 = 0;\n    } else {\n        t0 *= t0;\n        n0 = t0 * t0 * gi0.dot3(x0, y0, z0);  // (x,y) of grad3 used for 2D gradient\n    }\n    let t1 = 0.6 - x1*x1 - y1*y1 - z1*z1;\n    if (t1<0) {\n        n1 = 0;\n    } else {\n        t1 *= t1;\n        n1 = t1 * t1 * gi1.dot3(x1, y1, z1);\n    }\n    let t2 = 0.6 - x2*x2 - y2*y2 - z2*z2;\n    if (t2<0) {\n        n2 = 0;\n    } else {\n        t2 *= t2;\n        n2 = t2 * t2 * gi2.dot3(x2, y2, z2);\n    }\n    let t3 = 0.6 - x3*x3 - y3*y3 - z3*z3;\n    if (t3<0) {\n        n3 = 0;\n    } else {\n        t3 *= t3;\n        n3 = t3 * t3 * gi3.dot3(x3, y3, z3);\n    }\n    // Add contributions from each corner to get the final noise value.\n    // The result is scaled to return values in the interval [-1,1].\n    return 32 * (n0 + n1 + n2 + n3);\n\n};\n*/\n// ##### Perlin noise stuff\n/*\nfunction fade(t) {\n    return t*t*t*(t*(t*6-15)+10);\n}\n\nfunction lerp(a, b, t) {\n    return (1-t)*a + t*b;\n}\n\n// 2D Perlin Noise\nmyModule.perlin2 = function(x, y) {\n    // Find unit grid cell containing point\n    let X = Math.floor(x), Y = Math.floor(y);\n    // Get relative xy coordinates of point within that cell\n    x = x - X; y = y - Y;\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\n    X = X & 255; Y = Y & 255;\n\n    // Calculate noise contributions from each of the four corners\n    let n00 = gradP[X+perm[Y]].dot2(x, y);\n    let n01 = gradP[X+perm[Y+1]].dot2(x, y-1);\n    let n10 = gradP[X+1+perm[Y]].dot2(x-1, y);\n    let n11 = gradP[X+1+perm[Y+1]].dot2(x-1, y-1);\n\n    // Compute the fade curve value for x\n    let u = fade(x);\n\n    // Interpolate the four results\n    return lerp(\n        lerp(n00, n10, u),\n        lerp(n01, n11, u),\n        fade(y));\n};*/\n/*\n// 3D Perlin Noise\nmyModule.perlin3 = function(x, y, z) {\n    // Find unit grid cell containing point\n    let X = Math.floor(x), Y = Math.floor(y), Z = Math.floor(z);\n    // Get relative xyz coordinates of point within that cell\n    x = x - X; y = y - Y; z = z - Z;\n    // Wrap the integer cells at 255 (smaller integer period can be introduced here)\n    X = X & 255; Y = Y & 255; Z = Z & 255;\n\n    // Calculate noise contributions from each of the eight corners\n    let n000 = gradP[X+  perm[Y+  perm[Z  ]]].dot3(x,   y,     z);\n    let n001 = gradP[X+  perm[Y+  perm[Z+1]]].dot3(x,   y,   z-1);\n    let n010 = gradP[X+  perm[Y+1+perm[Z  ]]].dot3(x,   y-1,   z);\n    let n011 = gradP[X+  perm[Y+1+perm[Z+1]]].dot3(x,   y-1, z-1);\n    let n100 = gradP[X+1+perm[Y+  perm[Z  ]]].dot3(x-1,   y,   z);\n    let n101 = gradP[X+1+perm[Y+  perm[Z+1]]].dot3(x-1,   y, z-1);\n    let n110 = gradP[X+1+perm[Y+1+perm[Z  ]]].dot3(x-1, y-1,   z);\n    let n111 = gradP[X+1+perm[Y+1+perm[Z+1]]].dot3(x-1, y-1, z-1);\n\n    // Compute the fade curve value for x, y, z\n    let u = fade(x);\n    let v = fade(y);\n    let w = fade(z);\n\n    // Interpolate\n    return lerp(\n        lerp(\n            lerp(n000, n100, u),\n            lerp(n001, n101, u), w),\n        lerp(\n            lerp(n010, n110, u),\n            lerp(n011, n111, u), w),\n        v);\n};*/\n\nexport const noise = myModule;","import {BB} from '../../bb/bb';\nimport {IRGB, IRGBA} from '../kl-types';\nimport {IBounds, IPressureInput} from '../../bb/bb-types';\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\nimport {clamp} from '../../bb/math/math';\nimport {BezierLine, TBezierLineCallback} from '../../bb/math/line';\n\nexport interface IBlendBrushHistoryEntry extends IHistoryEntry {\n    tool: ['brush', 'BlendBrush'];\n    actions: THistoryInnerActions<BlendBrush>[];\n}\n\nconst cellSize = 256;\n\ninterface IDrawBufferItem {\n    x: number;\n    y: number;\n    size: number;\n    opacity: number;\n    x1: number;\n    y1: number;\n    x2: number;\n    y2: number;\n    r: number;\n    g: number;\n    b: number;\n}\n\nexport class BlendBrush {\n\n    private isTesting: boolean = false; // testing mode - context only gets updated when line is finished\n\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\n    private color: IRGB = {} as IRGB;\n    private size: number = 29; // radius - 0.5 - 99999\n    private opacity: number = 0.6; // 0-1\n    private blending: number = 0.65; // 0-1\n\n    private settingLockLayerAlpha: boolean = false;\n    private settingSizePressure: boolean = true;\n    private settingOpacityPressure: boolean = false;\n\n    private blendCol: IRGBA = {r: 0, g: 0, b: 0, a: 1}; // todo docs\n    private blendMix: number = 0.45; // todo docs\n    private mixCol: IRGB = {r: 0, g: 0, b: 0}; // todo docs\n    private localColOld: IRGBA = {} as IRGBA; // todo docs\n\n    private isDrawing: boolean = false;\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0}; // todo docs\n    private bezierLine: undefined | BezierLine;\n\n    private history: KlHistoryInterface | undefined;\n    private historyEntry: IBlendBrushHistoryEntry | undefined;\n    private redrawBounds: IBounds | undefined;\n    private cells: (ImageData | undefined)[] = [];\n    private drawBuffer: IDrawBufferItem[] = [];\n\n    private updateRedrawBounds (bounds: IBounds): void {\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\n    }\n\n    private getCellsWidth (): number {\n        return Math.ceil(this.context.canvas.width / cellSize);\n    }\n\n    /**\n     * draw changed cells (changed by brushstroke) onto context\n     * @private\n     */\n    private drawChangedCells (): void {\n        if (!this.redrawBounds) {\n            return;\n        }\n\n        const cells: typeof this.cells = this.cells.map(() => undefined);\n        const touchedCells = this.getTouchedCells(this.redrawBounds);\n        touchedCells.forEach((isTouched, index) => {\n            if (isTouched) {\n                cells[index] = this.cells[index];\n            }\n        });\n        this.drawCells(cells);\n        this.redrawBounds = undefined;\n    }\n\n    private getTouchedCells (bounds: IBounds): boolean[] {\n        const touchedCells = this.cells.map(() => false);\n        const cellsW = this.getCellsWidth();\n        bounds = {\n            x1: Math.floor(bounds.x1 / cellSize),\n            y1: Math.floor(bounds.y1 / cellSize),\n            x2: Math.floor(bounds.x2 / cellSize),\n            y2: Math.floor(bounds.y2 / cellSize),\n        };\n        for (let i = bounds.x1; i <= bounds.x2; i++) {\n            for (let e = bounds.y1; e <= bounds.y2; e++) {\n                touchedCells[e * cellsW + i] = true;\n            }\n        }\n        return touchedCells;\n    }\n\n    /**\n     * Slice up bounds according to cells\n     * @param bounds\n     * @private\n     */\n    private sliceBounds (bounds: IBounds): {index: number; bounds: IBounds}[] {\n        const cellsW = this.getCellsWidth();\n        const result: {index: number; bounds: IBounds}[] = [];\n        const touchedCells = this.getTouchedCells(bounds);\n\n        touchedCells.forEach((cell, i) => {\n            if (!cell) {\n                return;\n            }\n\n            const cellOffsetX = (i % cellsW) * cellSize;\n            const cellOffsetY = Math.floor(i / cellsW) * cellSize;\n            const cellWidth = this.cells[i]!.width;\n            const cellHeight = this.cells[i]!.height;\n\n            const inCellBounds = {\n                x1: Math.max(0, bounds.x1 - cellOffsetX),\n                y1: Math.max(0, bounds.y1 - cellOffsetY),\n                x2: Math.min(cellWidth - 1, bounds.x2 - cellOffsetX),\n                y2: Math.min(cellHeight - 1, bounds.y2 - cellOffsetY),\n            };\n            if (inCellBounds.x1 > inCellBounds.x2 || inCellBounds.y1 > inCellBounds.y2) {\n                return;\n            }\n            result.push({\n                index: i,\n                bounds: inCellBounds,\n            });\n        });\n\n        return result;\n    }\n\n    /**\n     * update copyImageData. copy over new regions if needed\n     */\n    private copyFromCanvas (bounds: IBounds | undefined): void {\n        if (!bounds) {\n            return;\n        }\n\n        const touchedCells = this.getTouchedCells(bounds);\n        const cellsW = this.getCellsWidth();\n\n        touchedCells.forEach((item, i) => {\n            if (!item || this.cells[i]) {\n                // not touched, or already copied\n                return;\n            }\n            const x = i % cellsW;\n            const y = Math.floor(i / cellsW);\n            const w = (Math.min(x * cellSize + cellSize, this.context.canvas.width) - 1) % cellSize + 1;\n            const h = (Math.min(y * cellSize + cellSize, this.context.canvas.height) - 1) % cellSize + 1;\n\n            // temp canvas to prevent main canvas from getting slowed down in chrome\n            const tmpCanvas = BB.canvas(w, h);\n            const tmpCtx = BB.ctx(tmpCanvas);\n            tmpCtx.drawImage(this.context.canvas, -x * cellSize, -y * cellSize);\n\n            this.cells[i] = tmpCtx.getImageData(0, 0, w, h);\n        });\n    }\n\n    private getAverage (x: number, y: number, size: number): IRGBA {\n\n        size = Math.max(0.5, size * 0.75);\n        const x1 = Math.max(0, Math.floor(x - size));\n        const y1 = Math.max(0, Math.floor(y - size));\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\n        if (x1 > x2 || y1 > y2) {\n            return {\n                r: 0,\n                g: 0,\n                b: 0,\n                a: 0,\n            };\n        }\n\n        let ar = 0, ag = 0, ab = 0, aa = 0, alpha;\n\n        const slicedBounds = this.sliceBounds({ x1, y1, x2, y2 });\n        slicedBounds.forEach(slice => {\n            const width = this.cells[slice.index]!.width;\n            const data = this.cells[slice.index]!.data;\n            const bounds = slice.bounds;\n\n            for (let i = bounds.y1; i <= bounds.y2; i += 4) {\n                for (let e = bounds.x1, e2 = i * width * 4 + bounds.x1 * 4; e <= bounds.x2; e += 4, e2 += 4 * 4) {\n                    alpha = data[e2 + 3];\n                    ar += data[e2] * alpha;\n                    ag += data[e2 + 1] * alpha;\n                    ab += data[e2 + 2] * alpha;\n                    aa += alpha;\n                }\n            }\n        });\n\n        if (aa !== 0) {\n            ar /= aa;\n            ag /= aa;\n            ab /= aa;\n            aa = Math.min(1, aa);\n        }\n        return {\n            r: ar,\n            g: ag,\n            b: ab,\n            a: aa,\n        };\n    }\n\n    private prepDot (x: number, y: number, size: number): IBounds | undefined {\n        size = Math.max(0.5, size);\n        const x1 = Math.max(0, Math.floor(x - size));\n        const y1 = Math.max(0, Math.floor(y - size));\n        const x2 = Math.min(this.context.canvas.width - 1, Math.ceil(x + size));\n        const y2 = Math.min(this.context.canvas.height - 1, Math.ceil(y + size));\n        if (x1 > x2 || y1 > y2) {\n            return undefined;\n        }\n        return { x1, y1, x2, y2 };\n    }\n\n    private drawDot (params: IDrawBufferItem): void {\n        // array with random numbers. faster than Math.random()\n        let randI = 0;\n        const randLen = params.size > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\n        const randArr: number[] = [];\n        for (let i = 0; i < randLen; i++) {\n            randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\n        }\n\n        // thin lines take more than just 1 sample\n        const sampleArr = [8,4,4,4,2,2,2,2,2,2]; // <0.5, 0.5, 1, 1.5, etc.\n        const samples = sampleArr[Math.floor(params.size * 2)];\n        const samplesSquared: number = samples ? samples * samples : 0;\n        const sampleOffsets: number[] = [];\n        if (samples) {\n            let i = 0;\n            for (let n = 0; n < samples; n++) {\n                for (let m = 0; m < samples; m++, i += 2) {\n                    sampleOffsets[i] = (n + 1) / samples; // x offset\n                    sampleOffsets[i + 1] = (m + 1) / samples; // y offset\n                }\n            }\n        }\n\n        const sharpness = Math.pow(params.opacity, 2) * 0.8;\n        // to optimize calculations\n        const invSharpness = 1 - sharpness;\n        const sharpnessSubtrahend = sharpness / invSharpness;\n        const sizeSquared = params.size * params.size;\n        const distDivisor = sizeSquared * invSharpness / params.opacity;\n        const alphaMinuend = (1 + sharpnessSubtrahend) * params.opacity;\n\n\n        const slicedBounds = this.sliceBounds({\n            x1: params.x1,\n            y1: params.y1,\n            x2: params.x2,\n            y2: params.y2,\n        });\n\n        const cellsW = this.getCellsWidth();\n        slicedBounds.forEach(slice => {\n            const cellOffsetX = (slice.index % cellsW) * cellSize;\n            const cellOffsetY = Math.floor(slice.index / cellsW) * cellSize;\n            const cellWidth = this.cells[slice.index]!.width;\n            const data = this.cells[slice.index]!.data;\n\n            // i - y index within cell\n            // e - x index within cell\n\n            // e2 - index in image data\n\n            // ri - y index within image relative to dot-center\n            // re - x index within image relative to dot-center\n\n            for (let i = slice.bounds.y1, ri = i + cellOffsetY - params.y; i <= slice.bounds.y2; i++, ri++) {\n                for (\n                    let e = slice.bounds.x1,\n                        e2 = i * cellWidth * 4 + slice.bounds.x1 * 4,\n                        re = e + cellOffsetX - params.x;\n                    e <= slice.bounds.x2;\n                    e++,\n                        e2 += 4,\n                        re++\n                ) {\n                    // O = over -> brush-dot\n                    // U = under -> image\n\n                    let alphaO = 0;\n                    if (samplesSquared) {\n                        for (let f = 0; f < sampleOffsets.length; f += 2) {\n                            const dist = BB.lenSquared(re + sampleOffsets[f], ri + sampleOffsets[f + 1]);\n                            if (dist >= sizeSquared) {\n                                continue;\n                            }\n                            alphaO += clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\n                        }\n                        if (!alphaO) {\n                            continue;\n                        }\n                        alphaO /= samplesSquared;\n                    } else {\n                        // technically needs + 0.5 offset, but not noticeable with large brush\n                        const dist = Math.pow(re, 2) + Math.pow(ri, 2);\n                        if (dist >= sizeSquared) {\n                            continue;\n                        }\n                        alphaO = clamp(alphaMinuend - dist / distDivisor, 0, params.opacity);\n                    }\n\n                    const invAlphaO = 1 - alphaO;\n                    const alphaU =data[e2 + 3] / 255;\n\n                    if (this.settingLockLayerAlpha) {\n                        const underR = (params.r * alphaO) + ((data[e2]) * invAlphaO);\n                        const underG = (params.g * alphaO) + ((data[e2 + 1]) * invAlphaO);\n                        const underB = (params.b * alphaO) + ((data[e2 + 2]) * invAlphaO);\n                        if (alphaU) {\n                            data[e2] = Math.floor(underR + randArr[randI]);\n                            data[e2 + 1] = Math.floor(underG + randArr[randI]);\n                            data[e2 + 2] = Math.floor(underB + randArr[randI]);\n                        }\n                    } else {\n                        const underR = (params.r * alphaO) + ((data[e2] * alphaU) * invAlphaO);\n                        const underG = (params.g * alphaO) + ((data[e2 + 1] * alphaU) * invAlphaO);\n                        const underB = (params.b * alphaO) + ((data[e2 + 2] * alphaU) * invAlphaO);\n\n                        const newAlpha = 1 - invAlphaO * (1 - alphaU);\n                        data[e2 + 3] = Math.floor(Math.min(255, newAlpha * 255) + 0.5);\n                        if (newAlpha) {\n                            data[e2] = Math.floor(underR / (newAlpha) + randArr[randI]);\n                            data[e2 + 1] = Math.floor(underG / (newAlpha) + randArr[randI]);\n                            data[e2 + 2] = Math.floor(underB / (newAlpha) + randArr[randI]);\n                        }\n                    }\n                    randI = (randI + 1) % randLen;\n\n                }\n            }\n\n        });\n    }\n\n    private calcSpacing (size: number): number {\n        return BB.mix(\n            (size * 2) / 2, // until size 5.3\n            (size * 2) / 9, // at size 24\n            clamp((size - 2.7) / (12 - 2.7), 0, 1)\n        );\n    }\n\n    private continueLine (x: number | undefined, y: number | undefined, p: number, isCoalesced: boolean): void {\n\n        this.drawBuffer = [];\n\n        let localPressure;\n        let localOpacity;\n        let localSize = (this.settingSizePressure) ? Math.max(1, p * this.size) : Math.max(1, this.size);\n\n        const bDist = this.calcSpacing(localSize);\n\n        const avgX = (x === undefined) ? this.lastInput.x : x;\n        const avgY = (y === undefined) ? this.lastInput.y : y;\n\n        let localColNew: IRGBA;\n\n        if (this.blending === 0) {\n            this.mixCol.r = this.color.r;\n            this.mixCol.g = this.color.g;\n            this.mixCol.b = this.color.b;\n        } else {\n            let average;\n            if (isCoalesced) {\n                average = {r: this.localColOld.r, g: this.localColOld.g, b: this.localColOld.b, a: 0};\n            } else {\n                const avgParams = [avgX, avgY, ((this.settingSizePressure) ? Math.max(0.5, p * this.size) : Math.max(0.5, this.size))];\n                const bounds = this.prepDot(avgParams[0], avgParams[1], avgParams[2]);\n                if (bounds) {\n                    this.copyFromCanvas(bounds);\n                }\n                average = this.getAverage(avgParams[0], avgParams[1], avgParams[2]);\n            }\n            localColNew = {r: 0, g: 0, b: 0, a: 0};\n\n            if (average.a > 0 && this.blendCol.a === 0) {\n                this.blendCol.r = average.r;\n                this.blendCol.g = average.g;\n                this.blendCol.b = average.b;\n                this.blendCol.a = average.a;\n                localColNew.r = this.blendCol.r;\n                localColNew.g = this.blendCol.g;\n                localColNew.b = this.blendCol.b;\n                localColNew.a = this.blendCol.a;\n\n            } else {\n                if (average.a === 0) {\n                    average.r = this.color.r;\n                    average.g = this.color.g;\n                    average.b = this.color.b;\n                    average.a = 1 - this.blending;\n                }\n\n                this.blendCol.r = BB.mix(this.blendCol.r, BB.mix(this.blendCol.r, average.r, this.blendMix), average.a);\n                this.blendCol.g = BB.mix(this.blendCol.g, BB.mix(this.blendCol.g, average.g, this.blendMix), average.a);\n                this.blendCol.b = BB.mix(this.blendCol.b, BB.mix(this.blendCol.b, average.b, this.blendMix), average.a);\n                this.blendCol.a = Math.min(1, this.blendCol.a + average.a);\n                localColNew.r = this.blendCol.r;\n                localColNew.g = this.blendCol.g;\n                localColNew.b = this.blendCol.b;\n                localColNew.a = this.blendCol.a;\n            }\n\n        }\n\n\n        const bezierCallback: TBezierLineCallback  = (val) => {\n            if (this.blending >= 1 && this.blendCol.a <= 0) {\n                return;\n            }\n            const factor = val.t;\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\n            localOpacity = (this.settingOpacityPressure) ? (this.opacity * localPressure * localPressure) : this.opacity;\n            localSize = (this.settingSizePressure) ? Math.max(0.1, localPressure * this.size) : Math.max(0.1, this.size);\n            if (this.blending != 0) {\n                this.mixCol.r = BB.mix(this.localColOld.r, localColNew.r, factor);\n                this.mixCol.g = BB.mix(this.localColOld.g, localColNew.g, factor);\n                this.mixCol.b = BB.mix(this.localColOld.b, localColNew.b, factor);\n            }\n            if (this.blending === 1 && this.localColOld.a === 0) {\n                this.mixCol.r = localColNew.r;\n                this.mixCol.g = localColNew.g;\n                this.mixCol.b = localColNew.b;\n            }\n            const bounds = this.prepDot(val.x, val.y, localSize);\n            if (bounds) {\n                this.updateRedrawBounds(bounds);\n                this.drawBuffer.push({\n                    x: val.x,\n                    y: val.y,\n                    size: localSize,\n                    opacity: localOpacity,\n                    x1: bounds.x1,\n                    y1: bounds.y1,\n                    x2: bounds.x2,\n                    y2: bounds.y2,\n                    r: BB.mix(this.color.r, this.mixCol.r, this.blending),\n                    g: BB.mix(this.color.g, this.mixCol.g, this.blending),\n                    b: BB.mix(this.color.b, this.mixCol.b, this.blending),\n                });\n            }\n        };\n\n        if (x === undefined || y === undefined) {\n            this.bezierLine!.addFinal(bDist, bezierCallback);\n        } else {\n            this.bezierLine!.add(x, y, bDist, bezierCallback);\n        }\n\n        this.copyFromCanvas(this.redrawBounds);\n        this.drawBuffer.forEach(item => {\n            this.drawDot(item);\n        });\n        this.drawBuffer = [];\n\n        this.localColOld = localColNew!;\n    }\n\n\n\n\n\n    // --- public ----\n    constructor () {\n    }\n\n    setHistory (h: KlHistoryInterface): void {\n        this.history = h;\n    }\n\n    getSize (): number {\n        return this.size;\n    }\n\n    setSize (s: number): void {\n        this.size = s;\n    }\n\n    getOpacity (): number {\n        return this.opacity;\n    }\n\n    setOpacity (o: number): void {\n        this.opacity = o;\n    }\n\n    getBlending (): number {\n        return this.blending;\n    }\n\n    setBlending (b: number): void {\n        this.blending = b;\n    }\n\n    setColor (c: IRGB): void {\n        this.color = BB.copyObj(c);\n    }\n\n    setContext (c: CanvasRenderingContext2D): void {\n        this.context = c;\n    }\n\n    setSizePressure (b: boolean): void {\n        this.settingSizePressure = b;\n    }\n\n    setOpacityPressure (b: boolean): void {\n        this.settingOpacityPressure = b;\n    }\n\n    getLockAlpha (): boolean {\n        return this.settingLockLayerAlpha;\n    }\n\n    setLockAlpha (b: boolean): void {\n        this.settingLockLayerAlpha = b;\n    }\n\n    getIsDrawing (): boolean {\n        return this.isDrawing;\n    }\n\n    setIsTesting (b: boolean): void {\n        this.isTesting = b;\n    }\n\n    startLine (x: number, y: number, p: number): void {\n        this.historyEntry = {\n            tool: ['brush', 'BlendBrush'],\n            actions: [],\n        };\n\n\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\n        this.cells = '0'.repeat(totalCells).split('').map(() => undefined);\n\n        this.isDrawing = true;\n\n        p = Math.max(0, Math.min(1, p));\n        const localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\n        const localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\n        if (this.blending === 0) {\n            this.mixCol.r = this.color.r;\n            this.mixCol.g = this.color.g;\n            this.mixCol.b = this.color.b;\n        } else {\n            this.copyFromCanvas(this.prepDot(x, y, localSize));\n\n            const average = this.getAverage(\n                x,\n                y,\n                ((this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size))\n            );\n            if (average.a === 0) {\n                this.blendCol = {\n                    r: this.color.r,\n                    g: this.color.g,\n                    b: this.color.b,\n                    a: 1 - this.blending,\n                };\n            } else {\n                this.blendCol = {\n                    r: average.r,\n                    g: average.g,\n                    b: average.b,\n                    a: average.a,\n                };\n            }\n\n            this.mixCol.r = this.blendCol.r;\n            this.mixCol.g = this.blendCol.g;\n            this.mixCol.b = this.blendCol.b;\n        }\n\n        this.localColOld = {r: this.mixCol.r, g: this.mixCol.g, b: this.mixCol.b, a: this.blendCol.a};\n\n        this.redrawBounds = undefined;\n        this.drawBuffer = [];\n\n        if (this.blending < 1 || this.blendCol.a > 0) {\n            const bounds = this.prepDot(x, y, localSize);\n            if (bounds) {\n                this.updateRedrawBounds(bounds);\n                this.drawBuffer.push({\n                    x: x,\n                    y: y,\n                    size: localSize,\n                    opacity: localOpacity,\n                    x1: bounds.x1,\n                    y1: bounds.y1,\n                    x2: bounds.x2,\n                    y2: bounds.y2,\n                    r: BB.mix(this.color.r, this.mixCol.r, this.blending),\n                    g: BB.mix(this.color.g, this.mixCol.g, this.blending),\n                    b: BB.mix(this.color.b, this.mixCol.b, this.blending),\n                });\n            }\n        }\n\n        this.copyFromCanvas(this.redrawBounds);\n        this.drawBuffer.forEach(item => {\n            this.drawDot(item);\n        });\n        this.drawBuffer = [];\n\n        this.bezierLine = new BB.BezierLine();\n        this.bezierLine.add(x, y, 0, function () {\n        });\n\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2 = BB.copyObj(this.lastInput);\n\n        if (!this.isTesting) {\n            this.drawChangedCells();\n        }\n    }\n\n    goLine (x: number, y: number, p: number, isCoalesced: boolean): void {\n        if (!this.isDrawing) {\n            return;\n        }\n        this.continueLine(x, y, this.lastInput.pressure, isCoalesced);\n\n        this.lastInput2 = BB.copyObj(this.lastInput);\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n\n        if (!this.isTesting) {\n            this.drawChangedCells();\n        }\n    }\n\n    endLine (): void {\n        if (this.bezierLine) {\n            this.continueLine(undefined, undefined, this.lastInput.pressure, false);\n        }\n\n        this.isDrawing = false;\n        this.bezierLine = undefined;\n\n\n        this.drawChangedCells();\n\n        if (this.historyEntry && this.history && this.cells.find(item => !!item)) {\n            this.historyEntry.actions.push({\n                action: 'drawCells',\n                params: [this.cells],\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n        this.cells = [];\n    }\n\n    /**\n     * draw cells onto context\n     * @param cells\n     */\n    drawCells (cells: (ImageData | undefined)[]): void {\n        const cellsW = this.getCellsWidth();\n        cells.forEach((imageData, index) => {\n            if (!imageData) {\n                return;\n            }\n            const cellOffsetX = (index % cellsW) * cellSize;\n            const cellOffsetY = Math.floor(index / cellsW) * cellSize;\n            this.context.putImageData(imageData, cellOffsetX, cellOffsetY);\n        });\n    }\n\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\n        this.lastInput.x = x2;\n        this.lastInput.y = y2;\n\n        if (this.isDrawing || x1 === undefined) {\n            return;\n        }\n\n        const totalCells = Math.ceil(this.context.canvas.width / cellSize) * Math.ceil(this.context.canvas.height / cellSize);\n        this.cells = '0'.repeat(totalCells).split('').map(() => undefined);\n        this.redrawBounds = undefined;\n        this.drawBuffer = [];\n\n        this.copyFromCanvas(this.prepDot(x1, y1, Math.max(0.1, this.size)));\n        const average = this.getAverage(x1, y1, Math.max(0.1, this.size));\n\n        if (average.a === 0) {\n            this.blendCol = {\n                r: this.color.r,\n                g: this.color.g,\n                b: this.color.b,\n                a: 1 - this.blending,\n            };\n        } else {\n            this.blendCol = {\n                r: average.r,\n                g: average.g,\n                b: average.b,\n                a: average.a,\n            };\n        }\n\n        this.mixCol.r = this.color.r * (1 - this.blendCol.a) + (this.blending * this.blendCol.r + this.color.r * (1 - this.blending)) * this.blendCol.a;\n        this.mixCol.g = this.color.g * (1 - this.blendCol.a) + (this.blending * this.blendCol.g + this.color.g * (1 - this.blending)) * this.blendCol.a;\n        this.mixCol.b = this.color.b * (1 - this.blendCol.a) + (this.blending * this.blendCol.b + this.color.b * (1 - this.blending)) * this.blendCol.a;\n\n\n        const p = 1;\n        const localOpacity = (this.settingOpacityPressure) ? (this.opacity * p * p) : this.opacity;\n        const localSize = (this.settingSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\n\n\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        const eX = (x2 - x1) / mouseDist;\n        const eY = (y2 - y1) / mouseDist;\n        const bDist = this.calcSpacing(localSize);\n        for (let loopDist = 0; loopDist <= mouseDist; loopDist += bDist) {\n            const bounds = this.prepDot(x1 + eX * loopDist, y1 + eY * loopDist, localSize);\n            if (bounds) {\n                this.copyFromCanvas(bounds);\n                this.drawBuffer.push({\n                    x: x1 + eX * loopDist,\n                    y: y1 + eY * loopDist,\n                    size: localSize,\n                    opacity: localOpacity,\n                    x1: bounds.x1,\n                    y1: bounds.y1,\n                    x2: bounds.x2,\n                    y2: bounds.y2,\n                    r: BB.mix(this.color.r, this.mixCol.r, this.blending),\n                    g: BB.mix(this.color.g, this.mixCol.g, this.blending),\n                    b: BB.mix(this.color.b, this.mixCol.b, this.blending),\n                });\n            }\n        }\n        this.drawBuffer.forEach(item => {\n            this.drawDot(item);\n        });\n        this.drawBuffer = [];\n\n        if (this.history && this.cells.find(item => !!item)) {\n            this.drawCells(this.cells);\n            this.historyEntry = {\n                tool: ['brush', 'BlendBrush'],\n                actions: [{\n                    action: 'drawCells',\n                    params: [this.cells],\n                }],\n            };\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n        this.cells = [];\n    }\n}\n","import {BB} from '../../bb/bb';\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\nimport {KL} from '../kl';\nimport {IRGB, TPressureInput} from '../kl-types';\n\nexport interface ISketchyBrushHistoryEntry extends IHistoryEntry {\n    tool: ['brush', 'SketchyBrush'];\n    actions: THistoryInnerActions<SketchyBrush>[];\n}\n\nconst sampleCanvas = BB.canvas(32, 32);\nconst sampleCtx = BB.ctx(sampleCanvas);\n\nexport class SketchyBrush {\n\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\n    private settingColor: IRGB = {} as IRGB;\n    private settingSize: number = 1;\n    private settingOpacity: number = 0.2;\n    private settingBlending: number = 0.5;\n    private settingScale: number = 1;\n    private lastX: number = 0;\n    private lastY: number = 0;\n    private inputIsDrawing: boolean = false;\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\n    private historyEntry: ISketchyBrushHistoryEntry | undefined;\n    private sketchySeed: number = 0;\n    private points: [number, number][] = []; // x y\n    private count: number = 0;\n    private readonly mixMode = [\n        (c1: IRGB): IRGB => {\n            return c1;\n        },\n        (c1: IRGB, c2: IRGB): IRGB => { // why\n            const result = new BB.RGB(c1.r, c1.g, c1.b);\n            result.r *= c2.r / 255;\n            result.g *= c2.g / 255;\n            result.b *= c2.b / 255;\n            return result;\n        },\n    ];\n\n\n    private rand (): number {\n        this.sketchySeed++;\n        return Math.sin(6324634.2345 * Math.cos(this.sketchySeed * 5342.3423)) * 0.5 + 0.5;\n    }\n\n    // ---- public ----\n    constructor () {}\n\n    // ---- interface ----\n\n    setHistory (l: KlHistoryInterface): void {\n        this.history = l;\n    }\n\n    setSeed (s: number): void {\n        this.sketchySeed = parseInt('' + s);\n    }\n\n    getSeed (): number {\n        return parseInt('' + this.sketchySeed);\n    }\n\n    getSize (): number {\n        return this.settingSize / 2;\n    }\n\n    setColor (c: IRGB): void {\n        this.settingColor = c;\n    }\n\n    getOpacity (): number {\n        return this.settingOpacity;\n    }\n\n    setOpacity (o: number): void {\n        this.settingOpacity = o;\n    }\n\n    getBlending (): number {\n        return this.settingBlending;\n    }\n\n    setBlending (b: number): void {\n        this.settingBlending = b;\n    }\n\n    setSize (s: number): void {\n        this.settingSize = s * 2;\n    }\n\n    getScale (): number {\n        return this.settingScale;\n    }\n\n    setScale (s: number): void {\n        this.settingScale = s;\n    }\n\n    setContext (c: CanvasRenderingContext2D): void {\n        this.context = c;\n    }\n\n    startLine (x: number, y: number, pressure: number, shift?: boolean): void {\n        if (shift && this.lastInput.x) {\n            this.inputIsDrawing = true;\n            this.endLine();\n        } else {\n            this.inputIsDrawing = true;\n            this.lastX = x;\n            this.lastY = y;\n            this.lastInput.x = x;\n            this.lastInput.y = y;\n            this.historyEntry = {\n                tool: ['brush', 'SketchyBrush'],\n                actions: [\n                    {\n                        action: 'setScale',\n                        params: [this.settingScale],\n                    },\n                    {\n                        action: 'setSize',\n                        params: [this.settingSize / 2],\n                    },\n                    {\n                        action: 'setOpacity',\n                        params: [this.settingOpacity],\n                    },\n                    {\n                        action: 'setColor',\n                        params: [this.settingColor],\n                    },\n                    {\n                        action: 'setBlending',\n                        params: [this.settingBlending],\n                    },\n                    {\n                        action: 'startLine',\n                        params: [x, y, pressure],\n                    },\n                ],\n            };\n        }\n\n    }\n\n    goLine (p_x: number, p_y: number, pressure: number, preMixedColor: IRGB | undefined): void {\n        if (!this.inputIsDrawing || (p_x === this.lastInput.x && p_y === this.lastInput.y)) {\n            return;\n        }\n\n        let e, b, a, g;\n        const x = parseInt('' + p_x);\n        const y = parseInt('' + p_y);\n        this.points.push([x, y]);\n\n        let mixr = this.settingColor.r;\n        let mixg = this.settingColor.g;\n        let mixb = this.settingColor.b;\n\n        if (preMixedColor) {\n            mixr = preMixedColor.r;\n            mixg = preMixedColor.g;\n            mixb = preMixedColor.b;\n        } else {\n            if (this.settingBlending !== 0) {\n                if (x + 5 >= 0 && y + 5 >= 0 && x - 5 < this.context.canvas.width - 1 && y - 5 < this.context.canvas.height - 1) {\n                    mixr = 0;\n                    mixg = 0;\n                    mixb = 0;\n                    const mixX = Math.min(this.context.canvas.width - 1, Math.max(0, x - 5));\n                    const mixY = Math.min(this.context.canvas.height - 1, Math.max(0, y - 5));\n                    let mixW = Math.min(this.context.canvas.width - 1, Math.max(0, x + 5));\n                    let mixH = Math.min(this.context.canvas.height - 1, Math.max(0, y + 5));\n                    mixW -= mixX;\n                    mixH -= mixY;\n\n                    if (mixW > 0 && mixH > 0) {\n                        const imDat = this.context.getImageData(mixX, mixY, mixW, mixH);\n                        let countMix = 0;\n                        for (let i = 0; i < imDat.data.length; i += 4) {\n                            mixr += imDat.data[i + 0];\n                            mixg += imDat.data[i + 1];\n                            mixb += imDat.data[i + 2];\n                            countMix++;\n                        }\n                        mixr /= countMix;\n                        mixg /= countMix;\n                        mixb /= countMix;\n                    }\n\n                    const mixed = this.mixMode[0](new BB.RGB(mixr, mixg, mixb), this.settingColor);\n                    mixr = parseInt('' + BB.mix(this.settingColor.r, mixed.r, this.settingBlending));\n                    mixg = parseInt('' + BB.mix(this.settingColor.g, mixed.g, this.settingBlending));\n                    mixb = parseInt('' + BB.mix(this.settingColor.b, mixed.b, this.settingBlending));\n                }\n            }\n        }\n\n        this.context.save();\n        this.context.strokeStyle = 'rgba(' + mixr + ', ' + mixg + ', ' + mixb + ', ' + this.settingOpacity + ')';\n        this.context.lineWidth = this.settingSize;\n\n        this.context.beginPath();\n        this.context.moveTo(this.lastX, this.lastY);\n        this.context.lineTo(x, y);\n\n        for (e = 0; e < this.points.length; e++) {\n            b = this.points[e][0] - this.points[this.count][0];\n            a = this.points[e][1] - this.points[this.count][1];\n            g = b * b + a * a;\n            if (g < 4000 * this.settingScale * this.settingScale && this.rand() > g / 2000 / this.settingScale / this.settingScale) {\n                this.context.moveTo(this.points[this.count][0] + (b * 0.3), this.points[this.count][1] + (a * 0.3));\n                this.context.lineTo(this.points[e][0] - (b * 0.3), this.points[e][1] - (a * 0.3));\n            }\n        }\n\n        this.context.stroke();\n        this.context.restore();\n\n\n        this.count++;\n        this.lastX = x;\n        this.lastY = y;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.historyEntry!.actions!.push({\n            action: 'goLine',\n            params: [p_x, p_y, pressure, {r: mixr, g: mixg, b: mixb}],\n        });\n    }\n\n    endLine (): void {\n        this.inputIsDrawing = false;\n        this.count = 0;\n        this.points = [];\n        if (this.historyEntry) {\n            this.historyEntry.actions!.push({\n                action: 'endLine',\n                params: [],\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n    }\n    //cheap 'n' ugly\n\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\n        this.lastInput.x = x2;\n        this.lastInput.y = y2;\n\n        if (this.inputIsDrawing || x1 === undefined) {\n            return;\n        }\n\n\n        this.context.save();\n        this.context.lineWidth = this.settingSize;\n\n        const mixCol = {\n            r: this.settingColor.r,\n            g: this.settingColor.g,\n            b: this.settingColor.b,\n        };\n        if (x1 + 5 >= 0 && y1 + 5 >= 0 && x1 - 5 < this.context.canvas.width - 1 && y1 - 5 < this.context.canvas.height - 1) {\n            mixCol.r = 0;\n            mixCol.g = 0;\n            mixCol.b = 0;\n            const mixX = Math.min(this.context.canvas.width - 1, Math.max(0, x1 - 5));\n            const mixY = Math.min(this.context.canvas.height - 1, Math.max(0, y1 - 5));\n            let mixW = Math.min(this.context.canvas.width - 1, Math.max(0, x1 + 5));\n            let mixH = Math.min(this.context.canvas.height - 1, Math.max(0, y1 + 5));\n            mixW -= mixX;\n            mixH -= mixY;\n            if (mixW > 0 && mixH > 0) {\n                const w = Math.min(sampleCanvas.width, mixW);\n                const h = Math.min(sampleCanvas.height, mixH);\n                sampleCtx.save();\n                sampleCtx.globalCompositeOperation = 'copy';\n                sampleCtx.drawImage(this.context.canvas, mixX, mixY, mixW, mixH, 0, 0, w, h);\n                sampleCtx.restore();\n\n                const imDat = sampleCtx.getImageData(mixX, mixY, mixW, mixH);\n                let countMix = 0;\n                for (let i = 0; i < imDat.data.length; i += 4) {\n                    mixCol.r += imDat.data[i + 0];\n                    mixCol.g += imDat.data[i + 1];\n                    mixCol.b += imDat.data[i + 2];\n                    countMix++;\n                }\n                mixCol.r /= countMix;\n                mixCol.g /= countMix;\n                mixCol.b /= countMix;\n            }\n        }\n        const mixed = this.mixMode[0](new BB.RGB(mixCol.r, mixCol.g, mixCol.b), this.settingColor);\n        mixCol.r = parseInt('' + (this.settingBlending * mixed.r + this.settingColor.r * (1 - this.settingBlending)));\n        mixCol.g = parseInt('' + (this.settingBlending * mixed.g + this.settingColor.g * (1 - this.settingBlending)));\n        mixCol.b = parseInt('' + (this.settingBlending * mixed.b + this.settingColor.b * (1 - this.settingBlending)));\n        this.context.strokeStyle = 'rgba(' + mixCol.r + ', ' + mixCol.g + ', ' + mixCol.b + ', ' + this.settingOpacity + ')';\n        this.context.beginPath();\n        this.context.moveTo(x1, y1);\n        this.context.lineTo(x2, y2);\n        this.context.stroke();\n        this.context.strokeStyle = 'rgba(' + mixCol.r + ', ' + mixCol.g + ', ' + mixCol.b + ', ' + this.settingOpacity + ')';\n        this.context.restore();\n\n        const historyEntry: ISketchyBrushHistoryEntry = {\n            tool: ['brush', 'SketchyBrush'],\n            actions: [\n                {\n                    action: 'setScale',\n                    params: [this.settingScale],\n                },\n                {\n                    action: 'setSize',\n                    params: [this.settingSize / 2],\n                },\n                {\n                    action: 'setOpacity',\n                    params: [this.settingOpacity],\n                },\n                {\n                    action: 'setColor',\n                    params: [this.settingColor],\n                },\n                {\n                    action: 'setBlending',\n                    params: [this.settingBlending],\n                },\n                {\n                    action: 'drawLineSegment',\n                    params: [x1, y1, x2, y2],\n                },\n            ],\n        };\n        this.history.push(historyEntry);\n    }\n\n\n    isDrawing (): boolean {\n        return this.inputIsDrawing;\n    }\n}\n","import {BB} from '../../bb/bb';\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\nimport {KL} from '../kl';\nimport {IRGB, TPressureInput} from '../kl-types';\nimport {IVector2D} from '../../bb/bb-types';\nimport {BezierLine} from '../../bb/math/line';\nimport {ERASE_COLOR} from './erase-color';\nimport {throwIfNull} from '../../bb/base/base';\n\nexport interface IPixelBrushHistoryEntry extends IHistoryEntry {\n    tool: ['brush', 'PixelBrush'];\n    actions: THistoryInnerActions<PixelBrush>[];\n}\n\n\nexport class PixelBrush {\n\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\n    private historyEntry: IPixelBrushHistoryEntry | undefined;\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\n    private settingHasSizePressure: boolean = true;\n    private settingHasOpacityPressure: boolean = false;\n    private settingSize: number = 0.5;\n    private settingSpacing: number = 0.9;\n    private settingOpacity: number = 1;\n    private settingColor: IRGB = {} as IRGB;\n    private settingColorStr: string = '';\n    private settingLockLayerAlpha: boolean = false;\n    private settingIsEraser: boolean = false;\n    private settingUseDither: boolean = true;\n    private inputIsDrawing: boolean = false;\n    private lineToolLastDot: number = 0;\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\n    private lastInput2: TPressureInput = {x: 0, y: 0, pressure: 0};\n    private bezierLine: BezierLine | null = null;\n    private readonly ditherArr: [number, number][] = [\n        [3, 2],\n        [1, 0],\n        [3, 0],\n        [1, 2],\n        [2, 1],\n        [0, 3],\n        [0, 1],\n        [2, 3],\n\n        [2, 0],\n        [0, 2],\n        [0, 0],\n        [2, 2],\n        [1, 1],\n        [3, 3],\n        [3, 1],\n        [1, 3],\n    ];\n    private readonly ditherCanvas: HTMLCanvasElement;\n    private readonly ditherCtx: CanvasRenderingContext2D;\n    private ditherPattern: CanvasPattern = {} as CanvasPattern;\n\n\n    private updateDither (): void {\n        this.ditherCtx.clearRect(0, 0, 4, 4);\n        this.ditherCtx.fillStyle = this.settingIsEraser ? `rgb(${ERASE_COLOR},${ERASE_COLOR},${ERASE_COLOR})` : this.settingColorStr;\n        for (let i = 0; i < Math.max(1, Math.round(this.settingOpacity * this.ditherArr.length)); i++) {\n            this.ditherCtx.fillRect(this.ditherArr[i][0], this.ditherArr[i][1], 1, 1);\n        }\n        this.ditherPattern = throwIfNull(this.context.createPattern(this.ditherCanvas, 'repeat'));\n    }\n\n    /**\n     * Tests p1->p2 or p3->p4 deviate in their direction more than max, compared to p1->p4\n     */\n    private cubicCurveOverThreshold (p1: IVector2D, p2: IVector2D, p3: IVector2D, p4: IVector2D, maxAngleRad: number): boolean {\n        const d = BB.Vec2.nor({\n            x: p4.x - p1.x,\n            y: p4.y - p1.y,\n        });\n        const d2 = BB.Vec2.nor({\n            x: p2.x - p1.x,\n            y: p2.y - p1.y,\n        });\n        const d3 = BB.Vec2.nor({\n            x: p4.x - p3.x,\n            y: p4.y - p3.y,\n        });\n        // const a2 = Math.abs(BB.Vec2.angle(d, d2) % Math.PI) / Math.PI * 180;\n        // const a3 = Math.abs(BB.Vec2.angle(d, d3) % Math.PI) / Math.PI * 180;\n\n        return Math.max(BB.Vec2.dist(d, d2), BB.Vec2.dist(d, d3)) > maxAngleRad;\n    }\n\n    private plotCubicBezierLine (p1: IVector2D, p2: IVector2D, p3: IVector2D, p4: IVector2D): void {\n\n        const isOverThreshold = this.cubicCurveOverThreshold(p1, p2, p3, p4, 0.1);\n\n        p1.x = Math.floor(p1.x);\n        p1.y = Math.floor(p1.y);\n        p4.x = Math.floor(p4.x);\n        p4.y = Math.floor(p4.y);\n\n        const dist = BB.dist(p1.x, p1.y, p4.x, p4.y);\n        if (!isOverThreshold || dist < 7) {\n            this.plotLine(p1.x, p1.y, p4.x, p4.y, true);\n            return;\n        }\n\n        const n = Math.max(2, Math.round(dist / 4));\n        const pointArr = [];\n        for (let i = 0; i <= n; i++) {\n            const t = i / n;\n            const a = Math.pow(1 - t, 3);\n            const b = 3 * t * Math.pow(1 - t, 2);\n            const c = 3 * Math.pow(t, 2) * (1 - t);\n            const d = Math.pow(t, 3);\n            pointArr.push({\n                x: a * p1.x + b * p2.x + c * p3.x + d * p4.x,\n                y: a * p1.y + b * p2.y + c * p3.y + d * p4.y,\n            });\n        }\n\n        for (let i = 0; i < n; i++) {\n            this.plotLine(\n                Math.round(pointArr[i].x),\n                Math.round(pointArr[i].y),\n                Math.round(pointArr[i + 1].x),\n                Math.round(pointArr[i + 1].y),\n                true\n            );\n        }\n    }\n\n    private drawDot (x: number, y: number, size: number, opacity: number): void {\n        this.context.save();\n        if (this.settingIsEraser) {\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : '#fff';\n            if (this.settingLockLayerAlpha) {\n                this.context.globalCompositeOperation = 'source-atop';\n            } else {\n                this.context.globalCompositeOperation = 'destination-out';\n            }\n        } else {\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : this.settingColorStr;\n            if (this.settingLockLayerAlpha) {\n                this.context.globalCompositeOperation = 'source-atop';\n            }\n        }\n        this.context.globalAlpha = this.settingUseDither ? 1 : opacity;\n        this.context.fillRect(\n            Math.round(x + -size),\n            Math.round(y + -size),\n            Math.round(size * 2),\n            Math.round(size * 2)\n        );\n        this.context.restore();\n    }\n\n    private continueLine (\n        x: number | null,\n        y: number | null,\n        size: number,\n        pressure: number\n    ): void {\n        if (this.bezierLine === null) {\n            this.bezierLine = new BB.BezierLine();\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, () => {});\n        }\n\n        this.context.save();\n\n        const dotCallback = (\n            val: {\n                x: number;\n                y: number;\n                t: number;\n                angle?: number;\n                dAngle: number;\n            }\n        ): void => {\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\n            const localOpacity = this.settingOpacity * (this.settingHasOpacityPressure ? (localPressure * localPressure) : 1);\n            const localSize = Math.max(0.5, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\n            this.drawDot(val.x, val.y, localSize, localOpacity);\n        };\n\n        const controlCallback = (\n            controlObj: {\n                p1: IVector2D;\n                p2: IVector2D;\n                p3: IVector2D;\n                p4: IVector2D;\n            }\n        ): void => {\n            this.plotCubicBezierLine(controlObj.p1, controlObj.p2, controlObj.p3, controlObj.p4);\n        };\n\n        if (Math.round(this.settingSize * 2) === 1) {\n            if (x === null || y === null) {\n                this.bezierLine.addFinal(4, undefined, controlCallback);\n            } else {\n                this.bezierLine.add(x, y, 4, undefined, controlCallback);\n            }\n\n        } else {\n            const localSpacing = size * this.settingSpacing;\n\n            if (x === null || y === null) {\n                this.bezierLine.addFinal(localSpacing, dotCallback);\n            } else {\n                this.bezierLine.add(x, y, localSpacing, dotCallback);\n            }\n        }\n\n        this.context.restore();\n    }\n\n\n    /**\n     * bresenheim line drawing\n     */\n    private plotLine (x0: number, y0: number, x1: number, y1: number, skipFirst: boolean): void {\n        this.context.save();\n\n        if (this.settingIsEraser) {\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : '#fff';\n            if (this.settingLockLayerAlpha) {\n                this.context.globalCompositeOperation = 'source-atop';\n            } else {\n                this.context.globalCompositeOperation = 'destination-out';\n            }\n        } else {\n            this.context.fillStyle = this.settingUseDither ? this.ditherPattern : this.settingColorStr;\n            if (this.settingLockLayerAlpha) {\n                this.context.globalCompositeOperation = 'source-atop';\n            }\n        }\n        this.context.globalAlpha = this.settingUseDither ? 1 : this.settingOpacity;\n\n        x0 = Math.floor(x0);\n        y0 = Math.floor(y0);\n        x1 = Math.floor(x1);\n        y1 = Math.floor(y1);\n\n        const dX = Math.abs(x1 - x0);\n        const sX = x0 < x1 ? 1 : -1;\n        const dY = -Math.abs(y1 - y0);\n        const sY = y0 < y1 ? 1 : -1;\n        let err = dX + dY;\n        // eslint-disable-next-line no-constant-condition\n        while (true) {\n            if (skipFirst) {\n                skipFirst = false;\n            } else {\n                this.context.fillRect(x0, y0, 1, 1);\n            }\n            if (x0 === x1 && y0 === y1) {\n                break;\n            }\n            const e2 = 2 * err;\n            if (e2 >= dY) {\n                err += dY;\n                x0 += sX;\n            }\n            if (e2 <= dX) {\n                err += dX;\n                y0 += sY;\n            }\n        }\n\n        this.context.restore();\n    }\n\n\n\n    // ---- public ----\n    constructor () {\n        this.ditherCanvas = BB.canvas(4, 4);\n        this.ditherCtx = BB.ctx(this.ditherCanvas);\n    }\n\n    // ---- interface ----\n\n    startLine (x: number, y: number, p: number): void {\n        this.historyEntry = {\n            tool: ['brush', 'PixelBrush'],\n            actions: [\n                {\n                    action: 'sizePressure',\n                    params: [this.settingHasSizePressure],\n                },\n                {\n                    action: 'opacityPressure',\n                    params: [this.settingHasOpacityPressure],\n                },\n                {\n                    action: 'setSize',\n                    params: [this.settingSize],\n                },\n                {\n                    action: 'setSpacing',\n                    params: [this.settingSpacing],\n                },\n                {\n                    action: 'setOpacity',\n                    params: [this.settingOpacity],\n                },\n                {\n                    action: 'setColor',\n                    params: [this.settingColor],\n                },\n                {\n                    action: 'setLockAlpha',\n                    params: [this.settingLockLayerAlpha],\n                },\n                {\n                    action: 'setIsEraser',\n                    params: [this.settingIsEraser],\n                },\n                {\n                    action: 'setUseDither',\n                    params: [this.settingUseDither],\n                },\n            ],\n        };\n\n        if (this.settingUseDither) {\n            this.updateDither();\n        }\n\n        p = Math.max(0, Math.min(1, p));\n        const localOpacity = this.settingHasOpacityPressure ? (this.settingOpacity * p * p) : this.settingOpacity;\n        const localSize = this.settingHasSizePressure ? Math.max(0.5, p * this.settingSize) : Math.max(0.5, this.settingSize);\n\n        this.inputIsDrawing = true;\n        this.drawDot(x, y, localSize, localOpacity);\n        this.lineToolLastDot = localSize * this.settingSpacing;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2 = BB.copyObj(this.lastInput);\n\n        this.historyEntry.actions!.push({\n            action: 'startLine',\n            params: [x, y, p],\n        });\n    }\n\n    goLine (x: number, y: number, p: number): void {\n        if (!this.inputIsDrawing) {\n            return;\n        }\n        this.historyEntry!.actions!.push({\n            action: 'goLine',\n            params: [x, y, p],\n        });\n\n        //debug\n        //drawDot(x, y, 1, 0.5);\n\n        const pressure = BB.clamp(p, 0, 1);\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\n\n        this.lastInput2 = BB.copyObj(this.lastInput);\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = pressure;\n    }\n\n    endLine (x: number, y: number): void {\n\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n        this.continueLine(null, null, localSize, this.lastInput.pressure);\n\n        //debug\n        //drawDot(lastInput.x, lastInput.y, 3, 1);\n        //drawDot(x, y, 10, 0.1);\n\n        this.inputIsDrawing = false;\n\n        this.bezierLine = null;\n\n        if (this.historyEntry) {\n            this.historyEntry.actions!.push({\n                action: 'endLine',\n                params: [x, y],\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n    }\n\n    //cheap n' ugly\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\n        this.lastInput.x = x2;\n        this.lastInput.y = y2;\n        this.lastInput.pressure = 1;\n\n        if (this.inputIsDrawing || x1 === undefined) {\n            return;\n        }\n\n        if (this.settingUseDither) {\n            this.updateDither();\n        }\n\n        if (Math.round(this.settingSize * 2) === 1) {\n            this.plotLine(x1, y1, x2, y2, true);\n        } else {\n            // const angle = BB.pointsToAngleDeg({x: x1, y: y1}, {x: x2, y: y2});\n            const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n            const eX = (x2 - x1) / mouseDist;\n            const eY = (y2 - y1) / mouseDist;\n            let loopDist;\n            const bdist = this.settingSize * this.settingSpacing;\n            this.lineToolLastDot = this.settingSize * this.settingSpacing;\n            for (loopDist = this.lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\n                this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.settingSize, this.settingOpacity);\n            }\n        }\n\n        const historyEntry: IPixelBrushHistoryEntry = {\n            tool: ['brush', 'PixelBrush'],\n            actions: [\n                {\n                    action: 'sizePressure',\n                    params: [this.settingHasSizePressure],\n                },\n                {\n                    action: 'opacityPressure',\n                    params: [this.settingHasOpacityPressure],\n                },\n                {\n                    action: 'setSize',\n                    params: [this.settingSize],\n                },\n                {\n                    action: 'setSpacing',\n                    params: [this.settingSpacing],\n                },\n                {\n                    action: 'setOpacity',\n                    params: [this.settingOpacity],\n                },\n                {\n                    action: 'setColor',\n                    params: [this.settingColor],\n                },\n                {\n                    action: 'setLockAlpha',\n                    params: [this.settingLockLayerAlpha],\n                },\n                {\n                    action: 'setIsEraser',\n                    params: [this.settingIsEraser],\n                },\n                {\n                    action: 'setUseDither',\n                    params: [this.settingUseDither],\n                },\n                {\n                    action: 'drawLineSegment',\n                    params: [x1, y1, x2, y2],\n                },\n            ],\n        };\n        this.history.push(historyEntry);\n    }\n\n    //IS\n    isDrawing (): boolean {\n        return this.inputIsDrawing;\n    }\n\n    //SET\n    setColor (c: IRGB): void {\n        if (this.settingColor === c) {\n            return;\n        }\n        this.settingColor = c;\n        this.settingColorStr = 'rgb(' + this.settingColor.r + ',' + this.settingColor.g + ',' + this.settingColor.b + ')';\n    }\n\n    setContext (c: CanvasRenderingContext2D): void {\n        this.context = c;\n    }\n\n    setHistory (l: KlHistoryInterface): void {\n        this.history = l;\n    }\n\n    setSize (s: number): void {\n        this.settingSize = Math.round(s * 2) / 2;\n    }\n\n    setOpacity (o: number): void {\n        this.settingOpacity = o;\n    }\n\n    setSpacing (s: number): void {\n        this.settingSpacing = s;\n    }\n\n    sizePressure (b: boolean): void {\n        this.settingHasSizePressure = b;\n    }\n\n    opacityPressure (b: boolean): void {\n        this.settingHasOpacityPressure = b;\n    }\n\n    setLockAlpha (b: boolean): void {\n        this.settingLockLayerAlpha = b;\n    }\n\n    setIsEraser (b: boolean): void {\n        this.settingIsEraser = b;\n    }\n\n    setUseDither (b: boolean): void {\n        this.settingUseDither = b;\n    }\n\n    //GET\n    getSpacing (): number {\n        return this.settingSpacing;\n    }\n\n    getSize (): number {\n        return this.settingSize;\n    }\n\n    getOpacity (): number {\n        return this.settingOpacity;\n    }\n\n    getLockAlpha (): boolean {\n        return this.settingLockLayerAlpha;\n    }\n\n    getIsEraser (): boolean {\n        return this.settingIsEraser;\n    }\n\n    getUseDither (): boolean {\n        return this.settingUseDither;\n    }\n}\n","import {BB} from '../../bb/bb';\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\nimport {KL} from '../kl';\nimport {TPressureInput} from '../kl-types';\nimport {BezierLine} from '../../bb/math/line';\nimport {ERASE_COLOR} from './erase-color';\nimport {KlCanvasContext} from '../canvas/kl-canvas';\n\nexport interface IEraserBrushHistoryEntry extends IHistoryEntry {\n    tool: ['brush', 'EraserBrush'];\n    actions: THistoryInnerActions<EraserBrush>[];\n}\n\nexport class EraserBrush {\n\n    private size: number = 30;\n    private spacing: number = 0.4;\n    private opacity: number = 1;\n    private useSizePressure: boolean = true;\n    private useOpacityPressure: boolean = false;\n    private isTransparentBG: boolean = false;\n\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\n    private historyEntry: IEraserBrushHistoryEntry | undefined;\n    private isBaseLayer: boolean = false;\n    private context: KlCanvasContext = {} as KlCanvasContext;\n\n    private started: boolean = false;\n    private lastDot: number | undefined;\n    private lastInput: TPressureInput = {x: 0, y: 0, pressure: 0};\n    private lastInput2: TPressureInput = {x: 0, y: 0, pressure: 0};\n    private bezierLine: BezierLine | undefined;\n\n\n    private drawDot (x: number, y: number, size: number, opacity: number): void {\n        this.context.save();\n        if (this.isBaseLayer) {\n            if (this.isTransparentBG) {\n                this.context.globalCompositeOperation = 'destination-out';\n            } else {\n                this.context.globalCompositeOperation = 'source-atop';\n            }\n        } else {\n            this.context.globalCompositeOperation = 'destination-out';\n        }\n        const radgrad = this.context.createRadialGradient(size, size, 0, size, size, size);\n        let sharpness = Math.pow(opacity, 2);\n        sharpness = Math.max(0, Math.min((size - 1) / size, sharpness));\n        const oFac = Math.max(0, Math.min(1, opacity));\n        const localOpacity = 2 * oFac - oFac * oFac;\n        radgrad.addColorStop(sharpness, `rgba(${ERASE_COLOR}, ${ERASE_COLOR}, ${ERASE_COLOR}, ` + localOpacity + ')');\n        radgrad.addColorStop(1, `rgba(${ERASE_COLOR}, ${ERASE_COLOR}, ${ERASE_COLOR}, 0)`);\n        this.context.fillStyle = radgrad;\n        this.context.translate(x - size, y - size);\n        this.context.fillRect(0, 0, size * 2, size * 2);\n        this.context.restore();\n    }\n\n    private continueLine (x: number | undefined, y: number | undefined, p: number): void {\n        p = Math.max(0, Math.min(1, p));\n        let localPressure;\n        let localOpacity;\n        let localSize = (this.useSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\n\n        const bdist = Math.max(1, Math.max(0.5, 1 - this.opacity) * localSize * this.spacing);\n\n        const bezierCallback = (val: {\n            x: number;\n            y: number;\n            t: number;\n            angle?: number;\n            dAngle: number;\n        }): void => {\n            const factor = val.t;\n            localPressure = this.lastInput2.pressure * (1 - factor) + p * factor;\n            localOpacity = (this.useOpacityPressure) ? (this.opacity * localPressure * localPressure) : this.opacity;\n            localSize = (this.useSizePressure) ? Math.max(0.1, localPressure * this.size) : Math.max(0.1, this.size);\n\n            this.drawDot(val.x, val.y, localSize, localOpacity);\n        };\n\n        if (x === undefined || y === undefined) {\n            this.bezierLine!.addFinal(bdist, bezierCallback);\n        } else {\n            this.bezierLine!.add(x, y, bdist, bezierCallback);\n        }\n    }\n\n    // ---- public -----\n    constructor () {}\n\n    // ---- interface ----\n    startLine (x: number, y: number, p: number): void {\n        this.historyEntry = {\n            tool: ['brush', 'EraserBrush'],\n            actions: [\n                {\n                    action: 'opacityPressure',\n                    params: [this.useOpacityPressure],\n                },\n                {\n                    action: 'sizePressure',\n                    params: [this.useSizePressure],\n                },\n                {\n                    action: 'setSize',\n                    params: [this.size],\n                },\n                {\n                    action: 'setOpacity',\n                    params: [this.opacity],\n                },\n                {\n                    action: 'setTransparentBG',\n                    params: [this.isTransparentBG],\n                },\n                {\n                    action: 'startLine',\n                    params: [x, y, p],\n                },\n            ],\n        };\n\n        this.isBaseLayer = 0 === this.context.canvas.index;\n\n        p = Math.max(0, Math.min(1, p));\n        const localOpacity = (this.useOpacityPressure) ? (this.opacity * p * p) : this.opacity;\n        const localSize = (this.useSizePressure) ? Math.max(0.1, p * this.size) : Math.max(0.1, this.size);\n\n        this.started = true;\n        if (localSize > 1) {\n            this.drawDot(x, y, localSize, localOpacity);\n        }\n        this.lastDot = localSize * this.spacing;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2 = BB.copyObj(this.lastInput);\n\n        this.bezierLine = new BB.BezierLine();\n        this.bezierLine.add(x, y, 0, () => undefined);\n    }\n\n    goLine (x: number, y: number, p: number): void {\n        if (!this.started || !this.historyEntry) {\n            return;\n        }\n        this.historyEntry.actions?.push({\n            action: 'goLine',\n            params: [x, y, p],\n        });\n\n        this.continueLine(x, y, this.lastInput.pressure);\n\n        this.lastInput2 = BB.copyObj(this.lastInput);\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n    }\n\n    endLine (): void {\n\n        if (this.bezierLine) {\n            this.continueLine(undefined, undefined, this.lastInput.pressure);\n        }\n\n        this.started = false;\n        this.bezierLine = undefined;\n\n        if (this.historyEntry) {\n            this.historyEntry.actions?.push({\n                action: 'endLine',\n                params: [],\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n    }\n\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\n\n        this.isBaseLayer = 0 === this.context.canvas.index;\n\n        this.lastInput.x = x2;\n        this.lastInput.y = y2;\n\n        if (this.started || x1 === undefined) {\n            return;\n        }\n\n        const mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        const eX = (x2 - x1) / mouseDist;\n        const eY = (y2 - y1) / mouseDist;\n        let loopDist;\n        const bdist = Math.max(1, Math.max(0.5, 1 - this.opacity) * this.size * this.spacing);\n        this.lastDot = 0;\n        for (loopDist = this.lastDot; loopDist <= mouseDist; loopDist += bdist) {\n            this.drawDot(x1 + eX * loopDist, y1 + eY * loopDist, this.size, this.opacity);\n        }\n\n\n        const historyEntry: IEraserBrushHistoryEntry = {\n            tool: ['brush', 'EraserBrush'],\n            actions: [\n                {\n                    action: 'opacityPressure',\n                    params: [this.useOpacityPressure],\n                },\n                {\n                    action: 'sizePressure',\n                    params: [this.useSizePressure],\n                },\n                {\n                    action: 'setSize',\n                    params: [this.size],\n                },\n                {\n                    action: 'setOpacity',\n                    params: [this.opacity],\n                },\n                {\n                    action: 'setTransparentBG',\n                    params: [this.isTransparentBG],\n                },\n                {\n                    action: 'drawLineSegment',\n                    params: [x1, y1, x2, y2],\n                },\n            ],\n        };\n        this.history.push(historyEntry);\n    }\n\n    //IS\n    isDrawing (): boolean {\n        return this.started;\n    }\n\n    //SET\n    setContext (c: KlCanvasContext): void {\n        this.context = c;\n    }\n\n    setHistory (l: KlHistoryInterface): void {\n        this.history = l;\n    }\n\n    setSize (s: number): void {\n        this.size = s;\n    }\n\n    setOpacity (o: number): void {\n        this.opacity = o;\n    }\n\n    sizePressure (b: boolean): void {\n        this.useSizePressure = b;\n    }\n\n    opacityPressure (b: boolean): void {\n        this.useOpacityPressure = b;\n    }\n\n    setTransparentBG (b: boolean): void {\n        this.isTransparentBG = b;\n    }\n\n    //GET\n    getSize (): number {\n        return this.size;\n    }\n\n    getOpacity (): number {\n        return this.opacity;\n    }\n}\n","import {BB} from '../../bb/bb';\nimport {IBounds, IPressureInput, IVector2D} from '../../bb/bb-types';\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\nimport {KL} from '../kl';\nimport {IRGB} from '../kl-types';\nimport {clamp} from '../../bb/math/math';\nimport {BezierLine, TBezierLineCallback} from '../../bb/math/line';\n\nexport interface ISmudgeBrushHistoryEntry extends IHistoryEntry {\n    tool: ['brush', 'SmudgeBrush'];\n    actions: THistoryInnerActions<SmudgeBrush>[];\n}\n\n// let statCount = 1;\n// let statAcc = 0;\n// stats on win10, chrome, size 100, opacity 80, smudge()\n// unoptimized: 1 ms\n// minimal: 0.09 ms\n// minimal + circle: 0.5ms\n// minimal + circle + ix, iy: 0.23ms\n// unoptimized + ix, iy: 0.64 ms\n// unoptimized + ix, iy + sans rounding: 0.61 ms\n// ix, iy + sans rounding + sans random: 0.32ms\n// ix, iy + sans rounding + fast random: 0.46 ms\n// ix, iy + sans rounding + fast random + offset const: 0.48 ms\n\nconst CELL_SIZE = 256;\n\ninterface ISmudgeParams {\n    aP: IVector2D;\n    bP: IVector2D;\n    size: {\n        w: number;\n        h: number;\n    };\n    brush: {\n        center: IVector2D;\n        size: number;\n        opacity: number;\n        alphaLock: boolean;\n    };\n}\n\n\n/**\n * determine bounds of smudge\n * @param imWidth\n * @param imHeight\n * @param aP\n * @param bP\n * @param size\n */\nfunction prepSmudge (\n    imWidth: number,\n    imHeight: number,\n    aP: IVector2D, // top left of source, integers\n    bP: IVector2D, // top left of dest, integers\n    size: {w: number; h: number}, // size of both rectangles, integers\n): ({\n    aP: IVector2D;\n    bP: IVector2D;\n    size: {w: number; h: number};\n} | null) {\n\n    if (aP.x === bP.x && aP.y === bP.y) {\n        return null;\n    }\n\n    aP = BB.copyObj(aP);\n    bP = BB.copyObj(bP);\n    size = BB.copyObj(size);\n\n    // corner behavior\n    // cut down rectangles, if a or b go outside\n    // i.e. if user drags partially or fully outside the canvas\n    {\n        let top = 0;\n        let right = 0;\n        let bottom = 0;\n        let left = 0;\n\n        if (aP.x < 0) {\n            left = -aP.x;\n        }\n        if (aP.y < 0) {\n            top = -aP.y;\n        }\n        if (bP.x < 0) {\n            left = Math.max(left, -bP.x);\n        }\n        if (bP.y < 0) {\n            top = Math.max(top, -bP.y);\n        }\n        if (aP.x + size.w > imWidth) {\n            right = aP.x + size.w - imWidth;\n        }\n        if (aP.y + size.h > imHeight) {\n            bottom = aP.y + size.h - imHeight;\n        }\n        if (bP.x + size.w > imWidth) {\n            right = Math.max(right, bP.x + size.w - imWidth);\n        }\n        if (bP.y + size.h > imHeight) {\n            bottom = Math.max(bottom, bP.y + size.h - imHeight);\n        }\n\n        aP.x += left;\n        bP.x += left;\n        aP.y += top;\n        bP.y += top;\n\n        size.w = size.w - left - right;\n        size.h = size.h - top - bottom;\n        if (size.w <= 0 || size.h <= 0) {\n            return null;\n        }\n    }\n\n    return {\n        aP: {\n            x: aP.x,\n            y: aP.y,\n        },\n        bP: {\n            x: bP.x,\n            y: bP.y,\n        },\n        size: {\n            w: size.w,\n            h: size.h,\n        },\n    };\n}\n\n/**\n * Pixel operations that do the smudging via ImageData\n * @param imageData\n * @param p\n */\nfunction smudge (imageData: ImageData, p : ISmudgeParams): void {\n\n    p = BB.copyObj(p);\n\n    const cSize = p.brush.size;\n    const cX = p.brush.center.x;\n    const cY = p.brush.center.y;\n\n    /*if (statCount % 1000 === 0) {\n        console.log(statAcc / 1000);\n        statAcc = 0;\n    }\n    let start = performance.now();*/\n\n\n    // determine offset\n    const aIndex = p.aP.y * imageData.width + p.aP.x;\n    const bIndex = p.bP.y * imageData.width + p.bP.x;\n    const offset = (bIndex - aIndex) * 4;\n\n    // array with random numbers. faster than Math.random()\n    let randI = 0;\n    const randLen = cSize > 30 ? 1024 : 512; // lower lengths lead to noticeable patterns\n    const randArr: number[] = [];\n    for (let i = 0; i < randLen; i++) {\n        randArr[i] = (Math.random() - 0.5) / 1.001 + 0.5;\n    }\n\n    const softnessPx = Math.max(3, Math.min(8, p.brush.size - 8));\n\n    const pixel = (ai: number, bi: number, ix: number, iy: number): void => {\n\n        const dist = BB.dist(cX, cY, ix, iy);\n        const fac = 1 - p.brush.opacity * (1 - clamp((dist - (cSize - softnessPx)) / softnessPx, 0, 1));\n\n        if (fac === 1) {\n            return;\n        }\n\n        if (!imageData.data[ai + 3]) {\n            /* empty */\n        } else if (!imageData.data[bi + 3]) { // don't mix if target fully transparent. pixel might have a strange color.\n            imageData.data[bi] = imageData.data[ai];\n            imageData.data[bi + 1] = imageData.data[ai + 1];\n            imageData.data[bi + 2] = imageData.data[ai + 2];\n        } else {\n\n            // consider alpha ratio. If a has lower alpha than b, then b should be stronger, and vice versa\n            // not totally accurate. TODO same compositing as blend brush\n            let fac2;\n            if (imageData.data[ai + 3] < imageData.data[bi + 3]) {\n                fac2 = 1 - imageData.data[ai + 3] / imageData.data[bi + 3] * (1 - fac);\n            } else {\n                fac2 = imageData.data[bi + 3] / imageData.data[ai + 3] * fac;\n            }\n\n            // ImageData's Uint8ClampedArray rounds -> 0.5 becomes 1. But not in Safari, so needs to be done manually\n            // Offset mixed color by random number noise (-0.5, 0.5), so it doesn't get stuck while mixing.\n            // No +0.5, because it cancels out with rand.\n            imageData.data[bi] = Math.floor(BB.mix(imageData.data[ai], imageData.data[bi + 0], fac2) + randArr[randI]);\n            imageData.data[bi + 1] = Math.floor(BB.mix(imageData.data[ai + 1], imageData.data[bi + 1], fac2) + randArr[randI]);\n            imageData.data[bi + 2] = Math.floor(BB.mix(imageData.data[ai + 2], imageData.data[bi + 2], fac2) + randArr[randI]);\n\n            randI = (randI + 1) % randLen;\n        }\n        // Always mix alpha. unless alpha lock\n        if (!p.brush.alphaLock) {\n            imageData.data[bi + 3] = Math.floor(BB.mix(imageData.data[ai + 3], imageData.data[bi + 3], fac) + 0.5);\n        }\n\n    };\n\n    const bx1 = p.bP.x * 4;\n    const bx2 = bx1 + (p.size.w - 1) * 4;\n\n    // transfer of pixels depends on direction of smudging if there is overlap\n    if (p.aP.y < p.bP.y) {\n        for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\n            const yStart = (y + p.bP.y) * imageData.width * 4;\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\n                pixel(x2, x, ix, iy);\n            }\n        }\n    } else if (p.aP.y > p.bP.y) {\n        for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\n            const yStart = (y + p.bP.y) * imageData.width * 4;\n            for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\n                pixel(x2, x, ix, iy);\n            }\n        }\n    } else {\n        if (p.aP.x < p.bP.x) {\n            for (let y = p.size.h - 1, iy = p.bP.y + p.size.h - 1; y >= 0; y--, iy--) {\n                const yStart = (y + p.bP.y) * imageData.width * 4;\n                for (let x = bx2 + yStart, x2 = bx2 + yStart - offset, ix = p.bP.x + p.size.w - 1; x >= bx1 + yStart; x -= 4, x2 -= 4, ix--) {\n                    pixel(x2, x, ix, iy);\n                }\n            }\n        } else {\n            for (let y = 0, iy = p.bP.y; y < p.size.h; y++, iy++) {\n                const yStart = (y + p.bP.y) * imageData.width * 4;\n                for (let x = bx1 + yStart, x2 = bx1 + yStart - offset, ix = p.bP.x; x < bx2 + yStart; x += 4, x2 += 4, ix++) {\n                    pixel(x2, x, ix, iy);\n                }\n            }\n        }\n    }\n\n    //statCount++;\n    //statAcc += performance.now() - start;\n}\n\nexport class SmudgeBrush {\n\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\n    private historyEntry: ISmudgeBrushHistoryEntry | undefined;\n\n    private settingColor: IRGB = {r: 0, g: 0, b: 0};\n    private settingSize: number = 35;\n    private settingSpacing: number = 0.20446882736951905;\n    private settingOpacity: number = 0.8;\n    private settingHasSizePressure: boolean = false;\n    private settingHasOpacityPressure: boolean = false;\n    private settingLockLayerAlpha: boolean = false;\n\n    private lineToolLastDot: number = 0;\n    private lastInput: IPressureInput = {x: 0, y: 0, pressure: 0};\n    private lastInput2: IPressureInput = {x: 0, y: 0, pressure: 0};\n    private lastDot: IVector2D | undefined;\n\n    private isDrawing: boolean = false;\n\n    private bezierLine: BezierLine | undefined;\n\n    private redrawBounds: IBounds | undefined;\n    private completeRedrawBounds: IBounds | undefined;\n\n    private copyImageData: ImageData = {} as ImageData;\n\n    private drawBuffer: ISmudgeParams[] = [];\n\n    private copiedCells: boolean[] = [];\n\n    // workaround for https://github.com/microsoft/TypeScript/issues/41654\n    private resetRedrawBounds (): void {\n        this.redrawBounds = undefined;\n    }\n\n    private updateRedrawBounds (bounds: IBounds): void {\n        this.redrawBounds = BB.updateBounds(this.redrawBounds, bounds);\n    }\n\n    private updateCompleteRedrawBounds (x1: number, y1: number, x2: number, y2: number): void {\n        this.completeRedrawBounds = BB.updateBounds(\n            this.completeRedrawBounds,\n            { x1, y1, x2, y2 }\n        );\n    }\n\n    /**\n     * update copyImageData. copy over new regions if needed\n     */\n    copyFromCanvas (): void {\n\n        const touchedCells = this.copiedCells.map(() => false);\n\n        const bounds: IBounds[] = [];\n        const cellsW = Math.ceil(this.copyImageData.width / CELL_SIZE);\n\n        if (!this.redrawBounds) {\n            return;\n        }\n        bounds.push({\n            x1: Math.floor(this.redrawBounds.x1 / CELL_SIZE),\n            y1: Math.floor(this.redrawBounds.y1 / CELL_SIZE),\n            x2: Math.floor(this.redrawBounds.x2 / CELL_SIZE),\n            y2: Math.floor(this.redrawBounds.y2 / CELL_SIZE),\n        });\n        bounds.forEach(item => {\n            for (let i = item.x1; i <= item.x2; i++) {\n                for (let e = item.y1; e <= item.y2; e++) {\n                    touchedCells[e * cellsW + i] = true;\n                }\n            }\n        });\n\n        touchedCells.forEach((item, i) => {\n            if (!item || this.copiedCells[i]) {\n                // not touched, or already copied\n                return;\n            }\n            this.copiedCells[i] = true;\n            const x = i % cellsW;\n            const y = Math.floor(i / cellsW);\n            const w = (Math.min(x * CELL_SIZE + CELL_SIZE, this.copyImageData.width) - 1) % CELL_SIZE + 1;\n            const h = (Math.min(y * CELL_SIZE + CELL_SIZE, this.copyImageData.height) - 1) % CELL_SIZE + 1;\n\n            // temp canvas to prevent main canvas from getting slowed down in chrome\n            const tmpCanvas = BB.canvas(w, h);\n            const tmpCtx = BB.ctx(tmpCanvas);\n            tmpCtx.drawImage(this.context.canvas, -x * CELL_SIZE, -y * CELL_SIZE);\n\n            const data = tmpCtx.getImageData(0, 0, w, h);\n\n            for (let i = 0; i < h; i++) {\n                for (let e = 0, e2 = i * w * 4, e3 = ((y * CELL_SIZE + i) * this.copyImageData.width + x * CELL_SIZE) * 4; e < w; e++, e2 += 4, e3 += 4) {\n                    this.copyImageData.data[e3] = data.data[e2];\n                    this.copyImageData.data[e3 + 1] = data.data[e2 + 1];\n                    this.copyImageData.data[e3 + 2] = data.data[e2 + 2];\n                    this.copyImageData.data[e3 + 3] = data.data[e2 + 3];\n                }\n            }\n        });\n    }\n\n\n    /**\n     * fill drawBuffer with params about to be drawn\n     * @param x\n     * @param y\n     * @param size\n     * @param opacity\n     */\n    prepDot (x: number, y: number, size: number, opacity: number): void {\n        if (!this.lastDot) {\n            this.lastDot = {\n                x: x,\n                y: y,\n            };\n            return;\n        }\n\n        size = Math.round(size);\n\n\n        const w = Math.round(size * 2);\n        const h = Math.round(size * 2);\n\n        const bounds = prepSmudge(\n            this.copyImageData.width,\n            this.copyImageData.height,\n            {\n                x: Math.round(this.lastDot.x - size),\n                y: Math.round(this.lastDot.y - size),\n            },\n            {\n                x: Math.round(x - size),\n                y: Math.round(y - size),\n            },\n            {\n                w,\n                h,\n            },\n        );\n\n        if (bounds) {\n            const params: ISmudgeParams = {\n                aP: bounds.aP,\n                bP: bounds.bP,\n                size: bounds.size,\n                brush: {\n                    center: { x, y },\n                    size,\n                    opacity,\n                    alphaLock: this.settingLockLayerAlpha,\n                },\n            };\n            this.updateRedrawBounds({\n                x1: params.bP.x,\n                y1: params.bP.y,\n                x2: params.bP.x + params.brush.size * 2,\n                y2: params.bP.y + params.brush.size * 2,\n            });\n            this.drawBuffer.push(params);\n        }\n\n        this.lastDot = {\n            x: x,\n            y: y,\n        };\n    }\n\n    continueLine (x: number | undefined, y: number | undefined, size: number, pressure: number): void {\n        this.drawBuffer = [];\n\n        if (!this.bezierLine) {\n            this.bezierLine = new BB.BezierLine();\n            this.bezierLine.add(this.lastInput.x, this.lastInput.y, 0, function (){});\n        }\n\n        const drawArr: Parameters<typeof this.prepDot>[] = []; //draw instructions. will be all drawn at once\n\n        const dotCallback: TBezierLineCallback = (val): void => {\n            const localPressure = BB.mix(this.lastInput2.pressure, pressure, val.t);\n            const localOpacity = this.settingOpacity * (this.settingHasOpacityPressure ? (localPressure * localPressure) : 1);\n            const localSize = Math.max(0.1, this.settingSize * (this.settingHasSizePressure ? localPressure : 1));\n            drawArr.push([val.x, val.y, localSize, localOpacity]);//, val.angle]);\n        };\n\n        const localSpacing = size * this.settingSpacing / 3;\n        if (x === undefined || y === undefined) {\n            this.bezierLine.addFinal(localSpacing, dotCallback);\n        } else {\n            this.bezierLine.add(x, y, localSpacing, dotCallback);\n        }\n\n        // execute draw instructions\n        for (let i = 0; i < drawArr.length; i++) {\n            const item = drawArr[i];\n            this.prepDot(item[0], item[1], item[2], item[3]);\n        }\n\n        this.copyFromCanvas();\n\n        for (let i = 0; i < this.drawBuffer.length; i++) {\n            smudge(this.copyImageData, this.drawBuffer[i]);\n        }\n    }\n\n\n\n    // ---- public ----\n\n    constructor () { }\n\n    startLine (x: number, y: number, p: number): void {\n        this.historyEntry = {\n            tool: ['brush', 'SmudgeBrush'],\n            actions: [],\n        };\n\n        p = BB.clamp(p, 0, 1);\n        const localOpacity = this.settingHasOpacityPressure ? (this.settingOpacity * p * p) : this.settingOpacity;\n        const localSize = this.settingHasSizePressure ? Math.max(0.1, p * this.settingSize) : Math.max(0.1, this.settingSize);\n\n        this.lastDot = undefined;\n        this.isDrawing = true;\n\n        this.copyImageData = new ImageData(this.context.canvas.width, this.context.canvas.height);\n        const totalCells = Math.ceil(this.context.canvas.width / CELL_SIZE) * Math.ceil(this.context.canvas.height / CELL_SIZE);\n        this.copiedCells = '0'.repeat(totalCells).split('').map(() => false);\n\n        this.prepDot(x, y, localSize, localOpacity);\n\n        this.lineToolLastDot = localSize * this.settingSpacing;\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput.pressure = p;\n        this.lastInput2.pressure = p;\n\n        this.completeRedrawBounds = undefined;\n    }\n\n    goLine (x: number, y: number, p: number): void {\n        if (!this.isDrawing) {\n            return;\n        }\n\n        this.resetRedrawBounds();\n        const pressure = BB.clamp(p, 0, 1);\n        const localSize = this.settingHasSizePressure ?\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n\n        this.continueLine(x, y, localSize, this.lastInput.pressure);\n\n\n        if (this.redrawBounds) {\n            this.context.putImageData(\n                this.copyImageData,\n                0,\n                0,\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\n            );\n            this.updateCompleteRedrawBounds(\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2,\n                this.redrawBounds.y2\n            );\n        }\n\n        this.lastInput.x = x;\n        this.lastInput.y = y;\n        this.lastInput2.pressure = this.lastInput.pressure;\n        this.lastInput.pressure = pressure;\n    }\n\n    endLine (): void {\n        this.resetRedrawBounds();\n        const localSize = this.settingHasSizePressure ?\n            Math.max(0.1, this.lastInput.pressure * this.settingSize) : Math.max(0.1, this.settingSize);\n        this.context.save();\n        this.continueLine(undefined, undefined, localSize, this.lastInput.pressure);\n        this.context.restore();\n\n        this.isDrawing = false;\n        this.bezierLine = undefined;\n\n        if (this.redrawBounds) {\n            this.context.putImageData(\n                this.copyImageData,\n                0,\n                0,\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2 - this.redrawBounds.x1 - 1,\n                this.redrawBounds.y2 - this.redrawBounds.y1 - 1\n            );\n            this.updateCompleteRedrawBounds(\n                this.redrawBounds.x1,\n                this.redrawBounds.y1,\n                this.redrawBounds.x2,\n                this.redrawBounds.y2\n            );\n        }\n\n        if (this.historyEntry && this.completeRedrawBounds) {\n            let historyIm: ImageData | HTMLCanvasElement = this.copyImageData;\n            if (!(\n                this.completeRedrawBounds.x1 === 0 &&\n                this.completeRedrawBounds.y1 === 0 &&\n                this.completeRedrawBounds.x2 >= this.context.canvas.width - 1 &&\n                this.completeRedrawBounds.y2 >= this.context.canvas.height - 1\n            )) {\n\n                // temp canvas to prevent main canvas from getting slowed down in chrome\n                const tmpCanvas = BB.canvas(\n                    this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\n                    this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\n                );\n                const tmpCtx = BB.ctx(tmpCanvas);\n                tmpCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\n\n                historyIm = tmpCanvas; // faster than getting image data (measured on 2018 lenovo chromebook)\n            }\n            this.historyEntry.actions.push({\n                action: 'drawImage',\n                params: [\n                    historyIm,\n                    this.completeRedrawBounds.x1,\n                    this.completeRedrawBounds.y1,\n                ],\n            });\n            this.history.push(this.historyEntry);\n            this.historyEntry = undefined;\n        }\n        this.copyImageData = {} as ImageData;\n    }\n\n    drawImage (im: ImageData | HTMLCanvasElement, x: number, y: number): void {\n        if (im instanceof ImageData) {\n            this.context.putImageData(im, x, y);\n        } else {\n            this.context.clearRect(x, y, im.width, im.height);\n            this.context.drawImage(im, x, y);\n        }\n    }\n\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\n        return;\n        /*\n        // todo\n        lastInput.x = x2;\n        lastInput.y = y2;\n        lastInput.pressure = 1;\n\n        if (isDrawing || x1 === undefined) {\n            return;\n        }\n\n        let angle = BB.pointsToAngleDeg({x:x1, y:y1}, {x:x2, y:y2});\n        let mouseDist = Math.sqrt(Math.pow(x2 - x1, 2.0) + Math.pow(y2 - y1, 2.0));\n        let eX = (x2 - x1) / mouseDist;\n        let eY = (y2 - y1) / mouseDist;\n        let loopDist;\n        let bdist = settingSize * settingSpacing;\n        lineToolLastDot = settingSize * settingSpacing;\n        for (loopDist = lineToolLastDot; loopDist <= mouseDist; loopDist += bdist) {\n            drawDot(x1 + eX * loopDist, y1 + eY * loopDist, settingSize, settingOpacity);\n        }\n\n\n        let historyEntry = {\n            tool: [\"brush\", \"SmudgeBrush\"],\n            actions: []\n        };\n        // todo\n        history.add(historyEntry);*/\n    }\n\n    getIsDrawing (): boolean {\n        return this.isDrawing;\n    }\n\n    setColor (c: IRGB): void {\n        if (this.settingColor.r === c.r && this.settingColor.g === c.g && this.settingColor.b === c.b) {\n            return;\n        }\n        this.settingColor = {r: c.r, g: c.g, b: c.b};\n    }\n\n    setContext (c: CanvasRenderingContext2D): void {\n        this.context = c;\n    }\n\n    setHistory (h: KlHistoryInterface): void {\n        this.history = h;\n    }\n\n    setSize (s: number): void {\n        this.settingSize = s;\n    }\n\n    setOpacity (o: number): void {\n        this.settingOpacity = o;\n    }\n\n    setSpacing (s: number): void {\n        this.settingSpacing = s;\n    }\n\n    sizePressure (b: boolean): void {\n        this.settingHasSizePressure = b;\n    }\n\n    opacityPressure (b: boolean): void {\n        this.settingHasOpacityPressure = b;\n    }\n\n    setLockAlpha (b: boolean): void {\n        this.settingLockLayerAlpha = b;\n    }\n\n    getSpacing (): number {\n        return this.settingSpacing;\n    }\n\n    getSize (): number {\n        return this.settingSize;\n    }\n\n    getOpacity (): number {\n        return this.settingOpacity;\n    }\n\n    getLockAlpha (): boolean {\n        return this.settingLockLayerAlpha;\n    }\n\n}\n","import {BB} from '../../bb/bb';\nimport {IRGB} from '../kl-types';\nimport {IBounds} from '../../bb/bb-types';\nimport {IHistoryEntry, KlHistoryInterface, THistoryInnerActions} from '../history/kl-history';\nimport {ERASE_COLOR} from './erase-color';\nimport {KL} from '../kl';\n\nexport interface IChemyBrushHistoryEntry extends IHistoryEntry {\n    tool: ['brush', 'ChemyBrush'];\n    actions: THistoryInnerActions<ChemyBrush>[];\n}\n\ntype TChemyMode = 'fill' | 'stroke';\n\nexport class ChemyBrush {\n\n    private context: CanvasRenderingContext2D = {} as CanvasRenderingContext2D;\n    private settingColor: IRGB = {} as IRGB;\n    private settingSize: number = 0.25; // radius - 0.5 - 99999\n    private settingOpacity: number = 1; // 0-1\n    private settingLockLayerAlpha: boolean = false;\n    private settingIsEraser: boolean = false;\n    private settingMode: TChemyMode = 'fill';\n    private settingDistort: number = 0; // 0 - 1\n    private settingXSymmetry: boolean = false;\n    private settingYSymmetry: boolean = false;\n    private settingGradient: boolean = false;\n\n    private isDrawing: boolean = false;\n\n    private history: KlHistoryInterface = new KL.DecoyKlHistory();\n\n    private copyCanvas: HTMLCanvasElement = {} as HTMLCanvasElement;\n    private path: {x: number; y: number}[] = [];\n    private minY: number = 0;\n    private maxY: number = 0;\n    private completeRedrawBounds: IBounds | undefined;\n\n    private updateCompleteRedrawBounds (x: number, y: number): void {\n        let bounds = { x1: x, y1: y, x2: x, y2: y};\n        if (this.settingXSymmetry) {\n            bounds = BB.updateBounds(\n                bounds,\n                {\n                    x1: -x + this.copyCanvas.width,\n                    y1: y,\n                    x2: -x + this.copyCanvas.width,\n                    y2: y,\n                }\n            );\n        }\n        if (this.settingYSymmetry) {\n            bounds = BB.updateBounds(\n                bounds,\n                {\n                    x1: x,\n                    y1: -y + this.copyCanvas.height,\n                    x2: x,\n                    y2: -y + this.copyCanvas.height,\n                }\n            );\n        }\n        const buffer = this.settingMode === 'stroke' ? this.settingSize + 1 : 1;\n        bounds.x1 = Math.floor(bounds.x1 - buffer);\n        bounds.y1 = Math.floor(bounds.y1 - buffer);\n        bounds.x2 = Math.ceil(bounds.x2 + buffer);\n        bounds.y2 = Math.ceil(bounds.y2 + buffer);\n\n        this.completeRedrawBounds = BB.updateBounds(this.completeRedrawBounds, bounds);\n    }\n\n    private drawShape (): void {\n        this.context.save();\n        this.context.clearRect(0, 0, this.context.canvas.width, this.context.canvas.height);\n        this.context.drawImage(this.copyCanvas, 0, 0);\n\n        const color = {...this.settingColor};\n        if (this.settingIsEraser) {\n            color.r = ERASE_COLOR;\n            color.g = ERASE_COLOR;\n            color.b = ERASE_COLOR;\n            if (this.settingLockLayerAlpha) {\n                this.context.globalCompositeOperation = 'source-atop';\n            } else {\n                this.context.globalCompositeOperation = 'destination-out';\n            }\n        } else {\n            if (this.settingLockLayerAlpha) {\n                this.context.globalCompositeOperation = 'source-atop';\n            }\n        }\n\n        if (this.path.length > 1) {\n\n            // path\n            const path = new Path2D();\n            this.path.forEach((item, index) => {\n                if (index === 0) {\n                    path.moveTo(item.x, item.y);\n                } else {\n                    path.lineTo(item.x, item.y);\n                }\n            });\n\n            let style: string | CanvasGradient = BB.ColorConverter.toRgbaStr({\n                r: color.r,\n                g: color.g,\n                b: color.b,\n                a: this.settingOpacity,\n            });\n            if (this.settingGradient) {\n                const startAtTop = this.path[0].x > this.path[this.path.length - 1].x;\n                const gradient = this.context.createLinearGradient(\n                    0, startAtTop ? this.minY : this.maxY,\n                    0, startAtTop ? this.maxY : this.minY,\n                );\n                gradient.addColorStop(\n                    0,\n                    BB.ColorConverter.toRgbaStr({\n                        r: color.r,\n                        g: color.g,\n                        b: color.b,\n                        a: this.settingOpacity,\n                    })\n                );\n                gradient.addColorStop(\n                    1,\n                    BB.ColorConverter.toRgbaStr({\n                        r: color.r,\n                        g: color.g,\n                        b: color.b,\n                        a: 0,\n                    })\n                );\n                style = gradient;\n            }\n\n            // setup params\n            if (this.settingMode === 'fill') {\n                this.context.fillStyle = style;\n\n            } else {\n                this.context.lineWidth = this.settingSize * 2;\n                this.context.lineJoin = 'bevel';\n                this.context.strokeStyle = style;\n            }\n\n            // draw\n            const draw = () => {\n                if (this.settingMode === 'fill') {\n                    this.context.fill(path);\n                } else {\n                    this.context.stroke(path);\n                }\n            };\n\n            draw();\n            if (this.settingXSymmetry) {\n                this.context.save();\n                this.context.translate(this.context.canvas.width / 2, 0);\n                this.context.scale(-1, 1);\n                this.context.translate(-this.context.canvas.width / 2, 0);\n                draw();\n                this.context.restore();\n            }\n            if (this.settingYSymmetry) {\n                this.context.save();\n                this.context.translate(0, this.context.canvas.height / 2);\n                this.context.scale(1, -1);\n                this.context.translate(0, -this.context.canvas.height / 2);\n                draw();\n                this.context.restore();\n                if (this.settingXSymmetry) {\n                    this.context.save();\n                    this.context.translate(this.context.canvas.width / 2, this.context.canvas.height / 2);\n                    this.context.scale(-1, -1);\n                    this.context.translate(-this.context.canvas.width / 2, -this.context.canvas.height / 2);\n                    draw();\n                    this.context.restore();\n                }\n            }\n        }\n\n        this.context.restore();\n    }\n\n    // --- public ----\n    constructor () {\n    }\n\n    setHistory (h: KlHistoryInterface): void {\n        this.history = h;\n    }\n\n    getSize (): number {\n        return this.settingMode === 'stroke' ? this.settingSize : 0;\n    }\n\n    setSize (s: number): void {\n        this.settingSize = s;\n    }\n\n    getOpacity (): number {\n        return this.settingOpacity;\n    }\n\n    setOpacity (o: number): void {\n        this.settingOpacity = o;\n    }\n\n    setColor (c: IRGB): void {\n        this.settingColor = BB.copyObj(c);\n    }\n\n    setContext (c: CanvasRenderingContext2D) {\n        this.context = c;\n    }\n\n    setMode (mode: TChemyMode): void {\n        this.settingMode = mode;\n    }\n\n    getMode (): TChemyMode {\n        return this.settingMode;\n    }\n\n    setDistort (distort: number): void {\n        this.settingDistort = BB.clamp(distort, 0, 1);\n    }\n\n    getDistort (): number {\n        return this.settingDistort;\n    }\n\n    setXSymmetry (b: boolean): void {\n        this.settingXSymmetry = b;\n    }\n\n    getXSymmetry (): boolean {\n        return this.settingXSymmetry;\n    }\n\n    setYSymmetry (b: boolean): void {\n        this.settingYSymmetry = b;\n    }\n\n    getYSymmetry (): boolean {\n        return this.settingYSymmetry;\n    }\n\n    setGradient (b: boolean): void {\n        this.settingGradient = b;\n    }\n\n    getGradient (): boolean {\n        return this.settingGradient;\n    }\n\n    getLockAlpha (): boolean {\n        return this.settingLockLayerAlpha;\n    }\n\n    setLockAlpha (b: boolean): void {\n        this.settingLockLayerAlpha = b;\n    }\n\n    getIsEraser (): boolean {\n        return this.settingIsEraser;\n    }\n\n    setIsEraser (b: boolean): void {\n        this.settingIsEraser = b;\n    }\n\n    getIsDrawing (): boolean {\n        return this.isDrawing;\n    }\n\n    startLine (x: number, y: number): void {\n        this.isDrawing = true;\n        this.path = [{x, y}];\n        this.minY = y;\n        this.maxY = y;\n        this.copyCanvas = BB.canvas(this.context.canvas.width, this.context.canvas.height);\n        BB.ctx(this.copyCanvas).drawImage(this.context.canvas, 0, 0);\n        this.completeRedrawBounds = undefined;\n        this.updateCompleteRedrawBounds(x, y);\n    }\n\n    goLine (x: number, y: number): void {\n        if (!this.isDrawing) {\n            return;\n        }\n\n        const pos = { x, y };\n        if (this.settingDistort > 0) {\n            pos.x += (Math.random() - 0.5) * this.settingDistort * 80;\n            pos.y += (Math.random() - 0.5) * this.settingDistort * 80;\n        }\n\n        this.minY = Math.min(this.minY, pos.y);\n        this.maxY = Math.max(this.maxY, pos.y);\n        this.path.push(pos);\n        this.updateCompleteRedrawBounds(x, y);\n        this.drawShape();\n    }\n\n    endLine (): void {\n        this.isDrawing = false;\n        this.completeRedrawBounds = BB.boundsInArea(this.completeRedrawBounds, this.copyCanvas.width, this.copyCanvas.height);\n        if (this.path.length > 1 && this.completeRedrawBounds) {\n            const historyCanvas = BB.canvas(\n                this.completeRedrawBounds.x2 - this.completeRedrawBounds.x1 + 1,\n                this.completeRedrawBounds.y2 - this.completeRedrawBounds.y1 + 1\n            );\n            const historyCtx = BB.ctx(historyCanvas);\n            historyCtx.drawImage(this.context.canvas, -this.completeRedrawBounds.x1, -this.completeRedrawBounds.y1);\n\n            this.history.push({\n                tool: ['brush', 'ChemyBrush'],\n                actions: [\n                    {\n                        action: 'drawImage',\n                        params: [\n                            historyCanvas, // faster than getting image data (measured on 2018 lenovo chromebook)\n                            this.completeRedrawBounds.x1,\n                            this.completeRedrawBounds.y1,\n                        ],\n                    },\n                ],\n            } as IChemyBrushHistoryEntry);\n        }\n        this.path = [];\n        this.copyCanvas = {} as HTMLCanvasElement;\n    }\n\n    drawImage (im: HTMLCanvasElement, x: number, y: number): void {\n        this.context.save();\n        this.context.clearRect(x, y, im.width, im.height);\n        this.context.drawImage(im, x, y);\n        this.context.restore();\n    }\n\n    drawLineSegment (x1: number, y1: number, x2: number, y2: number): void {\n        // might make sense for stroke\n    }\n}\n","import {penBrushUi} from './pen-brush-ui';\nimport {blendBrushUi} from './blend-brush-ui';\nimport {sketchyBrushUi} from './sketchy-brush-ui';\nimport {pixelBrushUi} from './pixel-brush-ui';\nimport {eraserBrushUi} from './eraser-brush-ui';\nimport {smudgeBrushUi} from './smudge-brush-ui';\nimport {chemyBrushUi} from './chemy-brush-ui';\nimport {IBrushUi} from '../kl-types';\n\n/**\n * UI for brushes.\n * Each brush ui carries the brush with it.\n * So if you want to draw, you do it through the UI. should be changed sometime.\n */\n\nexport const brushesUI: {\n    [key: string]: IBrushUi<any>;\n} = {\n    penBrush: penBrushUi,\n    blendBrush: blendBrushUi,\n    sketchyBrush: sketchyBrushUi,\n    pixelBrush: pixelBrushUi,\n    chemyBrush: chemyBrushUi,\n    smudgeBrush: smudgeBrushUi,\n    eraserBrush: eraserBrushUi,\n};\n","import {BB} from '../../bb/bb';\nimport {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {Checkbox} from '../ui/components/checkbox';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\nimport brushIconImg from '/src/app/img/ui/brush-pen.svg';\nimport {genBrushAlpha01, genBrushAlpha02} from '../brushes/alphas/brush-alphas';\nimport {IBrushUi} from '../kl-types';\nimport {LANG, languageStrings} from '../../language/language';\nimport {Options} from '../ui/components/options';\nimport {PenBrush} from '../brushes/pen-brush';\n\n\nexport const penBrushUi = (function () {\n    const brushInterface = {\n        image: brushIconImg,\n        tooltip: LANG('brush-pen'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\n        },\n        opacitySlider: {\n            min: 1/100,\n            max: 1,\n            curve: [[0, 1/100], [0.5, 30/100], [1, 1]],\n        },\n    } as IBrushUi<PenBrush>;\n\n    let alphaNames = [\n        LANG('brush-pen-circle'),\n        LANG('brush-pen-chalk'),\n        LANG('brush-pen-calligraphy'),\n        LANG('brush-pen-square'),\n    ];\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-pen');\n        alphaNames = [\n            LANG('brush-pen-circle'),\n            LANG('brush-pen-chalk'),\n            LANG('brush-pen-calligraphy'),\n            LANG('brush-pen-square'),\n        ];\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement('div'); // the gui\n        const brush = new brushes.PenBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider: KlSlider;\n        let opacitySlider: KlSlider;\n\n        const alphaOptions = new Options({\n            optionArr: [0, 1, 2, 3].map(id => {\n\n                const alpha = BB.el({\n                    className: 'dark-invert',\n                    css: {\n                        width: '31px',\n                        height: '31px',\n                        backgroundSize: 'contain',\n                        margin: '2px',\n                    },\n                });\n                const canvas = BB.canvas(70, 70);\n                const ctx = BB.ctx(canvas);\n                if (id === 0 || id === 3) {\n                    if (id === 0) {\n                        ctx.beginPath();\n                        ctx.arc(35, 35, 30, 0, 2 * Math.PI);\n                        ctx.closePath();\n                        ctx.fill();\n                    } else {\n                        ctx.fillRect(5, 5, 60, 60);\n                    }\n                } else if (id === 1) {\n                    ctx.drawImage(genBrushAlpha01(60), 5, 5);\n                } else if (id === 2) {\n                    ctx.drawImage(genBrushAlpha02(60), 5, 5);\n                }\n                alpha.style.backgroundImage = 'url(' + canvas.toDataURL('image/png') + ')';\n\n                return {\n                    id: id,\n                    label: alpha,\n                    title: alphaNames[id],\n                };\n            }),\n            initId: 0,\n            onChange: (id) => {\n                brush.setAlpha(id);\n            },\n        });\n\n        const lockAlphaToggle = new Checkbox({\n            init: brush.getLockAlpha(),\n            label: LANG('lock-alpha'),\n            callback: function (b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: LANG('lock-alpha-title'),\n            css: {\n                display: 'inline-block',\n            },\n        });\n\n        const spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\n\n        function setSize (size: number) {\n            brush.setSize(size);\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\n        }\n\n        function init () {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue) => {\n                    if (displayValue < 10) {\n                        return BB.round(displayValue, 1);\n                    } else {\n                        return Math.round(displayValue);\n                    }\n                },\n                manualInputRoundDigits: 1,\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brushInterface.opacitySlider.max,\n                curve: brushInterface.opacitySlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\n                brush.sizePressure(b);\n            });\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\n                brush.opacityPressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle,\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    },\n                }),\n                BB.el({\n                    content: [\n                        opacitySlider.getElement(),\n                        pressureOpacityToggle,\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    },\n                }),\n                BB.el({\n                    content: alphaOptions.getElement(),\n                    css: {\n                        marginTop: '10px',\n                    },\n                }),\n                BB.el({\n                    content: lockAlphaToggle.getElement(),\n                    css: {\n                        marginTop: '10px',\n                    },\n                }),\n            );\n\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function (size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function (opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function (x, y) {\n            brush.endLine(x, y);\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    } as IBrushUi<PenBrush>['Ui'];\n    return brushInterface;\n})();","\nexport const eventResMs = 20;","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"brush-pen.49a7b91e.svg\";","import {BB} from '../../bb/bb';\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\nimport {eventResMs} from './brushes-consts';\nimport {Checkbox} from '../ui/components/checkbox';\nimport {brushes} from '../brushes/brushes';\nimport {klHistory} from '../history/kl-history';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport brushIconImg from '/src/app/img/ui/brush-blend.svg';\nimport {IBrushUi} from '../kl-types';\nimport {LANG, languageStrings} from '../../language/language';\nimport {BlendBrush} from '../brushes/blend-brush';\n\nexport const blendBrushUi = (function () {\n    const brushInterface = {\n        image: brushIconImg,\n        tooltip: LANG('brush-blend'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1,\n        },\n    } as IBrushUi<BlendBrush>;\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-blend');\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement('div'); // the gui\n        const brush = new brushes.BlendBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n\n        let sizeSlider: KlSlider;\n        let opacitySlider: KlSlider;\n\n        function setSize (size: number): void {\n            brush.setSize(size);\n        }\n\n        function init () {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: 58,\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                curve: brushInterface.opacitySlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n            const blendingSlider = new KlSlider({\n                label: LANG('brush-blending'),\n                width: 225,\n                height: 30,\n                min: 0,\n                max: 1,\n                value: brush.getBlending(),\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: function (val) {\n                    brush.setBlending(val);\n                },\n            });\n            blendingSlider.getElement().style.marginTop = '10px';\n\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\n                brush.setSizePressure(b);\n            });\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\n                brush.setOpacityPressure(b);\n            });\n\n            const lockAlphaToggle = new Checkbox({\n                init: brush.getLockAlpha(),\n                label: LANG('lock-alpha'),\n                callback: function (b) {\n                    brush.setLockAlpha(b);\n                },\n                doHighlight: true,\n                title: LANG('lock-alpha-title'),\n                css: {\n                    marginTop: '10px',\n                    display: 'inline-block',\n                },\n            });\n\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle,\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    },\n                }),\n                BB.el({\n                    content: [\n                        opacitySlider.getElement(),\n                        pressureOpacityToggle,\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    },\n                }),\n                blendingSlider.getElement(),\n                lockAlphaToggle.getElement()\n            );\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function (size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function (opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p, isCoalesced) {\n            brush.goLine(x, y, p, isCoalesced);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.getIsDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    } as IBrushUi<BlendBrush>['Ui'];\n\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"brush-blend.3706e8a1.svg\";","import {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport brushIconImg from '/src/app/img/ui/brush-sketchy.png';\nimport {IBrushUi} from '../kl-types';\nimport {LANG, languageStrings} from '../../language/language';\nimport {BB} from '../../bb/bb';\nimport {SketchyBrush} from '../brushes/sketchy-brush';\n\nexport const sketchyBrushUi = (function () {\n    const brushInterface = {\n        image: brushIconImg,\n        tooltip: LANG('brush-sketchy'),\n        sizeSlider: {\n            min: 0.5,\n            max: 10,\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1,\n        },\n    } as IBrushUi<SketchyBrush>;\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-sketchy');\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement('div'); // the gui\n        const brush = new brushes.SketchyBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider: KlSlider;\n        let opacitySlider: KlSlider;\n\n        function setSize (size: number) {\n            brush.setSize(size);\n        }\n\n        function init () {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 250,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize() * 2,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: function (val) {\n                    brush.setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue) => {\n                    if (displayValue < 10) {\n                        return BB.round(displayValue, 1);\n                    } else {\n                        return Math.round(displayValue);\n                    }\n                },\n                manualInputRoundDigits: 1,\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 250,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n            const blendSlider = new KlSlider({\n                label: LANG('brush-blending'),\n                width: 250,\n                height: 30,\n                min: 0,\n                max: 1,\n                value: brush.getBlending(),\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: function (val) {\n                    brush.setBlending(val);\n                },\n            });\n            const scaleSlider = new KlSlider({\n                label: LANG('brush-sketchy-scale'),\n                width: 250,\n                height: 30,\n                min: 1,\n                max: 20,\n                value: brush.getScale(),\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brush.setScale(val);\n                },\n            });\n            opacitySlider.getElement().style.marginTop = '10px';\n            blendSlider.getElement().style.marginTop = '10px';\n            scaleSlider.getElement().style.marginTop = '10px';\n            div.append(\n                sizeSlider.getElement(),\n                opacitySlider.getElement(),\n                blendSlider.getElement(),\n                scaleSlider.getElement(),\n            );\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function (size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function (opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, pressure) {\n            brush.startLine(x, y, pressure);\n        };\n        this.goLine = function (x, y, pressure) {\n            brush.goLine(x, y, pressure, undefined);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getSeed = function () {\n            return parseInt('' + brush.getSeed());\n        };\n        this.setSeed = function (s) {\n            brush.setSeed(parseInt('' + s));\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    } as IBrushUi<SketchyBrush>['Ui'];\n\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"brush-sketchy.4c477c01.png\";","import {BB} from '../../bb/bb';\nimport {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {Checkbox} from '../ui/components/checkbox';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\nimport brushIconImg from '/src/app/img/ui/brush-pixel.svg';\nimport {IBrushUi} from '../kl-types';\nimport {LANG, languageStrings} from '../../language/language';\nimport {PixelBrush} from '../brushes/pixel-brush';\n\nexport const pixelBrushUi = (function () {\n    const brushInterface = {\n        image: brushIconImg,\n        tooltip: LANG('brush-pixel'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1,\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]],\n        },\n    } as IBrushUi<PixelBrush>;\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-pixel');\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement('div'); // the gui\n        const brush = new brushes.PixelBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider: KlSlider;\n        let opacitySlider: KlSlider;\n\n        const lockAlphaToggle = new Checkbox({\n            init: brush.getLockAlpha(),\n            label: LANG('lock-alpha'),\n            callback: function (b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: LANG('lock-alpha-title'),\n            css: {\n                marginRight: '10px',\n            },\n        });\n\n        const eraserToggle = new Checkbox({\n            init: brush.getIsEraser(),\n            label: LANG('eraser'),\n            callback: function (b) {\n                brush.setIsEraser(b);\n            },\n            css: {\n                marginRight: '10px',\n            },\n        });\n\n        const ditherToggle = new Checkbox({\n            init: brush.getUseDither(),\n            label: LANG('brush-pixel-dither'),\n            callback: function (b) {\n                brush.setUseDither(b);\n            },\n        });\n\n        const spacingSpline = new BB.SplineInterpolator([[0.5, 0.45], [100, 4]]);\n\n        function setSize (size: number) {\n            brush.setSize(size);\n            brush.setSpacing(spacingSpline.interpolate(size) / size);\n        }\n\n        function init () {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brushInterface.opacitySlider.max,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\n                brush.sizePressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle,\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    },\n                }),\n                opacitySlider.getElement()\n            );\n\n            const toggleRow = BB.el({\n                parent: div,\n                css: {\n                    display: 'flex',\n                    marginTop: '10px',\n                },\n            });\n\n            toggleRow.append(\n                lockAlphaToggle.getElement(),\n                eraserToggle.getElement(),\n                ditherToggle.getElement(),\n            );\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function (size) {\n            setSize(size);\n            sizeSlider.setValue(size * 2);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function (opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity * 100);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function (x, y) {\n            brush.endLine(x, y);\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.toggleEraser = () => {\n            eraserToggle.setValue(!eraserToggle.getValue());\n            brush.setIsEraser(eraserToggle.getValue());\n        };\n        this.getElement = function () {\n            return div;\n        };\n    } as IBrushUi<PixelBrush>['Ui'];\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"brush-pixel.673f3e4c.svg\";","import {BB} from '../../bb/bb';\nimport {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\nimport {Checkbox} from '../ui/components/checkbox';\nimport brushIconImg from '/src/app/img/ui/brush-eraser.svg';\nimport {IBrushUi} from '../kl-types';\nimport {LANG, languageStrings} from '../../language/language';\nimport {EraserBrush} from '../brushes/eraser-brush';\n\nexport const eraserBrushUi = (function () {\n    const brushInterface = {\n        image: brushIconImg,\n        tooltip: LANG('eraser') + ' [E]',\n        sizeSlider: {\n            min: 0.5,\n            max: 200,\n            curve: BB.quadraticSplineInput(0.5, 200, 0.1),\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1,\n        },\n    } as IBrushUi<EraserBrush>;\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('eraser') + ' [E]';\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement('div'); // the gui\n        const brush = new brushes.EraserBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n\n        let sizeSlider: KlSlider;\n        let opacitySlider: KlSlider;\n        let isTransparentBg = false;\n\n        function setSize (size: number) {\n            brush.setSize(size);\n        }\n\n        function init () {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: 30,\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue) => {\n                    if (displayValue < 10) {\n                        return BB.round(displayValue, 1);\n                    } else {\n                        return Math.round(displayValue);\n                    }\n                },\n                manualInputRoundDigits: 1,\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brushInterface.opacitySlider.max,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n\n            const pressureSizeToggle = createPenPressureToggle(true, function (b) {\n                brush.sizePressure(b);\n            });\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\n                brush.opacityPressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle,\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    },\n                }),\n                BB.el({\n                    content: [\n                        opacitySlider.getElement(),\n                        pressureOpacityToggle,\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    },\n                })\n            );\n\n            const transparencyToggle = new Checkbox({\n                init: false,\n                label: LANG('brush-eraser-transparent-bg'),\n                callback: function (b) {\n                    isTransparentBg = b;\n                    brush.setTransparentBG(b);\n                },\n                css: {\n                    marginTop: '10px',\n                },\n            });\n            div.append(transparencyToggle.getElement());\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.isDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function (size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function (opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n        this.setColor = function () {\n        };\n        this.setContext = function (c) {\n            brush.setContext(c as Parameters<EraserBrush['setContext']>[0]);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.getIsTransparentBg = function () {\n            return isTransparentBg;\n        };\n        this.isDrawing = function () {\n            return brush.isDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    } as IBrushUi<EraserBrush>['Ui'];\n\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"brush-eraser.a9e10dce.svg\";","import {BB} from '../../bb/bb';\nimport {brushes} from '../brushes/brushes';\nimport {eventResMs} from './brushes-consts';\nimport {klHistory} from '../history/kl-history';\nimport {Checkbox} from '../ui/components/checkbox';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport {createPenPressureToggle} from '../ui/components/create-pen-pressure-toggle';\nimport brushIconImg from '/src/app/img/ui/brush-smudge.svg';\nimport {IBrushUi} from '../kl-types';\nimport {LANG, languageStrings} from '../../language/language';\nimport {SmudgeBrush} from '../brushes/smudge-brush';\n\nexport const smudgeBrushUi = (function () {\n    const brushInterface = {\n        image: brushIconImg,\n        tooltip: LANG('brush-smudge'),\n        sizeSlider: {\n            min: 0.5,\n            max: 100,\n            curve: BB.quadraticSplineInput(0.5, 100, 0.1),\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1,\n            curve: [[0, 1 / 100], [0.5, 0.3], [1, 1]],\n        },\n    } as IBrushUi<SmudgeBrush>;\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-smudge');\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement('div'); // the gui\n        const brush = new brushes.SmudgeBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n        let sizeSlider: KlSlider;\n        let opacitySlider: KlSlider;\n\n        const lockAlphaToggle = new Checkbox({\n            init: brush.getLockAlpha(),\n            label: LANG('lock-alpha'),\n            callback: function (b) {\n                brush.setLockAlpha(b);\n            },\n            doHighlight: true,\n            title: LANG('lock-alpha-title'),\n        });\n\n        const spacingSpline = new BB.SplineInterpolator([[0, 15], [8, 7], [14, 4], [30, 3], [50, 2.7], [100, 2]]);\n\n        function setSize (size: number) {\n            brush.setSize(size);\n            brush.setSpacing(Math.max(2, spacingSpline.interpolate(size)) / 15);\n        }\n\n        function init () {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 225,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue) => {\n                    if (displayValue < 10) {\n                        return BB.round(displayValue, 1);\n                    } else {\n                        return Math.round(displayValue);\n                    }\n                },\n                manualInputRoundDigits: 1,\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 225,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                curve: brushInterface.opacitySlider.curve,\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n\n            const pressureSizeToggle = createPenPressureToggle(false, function (b) {\n                brush.sizePressure(b);\n            });\n            const pressureOpacityToggle = createPenPressureToggle(false, function (b) {\n                brush.opacityPressure(b);\n            });\n\n            div.append(\n                BB.el({\n                    content: [\n                        sizeSlider.getElement(),\n                        pressureSizeToggle,\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                        marginBottom: '10px',\n                    },\n                }),\n                BB.el({\n                    content: [\n                        opacitySlider.getElement(),\n                        pressureOpacityToggle,\n                    ],\n                    css: {\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        alignItems: 'center',\n                    },\n                })\n            );\n\n            const bottomRow = BB.el({\n                parent: div,\n                css: {\n                    marginTop: '10px',\n                },\n            });\n            bottomRow.append(lockAlphaToggle.getElement());\n\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.getIsDrawing()) {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function (size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function (opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y, p);\n        };\n        this.goLine = function (x, y, p) {\n            brush.goLine(x, y, p);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.getIsDrawing();\n        };\n        this.getElement = function () {\n            return div;\n        };\n    } as IBrushUi<SmudgeBrush>['Ui'];\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"brush-smudge.45852bcd.svg\";","import {BB} from '../../bb/bb';\nimport {eventResMs} from './brushes-consts';\nimport {Checkbox} from '../ui/components/checkbox';\nimport {brushes} from '../brushes/brushes';\nimport {klHistory} from '../history/kl-history';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport brushIconImg from '/src/app/img/ui/brush-chemy.svg';\nimport {IBrushUi} from '../kl-types';\nimport {Options} from '../ui/components/options';\nimport {BoxToggle} from '../ui/components/box-toggle';\nimport {LANG, languageStrings} from '../../language/language';\nimport {ChemyBrush} from '../brushes/chemy-brush';\n\nexport const chemyBrushUi = (function () {\n    const brushInterface = {\n        image: brushIconImg,\n        tooltip: LANG('brush-chemy'),\n        sizeSlider: {\n            min: 0.25,\n            max: 25,\n            curve: BB.quadraticSplineInput(0.25, 25, 0.1),\n            isDisabled: true,\n        },\n        opacitySlider: {\n            min: 1 / 100,\n            max: 1,\n        },\n    } as IBrushUi<ChemyBrush>;\n\n    languageStrings.subscribe(() => {\n        brushInterface.tooltip = LANG('brush-chemy');\n    });\n\n    brushInterface.Ui = function (p) {\n        const div = document.createElement('div'); // the gui\n        const brush = new brushes.ChemyBrush();\n        brush.setHistory(klHistory);\n        p.onSizeChange(brush.getSize());\n\n        let sizeSlider: KlSlider;\n        let opacitySlider: KlSlider;\n\n        function setSize (size: number) {\n            brush.setSize(size);\n        }\n\n        let eraserToggle: Checkbox;\n\n        function init () {\n            sizeSlider = new KlSlider({\n                label: LANG('brush-size'),\n                width: 250,\n                height: 30,\n                min: brushInterface.sizeSlider.min,\n                max: brushInterface.sizeSlider.max,\n                value: brush.getSize(),\n                curve: brushInterface.sizeSlider.curve,\n                eventResMs: eventResMs,\n                isEnabled: brush.getMode() === 'stroke',\n                toDisplayValue: (val) => val * 2,\n                toValue: (displayValue) => displayValue / 2,\n                onChange: (val) => {\n                    setSize(val);\n                    p.onSizeChange(val);\n                },\n                formatFunc: (displayValue) => {\n                    if (displayValue < 5) {\n                        return BB.round(displayValue, 1);\n                    } else {\n                        return Math.round(displayValue);\n                    }\n                },\n                manualInputRoundDigits: 1,\n            });\n            opacitySlider = new KlSlider({\n                label: LANG('opacity'),\n                width: 250,\n                height: 30,\n                min: brushInterface.opacitySlider.min,\n                max: brushInterface.opacitySlider.max,\n                value: brush.getOpacity(),\n                eventResMs: eventResMs,\n                toDisplayValue: (val) => val * 100,\n                toValue: (displayValue) => displayValue / 100,\n                onChange: (val) => {\n                    brush.setOpacity(val);\n                    p.onOpacityChange(val);\n                },\n            });\n\n            BB.css(opacitySlider.getElement(), {\n                marginTop: '10px',\n            });\n\n            eraserToggle = new Checkbox({\n                init: brush.getIsEraser(),\n                label: LANG('eraser'),\n                callback: function (b) {\n                    brush.setIsEraser(b);\n                },\n                css: {\n                    marginTop: '10px',\n                    marginLeft: '10px',\n                },\n            });\n\n            const lockAlphaToggle = new Checkbox({\n                init: brush.getLockAlpha(),\n                label: LANG('lock-alpha'),\n                callback: function (b) {\n                    brush.setLockAlpha(b);\n                },\n                doHighlight: true,\n                title: LANG('lock-alpha-title'),\n                css: {\n                    marginTop: '10px',\n                },\n            });\n\n            const toggleRow = BB.el({\n                css: {\n                    display: 'flex',\n                    marginTop: '10px',\n                },\n            });\n\n            const iconSize = 35;\n            const padding = 8;\n            const actualIconSize = iconSize - padding * 2;\n            const halfSize = actualIconSize / 2;\n\n            const modeOptions = new Options({\n                optionArr: [\n                    {\n                        id: 'fill',\n                        label: BB.createSvg({\n                            class: 'dark-invert',\n                            elementType: 'svg',\n                            width: iconSize + '',\n                            height: iconSize + '',\n                            childrenArr: [\n                                {\n                                    elementType: 'path',\n                                    fill: '#000',\n                                    style: `transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\n                                },\n                            ],\n                        }),\n                        title: LANG('brush-chemy-fill'),\n                    },\n                    {\n                        id: 'stroke',\n                        label: BB.createSvg({\n                            class: 'dark-invert',\n                            elementType: 'svg',\n                            width: iconSize + '',\n                            height: iconSize + '',\n                            childrenArr: [\n                                {\n                                    elementType: 'path',\n                                    fill: 'none',\n                                    stroke: '#000',\n                                    style: `stroke-width: 0.12px; transform-origin: 0 0; transform: translate(-0.5px, -0.5px) scale(${actualIconSize}, ${actualIconSize}) translate(0.5px, 0.5px)`,\n                                    d: 'M 0,0 C 1.5,0 -0.5,1 1,1',\n                                },\n                            ],\n                        }),\n                        title: LANG('brush-chemy-stroke'),\n                    },\n                ],\n                initId: brush.getMode(),\n                onChange: (id: string): void => {\n                    brush.setMode(id as 'stroke' | 'fill');\n                    brushInterface.sizeSlider.isDisabled = brush.getMode() === 'fill';\n                    sizeSlider.setIsEnabled(!brushInterface.sizeSlider.isDisabled);\n\n                    const brushSize = brush.getSize();\n                    sizeSlider.setValue(brushSize);\n                    p.onSizeChange(brushSize);\n                    p.onConfigChange();\n                },\n            });\n\n            const mirrorXToggle = new BoxToggle({\n                label: BB.createSvg({\n                    class: 'dark-invert',\n                    elementType: 'svg',\n                    width: iconSize + '',\n                    height: iconSize + '',\n                    childrenArr: [\n                        {\n                            elementType: 'path',\n                            fill: 'none',\n                            stroke: '#000',\n                            style: 'stroke-width: 1px',\n                            d: `M ${halfSize + padding},${padding} ${halfSize + padding},${actualIconSize + padding}`,\n                        },\n                    ],\n                }),\n                title: LANG('brush-chemy-mirror-x'),\n                init: brush.getXSymmetry(),\n                onChange: (b) => {\n                    brush.setXSymmetry(b);\n                },\n            });\n\n            const mirrorYToggle = new BoxToggle({\n                label: BB.createSvg({\n                    class: 'dark-invert',\n                    elementType: 'svg',\n                    width: iconSize + '',\n                    height: iconSize + '',\n                    childrenArr: [\n                        {\n                            elementType: 'path',\n                            fill: 'none',\n                            stroke: '#000',\n                            style: 'stroke-width: 1px',\n                            d: `M ${padding},${halfSize + padding} ${actualIconSize + padding},${halfSize + padding}`,\n                        },\n                    ],\n                }),\n                title: LANG('brush-chemy-mirror-y'),\n                init: brush.getYSymmetry(),\n                onChange: (b) => {\n                    brush.setYSymmetry(b);\n                },\n            });\n\n            const gradientToggle = new BoxToggle({\n                label: BB.createSvg({\n                    class: 'dark-invert',\n                    elementType: 'svg',\n                    width: iconSize + '',\n                    height: iconSize + '',\n                    childrenArr: [\n                        {\n                            elementType: 'defs',\n                            childrenArr: [\n                                {\n                                    elementType: 'linearGradient',\n                                    id: 'gradient',\n                                    x1: '0',\n                                    y1: '0',\n                                    x2: '0',\n                                    y2: '1',\n                                    childrenArr: [\n                                        {\n                                            elementType: 'stop',\n                                            offset: '0%',\n                                            'stop-color': 'rgba(0,0,0,0)',\n                                        },\n                                        {\n                                            elementType: 'stop',\n                                            offset: '100%',\n                                            'stop-color': 'rgba(0,0,0,1)',\n                                        },\n                                    ],\n                                },\n                            ],\n                        },\n                        {\n                            elementType: 'rect',\n                            fill: \"url('#gradient')\",\n                            x: '' + padding,\n                            y: '' + padding,\n                            width: '' + actualIconSize,\n                            height: '' + actualIconSize,\n                        },\n                    ],\n                }),\n                title: LANG('brush-chemy-gradient'),\n                init: brush.getGradient(),\n                onChange: (b) => {\n                    brush.setGradient(b);\n                },\n            });\n\n            BB.css(mirrorXToggle.getElement(), {\n                marginLeft: '10px',\n            });\n            {\n                const margin = {\n                    marginLeft: '4px',\n                };\n                BB.css(mirrorYToggle.getElement(), margin);\n                BB.css(gradientToggle.getElement(), margin);\n            }\n\n            toggleRow.append(\n                modeOptions.getElement(),\n                mirrorXToggle.getElement(),\n                mirrorYToggle.getElement(),\n                gradientToggle.getElement(),\n            );\n\n            div.append(\n                sizeSlider.getElement(),\n                opacitySlider.getElement(),\n                toggleRow,\n                BB.el({\n                    content: [\n                        lockAlphaToggle.getElement(),\n                        eraserToggle.getElement(),\n                    ],\n                    css: {\n                        display: 'flex',\n                    },\n                })\n            );\n        }\n\n        init();\n\n        this.increaseSize = function (f) {\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\n                sizeSlider.changeSliderValue(f);\n            }\n        };\n        this.decreaseSize = function (f) {\n            if (!brush.getIsDrawing() && brush.getMode() === 'stroke') {\n                sizeSlider.changeSliderValue(-f);\n            }\n        };\n\n        this.getSize = function () {\n            return brush.getSize();\n        };\n        this.setSize = function (size) {\n            setSize(size);\n            sizeSlider.setValue(size);\n        };\n        this.getOpacity = function () {\n            return brush.getOpacity();\n        };\n        this.setOpacity = function (opacity) {\n            brush.setOpacity(opacity);\n            opacitySlider.setValue(opacity);\n        };\n\n        this.setColor = function (c) {\n            brush.setColor(c);\n        };\n        this.setContext = function (c) {\n            brush.setContext(c);\n        };\n        this.startLine = function (x, y, p) {\n            brush.startLine(x, y);\n        };\n        this.goLine = function (x, y, p, isCoalesced) {\n            brush.goLine(x, y);\n        };\n        this.endLine = function () {\n            brush.endLine();\n        };\n        this.getBrush = function () {\n            return brush;\n        };\n        this.isDrawing = function () {\n            return brush.getIsDrawing();\n        };\n        this.toggleEraser = () => {\n            eraserToggle.setValue(!eraserToggle.getValue());\n            brush.setIsEraser(eraserToggle.getValue());\n        };\n        this.getElement = function () {\n            return div;\n        };\n    } as IBrushUi<ChemyBrush>['Ui'];\n\n    return brushInterface;\n})();","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"brush-chemy.a5a188f6.svg\";","import {BB} from '../../../bb/bb';\nimport {DynamicModal} from './base/dynamic-modal';\nimport {LANG} from '../../../language/language';\n\nexport function showIframeModal (\n    url: string,\n    isEmbed: boolean,\n) {\n\n    // window very small, modal might look bad\n    if (!isEmbed && (window.innerHeight < 500 || window.innerWidth < 700)) {\n        window.open(url);\n        return;\n    }\n\n    const iframe = BB.el({\n        tagName: 'iframe',\n        custom: {\n            src: url,\n        },\n        css: {\n            width: '100%',\n            height: '100%',\n            opacity: '0',\n        },\n    });\n    setTimeout(() => {\n        iframe.style.opacity = ''; // fallback\n    }, 500);\n\n    const titleEl = BB.el();\n\n    let linkEl: HTMLElement | undefined;\n    if (!isEmbed) {\n        linkEl = BB.el({\n            tagName: 'a',\n            parent: titleEl,\n            content: LANG('modal-new-tab'),\n            custom: {\n                href: 'help',\n                target: '_blank',\n            },\n            onClick: function () {\n                popup.close();\n            },\n        });\n        iframe.onload = () => {\n            if (linkEl && iframe.contentWindow) {\n                BB.setAttributes(linkEl, {\n                    href: '' + iframe.contentWindow.location,\n                });\n            }\n            iframe.style.opacity = '';\n        };\n    }\n\n\n    const popup = new DynamicModal({\n        title: titleEl,\n        content: iframe,\n        width: 880,\n        isMaxHeight: true,\n        onClose: () => {\n            if (linkEl) {\n                iframe.src = 'about:blank';\n                BB.destroyEl(linkEl);\n                linkEl = undefined;\n            }\n        },\n    });\n\n}","import {BB} from '../../../bb/bb';\n\nexport class RadioList {\n\n    el: HTMLDivElement;\n    inputs: HTMLInputElement[] = [];\n\n    constructor ({name, init, items, ignoreFocus}: {\n        name: string;\n        init?: string;\n        items: {\n            label: string;\n            value: string;\n        }[];\n        ignoreFocus?: boolean; // default false\n    }) {\n        this.el = BB.el({\n            className: 'kl-radio',\n        });\n\n        items.forEach(item => {\n            const label = BB.el({\n                tagName: 'label',\n            });\n            const input = BB.el({\n                tagName: 'input',\n                parent: label,\n                custom: {\n                    name: name,\n                    value: item.value,\n                    type: 'radio',\n                },\n            });\n            if (ignoreFocus) {\n                input.setAttribute('data-ignore-focus', 'true');\n            }\n            if (init === item.value) {\n                input.checked = true;\n            }\n            label.append(item.label);\n            this.el.append(label);\n            this.inputs.push(input);\n        });\n    }\n\n\n    getValue (): string | null {\n        for (let i = 0; i < this.inputs.length; i++) {\n            if (this.inputs[i].checked) {\n                return this.inputs[i].value;\n            }\n        }\n        return null;\n    }\n\n    getElement () {\n        return this.el;\n    }\n\n}","import {BB} from '../../../bb/bb';\n\nimport removeLayerImg from '/src/app/img/ui/remove-layer.svg';\nimport {IKlProject} from '../../kl-types';\nimport {showIframeModal} from '../modals/show-iframe-modal';\nimport {SaveReminder} from './save-reminder';\nimport {IProjectStoreListener, ProjectStore} from '../../storage/project-store';\nimport {KL} from '../../kl';\nimport {LANG} from '../../../language/language';\nimport {theme} from '../../../theme/theme';\n\nexport class BrowserStorageUi {\n\n    private previewEl: HTMLDivElement = {} as HTMLDivElement;\n    private readonly infoEl: HTMLElement = {} as HTMLElement;\n    private readonly ageEl: HTMLElement = {} as HTMLElement;\n    private readonly storeButtonEl: HTMLButtonElement = {} as HTMLButtonElement;\n    private readonly clearButtonEl: HTMLButtonElement = {} as HTMLButtonElement;\n    private readonly storeListener: IProjectStoreListener = {} as IProjectStoreListener;\n    private readonly updateCheckerboard: () => void = () => {};\n\n    private timestamp: number | undefined;\n    private thumbnail: HTMLImageElement | HTMLCanvasElement | undefined;\n\n    private updateAge () {\n        if (!this.timestamp) {\n            return;\n        }\n        let age = new Date().getTime() - this.timestamp;\n        let ageStr;\n        age = Math.floor(age / 1000 / 60);\n        ageStr = LANG('file-storage-min-ago').replace('{x}', '' + age);\n        if (age > 60) {\n            age = Math.floor(age / 60);\n            ageStr = LANG('file-storage-hours-ago').replace('{x}', '' + age);\n            if (age > 24) {\n                age = Math.floor(age / 24);\n                ageStr = LANG('file-storage-days-ago').replace('{x}', '' + age);\n                if (age > 31) {\n                    ageStr = LANG('file-storage-month-ago');\n                }\n            }\n        }\n        this.ageEl.textContent = ageStr;\n    }\n\n    private resetButtons () {\n        if (this.timestamp) {\n            this.storeButtonEl.textContent = LANG('file-storage-overwrite');\n            this.storeButtonEl.disabled = false;\n            this.clearButtonEl.disabled = false;\n        } else {\n            this.storeButtonEl.textContent = LANG('file-storage-store');\n            this.storeButtonEl.disabled = false;\n            this.clearButtonEl.disabled = true;\n        }\n    }\n\n    private updateThumb (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) {\n        this.timestamp = timestamp;\n        this.thumbnail = thumbnail;\n        if (this.timestamp && thumbnail) {\n            thumbnail.classList.add('kl-storage-preview__im');\n            this.previewEl.innerHTML = '';\n            this.updateAge();\n            this.previewEl.append(thumbnail, this.ageEl);\n        } else {\n            this.previewEl.innerHTML = LANG('file-storage-empty');\n        }\n        this.resetButtons();\n    }\n\n    private async store () {\n        this.storeButtonEl.textContent = LANG('file-storage-storing');\n        this.storeButtonEl.disabled = true;\n        this.clearButtonEl.disabled = true;\n        await new Promise((resolve) => {\n            setTimeout(() => resolve(null), 20);\n        });\n        try {\n            await this.projectStore.store(this.getProject());\n            this.saveReminder.reset();\n        } catch (e) {\n            this.resetButtons();\n            KL.popup({\n                target: this.klRootEl,\n                type: 'error',\n                message: [\n                    `${LANG('file-storage-failed-1')}<ul>`,\n                    `<li>${LANG('file-storage-failed-2')}</li>`,\n                    `<li>${LANG('file-storage-failed-3')}</li>`,\n                    `<li>${LANG('file-storage-failed-4')}</li>`,\n                    '</ul>',\n                ].join(''),\n                buttons: ['Ok'],\n            });\n            setTimeout(() => {\n                throw new Error('storage-ui: failed to store browser storage, ' + e);\n            }, 0);\n        }\n    }\n\n    private async clear () {\n        this.storeButtonEl.disabled = true;\n        this.clearButtonEl.disabled = true;\n        try {\n            await this.projectStore.clear();\n        } catch (e) {\n            this.resetButtons();\n            KL.popup({\n                target: this.klRootEl,\n                type: 'error',\n                message: LANG('file-storage-failed-clear'),\n                buttons: ['Ok'],\n            });\n            setTimeout(() => {\n                throw new Error('storage-ui: failed to clear browser storage, ' + e);\n            }, 0);\n        }\n    }\n\n    element: HTMLDivElement;\n\n    constructor (\n        private projectStore: ProjectStore,\n        private getProject: () => IKlProject,\n        private saveReminder: SaveReminder,\n        private klRootEl: HTMLElement,\n        private options?: { hideClearButton?: boolean; isFocusable?: boolean }, // isFocusable default = false\n    ) {\n        this.element = BB.el({\n            css: {\n                display: 'grid',\n                gridTemplateColumns: '1fr 0fr',\n                gridTemplateRows: '0fr 0fr 0fr',\n                gap: '0 0',\n                gridTemplateAreas: '\"title title\" \"preview store\" \"preview clear\"',\n            },\n        });\n\n\n        const title = BB.el({\n            parent: this.element,\n            content: LANG('file-storage'),\n            css: {\n                gridArea: 'title',\n                display: 'flex',\n                margin: '-5px 0',\n                gap: '5px',\n                //background: '#f00',\n            },\n        });\n\n        this.infoEl = BB.el({\n            parent: title,\n            content: '?',\n            className: 'kl-info-btn',\n            title: LANG('file-storage-about'),\n            onClick: () => {\n                showIframeModal('./help/#help-browser-storage', false);\n            },\n        });\n\n        if (this.projectStore.isBroken()) {\n            BB.el({\n                parent: this.element,\n                content: ' ' + LANG('file-storage-cant-access'),\n                css: {\n                    marginTop: '10px',\n                },\n            });\n            return;\n        }\n\n        this.previewEl = BB.el({\n            parent: this.element,\n            title: LANG('file-storage-thumb-title'),\n            className: 'kl-storage-preview',\n        });\n        this.ageEl = BB.el({\n            css: {\n                position: 'absolute',\n                right: '1px',\n                bottom: '1px',\n                width: 'calc(100% - 2px)',\n                textAlign: 'center',\n                background: 'rgba(0,0,0,0.7)',\n                color: '#fff',\n                textSize: '13px',\n            },\n        });\n        const btnCustom: { [key: string]: string } = options?.isFocusable ?  {} : {\n            tabIndex: '-1',\n        };\n        this.storeButtonEl = BB.el({\n            parent: this.element,\n            tagName: 'button',\n            className: 'grid-button',\n            content: LANG('file-storage-store'),\n            css: {\n                gridArea: 'store',\n                //background: '#00f',\n            },\n            custom: btnCustom,\n            onClick: () => this.store(),\n        });\n        this.clearButtonEl = BB.el({\n            parent: this.element,\n            tagName: 'button',\n            className: 'grid-button',\n            content: '<img src=\"' + removeLayerImg + '\" height=\"20\"/> ' + LANG('file-storage-clear'),\n            css: {\n                gridArea: 'clear',\n                //background: '#ff0',\n            },\n            custom: btnCustom,\n            onClick: () => this.clear(),\n        });\n\n        if (this.options?.hideClearButton) {\n            this.clearButtonEl.style.visibility = 'hidden';\n        }\n\n        this.storeListener = {\n            onUpdate: (timestamp, thumbnail) => {\n                this.updateThumb(timestamp, thumbnail);\n            },\n        };\n        this.projectStore.subscribe(this.storeListener);\n\n        this.updateCheckerboard = (): void => {\n            if (!this.thumbnail) {\n                return;\n            }\n            BB.css(this.thumbnail, {\n                background: \"url('\" + BB.createCheckerCanvas(4, theme.isDark()).toDataURL('image/png') + \"')\",\n            });\n        };\n        theme.addIsDarkListener(this.updateCheckerboard);\n\n        setInterval(() => this.updateAge(), 1000 * 60);\n\n        (async () => {\n            try {\n                const readResult = await this.projectStore.read();\n                if (readResult) {\n                    this.updateThumb(readResult.timestamp, readResult.thumbnail);\n                } else {\n                    this.updateThumb();\n                }\n            } catch (e) {\n                setTimeout(() => {\n                    throw new Error('storage-ui: failed initial read browser storage, ' + e);\n                }, 0);\n            }\n        })();\n    }\n\n\n    getElement () {\n        return this.element;\n    }\n\n    show () {\n        // todo\n    }\n\n    hide () {\n        // todo\n    }\n\n    destroy () {\n        BB.destroyEl(this.infoEl);\n        BB.destroyEl(this.storeButtonEl);\n        BB.destroyEl(this.clearButtonEl);\n        theme.removeIsDarkListener(this.updateCheckerboard);\n        this.projectStore.unsubscribe(this.storeListener);\n    }\n}","import {IKlProject, IKlStorageProject} from '../kl-types';\nimport {ProjectConverter, TReadStorageProjectResult} from './project-converter';\nimport {clear, getKlProjectObj, storeKlProjectObj} from './indexed-db';\nimport {LocalStorage} from '../../bb/base/local-storage';\n\n\nexport interface IProjectStoreListener {\n    onUpdate: (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement) => void;\n}\n\nfunction makeAsync<T> (\n    nonAsyncFunc: (\n        resolveCallback: (value: T) => void,\n        rejectCallback: (reason?: unknown) => void\n    ) => void,\n): Promise<T> {\n    return new Promise<T>((resolve, reject) => {\n        nonAsyncFunc(resolve, reject);\n    });\n}\n\n/**\n * simplified interface for storing projects into browser storage\n */\nexport class ProjectStore {\n\n    private listeners: IProjectStoreListener[] = [];\n    private accessHasFailed: boolean = false;\n\n    async lowLevelStore (project: IKlStorageProject): Promise<void> {\n        await new Promise<void>((resolve, reject) => {\n            storeKlProjectObj(project, resolve, reject);\n        });\n    }\n\n    async lowLevelRead (): Promise<IKlStorageProject> {\n        return await makeAsync(getKlProjectObj) as IKlStorageProject;\n    }\n\n    async lowLevelClear (): Promise<void> {\n        await makeAsync<void>(clear);\n    }\n\n\n\n    private emit (timestamp?: number, thumbnail?: HTMLImageElement | HTMLCanvasElement): void {\n        this.listeners.forEach(item => {\n            item.onUpdate(timestamp, thumbnail);\n        });\n    }\n\n    private updateTimestamp (): void {\n        LocalStorage.setItem('indexedDbUpdatedAt', '' + new Date().getTime());\n    }\n\n    // --- public ---\n\n    constructor () {\n        window.addEventListener('storage', (e) => {\n            if (e.key !== 'indexedDbUpdatedAt' || this.listeners.length === 0) {\n                return;\n            }\n            try {\n                ( async (): Promise<void> => {\n                    const readResult = await this.read();\n                    if (readResult) {\n                        this.emit(readResult.timestamp, readResult.thumbnail);\n                    } else {\n                        this.emit();\n                    }\n                })();\n            } catch (e) {\n                if (e instanceof Error && e.message.indexOf('db-error') === 0) {\n                    this.accessHasFailed = true;\n                }\n            }\n\n        });\n    }\n\n    async read (): Promise<{\n        project: IKlProject;\n        timestamp: number;\n        thumbnail: HTMLImageElement | HTMLCanvasElement;\n    } | undefined> {\n        let storageProject;\n        try {\n            storageProject = await this.lowLevelRead();\n        } catch (e) {\n            this.accessHasFailed = true;\n            throw new Error('db-error: ' + e);\n        }\n        if (!storageProject) {\n            return undefined;\n        }\n        let result;\n        try {\n            result = await ProjectConverter.readStorageProject(storageProject);\n        } catch (e) {\n            throw new Error('format-error: ' + e);\n        }\n        return result;\n    }\n\n    async store (project: IKlProject): Promise<void> {\n        try {\n            const storageProject = ProjectConverter.createStorageProject(project);\n            await this.lowLevelStore(storageProject);\n        } catch (e) {\n            this.accessHasFailed = true;\n            throw new Error('db-error: ' + e);\n        }\n        {\n            // immediately test if it can be read\n            const storageProject = await this.lowLevelRead();\n            let readResult: TReadStorageProjectResult;\n            try {\n                readResult = await ProjectConverter.readStorageProject(storageProject);\n            } catch (e) {\n                await this.lowLevelClear();\n                this.updateTimestamp();\n                setTimeout(() => this.emit(), 0);\n                throw new Error('format-error: ' + e);\n            }\n            this.updateTimestamp();\n            setTimeout(() => this.emit(readResult.timestamp, readResult.thumbnail), 0);\n        }\n    }\n\n    async clear (): Promise<void> {\n        await this.lowLevelClear();\n        this.updateTimestamp();\n        setTimeout(() => this.emit(), 0);\n    }\n\n    subscribe (listener: IProjectStoreListener): void {\n        if (this.listeners.includes(listener)) {\n            return;\n        }\n        this.listeners.push(listener);\n    }\n\n    unsubscribe (listener: IProjectStoreListener): void {\n        for (let i = 0; i < this.listeners.length; i++) {\n            if (listener === this.listeners[i]) {\n                this.listeners.splice(i, 1);\n                return;\n            }\n        }\n    }\n\n    isBroken (): boolean {\n        return this.accessHasFailed;\n    }\n\n}","import {IKlProject, IKlStorageProject} from '../kl-types';\nimport {BB} from '../../bb/bb';\nimport {drawProject} from '../canvas/draw-project';\nimport {base64ToBlob} from './base-64-to-blob';\n\nexport type TReadStorageProjectResult = {\n    project: IKlProject;\n    timestamp: number;\n    thumbnail: HTMLImageElement | HTMLCanvasElement;\n};\n\nconst thumbSize = 240;\n\nfunction loadImage (blob: Blob): Promise<HTMLImageElement> {\n    return new Promise<HTMLImageElement>((resolve, reject) => {\n        const im = new Image();\n        try {\n            im.src = BB.imageBlobToUrl(blob);\n        } catch (e) {\n            reject('imageBlobToUrl, ' + (e instanceof Error ? e.message : ''));\n            return;\n        }\n        im.onload = (): void => {\n            URL.revokeObjectURL(im.src);\n            resolve(im);\n        };\n        im.onabort = (): void => {\n            reject('layer image failed loading');\n        };\n        im.onerror = (): void => {\n            reject('layer image failed loading');\n        };\n    });\n}\n\n/**\n * for:\n * - preparing project to be stored in ProjectStore\n * - reading a project that came out of the ProjectStore\n */\nexport class ProjectConverter {\n\n    private static createThumbnail (project: IKlProject): HTMLCanvasElement {\n        const size = BB.fitInto(project.width, project.height, thumbSize, thumbSize);\n        const factor = size.width / project.width;\n        return drawProject(project, factor);\n    }\n\n    static createStorageProject (project: IKlProject): IKlStorageProject {\n        return {\n            id: 1,\n            timestamp: new Date().getTime(),\n            thumbnail: base64ToBlob(ProjectConverter.createThumbnail(project).toDataURL('image/png')),\n            width: project.width,\n            height: project.height,\n            layers: project.layers.map(item => {\n                let blob;\n                if (item.image instanceof HTMLCanvasElement) {\n                    blob = base64ToBlob((item.image as HTMLCanvasElement).toDataURL('image/png'));\n                } else {\n                    // todo image\n                    throw new Error('Not implemented');\n                }\n                return {\n                    name: item.name,\n                    isVisible: item.isVisible,\n                    opacity: item.opacity,\n                    mixModeStr: item.mixModeStr,\n                    blob,\n                };\n            }),\n        };\n    }\n\n    static async readStorageProject (storageProject: IKlStorageProject): Promise<TReadStorageProjectResult> {\n        if (\n            !storageProject.width || !storageProject.height ||\n            isNaN(storageProject.width) || isNaN(storageProject.height) ||\n            storageProject.width < 1 || storageProject.height < 1\n        ) {\n            throw new Error('readStorageProject invalid canvas size: ' + storageProject.width + ', ' + storageProject.height);\n        }\n        const project: IKlProject = {\n            width: storageProject.width,\n            height: storageProject.height,\n            layers: (await Promise.all(storageProject.layers.map(layer => loadImage(layer.blob))))\n                .map((image, i) => {\n                    const storageLayer = storageProject.layers[i];\n                    return {\n                        name: storageLayer.name,\n                        isVisible: 'isVisible' in storageLayer ? storageLayer.isVisible : true, // isVisible added 2023-07\n                        opacity: storageLayer.opacity,\n                        mixModeStr: storageLayer.mixModeStr,\n                        image,\n                    };\n                }),\n        };\n\n        let thumbnail;\n        if (storageProject.thumbnail) {\n            thumbnail = await loadImage(storageProject.thumbnail);\n        } else {\n            thumbnail = ProjectConverter.createThumbnail(project);\n        }\n\n        return {\n            project: project,\n            timestamp: storageProject.timestamp,\n            thumbnail: thumbnail,\n        };\n    }\n\n}","\nexport function base64ToBlob (base64Str: string): Blob {\n    const parts = base64Str.match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/) as [string, string ,string, string];\n    const binStr = atob(parts[3]);\n    const buf = new ArrayBuffer(binStr.length);\n    const view = new Uint8Array(buf);\n    for (let i = 0; i < view.length; i++) {\n        view[i] = binStr.charCodeAt(i);\n    }\n    return new Blob([view], {'type': parts[1]});\n}","import {BB} from '../../../bb/bb';\nimport {KL} from '../../kl';\nimport {BrowserStorageUi} from '../components/browser-storage-ui';\nimport {IKlProject, TDropOption, TExportType} from '../../kl-types';\nimport {SaveReminder} from '../components/save-reminder';\nimport {ProjectStore} from '../../storage/project-store';\nimport {LANG} from '../../../language/language';\nimport newImageImg from '/src/app/img/ui/new-image.svg';\nimport exportImg from '/src/app/img/ui/export.svg';\nimport shareImg from '/src/app/img/ui/share.svg';\nimport uploadImg from '/src/app/img/ui/upload.svg';\nimport importImg from '/src/app/img/ui/import.svg';\nimport copyImg from '/src/app/img/ui/copy.svg';\n\nexport class FileTab {\n\n    private readonly rootEl: HTMLDivElement;\n    private importButton: undefined | HTMLInputElement;\n    private fileBrowserStorage: undefined | BrowserStorageUi;\n\n    constructor (\n        klRootEl: HTMLElement,\n        projectStore: ProjectStore,\n        getProject: () => IKlProject,\n        private exportType: TExportType,\n        onExportTypeChange: (type: TExportType) => void,\n        onFileSelect: (fileList: FileList, optionStr: TDropOption) => void,\n        onSaveImageToComputer: () => void,\n        onNewImage: () => void,\n        onShareImage: (callback: () => void) => void,\n        onUpload: () => void,\n        onCopyToClipboard: () => void,\n        saveReminder: SaveReminder,\n    ) {\n        this.rootEl = document.createElement('div');\n\n        const asyncCreation = (): void => {\n            const fileMenu = document.createElement('div');\n            const newButton = document.createElement('button');\n            const saveButton = document.createElement('button');\n            const shareButton = document.createElement('button');\n            const uploadImgurButton = document.createElement('button');\n            const clipboardButton = document.createElement('button');\n\n            newButton.style.cssFloat = 'left';\n            BB.css(saveButton, {\n                cssFloat: 'left',\n                clear: 'both',\n                flexGrow: '1',\n            });\n            BB.css(clipboardButton, {\n                cssFloat: 'left',\n                clear: 'both',\n            });\n\n            newButton.tabIndex = -1;\n            saveButton.tabIndex = -1;\n            shareButton.tabIndex = -1;\n            uploadImgurButton.tabIndex = -1;\n            clipboardButton.tabIndex = -1;\n\n            newButton.innerHTML = `<img class=\"dark-no-invert\" src='${newImageImg}' alt='icon' height='20'/>${LANG('file-new')}`;\n            saveButton.innerHTML = `<img src='${exportImg}' alt='icon' height='20'/>${LANG('file-save')}`;\n            shareButton.innerHTML = `<img src='${shareImg}' alt='icon' height='20'/>${LANG('file-share')}`;\n            uploadImgurButton.innerHTML = `<img style='float:left' src='${uploadImg}' height='20' alt='icon'/>${LANG('file-upload')}`;\n            clipboardButton.innerHTML = `<img src='${copyImg}' alt='icon' height='20'/>${LANG('file-copy')}`;\n            clipboardButton.title = LANG('file-copy-title');\n            newButton.className = 'grid-button';\n            saveButton.className = 'grid-button';\n            shareButton.className = 'grid-button';\n            uploadImgurButton.className = 'grid-button';\n            clipboardButton.className = 'grid-button';\n\n            const importWrapper = BB.el({\n                className: 'grid-button',\n                css: {\n                    position: 'relative',\n                    cursor: 'pointer',\n                    cssFloat: 'left',\n                },\n            });\n            const innerMask = BB.el({\n                parent: importWrapper,\n                css: {\n                    width: '120px',\n                    height: '28px',\n                    overflow: 'hidden',\n                    cursor: 'pointer',\n                    position: 'relative',\n                },\n            });\n            this.importButton = BB.el({\n                tagName: 'input',\n                parent: innerMask,\n                css: {\n                    display: 'none',\n                },\n            });\n            this.importButton.tabIndex = -1;\n            this.importButton.type = 'file';\n            this.importButton.multiple = true;\n            this.importButton.accept = 'image';\n            this.importButton.size = 71;\n            this.importButton.onchange = () => {\n                if (!this.importButton) {\n                    return;\n                }\n                this.importButton.files && onFileSelect(this.importButton.files, 'default');\n                this.importButton.value = '';\n            };\n\n            const importFakeButton = BB.el({\n                tagName: 'button',\n                parent: importWrapper,\n                content: \"<img class=\\\"dark-no-invert\\\" style='float:left' height='20' src='\" + importImg + \"' alt='icon'/>\" + LANG('file-import'),\n                css: {\n                    width: '120px',\n                    display: 'box',\n                    position: 'absolute',\n                    left: '0',\n                    top: '0',\n                    cursor: 'pointer',\n                },\n            });\n            importFakeButton.tabIndex = -1;\n            importFakeButton.onclick = () => this.importButton && this.importButton.click();\n\n            // --- export filetype dropdown ---\n            const exportTypeSelect = new KL.Select({\n                optionArr: [\n                    ['png', 'PNG'],\n                    ['psd', 'PSD'],\n                    ['layers', LANG('layers') + ' (PNG)'],\n                ],\n                initValue: this.exportType,\n                onChange: (val) => {\n                    this.exportType = val as TExportType;\n                    onExportTypeChange(this.exportType);\n                    onSaveImageToComputer();\n                },\n                title: LANG('file-format'),\n            });\n            BB.css(exportTypeSelect.getElement(), {\n                width: '50%',\n                height: '30px',\n                marginTop: '10px',\n                marginLeft: '10px',\n            });\n\n\n\n            newButton.onclick = onNewImage;\n            saveButton.onclick = () => {\n                onSaveImageToComputer();\n            };\n            shareButton.onclick = () => {\n                shareButton.disabled = true;\n                onShareImage(() => {\n                    shareButton.disabled = false;\n                });\n            };\n            uploadImgurButton.onclick = () => onUpload();\n\n            clipboardButton.onclick = () => {\n                clipboardButton.blur();\n                onCopyToClipboard();\n            };\n\n            const saveNote = BB.el({\n                className: 'kl-toolspace-note',\n                textContent: LANG('file-no-autosave'),\n                css: {\n                    margin: '10px 10px 0 10px',\n                },\n            });\n\n            const createSpacer = () => {\n                const el = document.createElement('div');\n                const clearer = document.createElement('div');\n                const line = BB.el({\n                    className: 'grid-hr',\n                });\n                el.append(clearer, line);\n                BB.css(clearer, {\n                    clear: 'both',\n                });\n                return el;\n            };\n\n            this.fileBrowserStorage = new BrowserStorageUi(projectStore, getProject, saveReminder, klRootEl);\n            BB.css(this.fileBrowserStorage.getElement(), {\n                //background: 'red',\n                margin: '10px',\n            });\n\n            const saveRow = BB.el({\n                content: [saveButton, exportTypeSelect.getElement()],\n                className: 'kl-file-save-row',\n            });\n\n            //actual structure\n            BB.append(fileMenu, [\n                saveNote,\n                newButton,\n                importWrapper,\n                BB.el({css: {clear: 'both'}}),\n\n                saveRow,\n\n                clipboardButton,\n                BB.canShareFiles() ? shareButton : undefined,\n                BB.el({css: {clear: 'both'}}),\n\n                createSpacer(),\n                this.fileBrowserStorage.getElement(),\n                createSpacer(),\n                uploadImgurButton,\n            ]);\n\n            this.rootEl.append(fileMenu);\n        };\n\n        setTimeout(asyncCreation, 1);\n    }\n\n    refresh (): void {\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsVisible (isVisible: boolean): void {\n        if (isVisible) {\n            this.refresh();\n        }\n    }\n\n    triggerImport (): void {\n        this.importButton && this.importButton.click();\n    }\n}\n","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"upload.5289e924.svg\";","import {BB} from '../../../bb/bb';\nimport {KL} from '../../kl';\nimport {klHistory} from '../../history/kl-history';\nimport {IKeyString} from '../../../bb/bb-types';\nimport {StatusOverlay} from '../components/status-overlay';\nimport {KlCanvasWorkspace} from '../../canvas-ui/kl-canvas-workspace';\nimport {KlCanvas} from '../../canvas/kl-canvas';\nimport {LANG} from '../../../language/language';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../../kl-types';\nimport {KlColorSlider} from '../components/kl-color-slider';\nimport {LayerManager} from './layer-manager/layer-manager';\nimport {HandUi} from './hand-ui';\nimport {RGB} from '../../../bb/color/color';\nimport {getSharedFx} from '../../../fx-canvas/shared-fx';\nimport {c} from '../../../bb/base/c';\n\n\nexport class FilterTab {\n\n    private readonly rootEl: HTMLDivElement;\n    private isInit = false;\n\n    private testHasWebGL (): boolean {\n        return !!getSharedFx();\n    }\n\n    constructor (\n        private klRootEl: HTMLElement,\n        private klColorSlider: KlColorSlider,\n        private layerManager: LayerManager,\n        private klCanvasWorkspace: KlCanvasWorkspace,\n        private handUi: HandUi,\n        private getCurrentColor: () => RGB,\n        private getKlMaxCanvasSize: () => number,\n        private getKlCanvas: () => KlCanvas,\n        private getCurrentLayerCtx: () => CanvasRenderingContext2D | null,\n        private isEmbed: boolean,\n        private statusOverlay: StatusOverlay,\n    ) {\n        this.rootEl = document.createElement('div');\n    }\n\n    private init (): void {\n        const filters = KL.filterLib;\n        const buttons = [];\n\n        if (!KL.filterLibStatus.isLoaded) {\n            throw new Error('filters not loaded');\n        }\n\n        const hasWebGL: boolean = this.testHasWebGL();\n\n        if (!hasWebGL) {\n            const note = BB.el({\n                parent: this.rootEl,\n                className: 'kl-toolspace-note',\n                content: 'Features disabled because WebGL is failing.',\n                css: {\n                    margin: '10px',\n                    marginBottom: '0',\n                },\n            });\n            const noteButton = BB.el({\n                parent: note,\n                tagName: 'button',\n                textContent: 'Learn More',\n                css: {\n                    marginLeft: '5px',\n                },\n            });\n            noteButton.onclick = () => {\n                KL.popup({\n                    target: this.klRootEl,\n                    message: '<b>WebGL is not working</b>',\n                    div: BB.el({\n                        content: `\nSee if your browser supports WebGL and has it enabled: <a href=\"https://get.webgl.org\" target=\"_blank\" rel=\"noopener noreferrer\">get.webgl.org</a><br>\n<br>\nRecently (2023-05) a number of Chrome users on Chrome OS reported that WebGL fails, although it is enabled & supported.\nThis has been reported to Google.\n`,\n                    }),\n                    buttons: ['Ok'],\n                    clickOnEnter: 'Ok',\n                });\n            };\n        }\n\n        const createButton = (filterKey: string): HTMLElement => {\n            const filter = filters[filterKey];\n\n            const button = document.createElement('button');\n            const buttonLabel = LANG(filter.lang.button);\n            const imClass = filter.darkNoInvert ? 'class=\"dark-no-invert\"' : '';\n            const im = '<img ' + imClass + ' height=\"20\" width=\"18\" src=\"' + filter.icon + '\" style=\"margin-right: 3px\" alt=\"icon\" />';\n            button.innerHTML = im + buttonLabel;\n            button.className = 'grid-button grid-button--filter';\n            BB.css(button, {\n                lineHeight: '20px',\n                fontSize: '12px',\n            });\n            button.tabIndex = -1;\n\n            const filterName = LANG(filter.lang.name);\n\n            let isEnabled = true;\n            if (filter.webGL && !hasWebGL) {\n                isEnabled = false;\n            }\n\n            if (isEnabled) {\n                button.onclick = () => {\n\n                    type TOptions = 'Ok' | 'Cancel';\n                    const dialogButtons: TOptions[] = ['Ok', 'Cancel'];\n\n                    const finishedDialog = (result: TOptions, filterDialog: TFilterGetDialogResult<any>): void => {\n                        if ('error' in filterDialog) {\n                            return;\n                        }\n                        if (result == 'Cancel') {\n                            if (filterDialog.destroy) {\n                                filterDialog.destroy();\n                            }\n                            return;\n                        }\n                        let input;\n                        try {\n                            input = filterDialog.getInput!(); // also destroys\n                        } catch (e) {\n                            if ((e as Error).message.indexOf('.getInput is not a function') !== -1) {\n                                throw 'filterDialog.getInput is not a function, filter: ' + filterName;\n                            } else {\n                                throw e;\n                            }\n                        }\n                        applyFilter(input);\n                    };\n\n                    if (!('apply' in filters[filterKey])) {\n                        KL.popup({\n                            target: this.klRootEl,\n                            message: 'Application not fully loaded',\n                            type: 'error',\n                        });\n                        return;\n                    }\n\n                    const applyFilter = (input: any) => {\n                        const filterResult = filters[filterKey].apply!({\n                            context: this.getCurrentLayerCtx(),\n                            klCanvas: this.getKlCanvas(),\n                            history: klHistory,\n                            input: input,\n                        } as IFilterApply);\n                        if (filterResult === false) {\n                            KL.popup({\n                                target: this.klRootEl,\n                                message: \"Couldn't apply the edit action\",\n                                type: 'error',\n                            });\n                        }\n                        if (filters[filterKey].updatePos === true) {\n                            this.klCanvasWorkspace.resetOrFitView();\n                            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n                        }\n                        this.layerManager.update();\n                    };\n\n                    if (filters[filterKey].isInstant){\n                        button.blur();\n                        applyFilter(null);\n                        this.statusOverlay.out('\"' + filterName + '\" ' + LANG('filter-applied'), true);\n                    } else {\n                        const secondaryColorRGB = this.klColorSlider.getSecondaryRGB();\n                        let filterDialog: TFilterGetDialogResult<any> | undefined = undefined;\n\n                        try {\n                            filterDialog = filters[filterKey].getDialog!({\n                                context: this.getCurrentLayerCtx(),\n                                klCanvas: this.getKlCanvas(),\n                                maxWidth: this.getKlMaxCanvasSize(),\n                                maxHeight: this.getKlMaxCanvasSize(),\n                                currentColorRgb: {r: this.getCurrentColor().r, g: this.getCurrentColor().g, b: this.getCurrentColor().b},\n                                secondaryColorRgb: {r: secondaryColorRGB.r, g: secondaryColorRGB.g, b: secondaryColorRGB.b},\n                            } as IFilterGetDialogParam) as TFilterGetDialogResult;\n                        } catch (e) {\n                            setTimeout(() => {\n                                throw e;\n                            });\n                        }\n\n                        if (!filterDialog || 'error' in filterDialog) {\n                            KL.popup({\n                                target: this.klRootEl,\n                                message: filterDialog ? filterDialog.error : 'Error: Could not perform action.',\n                                type: 'error',\n                            });\n                            return;\n                        }\n\n                        let closeFunc: () => void;\n                        // Todo should move into getDialogParams\n                        filterDialog.errorCallback = (e) => {\n                            KL.popup({\n                                target: this.klRootEl,\n                                message: 'Error: Could not perform action.',\n                                type: 'error',\n                            });\n                            setTimeout(() => {\n                                throw e;\n                            }, 0);\n                            closeFunc();\n                        };\n\n\n                        const style: IKeyString = {};\n                        if ('width' in filterDialog) {\n                            style.width = filterDialog.width + 'px';\n                        }\n\n                        let title: HTMLElement;\n                        {\n                            const els: HTMLElement[] = [\n                                c('b', filterName),\n                            ];\n                            if (filter.lang.description !== undefined) {\n                                els.push(c({\n                                    className: 'kl-info-btn',\n                                    onClick: () => {\n                                        KL.popup({\n                                            target: this.klRootEl,\n                                            message: LANG(filter.lang.description!),\n                                        });\n                                    },\n                                    title: LANG(filter.lang.description!),\n                                    noRef: true,\n                                }, '?'));\n                            }\n                            title = c(',flex,gap-5', els);\n                        }\n\n\n\n\n                        KL.popup({\n                            target: this.klRootEl,\n                            message: title,\n                            div: filterDialog.element,\n                            style: style,\n                            buttons: dialogButtons,\n                            clickOnEnter: 'Ok',\n                            callback: (result) => {\n                                finishedDialog(result as TOptions, filterDialog!);\n                            },\n                            closeFunc: (func) => {\n                                closeFunc = func;\n                            },\n                        });\n                    }\n                };\n            } else {\n                button.disabled = true;\n            }\n\n            buttons.push(button);\n            return button;\n        };\n\n        const addGroup = (groupArr: string[]): void => {\n            Object.entries(filters).forEach(([filterKey, filter]) => {\n                if (!groupArr.includes(filterKey)) {\n                    return;\n                }\n                if (this.isEmbed && !filter.inEmbed) {\n                    return;\n                }\n                this.rootEl.append(createButton(filterKey));\n            });\n        };\n\n        const groupA = [\n            'cropExtend',\n            'flip',\n            'perspective',\n            'resize',\n            'rotate',\n            'transform',\n        ];\n        const groupB = [\n            'brightnessContrast',\n            'curves',\n            'distort',\n            'hueSaturation',\n            'invert',\n            'tiltShift',\n            'toAlpha',\n            'blur',\n            'unsharpMask',\n        ];\n        const groupC = [\n            'grid',\n            'noise',\n            'pattern',\n            'vanishPoint',\n        ];\n\n        addGroup(groupA);\n        this.rootEl.append(BB.el({className: 'grid-hr'}));\n        addGroup(groupB);\n        this.rootEl.append(BB.el({className: 'grid-hr'}));\n        addGroup(groupC);\n\n        this.isInit = true;\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    show (): void {\n        if (!this.isInit) {\n            this.init();\n        }\n        this.rootEl.style.display = 'block';\n    }\n\n    hide (): void {\n        this.rootEl.style.display = 'none';\n    }\n\n}","import {fxCanvas} from './fx-canvas';\nimport {TFxCanvas} from './fx-canvas-types';\n\nlet failed = false;\nlet fx: TFxCanvas | null = null;\n\nexport function getSharedFx (): TFxCanvas | null {\n    // failed previously, don't need to try again.\n    if (failed) {\n        return fx;\n    }\n\n    if (!fx || fx._.gl.isContextLost()) {\n        try {\n            fx = fxCanvas();\n        } catch (e) {\n            failed = true;\n            fx = null;\n            setTimeout(() => {\n                throw e;\n            });\n        }\n    }\n    return fx;\n}","import {brightnessContrast} from './filters/brightness-contrast';\nimport {FxShader} from './core/fx-shader';\nimport {gl, setGl} from './core/gl';\nimport {FxTexture} from './core/fx-texture';\nimport {curves} from './filters/curves';\nimport {hueSaturation} from './filters/hue-saturation';\nimport {noise} from './filters/noise';\nimport {triangleBlur} from './filters/triangle-blur';\nimport {tiltShift} from './filters/tilt-shift';\nimport {matrixWarp} from './filters/matrix-warp';\nimport {unsharpMask} from './filters/unsharp-mask';\nimport {toAlpha} from './filters/to-alpha';\nimport {invert} from './filters/invert';\nimport {perspective} from './filters/perspective';\nimport {unmultiplyAlpha} from './filters/unmultiply-alpha';\nimport {distort} from './filters/distort';\nimport {multiplyAlpha} from './filters/multiply-alpha';\nimport {TFxCanvas, TFxGl, TFxSupportedElements, TWrappedTexture} from './fx-canvas-types';\nimport {BB} from '../bb/bb';\n\n/*\n * based on glfx.js\n * https://github.com/evanw/glfx.js/\n * Copyright 2011 Evan Wallace\n * Released under the MIT license\n */\n\n/**\n * Before you can apply any filters you will need a canvas, which stores the result of the filters you apply.\n * Canvas creation is done through fxCanvas(), which creates and returns a new WebGL <canvas> tag with additional\n * methods specific to fxCanvas. This call will throw an error message if the browser doesn't support WebGL.\n *\n * This library provides realtime image effects using WebGL. There are three parts to it:\n * - texture - a raw source of image data (created from <img> <canvas> or <video>)\n * - filter - an image effect (represents one or more WebGL shaders)\n * - canvas - an image buffer that stores the results (a WebGL <canvas> tag)\n */\nexport const fxCanvas: (() => TFxCanvas) = (function () {\n\n    function wrapTexture (texture: FxTexture): TWrappedTexture {\n        return {\n            _: texture,\n            loadContentsOf: function (element) {\n                // Make sure that we're using the correct global WebGL context\n                setGl(this._.gl);\n                this._.loadContentsOf(element);\n            },\n            destroy: function () {\n                // Make sure that we're using the correct global WebGL context\n                setGl(this._.gl);\n                this._.destroy();\n            },\n        };\n    }\n\n    function texture (element: TFxSupportedElements) {\n        return wrapTexture(FxTexture.fromElement(element));\n    }\n\n    function getTextureType (): GLenum {\n        let textureType: GLenum = gl.UNSIGNED_BYTE;\n\n        // Go for floating point buffer textures if we can, it'll make the bokeh\n        // filter look a lot better. Note that on Windows, ANGLE does not let you\n        // render to a floating-point texture when linear filtering is enabled.\n        // See http://crbug.com/172278 for more information.\n        if (\n            gl.getExtension('WEBGL_color_buffer_float') && // firefox shows warning without this line\n            gl.getExtension('OES_texture_float') &&\n            gl.getExtension('OES_texture_float_linear')\n        ) {\n            const testTexture = new FxTexture(100, 100, gl.RGBA, gl.FLOAT);\n            try {\n                // Only use gl.FLOAT if we can render to it\n                testTexture.drawTo(function () {\n                    textureType = gl.FLOAT;\n                });\n            } catch (e) {\n                /* empty */\n            }\n            testTexture.destroy();\n        }\n        return textureType;\n    }\n\n    function initialize (this: TFxCanvas, width: number, height: number): void {\n        const textureType = getTextureType();\n        if (this._.texture) {\n            this._.texture.destroy();\n        }\n        if (this._.spareTexture) {\n            this._.spareTexture.destroy();\n        }\n        this.width = width;\n        this.height = height;\n        this._.texture = new FxTexture(width, height, gl.RGBA, textureType);\n        this._.spareTexture = new FxTexture(width, height, gl.RGBA, textureType);\n        this._.extraTexture = this._.extraTexture || new FxTexture(0, 0, gl.RGBA, textureType);\n        this._.flippedShader = this._.flippedShader || new FxShader(null, `\nuniform sampler2D texture;\nvarying vec2 texCoord;\nvoid main() {\n    gl_FragColor = texture2D(texture, vec2(texCoord.x, 1.0 - texCoord.y));\n}\n        `, 'flippedShader');\n        this._.isInitialized = true;\n    }\n\n    function draw (this: TFxCanvas, texture: TWrappedTexture, width?: number, height?: number): TFxCanvas {\n        if (!this._.isInitialized || texture._.width != this.width || texture._.height != this.height) {\n            initialize.call(this, width ? width : texture._.width, height ? height : texture._.height);\n        }\n\n        texture._.use();\n        this._.texture.drawTo(function () {\n            FxShader.getDefaultShader().drawRect();\n        });\n\n        return this;\n    }\n\n    function update (this: TFxCanvas): TFxCanvas {\n        this._.texture.use();\n        this._.flippedShader.drawRect();\n        return this;\n    }\n\n    function contents (this: TFxCanvas): TWrappedTexture {\n        const texture = new FxTexture(this._.texture.width, this._.texture.height, gl.RGBA, gl.UNSIGNED_BYTE);\n        this._.texture.use();\n        texture.drawTo(function () {\n            FxShader.getDefaultShader().drawRect();\n        });\n        return wrapTexture(texture);\n    }\n\n    /*\n       Get a Uint8 array of pixel values: [r, g, b, a, r, g, b, a, ...]\n       Length of the array will be width * height * 4.\n    */\n    function getPixelArray (this: TFxCanvas): Uint8Array {\n        const w = this._.texture.width;\n        const h = this._.texture.height;\n        const array = new Uint8Array(w * h * 4);\n        this._.texture.drawTo(function () {\n            gl.readPixels(0, 0, w, h, gl.RGBA, gl.UNSIGNED_BYTE, array);\n        });\n        return array;\n    }\n\n    function wrap<F extends (...args: any[]) => unknown>(fn: F): F {\n        return <F>function (this: TFxCanvas, ...args: any[]) {\n            // Make sure that we're using the correct global WebGL context\n            setGl(this._.gl);\n            // Now that the context has been switched, we can call the wrapped function\n            return fn.apply(this, args);\n        };\n    }\n\n    function getWebGlContext (canvas: HTMLCanvasElement, options?: WebGLContextAttributes): WebGLRenderingContext | null {\n        const contextNames = ['webgl', 'experimental-webgl', 'webgl2'];\n        let context: WebGLRenderingContext | null = null;\n        contextNames.forEach(name => {\n            if (context) {\n                return;\n            }\n            // get.webgl.org does a try-catch\n            try {\n                context = canvas.getContext(name, options) as (typeof context);\n            } catch (e) {\n                /* empty */\n            }\n        });\n        return context;\n    }\n\n    return (): TFxCanvas => {\n        if (!window.WebGLRenderingContext) {\n            throw 'WebGLRenderingContext not set. Browser does not support WebGL.';\n        }\n\n        const canvas: TFxCanvas = BB.canvas(1, 1) as TFxCanvas;\n        const context = getWebGlContext(canvas, {premultipliedAlpha: false});\n        if (!context) {\n            throw 'This browser does not support WebGL';\n        }\n        setGl(context as TFxGl);\n\n        canvas._ = {\n            gl,\n            isInitialized: false,\n            texture: null,\n            spareTexture: null,\n            flippedShader: null,\n        } as any;\n\n        // Core methods\n        canvas.texture = wrap(texture);\n        canvas.draw = wrap(draw);\n        canvas.update = wrap(update);\n        canvas.contents = wrap(contents);\n        canvas.getPixelArray = wrap(getPixelArray);\n\n        // Filter methods\n        canvas.brightnessContrast = wrap(brightnessContrast);\n        canvas.hueSaturation = wrap(hueSaturation);\n        canvas.triangleBlur = wrap(triangleBlur);\n        canvas.unsharpMask = wrap(unsharpMask);\n        canvas.perspective = wrap(perspective);\n        canvas.matrixWarp = wrap(matrixWarp);\n        canvas.tiltShift = wrap(tiltShift);\n        canvas.noise = wrap(noise);\n        canvas.curves = wrap(curves);\n        canvas.invert = wrap(invert);\n        canvas.multiplyAlpha = wrap(multiplyAlpha);\n        canvas.unmultiplyAlpha = wrap(unmultiplyAlpha);\n        canvas.toAlpha = wrap(toAlpha);\n        canvas.distort = wrap(distort);\n\n        return canvas as TFxCanvas;\n    };\n})();","import {BB} from '../../bb/bb';\nimport {simpleShader} from '../core/simple-shader';\nimport {FxShader} from '../core/fx-shader';\nimport {gl} from '../core/gl';\nimport {TFxCanvas} from '../fx-canvas-types';\n\n/**\n * @type Brightness / Contrast\n * Provides additive brightness and multiplicative contrast control.\n * @param brightness -1 to 1 (-1 is solid black, 0 is no change, and 1 is solid white)\n * @param contrast   -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\n */\nexport type TFilterBrightnessContrast = (\n    this: TFxCanvas,\n    brightness: number,\n    contrast: number\n) => TFxCanvas;\n\nexport const brightnessContrast: TFilterBrightnessContrast = function (brightness, contrast) {\n    gl.brightnessContrast = gl.brightnessContrast || new FxShader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float brightness;\\\n        uniform float contrast;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            color.rgb += brightness;\\\n            if (contrast > 0.0) {\\\n                color.rgb = (color.rgb - 0.5) / (1.0 - contrast) + 0.5;\\\n            } else {\\\n                color.rgb = (color.rgb - 0.5) * (1.0 + contrast) + 0.5;\\\n            }\\\n            gl_FragColor = color;\\\n        }\\\n    ', 'brightnessContrast');\n\n    simpleShader.call(this, gl.brightnessContrast, {\n        brightness: BB.clamp(brightness, -1, 1),\n        contrast: BB.clamp(contrast, -1, 1),\n    });\n\n    return this;\n};","import {TFxCanvas, TUniforms} from '../fx-canvas-types';\nimport {FxTexture} from './fx-texture';\nimport {FxShader} from './fx-shader';\n\nexport function simpleShader (\n    this: TFxCanvas,\n    shader: FxShader,\n    uniforms: TUniforms<number | number[]>,\n    textureIn?: FxTexture,\n    textureOut?: FxTexture\n): void {\n    (textureIn || this._.texture).use();\n    this._.spareTexture.drawTo(function () {\n        shader.uniforms(uniforms).drawRect();\n    });\n    this._.spareTexture.swapWith(textureOut || this._.texture);\n}","import {gl} from './gl';\nimport {TUniforms} from '../fx-canvas-types';\nimport {BB} from '../../bb/bb';\n\n// VERTEX_SHADER | FRAGMENT_SHADER\ntype TShaderType = GLenum;\n\nconst defaultVertexSource = '\\\n    attribute vec2 vertex;\\\n    attribute vec2 _texCoord;\\\n    varying vec2 texCoord;\\\n    void main() {\\\n        texCoord = _texCoord;\\\n        gl_Position = vec4(vertex * 2.0 - 1.0, 0.0, 1.0);\\\n    }';\n\nconst defaultFragmentSource = '\\\n    uniform sampler2D texture;\\\n    varying vec2 texCoord;\\\n    void main() {\\\n        gl_FragColor = texture2D(texture, texCoord);\\\n    }';\n\nfunction isArray (obj: unknown): obj is unknown[] {\n    return Object.prototype.toString.call(obj) == '[object Array]';\n}\n\nfunction isNumber (obj: unknown): obj is number {\n    return Object.prototype.toString.call(obj) == '[object Number]';\n}\n\nlet floatPrecision: 'lowp' | 'mediump' | 'highp' | undefined;\n\nexport class FxShader {\n\n    // ---- static ----\n    static getDefaultShader (): FxShader {\n        gl.defaultShader = gl.defaultShader || new FxShader();\n        return gl.defaultShader;\n    }\n\n\n    // ---- private ----\n\n    private compileSource (type: TShaderType, source: string, nameStr: string): WebGLShader {\n        const shader = BB.throwIfNull(gl.createShader(type));\n        gl.shaderSource(shader, source.replace(/#define.*/, '')); // glslify adds a line add the beginning that breaks it\n        gl.compileShader(shader);\n        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n            throw 'compile error: ' + nameStr + ' - ' + gl.getShaderInfoLog(shader);\n        }\n        return shader;\n    }\n\n    /**\n     * HIGH_FLOAT | MEDIUM_FLOAT\n     */\n    private testPrecisionSupport (precisionType: GLenum): boolean {\n        const format = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, precisionType);\n        return format !== null && format.precision !== 0;\n    }\n\n    // ---- public ----\n    constructor (\n        vertexSource?: string | null,\n        fragmentSource?: string | null,\n        nameStr?: string,\n    ) {\n        this.vertexAttribute = null;\n        this.texCoordAttribute = null;\n        this.program = BB.throwIfNull(gl.createProgram());\n        vertexSource = vertexSource || defaultVertexSource;\n        fragmentSource = fragmentSource || defaultFragmentSource;\n        if (!floatPrecision) {\n            floatPrecision = this.testPrecisionSupport(gl.HIGH_FLOAT) ? 'highp' : (this.testPrecisionSupport(gl.MEDIUM_FLOAT) ? 'mediump' : 'lowp');\n        }\n        fragmentSource = 'precision ' + floatPrecision + ' float;' + fragmentSource; // annoying requirement is annoying\n        gl.attachShader(this.program, this.compileSource(gl.VERTEX_SHADER, vertexSource, nameStr + '(vertex)'));\n        gl.attachShader(this.program, this.compileSource(gl.FRAGMENT_SHADER, fragmentSource, nameStr + '(fragment)'));\n        gl.linkProgram(this.program);\n        if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\n            throw 'link error: ' + gl.getProgramInfoLog(this.program);\n        }\n    }\n\n    // ---- interface ----\n    \n    vertexAttribute: null | number;\n    texCoordAttribute: null | number;\n    program: WebGLProgram | null; // null = destroyed\n\n    destroy (): void {\n        gl.deleteProgram(this.program);\n        this.program = null;\n    }\n\n    uniforms (uniforms: TUniforms<number | number[]>): FxShader {\n        gl.useProgram(this.program);\n        Object.entries(uniforms).forEach(([name, value]) => {\n\n            const location = gl.getUniformLocation(this.program!, name);\n            if (location === null) {\n                // will be null if the uniform isn't used in the shader\n                return;\n            }\n\n            if (isArray(value)) {\n                switch (value.length) {\n                    case 1:\n                        gl.uniform1fv(location, new Float32Array(value));\n                        break;\n                    case 2:\n                        gl.uniform2fv(location, new Float32Array(value));\n                        break;\n                    case 3:\n                        gl.uniform3fv(location, new Float32Array(value));\n                        break;\n                    case 4:\n                        gl.uniform4fv(location, new Float32Array(value));\n                        break;\n                    case 9:\n                        gl.uniformMatrix3fv(location, false, new Float32Array(value));\n                        break;\n                    case 16:\n                        gl.uniformMatrix4fv(location, false, new Float32Array(value));\n                        break;\n                    default:\n                        throw 'dont\\'t know how to load uniform \"' + name + '\" of length ' + value.length;\n                }\n            } else if (isNumber(value)) {\n                gl.uniform1f(location, value);\n            } else {\n                throw 'attempted to set uniform \"' + name + '\" to invalid value ' + ((value as any) || 'undefined').toString();\n            }\n        });\n        // allow chaining\n        return this;\n    }\n\n    //\n    /**\n     * textures are uniforms too but for some reason can't be specified by gl.uniform1f,\n     * even though floating point numbers represent the integers 0 through 7 exactly\n     */\n    textures (textures: Record<string, GLint>): FxShader {\n        gl.useProgram(this.program);\n\n        Object.entries(textures).forEach(([name, value]) => {\n            gl.uniform1i(gl.getUniformLocation(this.program!, name), value);\n        });\n\n        // allow chaining\n        return this;\n    }\n\n   drawRect (left?: number, top?: number, right?: number, bottom?: number): void {\n        let undefined;\n        const viewport = gl.getParameter(gl.VIEWPORT);\n        top = top !== undefined ? (top - viewport[1]) / viewport[3] : 0;\n        left = left !== undefined ? (left - viewport[0]) / viewport[2] : 0;\n        right = right !== undefined ? (right - viewport[0]) / viewport[2] : 1;\n        bottom = bottom !== undefined ? (bottom - viewport[1]) / viewport[3] : 1;\n        if (gl.vertexBuffer === undefined || gl.vertexBuffer === null) {\n            gl.vertexBuffer = BB.throwIfNull(gl.createBuffer());\n        }\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([left, top, left, bottom, right, top, right, bottom]), gl.STATIC_DRAW);\n        if (gl.texCoordBuffer == null) {\n            gl.texCoordBuffer = BB.throwIfNull(gl.createBuffer());\n            gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]), gl.STATIC_DRAW);\n        }\n        if (this.vertexAttribute == null) {\n            this.vertexAttribute = gl.getAttribLocation(this.program!, 'vertex');\n            gl.enableVertexAttribArray(this.vertexAttribute);\n        }\n        if (this.texCoordAttribute == null) {\n            this.texCoordAttribute = gl.getAttribLocation(this.program!, '_texCoord');\n            gl.enableVertexAttribArray(this.texCoordAttribute);\n        }\n        gl.useProgram(this.program);\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.vertexBuffer);\n        gl.vertexAttribPointer(this.vertexAttribute, 2, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, gl.texCoordBuffer);\n        gl.vertexAttribPointer(this.texCoordAttribute, 2, gl.FLOAT, false, 0, 0);\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n    }\n\n}","import {TFxGl} from '../fx-canvas-types';\n\nexport let gl: TFxGl;\n\nexport function setGl (newGl: TFxGl | null): void {\n    // more problems setting type to null\n    gl = newGl as TFxGl;\n}","import {gl} from './gl';\nimport {BB} from '../../bb/bb';\nimport {TFxGl, TFxSupportedElements} from '../fx-canvas-types';\n\n/**\n * Format           Type                    Channels    Bytes per pixel\n * RGBA             UNSIGNED_BYTE           4           4\n * RGB              UNSIGNED_BYTE           3           3\n * RGBA             UNSIGNED_SHORT_4_4_4_4  4           2\n * RGBA             UNSIGNED_SHORT_5_5_5_1  4           2\n * RGB              UNSIGNED_SHORT_5_6_5    3           2\n * LUMINANCE_ALPHA  UNSIGNED_BYTE           2           2\n * LUMINANCE        UNSIGNED_BYTE           1           1\n * ALPHA            UNSIGNED_BYTE           1           1\n *\n * https://webglfundamentals.org/webgl/lessons/webgl-data-textures.html\n */\nexport type TTextureFormat = GLenum;\nexport type TTextureType = GLenum;\n\n\nexport class FxTexture {\n    \n    // ---- static ----\n    static fromElement (element: TFxSupportedElements): FxTexture {\n        const texture = new FxTexture(0, 0, gl.RGBA, gl.UNSIGNED_BYTE);\n        texture.loadContentsOf(element);\n        return texture;\n    }\n    \n    \n    // ---- private ----\n    private canvas: HTMLCanvasElement | null;\n    private type: TTextureType;\n\n    /*\n    // never seen this being used\n    private getCanvas(texture: Texture): CanvasRenderingContext2D {\n        if (this.canvas == null) {\n            this.canvas = BB.canvas(texture.width, texture.height);\n        }\n        this.canvas.width = texture.width;\n        this.canvas.height = texture.height;\n        const c = BB.ctx(this.canvas);\n        c.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        return c;\n    }*/\n\n    \n    // ---- public ----\n    constructor (\n        width: number,\n        height: number,\n        format: TTextureFormat,\n        type: TTextureType,\n    ) {\n        this.gl = gl;\n        this.id = BB.throwIfNull(gl.createTexture());\n        this.width = width;\n        this.height = height;\n        this.format = format;\n        this.type = type;\n        this.canvas = null;\n\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        if (width && height) {\n            gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\n        }\n    }\n    \n    // ---- interface ----\n\n    gl: TFxGl;\n    width: number;\n    height: number;\n    id: WebGLTexture | null; // null -> destroyed\n    format: TTextureFormat;\n    \n    loadContentsOf (element: TFxSupportedElements): void {\n        this.width = element.width || (element as HTMLVideoElement).videoWidth;\n        this.height = element.height || (element as HTMLVideoElement).videoHeight!;\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n        gl.texImage2D(gl.TEXTURE_2D, 0, this.format, this.format, this.type, element);\n    }\n\n    initFromBytes (width: number, height: number, data: number[]): void {\n        this.width = width;\n        this.height = height;\n        this.format = gl.RGBA;\n        this.type = gl.UNSIGNED_BYTE;\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, this.type, new Uint8Array(data));\n    }\n\n    destroy (): void {\n        gl.deleteTexture(this.id);\n        this.id = null;\n    }\n\n    use (unit?: number): void {\n        gl.activeTexture(gl.TEXTURE0 + (unit || 0));\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n    }\n\n    unuse (unit: number): void {\n        gl.activeTexture(gl.TEXTURE0 + (unit || 0));\n        gl.bindTexture(gl.TEXTURE_2D, null);\n    }\n\n    ensureFormat (width: number, height: number, format: TTextureFormat, type: TTextureType): void {\n        // change the format only if required\n        if (width != this.width || height != this.height || format != this.format || type != this.type) {\n            this.width = width;\n            this.height = height;\n            this.format = format;\n            this.type = type;\n            gl.bindTexture(gl.TEXTURE_2D, this.id);\n            gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\n        }\n    }\n\n    ensureFormatViaTexture (texture: FxTexture): void {\n        this.ensureFormat(texture.width, texture.height, texture.format, texture.type);\n    }\n\n    drawTo (callback: () => void): void {\n        // start rendering to this texture\n        gl.framebuffer = gl.framebuffer || gl.createFramebuffer();\n        gl.bindFramebuffer(gl.FRAMEBUFFER, gl.framebuffer);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0);\n        if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE) {\n            throw new Error('incomplete framebuffer');\n        }\n        gl.viewport(0, 0, this.width, this.height);\n\n        // do the drawing\n        callback();\n\n        // stop rendering to this texture\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    }\n\n\n    /*\n    // never seen this being used\n    fillUsingCanvas (callback: (canvas: CanvasRenderingContext2D) => void): Texture {\n        callback(this.getCanvas(this));\n        this.format = gl.RGBA;\n        this.type = gl.UNSIGNED_BYTE;\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.canvas);\n        return this;\n    }\n\n    // never seen this being used\n    toImage (image: HTMLImageElement): void {\n        this.use();\n        Shader.getDefaultShader().drawRect();\n        const size = this.width * this.height * 4;\n        const pixels = new Uint8Array(size);\n        const c = this.getCanvas(this);\n        const data = c.createImageData(this.width, this.height);\n        gl.readPixels(0, 0, this.width, this.height, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\n        for (let i = 0; i < size; i++) {\n            data.data[i] = pixels[i];\n        }\n        c.putImageData(data, 0, 0);\n        image.src = this.canvas.toDataURL();\n    }\n     */\n\n    swapWith (other: FxTexture): void {\n        let temp;\n\n        temp = other.id;\n        other.id = this.id;\n        this.id = temp;\n\n        temp = other.width;\n        other.width = this.width;\n        this.width = temp;\n\n        temp = other.height;\n        other.height = this.height;\n        this.height = temp;\n\n        temp = other.format;\n        other.format = this.format;\n        this.format = temp;\n\n        // type?\n    }\n}\n","import {splineInterpolate} from '../math/spline-interpolate';\nimport {gl} from '../core/gl';\nimport {FxShader} from '../core/fx-shader';\nimport {simpleShader} from '../core/simple-shader';\nimport {TFxCanvas} from '../fx-canvas-types';\n\n/**\n * Curves\n * @description A powerful mapping tool that transforms the colors in the image\n *              by an arbitrary function. The function is interpolated between\n *              a set of 2D points using splines. The curves filter can take\n *              either one or three arguments which will apply the mapping to\n *              either luminance or RGB values, respectively.\n * @param red   A list of points that define the function for the red channel.\n *              Each point is a list of two values: the value before the mapping\n *              and the value after the mapping, both in the range 0 to 1. For\n *              example, [[0,1], [1,0]] would invert the red channel while\n *              [[0,0], [1,1]] would leave the red channel unchanged.\n * @param green A list of points that define the function for the green\n *              channel (just like for red).\n * @param blue  list of points that define the function for the blue\n *              channel (just like for red).\n */\nexport type TFilterCurves = (\n    this: TFxCanvas,\n    red: [number, number][],\n    green: [number, number][],\n    blue: [number, number][],\n) => TFxCanvas;\n\nexport const curves: TFilterCurves = function (red, green, blue) {\n    // Create the ramp texture\n    const redRamp = splineInterpolate(red);\n    const greenRamp = splineInterpolate(green);\n    const blueRamp = splineInterpolate(blue);\n    const array: number[] = [];\n    for (let i = 0; i < 256; i++) {\n        array.splice(array.length, 0, redRamp[i], greenRamp[i], blueRamp[i], 255);\n    }\n    this._.extraTexture.initFromBytes(256, 1, array);\n    this._.extraTexture.use(1);\n\n    gl.curves = gl.curves || new FxShader(null, '\\\n        uniform sampler2D texture;\\\n        uniform sampler2D map;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            color.r = texture2D(map, vec2(color.r)).r;\\\n            color.g = texture2D(map, vec2(color.g)).g;\\\n            color.b = texture2D(map, vec2(color.b)).b;\\\n            gl_FragColor = color;\\\n        }\\\n    ', 'curves');\n\n    gl.curves.textures({\n        map: 1,\n    });\n    simpleShader.call(this, gl.curves, {});\n\n    return this;\n};","import {BB} from '../../bb/bb';\n\nexport function splineInterpolate (points: [number, number][]): number[] {\n    const interpolator = new BB.SplineInterpolator(points);\n    const array = [];\n    for (let i = 0; i < 256; i++) {\n        array.push(\n            BB.clamp(\n                Math.floor(interpolator.interpolate(i / 255) * 256),\n                0,\n                255\n            )\n        );\n    }\n    return array;\n}","import {gl} from '../core/gl';\nimport {FxShader} from '../core/fx-shader';\nimport {simpleShader} from '../core/simple-shader';\nimport {BB} from '../../bb/bb';\nimport {TFxCanvas} from '../fx-canvas-types';\n\n/**\n * Hue / Saturation\n * @description      Provides rotational hue and multiplicative saturation control. RGB color space\n *                   can be imagined as a cube where the axes are the red, green, and blue color\n *                   values. Hue changing works by rotating the color vector around the grayscale\n *                   line, which is the straight line from black (0, 0, 0) to white (1, 1, 1).\n *                   Saturation is implemented by scaling all color channel values either toward\n *                   or away from the average color channel value.\n * @param hue        -1 to 1 (-1 is 180 degree rotation in the negative direction, 0 is no change,\n *                   and 1 is 180 degree rotation in the positive direction)\n * @param saturation -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)\n */\nexport type TFilterHueSaturation = (\n    this: TFxCanvas,\n    hue: number,\n    saturation: number,\n) => TFxCanvas;\n\nexport const hueSaturation: TFilterHueSaturation = function (hue, saturation) {\n    gl.hueSaturation = gl.hueSaturation || new FxShader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float hue;\\\n        uniform float saturation;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 color = texture2D(texture, texCoord);\\\n            \\\n            /* hue adjustment, wolfram alpha: RotationTransform[angle, {1, 1, 1}][{x, y, z}] */\\\n            float angle = hue * 3.14159265;\\\n            float s = sin(angle), c = cos(angle);\\\n            vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\\\n            float len = length(color.rgb);\\\n            color.rgb = vec3(\\\n                dot(color.rgb, weights.xyz),\\\n                dot(color.rgb, weights.zxy),\\\n                dot(color.rgb, weights.yzx)\\\n            );\\\n            \\\n            /* saturation adjustment */\\\n            float average = (color.r + color.g + color.b) / 3.0;\\\n            if (saturation > 0.0) {\\\n                color.rgb += (average - color.rgb) * (1.0 - 1.0 / (1.001 - saturation));\\\n            } else {\\\n                color.rgb += (average - color.rgb) * (-saturation);\\\n            }\\\n            \\\n            gl_FragColor = color;\\\n        }\\\n    ', 'hueSaturation');\n\n    simpleShader.call(this, gl.hueSaturation, {\n        hue: BB.clamp(hue, -1, 1),\n        saturation: BB.clamp(saturation, -1, 1),\n    });\n\n    return this;\n};\n","import {gl} from '../core/gl';\nimport {FxShader} from '../core/fx-shader';\nimport {simpleShader} from '../core/simple-shader';\nimport shaderNoise from '../shaders/shader-noise.glsl';\nimport {TFxCanvas} from '../fx-canvas-types';\n\n/**\n * Noise\n * draws noise, completely replaces original image\n */\nexport type TFilterNoise = (\n    this: TFxCanvas,\n    seed: number | undefined, // float, any value okay - default 0\n    type: number, // 1 value, 2 simplex, 3 cellular\n    scale: [number, number], // float, small scale will show repeating patterns\n    offset: [number, number], // offset x, y - large offsets will show repeating patterns\n    octaves: number, // int 0 - 4\n    samples: number, // 1 | 4 | 8 -> super-sampling\n    peaks: number, // how often it will ramp *additionally* from 0 to 1\n    brightness: number, // range [-1, 1]\n    contrast: number, // range [-1, 1]\n    isReversed: boolean, // reverse 0-1 range\n    colA: {r: number; g: number; b: number} | undefined, // which color at 0, if rgb - default black\n    colB: {r: number; g: number; b: number} | undefined, // which color at 1, if rgb - default white\n    channels: 'rgb' | 'alpha', // which channel to target\n) => TFxCanvas;\n\nexport const noise: TFilterNoise = function (\n    seed,\n    type,\n    scale,\n    offset,\n    octaves,\n    samples,\n    peaks,\n    brightness,\n    contrast,\n    isReversed,\n    colA,\n    colB,\n    channels,\n) {\n    gl.noise = gl.noise || new FxShader(null, shaderNoise.replace(/#define.*/, ''), 'noise');\n    simpleShader.call(this, gl.noise, {\n        seed: seed || 0,\n        type,\n        scale: [scale[0], scale[1]],\n        offset,\n        octaves,\n        samples,\n        texSize: [this.width, this.height],\n        peaks,\n        brightness,\n        contrast,\n        isReversed: isReversed ? 1.0 : 0.0,\n        colA: colA ? [colA.r / 255, colA.g / 255, colA.b / 255] : [0, 0, 0],\n        colB: colB ? [colB.r / 255, colB.g / 255, colB.b / 255] : [1, 1, 1],\n        channels: channels === 'rgb' ? 0 : 1,\n    });\n\n    return this;\n};","uniform sampler2D texture;\nvarying vec2 texCoord;\nuniform vec2 texSize;\n\nuniform float seed;\nuniform float type;\nuniform vec2 scale;\nuniform vec2 offset;\nuniform float octaves;\nuniform float samples;\n\nuniform float peaks;\nuniform float contrast;\nuniform float brightness;\nuniform float isReversed;\n\nuniform vec3 colA;\nuniform vec3 colB;\n\nuniform float channels; // 0 - rgb, 1 - alpha\n\n// fbm, cellular_noise based on\n// https://github.com/Gonkee/Gonkees-Shaders\n// MIT, Copyright  Gonkee\n\n// hash & simplex based on\n// https://www.shadertoy.com/view/Msf3WH\n// MIT, Copyright  2013 Inigo Quilez\n// https://www.youtube.com/c/InigoQuilez\n// https://iquilezles.org\n\n\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nfloat value_noise(vec2 coord){\n    return rand(floor(coord) / 100.0);\n}\n\nfloat cellular_noise(vec2 coord) {\n    vec2 i = floor(coord);\n    vec2 f = fract(coord);\n\n    float min_dist = 99999.0;\n    for (float x = -1.0; x <= 1.0; x++) {\n        for (float y = -1.0; y <= 1.0; y++) {\n            vec2 node = rand(i + vec2(x, y)) + vec2(x, y);\n            float dist = sqrt((f - node).x * (f - node).x + (f - node).y * (f - node).y);\n            min_dist = min(min_dist, dist);\n        }\n    }\n    return min_dist;\n}\n\n// ---------- Simplex Alternative ---------------------\n\nvec3 hash(vec3 p)\n{ p=vec3(dot(p, vec3(127.1, 311.7, 74.7))\n, dot(p, vec3(269.5, 183.3, 246.1))\n, dot(p, vec3(113.5, 271.9, 124.6)))\n;return fract(sin(p)*43758.5453123)*2.-1.; }\n\nmat3 hash(mat3 p)\n{ return mat3(hash(p[0]), hash(p[1]), hash(p[2])); }\n\nvec3 dots(mat3 a, vec3 w, mat3 b){ return vec3\n(dot(a[0], w-b[0]), dot(a[1], w-b[1]), dot(a[2], w-b[2])); }\n\n//return noiseGra13dx as .x, and its derivatives as .yzw\n// https://www.shadertoy.com/view/llByD1\nvec3 noiseGra13dx(in vec3 x) {\n    vec3 p=floor(x), w=fract(x)\n    #if 1\n    , u=w*w*w*(w*(w*6.-15.)+10.), v=30.*w*w*(w*(w-2.)+1.)//quintic hermite\n    #else\n    , u=w*w*(3.-2.*w), v=6.*w*(1.-w)//cubic hermite\n    #endif\n    //gradients\n    , G=hash(p+vec3(0)), F=hash(p+vec3(1))\n    ;mat3 D=hash(mat3(p, p, p)+mat3(1)), E=hash(mat3(p, p, p)+1.-mat3(1));\n    //projections\n    vec3 d=dots(D, w, mat3(1)), e=dots(E, w, 1.-mat3(1));\n    //interpolations\n    float g=dot(G, w), f=dot(F, w-vec3(1));\n    vec3 h=u.yzx*(g-d.xyx-d.yzz+e.zxy)+d-g, U=u*h, a=d-e;\n    mat3 S=D-mat3(G, G, G), W=D-E;\n    a.x=(a.x+a.y+a.z)+f-g;\n    ;float b=u.x*u.y*u.z;\n\n    vec4 result = vec4(g+U.x+U.y+U.z+a.x*b// value\n    , G*(1.-b)+b*(W[0]+W[1]+W[2]+F)//https://www.shadertoy.com/view/llByD1\n    +u.x*(S[0]+u.y*(G-D[0]-D[1]+E[2]))// derivatives\n    +u.y*(S[1]+u.z*(G-D[1]-D[2]+E[0]))\n    +u.z*(S[2]+u.x*(G-D[0]-D[2]+E[1]))\n    +v*(u.zxy*(g-d.xxy-d.zyz+e.yzx)+h+u.yzx*u.zxy*a.x));\n    return 0.5 + 0.5 * result.xxx;\n}\n\nfloat fbm(vec2 coord) {\n    float normalize_factor = 0.0;\n    float value = 0.0;\n    float scale = 0.5;\n\n    for (float i = 0.0; i < 7.0; i++){\n        if (i < octaves) {\n            if (type == 0.0) {\n                value += value_noise(coord) * scale;\n            } else if (type == 1.0) {\n                value += noiseGra13dx(vec3(coord.x, coord.y, 0.0)).r * scale;\n            } else if (type == 2.0) {\n                value += cellular_noise(coord) * scale;\n            }\n            normalize_factor += scale;\n            coord *= 2.0;\n            scale *= 0.5;\n        }\n    }\n    return value / normalize_factor;\n}\n\nfloat render (vec2 pos) {\n    float result = fbm(pos);\n    //\n\n    if (peaks > 0.0) {\n        result = abs(mod(result * peaks - 0.5, 1.0) - 0.5) * 2.0;// triangle\n        //result = mod(result * (peaks + 1.0), 1.0); // sawtooth\n    }\n\n    result += brightness;\n    if (contrast > 0.0) {\n        result = clamp((result - 0.5) / (1.0 - contrast) + 0.5, 0.0, 1.0);\n    } else if (contrast < 0.0) {\n        result = clamp((result - 0.5) * (1.0 + contrast) + 0.5, 0.0, 1.0);\n    }\n\n    if (isReversed == 1.0) {\n        result = 1.0 - result;\n    }\n    return result;\n}\n\n\nvoid main() {\n    vec4 color;\n\n    vec2 seedOffset;\n    seedOffset.x = (rand(vec2(seed, 0.0)) * 100.0 - 50.0);\n    seedOffset.y = (rand(vec2(0.0, seed)) * 100.0 - 50.0);\n\n    float val = 0.0;\n    vec2 basePos = texCoord * texSize / scale - offset / scale + seedOffset;\n\n    if (samples == 1.0) {\n        val = render(basePos);\n\n    }/* else if (samples == 4.0) {\n        for (float i = 0.0; i < 2.0; i++) {\n            for (float e = 0.0; e < 2.0; e++) {\n                val += render(basePos + (vec2(i, e) - 0.5) * 0.5 / scale);\n            }\n        }\n        val /= 4.0;\n\n    }*/ else if (samples == 16.0) {\n        for (float i = 0.0; i < 4.0; i++) {\n            for (float e = 0.0; e < 4.0; e++) {\n                val += render(basePos + (vec2(i, e) - 0.25) * 0.25 / scale);\n            }\n        }\n        val /= 16.0;\n    }\n\n    if (channels == 0.0) {\n        gl_FragColor = vec4(vec3(mix(colA, colB, val)), 1.0);\n    } else {\n        gl_FragColor = vec4(vec3(1.0), val);\n    }\n}","import {gl} from '../core/gl';\nimport {FxShader} from '../core/fx-shader';\nimport {randomShaderFunc} from '../shaders/random-shader-func';\nimport {simpleShader} from '../core/simple-shader';\nimport {TFxCanvas} from '../fx-canvas-types';\n\n/**\n * Triangle Blur\n * @description  This is the most basic blur filter, which convolves the image with a\n *               pyramid filter. The pyramid filter is separable and is applied as two\n *               perpendicular triangle filters.\n *               Note: Requires alpha to be premultiplied.\n * @param radius The radius of the pyramid convolved with the image.\n */\nexport type TFilterTriangleBlur = (\n    this: TFxCanvas,\n    radius: number,\n) => TFxCanvas;\n\n\nexport const triangleBlur: TFilterTriangleBlur = function (radius) {\n    gl.triangleBlur = gl.triangleBlur || new FxShader(null, '\\\n        uniform sampler2D texture;\\\n        uniform vec2 delta;\\\n        varying vec2 texCoord;\\\n        ' + randomShaderFunc + '\\\n        void main() {\\\n            vec4 color = vec4(0.0);\\\n            float total = 0.0;\\\n            \\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\n            \\\n            for (float t = -30.0; t <= 30.0; t++) {\\\n                float percent = (t + offset - 0.5) / 30.0;\\\n                float weight = 1.0 - abs(percent);\\\n                vec4 sample = texture2D(texture, texCoord + delta * percent);\\\n                \\\n                color += sample * weight;\\\n                total += weight;\\\n            }\\\n            \\\n            gl_FragColor = color / total;\\\n        }\\\n    ', 'triangleBlur');\n\n    simpleShader.call(this, gl.triangleBlur, {\n        delta: [radius / this.width, 0],\n    });\n    simpleShader.call(this, gl.triangleBlur, {\n        delta: [0, radius / this.height],\n    });\n\n    return this;\n};","// returns a random number between 0 and 1\nexport const randomShaderFunc = '\\\n    float random(vec3 scale, float seed) {\\\n        /* use the fragment position for a different seed per-pixel */\\\n        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\\\n    }\\\n';","import {gl} from '../core/gl';\nimport {FxShader} from '../core/fx-shader';\nimport {randomShaderFunc} from '../shaders/random-shader-func';\nimport {simpleShader} from '../core/simple-shader';\nimport {TFxCanvas} from '../fx-canvas-types';\n\n/**\n * Tilt Shift\n * @description          Simulates the shallow depth of field normally encountered in close-up\n *                       photography, which makes the scene seem much smaller than it actually\n *                       is. This filter assumes the scene is relatively planar, in which case\n *                       the part of the scene that is completely in focus can be described by\n *                       a line (the intersection of the focal plane and the scene). An example\n *                       of a planar scene might be looking at a road from above at a downward\n *                       angle. The image is then blurred with a blur radius that starts at zero\n *                       on the line and increases further from the line.\n *                       Note: Requires alpha to be premultiplied.\n *\n * @param startX         The x coordinate of the start of the line segment.\n * @param startY         The y coordinate of the start of the line segment.\n * @param endX           The x coordinate of the end of the line segment.\n * @param endY           The y coordinate of the end of the line segment.\n * @param blurRadius     The maximum radius of the pyramid blur.\n * @param gradientRadius The distance from the line at which the maximum blur radius is reached.\n */\nexport type TFilterTiltShift = (\n    this: TFxCanvas,\n    startX: number,\n    startY: number,\n    endX: number,\n    endY: number,\n    blurRadius: number,\n    gradientRadius: number,\n) => TFxCanvas;\n\nexport const tiltShift: TFilterTiltShift = function (\n    startX,\n    startY,\n    endX,\n    endY,\n    blurRadius,\n    gradientRadius,\n) {\n    gl.tiltShift = gl.tiltShift || new FxShader(null, '\\\n        uniform sampler2D texture;\\\n        uniform float blurRadius;\\\n        uniform float gradientRadius;\\\n        uniform vec2 start;\\\n        uniform vec2 end;\\\n        uniform vec2 delta;\\\n        uniform vec2 texSize;\\\n        varying vec2 texCoord;\\\n        ' + randomShaderFunc + '\\\n        void main() {\\\n            vec4 color = vec4(0.0);\\\n            float total = 0.0;\\\n            \\\n            /* randomize the lookup values to hide the fixed number of samples */\\\n            float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\\\n            \\\n            vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\\\n            float radius = smoothstep(0.0, 1.0, abs(dot(texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;\\\n            for (float t = -30.0; t <= 30.0; t++) {\\\n                float percent = (t + offset - 0.5) / 30.0;\\\n                float weight = 1.0 - abs(percent);\\\n                vec4 sample = texture2D(texture, texCoord + delta / texSize * percent * radius);\\\n                \\\n                color += sample * weight;\\\n                total += weight;\\\n            }\\\n            \\\n            gl_FragColor = color / total;\\\n        }\\\n    ', 'tiltShift');\n\n    const dx = endX - startX;\n    const dy = endY - startY;\n    const d = Math.sqrt(dx * dx + dy * dy);\n    simpleShader.call(this, gl.tiltShift, {\n        blurRadius: blurRadius,\n        gradientRadius: gradientRadius,\n        start: [startX, startY],\n        end: [endX, endY],\n        delta: [dx / d, dy / d],\n        texSize: [this.width, this.height],\n    });\n    simpleShader.call(this, gl.tiltShift, {\n        blurRadius: blurRadius,\n        gradientRadius: gradientRadius,\n        start: [startX, startY],\n        end: [endX, endY],\n        delta: [-dy / d, dx / d],\n        texSize: [this.width, this.height],\n    });\n\n    return this;\n};","import {gl} from '../core/gl';\nimport {warpShader} from '../shaders/warp-shader';\nimport {simpleShader} from '../core/simple-shader';\nimport {getInverse} from '../math/matrix';\nimport {TFxCanvas, TMat2x2, TMat3x3, TMatDeep3x3} from '../fx-canvas-types';\n\n/**\n * Matrix Warp\n * @description           Transforms an image by a 2x2 or 3x3 matrix. The coordinates used in\n *                        the transformation are (x, y) for a 2x2 matrix or (x, y, 1) for a\n *                        3x3 matrix, where x and y are in units of pixels.\n * @param matrix          A 2x2 or 3x3 matrix represented as either a list or a list of lists.\n *                        For example, the 3x3 matrix [[2,0,0],[0,3,0],[0,0,1]] can also be\n *                        represented as [2,0,0,0,3,0,0,0,1] or just [2,0,0,3].\n * @param inverse         A boolean value that, when true, applies the inverse transformation\n *                        instead. (optional, defaults to false)\n * @param useTextureSpace A boolean value that, when true, uses texture-space coordinates\n *                        instead of screen-space coordinates. Texture-space coordinates range\n *                        from -1 to 1 instead of 0 to width - 1 or height - 1, and are easier\n *                        to use for simple operations like flipping and rotating.\n */\nexport type TFilterMatrixWarp = (\n    this: TFxCanvas,\n    matrix: TMat2x2 | TMat3x3 | TMatDeep3x3,\n    inverse?: boolean,\n    useTextureSpace?: boolean,\n) => TFxCanvas;\n\n\nexport const matrixWarp: TFilterMatrixWarp = function (matrix, inverse, useTextureSpace) {\n    gl.matrixWarp = gl.matrixWarp || warpShader('\\\n        uniform mat3 matrix;\\\n        uniform bool useTextureSpace;\\\n    ', '\\\n        if (useTextureSpace) coord = coord / texSize * 2.0 - 1.0;\\\n        vec3 warp = matrix * vec3(coord, 1.0);\\\n        coord = warp.xy / warp.z;\\\n        if (useTextureSpace) coord = (coord * 0.5 + 0.5) * texSize;\\\n    ');\n\n    // Flatten all members of matrix into one big list\n    matrix = matrix.flat() as (TMat2x2 | TMat3x3);\n\n    // Extract a 3x3 matrix out of the arguments\n    if (matrix.length == 4) {\n        matrix = [\n            matrix[0], matrix[1], 0,\n            matrix[2], matrix[3], 0,\n            0, 0, 1,\n        ];\n    } else if (matrix.length != 9) {\n        throw 'can only warp with 2x2 or 3x3 matrix';\n    }\n\n    simpleShader.call(this, gl.matrixWarp, {\n        matrix: inverse ? getInverse(matrix) : matrix,\n        texSize: [this.width, this.height],\n        useTextureSpace: useTextureSpace ? 1 : 0,\n    });\n\n    return this;\n};","import {FxShader} from '../core/fx-shader';\n\nexport function warpShader (uniformsStr: string, warpStr: string): FxShader {\n    return new FxShader(null, uniformsStr + '\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    void main() {\\\n        vec2 coord = texCoord * texSize;\\\n        ' + warpStr + '\\\n        gl_FragColor = texture2D(texture, coord / texSize);\\\n        vec2 clampedCoord = clamp(coord, vec2(0.0), texSize);\\\n        if (coord != clampedCoord) {\\\n            /* fade to transparent if we are outside the image */\\\n            gl_FragColor.a *= max(0.0, 1.0 - length(coord - clampedCoord));\\\n        }\\\n    }', 'warp');\n}","import {TMat3x3} from '../fx-canvas-types';\n\n// from javax.media.jai.PerspectiveTransform\n\n/**\n * Creates a PerspectiveTransform that maps the unit square onto an arbitrary quadrilateral.\n */\nexport function getSquareToQuad (\n    x0: number,\n    y0: number,\n    x1: number,\n    y1: number,\n    x2: number,\n    y2: number,\n    x3: number,\n    y3: number\n): TMat3x3 {\n    const dx1 = x1 - x2;\n    const dy1 = y1 - y2;\n    const dx2 = x3 - x2;\n    const dy2 = y3 - y2;\n    const dx3 = x0 - x1 + x2 - x3;\n    const dy3 = y0 - y1 + y2 - y3;\n    const det = dx1 * dy2 - dx2 * dy1;\n    const a = (dx3 * dy2 - dx2 * dy3) / det;\n    const b = (dx1 * dy3 - dx3 * dy1) / det;\n    return [\n        x1 - x0 + a * x1, y1 - y0 + a * y1, a,\n        x3 - x0 + b * x3, y3 - y0 + b * y3, b,\n        x0, y0, 1,\n    ];\n}\n\nexport function getInverse (m: TMat3x3): TMat3x3 {\n    const a = m[0], b = m[1], c = m[2];\n    const d = m[3], e = m[4], f = m[5];\n    const g = m[6], h = m[7], i = m[8];\n    const det = a * e * i - a * f * h - b * d * i + b * f * g + c * d * h - c * e * g;\n    return [\n        (e * i - f * h) / det, (c * h - b * i) / det, (b * f - c * e) / det,\n        (f * g - d * i) / det, (a * i - c * g) / det, (c * d - a * f) / det,\n        (d * h - e * g) / det, (b * g - a * h) / det, (a * e - b * d) / det,\n    ];\n}\n\nexport function multiply (a: TMat3x3, b: TMat3x3): TMat3x3 {\n    return [\n        a[0] * b[0] + a[1] * b[3] + a[2] * b[6],\n        a[0] * b[1] + a[1] * b[4] + a[2] * b[7],\n        a[0] * b[2] + a[1] * b[5] + a[2] * b[8],\n        a[3] * b[0] + a[4] * b[3] + a[5] * b[6],\n        a[3] * b[1] + a[4] * b[4] + a[5] * b[7],\n        a[3] * b[2] + a[4] * b[5] + a[5] * b[8],\n        a[6] * b[0] + a[7] * b[3] + a[8] * b[6],\n        a[6] * b[1] + a[7] * b[4] + a[8] * b[7],\n        a[6] * b[2] + a[7] * b[5] + a[8] * b[8],\n    ];\n}","import {gl} from '../core/gl';\nimport {FxShader} from '../core/fx-shader';\nimport {simpleShader} from '../core/simple-shader';\nimport {TFxCanvas} from '../fx-canvas-types';\n\n/**\n * Unsharp Mask\n * @description    A form of image sharpening that amplifies high-frequencies in the image. It\n *                 is implemented by scaling pixels away from the average of their neighbors.\n * @param radius   The blur radius that calculates the average of the neighboring pixels.\n * @param strength A scale factor where 0 is no effect and higher values cause a stronger effect.\n */\nexport type TFilterUnsharpMask = (\n    this: TFxCanvas,\n    radius: number,\n    strength: number,\n) => TFxCanvas;\n\nexport const unsharpMask: TFilterUnsharpMask = function (radius, strength) {\n    gl.unsharpMask = gl.unsharpMask || new FxShader(null, '\\\n        uniform sampler2D blurredTexture;\\\n        uniform sampler2D originalTexture;\\\n        uniform float strength;\\\n        uniform float threshold;\\\n        varying vec2 texCoord;\\\n        void main() {\\\n            vec4 blurred = texture2D(blurredTexture, texCoord);\\\n            vec4 original = texture2D(originalTexture, texCoord);\\\n            gl_FragColor = mix(blurred, original, 1.0 + strength);\\\n        }\\\n    ', 'unsharpMask');\n\n    // Store a copy of the current texture in the second texture unit\n    this._.extraTexture.ensureFormatViaTexture(this._.texture);\n    this._.texture.use();\n    this._.extraTexture.drawTo(function () {\n        FxShader.getDefaultShader().drawRect();\n    });\n\n    // Blur the current texture, then use the stored texture to detect edges\n    this._.extraTexture.use(1);\n    this.triangleBlur(radius);\n    gl.unsharpMask.textures({\n        originalTexture: 1,\n    });\n    simpleShader.call(this, gl.unsharpMask, {\n        strength: strength,\n    });\n    this._.extraTexture.unuse(1);\n\n    return this;\n};","import {gl} from '../core/gl';\nimport {FxShader} from '../core/fx-shader';\nimport {simpleShader} from '../core/simple-shader';\nimport {TFxCanvas} from '../fx-canvas-types';\nimport {IRGBA} from '../../klecks/kl-types';\n\n/**\n * To Alpha\n * @description   Generates alpha channel from luminance (r+g+b)\n * @param isInverted    boolean - invert luminance\n * @param replaceRGBA    rgba - color to replace rgb with. if a = 0 -> keep orig color\n */\nexport type TFilterToAlpha = (\n    this: TFxCanvas,\n    isInverted: boolean,\n    replaceRGBA: IRGBA | null,\n) => TFxCanvas;\n\nexport const toAlpha: TFilterToAlpha = function (isInverted, replaceRGBA) {\n    gl.toAlpha = gl.toAlpha || new FxShader(null, '\\\n    uniform bool isInverted;\\\n    uniform vec4 replace;\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    \\\n    void main() {\\\n        vec4 color = texture2D(texture, texCoord);\\\n        float alpha = (color.r + color.g + color.b) / 3.0;\\\n        if (isInverted) alpha = 1.0 - alpha;\\\n        alpha = min(color.a, alpha);\\\n        if (replace.a > 0.0) color = replace;\\\n        gl_FragColor = vec4(color.r, color.g, color.b, alpha);\\\n    }\\\n', 'toAlpha');\n\n    simpleShader.call(this, gl.toAlpha, {\n        isInverted: isInverted ? 1 : 0,\n        replace: replaceRGBA ? [replaceRGBA.r / 255, replaceRGBA.g / 255, replaceRGBA.b / 255, replaceRGBA.a] : [0, 0, 0, 0],\n        texSize: [this.width, this.height],\n    });\n\n    return this;\n};","import {gl} from '../core/gl';\nimport {FxShader} from '../core/fx-shader';\nimport {simpleShader} from '../core/simple-shader';\nimport {TFxCanvas} from '../fx-canvas-types';\n\n/**\n * Invert\n * @description   Inverts color of each pixel\n */\nexport type TFilterInvert = (\n    this: TFxCanvas,\n) => TFxCanvas;\n\nexport const invert: TFilterInvert = function () {\n    gl.invert = gl.invert || new FxShader(null, '\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    \\\n    void main() {\\\n        vec4 color = texture2D(texture, texCoord);\\\n        color.rgb = 1.0 - color.rgb;\\\n        gl_FragColor = color;\\\n    }\\\n', 'invert');\n\n    simpleShader.call(this, gl.invert, {\n        texSize: [this.width, this.height],\n    });\n\n    return this;\n};","import {getInverse, getSquareToQuad, multiply} from '../math/matrix';\nimport {TFxCanvas} from '../fx-canvas-types';\n\nexport type TRectanglePoints = [\n    number, number, // point a\n    number, number, // point b\n    number, number, // point c\n    number, number, // point d\n];\n\n/**\n * Perspective\n * @description  Warps one quadrangle to another with a perspective transform. This can be used to\n *               make a 2D image look 3D or to recover a 2D image captured in a 3D environment.\n *               Note: Requires alpha to be premultiplied.\n * @param before The x and y coordinates of four points before the transform in a flat list. This\n *               would look like [ax, ay, bx, by, cx, cy, dx, dy] for four points (ax, ay), (bx, by),\n *               (cx, cy), and (dx, dy).\n * @param after  The x and y coordinates of four points after the transform in a flat list, just\n *               like the other argument.\n */\nexport type TFilterPerspective = (\n    this: TFxCanvas,\n    before: TRectanglePoints,\n    after: TRectanglePoints,\n) => TFxCanvas;\n\nexport const perspective: TFilterPerspective = function (before, after) {\n    const a = getSquareToQuad(...after);\n    const b = getSquareToQuad(...before);\n    const c = multiply(getInverse(a), b);\n    return this.matrixWarp(c);\n};\n","import {gl} from '../core/gl';\nimport {FxShader} from '../core/fx-shader';\nimport {simpleShader} from '../core/simple-shader';\nimport {TFxCanvas} from '../fx-canvas-types';\n\n/**\n * unmultiplyAlpha\n * reverses alpha multiply\n */\nexport type TFilterUnmultiplyAlpha = (\n    this: TFxCanvas,\n) => TFxCanvas;\n\nexport const unmultiplyAlpha: TFilterUnmultiplyAlpha = function () {\n    gl.unmultiplyAlpha = gl.unmultiplyAlpha || new FxShader(null, '\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    \\\n    void main() {\\\n        vec4 color = texture2D(texture, texCoord);\\\n        if(color.a > 0.0) {\\\n            color.rgb /= color.a;\\\n        }\\\n        gl_FragColor = color;\\\n    }\\\n', 'unmultiplyAlpha');\n\n    simpleShader.call(this, gl.unmultiplyAlpha, {\n        texSize: [this.width, this.height],\n    });\n\n    return this;\n};","import {gl} from '../core/gl';\nimport {warpShader} from '../shaders/warp-shader';\nimport {simpleShader} from '../core/simple-shader';\nimport {TFxCanvas} from '../fx-canvas-types';\n\n\nexport type TFilterDistortSettings = {\n    stepSize: number; // [1, inf]\n    distortType: 0 | 1 | 2;\n    scale: { x: number; y: number };\n    strength: { x: number; y: number };\n    phase: { x: number; y: number };\n    offset: { x: number; y: number };\n};\n\n/**\n * Distort\n * Distorts image (moves pixels around)\n */\nexport type TFilterDistort = (\n    this: TFxCanvas,\n    settings: TFilterDistortSettings,\n) => TFxCanvas;\n\n/**\n * @filter        Distort\n * @description   Distorts image (moves pixels around)\n *                Note: Requires alpha to be premultiplied.\n */\nexport const distort: TFilterDistort = function (settings) {\n    gl.distort = gl.distort || warpShader(`\n    uniform float stepSize;\n    uniform vec2 scale;\n    uniform vec2 strength;\n    uniform vec2 phase;\n    uniform float type;\n    uniform vec2 offset;\n`, `\n    const float PI = 3.14159265;\n    float x = coord.x + offset.x;\n    float y = coord.y + offset.y;\n    if (stepSize > 1.0) {\n        x = floor(x / stepSize) * stepSize;\n        y = floor(y / stepSize) * stepSize;\n    }\n    float distortX = sin((x/scale.x + phase.x) * PI * 2.0) * strength.x;\n    float distortY = sin((y/scale.y + phase.y) * PI * 2.0) * strength.y;\n    if (type == 0.0) {\n        coord.y += distortX;\n        coord.x += distortY;\n    } else if (type == 1.0) {\n        coord.x += distortX;\n        coord.y += distortY;\n    } else if (type == 2.0) {\n        x -= offset.x;\n        y -= offset.y;\n        gl_FragColor = texture2D(texture, vec2(x, y) / texSize);\n        coord.y += sin(gl_FragColor.r/scale.x*200.0 + phase.x * PI * 2.0) * strength.x;\n        coord.x += cos(gl_FragColor.g/scale.y*200.0 + phase.y * PI * 2.0) * strength.y;\n    }\n    coord.x = mod(coord.x, texSize.x);\n    coord.y = mod(coord.y, texSize.y);\n`);\n\n    simpleShader.call(this, gl.distort, {\n        stepSize: settings.stepSize,\n        type: settings.distortType,\n        scale: [settings.scale.x, settings.scale.y],\n        strength: [settings.strength.x, settings.strength.y],\n        phase: [settings.phase.x, settings.phase.y],\n        offset: [settings.offset.x, settings.offset.y],\n        texSize: [this.width, this.height],\n    });\n\n    return this;\n};\n\n","import {gl} from '../core/gl';\nimport {FxShader} from '../core/fx-shader';\nimport {simpleShader} from '../core/simple-shader';\nimport {TFxCanvas} from '../fx-canvas-types';\n\n/**\n * multiplyAlpha\n * applies alpha multiply\n */\nexport type TFilterMultiplyAlpha = (\n    this: TFxCanvas,\n) => TFxCanvas;\n\nexport const multiplyAlpha: TFilterMultiplyAlpha = function () {\n    gl.multiplyAlpha = gl.multiplyAlpha || new FxShader(null, '\\\n    uniform sampler2D texture;\\\n    uniform vec2 texSize;\\\n    varying vec2 texCoord;\\\n    \\\n    void main() {\\\n        vec4 color = texture2D(texture, texCoord);\\\n        color.rgb *= color.a;\\\n        gl_FragColor = color;\\\n    }\\\n', 'multiplyAlpha');\n\n    simpleShader.call(this, gl.multiplyAlpha, {\n        texSize: [this.width, this.height],\n    });\n\n    return this;\n};","import {BB} from '../../../bb/bb';\nimport {KL} from '../../kl';\nimport {SaveReminder} from '../components/save-reminder';\nimport {base64ToBlob} from '../../storage/base-64-to-blob';\nimport {KlCanvas} from '../../canvas/kl-canvas';\nimport {LANG} from '../../../language/language';\nimport loadingImg from '/src/app/img/ui/loading.gif';\n\ntype TImgurUploadResponse = {\n    // just a subset\n    id: string;\n    datetime: number;\n    type: string;\n    width: number;\n    height: number;\n    deletehash: string;\n    name: string;\n    link: string;\n};\n\n/**\n * uploads canvas, opens new tab with the upload progress & then opens the image page.\n */\nasync function upload (\n    canvas: HTMLCanvasElement,\n    title: string,\n    description: string,\n    type: 'png' | 'jpeg',\n    imgurKey: string,\n): Promise<TImgurUploadResponse> {\n    const img = base64ToBlob(canvas.toDataURL('image/' + type));\n\n    const w = window.open();\n\n    if (!w) {\n        throw new Error('could not create new tab');\n    }\n\n    const label = w.document.createElement('div');\n    const gif = w.document.createElement('img');\n    gif.src = loadingImg;\n    label.append(gif);\n    BB.css(gif, {\n        filter: 'invert(1)',\n    });\n    BB.css(w.document.body, {\n        backgroundColor: '#121211',\n        backgroundImage: 'linear-gradient(#2b2b2b 0%, #121211 50%)',\n        backgroundRepeat: 'no-repeat',\n    });\n    \n    const labelText = w.document.createElement('div');\n    labelText.style.marginTop = '10px';\n    label.append(labelText);\n    labelText.textContent = LANG('upload-uploading');\n\n    w.document.body.append(label);\n    BB.css(label, {\n        marginLeft: 'auto',\n        marginRight: 'auto',\n        marginTop: '100px',\n        fontFamily: 'system-ui, sans-serif',\n        fontSize: '20px',\n        textAlign: 'center',\n        transition: 'opacity 0.3s ease-in-out',\n        opacity: '0',\n        color: '#ccc',\n    });\n    setTimeout(function () {\n        label.style.opacity = '1';\n    }, 20);\n\n    let response;\n    try {\n        const formData = new FormData();\n        formData.append('title', title);\n        formData.append('description', description);\n        formData.append('image', img);\n        response = await fetch('https://api.imgur.com/3/image',  {\n            method: 'POST',\n            headers: {\n                Authorization: 'Client-ID ' + imgurKey,\n            },\n            body: formData,\n        });\n\n    } catch (e) {\n        w.close();\n        throw e;\n    }\n    if (!response.ok) {\n        w.close();\n        throw new Error();\n    }\n    const data: TImgurUploadResponse = (await response.json()).data;\n\n    w.location.href = data.link.replace(/\\.(jpg|png)/, '');\n\n    return data;\n}\n\n\nexport function imgurUpload (\n    klCanvas: KlCanvas,\n    klRootEl: HTMLElement,\n    saveReminder: SaveReminder,\n    imgurKey: string, // API key\n): void {\n    if (!imgurKey) {\n        throw new Error('imgur key missing');\n    }\n\n    const inputTitle = BB.el({tagName: 'input'});\n    inputTitle.type = 'text';\n    inputTitle.value = LANG('upload-title-untitled');\n    const inputDescription = BB.el({\n        tagName: 'textarea',\n        custom: {\n            rows: '2',\n        },\n        css: {\n            width: '100%',\n            maxWidth: '100%',\n        },\n    });\n\n    const labelTitle =  BB.el({\n        textContent: LANG('upload-name') + ':',\n    });\n    const labelDescription = BB.el({\n        textContent: LANG('upload-caption') + ':',\n        css: {\n            marginTop: '10px',\n        },\n    });\n\n    const tos = BB.el({\n        content: `<br/><a href=\"https://imgur.com/tos\" target=\"_blank\" rel=\"noopener noreferrer\">${LANG('terms-of-service')}</a>`,\n    });\n\n    const typeRadio = new KL.RadioList({\n        name: 'filetype',\n        init: 'jpeg',\n        items: [\n            { label: 'JPG', value: 'jpeg' },\n            { label: 'PNG', value: 'png' },\n        ],\n        ignoreFocus: true,\n    });\n    BB.css(typeRadio.getElement(), {\n        marginBottom: '10px',\n    });\n\n\n    const outDiv = BB.el();\n    const infoHint = BB.el({\n        className: 'info-hint',\n        textContent: LANG('upload-link-notice'),\n    });\n    outDiv.append(\n        infoHint,\n        typeRadio.getElement(),\n        labelTitle,\n        inputTitle,\n        labelDescription,\n        inputDescription,\n        tos\n    );\n    KL.popup({\n        target: klRootEl,\n        message: `<b>${LANG('upload-title')}</b>`,\n        type: 'upload',\n        div: outDiv,\n        buttons: [LANG('upload-submit'), 'Cancel'],\n        clickOnEnter: LANG('upload-submit'),\n        primaries: [LANG('upload-submit')],\n        autoFocus: LANG('upload-submit'),\n        callback: async function (val) {\n            if (val === LANG('upload-submit') || val === 'Yes' || val === 'Ok') {\n                try {\n                    const result = await upload(\n                        klCanvas.getCompleteCanvas(1),\n                        inputTitle.value,\n                        inputDescription.value,\n                        typeRadio.getValue() as 'png' | 'jpeg',\n                        imgurKey,\n                    );\n\n                    KL.popup({\n                        target: klRootEl,\n                        type: 'ok',\n                        message: `<h3>${LANG('upload-success')}</h3><br>${LANG('upload-delete')}<br><a target='_blank' rel=\"noopener noreferrer\" href='https://imgur.com/delete/${result.deletehash}'>imgur.com/delete/${result.deletehash}</a><br><br>`,\n                        buttons: ['Ok'],\n                    });\n                    saveReminder.reset();\n\n                } catch(e) {\n                    KL.popup({\n                        target: klRootEl,\n                        type: 'error',\n                        message: LANG('upload-failed'),\n                        buttons: ['Ok'],\n                    });\n                }\n            }\n        },\n    });\n}","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"loading.7ff8a2ac.gif\";","\nexport type TAgPsd = Awaited<typeof import('ag-psd')>;\nlet agPsdLazy: TAgPsd;\n\nexport async function loadAgPsd (): Promise<TAgPsd> {\n    if (!agPsdLazy) {\n        agPsdLazy = await import('ag-psd');\n    }\n    return agPsdLazy;\n}","import {KL} from '../../kl';\nimport {BB} from '../../../bb/bb';\nimport {KlHistoryInterface} from '../../history/kl-history';\nimport {LANG} from '../../../language/language';\nimport {BrowserStorageUi} from './browser-storage-ui';\nimport {ProjectStore} from '../../storage/project-store';\nimport {IKlProject} from '../../kl-types';\n\nexport type TSaveReminderSetting = '20min' | '40min' | 'disabled';\n\nconst unsavedActionsLimit = 100; // number of actions user did since last save\nconst LS_REMINDER_KEY = 'kl-save-reminder';\n\n/**\n * remind user of saving, keep user aware of save state\n */\nexport class SaveReminder {\n    private setting: TSaveReminderSetting;\n\n    private lastSavedActionNumber: number | undefined;\n    private lastSavedAt: number = 0;\n\n    private lastReminderShownAt: number = 0;\n    private unsavedInterval: ReturnType<typeof setInterval> | undefined;\n    private closeFunc: (() => void) | undefined;\n\n    showPopup (): void {\n        if (!this.projectStore || !this.getProject) {\n            throw new Error('projectStore and getProject need to be set');\n        }\n\n        const min = Math.round((performance.now() - this.lastSavedAt) / 1000 / 60);\n\n        const contentEl = BB.el();\n\n        contentEl.append(\n            BB.el({\n                content: LANG(\n                    'save-reminder-text',\n                    {\n                        a: '<strong>' + min,\n                        b: '</strong>',\n                    }\n                ),\n                css: {\n                    marginBottom: '20px',\n                },\n            }),\n        );\n\n        const psdWrapper = BB.el({\n            css: {\n                borderTop: '1px solid #aaa',\n                margin: '0 -20px',\n                padding: '20px',\n            },\n        });\n        const storageWrapper = BB.el({\n            css: {\n                borderTop: '1px solid #aaa',\n                margin: '0 -20px',\n                padding: '20px',\n                paddingBottom: '0',\n            },\n        });\n        contentEl.append(psdWrapper, storageWrapper);\n\n\n        const psdBtn = BB.el({\n            tagName: 'button',\n            className: 'kl-button',\n            content: LANG('save-reminder-save-psd'),\n            onClick: () => this.onSaveAsPsd(),\n        });\n        psdWrapper.append(\n            psdBtn,\n            BB.el({\n                content: LANG('save-reminder-psd-layers'),\n                css: {\n                    marginTop: '10px',\n                },\n            }),\n        );\n\n\n        const storageUi = new BrowserStorageUi(\n            this.projectStore,\n            this.getProject,\n            this,\n            document.body,\n            {\n                hideClearButton: true,\n                isFocusable: true,\n            }\n        );\n        storageWrapper.append(storageUi.getElement());\n\n\n        KL.popup({\n            target: document.body,\n            message: `<b>${LANG('save-reminder-title')}</b>`,\n            div: contentEl,\n            ignoreBackground: true,\n            callback: () => {\n                storageUi.destroy();\n                BB.destroyEl(psdBtn);\n                this.closeFunc = undefined;\n                this.lastReminderShownAt = performance.now();\n            },\n            closeFunc: (f) => {\n                this.closeFunc = f;\n            },\n        });\n        setTimeout(() => {\n            psdBtn.focus();\n        }, 40);\n    }\n\n    constructor (\n        private history: KlHistoryInterface,\n        private showReminder: boolean,\n        private changeTitle: boolean,\n        private onSaveAsPsd: () => void,\n        private isDrawing: () => boolean,\n        private projectStore: ProjectStore | null, // needed if showReminder\n        private getProject: (() => IKlProject) | null, // needed if showReminder\n        private title: string = 'Klecks',\n    ) {\n        this.setting = (localStorage.getItem(LS_REMINDER_KEY) as TSaveReminderSetting | null) ?? '20min';\n    }\n\n    init (): void {\n        if (this.lastSavedActionNumber !== undefined) { // already initialized\n            return;\n        }\n        this.lastSavedActionNumber = this.history.getActionNumber();\n        this.lastReminderShownAt = performance.now();\n        this.lastSavedAt = performance.now();\n\n        if (this.showReminder) {\n            setInterval(() => {\n                if (document.visibilityState !== 'visible') {\n                    return;\n                }\n\n                const unsavedActions = Math.abs(this.history.getActionNumber() - this.lastSavedActionNumber!);\n\n                const timeLimitMs = 1000 * 60 * {\n                    '20min': 20,\n                    '40min': 40,\n                    'disabled': 0,\n                }[this.setting];\n\n                if (\n                    timeLimitMs > 0 &&\n                    KL.dialogCounter.get() === 0 &&\n                    !this.isDrawing() &&\n                    this.lastReminderShownAt + timeLimitMs < performance.now() &&\n                    unsavedActions >= unsavedActionsLimit\n                ) {\n                    this.showPopup();\n                }\n            }, 1000 * 5);\n        }\n\n        // confirmation dialog when closing tab\n        function onBeforeUnload (e: BeforeUnloadEvent) {\n            e.preventDefault();\n            e.returnValue = '';\n        }\n\n        this.history.addListener(() => {\n            const actionNumber = this.history.getActionNumber();\n            if (this.lastSavedActionNumber !== actionNumber) {\n                window.onbeforeunload =  onBeforeUnload;\n            } else {\n                window.onbeforeunload = null;\n            }\n        });\n\n        if (this.changeTitle) {\n            document.addEventListener('visibilitychange', () => {\n                if (document.visibilityState === 'visible') {\n                    document.title = this.title;\n                    clearInterval(this.unsavedInterval);\n                } else {\n                    const actionNumber = this.history.getActionNumber();\n                    if (this.lastSavedActionNumber !== actionNumber) {\n                        document.title = LANG('unsaved') + ' - ' + this.title;\n                        let state = 0;\n                        this.unsavedInterval = setInterval(() => {\n                            state = (state + 1) % 2;\n                            if (state === 1) {\n                                document.title = LANG('unsaved') + '  ' + this.title;\n                            } else {\n                                document.title = LANG('unsaved') + ' - ' + this.title;\n                            }\n                        }, 1000 * 60 * 3);\n                    }\n                }\n            });\n        }\n    }\n\n    reset (): void {\n        if (this.lastSavedActionNumber === undefined) { // not initialized\n            return;\n        }\n\n        this.lastSavedActionNumber = this.history.getActionNumber();\n        this.lastReminderShownAt = performance.now();\n        this.lastSavedAt = performance.now();\n        window.onbeforeunload = null;\n\n        if (this.closeFunc) {\n            this.closeFunc();\n        }\n    }\n\n    getSetting (): TSaveReminderSetting {\n        return this.setting;\n    }\n\n    setSetting (setting: TSaveReminderSetting): void {\n        this.setting = setting;\n        localStorage.setItem(LS_REMINDER_KEY, this.setting);\n    }\n}\n","import {BB} from '../../bb/bb';\nimport {KL} from '../kl';\nimport {KlCanvas} from '../canvas/kl-canvas';\nimport {TExportType} from '../kl-types';\nimport {SaveReminder} from '../ui/components/save-reminder';\nimport {saveAs} from '../../bb/base/save-as';\nimport {Psd} from 'ag-psd/dist/psd';\nimport {klConfig} from '../kl-config';\n\nexport class SaveToComputer {\n\n    /**\n     * Using old code, because saving somehow doesn't work for ipad before ios 13,\n     * and it doesn't even throw an exception.\n     */\n    private saveImage (canvas: HTMLCanvasElement, filename: string, mimeType: string): void {\n        const parts = canvas.toDataURL(mimeType).match(/data:([^;]*)(;base64)?,([0-9A-Za-z+/]+)/);\n\n        if (!parts) {\n            throw new Error('saveImage: empty parts');\n        }\n\n        //assume base64 encoding\n        const binStr = atob(parts[3]);\n        //convert to binary in ArrayBuffer\n        const buf = new ArrayBuffer(binStr.length);\n        const view = new Uint8Array(buf);\n        for (let i = 0; i < view.length; i++) {\n            view[i] = binStr.charCodeAt(i);\n        }\n        const blob = new Blob([view], {'type': parts[1]});\n        saveAs(blob, filename);\n    }\n\n    constructor (\n        private saveReminder: SaveReminder,\n        private getExportType: () => TExportType,\n        private getKlCanvas: () => KlCanvas,\n    ) {}\n\n    save (format?: 'psd' | 'layers' | 'png'): void {\n        this.saveReminder.reset();\n\n        if (!format) {\n            format = this.getExportType();\n        }\n\n        if (format === 'png') {\n            const extension = 'png';\n            const mimeType = 'image/png';\n            const filename = BB.getDate() + klConfig.filenameBase + '.' + extension;\n            const fullCanvas = this.getKlCanvas().getCompleteCanvas(1);\n            try {\n                this.saveImage(fullCanvas, filename, mimeType);\n            } catch (error) { //fallback for old browsers\n                alert('could not save');\n                throw new Error('failed png export');\n            }\n        } else if (format === 'layers') {\n            const extension = 'png';\n            const mimeType = 'image/png';\n            const fileBase = BB.getDate() + klConfig.filenameBase;\n            const layerArr = this.getKlCanvas().getLayersFast();\n            for (let i = 0; i < layerArr.length; i++) {\n                const item = layerArr[i];\n                const fnameArr = [\n                    fileBase,\n                    '_',\n                    ('' + (i + 1)).padStart(2, '0'),\n                    '_',\n                    item.name,\n                    '.',\n                    extension,\n                ];\n                this.saveImage(item.canvas, fnameArr.join(''), mimeType);\n            }\n        } else if (format === 'psd') {\n\n            const layerArr = this.getKlCanvas().getLayersFast();\n\n            const psdConfig: Psd = {\n                width: this.getKlCanvas().getWidth(),\n                height: this.getKlCanvas().getHeight(),\n                children: [],\n                canvas: this.getKlCanvas().getCompleteCanvas(1),\n            };\n            for (let i = 0; i < layerArr.length; i++) {\n                const item = layerArr[i];\n                psdConfig.children!.push({\n                    name: item.name,\n                    hidden: !item.isVisible,\n                    opacity: item.opacity,\n                    canvas: item.canvas,\n                    blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\n                    left: 0,\n                    top: 0,\n                });\n            }\n\n            KL.loadAgPsd().then((agPsdLazy) => {\n                const buffer = agPsdLazy.writePsdBuffer(psdConfig);\n                const blob = new Blob([buffer], { type: 'application/octet-stream' });\n                saveAs(blob, BB.getDate() + klConfig.filenameBase + '.psd');\n            }).catch(() => {\n                alert('Error: failed to load PSD library');\n            });\n\n        }\n\n    }\n\n}","// https://github.com/eligrey/FileSaver.js/issues/774\n// stripped down version of https://github.com/eligrey/FileSaver.js/blob/master/src/FileSaver.js#L81-L108\n\nexport function saveAs (blob: Blob, name: string): void {\n    // Namespace is used to prevent conflict w/ Chrome Poper Blocker extension (Issue https://github.com/eligrey/FileSaver.js/issues/561)\n    const a = document.createElementNS('http://www.w3.org/1999/xhtml', 'a') as HTMLAnchorElement;\n    a.download = name;\n    a.rel = 'noopener';\n    a.href = URL.createObjectURL(blob);\n\n    setTimeout(() => URL.revokeObjectURL(a.href), 40 /* sec */ * 1000);\n    setTimeout(() => a.click(), 0);\n}\n","import {KL} from '../kl';\nimport {IHistoryBroadcast, IHistoryEntry, klHistory} from './kl-history';\nimport {KlCanvasWorkspace} from '../canvas-ui/kl-canvas-workspace';\nimport {IFilter, IFilterApply, IInitState} from '../kl-types';\nimport {KlCanvas, KlCanvasContext} from '../canvas/kl-canvas';\nimport {LayerManager} from '../ui/tool-tabs/layer-manager/layer-manager';\nimport {LayerPreview} from '../ui/components/layer-preview';\nimport {HandUi} from '../ui/tool-tabs/hand-ui';\nimport {throwIfNull} from '../../bb/base/base';\nimport {TBrush} from '../brushes/brushes';\n\nfunction execHistoryEntry (\n    historyEntry: IHistoryEntry,\n    layerIndex: number,\n    klCanvas: KlCanvas,\n    brushes: TBrush[],\n    setCurrentLayerCtx: (ctx: CanvasRenderingContext2D) => void,\n    getCurrentLayerCtx: () => CanvasRenderingContext2D,\n): number {\n    if (historyEntry.tool[0] === 'brush') {\n        const b = brushes[historyEntry.tool[1] as any];\n        historyEntry.actions!.forEach(action => {\n            (b[action.action as keyof TBrush] as any)(...action.params);\n        });\n\n    } else if (historyEntry.tool[0] === 'canvas') {\n        const p = historyEntry.params!;\n        const id = (klCanvas[historyEntry.action as keyof KlCanvas] as any)(...p);\n        if (typeof id === 'number') {\n            layerIndex = id;\n            const ctx = throwIfNull(klCanvas.getLayerContext(layerIndex)) as KlCanvasContext;\n            setCurrentLayerCtx(ctx);\n            Object.entries(brushes).forEach(([, brush]) => brush.setContext(ctx));\n        }\n\n    } else if (historyEntry.tool[0] === 'filter') {\n        const p = [{\n            context: getCurrentLayerCtx(),\n            klCanvas,\n            input: historyEntry.params![0].input,\n            history: new KL.DecoyKlHistory(),\n        } as IFilterApply];\n        (KL.filterLib[historyEntry.tool[1]][historyEntry.action! as keyof IFilter] as any)(...p);\n\n    } else if (historyEntry.tool[0] === 'misc' && historyEntry.action === 'focusLayer') {\n        layerIndex = historyEntry.params![0];\n        const ctx = throwIfNull(klCanvas.getLayerContext(layerIndex)) as KlCanvasContext;\n        setCurrentLayerCtx(ctx);\n        Object.entries(brushes).forEach(([, brush]) => brush.setContext(ctx));\n\n    } else if (historyEntry.tool[0] === 'misc' && historyEntry.action === 'importImage') {\n        const id = klCanvas.addLayer();\n        if (typeof id === 'number') {\n            layerIndex = id;\n            if (historyEntry.params![1]) {\n                klCanvas.renameLayer(layerIndex, historyEntry.params![1]);\n            }\n            const ctx = throwIfNull(klCanvas.getLayerContext(layerIndex)) as KlCanvasContext;\n            setCurrentLayerCtx(ctx);\n            Object.entries(brushes).forEach(([, brush]) => brush.setContext(ctx));\n        }\n        getCurrentLayerCtx().drawImage(historyEntry.params![0], 0, 0);\n    }\n    return layerIndex;\n}\n\nexport class UndoRedoCatchup {\n\n    private doIgnore = false;\n\n    /**\n     * Prevent multiple undo / redo getting triggered at once if UI is frozen.\n     * true -> ignore, don't undo / redo\n     */\n    private shouldIgnoreTest (): boolean {\n        if (this.doIgnore) {\n            return true;\n        }\n        this.doIgnore = true;\n        setTimeout(() => {\n            this.doIgnore = false;\n        }, 0);\n        return false;\n    }\n    \n\n    // ---- public ----\n\n    constructor (\n        private brushUiMap: any, // todo\n        private layerPreview: LayerPreview,\n        private layerManager: LayerManager,\n        private handUi: HandUi,\n        private klCanvasWorkspace: KlCanvasWorkspace,\n        private getInitState: () => IInitState,\n        private getKlCanvas: () => KlCanvas,\n        private getCurrentLayerCtx: () => CanvasRenderingContext2D | null,\n        private setCurrentLayerCtx: (ctx: CanvasRenderingContext2D) => void,\n        private getCurrentBrush: () => TBrush,\n    ) { }\n\n    undo (): boolean {\n        if (this.shouldIgnoreTest() || !klHistory.canUndo()) {\n            return false;\n        }\n        const entries: IHistoryEntry[] = klHistory.undo();\n        const klCanvas = this.getKlCanvas();\n        klHistory.pause(true);\n        const initState: IInitState = this.getInitState();\n        const oldSize = {w: klCanvas.getWidth(), h: klCanvas.getHeight()};\n        klCanvas.copy(initState.canvas);\n        let layerIndex = initState.focus;\n        this.setCurrentLayerCtx(throwIfNull(klCanvas.getLayerContext(layerIndex)));\n        const brushes: any = {};\n        Object.entries(KL.brushes).forEach(([b, brush]) => {\n            brushes[b] = new brush();\n            brushes[b].setContext(this.getCurrentLayerCtx());\n        });\n        brushes.SketchyBrush.setSeed(initState.brushes.SketchyBrush.getSeed());\n        entries.forEach(entry => {\n            layerIndex = execHistoryEntry(\n                entry,\n                layerIndex,\n                klCanvas,\n                brushes,\n                (ctx) => this.setCurrentLayerCtx(ctx),\n                () => throwIfNull(this.getCurrentLayerCtx()),\n            );\n        });\n        if (oldSize.w !== klCanvas.getWidth() || oldSize.h !== klCanvas.getHeight()) {\n            this.klCanvasWorkspace.resetOrFitView();\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n        }\n        this.layerManager.update(layerIndex);\n        this.layerPreview.setLayer(throwIfNull(klCanvas.getLayer(layerIndex)));\n        this.brushUiMap.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx()! as KlCanvasContext);\n        this.klCanvasWorkspace.setLastDrawEvent();\n\n        klHistory.pause(false);\n        return true;\n    }\n\n    redo (): boolean {\n        if (this.shouldIgnoreTest() || !klHistory.canRedo()) {\n            return false;\n        }\n        const entry = klHistory.redo();\n        if (!entry) {\n            setTimeout(() => {\n                throw new Error('redo failed. redo entry undefined');\n            });\n            return false;\n        }\n        const klCanvas = this.getKlCanvas();\n        klHistory.pause(true);\n        const oldSize = {w: klCanvas.getWidth(), h: klCanvas.getHeight()};\n        const brushes: any = {};\n        Object.entries(KL.brushes).forEach(([b, brush]) => {\n            brushes[b] = new brush();\n            brushes[b].setContext(this.getCurrentLayerCtx());\n        });\n        brushes.SketchyBrush.setSeed(this.brushUiMap.sketchyBrush.getSeed());\n        execHistoryEntry(\n            entry,\n            0, // doesn't matter, because result not used\n            klCanvas,\n            brushes,\n            (ctx) => this.setCurrentLayerCtx(ctx),\n            () => throwIfNull(this.getCurrentLayerCtx()),\n        );\n\n        if (oldSize.w !== klCanvas.getWidth() || oldSize.h !== klCanvas.getHeight()) {\n            this.klCanvasWorkspace.resetOrFitView();\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n        }\n        const currentLayerIndex = throwIfNull(klCanvas.getLayerIndex(this.getCurrentLayerCtx()!.canvas));\n        this.layerManager.update(currentLayerIndex);\n        this.layerPreview.setLayer(klCanvas.getLayer(currentLayerIndex)!);\n        this.brushUiMap.sketchyBrush.setSeed(brushes.SketchyBrush.getSeed());\n        this.getCurrentBrush().setContext(this.getCurrentLayerCtx()! as KlCanvasContext);\n        this.klCanvasWorkspace.setLastDrawEvent();\n        klHistory.pause(false);\n\n        return true;\n    }\n\n    catchup (logParam: IHistoryBroadcast | null): void {\n        // const start = performance.now();\n        //play catch up (the version that is a few steps behind)\n\n        if (!logParam || !logParam.bufferUpdate) {\n            return;\n        }\n\n        const initState: IInitState = this.getInitState();\n        let localCurrentLayerCtx = initState.canvas.getLayerContext(initState.focus);\n\n        initState.focus = execHistoryEntry(\n            logParam.bufferUpdate,\n            initState.focus,\n            initState.canvas,\n            initState.brushes,\n            (ctx) => {\n                localCurrentLayerCtx = ctx;\n            },\n            () => throwIfNull(localCurrentLayerCtx),\n        );\n\n        // console.log('catchup', performance.now() - start);\n    }\n\n\n}","import {IRGB, ISliderConfig} from '../kl-types';\n\nexport type TBrushSettingEmit = { type: 'color'; value: IRGB } |\n    { type: 'opacity'; value: number } |\n    { type: 'size'; value: number } |\n    { type: 'sliderConfig'; value: ISliderConfig };\n\nexport type TBrushSettingSubscriber = (p : TBrushSettingEmit) => void;\n\n/**\n * Central place to update brush settings, and to subscribe to changes.\n */\nexport class BrushSettingService {\n\n    private static instance: BrushSettingService;\n    subscriberArr: TBrushSettingSubscriber[] = [];\n\n    private emit (obj: TBrushSettingEmit, skipSubscriber?: TBrushSettingSubscriber): void {\n        for (let i = 0; i < this.subscriberArr.length; i++) {\n            if (this.subscriberArr[i] === skipSubscriber) {\n                continue;\n            }\n            this.subscriberArr[i](obj);\n        }\n    }\n\n    // --- public ---\n\n    constructor (\n        private onSetColor: (rgb: IRGB) => void,\n        private onSetSize: (size: number) => void,\n        private onSetOpacity: (opacity: number) => void,\n        private onGetColor: () => IRGB,\n        private onGetSize: () => number,\n        private onGetOpacity: () => number,\n        private onGetSliderConfig: () => ISliderConfig,\n    ) {\n        if (BrushSettingService.instance) {\n            throw new Error('BrushSettingService already instantiated');\n        }\n        BrushSettingService.instance = this;\n    }\n\n    emitColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber): void {\n        this.emit(\n            {\n                type: 'color',\n                value: color,\n            },\n            skipSubscriber\n        );\n    }\n\n    emitSize (size: number, skipSubscriber?: TBrushSettingSubscriber): void {\n        this.emit(\n            {\n                type: 'size',\n                value: size,\n            },\n            skipSubscriber\n        );\n    }\n\n    emitOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber): void {\n        this.emit(\n            {\n                type: 'opacity',\n                value: opacity,\n            },\n            skipSubscriber\n        );\n    }\n\n    emitSliderConfig (sliderConfig: ISliderConfig, skipSubscriber?: TBrushSettingSubscriber) {\n        this.emit(\n            {\n                type: 'sliderConfig',\n                value: sliderConfig,\n            },\n            skipSubscriber\n        );\n    }\n\n    /**\n     * set current brush color\n     * @param color\n     * @param skipSubscriber\n     */\n    setColor (color: IRGB, skipSubscriber?: TBrushSettingSubscriber) {\n        this.onSetColor(color);\n        this.emitColor(color, skipSubscriber);\n    }\n\n    /**\n     * set current brush size\n     * @param size\n     * @param skipSubscriber\n     */\n    setSize (size: number, skipSubscriber?: TBrushSettingSubscriber) {\n        this.onSetSize(size);\n        // why not emitting?\n    }\n\n    /**\n     * set current opacity\n     * @param opacity\n     * @param skipSubscriber\n     */\n    setOpacity (opacity: number, skipSubscriber?: TBrushSettingSubscriber) {\n        this.onSetOpacity(opacity);\n        // why not emitting?\n    }\n\n    /**\n     * get current brush color\n     */\n    getColor (): IRGB {\n        return this.onGetColor();\n    }\n\n    getSize (): number {\n        return this.onGetSize();\n    }\n\n    getOpacity (): number {\n        return this.onGetOpacity();\n    }\n\n    getSliderConfig (): ISliderConfig {\n        return this.onGetSliderConfig();\n    }\n\n    /**\n     * subscribe to changes\n     * @param func\n     */\n    subscribe (func: TBrushSettingSubscriber): void {\n        if (this.subscriberArr.includes(func)) {\n            return;\n        }\n        this.subscriberArr.push(func);\n    }\n\n    unsubscribe (func: TBrushSettingSubscriber): void {\n        for (let i = 0; i < this.subscriberArr.length; i++) {\n            if (func === this.subscriberArr[i]) {\n                this.subscriberArr.splice(i, 1);\n                i--;\n            }\n        }\n    }\n}\n\n","import {BB} from '../../../bb/bb';\nimport {LANG, languageStrings, LS_LANGUAGE_KEY} from '../../../language/language';\nimport {KL} from '../../kl';\nimport {languages} from '../../../../languages/languages';\nimport bitbofLogoImg from '/src/app/img/bitbof-logo.svg';\nimport klecksLogoImg from '/src/app/img/klecks-logo.png';\nimport uiSwapImg from '/src/app/img/ui/ui-swap-lr.svg';\nimport {LocalStorage} from '../../../bb/base/local-storage';\nimport {theme, TTheme} from '../../../theme/theme';\nimport {addIsDarkListener, nullToUndefined} from '../../../bb/base/base';\nimport {showLicensesDialog} from '../modals/licenses-dialog/show-licenses-dialog';\nimport {c} from '../../../bb/base/c';\nimport {SaveReminder} from '../components/save-reminder';\nimport {showModal} from '../modals/base/showModal';\n\nexport class SettingsTab {\n\n    private readonly rootEl: HTMLElement;\n\n    // --- public ---\n    constructor (\n        onLeftRight: () => void,\n        saveReminder: SaveReminder | undefined,\n        customAbout?: HTMLElement,\n    ) {\n        this.rootEl = BB.el({\n            css: {\n                margin: '10px',\n            },\n        });\n\n        // ---- language ----\n        const autoLanguage = languageStrings.getAutoLanguage();\n\n        const langWrapper = BB.el({\n            parent: this.rootEl,\n            content: BB.el({\n                content: LANG('settings-language') + ':',\n                css: {\n                    marginRight: '5px',\n                    marginBottom: '2px',\n                },\n            }),\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                flexWrap: 'wrap',\n            },\n        });\n\n        const options: [string, string][] = [\n            ['auto', LANG('auto') + `  ${autoLanguage.name} (${autoLanguage.code})`] as [string, string],\n            ...languages.map(item => {\n                return [item.code, item.name + ` (${item.code})`] as [string, string];\n            }),\n        ];\n        const languageSelect = new KL.Select({\n            initValue: nullToUndefined(LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto'),\n            optionArr: options,\n            onChange: (val) => {\n                if (val === 'auto') {\n                    LocalStorage.removeItem(LS_LANGUAGE_KEY);\n                } else {\n                    LocalStorage.setItem(LS_LANGUAGE_KEY, val);\n                }\n                languageHint.style.display = 'block';\n            },\n        });\n        BB.css(languageSelect.getElement(), {\n            flexGrow: '1',\n        });\n        const languageHint = BB.el({\n            className: 'kl-toolspace-note',\n            content: LANG('settings-language-reload'),\n            css: {\n                display: 'none',\n                marginTop: '5px',\n                flexGrow: '1',\n            },\n        });\n\n        langWrapper.append(\n            languageSelect.getElement(),\n            languageHint,\n        );\n\n\n        // ---- theme ----\n        function themeToLabel (theme: TTheme): string {\n            return theme === 'dark' ? ' ' + LANG('theme-dark') : ' ' + LANG('theme-light');\n        }\n        const themeSelect = new KL.Select({\n            optionArr: [\n                ['auto', LANG('auto') + '  ' + themeToLabel(theme.getMediaQueryTheme())],\n                ['light', themeToLabel('light')],\n                ['dark', themeToLabel('dark')],\n            ],\n            initValue: theme.getStoredTheme() || 'auto',\n            onChange: (val): void => {\n                theme.setStoredTheme(val === 'auto' ? undefined : val);\n            },\n        });\n        BB.css(themeSelect.getElement(), {\n            flexGrow: '1',\n        });\n        addIsDarkListener(() => {\n            themeSelect.updateLabel('auto', LANG('auto') + '  ' + themeToLabel(theme.getMediaQueryTheme()));\n        });\n        BB.el({\n            parent: this.rootEl,\n            content: [\n                BB.el({\n                    content: LANG('settings-theme') + ':',\n                    css: {\n                        marginRight: '5px',\n                        marginBottom: '2px',\n                    },\n                }),\n                themeSelect.getElement(),\n            ],\n            css: {\n                marginTop: '15px',\n                display: 'flex',\n                alignItems: 'center',\n                flexWrap: 'wrap',\n            },\n        });\n\n        // ---- save reminder ----\n        if (saveReminder) {\n            const reminderSelect = new KL.Select({\n                optionArr: [\n                    ['20min', LANG('x-minutes', {x: '20'})],\n                    ['40min', LANG('x-minutes', {x: '40'})],\n                    ['disabled', ' ' + LANG('settings-save-reminder-disabled')],\n                ],\n                initValue: saveReminder.getSetting(),\n                onChange: (val) => {\n                    if (val !== 'disabled') {\n                        saveReminder.setSetting(val);\n                        return;\n                    }\n                    const disableStr = LANG('settings-save-reminder-confirm-disable');\n                    showModal({\n                        target: document.body,\n                        message: '' + LANG('settings-save-reminder-confirm-title'),\n                        div: c('', [\n                            c('.info-hint', LANG('settings-save-reminder-confirm-a')),\n                            LANG('settings-save-reminder-confirm-b'),\n                        ]),\n                        buttons: [disableStr, 'Cancel'],\n                        callback: (result) => {\n                            if (result === disableStr) {\n                                saveReminder.setSetting(val);\n                            } else {\n                                reminderSelect.setValue(saveReminder.getSetting());\n                            }\n                        },\n                    });\n                },\n            });\n            reminderSelect.getElement().style.flexGrow = '1';\n\n            this.rootEl.append(c(',flex,items-center,gap-5,mt-15,flexWrap', [\n                LANG('settings-save-reminder-label') + ':',\n                reminderSelect.getElement(),\n            ]));\n        }\n\n        // ---- flip ui ----\n        BB.el({\n            tagName: 'button',\n            parent: this.rootEl,\n            content: '<img height=\"20\" width=\"18\" src=\"' + uiSwapImg + '\" alt=\"icon\" style=\"margin-right: 5px\"/>' + LANG('switch-ui-left-right'),\n            onClick: () => onLeftRight(),\n            css: {\n                marginTop: '15px',\n            },\n            custom: {\n                tabIndex: '-1',\n            },\n        });\n\n\n        // ---- about ----\n        this.rootEl.append(BB.el({className: 'grid-hr', css: {margin: '10px 0'}}));\n\n        function makeLicenses () {\n            return BB.el({\n                tagName: 'a',\n                content: LANG('licenses'),\n                onClick: () => showLicensesDialog(),\n            });\n        }\n\n        if (customAbout) {\n            this.rootEl.append(customAbout);\n            if (!customAbout.innerHTML) {\n                const minimalAbout = BB.el({\n                    parent: customAbout,\n                    css: {\n                       textAlign: 'center',\n                   },\n                });\n                minimalAbout.append(\n                    BB.el({\n                        content: `<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a>  2023<br>`,\n                    }),\n                    makeLicenses(),\n                );\n            }\n        } else {\n            const versionEl = BB.el({\n                parent: this.rootEl,\n                css: {\n                    textAlign: 'center',\n                },\n                content: `\n<img alt=\"Klecks\" class=\"dark-invert\" height=\"25\" src=\"${klecksLogoImg}\"><br>\n<img alt=\"icon\" height=\"20\" style=\"vertical-align:middle\" src=\"${bitbofLogoImg}\"> <a href=\"https://bitbof.com\" target=\"_blank\" tabIndex=\"-1\">bitbof</a>  2023<br>`,\n            });\n\n            versionEl.append(\n                makeLicenses(),\n                document.createTextNode(' | '),\n                BB.el({\n                    tagName: 'a',\n                    content: LANG('donate'),\n                    custom: {\n                        href: 'https://kleki.com/donate/',\n                        target: '_blank',\n                    },\n                }),\n                document.createTextNode(' | '),\n                BB.el({\n                    tagName: 'a',\n                    content: LANG('source-code'),\n                    custom: {\n                        href: 'https://klecks.org',\n                        target: '_blank',\n                    },\n                }),\n            );\n\n\n        }\n\n        window.addEventListener('storage', (e) => {\n            if (e.key !== LS_LANGUAGE_KEY) {\n                return;\n            }\n            languageSelect.setValue(\n                nullToUndefined(LocalStorage.getItem(LS_LANGUAGE_KEY) ? LocalStorage.getItem(LS_LANGUAGE_KEY) : 'auto'),\n            );\n        });\n\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n}","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"bitbof-logo.bc5e3ed5.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"ui-swap-lr.7f474f51.svg\";","import {c} from '../../../../bb/base/c';\nimport {css as emotionCss} from '@emotion/css';\nimport {DynamicModal} from '../base/dynamic-modal';\nimport {BB} from '../../../../bb/bb';\nimport {LANG} from '../../../../language/language';\n\nexport function showLicensesDialog () {\n    const licensesCss = emotionCss({\n        display: 'flex',\n        flexDirection: 'column',\n        gap: '10px',\n        'details > div': {\n            padding: '10px',\n            boxShadow: '0 0 0 1px',\n            marginTop: '5px',\n            fontFamily: 'monospace',\n            background: '#aaa2',\n            overflow: 'hidden',\n        },\n        'summary': {\n            cursor: 'pointer',\n            userSelect: 'none',\n        },\n    });\n\n    const libraries = c('.' + licensesCss, LANG('loading'));\n    const fonts = c('.' + licensesCss, LANG('loading'));\n\n    const content = c(',flex,flexCol,gap-10', [\n        libraries,\n        fonts,\n    ]);\n\n    new DynamicModal({\n        title: BB.el({\n            content: LANG('licenses'),\n        }),\n        content: BB.el({\n            content,\n            css: {\n                height: '100%',\n                overflowY: 'auto',\n                padding: '10px',\n                boxSizing: 'border-box',\n            },\n        }),\n        width: 800,\n        isMaxHeight: true,\n        onClose: () => {\n            if (window.location.hash === '#licenses') {\n                history.replaceState('', document.title, window.location.pathname\n                    + window.location.search);\n            }\n        },\n    });\n\n    import('./licenses').then(result => {\n        libraries.innerHTML = '';\n        result.licenses.forEach(item => {\n            libraries.append(c('details', [\n                c('summary', item.title),\n                c('', item.full.replace(/\\n/g, '<br>')),\n            ]));\n        });\n    });\n\n    import('../../../../../fonts/font-licenses').then(result => {\n        fonts.innerHTML = '';\n        result.fontLicenses.forEach(item => {\n            fonts.append(c('details', [\n                c('summary', 'Font: ' + item.title),\n                c('', item.full.replace(/\\n/g, '<br>')),\n            ]));\n        });\n    });\n}","import {BB} from '../../../bb/bb';\nimport {LANG} from '../../../language/language';\nimport {dialogCounter} from '../modals/modal-count';\n\n/**\n * Scroll buttons at the top and bottom of toolspace\n * Show up when window is very small.\n * Allow user to scroll up and down toolspace.\n */\nexport class ToolspaceScroller {\n\n    private readonly toolspace: HTMLElement;\n    private readonly upBtn: HTMLElement;\n    private readonly downBtn: HTMLElement;\n    private downInterval: any;\n    private upInterval: any;\n\n    private update (): void {\n        let newUpDisplay = this.upBtn.style.display;\n        let newDownDisplay = this.downBtn.style.display;\n        if (this.toolspace.scrollHeight > this.toolspace.offsetHeight + 3) { // small buffer where it's not worth it\n            if (!this.upInterval) {\n                newUpDisplay = this.toolspace.scrollTop === 0 ? 'none' : 'block';\n            }\n            if (!this.downInterval) {\n                newDownDisplay = (\n                    this.toolspace.scrollTop + this.toolspace.offsetHeight + 1 >= this.toolspace.scrollHeight ?\n                        'none' : 'block'\n                );\n            }\n        } else {\n            newUpDisplay = 'none';\n            newDownDisplay = 'none';\n        }\n        // check to prevent infinite MutationObserver loop in Pale Moon\n        if (newUpDisplay !== this.upBtn.style.display) {\n            this.upBtn.style.display = newUpDisplay;\n        }\n        if (newDownDisplay !== this.downBtn.style.display) {\n            this.downBtn.style.display = newDownDisplay;\n        }\n    }\n\n    // --- public ---\n    constructor (p: {toolspace: HTMLElement; uiState: 'left' | 'right'}) {\n        this.toolspace = p.toolspace;\n        this.upBtn = BB.el({\n            parent: this.toolspace,\n            title: LANG('scroll'),\n            className: 'kl-scroller',\n            css: {\n                top: '0',\n                transform: 'rotate(180deg)',\n            },\n        });\n        this.downBtn = BB.el({\n            parent: this.toolspace,\n            title: LANG('scroll'),\n            className: 'kl-scroller',\n            css: {\n                bottom: '0',\n            },\n        });\n        this.updateUiState(p.uiState);\n\n        const upListener = new BB.PointerListener({\n            target: this.upBtn,\n            onPointer: (e) => {\n                if (e.type === 'pointerdown') {\n                    this.upInterval = setInterval(() => {\n                        this.toolspace.scrollBy(0, -13);\n                        this.update();\n                    }, 20);\n                }\n                if (e.type === 'pointerup') {\n                    clearInterval(this.upInterval);\n                    setTimeout(() => { // prevent ff pressing anything underneath\n                        this.upInterval = null;\n                        this.update();\n                    }, 50);\n                }\n            },\n        });\n        const downListener = new BB.PointerListener({\n            target: this.downBtn,\n            onPointer: (e) => {\n                if (e.type === 'pointerdown') {\n                    this.downInterval = setInterval(() => {\n                        this.toolspace.scrollBy(0, 13);\n                        this.update();\n                    }, 20);\n                }\n                if (e.type === 'pointerup') {\n                    clearInterval(this.downInterval);\n                    setTimeout(() => { // prevent ff pressing anything underneath\n                        this.downInterval = null;\n                        this.update();\n                    }, 50);\n                }\n            },\n        });\n\n        const wheelListener = (e: WheelEvent) => {\n            this.toolspace.scrollBy(0, Math.round(0.7 * e.deltaY));\n            this.update();\n        };\n        this.upBtn.addEventListener('wheel', wheelListener);\n        this.downBtn.addEventListener('wheel', wheelListener);\n\n        this.update();\n\n        const observer = new MutationObserver(() => this.update());\n        observer.observe(\n            this.toolspace,\n            {\n                attributes: true,\n                childList: true,\n                subtree: true,\n            }\n        );\n        window.addEventListener('resize', () => this.update());\n\n        // hide if in dialog because that can have its own scrollbar\n        dialogCounter.subscribe((v) => {\n            // ignores the 0.5 by tool dropdown\n            this.upBtn.style.opacity = v >= 1 ? '0' : '';\n            this.downBtn.style.opacity = v >= 1 ? '0' : '';\n        });\n    }\n\n    updateUiState (uiState: 'left' | 'right'): void {\n        BB.css(this.upBtn, {\n            left: uiState === 'left' ? '0' : '',\n            right: uiState === 'right' ? '0' : '',\n        });\n        BB.css(this.downBtn, {\n            left: uiState === 'left' ? '0' : '',\n            right: uiState === 'right' ? '0' : '',\n        });\n    }\n}","import {BB} from '../../../bb/bb';\nimport {KlSlider} from '../components/kl-slider';\nimport {LANG} from '../../../language/language';\nimport {Checkbox} from '../components/checkbox';\nimport {Options} from '../components/options';\nimport {TGradientType} from '../../kl-types';\nimport {KlColorSlider} from '../components/kl-color-slider';\n\n\ninterface IGradientUiSettings {\n    opacity: number;\n    type: TGradientType;\n    doLockAlpha: boolean;\n    doSnap: boolean;\n    isReversed: boolean;\n    isEraser: boolean;\n}\n\n/**\n * Gradient Tool tab contents\n *\n * @param p\n * @constructor\n */\nexport class GradientUi {\n\n    private readonly rootEl: HTMLElement;\n    private colorDiv: HTMLElement;\n    private colorSlider: KlColorSlider;\n    private isVisible: boolean;\n    private readonly iconArr: HTMLElement[];\n\n    private settings: IGradientUiSettings = {\n        opacity: 1,\n        type: 'linear',\n        doLockAlpha: false,\n        doSnap: false,\n        isReversed: false,\n        isEraser: false,\n    };\n\n    private updateIcons (): void {\n        const col1 = this.settings.isReversed ? '#0000' : '#000';\n        const col2 = this.settings.isReversed ? '#000' : '#0000';\n        this.iconArr[0].style.background = `linear-gradient(${col1}, ${col2})`;\n        this.iconArr[1].style.background = `linear-gradient(${col2}, ${col1}, ${col2})`;\n        this.iconArr[2].style.background = `radial-gradient(${col1}, ${col2})`;\n    }\n\n    // ----- public -------\n\n    constructor (\n        p: {\n            colorSlider: KlColorSlider; // when opening tab, inserts it (snatches it from where else it was)\n        }\n    ) {\n        this.colorSlider = p.colorSlider;\n        this.rootEl = BB.el({\n            css: {\n                margin: '10px',\n            },\n        });\n        this.isVisible = true;\n\n        this.colorDiv = BB.el({\n            parent: this.rootEl,\n            css: {\n                marginBottom: '10px',\n            },\n        });\n\n        this.iconArr = [];\n        {\n            const size = 33;\n            [0, 1, 2].forEach(() => {\n                const el = BB.el({\n                    className: 'dark-invert',\n                    css: {\n                        width: size + 'px',\n                        height: size + 'px',\n                        borderRadius: '3px',\n                        margin: '1px',\n                    },\n                });\n                this.iconArr.push(el);\n            });\n        }\n        this.updateIcons();\n\n        const typeOptions = new Options<TGradientType>({\n            optionArr: [\n                {\n                    id: 'linear',\n                    label: this.iconArr[0],\n                    title: LANG('gradient-linear'),\n                },\n                {\n                    id: 'linear-mirror',\n                    label: this.iconArr[1],\n                    title: LANG('gradient-linear-mirror'),\n                },\n                {\n                    id: 'radial',\n                    label: this.iconArr[2],\n                    title: LANG('gradient-radial'),\n                },\n            ],\n            initId: 'linear',\n            onChange: (id) => {\n                this.settings.type = id;\n            },\n        });\n        this.rootEl.append(typeOptions.getElement());\n\n        const opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: 250,\n            height: 30,\n            min: 1 / 100,\n            max: 1,\n            value: this.settings.opacity,\n            toValue: (displayValue) => displayValue / 100,\n            toDisplayValue: (value) => value * 100,\n            onChange: (val) => {\n                this.settings.opacity = val;\n            },\n        });\n        BB.css(opacitySlider.getElement(), {\n            marginTop: '10px',\n        });\n        this.rootEl.append(opacitySlider.getElement());\n\n\n\n        const row1 = BB.el({\n            parent: this.rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginTop: '10px',\n            },\n        });\n\n        const reverseToggle = new Checkbox({\n            init: false,\n            label: LANG('reverse'),\n            callback: (b) => {\n                this.settings.isReversed = b;\n                this.updateIcons();\n            },\n            css: {\n                width: '50%',\n            },\n        });\n\n        const doSnapToggle = new Checkbox({\n            init: false,\n            label: LANG('angle-snap'),\n            title: LANG('angle-snap-title'),\n            callback: (b) => {\n                this.settings.doSnap = b;\n            },\n            css: {\n                width: '50%',\n            },\n        });\n\n        row1.append(\n            reverseToggle.getElement(),\n            doSnapToggle.getElement(),\n        );\n\n\n        const row2 = BB.el({\n            parent: this.rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginTop: '10px',\n            },\n        });\n\n        const eraserToggle = new Checkbox({\n            init: this.settings.isEraser,\n            label: LANG('eraser'),\n            callback: (b) => {\n                this.settings.isEraser = b;\n            },\n            css: {\n                width: '50%',\n            },\n        });\n\n        const lockAlphaToggle = new Checkbox({\n            init: false,\n            label: LANG('lock-alpha'),\n            title: LANG('lock-alpha-title'),\n            callback: (b) => {\n                this.settings.doLockAlpha = b;\n            },\n            doHighlight: true,\n            css: {\n                width: '50%',\n            },\n        });\n\n        row2.append(\n            eraserToggle.getElement(),\n            lockAlphaToggle.getElement(),\n        );\n\n\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    setIsVisible (isVisible: boolean): void {\n        this.isVisible = !!isVisible;\n        this.rootEl.style.display = isVisible ? 'block' : 'none';\n        if (isVisible) {\n            this.colorDiv.append(this.colorSlider.getElement(), this.colorSlider.getOutputElement());\n        }\n    }\n\n    getSettings (): IGradientUiSettings {\n        return BB.copyObj(this.settings);\n    }\n\n}","import {KL} from '../klecks/kl';\nimport {klHistory, TMiscFocusLayerHistoryEntry} from '../klecks/history/kl-history';\nimport {BB} from '../bb/bb';\nimport {showIframeModal} from '../klecks/ui/modals/show-iframe-modal';\nimport {EmbedToolspaceTopRow} from '../embed/embed-toolspace-top-row';\nimport {\n    IGradient,\n    IInitState,\n    IKlProject, IRGB,\n    TDrawEvent,\n    TExportType,\n    TKlCanvasLayer,\n    TUiLayout,\n} from '../klecks/kl-types';\nimport {importFilters} from '../klecks/filters/filters-lazy';\nimport {base64ToBlob} from '../klecks/storage/base-64-to-blob';\nimport {klCanvasToPsdBlob} from '../klecks/storage/kl-canvas-to-psd-blob';\nimport {ProjectStore} from '../klecks/storage/project-store';\nimport {SaveReminder} from '../klecks/ui/components/save-reminder';\nimport {KlCanvasWorkspace} from '../klecks/canvas-ui/kl-canvas-workspace';\nimport {KlCanvas} from '../klecks/canvas/kl-canvas';\nimport {LANG} from '../language/language';\nimport {LocalStorage} from '../bb/base/local-storage';\nimport {LineSmoothing} from '../klecks/events/line-smoothing';\nimport {LineSanitizer} from '../klecks/events/line-sanitizer';\nimport {TabRow} from '../klecks/ui/components/tab-row';\nimport {LayerPreview} from '../klecks/ui/components/layer-preview';\nimport {KlColorSlider} from '../klecks/ui/components/kl-color-slider';\nimport {ToolspaceToolRow} from '../klecks/ui/components/toolspace-tool-row';\nimport {StatusOverlay} from '../klecks/ui/components/status-overlay';\nimport {SaveToComputer} from '../klecks/storage/save-to-computer';\nimport {ToolspaceCollapser} from '../klecks/ui/components/toolspace-collapser';\nimport {ToolspaceScroller} from '../klecks/ui/components/toolspace-scroller';\nimport {translateSmoothing} from '../klecks/utils/translate-smoothing';\nimport {ImportHandler} from './import-handler';\n\nimport toolPaintImg from '/src/app/img/ui/tool-paint.svg';\nimport toolHandImg from '/src/app/img/ui/tool-hand.svg';\nimport toolFillImg from '/src/app/img/ui/tool-fill.svg';\nimport toolGradientImg from '/src/app/img/ui/tool-gradient.svg';\nimport toolTextImg from '/src/app/img/ui/tool-text.svg';\nimport toolShapeImg from '/src/app/img/ui/tool-shape.svg';\nimport tabSettingsImg from '/src/app/img/ui/tab-settings.svg';\nimport tabLayersImg from '/src/app/img/ui/tab-layers.svg';\nimport {LayerManager} from '../klecks/ui/tool-tabs/layer-manager/layer-manager';\nimport {IVector2D} from '../bb/bb-types';\nimport {createConsoleApi} from './console-api';\nimport {ERASE_COLOR} from '../klecks/brushes/erase-color';\nimport {throwIfNull} from '../bb/base/base';\nimport {klConfig} from '../klecks/kl-config';\nimport {TRenderTextParam} from '../klecks/image-operations/render-text';\n\ntype KlAppOptionsEmbed = {\n    url: string;\n    onSubmit: (onSuccess: () => void, onError: () => void) => void;\n};\n\ninterface IKlAppOptions {\n    saveReminder?: SaveReminder;\n    projectStore?: ProjectStore;\n    logoImg?: string; // app logo\n    bottomBar?: HTMLElement; // row at bottom of toolspace\n    embed?: KlAppOptionsEmbed;\n    app?: {\n        imgurKey?: string; // for imgur uploads\n    };\n    aboutEl?: HTMLElement; // replaces info about Klecks in settings tab\n}\n\nimportFilters();\n\nexport class KlApp {\n\n    private readonly klRootEl: HTMLElement;\n    private uiWidth: number;\n    private uiHeight: number;\n    private readonly layerPreview: LayerPreview;\n    private readonly klColorSlider: KlColorSlider;\n    private readonly toolspaceToolRow: ToolspaceToolRow;\n    private readonly statusOverlay: StatusOverlay;\n    private readonly klCanvas: KlCanvas;\n    private uiState: TUiLayout;\n    private readonly embed: undefined | KlAppOptionsEmbed;\n    private readonly saveToComputer: SaveToComputer;\n    private readonly lineSanitizer: LineSanitizer;\n    private readonly klCanvasWorkspace: KlCanvasWorkspace;\n    private readonly collapseThreshold: number = 820;\n    private readonly toolspaceCollapser: ToolspaceCollapser;\n    private readonly toolspace: HTMLElement;\n    private readonly toolspaceInner: HTMLElement;\n    private readonly toolWidth: number = 271;\n    private readonly bottomBar: HTMLElement | undefined;\n    private readonly layerManager: LayerManager;\n    private readonly toolspaceScroller: ToolspaceScroller;\n    private readonly bottomBarWrapper: HTMLElement;\n\n    private updateCollapse (): void {\n\n        //collapser\n        if (this.uiWidth < this.collapseThreshold) {\n            this.toolspaceCollapser.getElement().style.display = 'block';\n\n            this.toolspaceCollapser.setDirection(this.uiState);\n            if (this.toolspaceCollapser.isOpen()) {\n                if (this.uiState === 'left') {\n                    BB.css(this.toolspaceCollapser.getElement(), {\n                        left: '271px',\n                        right: '',\n                    });\n                    BB.css(this.klCanvasWorkspace.getElement(), {\n                        left: '271px',\n                    });\n                } else {\n                    BB.css(this.toolspaceCollapser.getElement(), {\n                        left: '',\n                        right: '271px',\n                    });\n                    BB.css(this.klCanvasWorkspace.getElement(), {\n                        left: '0',\n                    });\n                }\n                this.toolspace.style.display = 'block';\n                this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth - this.toolWidth), this.uiHeight);\n                this.statusOverlay.setWide(false);\n\n            } else {\n                if (this.uiState === 'left') {\n                    BB.css(this.toolspaceCollapser.getElement(), {\n                        left: '0',\n                        right: '',\n                    });\n                    BB.css(this.klCanvasWorkspace.getElement(), {\n                        left: '0',\n                    });\n                } else {\n                    BB.css(this.toolspaceCollapser.getElement(), {\n                        left: '',\n                        right: '0',\n                    });\n                    BB.css(this.klCanvasWorkspace.getElement(), {\n                        left: '0',\n                    });\n                }\n                this.toolspace.style.display = 'none';\n                this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth), this.uiHeight);\n                this.statusOverlay.setWide(true);\n\n            }\n\n        } else {\n            this.toolspaceCollapser.getElement().style.display = 'none';\n            if (this.uiState === 'left') {\n                BB.css(this.klCanvasWorkspace.getElement(), {\n                    left: '271px',\n                });\n            } else {\n                BB.css(this.klCanvasWorkspace.getElement(), {\n                    left: '0',\n                });\n            }\n            this.toolspace.style.display = 'block';\n            this.klCanvasWorkspace.setSize(Math.max(0, this.uiWidth - this.toolWidth), this.uiHeight);\n            this.statusOverlay.setWide(false);\n        }\n    }\n\n    private updateBottomBar (): void {\n        if (!this.bottomBar) {\n            return;\n        }\n        const isVisible = (this.toolspaceInner.scrollHeight + 40 < window.innerHeight);\n        const newDisplay = isVisible ? '' : 'none';\n        // check to prevent infinite MutationObserver loop in Pale Moon\n        if (newDisplay !== this.bottomBarWrapper.style.display) {\n            this.bottomBarWrapper.style.display = newDisplay;\n        }\n    }\n\n    private updateUi (): void {\n        this.toolspace.classList.toggle('kl-toolspace--left', this.uiState === 'left');\n        this.toolspace.classList.toggle('kl-toolspace--right', this.uiState === 'right');\n        if (this.uiState === 'left') {\n            BB.css(this.toolspace, {\n                left: '0',\n                right: '',\n            });\n            BB.css(this.klCanvasWorkspace.getElement(), {\n                left: '271px',\n            });\n        } else {\n            BB.css(this.toolspace, {\n                left: '',\n                right: '0',\n            });\n            BB.css(this.klCanvasWorkspace.getElement(), {\n                left: '0',\n            });\n        }\n        this.statusOverlay.setUiState(this.uiState);\n        this.layerPreview.setUiState(this.uiState);\n        this.layerManager.setUiState(this.uiState);\n        this.updateCollapse();\n        this.toolspaceScroller.updateUiState(this.uiState);\n    }\n\n    // -------- public --------\n    constructor (\n        pProject: IKlProject | null,\n        pOptions: IKlAppOptions,\n    ) {\n        this.embed = pOptions.embed;\n        // default 2048, unless your screen is bigger than that (that computer then probably has the horsepower for that)\n        // but not larger than 4096 - a fairly arbitrary decision\n        const klMaxCanvasSize = Math.min(4096, Math.max(2048, Math.max(window.screen.width, window.screen.height)));\n        this.uiState = (this.embed ? 'left' : (LocalStorage.getItem('uiState') ? LocalStorage.getItem('uiState') : 'right')) as TUiLayout;\n        const projectStore = pOptions.projectStore;\n        this.klRootEl = BB.el({\n            className: 'g-root',\n            css: {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                right: '0',\n                bottom: '0',\n            },\n        });\n        this.uiWidth = Math.max(0, window.innerWidth);\n        this.uiHeight = Math.max(0, window.innerHeight);\n        let exportType: TExportType = 'png';\n        this.klCanvas = new KL.KlCanvas(\n            pProject ? {\n                projectObj: pProject,\n            } : {\n                width: Math.max(10, Math.min(klMaxCanvasSize, window.innerWidth < this.collapseThreshold ? this.uiWidth : this.uiWidth - this.toolWidth)),\n                height: Math.max(10, Math.min(klMaxCanvasSize, this.uiHeight)),\n            }, this.embed ? -1 : 0);\n        this.klCanvas.setHistory(klHistory);\n        let initState: IInitState;\n        let mainTabRow: TabRow | undefined = undefined;\n\n        if (!pOptions.saveReminder) {\n            pOptions.saveReminder = {init: () => {}, reset: () => {}} as SaveReminder;\n        }\n\n        if (pProject) {\n            // attempt at freeing memory\n            pProject.layers.forEach(layer => {\n                layer.image = null as any;\n            });\n            pProject = null;\n        } else {\n            klHistory.pause(true);\n            this.klCanvas.addLayer();\n            this.klCanvas.layerFill(0, {r: ERASE_COLOR, g: ERASE_COLOR, b: ERASE_COLOR});\n            klHistory.pause(false);\n        }\n        try {\n            initState = {\n                canvas: new KL.KlCanvas({copy: this.klCanvas}, this.embed ? -1 : 0),\n                focus: this.klCanvas.getLayerCount() - 1,\n                brushes: {},\n            };\n        } catch (e) {\n            if ((e as Error).message === 'kl-create-canvas-error') {\n                this.klCanvas.destroy();\n            }\n            throw e;\n        }\n        Object.entries(KL.brushes).forEach(([b, Brush]) => {\n            initState.brushes[b] = new Brush();\n            if (initState.canvas) {\n                initState.brushes[b].setContext(initState.canvas.getLayerContext(initState.focus));\n            }\n        });\n\n\n        let currentColor = new BB.RGB(0, 0, 0);\n        let currentBrushUi: any; // todo\n        let currentBrushId: string;\n        let lastNonEraserBrushId: string;\n        let currentLayerCtx = throwIfNull(this.klCanvas.getLayerContext(this.klCanvas.getLayerCount() - 1));\n\n        // when cycling through brushes you need to know the next non-eraser brush\n        const getNextBrushId = (): string => {\n            if (currentBrushId === 'eraserBrush') {\n                return lastNonEraserBrushId;\n            }\n            const keyArr = Object.keys(brushUiMap).filter(item => item !== 'eraserBrush');\n            const i = keyArr.findIndex(item => item === currentBrushId);\n            return keyArr[(i + 1) % keyArr.length];\n        };\n\n        const sizeWatcher = (val: number) => {\n            brushSettingService.emitSize(val);\n            if (this.klCanvasWorkspace) {\n                this.klCanvasWorkspace.setCursorSize(val * 2);\n            }\n        };\n\n        const brushSettingService = new KL.BrushSettingService(\n            (color) => {\n                this.klColorSlider.setColor(color);\n                currentBrushUi.setColor(color);\n                currentColor = BB.copyObj(color);\n            },\n            (size) => {\n                currentBrushUi.setSize(size);\n                this.klCanvasWorkspace.setCursorSize(size * 2);\n            },\n            (opacity) => {\n                currentBrushUi.setOpacity(opacity);\n            },\n            () => this.klColorSlider.getColor(),\n            () => brushUiMap[currentBrushId].getSize(),\n            () => brushUiMap[currentBrushId].getOpacity(),\n            () => {\n                return {\n                    sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\n                    opacitySlider: KL.brushesUI[currentBrushId].opacitySlider,\n                };\n            }\n        );\n\n        const lineSmoothing = new LineSmoothing({\n            smoothing: translateSmoothing(1),\n        });\n        this.lineSanitizer = new LineSanitizer();\n\n        const drawEventChain = new BB.EventChain({\n            chainArr: [\n                this.lineSanitizer as any,\n                lineSmoothing as any,\n            ],\n        });\n\n        drawEventChain.setChainOut(((event: TDrawEvent) => {\n            if (event.type === 'down') {\n                this.toolspace.style.pointerEvents = 'none';\n                currentBrushUi.startLine(event.x, event.y, event.pressure);\n                this.klCanvasWorkspace.requestFrame();\n            }\n            if (event.type === 'move') {\n                currentBrushUi.goLine(event.x, event.y, event.pressure, false, event.isCoalesced);\n                this.klCanvasWorkspace.setLastDrawEvent(event.x, event.y, event.pressure);\n                this.klCanvasWorkspace.requestFrame();\n            }\n            if (event.type === 'up') {\n                this.toolspace.style.pointerEvents = '';\n                currentBrushUi.endLine();\n                this.klCanvasWorkspace.requestFrame();\n            }\n            if (event.type === 'line') {\n                currentBrushUi.getBrush().drawLineSegment(event.x0, event.y0, event.x1, event.y1);\n                this.klCanvasWorkspace.requestFrame();\n            }\n        }) as any);\n\n        let textToolSettings = {\n            size: 20,\n            align: 'left' as ('left' | 'center' | 'right'),\n            isBold: false,\n            isItalic: false,\n            font: 'sans-serif',\n            letterSpacing: 0,\n            lineHeight: 1,\n            fill: {\n                color: {r: 0, g: 0, b: 0, a: 1},\n            },\n        } as TRenderTextParam;\n\n        this.klCanvasWorkspace = new KL.KlCanvasWorkspace({\n            klCanvas: this.klCanvas,\n            width: Math.max(0, this.uiWidth - this.toolWidth),\n            height: this.uiHeight,\n            onDraw: (e) => drawEventChain.chainIn(e as any),\n            onPick: (rgbObj, isDragDone) => {\n                brushSettingService.setColor(rgbObj);\n                if (isDragDone) {\n                    this.klColorSlider.pickingDone();\n                    this.klCanvasWorkspace.setMode(this.toolspaceToolRow.getActive());\n                }\n            },\n            onFill: (canvasX, canvasY) => {\n                const layerIndex = throwIfNull(this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\n                this.klCanvas.floodFill(\n                    layerIndex,\n                    canvasX,\n                    canvasY,\n                    fillUi.getIsEraser() ? null : this.klColorSlider.getColor(),\n                    fillUi.getOpacity(),\n                    fillUi.getTolerance(),\n                    fillUi.getSample(),\n                    fillUi.getGrow(),\n                    fillUi.getContiguous()\n                );\n                this.klCanvasWorkspace.requestFrame();\n            },\n            onGradient: (typeStr, canvasX, canvasY, angleRad) => {\n                if (typeStr === 'down') {\n                    gradientTool.onDown(canvasX, canvasY, angleRad);\n                }\n                if (typeStr === 'move') {\n                    gradientTool.onMove(canvasX, canvasY);\n                }\n                if (typeStr === 'up') {\n                    gradientTool.onUp(canvasX, canvasY);\n                }\n            },\n            onText: (canvasX, canvasY, angleRad) => {\n                if (KL.dialogCounter.get() > 0) {\n                    return;\n                }\n\n                KL.textToolDialog({\n                    klCanvas: this.klCanvas,\n                    layerIndex: throwIfNull(this.klCanvas.getLayerIndex(currentLayerCtx.canvas)),\n                    primaryColor: this.klColorSlider.getColor(),\n                    secondaryColor: this.klColorSlider.getSecondaryRGB(),\n\n                    text: {\n                        ...textToolSettings,\n                        text: '',\n                        x: canvasX,\n                        y: canvasY,\n                        angleRad: angleRad,\n                        fill : textToolSettings.fill ? {\n                            color: {\n                                ...this.klColorSlider.getColor(),\n                                a: textToolSettings.fill.color.a,\n                            },\n                        } : undefined,\n                        stroke : textToolSettings.stroke ? {\n                            ...textToolSettings.stroke,\n                            color: {\n                                ...this.klColorSlider.getSecondaryRGB(),\n                                a: textToolSettings.stroke.color.a,\n                            },\n                        } : undefined,\n                    },\n\n                    onConfirm: (val) => {\n                        textToolSettings = {\n                            ...val,\n                            text: '',\n                        };\n                        const layerIndex = throwIfNull(this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\n                        this.klCanvas.text(layerIndex, val);\n                        this.klCanvasWorkspace.requestFrame();\n                    },\n                });\n\n            },\n            onShape: (typeStr, canvasX, canvasY, angleRad) => {\n                if (typeStr === 'down') {\n                    shapeTool.onDown(canvasX, canvasY, angleRad);\n                }\n                if (typeStr === 'move') {\n                    shapeTool.onMove(canvasX, canvasY);\n                }\n                if (typeStr === 'up') {\n                    shapeTool.onUp(canvasX, canvasY);\n                }\n            },\n\n            onViewChange: (viewChangeObj) => {\n\n                if (viewChangeObj.changed.includes('scale')) {\n                    this.statusOverlay.out({\n                        type: 'transform',\n                        scale: viewChangeObj.scale,\n                        angleDeg: viewChangeObj.angle * 180 / Math.PI,\n                    });\n                }\n\n                this.toolspaceToolRow.setEnableZoomIn(viewChangeObj.scale !== this.klCanvasWorkspace.getMaxScale());\n                this.toolspaceToolRow.setEnableZoomOut(viewChangeObj.scale !== this.klCanvasWorkspace.getMinScale());\n\n                handUi.update(viewChangeObj.scale, viewChangeObj.angle * 180 / Math.PI);\n            },\n            onUndo: () => {\n                if (klHistory.canUndo()) {\n                    if (undoRedoCatchup.undo()) {\n                        this.statusOverlay.out(LANG('undo'), true);\n                    }\n                }\n            },\n            onRedo: () => {\n                if (klHistory.canRedo()) {\n                    if (undoRedoCatchup.redo()) {\n                        this.statusOverlay.out(LANG('redo'), true);\n                    }\n                }\n            },\n        });\n\n        const updateMainTabVisibility = () => {\n            if (!mainTabRow) {\n                return;\n            }\n\n            const toolObj = {\n                'draw': {},\n                'hand': {},\n                'fill': {},\n                'gradient': {},\n                'text': {},\n                'shape': {},\n            };\n\n            const activeStr = this.toolspaceToolRow.getActive();\n            const oldTabId = mainTabRow.getOpenedTabId();\n\n            const keysArr = Object.keys(toolObj);\n            for (let i = 0; i < keysArr.length; i++) {\n                if (activeStr === keysArr[i]) {\n                    mainTabRow.setIsVisible(keysArr[i], true);\n                } else {\n                    mainTabRow.setIsVisible(keysArr[i], false);\n                    if (oldTabId === keysArr[i]) {\n                        mainTabRow.open(activeStr);\n                    }\n                }\n            }\n\n        };\n\n        const keyListener = new BB.KeyListener({\n            onDown: (keyStr, event, comboStr) => {\n                if (KL.dialogCounter.get() > 0 || BB.isInputFocused(true)) {\n                    return;\n                }\n\n                const isDrawing = this.lineSanitizer.getIsDrawing() || this.klCanvasWorkspace.getIsDrawing();\n                if (isDrawing) {\n                    return;\n                }\n\n                if (comboStr === 'plus') {\n                    this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\n                }\n                if (comboStr === 'minus') {\n                    this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\n                }\n                if (comboStr === 'home') {\n                    this.klCanvasWorkspace.fitView(true);\n                }\n                if (comboStr === 'end') {\n                    this.klCanvasWorkspace.resetView(true);\n                }\n                if (['ctrl+z', 'cmd+z'].includes(comboStr)) {\n                    event.preventDefault();\n                    undoRedoCatchup.undo();\n                }\n                if (\n                    ['ctrl+y', 'cmd+y'].includes(comboStr) ||\n                    (\n                        (\n                            BB.sameKeys('ctrl+shift+z', comboStr) ||\n                            BB.sameKeys('cmd+shift+z', comboStr)\n                        ) && keyStr === 'z'\n                    )\n                ) {\n                    event.preventDefault();\n                    undoRedoCatchup.redo();\n                }\n                if (!this.embed) {\n                    if (['ctrl+s', 'cmd+s'].includes(comboStr)) {\n                        event.preventDefault();\n                        this.saveToComputer.save();\n                    }\n                    if (['ctrl+shift+s', 'cmd+shift+s'].includes(comboStr)) {\n                        event.preventDefault();\n\n                        (async () => {\n                            let success = true;\n                            try {\n                                await projectStore!.store(this.klCanvas.getProject());\n                            } catch (e) {\n                                success = false;\n                                setTimeout(() => {\n                                    throw new Error('keyboard-shortcut: failed to store browser storage, ' + e);\n                                }, 0);\n                                this.statusOverlay.out(' ' + LANG('file-storage-failed'), true);\n                            }\n                            if (success) {\n                                pOptions.saveReminder!.reset();\n                                this.statusOverlay.out(LANG('file-storage-stored'), true);\n                            }\n                        })();\n                    }\n                    if (['ctrl+c', 'cmd+c'].includes(comboStr)) {\n                        event.preventDefault();\n                        copyToClipboard(true);\n                    }\n                }\n                if (['ctrl+a', 'cmd+a'].includes(comboStr)) {\n                    event.preventDefault();\n                }\n\n\n                if (keyListener.comboOnlyContains(['left', 'right', 'up', 'down'])) {\n                    if (keyStr === 'left') {\n                        this.klCanvasWorkspace.translateView(1, 0);\n                    }\n                    if (keyStr === 'right') {\n                        this.klCanvasWorkspace.translateView(-1, 0);\n                    }\n                    if (keyStr === 'up') {\n                        this.klCanvasWorkspace.translateView(0, 1);\n                    }\n                    if (keyStr === 'down') {\n                        this.klCanvasWorkspace.translateView(0, -1);\n                    }\n                }\n\n\n                if (['r+left','r+right'].includes(comboStr)) {\n                    if (keyStr === 'left') {\n                        this.klCanvasWorkspace.setAngle(-15, true);\n                        handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n                    }\n                    if (keyStr === 'right') {\n                        this.klCanvasWorkspace.setAngle(15, true);\n                        handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n                    }\n                }\n                if (['r+up'].includes(comboStr)) {\n                    this.klCanvasWorkspace.setAngle(0);\n                    handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n                }\n\n\n                if (comboStr === 'sqbr_open') {\n                    currentBrushUi.decreaseSize(0.03 / this.klCanvasWorkspace.getScale());\n                }\n                if (comboStr === 'sqbr_close') {\n                    currentBrushUi.increaseSize(0.03 / this.klCanvasWorkspace.getScale());\n                }\n                if (comboStr === 'enter') {\n                    this.klCanvas.layerFill(\n                        throwIfNull(this.klCanvas.getLayerIndex(currentLayerCtx.canvas)),\n                        this.klColorSlider.getColor(),\n                    );\n                    this.statusOverlay.out(LANG('filled'), true);\n                }\n                if (['delete', 'backspace'].includes(comboStr)) {\n                    const layerIndex = throwIfNull(this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\n                    if (layerIndex === 0 && !brushUiMap.eraserBrush.getIsTransparentBg()) {\n                        this.klCanvas.layerFill(layerIndex, {r: 255, g: 255, b: 255}, 'source-in');\n                    } else {\n                        this.klCanvas.clearLayer(layerIndex);\n                    }\n                    this.statusOverlay.out(LANG('cleared-layer'), true);\n                }\n                if (comboStr === 'shift+e') {\n                    event.preventDefault();\n                    currentBrushUi.toggleEraser && currentBrushUi.toggleEraser();\n\n                } else if (comboStr === 'e') {\n                    event.preventDefault();\n                    this.klCanvasWorkspace.setMode('draw');\n                    this.toolspaceToolRow.setActive('draw');\n                    mainTabRow && mainTabRow.open('draw');\n                    updateMainTabVisibility();\n                    brushTabRow.open('eraserBrush');\n                }\n                if (comboStr === 'b') {\n                    event.preventDefault();\n                    const prevMode = this.klCanvasWorkspace.getMode();\n                    this.klCanvasWorkspace.setMode('draw');\n                    this.toolspaceToolRow.setActive('draw');\n                    mainTabRow && mainTabRow.open('draw');\n                    updateMainTabVisibility();\n                    brushTabRow.open(prevMode === 'draw' ? getNextBrushId() : currentBrushId);\n                }\n                if (comboStr === 'g') {\n                    event.preventDefault();\n                    const newMode = this.klCanvasWorkspace.getMode() === 'fill' ? 'gradient' : 'fill';\n                    this.klCanvasWorkspace.setMode(newMode);\n                    this.toolspaceToolRow.setActive(newMode);\n                    mainTabRow && mainTabRow.open(newMode);\n                    updateMainTabVisibility();\n                }\n                if (comboStr === 't') {\n                    event.preventDefault();\n                    this.klCanvasWorkspace.setMode('text');\n                    this.toolspaceToolRow.setActive('text');\n                    mainTabRow && mainTabRow.open('text');\n                    updateMainTabVisibility();\n                }\n                if (comboStr === 'u') {\n                    event.preventDefault();\n                    this.klCanvasWorkspace.setMode('shape');\n                    this.toolspaceToolRow.setActive('shape');\n                    mainTabRow && mainTabRow.open('shape');\n                    updateMainTabVisibility();\n                }\n                if (comboStr === 'x') {\n                    event.preventDefault();\n                    this.klColorSlider.swapColors();\n                }\n\n\n            },\n            onUp: (keyStr, event) => {\n            },\n        });\n\n        const brushUiMap: {\n            [key: string]: any;\n        } = {};\n        // create brush UIs\n        Object.entries(KL.brushesUI).forEach(([b, brushUi]) => {\n            const ui = new (brushUi.Ui as any)({\n                onSizeChange: sizeWatcher,\n                onOpacityChange: (opacity: number) => {\n                    brushSettingService.emitOpacity(opacity);\n                },\n                onConfigChange: () => {\n                    brushSettingService.emitSliderConfig({\n                        sizeSlider: KL.brushesUI[currentBrushId].sizeSlider,\n                        opacitySlider: KL.brushesUI[currentBrushId].opacitySlider,\n                    });\n                },\n            });\n            brushUiMap[b] = ui;\n            ui.getElement().style.padding = 10 + 'px';\n        });\n\n        this.statusOverlay = new KL.StatusOverlay();\n\n        this.toolspace = BB.el({\n            className: 'kl-toolspace',\n            css: {\n                position: 'absolute',\n                right: '0',\n                top: '0',\n                bottom: '0',\n                width: (this.toolWidth) + 'px',\n                overflow: 'hidden',\n                userSelect: 'none',\n                touchAction: 'none',\n            },\n        });\n        this.toolspaceInner = BB.el({\n            parent: this.toolspace,\n        });\n        this.toolspace.oncontextmenu = () => {\n            return false;\n        };\n        this.toolspace.onclick = BB.handleClick;\n\n\n        this.toolspaceCollapser = new KL.ToolspaceCollapser({\n            onChange: () => {\n                this.updateCollapse();\n            },\n        });\n\n        this.updateCollapse();\n\n\n\n\n\n        let overlayToolspace;\n        setTimeout(() => {\n            overlayToolspace = new KL.OverlayToolspace({\n                enabledTest: () => {\n                    return KL.dialogCounter.get() === 0 && !this.lineSanitizer.getIsDrawing();\n                },\n                brushSettingService,\n            });\n            this.klRootEl.append(overlayToolspace.getElement());\n        }, 0);\n\n        BB.append(\n            this.klRootEl,\n            [\n                this.klCanvasWorkspace.getElement(),\n                this.toolspace,\n                this.toolspaceCollapser.getElement(),\n            ]\n        );\n\n        let toolspaceTopRow;\n        if (this.embed) {\n            toolspaceTopRow = new EmbedToolspaceTopRow({\n                onHelp: () => {\n                    showIframeModal(this.embed!.url + '/help.html', !!this.embed);\n                },\n                onSubmit: () => {\n                    const onFailure = () => {\n                        let closeFunc: () => void;\n                        const saveBtn = BB.el({\n                            tagName: 'button',\n                            textContent: LANG('save-reminder-save-psd'),\n                            css: {\n                                display: 'block',\n                            },\n                        });\n                        saveBtn.onclick = () => {\n                            this.saveAsPsd();\n                            closeFunc();\n                        };\n                        KL.popup({\n                            target: this.klRootEl,\n                            message: '<b>' + LANG('upload-failed') + '</b>',\n                            div: BB.el({\n                                    content: [\n                                        BB.el({\n                                            content: LANG('backup-drawing'),\n                                            css: {\n                                                marginBottom: '10px',\n                                            },\n                                        }),\n                                        saveBtn,\n                                    ],\n                                }),\n                            ignoreBackground: true,\n                            closeFunc: (f) => {\n                                closeFunc = f;\n                            },\n                        });\n                    };\n\n                    KL.popup({\n                        target: this.klRootEl,\n                        message: LANG('submit-prompt'),\n                        buttons: [LANG('submit'), 'Cancel'],\n                        callback: async (result) => {\n                            if (result !== LANG('submit')) {\n                                return;\n                            }\n\n                            const overlay = BB.el({\n                                parent: this.klRootEl,\n                                className: 'upload-overlay',\n                                content: '<div class=\"spinner\"></div> ' + LANG('submit-submitting'),\n                            });\n\n                            this.embed!.onSubmit(\n                                () => {\n                                    pOptions.saveReminder!.reset();\n                                    overlay.remove();\n                                },\n                                () => {\n                                    overlay.remove();\n                                    onFailure();\n                                });\n                        },\n                    });\n                },\n                onLeftRight: () => {\n                    this.uiState = this.uiState === 'left' ? 'right' : 'left';\n                    this.updateUi();\n                },\n            });\n        } else {\n            toolspaceTopRow = new KL.ToolspaceTopRow({\n                logoImg: pOptions.logoImg!,\n                onLogo: () => {\n                    showIframeModal('./home/', !!this.embed);\n                },\n                onNew: () => {\n                    showNewImageDialog();\n                },\n                onImport: () => {\n                    fileTab!.triggerImport();\n                },\n                onSave: () => {\n                    this.saveToComputer.save();\n                },\n                onShare: () => {\n                    shareImage();\n                },\n                onHelp: () => {\n                    showIframeModal('./help/', !!this.embed);\n                },\n            });\n        }\n        toolspaceTopRow.getElement().style.marginBottom = '10px';\n        this.toolspaceInner.append(toolspaceTopRow.getElement());\n\n        this.toolspaceToolRow = new KL.ToolspaceToolRow({\n            onActivate: (activeStr) => {\n                if (activeStr === 'draw') {\n                    this.klCanvasWorkspace.setMode('draw');\n                } else if (activeStr === 'hand') {\n                    this.klCanvasWorkspace.setMode('hand');\n                } else if (activeStr === 'fill') {\n                    this.klCanvasWorkspace.setMode('fill');\n                } else if (activeStr === 'gradient') {\n                    this.klCanvasWorkspace.setMode('gradient');\n                } else if (activeStr === 'text') {\n                    this.klCanvasWorkspace.setMode('text');\n                } else if (activeStr === 'shape') {\n                    this.klCanvasWorkspace.setMode('shape');\n                } else {\n                    throw new Error('unknown activeStr');\n                }\n                mainTabRow && mainTabRow.open(activeStr);\n                updateMainTabVisibility();\n                this.klColorSlider.pickingDone();\n            },\n            onZoomIn: () => {\n                this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? 1/8 : 1/2);\n            },\n            onZoomOut: () => {\n                this.klCanvasWorkspace.zoomByStep(keyListener.isPressed('shift') ? -1/8 : -1/2);\n            },\n            onUndo: () => {\n                undoRedoCatchup.undo();\n            },\n            onRedo: () => {\n                undoRedoCatchup.redo();\n            },\n        });\n        this.toolspaceToolRow.setIsSmall(this.uiHeight < 540);\n        klHistory.addListener(() => {\n            this.toolspaceToolRow.setEnableUndo(klHistory.canUndo());\n            this.toolspaceToolRow.setEnableRedo(klHistory.canRedo());\n        });\n        this.toolspaceInner.append(this.toolspaceToolRow.getElement());\n\n        const setBrushColor = (p_color: IRGB) => {\n            currentColor = p_color;\n            currentBrushUi.setColor(p_color);\n            brushSettingService.emitColor(p_color);\n            this.klColorSlider.pickingDone();\n        };\n\n        this.klColorSlider = new KL.KlColorSlider({\n            width: 250,\n            height: 30,\n            svHeight: 100,\n            startValue: new BB.RGB(0, 0, 0),\n            onPick: setBrushColor,\n        });\n        this.klColorSlider.setHeight(Math.max(163, Math.min(400, this.uiHeight - 505)));\n        this.klColorSlider.setPickCallback((doPick) => {\n\n            if (doPick) {\n                this.klCanvasWorkspace.setMode('pick');\n            } else {\n                this.klCanvasWorkspace.setMode(this.toolspaceToolRow.getActive());\n                updateMainTabVisibility();\n            }\n\n        });\n\n        const setCurrentBrush = (brushId: string) => {\n            if (brushId !== 'eraserBrush') {\n                lastNonEraserBrushId = brushId;\n            }\n\n            if (this.klColorSlider) {\n                if (brushId === 'eraserBrush') {\n                    this.klColorSlider.enable(false);\n                } else {\n                    this.klColorSlider.enable(true);\n                }\n            }\n\n            currentBrushId = brushId;\n            currentBrushUi = brushUiMap[brushId];\n            currentBrushUi.setColor(currentColor);\n            currentBrushUi.setContext(currentLayerCtx);\n            this.klCanvasWorkspace.setMode('draw');\n            this.toolspaceToolRow.setActive('draw');\n            updateMainTabVisibility();\n        };\n\n        const setCurrentLayer = (layer: TKlCanvasLayer) => { //BrushContext(p_context) {\n            currentLayerCtx = layer.context;\n            currentBrushUi.setContext(layer.context);\n            this.layerPreview.setLayer(layer);\n        };\n\n        const brushDiv = BB.el();\n        const colorDiv = BB.el({\n            css: {\n                margin: '10px',\n                display: 'flex',\n                flexWrap: 'wrap',\n                justifyContent: 'space-between',\n                alignItems: 'flex-end',\n            },\n        });\n        const toolspaceStabilizerRow = new KL.ToolspaceStabilizerRow({\n            smoothing: 1,\n            onSelect: (v) => {\n                lineSmoothing.setSmoothing(translateSmoothing(v));\n            },\n        });\n\n\n        brushDiv.append(colorDiv);\n        BB.append(\n            colorDiv,\n            [this.klColorSlider.getElement(), this.klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\n        );\n\n        const brushTabRow = new KL.TabRow({\n            initialId: 'penBrush',\n            useAccent: true,\n            tabArr: (() => {\n                const result = [];\n\n                const createTab = (keyStr: string) => {\n                    return {\n                        id: keyStr,\n                        image: KL.brushesUI[keyStr].image,\n                        title: KL.brushesUI[keyStr].tooltip,\n                        onOpen: () => {\n                            brushUiMap[keyStr].getElement().style.display = 'block';\n                            setCurrentBrush(keyStr);\n                            this.klColorSlider.pickingDone();\n                            brushSettingService.emitSliderConfig({\n                                sizeSlider: KL.brushesUI[keyStr].sizeSlider,\n                                opacitySlider: KL.brushesUI[keyStr].opacitySlider,\n                            });\n                            sizeWatcher(brushUiMap[keyStr].getSize());\n                            brushSettingService.emitOpacity(brushUiMap[keyStr].getOpacity());\n                        },\n                        onClose: () => {\n                            brushUiMap[keyStr].getElement().style.display = 'none';\n                        },\n                    };\n                };\n\n                const keyArr = Object.keys(brushUiMap);\n                for (let i = 0; i < keyArr.length; i++) {\n                    result.push(createTab(keyArr[i]));\n                }\n                return result;\n            })(),\n        });\n        BB.append(brushDiv, [\n            brushTabRow.getElement(),\n            ...Object.entries(KL.brushesUI).map(([b]) => brushUiMap[b].getElement()),\n        ]);\n\n        const handUi = new KL.HandUi({\n            scale: this.klCanvasWorkspace.getScale(),\n            angleDeg: 0,\n            onReset: () => {\n                this.klCanvasWorkspace.resetView(true);\n                handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n            },\n            onFit: () => {\n                this.klCanvasWorkspace.fitView(true);\n                handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n            },\n            onAngleChange: (angleDeg, isRelative) => {\n                this.klCanvasWorkspace.setAngle(angleDeg, isRelative);\n                handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n            },\n        });\n\n        const fillUi = new KL.FillUi({\n            colorSlider: this.klColorSlider,\n        });\n\n        const gradientUi = new KL.GradientUi({\n            colorSlider: this.klColorSlider,\n        });\n\n        const textUi = new KL.TextUi({\n            colorSlider: this.klColorSlider,\n        });\n\n        const shapeUi = new KL.ShapeUi({\n            colorSlider: this.klColorSlider,\n        });\n\n        const gradientTool = new KL.GradientTool({\n            onGradient: (isDone, x1, y1, x2, y2, angleRad) => {\n                const layerIndex = throwIfNull(this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\n                const settings = gradientUi.getSettings();\n                const gradientObj: IGradient = {\n                    type: settings.type,\n                    color1: this.klColorSlider.getColor(),\n                    isReversed: settings.isReversed,\n                    opacity: settings.opacity,\n                    doLockAlpha: settings.doLockAlpha,\n                    isEraser: settings.isEraser,\n                    doSnap: keyListener.isPressed('shift') || settings.doSnap,\n                    x1,\n                    y1,\n                    x2,\n                    y2,\n                    angleRad,\n                };\n\n                if (isDone) {\n                    this.klCanvas.setComposite(layerIndex, null);\n                    this.klCanvas.drawGradient(layerIndex, gradientObj);\n                } else {\n                    this.klCanvas.setComposite(layerIndex, {\n                        draw: (ctx) => {\n                            KL.drawGradient(ctx, gradientObj);\n                        },\n                    });\n                }\n                this.klCanvasWorkspace.requestFrame();\n            },\n        });\n\n        const shapeTool = new KL.ShapeTool({\n            onShape: (isDone, x1, y1, x2, y2, angleRad) => {\n\n                const layerIndex = throwIfNull(this.klCanvas.getLayerIndex(currentLayerCtx.canvas));\n\n                const shapeObj: any = {\n                    type: shapeUi.getShape(),\n                    x1: x1,\n                    y1: y1,\n                    x2: x2,\n                    y2: y2,\n                    angleRad: angleRad,\n                    isOutwards: shapeUi.getIsOutwards(),\n                    opacity: shapeUi.getOpacity(),\n                    isEraser: shapeUi.getIsEraser(),\n                    doLockAlpha: shapeUi.getDoLockAlpha(),\n                };\n                if (shapeUi.getShape() === 'line') {\n                    shapeObj.strokeRgb = this.klColorSlider.getColor();\n                    shapeObj.lineWidth = shapeUi.getLineWidth();\n                    shapeObj.isAngleSnap = shapeUi.getIsSnap() || keyListener.isPressed('shift');\n                } else {\n                    shapeObj.isFixedRatio = shapeUi.getIsFixed() || keyListener.isPressed('shift');\n                    if (shapeUi.getMode() === 'stroke') {\n                        shapeObj.strokeRgb = this.klColorSlider.getColor();\n                        shapeObj.lineWidth = shapeUi.getLineWidth();\n                    } else {\n                        shapeObj.fillRgb = this.klColorSlider.getColor();\n                    }\n                }\n\n                if (isDone) {\n                    this.klCanvas.setComposite(layerIndex, null);\n                    this.klCanvas.drawShape(layerIndex, shapeObj);\n                } else {\n                    this.klCanvas.setComposite(layerIndex, {\n                        draw: (ctx) => {\n                            KL.drawShape(ctx, shapeObj);\n                        },\n                    });\n                }\n                this.klCanvasWorkspace.requestFrame();\n\n            },\n        });\n\n        this.layerManager = new KL.LayerManager(\n            this.klCanvas,\n            (val) => {\n                setCurrentLayer(throwIfNull(this.klCanvas.getLayer(val)));\n                klHistory.push({\n                    tool: ['misc'],\n                    action: 'focusLayer',\n                    params: [val],\n                } as TMiscFocusLayerHistoryEntry);\n            },\n            this.klRootEl,\n            this.uiState,\n        );\n        this.layerPreview = new KL.LayerPreview({\n            klRootEl: this.klRootEl,\n            onClick: () => {\n                mainTabRow && mainTabRow.open('layers');\n            },\n            uiState: this.uiState,\n        });\n        this.layerPreview.setIsVisible(this.uiHeight >= 579);\n        this.layerPreview.setLayer(this.klCanvas.getLayer(this.klCanvas.getLayerIndex(currentLayerCtx.canvas)!)!);\n\n        const filterTab = new KL.FilterTab(\n            this.klRootEl,\n            this.klColorSlider,\n            this.layerManager,\n            this.klCanvasWorkspace,\n            handUi,\n            () => currentColor,\n            () => klMaxCanvasSize,\n            () => this.klCanvas,\n            () => currentLayerCtx,\n            !!this.embed,\n            this.statusOverlay,\n        );\n\n        const undoRedoCatchup = new KL.UndoRedoCatchup(\n            brushUiMap,\n            this.layerPreview,\n            this.layerManager,\n            handUi,\n            this.klCanvasWorkspace,\n            () => {\n                if (!initState) {\n                    throw new Error('initState not initialized');\n                }\n                return initState;\n            },\n            () => this.klCanvas,\n            () => currentLayerCtx,\n            (ctx) => {\n                currentLayerCtx = ctx;\n            },\n            () => currentBrushUi,\n        );\n        klHistory.addListener((p) => {\n            undoRedoCatchup.catchup(p);\n        });\n\n        const showNewImageDialog = () => {\n            KL.newImageDialog({\n                currentColor: currentColor,\n                secondaryColor: this.klColorSlider.getSecondaryRGB(),\n                maxCanvasSize: klMaxCanvasSize,\n                canvasWidth: this.klCanvas.getWidth(),\n                canvasHeight: this.klCanvas.getHeight(),\n                workspaceWidth: window.innerWidth < this.collapseThreshold ? this.uiWidth : this.uiWidth - this.toolWidth,\n                workspaceHeight: this.uiHeight,\n                onConfirm: (width, height, color) => {\n                    this.klCanvas.reset({\n                        width: width,\n                        height: height,\n                        color: color.a === 1 ? color : undefined,\n                    });\n\n                    this.layerManager.update(0);\n                    setCurrentLayer(throwIfNull(this.klCanvas.getLayer(0)));\n                    this.klCanvasWorkspace.resetOrFitView();\n                    handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n                },\n                onCancel: () => {},\n            });\n        };\n\n        const shareImage = (callback?: () => void) => {\n            BB.shareCanvas({\n                canvas: this.klCanvas.getCompleteCanvas(1),\n                fileName: BB.getDate() + klConfig.filenameBase + '.png',\n                title: BB.getDate() + klConfig.filenameBase + '.png',\n                callback: callback ? callback : () => {},\n            });\n        };\n\n        this.saveToComputer = new KL.SaveToComputer(\n            pOptions.saveReminder,\n            () => exportType,\n            () => this.klCanvas,\n        );\n\n        const copyToClipboard = (showCrop?: boolean) => {\n            KL.clipboardDialog(\n                this.klRootEl,\n                this.klCanvas.getCompleteCanvas(1),\n                (inputObj) => {\n                    if (inputObj.left === 0 && inputObj.right === 0 && inputObj.top === 0 && inputObj.bottom === 0) {\n                        return;\n                    }\n                    //do a crop\n                    KL.filterLib.cropExtend.apply!({\n                        context: currentLayerCtx,\n                        klCanvas: this.klCanvas,\n                        input: inputObj,\n                        history: klHistory,\n                    });\n                    this.layerManager.update();\n                    this.klCanvasWorkspace.resetOrFitView();\n                    handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n                },\n                this.statusOverlay,\n                showCrop || false,\n            );\n        };\n\n        const fileTab = this.embed ? null : new KL.FileTab(\n            this.klRootEl,\n            projectStore!,\n            () => this.klCanvas.getProject(),\n            exportType,\n            (type) => {\n                exportType = type;\n            },\n            (files, optionsStr) => importHandler.handleFileSelect(files, optionsStr),\n            () => this.saveToComputer.save(),\n            showNewImageDialog,\n            shareImage,\n            () => { // on upload\n                KL.imgurUpload(\n                    this.klCanvas,\n                    this.klRootEl,\n                    pOptions.saveReminder!,\n                    pOptions.app && pOptions.app.imgurKey ? pOptions.app.imgurKey : '',\n                );\n            },\n            copyToClipboard,\n            pOptions.saveReminder,\n        );\n\n        const settingsTab = new KL.SettingsTab(\n            () => {\n                this.uiState = this.uiState === 'left' ? 'right' : 'left';\n                this.updateUi();\n                if (!this.embed) {\n                    LocalStorage.setItem('uiState', this.uiState);\n                }\n            },\n            this.embed ? undefined : pOptions.saveReminder,\n            pOptions.aboutEl,\n        );\n\n        mainTabRow = new KL.TabRow({\n            initialId: 'draw',\n            tabArr: [\n                {\n                    id: 'draw',\n                    title: LANG('tool-brush'),\n                    image: toolPaintImg,\n                    onOpen: () => {\n                        if (currentBrushId === 'eraserBrush') {\n                            this.klColorSlider.enable(false);\n                        }\n                        BB.append(\n                            colorDiv,\n                            [this.klColorSlider.getElement(), this.klColorSlider.getOutputElement(), toolspaceStabilizerRow.getElement()]\n                        );\n                        brushDiv.style.display = 'block';\n                    },\n                    onClose: () => {\n                        brushDiv.style.display = 'none';\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'hand',\n                    title: LANG('tool-hand'),\n                    image: toolHandImg,\n                    isVisible: false,\n                    onOpen: () => {\n                        handUi.setIsVisible(true);\n                    },\n                    onClose: () => {\n                        handUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'fill',\n                    title: LANG('tool-paint-bucket'),\n                    image: toolFillImg,\n                    isVisible: false,\n                    onOpen: () => {\n                        this.klColorSlider.enable(true);\n                        fillUi.setIsVisible(true);\n                    },\n                    onClose: () => {\n                        fillUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'gradient',\n                    title: LANG('tool-gradient'),\n                    image: toolGradientImg,\n                    isVisible: false,\n                    onOpen: () => {\n                        this.klColorSlider.enable(true);\n                        gradientUi.setIsVisible(true);\n                    },\n                    onClose: () => {\n                        gradientUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'text',\n                    title: LANG('tool-text'),\n                    image: toolTextImg,\n                    isVisible: false,\n                    onOpen: () => {\n                        this.klColorSlider.enable(true);\n                        textUi.setIsVisible(true);\n                    },\n                    onClose: () => {\n                        textUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'shape',\n                    title: LANG('tool-shape'),\n                    image: toolShapeImg,\n                    isVisible: false,\n                    onOpen: () => {\n                        this.klColorSlider.enable(true);\n                        shapeUi.setIsVisible(true);\n                    },\n                    onClose: () => {\n                        shapeUi.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'layers',\n                    title: LANG('layers'),\n                    image: tabLayersImg,\n                    onOpen: () => {\n                        this.layerManager.update();\n                        this.layerManager.getElement().style.display = 'block';\n                    },\n                    onClose: () => {\n                        this.layerManager.getElement().style.display = 'none';\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n                {\n                    id: 'edit',\n                    label: LANG('tab-edit'),\n                    onOpen: () => {\n                        filterTab.show();\n                    },\n                    onClose: () => {\n                        filterTab.hide();\n                    },\n                    css: {\n                        padding: '0 7px',\n                    },\n                },\n                {\n                    id: 'file',\n                    label: LANG('tab-file'),\n                    isVisible: !!fileTab,\n                    onOpen: () => {\n                        if (!fileTab) {\n                            return;\n                        }\n                        fileTab.getElement().style.display = 'block';\n                        fileTab.setIsVisible(true);\n                    },\n                    onClose: () => {\n                        if (!fileTab) {\n                            return;\n                        }\n                        fileTab.getElement().style.display = 'none';\n                        fileTab.setIsVisible(false);\n                    },\n                    css: {\n                        padding: '0 7px',\n                    },\n                },\n                {\n                    id: 'settings',\n                    title: LANG('tab-settings'),\n                    image: tabSettingsImg,\n                    onOpen: () => {\n                        settingsTab.getElement().style.display = 'block';\n                        // settingsTab.setIsVisible(true);\n                    },\n                    onClose: () => {\n                        settingsTab.getElement().style.display = 'none';\n                        // settingsTab.setIsVisible(false);\n                    },\n                    css: {\n                        minWidth: '45px',\n                    },\n                },\n            ],\n        });\n\n        this.bottomBarWrapper = BB.el({\n            css: {\n                width: '270px',\n                position: 'absolute',\n                bottom: '0',\n                left: '0',\n            },\n        });\n        if (pOptions.bottomBar) {\n            this.bottomBar = pOptions.bottomBar;\n            this.bottomBarWrapper.append(this.bottomBar);\n            const observer = new MutationObserver(() => this.updateBottomBar());\n            observer.observe(\n                this.toolspaceInner,\n                {\n                    attributes: true,\n                    childList: true,\n                    subtree: true,\n                }\n            );\n        }\n\n\n\n\n        BB.append(this.toolspaceInner, [\n            this.layerPreview.getElement(),\n            mainTabRow.getElement(),\n            brushDiv,\n            handUi.getElement(),\n            fillUi.getElement(),\n            gradientUi.getElement(),\n            textUi.getElement(),\n            shapeUi.getElement(),\n            this.layerManager.getElement(),\n            filterTab.getElement(),\n            fileTab ? fileTab.getElement() : undefined,\n            settingsTab.getElement(),\n            BB.el({\n                css: {\n                    height: '10px', // a bit of spacing at the bottom\n                },\n            }),\n            this.bottomBarWrapper ? this.bottomBarWrapper : undefined,\n        ]);\n\n        this.toolspaceScroller = new KL.ToolspaceScroller({\n            toolspace: this.toolspace,\n            uiState: this.uiState,\n        });\n\n        if (!this.embed) {\n            Object.defineProperty(window, 'KL', {\n                value: createConsoleApi({\n                    onDraw: (path: IVector2D[]): void => {\n                        if (!path || path.length === 0) {\n                            return;\n                        }\n                        path.forEach((p, index) => {\n                            if (index === 0) {\n                                currentBrushUi.startLine(p.x, p.y, 1);\n                            } else {\n                                currentBrushUi.goLine(p.x, p.y, 1);\n                            }\n                        });\n                        currentBrushUi.endLine();\n                        this.klCanvasWorkspace.requestFrame();\n                    },\n                }),\n                writable: false,\n            });\n        }\n\n        this.resize(this.uiWidth, this.uiHeight);\n        this.updateUi();\n\n        const importHandler = new ImportHandler({\n            klRootEl: this.klRootEl,\n            klMaxCanvasSize,\n            layerManager: this.layerManager,\n            setCurrentLayer,\n            klCanvas: this.klCanvas,\n            klCanvasWorkspace: this.klCanvasWorkspace,\n            handUi,\n        }, {\n            onColor: (rgb) => brushSettingService.setColor(rgb),\n        });\n\n        if (!this.embed) {\n            new KL.KlImageDropper({\n                target: document.body,\n                onDrop: (files, optionStr) => {\n                    if (KL.dialogCounter.get() > 0) {\n                        return;\n                    }\n                    importHandler.handleFileSelect(files, optionStr);\n                },\n                enabledTest: () => {\n                    return KL.dialogCounter.get() === 0;\n                },\n            });\n\n            window.document.addEventListener(\n                'paste',\n                (e: ClipboardEvent) => importHandler.onPaste(e),\n                false\n            );\n        }\n\n        {\n            window.addEventListener('resize', () => {\n                this.resize(window.innerWidth, window.innerHeight);\n            });\n            window.addEventListener('orientationchange', () => {\n                this.resize(window.innerWidth, window.innerHeight);\n            });\n\n            // iPad doesn't trigger 'resize' event when using text zoom, although it's resizing the window.\n            // Workaround: place a div in the body that fills the window, and use a ResizeObserver\n            const windowResizeWatcher = BB.el({\n                parent: document.body,\n                css: {\n                    position: 'fixed',\n                    left: '0',\n                    top: '0',\n                    right: '0',\n                    bottom: '0',\n                    pointerEvents: 'none',\n                    zIndex: '-1',\n                    userSelect: 'none',\n                },\n            });\n            try {\n                // Not all browsers support ResizeObserver. Not critical though.\n                const observer = new ResizeObserver(() => this.resize(window.innerWidth, window.innerHeight));\n                observer.observe(windowResizeWatcher);\n            } catch (e) {\n                windowResizeWatcher.remove();\n            }\n\n            // prevent ctrl scroll -> zooming page\n            this.klRootEl.addEventListener('wheel', (event) => {\n                if (keyListener.isPressed('ctrl')) {\n                    event.preventDefault();\n                }\n            });\n            //maybe prevent zooming on safari mac os - todo still needed?\n            const prevent = (e: Event) => {\n                e.preventDefault();\n            };\n            window.addEventListener('gesturestart', prevent);\n            window.addEventListener('gesturechange', prevent);\n            window.addEventListener('gestureend', prevent);\n        }\n    }\n\n    // -------- interface --------\n\n    getEl (): HTMLElement {\n        return this.klRootEl;\n    }\n\n    resize (w: number, h: number): void {\n\n        // iPad scrolls down when increasing text zoom\n        if (window.scrollY > 0) {\n            window.scrollTo(0, 0);\n        }\n\n        if (this.uiWidth === Math.max(0, w) && this.uiHeight === Math.max(0, h)) {\n            return;\n        }\n\n        this.uiWidth = Math.max(0, w);\n        this.uiHeight = Math.max(0, h);\n\n        this.updateCollapse();\n        this.updateBottomBar();\n\n        this.layerPreview.setIsVisible(this.uiHeight >= 579);\n        this.klColorSlider.setHeight(Math.max(163, Math.min(400, this.uiHeight - 505)));\n        this.toolspaceToolRow.setIsSmall(this.uiHeight < 540);\n    }\n\n    out (msg: string): void {\n        this.statusOverlay.out(msg);\n    }\n\n    getPNG (): Blob {\n        return base64ToBlob(this.klCanvas.getCompleteCanvas(1).toDataURL('image/png'));\n    }\n\n    getPSD = async ():  Promise<Blob> => {\n        return await klCanvasToPsdBlob(this.klCanvas);\n    };\n\n    getProject (): IKlProject {\n        return this.klCanvas.getProject();\n    }\n\n    swapUiLeftRight (): void {\n        this.uiState = this.uiState === 'left' ? 'right' : 'left';\n        if (!this.embed) {\n            LocalStorage.setItem('uiState', this.uiState);\n        }\n        this.updateUi();\n    }\n\n    saveAsPsd (): void {\n        this.saveToComputer.save('psd');\n    }\n\n    isDrawing (): boolean {\n        return this.lineSanitizer.getIsDrawing() || this.klCanvasWorkspace.getIsDrawing();\n    }\n}\n","import {BB} from '../bb/bb';\nimport uiSwapImg from '/src/app/img/ui/ui-swap-lr.svg';\nimport helpImg from '/src/app/img/ui/help.svg';\nimport {LANG} from '../language/language';\nimport {PointerListener} from '../bb/input/pointer-listener';\n\n/**\n * Topmost row of buttons in toolspace. (embed)\n *\n * @param p\n * @constructor\n */\nexport class EmbedToolspaceTopRow {\n\n    private readonly rootEl: HTMLElement;\n\n    // ---- public ----\n\n    constructor (p: {onSubmit: () => void; onLeftRight: () => void; onHelp: () => void}) {\n        this.rootEl = BB.el({\n            className: 'kl-toolspace-row',\n            css: {\n                height: '36px',\n                display: 'flex',\n            },\n        });\n\n        function createButton (p: {\n            title: string;\n            content?: HTMLElement;\n            image?: string;\n            onClick: () => void;\n            extraPadding?: number;\n            contain: boolean;\n        }): {\n            el: HTMLElement;\n            pointerListener: PointerListener;\n        } {\n            const padding = 6 + (p.extraPadding ? p.extraPadding : 0);\n            const el = BB.el({\n                className: 'toolspace-row-button nohighlight',\n                title: p.title,\n                onClick: p.onClick,\n                css: {\n                    padding: p.content ? '' : (p.contain ? padding + 'px 0' : ''),\n                },\n            });\n            if (p.content) {\n                el.append(p.content);\n            } else {\n                const im = BB.el({\n                    className: 'dark-invert',\n                    css: {\n                        backgroundImage: 'url(\\'' + p.image + '\\')',\n                        backgroundRepeat: 'no-repeat',\n                        backgroundPosition: 'center',\n                        backgroundSize: p.contain ? 'contain' : '',\n                        //filter: 'grayscale(1)',\n                        height: '100%',\n                    },\n                });\n                im.style.pointerEvents = 'none';\n                el.append(im);\n            }\n            const pointerListener = new BB.PointerListener({ // because :hover causes problems w touch\n                target: el,\n                onEnterLeave: function (isOver): void {\n                    el.classList.toggle('toolspace-row-button-hover', isOver);\n                },\n            });\n\n            return {\n                el,\n                pointerListener,\n            };\n        }\n\n        const submitButton = createButton({\n            onClick: p.onSubmit,\n            title: LANG('submit-title'),\n            content: BB.el({\n                content: LANG('submit'),\n                className: 'toolspace-row-button__submit',\n                css: {\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    width: '100%',\n                    height: '100%',\n                },\n            }),\n            contain: true,\n        });\n        submitButton.el.style.width = '45px';\n\n        const helpButton = createButton({\n            onClick: p.onHelp,\n            title: LANG('help'),\n            image: helpImg,\n            contain: true,\n        });\n\n        const leftRightButton = createButton({\n            onClick: p.onLeftRight,\n            title: LANG('switch-ui-left-right'),\n            image: uiSwapImg,\n            contain: true,\n        });\n\n        this.rootEl.append(submitButton.el, leftRightButton.el, helpButton.el);\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n}\n","import {filterLib, filterLibStatus} from './filters';\nimport {filterBrightnessContrast} from './filter-brightness-contrast';\nimport {filterCropExtend} from './filter-crop-extend';\nimport {filterCurves} from './filter-curves';\nimport {filterFlip} from './filter-flip';\nimport {filterHueSaturation} from './filter-hue-saturation';\nimport {filterInvert} from './filter-invert';\nimport {filterPerspective} from './filter-perspective';\nimport {filterResize} from './filter-resize';\nimport {filterRotate} from './filter-rotate';\nimport {filterTiltShift} from './filter-tilt-shift';\nimport {filterTransform} from './filter-transform';\nimport {filterBlur} from './filter-blur';\nimport {filterUnsharpMask} from './filter-unsharp-mask';\nimport {filterToAlpha} from './filter-to-alpha';\nimport {filterGrid} from './filter-grid';\nimport {filterNoise} from './filter-noise';\nimport {filterPattern} from './filter-pattern';\nimport {filterDistort} from './filter-distort';\nimport {filterVanishPoint} from './filter-vanish-point';\nimport {IFilter} from '../kl-types';\n\ntype TModuleFilter = Pick<IFilter, 'getDialog' | 'apply'>;\n\nfunction importFilter (libObj: IFilter, moduleObj: TModuleFilter): void {\n    if (moduleObj.getDialog) {\n        libObj.getDialog = moduleObj.getDialog;\n    }\n    libObj.apply = moduleObj.apply;\n}\n\n\nexport function importFilters (): void {\n    if (filterLibStatus.isLoaded) {\n        return;\n    }\n    importFilter(filterLib.brightnessContrast, filterBrightnessContrast as TModuleFilter);\n    importFilter(filterLib.cropExtend, filterCropExtend as TModuleFilter);\n    importFilter(filterLib.curves, filterCurves as TModuleFilter);\n    importFilter(filterLib.flip, filterFlip as TModuleFilter);\n    importFilter(filterLib.hueSaturation, filterHueSaturation as TModuleFilter);\n    importFilter(filterLib.invert, filterInvert as TModuleFilter);\n    importFilter(filterLib.perspective, filterPerspective as TModuleFilter);\n    importFilter(filterLib.resize, filterResize as TModuleFilter);\n    importFilter(filterLib.rotate, filterRotate as TModuleFilter);\n    importFilter(filterLib.tiltShift, filterTiltShift as TModuleFilter);\n    importFilter(filterLib.transform, filterTransform as TModuleFilter);\n    importFilter(filterLib.blur, filterBlur as TModuleFilter);\n    importFilter(filterLib.unsharpMask, filterUnsharpMask as TModuleFilter);\n    importFilter(filterLib.toAlpha, filterToAlpha as TModuleFilter);\n    importFilter(filterLib.grid, filterGrid as TModuleFilter);\n    importFilter(filterLib.noise, filterNoise as TModuleFilter);\n    importFilter(filterLib.pattern, filterPattern as TModuleFilter);\n    importFilter(filterLib.distort, filterDistort as TModuleFilter);\n    importFilter(filterLib.vanishPoint, filterVanishPoint as TModuleFilter);\n\n    filterLibStatus.isLoaded = true;\n}","import {KlSlider} from '../ui/components/kl-slider';\nimport {eventResMs} from './filters-consts';\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {TFilterHistoryEntry} from './filters';\nimport {FxPreviewRenderer} from '../ui/project-viewport/fx-preview-renderer';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {css} from '@emotion/css/dist/emotion-css.cjs';\nimport {BB} from '../../bb/bb';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth} from '../ui/utils/preview-size';\n\nexport type TFilterBrightnessContrastInput = {\n    brightness: number;\n    contrast: number;\n}\n\nexport type TFilterBrightnessContrastHistoryEntry = TFilterHistoryEntry<\n    'brightnessContrast',\n    TFilterBrightnessContrastInput>;\n\nexport const filterBrightnessContrast = {\n    getDialog (params: IFilterGetDialogParam) {\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterBrightnessContrastInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        let brightness = 0, contrast = 0;\n        const fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas) => {\n                return fxCanvas.brightnessContrast(brightness, contrast);\n            },\n        });\n\n        function finishInit (): void {\n\n            const brightnessSlider = new KlSlider({\n                label: LANG('filter-bright-contrast-brightness'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 100,\n                value: (brightness + 1) * 50,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    brightness = val / 50 - 1;\n                    preview.render();\n                },\n            });\n            const contrastSlider = new KlSlider({\n                label: LANG('filter-bright-contrast-contrast'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 100,\n                value: (contrast + 1) * 50,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    contrast = val / 50 - 1;\n                    preview.render();\n                },\n            });\n            brightnessSlider.getElement().style.marginBottom = '10px';\n            contrastSlider.getElement().style.marginBottom = '10px';\n            rootEl.append(brightnessSlider.getElement(), contrastSlider.getElement());\n\n            const previewLayerArr: TProjectViewportProject['layers'] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                        isVisible: layers[i].isVisible,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr,\n                        hasClipping: false,\n                    });\n                }\n            }\n\n            const preview = new Preview({\n                width: getPreviewWidth(isSmall),\n                height: getPreviewHeight(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr,\n                },\n            });\n            preview.render();\n            preview.getElement().classList.add(css({\n                marginLeft: '-20px',\n                marginRight: '-20px',\n            }));\n            rootEl.append(preview.getElement());\n\n\n            result.destroy = () => {\n                brightnessSlider.destroy();\n                contrastSlider.destroy();\n                fxPreviewRenderer.destroy();\n                preview.destroy();\n            };\n            result.getInput = function (): TFilterBrightnessContrastInput {\n                result.destroy!();\n                return {\n                    brightness: brightness,\n                    contrast: contrast,\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1); // the canvas isn't ready for some reason\n\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterBrightnessContrastInput>): boolean {\n        const context = params.context;\n        const brightness = params.input.brightness;\n        const contrast = params.input.contrast;\n        const history = params.history;\n        if (!context || !history) {\n            return false;\n        }\n        history.pause(true);\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false; // todo more specific error?\n        }\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).brightnessContrast(brightness, contrast).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'brightnessContrast'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterBrightnessContrastHistoryEntry);\n\n        return true;\n    },\n};","\nexport const eventResMs = 60;","import {TFxCanvas, TWrappedTexture} from '../../../fx-canvas/fx-canvas-types';\nimport {TProjectViewportLayerFunc, TViewportTransformXY} from './project-viewport';\nimport {BB} from '../../../bb/bb';\nimport {getSharedFx} from '../../../fx-canvas/shared-fx';\nimport {throwIfNull} from '../../../bb/base/base';\nimport {IRect} from '../../../bb/bb-types';\nimport {compose, translate, applyToPoint, inverse, scale} from 'transformation-matrix';\nimport {createTransformMatrix} from './utils/create-transform-matrix';\n\ntype TPostMix = {\n    opacity: number;\n    operation: GlobalCompositeOperation;\n}\n\nexport type TFxPreviewRendererParams = {\n    original: Exclude<CanvasImageSource, VideoFrame | HTMLOrSVGImageElement> | HTMLImageElement;\n    onUpdate: (fxCanvas: TFxCanvas, transform: TViewportTransformXY) => TFxCanvas;\n    postMix?: TPostMix; // mix the result with the original\n};\n\nexport class FxPreviewRenderer {\n    private readonly original: TFxPreviewRendererParams['original'];\n    private readonly onUpdate: TFxPreviewRendererParams['onUpdate'];\n    private texture: TWrappedTexture | undefined = undefined;\n    private readonly textureSource: HTMLCanvasElement;\n    private ctx: CanvasRenderingContext2D;\n    private oldOnUpdateProps = {\n        textureWidth: 0,\n        textureHeight: 0,\n        transform: {\n            scaleX: 0,\n            scaleY: 0,\n            angleDeg: 0,\n            x: 0,\n            y: 0,\n        },\n    };\n    private fxCanvas: TFxCanvas;\n    private postMix: TPostMix | undefined;\n\n\n    // --- public ---\n    constructor (p: TFxPreviewRendererParams) {\n        this.original = p.original;\n        this.onUpdate = p.onUpdate;\n        this.textureSource = BB.canvas(1,1);\n        this.ctx = BB.ctx(this.textureSource);\n        this.fxCanvas = throwIfNull(getSharedFx());\n        this.postMix = p.postMix;\n    }\n\n    render: TProjectViewportLayerFunc = (viewportTransform, viewportWidth, viewportHeight) => {\n        const viewportMat = createTransformMatrix(viewportTransform);\n        const padding = 0; // render more than visible with padding < 0\n\n        let clippedViewportRect: IRect; // rect in viewport coordinates which contains the canvas\n        {\n            const topLeft = applyToPoint(viewportMat, {x: 0, y: 0});\n            const bottomRight = applyToPoint(viewportMat, {x: this.original.width, y: this.original.height});\n            bottomRight.x = Math.round(bottomRight.x);\n            bottomRight.y = Math.round(bottomRight.y);\n            const clippedTL = {\n                x: Math.max(padding, topLeft.x),\n                y: Math.max(padding, topLeft.y),\n            };\n            const clippedBR = {\n                x: Math.min(viewportWidth - padding, (bottomRight.x)),\n                y: Math.min(viewportHeight - padding, (bottomRight.y)),\n            };\n            clippedViewportRect = {\n                x: clippedTL.x,\n                y: clippedTL.y,\n                width: clippedBR.x - clippedTL.x,\n                height: clippedBR.y - clippedTL.y,\n            };\n\n            if (clippedViewportRect.width <= 0 || clippedViewportRect.height <= 0) {\n                this.textureSource.width = 1;\n                this.textureSource.height = 1;\n                return this.textureSource;\n            }\n        }\n\n        let resultTransform = compose(\n            inverse(viewportMat),\n            translate(padding, padding),\n            translate(clippedViewportRect.x - padding, clippedViewportRect.y - padding),\n        );\n\n        const onUpdateProps = {\n            textureWidth: Math.ceil(clippedViewportRect.width),\n            textureHeight: Math.ceil(clippedViewportRect.height),\n            transform: {\n                scaleX: viewportTransform.scaleX,\n                scaleY: viewportTransform.scaleY,\n                angleDeg: viewportTransform.angleDeg,\n                x: viewportTransform.x - clippedViewportRect.x,\n                y: viewportTransform.y - clippedViewportRect.y,\n            },\n        };\n\n        let tlOffsetX = 0;\n        let tlOffsetY = 0;\n\n\n        if (viewportTransform.scaleX > 1) {\n            // what pixels of original canvas are actually visible\n            const canvasTopLeft = applyToPoint(resultTransform, {x: 0, y: 0});\n            tlOffsetX = -canvasTopLeft.x;\n            tlOffsetY = -canvasTopLeft.y;\n            canvasTopLeft.x = Math.max(0, Math.floor(canvasTopLeft.x));\n            canvasTopLeft.y = Math.max(0, Math.floor(canvasTopLeft.y));\n            tlOffsetX += canvasTopLeft.x;\n            tlOffsetY += canvasTopLeft.y;\n\n            const canvasBottomRight = applyToPoint(resultTransform, {x: clippedViewportRect.width, y: clippedViewportRect.height});\n            canvasBottomRight.x = Math.min(this.original.width, Math.ceil(canvasBottomRight.x));\n            canvasBottomRight.y = Math.min(this.original.height, Math.ceil(canvasBottomRight.y));\n\n\n            const cw = canvasBottomRight.x - canvasTopLeft.x;\n            const ch = canvasBottomRight.y - canvasTopLeft.y;\n\n            onUpdateProps.textureWidth = cw;\n            onUpdateProps.textureHeight = ch;\n            onUpdateProps.transform = {\n                scaleX: 1,\n                scaleY: 1,\n                angleDeg: 0,\n                x: -canvasTopLeft.x,\n                y: -canvasTopLeft.y,\n            };\n\n            resultTransform = compose(\n                resultTransform,\n                scale(viewportTransform.scaleX, viewportTransform.scaleY),\n                translate(tlOffsetX, tlOffsetY),\n            );\n        }\n\n\n        if (!this.texture || JSON.stringify(onUpdateProps) !== JSON.stringify(this.oldOnUpdateProps) || this.postMix) {\n            // update texture\n            this.textureSource.width = onUpdateProps.textureWidth;\n            this.textureSource.height = onUpdateProps.textureHeight;\n\n            // draw original canvas into temp\n            this.ctx.save();\n            this.ctx.imageSmoothingEnabled = false;\n            if (viewportTransform.scaleX > 1) {\n                this.ctx.setTransform(createTransformMatrix(onUpdateProps.transform));\n            } else {\n                this.ctx.setTransform(inverse(resultTransform));\n            }\n            this.ctx.drawImage(this.original, 0, 0);\n            this.ctx.restore();\n            // debug\n            /*BB.css(this.canvas, {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                zIndex: '1000',\n                boxShadow: '0 0 0 1px #f00',\n            });\n            document.body.append(this.canvas);*/\n\n            if (!this.texture || JSON.stringify(onUpdateProps) !== JSON.stringify(this.oldOnUpdateProps)) {\n                this.texture && this.texture.destroy();\n                this.texture = this.fxCanvas.texture(this.textureSource);\n            }\n\n            if (!this.postMix) {\n                this.textureSource.width = 1;\n                this.textureSource.height = 1;\n            }\n        }\n        this.oldOnUpdateProps = onUpdateProps;\n\n        const resultFx = this.onUpdate(\n            this.fxCanvas.draw(this.texture),\n            onUpdateProps.transform\n        ).update();\n\n        if (this.postMix) {\n            this.ctx.save();\n            this.ctx.globalAlpha = this.postMix.opacity;\n            this.ctx.globalCompositeOperation = this.postMix.operation;\n            this.ctx.drawImage(resultFx, 0, 0);\n            this.ctx.restore();\n            return {\n                image: this.textureSource,\n                transform: resultTransform,\n            };\n        }\n\n        return {\n            image: resultFx,\n            transform: resultTransform,\n        };\n    };\n\n    setPostMix (postMix: TPostMix): void {\n        this.postMix = postMix;\n    }\n\n    destroy (): void {\n        BB.freeCanvas(this.textureSource);\n        if (this.texture) {\n            this.texture = this.fxCanvas.texture(this.textureSource);\n            this.fxCanvas.draw(this.texture).update();\n            this.texture && this.texture.destroy();\n        }\n    }\n}\n\n\n","import {BB} from '../../bb/bb';\nimport {input} from '../ui/components/input';\nimport {Checkbox} from '../ui/components/checkbox';\nimport {ColorOptions} from '../ui/components/color-options';\nimport {Cropper} from '../ui/components/cropper';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult, IRGBA} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {TFilterHistoryEntry} from './filters';\nimport {theme} from '../../theme/theme';\nimport {IRect} from '../../bb/bb-types';\nimport {smallPreview} from '../ui/utils/preview-size';\n\nexport type TFilterCropExtendInput = {\n    left: number;\n    right: number;\n    top: number;\n    bottom: number;\n    fillColor?: IRGBA;\n};\n\nexport type TFilterCropExtendHistoryEntry = TFilterHistoryEntry<\n    'cropExtend',\n    TFilterCropExtendInput>;\n\nexport const filterCropExtend = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const klCanvas = params.klCanvas;\n        if (!klCanvas) {\n            return false;\n        }\n        const tempCanvas = BB.canvas();\n        {\n            const fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 560, 400, 1);\n            const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n            const previewFactor = w / klCanvas.getWidth();\n            tempCanvas.width = w;\n            tempCanvas.height = h;\n            tempCanvas.style.display = 'block';\n            BB.ctx(tempCanvas).drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\n        }\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterCropExtendInput> = {\n            element: rootEl,\n        };\n        let left = 0, right = 0, top = 0, bottom = 0;\n        let leftChanged = false, rightChanged = false, topChanged = false, bottomChanged = false;\n        const maxWidth = params.maxWidth, maxHeight = params.maxHeight;\n        let scale: number = 1;\n\n\n\n        // --- input elements ---\n\n        const lrWrapper = BB.el({\n            css: {lineHeight: '30px', height: '35px'},\n        });\n        const tbWrapper = BB.el({\n            css: {lineHeight: '30px', height: '35px'},\n        });\n        rootEl.append(lrWrapper, tbWrapper);\n\n        const leftInput = input({\n            init: 0,\n            type: 'number',\n            min: -klCanvas.getWidth(),\n            max: maxWidth,\n            css: {width: '75px', marginRight: '20px'},\n            callback: function () {\n                leftChanged = true;\n                updateInput();\n            },\n        });\n        const rightInput = input({\n            init: 0,\n            type: 'number',\n            min: -klCanvas.getWidth(),\n            max: maxWidth,\n            css: {width: '75px'},\n            callback: function () {\n                rightChanged = true;\n                updateInput();\n            },\n        });\n        const topInput = input({\n            init: 0,\n            type: 'number',\n            min: -klCanvas.getHeight(),\n            max: maxHeight,\n            css: {width: '75px', marginRight: '20px'},\n            callback: function () {\n                topChanged = true;\n                updateInput();\n            },\n        });\n        const bottomInput = input({\n            init: 0,\n            type: 'number',\n            min: -klCanvas.getHeight(),\n            max: maxHeight,\n            css: {width: '75px'},\n            callback: function () {\n                bottomChanged = true;\n                updateInput();\n            },\n        });\n\n        const labelStyle = {\n            display: 'inline-block',\n            width: '60px',\n        };\n        lrWrapper.append(\n            BB.el({content: LANG('filter-crop-left') + ':', css: labelStyle}),\n            leftInput,\n            BB.el({content: LANG('filter-crop-right') + ':', css: labelStyle}),\n            rightInput\n        );\n        tbWrapper.append(\n            BB.el({content: LANG('filter-crop-top') + ':', css: labelStyle}),\n            topInput,\n            BB.el({content: LANG('filter-crop-bottom') + ':', css: labelStyle}),\n            bottomInput\n        );\n\n        function updateInput (): void {\n            left = parseInt(leftInput.value);\n            right = parseInt(rightInput.value);\n            top = parseInt(topInput.value);\n            bottom = parseInt(bottomInput.value);\n            let newWidth = klCanvas.getWidth() + left + right;\n            let newHeight = klCanvas.getHeight() + top + bottom;\n\n            if (newWidth <= 0) {\n                if (leftChanged) {\n                    left = -klCanvas.getWidth() - right + 1;\n                    leftInput.value = '' + left;\n                }\n                if (rightChanged) {\n                    right = -klCanvas.getWidth() - left + 1;\n                    rightInput.value = '' + right;\n                }\n                newWidth = 1;\n            }\n            if (newWidth > maxWidth) {\n                if (leftChanged) {\n                    left = -klCanvas.getWidth() - right + maxWidth;\n                    leftInput.value = '' + left;\n                }\n                if (rightChanged) {\n                    right = -klCanvas.getWidth() - left + maxWidth;\n                    rightInput.value = '' + right;\n                }\n                newWidth = maxWidth;\n            }\n            if (newHeight <= 0) {\n                if (topChanged) {\n                    top = -klCanvas.getHeight() - bottom + 1;\n                    topInput.value = '' + top;\n                }\n                if (bottomChanged) {\n                    bottom = -klCanvas.getHeight() - top + 1;\n                    bottomInput.value = '' + bottom;\n                }\n                newHeight = 1;\n            }\n            if (newHeight > maxHeight) {\n                if (topChanged) {\n                    top = -klCanvas.getHeight() - bottom + maxHeight;\n                    topInput.value = '' + top;\n                }\n                if (bottomChanged) {\n                    bottom = -klCanvas.getHeight() - top + maxHeight;\n                    bottomInput.value = '' + bottom;\n                }\n                newHeight = maxHeight;\n            }\n            cropper.setTransform({\n                x: -left,\n                y: -top,\n                width: newWidth,\n                height: newHeight,\n            });\n\n\n            leftChanged = false;\n            rightChanged = false;\n            topChanged = false;\n            bottomChanged = false;\n        }\n\n        let useRuleOfThirds = true;\n        const ruleOThirdsCheckbox = new Checkbox({\n            init: true,\n            label: LANG('filter-crop-rule-thirds'),\n            allowTab: true,\n            callback: function (b) {\n                useRuleOfThirds = b;\n                cropper.showThirds(useRuleOfThirds);\n            },\n        });\n        rootEl.append(BB.el({\n            css: {\n                clear: 'both',\n            },\n        }));\n\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 0};\n        const colorOptionsArr = [\n            {r: 0, g: 0, b: 0, a: 0},\n            {r: 255, g: 255, b: 255, a: 1},\n            {r: 0, g: 0, b: 0, a: 1},\n        ];\n        colorOptionsArr.push({\n            r: params.currentColorRgb.r,\n            g: params.currentColorRgb.g,\n            b: params.currentColorRgb.b,\n            a: 1,\n        });\n        colorOptionsArr.push({\n            r: params.secondaryColorRgb.r,\n            g: params.secondaryColorRgb.g,\n            b: params.secondaryColorRgb.b,\n            a: 1,\n        });\n\n        const colorOptions = new ColorOptions({\n            label: LANG('filter-crop-fill'),\n            colorArr: colorOptionsArr,\n            onChange: function (rgbaObj) {\n                selectedRgbaObj = rgbaObj!;\n                updateBg();\n            },\n        });\n\n\n        const flexRow = BB.el({\n            css: {\n                display: 'flex',\n                justifyContent: 'space-between',\n                alignItems: 'center',\n                marginTop: '10px',\n            },\n        });\n        rootEl.append(flexRow);\n        flexRow.append(ruleOThirdsCheckbox.getElement(), colorOptions.getElement());\n\n\n        // when input field changed, or dragging in preview finished\n        // adjusts the zoom\n        function update (transform: IRect): void {\n            const fit = BB.fitInto(transform.width, transform.height, 260, 180, 1);\n            scale = fit.width / transform.width;\n\n            const offset = BB.centerWithin(smallPreview.width, previewHeight, fit.width, fit.height);\n\n            tempCanvas.style.width = klCanvas.getWidth() * scale + 'px';\n            tempCanvas.style.height = klCanvas.getHeight() * scale + 'px';\n\n            offsetWrapper.style.left = (offset.x - transform.x * scale) + 'px';\n            offsetWrapper.style.top = (offset.y - transform.y * scale) + 'px';\n\n            left = parseInt('' + -transform.x);\n            top = parseInt('' + -transform.y);\n            right = parseInt('' + (transform.x + transform.width - klCanvas.getWidth()));\n            bottom = parseInt('' + (transform.y + transform.height - klCanvas.getHeight()));\n            leftInput.value = '' + left;\n            topInput.value = '' + top;\n            rightInput.value = '' + right;\n            bottomInput.value = '' + bottom;\n\n            BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\n                previewWrapper.style.background = 'url(' + url + ')';\n                if (selectedRgbaObj.a !== 0) {\n                    tempCanvas.style.background = 'url(' + url + ')';\n                }\n            }, theme.isDark());\n            previewWrapper.style.backgroundPosition = (offset.x) + 'px ' + (offset.y) + 'px';\n\n            cropper.setScale(scale);\n        }\n\n        const previewHeight = smallPreview.height - 2; // two less because of border\n        const previewWrapper = BB.el({\n            className: 'kl-edit-crop-preview',\n            css: {\n                width: smallPreview.width + 'px',\n                marginTop: '10px',\n                marginLeft: '-20px',\n                height: previewHeight + 'px',\n                backgroundColor: '#9e9e9e',\n                position: 'relative',\n                borderTop: '1px solid rgb(144,144,144)',\n                borderBottom: '1px solid rgb(144,144,144)',\n                overflow: 'hidden',\n                userSelect: 'none',\n                touchAction: 'none',\n            },\n        });\n        previewWrapper.oncontextmenu = function () {\n            return false;\n        };\n        const bgColorOverlay = BB.el({\n            css: {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n                bottom: '0',\n                right: '0',\n            },\n        });\n        previewWrapper.append(bgColorOverlay);\n\n        const offsetWrapper = BB.el({\n            parent: previewWrapper,\n            css: {\n                position: 'absolute',\n                left: '0',\n                top: '0',\n            },\n        });\n\n        BB.el({\n            parent: offsetWrapper,\n            content: tempCanvas,\n            css: {\n                boxShadow: '0 0 0px 1px rgb(130,130,130)',\n                position: 'absolute',\n                left: '0px',\n                top: '0px',\n            },\n        });\n\n\n        rootEl.append(previewWrapper);\n        const cropper = new Cropper({\n            x: 0,\n            y: 0,\n            width: klCanvas.getWidth(),\n            height: klCanvas.getHeight(),\n            scale: scale,\n            callback: update,\n            maxW: maxWidth,\n            maxH: maxHeight,\n        });\n        update(cropper.getTransform());\n        offsetWrapper.append(cropper.getElement());\n\n        function updateBg (): void {\n            if (selectedRgbaObj.a === 0) {\n                bgColorOverlay.style.background = '';\n                tempCanvas.style.background = '';\n            } else {\n                bgColorOverlay.style.background = BB.ColorConverter.toRgbStr(selectedRgbaObj);\n\n                BB.createCheckerDataUrl(parseInt('' + (50 * scale)), function (url) {\n                    tempCanvas.style.background = 'url(' + url + ')';\n                }, theme.isDark());\n            }\n        }\n\n        function updateIsDark (): void {\n            updateInput();\n        }\n        theme.addIsDarkListener(updateIsDark);\n\n        result.destroy = (): void => {\n            cropper.destroy();\n            ruleOThirdsCheckbox.destroy();\n            theme.removeIsDarkListener(updateIsDark);\n            colorOptions.destroy();\n        };\n        result.getInput = function (): TFilterCropExtendInput {\n            result.destroy!();\n            return {\n                left: left,\n                right: right,\n                top: top,\n                bottom: bottom,\n                fillColor: selectedRgbaObj.a === 0 ? undefined : selectedRgbaObj,\n            };\n        };\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterCropExtendInput>): boolean {\n        const klCanvas = params.klCanvas;\n        const history = params.history;\n        if (\n            !klCanvas ||\n            !history ||\n            isNaN(params.input.left) ||\n            isNaN(params.input.right) ||\n            isNaN(params.input.top) ||\n            isNaN(params.input.bottom)\n        ) {\n            return false;\n        }\n        history.pause(true);\n        klCanvas.resizeCanvas(params.input);\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'cropExtend'],\n            action: 'apply',\n            params: [{\n                input: BB.copyObj(params.input),\n            }],\n        } as TFilterCropExtendHistoryEntry);\n        return true;\n    },\n\n};","import {BB} from '../../bb/bb';\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {CurvesInput, getDefaultCurvesInput, TCurvesInput} from './filter-curves/curves-input';\nimport {Options} from '../ui/components/options';\nimport {TFilterHistoryEntry} from './filters';\nimport {FxPreviewRenderer} from '../ui/project-viewport/fx-preview-renderer';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {css} from '@emotion/css/dist/emotion-css.cjs';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth} from '../ui/utils/preview-size';\n\nexport type TFilterCurvesInput = {\n    curves: TCurvesInput;\n};\n\nexport type TFilterCurvesHistoryEntry = TFilterHistoryEntry<\n    'curves',\n    TFilterCurvesInput>;\n\nexport const filterCurves = {\n\n    getDialog (params: IFilterGetDialogParam) {\n\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterCurvesInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        let curves: TCurvesInput = getDefaultCurvesInput();\n        const fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas) => {\n                return fxCanvas.curves(curves.r, curves.g, curves.b);\n            },\n        });\n\n\n        function finishInit (): void {\n\n            const previewLayerArr: TProjectViewportProject['layers'] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                        isVisible: layers[i].isVisible,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr,\n                        hasClipping: false,\n                    });\n                }\n            }\n\n            const preview = new Preview({\n                width: getPreviewWidth(isSmall),\n                height: getPreviewHeight(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr,\n                },\n            });\n            preview.getElement().classList.add(css({\n                marginLeft: '-20px',\n                marginRight: '-20px',\n            }));\n\n            const input = new CurvesInput({\n                curves,\n                callback: function (val) {\n                    curves = val;\n                    preview.render();\n                },\n            });\n            const modeButtons: Options<string> = input.getModeButtons();\n\n\n            rootEl.append(input.getElement(),preview.getElement());\n\n            result.destroy = (): void => {\n                input.destroy();\n                modeButtons.destroy();\n                fxPreviewRenderer.destroy();\n                preview.destroy();\n            };\n            result.getInput = function (): TFilterCurvesInput {\n                result.destroy!();\n                return {\n                    curves: curves,\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterCurvesInput>): boolean {\n        const context = params.context;\n        const curves = params.input.curves;\n        const history = params.history;\n        if (!context || !history) {\n            return false;\n        }\n        history.pause(true);\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false; // todo more specific error?\n        }\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).curves(curves.r, curves.g, curves.b).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'curves'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterCurvesHistoryEntry);\n\n        return true;\n    },\n\n\n};","import {Options} from '../../ui/components/options';\nimport {LANG} from '../../../language/language';\nimport {BB} from '../../../bb/bb';\nimport {IVector2D} from '../../../bb/bb-types';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\n\ntype TCurvePoint = {\n    el: HTMLElement;\n    pointerListener: PointerListener;\n    setPos: (newX: number, newY: number) => void;\n};\n\nexport type TCurvesInput = {\n    r: [number, number][];\n    g: [number, number][];\n    b: [number, number][];\n}\n\nexport function getDefaultCurvesInput (): TCurvesInput {\n    return BB.copyObj({\n        r: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n        g: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n        b: [[0, 0], [1 / 3, 1 / 3], [2 / 3, 2 / 3], [1, 1]],\n    });\n}\n\nexport class CurvesInput {\n\n    private readonly rootEl: HTMLElement;\n    private readonly p0: TCurvePoint;\n    private readonly p1: TCurvePoint;\n    private readonly p2: TCurvePoint;\n    private readonly p3: TCurvePoint;\n    private readonly modeButtons: Options<string>;\n\n    // ---- public ----\n    constructor (\n        p: {\n            curves: TCurvesInput;\n            callback: (val: TCurvesInput) => void;\n        },\n    ) {\n        this.rootEl = BB.el({\n            css: {\n                position: 'relative',\n                marginBottom: '10px',\n            },\n        });\n        this.rootEl.oncontextmenu = () => false;\n        let mode = 'All';\n        let curves = p.curves;\n        this.modeButtons = new Options( {\n            optionArr: [\n                {\n                    id: 'All',\n                    label: LANG('filter-curves-all'),\n                },\n                {\n                    id: 'Red',\n                    label: LANG('red'),\n                },\n                {\n                    id: 'Green',\n                    label: LANG('green'),\n                },\n                {\n                    id: 'Blue',\n                    label: LANG('blue'),\n                },\n            ],\n            initId: 'All',\n            onChange: (id) => {\n                mode = id;\n                if (mode === 'All') {\n                    curves = getDefaultCurvesInput();\n                }\n                let curve = curves.r;\n                if (mode === 'Green') {\n                    curve = curves.g;\n                }\n                if (mode === 'Blue') {\n                    curve = curves.b;\n                }\n                this.p0.setPos(0, areaH - curve[0][1] * areaH);\n                this.p1.setPos(curve[1][0] * areaW, areaH - curve[1][1] * areaH);\n                this.p2.setPos(curve[2][0] * areaW, areaH - curve[2][1] * areaH);\n                this.p3.setPos(areaW, areaH - curve[3][1] * areaH);\n\n                update();\n            },\n        });\n        this.rootEl.append(this.modeButtons.getElement());\n\n        const curveArea = BB.el({\n            parent: this.rootEl,\n            className: 'kl-curves-graph',\n            css: {\n                position: 'relative',\n                marginTop: '10px',\n            },\n        });\n\n        const areaW = 300, areaH = 100;\n        const canvas = BB.canvas(areaW, areaH);\n        let ctx = BB.ctx(canvas);\n        curveArea.append(canvas);\n\n        const fit = (v: number): number => {\n            return Math.max(0, Math.min(1, v));\n        };\n\n        const createPoint = (\n            x: number,\n            y: number,\n            callback: (p: IVector2D) => void,\n            lock?: boolean,\n        ): TCurvePoint => {\n            const gripSize = 14;\n            let internalY = y, internalX = x;\n            const pointEl = BB.el({\n                className: 'kl-curves-graph__grip',\n                css: {\n                    left: (x - gripSize / 2) + 'px',\n                    top: (y - gripSize / 2) + 'px',\n                    width: gripSize + 'px',\n                    height: gripSize + 'px',\n                    borderRadius: gripSize + 'px',\n                },\n            });\n\n            const update = () => {\n                BB.css(pointEl, {\n                    left: (x - gripSize / 2) + 'px',\n                    top: (y - gripSize / 2) + 'px',\n                });\n            };\n\n            const pointerListener = new BB.PointerListener({\n                target: pointEl,\n                onPointer: (event) => {\n                    event.eventPreventDefault();\n                    if (event.type === 'pointerdown') {\n                        internalX = x;\n                        internalY = y;\n                    }\n                    if (event.button === 'left' && event.type === 'pointermove') {\n                        if (!lock) {\n                            internalX += event.dX;\n                        }\n                        x = Math.max(0, Math.min(areaW, internalX));\n                        internalY += event.dY;\n                        y = Math.max(0, Math.min(areaH, internalY));\n                        update();\n                        callback({\n                            x: x,\n                            y: y,\n                        });\n                    }\n                },\n            });\n\n            curveArea.append(pointEl);\n\n            const setPos = (newX: number, newY: number): void => {\n                x = newX;\n                y = newY;\n                internalY = y;\n                internalX = x;\n                BB.css(pointEl, {\n                    left: (x - gripSize / 2) + 'px',\n                    top: (y - gripSize / 2) + 'px',\n                });\n            };\n\n            return {\n                el: pointEl,\n                setPos,\n                pointerListener,\n            };\n        };\n\n        const updateControl = (i: number, x: number, y: number) => {\n            if (mode === 'All') {\n                curves.r[i] = [fit(x / areaW), fit(1 - y / areaH)];\n                curves.g[i] = [fit(x / areaW), fit(1 - y / areaH)];\n                curves.b[i] = [fit(x / areaW), fit(1 - y / areaH)];\n            }\n            if (mode === 'Red') {\n                curves.r[i] = [fit(x / areaW), fit(1 - y / areaH)];\n            }\n            if (mode === 'Green') {\n                curves.g[i] = [fit(x / areaW), fit(1 - y / areaH)];\n            }\n            if (mode === 'Blue') {\n                curves.b[i] = [fit(x / areaW), fit(1 - y / areaH)];\n            }\n        };\n\n        this.p0 = createPoint(0, areaH, (val: IVector2D) => {\n            updateControl(0, val.x, val.y);\n            update();\n        }, true);\n        this.p1 = createPoint(areaW / 3, areaH / 3 * 2, (val: IVector2D) => {\n            updateControl(1, val.x, val.y);\n            update();\n        });\n        this.p2 = createPoint(areaW / 3 * 2, areaH / 3, (val: IVector2D) => {\n            updateControl(2, val.x, val.y);\n            update();\n        });\n        this.p3 = createPoint(areaW, 0, (val: IVector2D) => {\n            updateControl(3, val.x, val.y);\n            update();\n        }, true);\n\n\n        const update = () => {\n            ctx = BB.ctx(canvas);\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n            const outCurves: TCurvesInput = {\n                r: [],\n                g: [],\n                b: [],\n            };\n            for (let i = 0; i < curves.r.length; i++) {\n                outCurves.r.push(curves.r[i]);\n                outCurves.g.push(curves.g[i]);\n                outCurves.b.push(curves.b[i]);\n            }\n\n            const drawCurve = (curve: [number, number][]) => {\n                ctx.beginPath();\n                const spline = new BB.SplineInterpolator(curve);\n                for (let i = 0; i < 100; i++) {\n                    let y = spline.interpolate(i / 100);\n                    y = Math.max(0, Math.min(1, y));\n\n                    if (i === 0) {\n                        ctx.moveTo(i / 100 * areaW, areaH - y * areaH);\n                    } else {\n                        ctx.lineTo(i / 100 * areaW, areaH - y * areaH);\n                    }\n                }\n                ctx.stroke();\n            };\n\n            ctx.save();\n            if (mode === 'All') {\n                ctx.strokeStyle = 'black';\n                drawCurve(outCurves.r);\n            } else {\n                ctx.globalAlpha = 0.5;\n                ctx.strokeStyle = 'red';\n                drawCurve(outCurves.r);\n                ctx.strokeStyle = 'green';\n                drawCurve(outCurves.g);\n                ctx.strokeStyle = 'blue';\n                drawCurve(outCurves.b);\n            }\n            ctx.restore();\n            p.callback(outCurves);\n        };\n\n        update();\n    }\n\n    // ---- interface ----\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    destroy (): void {\n        this.p0.pointerListener.destroy();\n        this.p1.pointerListener.destroy();\n        this.p2.pointerListener.destroy();\n        this.p3.pointerListener.destroy();\n    }\n\n    getModeButtons (): Options<string> {\n        return this.modeButtons;\n    }\n}\n","import {BB} from '../../bb/bb';\nimport {Checkbox} from '../ui/components/checkbox';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult, IKlBasicLayer, TMixMode} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {throwIfNull} from '../../bb/base/base';\nimport {TFilterHistoryEntry} from './filters';\nimport {Options} from '../ui/components/options';\nimport {smallPreview} from '../ui/utils/preview-size';\n\nexport type TFilterFlipInput = {\n    horizontal: boolean;\n    vertical: boolean;\n    flipCanvas: boolean;\n};\n\nexport type TFilterFlipHistoryEntry = TFilterHistoryEntry<\n    'flip',\n    TFilterFlipInput>;\n\nexport const filterFlip = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, 280, 200, 1);\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterFlipInput> = {\n            element: rootEl,\n        };\n        let isHorizontal = true;\n        let isVertical = false;\n        let doFlipCanvas = true;\n\n\n        const horizontalCheckbox = new Checkbox({\n            init: isHorizontal,\n            label: LANG('filter-flip-horizontal') + ' ',\n            allowTab: true,\n            callback: function (v) {\n                isHorizontal = v;\n                updatePreview();\n            },\n            css: {\n                marginBottom: '10px',\n            },\n        });\n        const verticalCheckbox = new Checkbox({\n            init: isVertical,\n            label: LANG('filter-flip-vertical') + ' ',\n            allowTab: true,\n            callback: function (v) {\n                isVertical = v;\n                updatePreview();\n            },\n            css: {\n                marginBottom: '10px',\n            },\n        });\n        rootEl.append(horizontalCheckbox.getElement());\n        rootEl.append(verticalCheckbox.getElement());\n\n        const targetOptions = new Options<boolean>({\n            optionArr: [\n                {\n                    id: true,\n                    label: LANG('filter-flip-image'),\n                },\n                {\n                    id: false,\n                    label: LANG('filter-flip-layer'),\n                },\n            ],\n            onChange: (val) => {\n                doFlipCanvas = val;\n                updatePreview();\n            },\n        });\n\n        rootEl.append(targetOptions.getElement());\n\n\n        const previewWrapper = BB.el({\n            className: 'kl-preview-wrapper',\n            css: {\n                width: smallPreview.width + 'px',\n                height: smallPreview.height + 'px',\n            },\n        });\n\n        const previewLayer: IKlBasicLayer = {\n            image: BB.canvas(Math.round(w), Math.round(h)),\n            isVisible: true,\n            opacity: 1,\n            mixModeStr: 'source-over' as TMixMode,\n        };\n        const klCanvasPreview = new KlCanvasPreview({\n            width: Math.round(w),\n            height: Math.round(h),\n            layers: [previewLayer],\n        });\n\n        const previewInnerWrapper = BB.el({\n            className: 'kl-preview-wrapper__canvas',\n            css: {\n                width: parseInt('' + w) + 'px',\n                height: parseInt('' + h) + 'px',\n            },\n        });\n        previewInnerWrapper.append(klCanvasPreview.getElement());\n        previewWrapper.append(previewInnerWrapper);\n\n        function updatePreview (): void {\n            const ctx = BB.ctx((previewLayer.image as HTMLCanvasElement));\n            ctx.save();\n            ctx.clearRect(0, 0, previewLayer.image.width, previewLayer.image.height);\n\n            if (doFlipCanvas) {\n                if (isHorizontal) {\n                    ctx.translate(previewLayer.image.width, 0);\n                    ctx.scale(-1, 1);\n                }\n                if (isVertical) {\n                    ctx.translate(0, previewLayer.image.height);\n                    ctx.scale(1, -1);\n                }\n            }\n\n            for (let i = 0; i < layers.length; i++) {\n                if (!layers[i].isVisible) {\n                    continue;\n                }\n\n                ctx.save();\n                if (!doFlipCanvas && selectedLayerIndex === i) {\n                    if (isHorizontal) {\n                        ctx.translate(previewLayer.image.width, 0);\n                        ctx.scale(-1, 1);\n                    }\n                    if (isVertical) {\n                        ctx.translate(0, previewLayer.image.height);\n                        ctx.scale(1, -1);\n                    }\n                }\n                if (ctx.canvas.width > layers[i].context.canvas.width) {\n                    ctx.imageSmoothingEnabled = false;\n                }\n                ctx.globalAlpha = layers[i].opacity;\n                ctx.globalCompositeOperation = layers[i].mixModeStr;\n                ctx.drawImage(layers[i].context.canvas, 0, 0, previewLayer.image.width, previewLayer.image.height);\n                ctx.restore();\n            }\n            klCanvasPreview.render();\n            ctx.restore();\n        }\n        setTimeout(updatePreview, 0);\n\n\n        rootEl.append(previewWrapper);\n        result.destroy = (): void => {\n            horizontalCheckbox.destroy();\n            verticalCheckbox.destroy();\n            targetOptions.destroy();\n            klCanvasPreview.destroy();\n        };\n        result.getInput = function (): TFilterFlipInput {\n            result.destroy!();\n            return {\n                horizontal: isHorizontal,\n                vertical: isVertical,\n                flipCanvas: doFlipCanvas,\n            };\n        };\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterFlipInput>): boolean {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        const history = params.history;\n        const horizontal = params.input.horizontal;\n        const vertical = params.input.vertical;\n        const flipCanvas = params.input.flipCanvas;\n        if (!context || !klCanvas || !history) {\n            return false;\n        }\n\n        history.pause(true);\n        klCanvas.flip(\n            horizontal,\n            vertical,\n            flipCanvas ? undefined : throwIfNull(klCanvas.getLayerIndex(context.canvas)),\n        );\n        history.pause(false);\n\n        history.push({\n            tool: ['filter', 'flip'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterFlipHistoryEntry);\n        return true;\n    },\n\n};","import {eventResMs} from './filters-consts';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {TFilterHistoryEntry} from './filters';\nimport {FxPreviewRenderer} from '../ui/project-viewport/fx-preview-renderer';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {css} from '@emotion/css/dist/emotion-css.cjs';\nimport {BB} from '../../bb/bb';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth} from '../ui/utils/preview-size';\n\nexport type TFilterHueSaturationInput = {\n    hue: number;\n    saturation: number;\n};\n\nexport type TFilterHueSaturationHistoryEntry = TFilterHistoryEntry<\n    'hueSaturation',\n    TFilterHueSaturationInput>;\n\nexport const filterHueSaturation = {\n\n    getDialog (params: IFilterGetDialogParam) {\n\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterHueSaturationInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        let hue = 0, saturation = 0;\n        const fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas) => {\n                return fxCanvas.hueSaturation(hue, saturation);\n            },\n        });\n\n        function finishInit (): void {\n\n            const hueSlider = new KlSlider({\n                label: LANG('filter-hue-sat-hue'),\n                width: 300,\n                height: 30,\n                min: -100,\n                max: 100,\n                value: hue * 100,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    hue = val / 100;\n                    preview.render();\n                },\n            });\n            const saturationSlider = new KlSlider({\n                label: LANG('filter-hue-sat-saturation'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 100,\n                value: (saturation + 1) * 50,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    saturation = val / 50 - 1;\n                    preview.render();\n                },\n            });\n            hueSlider.getElement().style.marginBottom = '10px';\n            saturationSlider.getElement().style.marginBottom = '10px';\n            rootEl.append(hueSlider.getElement(), saturationSlider.getElement());\n\n\n            const previewLayerArr: TProjectViewportProject['layers'] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                        isVisible: layers[i].isVisible,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr,\n                        hasClipping: false,\n                    });\n                }\n            }\n\n            const preview = new Preview({\n                width: getPreviewWidth(isSmall),\n                height: getPreviewHeight(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr,\n                },\n            });\n            preview.render();\n            preview.getElement().classList.add(css({\n                marginLeft: '-20px',\n                marginRight: '-20px',\n            }));\n            rootEl.append(preview.getElement());\n\n            result.destroy = (): void => {\n                hueSlider.destroy();\n                saturationSlider.destroy();\n                fxPreviewRenderer.destroy();\n                preview.destroy();\n            };\n            result.getInput = function (): TFilterHueSaturationInput {\n                result.destroy!();\n                return {\n                    hue: hue,\n                    saturation: saturation,\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterHueSaturationInput>): boolean {\n        const context = params.context;\n        const hue = params.input.hue;\n        const history = params.history;\n        const saturation = params.input.saturation;\n        if (!context || hue === null || saturation === null || !history) {\n            return false;\n        }\n        history.pause(true);\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false; // todo more specific error?\n        }\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).hueSaturation(hue, saturation).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'hueSaturation'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterHueSaturationHistoryEntry);\n        return true;\n    },\n\n};","import {getSharedFx} from '../../fx-canvas/shared-fx';\nimport {IFilterApply} from '../kl-types';\nimport {TFilterHistoryEntry} from './filters';\n\nexport type TFilterInvertInput = null;\n\nexport type TFilterInvertHistoryEntry = TFilterHistoryEntry<\n    'invert',\n    TFilterInvertInput>;\n\nexport const filterInvert = {\n\n    apply (params: IFilterApply<TFilterInvertInput>): boolean {\n        const context = params.context;\n        const history = params.history;\n        if (!context || !history) {\n            return false;\n        }\n\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false;\n        }\n\n        history.pause(true);\n\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).invert().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'invert'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterInvertHistoryEntry);\n        return true;\n    },\n\n};","import {BB} from '../../bb/bb';\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {TwoTabs} from '../ui/components/two-tabs';\nimport {TRectanglePoints} from '../../fx-canvas/filters/perspective';\nimport {TFilterHistoryEntry} from './filters';\nimport {applyToPoint, Matrix} from 'transformation-matrix';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {throwIfNull, throwIfUndefined} from '../../bb/base/base';\nimport {DraggableInput} from '../ui/components/draggable-input';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth, mediumPreview} from '../ui/utils/preview-size';\n\nexport type TFilterPerspectiveInput = {\n    before: TRectanglePoints;\n    after: TRectanglePoints;\n};\n\nexport type TFilterPerspectiveHistoryEntry = TFilterHistoryEntry<\n    'perspective',\n    TFilterPerspectiveInput>;\n\nexport const filterPerspective = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const isSmall = testIsSmall();\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterPerspectiveInput> = {\n            element: rootEl,\n        };\n        if (!isSmall) {\n            result.width = mediumPreview.width;\n        }\n\n        function finishInit (): void {\n\n            const fxCanvas = throwIfNull(getSharedFx());\n            const texture = throwIfUndefined(fxCanvas?.texture(context.canvas));\n\n            function update (): void {\n                if (isBefore) {\n                    fxCanvas.draw(texture).update();\n                } else {\n                    fxCanvas.draw(texture).perspective(\n                        getFlatArr(beforeInputs) as TRectanglePoints,\n                        getFlatArr(afterInputs) as TRectanglePoints,\n                    ).update();\n                }\n                preview.render();\n            }\n\n            const rectPoints = [\n                {x: 0, y: 0},\n                {x: context.canvas.width, y: 0},\n                {x: context.canvas.width, y: context.canvas.height},\n                {x: 0, y: context.canvas.height},\n            ];\n            const beforeInputs = rectPoints.map(point => {\n                return new DraggableInput({\n                    value: point,\n                    onChange: () => {\n                        update();\n                    },\n                });\n            });\n            beforeInputs.forEach(item => item.getElement().style.display = 'none');\n            const afterInputs = rectPoints.map(point => {\n                return new DraggableInput({\n                    value: point,\n                    onChange: () => {\n                        update();\n                    },\n                });\n            });\n            function getFlatArr (inputs: DraggableInput[], matrix?: Matrix): number[] {\n                return inputs.flatMap(item => {\n                    let value = item.getValue();\n                    if (matrix) {\n                        value = applyToPoint(matrix, value);\n                    }\n                    return [value.x, value.y];\n                });\n            }\n\n            let isBefore = false;\n\n            const beforeAfterTabs = new TwoTabs({\n                left: LANG('compare-before'),\n                right: LANG('compare-after'),\n                init: 1,\n                onChange: (val: number) => {\n                    isBefore = val === 0;\n                    if (isBefore) {\n                        beforeInputs.forEach(item => item.getElement().style.display = 'block');\n                        afterInputs.forEach(item => item.getElement().style.display = 'none');\n                    } else {\n                        beforeInputs.forEach((item, index) => {\n                            afterInputs[index].setValue(item.getValue());\n                        });\n                        beforeInputs.forEach(item => item.getElement().style.display = 'none');\n                        afterInputs.forEach(item => item.getElement().style.display = 'block');\n                    }\n                    update();\n                },\n            });\n            rootEl.append(beforeAfterTabs.getElement());\n\n            const previewLayerArr: TProjectViewportProject['layers'] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? fxCanvas : layers[i].context.canvas,\n                        isVisible: layers[i].isVisible,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr,\n                        hasClipping: false,\n                    });\n                }\n            }\n\n            const preview = new Preview({\n                width: getPreviewWidth(isSmall),\n                height: getPreviewHeight(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr,\n                },\n                onTransformChange: (transform) => {\n                    beforeInputs.forEach(item => item.setTransform(transform));\n                    afterInputs.forEach(item => item.setTransform(transform));\n                },\n            });\n            BB.css(preview.getElement(), {\n                overflow: 'hidden',\n                marginLeft: '-20px',\n                marginRight: '-20px',\n            });\n\n            preview.getElement().append(\n                ...beforeInputs.map(item => item.getElement()),\n                ...afterInputs.map(item => item.getElement()),\n            );\n            rootEl.append(preview.getElement());\n\n\n            update();\n            result.destroy = (): void => {\n                preview.destroy();\n                texture.destroy;\n                beforeInputs.forEach(item => item.destroy());\n                afterInputs.forEach(item => item.destroy());\n            };\n            result.getInput = (): TFilterPerspectiveInput => {\n                result.destroy!();\n                return {\n                    before: getFlatArr(beforeInputs) as TRectanglePoints,\n                    after: getFlatArr(afterInputs) as TRectanglePoints,\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterPerspectiveInput>): boolean {\n        const context = params.context;\n        const history = params.history;\n        const before = params.input.before;\n        const after = params.input.after;\n        if (!context || !before || !after || !history) {\n            return false;\n        }\n        history.pause(true);\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false; // todo more specific error?\n        }\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).multiplyAlpha().perspective(before, after).unmultiplyAlpha().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'perspective'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterPerspectiveHistoryEntry);\n        return true;\n    },\n\n};","import {BB} from '../../../bb/bb';\n\n/**\n * Two buttons next to each other, each representing a tab. one at a time can be active.\n */\nexport class TwoTabs {\n\n    private readonly rootEl: HTMLElement;\n    private readonly leftTab: HTMLElement;\n    private readonly rightTab: HTMLElement;\n    private value: number;\n\n    private update (): void {\n        this.leftTab.classList.toggle('kl-2-tabs--active', this.value === 0);\n        this.rightTab.classList.toggle('kl-2-tabs--active', this.value === 1);\n    }\n\n    // ---- public ----\n    constructor (params: {\n        left: string;\n        right: string;\n        init: number; //0, 1\n        onChange: (val: number) => void;\n    }) {\n        this.value = params.init;\n\n        this.rootEl = BB.el({\n            className: 'kl-2-tabs',\n        });\n\n        this.leftTab = BB.el({\n            parent: this.rootEl,\n            content: params.left,\n            className: 'kl-2-tabs__left',\n        });\n        this.leftTab.onpointerdown = () => false;\n\n        this.rightTab = BB.el({\n            parent: this.rootEl,\n            content: params.right,\n            className: 'kl-2-tabs__right',\n        });\n        this.rightTab.onpointerdown = () => false;\n\n        this.update();\n\n        this.leftTab.onclick = () => {\n            if (this.value === 0) {\n                return;\n            }\n            this.value = 0;\n            this.update();\n            params.onChange(this.value);\n        };\n\n        this.rightTab.onclick = () => {\n            if (this.value === 1) {\n                return;\n            }\n            this.value = 1;\n            this.update();\n            params.onChange(this.value);\n        };\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n}","import {TViewportTransform} from '../project-viewport/project-viewport';\nimport {BB} from '../../../bb/bb';\nimport {IVector2D} from '../../../bb/bb-types';\nimport {applyToPoint} from 'transformation-matrix';\nimport {createTransformMatrix} from '../project-viewport/utils/create-transform-matrix';\nimport {PointerListener} from '../../../bb/input/pointer-listener';\n\n\nexport type TDraggableInputParams = {\n    value: IVector2D;\n    onChange: (value: IVector2D) => void;\n};\n\nconst SIZE = 16;\n\nexport class DraggableInput {\n    private readonly rootEl: HTMLElement;\n    private transform: TViewportTransform;\n    private value: IVector2D;\n    private readonly pointerListener: PointerListener;\n\n    private update (): void {\n        const p = applyToPoint(\n            createTransformMatrix(this.transform),\n            this.value,\n        );\n        BB.css(this.rootEl, {\n            left: (p.x - SIZE / 2) + 'px',\n            top: (p.y - SIZE / 2) + 'px',\n        });\n    }\n\n    // ------ public ------\n    constructor (p: TDraggableInputParams) {\n        this.value = {...p.value};\n        this.transform = {\n            x: 0,\n            y: 0,\n            scale: 1,\n            angleDeg: 0,\n        };\n\n        this.rootEl = BB.el({\n            css: {\n                width: SIZE + 'px',\n                height: SIZE + 'px',\n                backgroundColor: '#fff',\n                border: '2px solid #000',\n                borderRadius: SIZE + 'px',\n                position: 'absolute',\n                cursor: 'move',\n                userSelect: 'none',\n                touchAction: 'none',\n            },\n        });\n\n        this.pointerListener = new BB.PointerListener({\n            target: this.rootEl,\n            onPointer: (event) => {\n                event.eventPreventDefault();\n                if (event.button === 'left' && event.type === 'pointermove') {\n                    this.value.x += event.dX / this.transform.scale;\n                    this.value.y += event.dY / this.transform.scale;\n                    this.update();\n                    p.onChange(this.value);\n                }\n            },\n        });\n    }\n\n    setTransform (transform: TViewportTransform): void {\n        if (JSON.stringify(this.transform) === JSON.stringify(transform)) {\n            return;\n        }\n        this.transform = transform;\n        this.update();\n    }\n\n    getValue (): IVector2D {\n        return this.value;\n    }\n\n    setValue (p: IVector2D): void {\n        this.value = {...p};\n        this.update();\n    }\n\n    getElement (): HTMLElement {\n        return this.rootEl;\n    }\n\n    destroy (): void {\n        this.rootEl.remove();\n        this.pointerListener.destroy();\n    }\n}","import {BB} from '../../bb/bb';\nimport {Checkbox} from '../ui/components/checkbox';\nimport {Select} from '../ui/components/select';\nimport constrainImg from '/src/app/img/ui/constrain.svg';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {TFilterHistoryEntry} from './filters';\nimport {table} from '../ui/components/table';\nimport {theme} from '../../theme/theme';\nimport {smallPreview} from '../ui/utils/preview-size';\n\nexport type TFilterResizeInput = {\n    width: number;\n    height: number;\n    algorithm: 'smooth' | 'pixelated';\n};\n\nexport type TFilterResizeHistoryEntry = TFilterHistoryEntry<\n    'resize',\n    TFilterResizeInput>;\n\nexport const filterResize = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        //BB.centerWithin\n        const klCanvas = params.klCanvas;\n        if (!klCanvas) {\n            return false;\n        }\n\n        const fit = BB.fitInto( klCanvas.getWidth(), klCanvas.getHeight(), 280, 200,1);\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        let previewFactor = w / klCanvas.getWidth();\n        const tempCanvas = klCanvas.getCompleteCanvas(1);\n\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterResizeInput> = {\n            element: rootEl,\n        };\n        let newWidth = klCanvas.getWidth(), newHeight = klCanvas.getHeight();\n\n        const maxWidth = params.maxWidth, maxHeight = params.maxHeight;\n\n        const widthWrapper = BB.el({\n            css: {\n                width: '150px',\n                height: '35px',\n                lineHeight: '30px',\n            },\n        });\n        const heightWrapper = BB.el({\n            css: {\n                width: '150px',\n                height: '35px',\n                lineHeight: '30px',\n            },\n        });\n        const widthInput = BB.el({\n            tagName: 'input',\n            css: {\n                cssFloat: 'right',\n                width: '90px',\n            },\n            custom: {\n                type: 'number',\n                min: '1',\n                max: '' + maxWidth,\n                value: '' + klCanvas.getWidth(),\n            },\n        });\n        const heightInput = BB.el({\n            tagName: 'input',\n            css: {\n                cssFloat: 'right',\n                width: '90px',\n            },\n            custom: {\n                type: 'number',\n                min: '1',\n                max: '' + maxHeight,\n                value: '' + klCanvas.getHeight(),\n            },\n        });\n        widthInput.onclick = function () {\n            (this as any).focus();\n            widthChanged = true;\n            update();\n        };\n        heightInput.onclick = function () {\n            (this as any).focus();\n            heightChanged = true;\n            update();\n        };\n        widthInput.onchange = function () {\n            widthChanged = true;\n            update();\n        };\n        heightInput.onchange = function () {\n            heightChanged = true;\n            update();\n        };\n        widthWrapper.append(LANG('width') + ': ', widthInput);\n        heightWrapper.append(LANG('height') + ': ', heightInput);\n        const inputWrapper = BB.el({\n            css: {\n                background: 'url(' + constrainImg + ') no-repeat 140px 5px',\n                backgroundSize: '50px 52px',\n            },\n        });\n        inputWrapper.append(widthWrapper, heightWrapper);\n        const constrainIm = new Image();\n        constrainIm.src = constrainImg;\n        constrainIm.height = 40;\n\n        const sizeTable = table([\n            [\n                LANG('width') + ':&nbsp;',\n                widthInput,\n                constrainIm,\n            ],\n            [\n                BB.el({css: {height: '5px'}}),\n                '',\n                '',\n            ],\n            [\n                LANG('height') + ':&nbsp;',\n                heightInput,\n            ],\n        ], {\n            '0.2': {rowspan: 3},\n        });\n        BB.css(sizeTable, {\n            marginBottom: '10px',\n        });\n\n        rootEl.append(sizeTable);\n\n        //contrain checkbox\n        let heightChanged = false, widthChanged = false;\n        const ratio = klCanvas.getWidth() / klCanvas.getHeight();\n\n        function updateConstrain (): void {\n            constrainIm.style.display = isConstrained ? '' : 'none';\n            if (isConstrained) {\n                widthInput.value = '' + klCanvas.getWidth();\n                heightInput.value = '' + klCanvas.getHeight();\n                update();\n            }\n        }\n\n        let isConstrained = true;\n        const constrainCheckbox = new Checkbox({\n            init: true,\n            label: LANG('constrain-proportions'),\n            allowTab: true,\n            callback: function (b) {\n                isConstrained = b;\n                updateConstrain();\n            },\n        });\n        rootEl.append(BB.el({\n            css: {\n                clear: 'both',\n            },\n        }));\n\n\n        const algorithmSelect = new Select({\n            isFocusable: true,\n            optionArr: [\n                ['smooth', LANG('algorithm-smooth')],\n                ['pixelated', LANG('algorithm-pixelated')],\n            ],\n            title: LANG('scaling-algorithm'),\n            initValue: 'smooth',\n            onChange: (): void => {\n                update();\n            },\n        });\n\n        const secondRowElement = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                justifyContent: 'space-between',\n                'alignItems': 'center',\n            },\n        });\n        secondRowElement.append(constrainCheckbox.getElement(), algorithmSelect.getElement());\n\n        const previewCanvas = BB.canvas(w, h);\n        previewCanvas.style.imageRendering = 'pixelated';\n\n\n        const previewCtx = BB.ctx(previewCanvas);\n\n\n        function draw (): void {\n            if (algorithmSelect.getValue() === 'smooth') {\n                previewCanvas.style.imageRendering = previewFactor > 1 ? 'pixelated' : '';\n\n                previewCanvas.width = klCanvas.getWidth();\n                previewCanvas.height = klCanvas.getHeight();\n\n                previewCtx.save();\n                previewCtx.imageSmoothingQuality = 'high';\n                previewCtx.drawImage(tempCanvas, 0, 0);\n                BB.resizeCanvas(previewCanvas, newWidth, newHeight);\n                previewCtx.restore();\n\n            } else {\n                previewCanvas.style.imageRendering = 'pixelated';\n\n                previewCanvas.width = newWidth;\n                previewCanvas.height = newHeight;\n                previewCtx.save();\n                previewCtx.imageSmoothingEnabled = false;\n                previewCtx.drawImage(tempCanvas, 0, 0, previewCanvas.width, previewCanvas.height);\n                previewCtx.restore();\n            }\n\n        }\n\n        function update (): void {\n            if ((widthInput.value.length === 0 && widthChanged) || (heightInput.value.length === 0 && heightChanged)) {\n                heightChanged = false;\n                widthChanged = false;\n                return;\n            }\n            widthInput.value = '' + Math.max(1, parseInt(widthInput.value));\n            heightInput.value = '' + Math.max(1, parseInt(heightInput.value));\n            if (isConstrained) {\n                if (heightChanged) {\n                    widthInput.value = '' + parseInt('' + (parseInt(heightInput.value) * ratio));\n                }\n                if (widthChanged) {\n                    heightInput.value = '' + parseInt('' + (parseInt(widthInput.value) / ratio));\n                }\n\n                if (parseInt(widthInput.value) > maxWidth || parseInt(heightInput.value) > maxHeight) {\n                    const fit = BB.fitInto(parseInt(widthInput.value), parseInt(heightInput.value), maxWidth, maxHeight, 1);\n                    widthInput.value = '' + parseInt('' + fit.width);\n                    heightInput.value = '' + parseInt('' + fit.height);\n                }\n            }\n\n            if (parseInt(widthInput.value) > maxWidth) {\n                widthInput.value = '' + maxWidth;\n            }\n            if (parseInt(heightInput.value) > maxHeight) {\n                heightInput.value = '' + maxHeight;\n            }\n\n            heightChanged = false;\n            widthChanged = false;\n\n            newWidth = parseInt(widthInput.value);\n            newHeight = parseInt(heightInput.value);\n\n            const preview = BB.fitInto(newWidth, newHeight, 280, 200, 1);\n            const previewW = parseInt('' + preview.width), previewH = parseInt('' + preview.height);\n            previewFactor = previewW / newWidth;\n\n            const offset = BB.centerWithin(smallPreview.width, smallPreview.height, previewW, previewH);\n\n            draw();\n\n            previewCanvas.style.width = Math.max(1, previewW) + 'px';\n            previewCanvas.style.height = Math.max(1, previewH) + 'px';\n            canvasWrapper.style.left = offset.x + 'px';\n            canvasWrapper.style.top = offset.y + 'px';\n            canvasWrapper.style.width = Math.max(1, previewW) + 'px';\n            canvasWrapper.style.height = Math.max(1, previewH) + 'px';\n        }\n\n        const previewWrapper = BB.el({\n            className: 'kl-transparent-preview',\n            css: {\n                width: smallPreview.width + 'px',\n                height: smallPreview.height + 'px',\n                marginLeft: '-20px',\n                display: 'table',\n                marginTop: '10px',\n                position: 'relative',\n                userSelect: 'none',\n            },\n        });\n\n        const canvasWrapper = BB.el({\n            parent: previewWrapper,\n            content: previewCanvas,\n            className: 'kl-transparent-preview__canvas',\n            css: {\n                width: w + 'px',\n                height: h + 'px',\n                position: 'absolute',\n                overflow: 'hidden',\n            },\n        });\n\n        function updateCheckerboard (): void {\n            BB.createCheckerDataUrl(8, function (url) {\n                previewWrapper.style.background = 'url(' + url + ')';\n            }, theme.isDark());\n        }\n        theme.addIsDarkListener(updateCheckerboard);\n        updateCheckerboard();\n\n\n        rootEl.append(previewWrapper);\n        update();\n\n        result.destroy = (): void => {\n            constrainCheckbox.destroy();\n            theme.removeIsDarkListener(updateCheckerboard);\n        };\n        result.getInput = function (): TFilterResizeInput {\n            result.destroy!();\n            return {\n                width: newWidth,\n                height: newHeight,\n                algorithm: algorithmSelect.getValue(),\n            };\n        };\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterResizeInput>): boolean {\n        const klCanvas = params.klCanvas;\n        const history = params.history;\n        const width = params.input.width;\n        const height = params.input.height;\n        const algorithm = params.input.algorithm;\n        if (!klCanvas || !history) {\n            return false;\n        }\n        history.pause(true);\n        klCanvas.resize(width, height, algorithm);\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'resize'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterResizeHistoryEntry);\n        return true;\n    },\n\n};","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"constrain.62f04e45.svg\";","import {BB} from '../../bb/bb';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {TFilterHistoryEntry} from './filters';\nimport {theme} from '../../theme/theme';\nimport {smallPreview} from '../ui/utils/preview-size';\n\nexport type TFilterRotateInput = {\n    deg: number;\n}\n\nexport type TFilterRotateHistoryEntry = TFilterHistoryEntry<\n    'rotate',\n    TFilterRotateInput>;\n\nexport const filterRotate = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const klCanvas = params.klCanvas;\n        if (!klCanvas) {\n            return false;\n        }\n\n        const fit = BB.fitInto(klCanvas.getWidth(), klCanvas.getHeight(), 280, 200, 1);\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n\n        const previewFactor = w / klCanvas.getWidth();\n        const tempCanvas = BB.canvas(w, h);\n        tempCanvas.style.display = 'block';\n        BB.ctx(tempCanvas).drawImage(klCanvas.getCompleteCanvas(previewFactor), 0, 0, w, h);\n\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterRotateInput> = {\n            element: rootEl,\n        };\n        let deg = 0;\n\n        function update (): void {\n            canvasWrapper.style.transform = 'rotate(' + deg + 'deg)';\n            if (Math.abs(deg % 180) === 90) {\n                //height has to fit width because of rotation\n                const fit = BB.fitInto(h, w, 280, 200, 1);\n                const scale = parseInt('' + fit.height) / w;\n                canvasWrapper.style.transform = 'rotate(' + deg + 'deg) scale(' + scale + ')';\n            }\n        }\n\n        const btnPlus = document.createElement('button');\n        btnPlus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\";\n        const btnMinus = document.createElement('button');\n        btnMinus.innerHTML = \"<span style='font-size: 1.3em'></span> 90\";\n        btnMinus.style.marginRight = '5px';\n\n\n        btnPlus.onclick = function () {\n            deg += 90;\n            update();\n        };\n        btnMinus.onclick = function () {\n            deg -= 90;\n            update();\n        };\n\n        rootEl.append(btnMinus, btnPlus);\n\n        const previewWrapper = BB.el({\n            className: 'kl-preview-wrapper',\n            css: {\n                width: smallPreview.width + 'px',\n                height: smallPreview.height + 'px',\n                display: 'table',\n            },\n        });\n\n        const previewcell = BB.el({\n            parent: previewWrapper,\n            css: {\n                display: 'table-cell',\n                verticalAlign: 'middle',\n            },\n        });\n        const canvasWrapper = BB.el({\n            parent: previewcell,\n            content: tempCanvas,\n            className: 'kl-preview-wrapper__canvas',\n            css: {\n                width: w + 'px',\n                height: h + 'px',\n                marginLeft: 'auto',\n                marginRight: 'auto',\n                overflow: 'hidden',\n            },\n        });\n\n\n        function updateCheckerboard (): void {\n            BB.createCheckerDataUrl(8, function (url) {\n                canvasWrapper.style.background = 'url(' + url + ')';\n            }, theme.isDark());\n        }\n        theme.addIsDarkListener(updateCheckerboard);\n        updateCheckerboard();\n\n        canvasWrapper.style.transition = 'all 0.2s ease-out';\n\n        rootEl.append(previewWrapper);\n        update();\n\n        result.destroy = (): void => {\n            theme.removeIsDarkListener(updateCheckerboard);\n        };\n        result.getInput = function (): TFilterRotateInput {\n            result.destroy!();\n            return {\n                deg: deg,\n            };\n        };\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterRotateInput>): boolean {\n        const klCanvas = params.klCanvas;\n        const history = params.history;\n        if (!klCanvas || !history) {\n            return false;\n        }\n        history.pause(true);\n        klCanvas.rotate(params.input.deg);\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'rotate'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterRotateHistoryEntry);\n        return true;\n    },\n\n};","import {BB} from '../../bb/bb';\nimport {eventResMs} from './filters-consts';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {IVector2D} from '../../bb/bb-types';\nimport {TFilterHistoryEntry} from './filters';\nimport {FxPreviewRenderer} from '../ui/project-viewport/fx-preview-renderer';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {createTransformMatrix} from '../ui/project-viewport/utils/create-transform-matrix';\nimport {applyToPoint} from 'transformation-matrix';\nimport {DraggableInput} from '../ui/components/draggable-input';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth} from '../ui/utils/preview-size';\n\nexport type TFilterTiltShiftInput = {\n    a: IVector2D;\n    b: IVector2D;\n    blur: number;\n    gradient: number;\n};\n\nexport type TFilterTiltShiftHistoryEntry = TFilterHistoryEntry<\n    'tiltShift',\n    TFilterTiltShiftInput>;\n\nexport const filterTiltShift = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterTiltShiftInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        let blur = 20, gradient = 200;\n        let fxPreviewRenderer: FxPreviewRenderer = {destroy: () => {}} as FxPreviewRenderer;\n\n        function finishInit () {\n\n            fxPreviewRenderer = new FxPreviewRenderer({\n                original: context.canvas,\n                onUpdate: (fxCanvas, transform) => {\n                    fa.setTransform(preview.getTransform());\n                    fb.setTransform((preview.getTransform()));\n\n                    const m = createTransformMatrix(transform);\n                    const a = applyToPoint(m, fa.getValue());\n                    const b = applyToPoint(m, fb.getValue());\n                    return fxCanvas.multiplyAlpha().tiltShift(\n                        a.x,\n                        a.y,\n                        b.x,\n                        b.y,\n                        blur * transform.scaleX,\n                        gradient * transform.scaleX\n                    ).unmultiplyAlpha();\n                },\n            });\n\n            function update () {\n                preview.render();\n            }\n\n            // focus line control points\n            const fa = new DraggableInput({\n                value: {x: context.canvas.width / 4, y: context.canvas.height / 2},\n                onChange: () => {\n                    update();\n                },\n            });\n            const fb = new DraggableInput({\n                value: {x: 3 * context.canvas.width / 4, y: context.canvas.height / 2},\n                onChange: () => {\n                    update();\n                },\n            });\n\n            const gradientSlider = new KlSlider({\n                label: LANG('filter-tilt-shift-gradient'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 1000,\n                value: gradient,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    gradient = val;\n                    update();\n                },\n            });\n            gradientSlider.getElement().style.marginBottom = '10px';\n            rootEl.append(gradientSlider.getElement());\n            const blurSlider = new KlSlider({\n                label: LANG('filter-tilt-shift-blur'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 200,\n                value: blur,\n                eventResMs: eventResMs,\n                onChange: function (val) {\n                    blur = val;\n                    update();\n                },\n            });\n            blurSlider.getElement().style.marginBottom = '10px';\n            rootEl.append(blurSlider.getElement());\n\n\n            const previewLayerArr: TProjectViewportProject['layers'] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                        isVisible: layers[i].isVisible,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr,\n                        hasClipping: false,\n                    });\n                }\n            }\n\n            const preview = new Preview({\n                width: getPreviewWidth(isSmall),\n                height: getPreviewHeight(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr,\n                },\n            });\n\n            preview.render();\n            BB.css(preview.getElement(), {\n                overflow: 'hidden',\n                marginLeft: '-20px',\n                marginRight: '-20px',\n            });\n\n            preview.getElement().append(fa.getElement(), fb.getElement());\n            rootEl.append(preview.getElement());\n\n            result.destroy = (): void => {\n                blurSlider.destroy();\n                gradientSlider.destroy();\n                fa.destroy();\n                fb.destroy();\n                fxPreviewRenderer.destroy();\n                preview.destroy();\n            };\n            result.getInput = function (): TFilterTiltShiftInput {\n                result.destroy!();\n                return {\n                    a: fa.getValue(),\n                    b: fb.getValue(),\n                    blur: blur,\n                    gradient: gradient,\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterTiltShiftInput>): boolean {\n        const context = params.context;\n        const history = params.history;\n        const a = params.input.a;\n        const b = params.input.b;\n        const blur = params.input.blur;\n        const gradient = params.input.gradient;\n        if (!context || !history) {\n            return false;\n        }\n        history.pause(true);\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false; // todo more specific error?\n        }\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).multiplyAlpha().tiltShift(a.x, a.y, b.x, b.y, blur, gradient).unmultiplyAlpha().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'tiltShift'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterTiltShiftHistoryEntry);\n        return true;\n    },\n\n};","import {BB} from '../../bb/bb';\nimport {Checkbox} from '../ui/components/checkbox';\nimport {FreeTransform} from '../ui/components/free-transform';\nimport {IFreeTransform} from '../ui/components/free-transform-utils';\nimport {Select} from '../ui/components/select';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {TFilterHistoryEntry} from './filters';\nimport {throwIfNull} from '../../bb/base/base';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {css} from '@emotion/css/dist/emotion-css.cjs';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth, mediumPreview} from '../ui/utils/preview-size';\n\nexport type TFilterTransformInput = {\n    bounds: {x: number; y: number; width: number; height: number};\n    transform: IFreeTransform;\n    isPixelated: boolean;\n};\n\nexport type TFilterTransformHistoryEntry = TFilterHistoryEntry<\n    'transform',\n    TFilterTransformInput>;\n\nexport const filterTransform = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const isSmall = testIsSmall();\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\n\n        // determine bounds and initial transformation\n        const boundsObj = BB.canvasBounds(context);\n        if (!boundsObj) {\n            return { error: LANG('filter-transform-empty') };\n        }\n        const initTransform = {\n            x: boundsObj.x + boundsObj.width / 2,\n            y: boundsObj.y + boundsObj.height / 2,\n            width: boundsObj.width,\n            height: boundsObj.height,\n            angleDeg: 0,\n        };\n\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterTransformInput> = {\n            element: rootEl,\n        };\n        if (!isSmall) {\n            result.width = mediumPreview.width;\n        }\n\n        const keyListener = new BB.KeyListener({\n            onDown: function (keyStr) {\n                if (BB.isInputFocused(true)) {\n                    return;\n                }\n\n                if (keyStr === 'left') {\n                    inputX.value = '' + (parseFloat(inputX.value) - 1);\n                    onInputsChanged();\n                }\n                if (keyStr === 'right') {\n                    inputX.value = '' + (parseFloat(inputX.value) + 1);\n                    onInputsChanged();\n                }\n                if (keyStr === 'up') {\n                    inputY.value = '' + (parseFloat(inputY.value) - 1);\n                    onInputsChanged();\n                }\n                if (keyStr === 'down') {\n                    inputY.value = '' + (parseFloat(inputY.value) + 1);\n                    onInputsChanged();\n                }\n            },\n\n        });\n\n        const leftWrapper = BB.el();\n        const rightWrapper = BB.el();\n        const rotWrapper = BB.el();\n        const inputY = BB.el({tagName: 'input'});\n        const inputX = BB.el({tagName: 'input'});\n        const inputR = BB.el({tagName: 'input'});\n        leftWrapper.style.width = '100px';\n        leftWrapper.style.height = '30px';\n        rightWrapper.style.width = '100px';\n        rightWrapper.style.height = '30px';\n        rightWrapper.style.display = 'inline-block';\n        leftWrapper.style.display = 'inline-block';\n        rotWrapper.style.display = 'inline-block';\n        rotWrapper.style.width = '150px';\n        rotWrapper.style.height = '30px';\n        inputY.type = 'number';\n        inputX.type = 'number';\n        inputR.type = 'number';\n        inputX.style.width = 70 + 'px';\n        inputY.style.width = 70 + 'px';\n        inputR.style.width = 70 + 'px';\n        inputY.value = '0';\n        inputX.value = '0';\n        inputR.value = '0';\n        inputY.onclick = function () {\n            inputY.focus();\n            onInputsChanged();\n        };\n        inputX.onclick = function () {\n            inputX.focus();\n            onInputsChanged();\n        };\n        inputR.onclick = function () {\n            inputR.focus();\n            onInputsChanged();\n        };\n        inputY.onchange = function () {\n            onInputsChanged();\n        };\n        inputX.onchange = function () {\n            onInputsChanged();\n        };\n        inputR.onchange = function () {\n            onInputsChanged();\n        };\n        inputY.onkeyup = function () {\n            onInputsChanged();\n        };\n        inputX.onkeyup = function () {\n            onInputsChanged();\n        };\n        inputR.onkeyup = function () {\n            onInputsChanged();\n        };\n        leftWrapper.append('X: ', inputX);\n        rightWrapper.append('Y: ', inputY);\n        rotWrapper.append(LANG('filter-transform-rotation') + ': ', inputR);\n        if (!isSmall) {\n            const inputRow = BB.el({\n                parent: rootEl,\n                css: {\n                    marginTop: '10px',\n                },\n            });\n            inputRow.append(leftWrapper, rightWrapper, rotWrapper);\n        }\n\n        // buttons\n        const actionBtnCss = {\n            marginLeft: '10px',\n            marginTop: '10px',\n        };\n        const buttonRow = BB.el ({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                flexWrap: 'wrap',\n                marginLeft: '-10px',\n            },\n        });\n        const flipXBtn = BB.el ({\n            parent: buttonRow,\n            tagName: 'button',\n            content: LANG('filter-transform-flip') + ' X',\n            onClick: () => {\n                const t = freeTransform.getValue();\n                freeTransform.setSize(-t.width, t.height);\n            },\n            css: actionBtnCss,\n        });\n        const flipYBtn = BB.el ({\n            parent: buttonRow,\n            tagName: 'button',\n            content: LANG('filter-transform-flip') + ' Y',\n            onClick: () => {\n                const t = freeTransform.getValue();\n                freeTransform.setSize(t.width, -t.height);\n            },\n            css: actionBtnCss,\n        });\n        const scaleRotLeftBtn = BB.el ({\n            parent: buttonRow,\n            tagName: 'button',\n            content: '-90',\n            onClick: () => {\n                const t = freeTransform.getValue();\n                t.angleDeg -= 90;\n                t.angleDeg %= 360;\n                freeTransform.setAngleDeg(t.angleDeg);\n                inputR.value = '' + Math.round(t.angleDeg);\n                updatePreview();\n            },\n            css: actionBtnCss,\n        });\n        const scaleRotRightBtn = BB.el ({\n            parent: buttonRow,\n            tagName: 'button',\n            content: '+90',\n            onClick: () => {\n                const t = freeTransform.getValue();\n                t.angleDeg += 90;\n                t.angleDeg %= 360;\n                freeTransform.setAngleDeg(t.angleDeg);\n                inputR.value = '' + Math.round(t.angleDeg);\n                updatePreview();\n            },\n            css: actionBtnCss,\n        });\n        const scaleDoubleBtn = BB.el ({\n            parent: buttonRow,\n            tagName: 'button',\n            content: '2x',\n            onClick: () => {\n                const t = freeTransform.getValue();\n                if (constrainCheckbox.getValue()) {\n                    freeTransform.setSize(freeTransform.getRatio() * t.height * 2, t.height * 2);\n                } else {\n                    freeTransform.setSize(t.width * 2, t.height * 2);\n                }\n            },\n            css: actionBtnCss,\n        });\n        const scaleHalfBtn = BB.el ({\n            parent: buttonRow,\n            tagName: 'button',\n            content: '1/2x',\n            onClick: () => {\n                const t = freeTransform.getValue();\n                freeTransform.setSize(Math.round(t.width / 2), Math.round(t.height / 2));\n            },\n            css: actionBtnCss,\n        });\n        const centerBtn = BB.el ({\n            parent: buttonRow,\n            tagName: 'button',\n            content: LANG('center'),\n            onClick: () => {\n                const t = freeTransform.getValue();\n                freeTransform.setPos({ x: context.canvas.width / 2, y: context.canvas.height / 2 });\n                freeTransform.setAngleDeg(t.angleDeg);\n                updatePreview();\n            },\n            css: actionBtnCss,\n        });\n\n\n\n\n\n        let isConstrained = true;\n        const constrainCheckbox = new Checkbox({\n            init: true,\n            label: LANG('filter-transform-constrain'),\n            title: LANG('constrain-proportions'),\n            allowTab: true,\n            callback: function (b) {\n                isConstrained = b;\n                freeTransform.setIsConstrained(isConstrained);\n            },\n            css: {\n                display: 'inline-block',\n            },\n        });\n        let isSnapping = false;\n        const snappingCheckbox = new Checkbox({\n            init: true,\n            label: LANG('filter-transform-snap'),\n            title: LANG('filter-transform-snap-title'),\n            allowTab: true,\n            callback: function (b) {\n                isSnapping = b;\n                freeTransform.setSnapping(isSnapping);\n            },\n            css: {\n                display: 'inline-block',\n                marginLeft: '10px',\n            },\n        });\n        const checkboxWrapper = BB.el();\n        checkboxWrapper.append(constrainCheckbox.getElement(), snappingCheckbox.getElement());\n\n        rootEl.append(BB.el({\n            css: {\n                clear: 'both',\n                height: '10px',\n            },\n        }));\n\n        const bottomRow = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                justifyContent: 'space-between',\n                alignItems: 'center',\n                marginBottom: '10px',\n            },\n        });\n\n        const algorithmSelect = new Select({\n            isFocusable: true,\n            optionArr: [\n                ['smooth', LANG('algorithm-smooth')],\n                ['pixelated', LANG('algorithm-pixelated')],\n            ],\n            initValue: 'smooth',\n            title: LANG('scaling-algorithm'),\n            onChange: (): void => {\n                updatePreview(true);\n            },\n        });\n        bottomRow.append(checkboxWrapper, algorithmSelect.getElement());\n\n        const previewCanvas = BB.canvas(context.canvas.width, context.canvas.height);\n        const previewLayerArr: TProjectViewportProject['layers'] = [];\n        {\n            for (let i = 0; i < layers.length; i++) {\n                previewLayerArr.push({\n                    image: i === selectedLayerIndex ? previewCanvas : layers[i].context.canvas,\n                    isVisible: layers[i].isVisible,\n                    opacity: layers[i].opacity,\n                    mixModeStr: layers[i].mixModeStr,\n                    hasClipping: false,\n                });\n            }\n        }\n\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n            hasEditMode: true,\n            onModeChange: (m) => {\n                freeTransform.getElement().style.pointerEvents = m === 'edit' ? '' : 'none';\n                freeTransform.getElement().style.opacity = m === 'edit' ? '' : '0.5';\n            },\n            onTransformChange: (transform) => {\n                freeTransform.setViewportTransform(transform);\n            },\n            padding: 30,\n        });\n        preview.render();\n        preview.getElement().classList.add(css({\n            overflow: 'hidden',\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        }));\n        rootEl.append(preview.getElement());\n\n\n        let lastDrawnTransformStr = '';\n        function updatePreview (doForce: boolean = false) {\n            if (!freeTransform) {\n                return;\n            }\n            const transform = freeTransform.getValue();\n            if (JSON.stringify(transform) === lastDrawnTransformStr && !doForce) {\n                return;\n            }\n            lastDrawnTransformStr = JSON.stringify(transform);\n\n            const ctx = BB.ctx(previewCanvas);\n            ctx.save();\n            ctx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);\n            BB.drawTransformedImageWithBounds(\n                ctx,\n                layers[selectedLayerIndex].context.canvas,\n                transform,\n                boundsObj,\n                algorithmSelect.getValue() === 'pixelated' ||\n                BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\n            );\n            ctx.restore();\n            preview.render();\n        }\n\n        const freeTransform = new FreeTransform({\n            x: initTransform.x,\n            y: initTransform.y,\n            width: initTransform.width,\n            height: initTransform.height,\n            angleDeg: initTransform.angleDeg,\n            isConstrained: true,\n            snapX: [0, context.canvas.width],\n            snapY: [0, context.canvas.height],\n            callback: function (t) {\n                inputX.value = '' + Math.round(t.x - initTransform.x);\n                inputY.value = '' + Math.round(t.y - initTransform.y);\n                inputR.value = '' + Math.round(t.angleDeg);\n                updatePreview();\n            },\n            viewportTransform: preview.getTransform(),\n        });\n        BB.css(freeTransform.getElement(), {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n        });\n        preview.getElement().append(freeTransform.getElement());\n\n        function onInputsChanged () {\n            freeTransform.setPos({\n                x: parseInt(inputX.value) + initTransform.x,\n                y: parseInt(inputY.value) + initTransform.y}\n            );\n            freeTransform.setAngleDeg(parseInt(inputR.value));\n            updatePreview();\n        }\n\n        updatePreview();\n\n        result.destroy = (): void => {\n            keyListener.destroy();\n            freeTransform.destroy();\n            constrainCheckbox.destroy();\n            snappingCheckbox.destroy();\n            BB.destroyEl(flipXBtn);\n            BB.destroyEl(flipYBtn);\n            BB.destroyEl(scaleRotLeftBtn);\n            BB.destroyEl(scaleRotRightBtn);\n            BB.destroyEl(scaleDoubleBtn);\n            BB.destroyEl(scaleHalfBtn);\n            BB.destroyEl(centerBtn);\n            preview.destroy();\n            BB.freeCanvas(previewCanvas);\n        };\n        result.getInput = function (): TFilterTransformInput {\n            const transform = freeTransform.getValue();\n            const input: TFilterTransformInput = {\n                transform,\n                bounds: boundsObj,\n                isPixelated: algorithmSelect.getValue() === 'pixelated' ||\n                    BB.testShouldPixelate(transform, transform.width / initTransform.width, transform.height / initTransform.height),\n            };\n            result.destroy!();\n            return BB.copyObj(input);\n        };\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterTransformInput>): boolean {\n        const context = params.context;\n        const history = params.history;\n        if (!context || !history) {\n            return false;\n        }\n        history.pause(true);\n\n        const input = params.input;\n\n        const copyCanvas = BB.copyCanvas(context.canvas);\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        BB.drawTransformedImageWithBounds(\n            context,\n            copyCanvas,\n            input.transform,\n            input.bounds,\n            input.isPixelated,\n        );\n\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'transform'],\n            action: 'apply',\n            params: [{input}],\n        } as TFilterTransformHistoryEntry);\n        return true;\n    },\n\n};","import {KlSlider} from '../ui/components/kl-slider';\nimport {eventResMs} from './filters-consts';\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {TFilterHistoryEntry} from './filters';\nimport {FxPreviewRenderer} from '../ui/project-viewport/fx-preview-renderer';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {css} from '@emotion/css/dist/emotion-css.cjs';\nimport {BB} from '../../bb/bb';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth} from '../ui/utils/preview-size';\n\nexport type TFilterBlurInput = {\n    radius: number;\n}\n\nexport type TFilterBlurHistoryEntry = TFilterHistoryEntry<\n    'blur',\n    TFilterBlurInput>;\n\n\nexport const filterBlur = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const klCanvas = params.klCanvas;\n        const context = params.context;\n        if (!klCanvas || !context) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterBlurInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        let radius = 10;\n        const fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas, transform) => {\n                return fxCanvas.multiplyAlpha().triangleBlur(radius * transform.scaleX).unmultiplyAlpha();\n            },\n        });\n\n\n        function finishInit (): void {\n\n            const radiusSlider = new KlSlider({\n                label: LANG('radius'),\n                width: 300,\n                height: 30,\n                min: 1,\n                max: 200,\n                value: radius,\n                eventResMs: eventResMs,\n                onChange: (val): void => {\n                    radius = val;\n                    preview.render();\n                },\n            });\n            radiusSlider.getElement().style.marginBottom = '10px';\n            rootEl.append(radiusSlider.getElement());\n\n            const previewLayerArr: TProjectViewportProject['layers'] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                        isVisible: layers[i].isVisible,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr,\n                        hasClipping: false,\n                    });\n                }\n            }\n\n            const preview = new Preview({\n                width: getPreviewWidth(isSmall),\n                height: getPreviewHeight(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr,\n                },\n            });\n            preview.render();\n            preview.getElement().classList.add(css({\n                marginLeft: '-20px',\n                marginRight: '-20px',\n            }));\n            rootEl.append(preview.getElement());\n\n            result.destroy = (): void => {\n                radiusSlider.destroy();\n                fxPreviewRenderer.destroy();\n                preview.destroy();\n            };\n            result.getInput = function (): TFilterBlurInput {\n                result.destroy!();\n                return {\n                    radius: radius,\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterBlurInput>): boolean {\n        const context = params.context;\n        const history = params.history;\n        const radius = params.input.radius;\n        if (!context || !radius || !history) {\n            return false;\n        }\n        history.pause(true);\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false; // todo more specific error?\n        }\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).multiplyAlpha().triangleBlur(radius).unmultiplyAlpha().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'blur'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterBlurHistoryEntry);\n        return true;\n    },\n\n};","import {KlSlider} from '../ui/components/kl-slider';\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {TFilterHistoryEntry} from './filters';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {css} from '@emotion/css';\nimport {FxPreviewRenderer} from '../ui/project-viewport/fx-preview-renderer';\nimport {BB} from '../../bb/bb';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth} from '../ui/utils/preview-size';\n\nexport type TFilterUnsharpMaskInput = {\n    radius: number;\n    strength: number;\n};\n\nexport type TFilterUnsharpMaskHistoryEntry = TFilterHistoryEntry<\n    'unsharpMask',\n    TFilterUnsharpMaskInput>;\n\nexport const filterUnsharpMask = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterUnsharpMaskInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        let radius = 2, strength = 5.1 / 10;\n        const fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas, transform) => {\n                return fxCanvas.unsharpMask(radius * transform.scaleX, strength);\n            },\n        });\n\n        function finishInit () {\n\n            function update () {\n                preview.render();\n            }\n\n            const radiusSlider = new KlSlider({\n                label: LANG('radius'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 200,\n                value: 2,\n                //eventResMs: eventResMs,\n                onChange: function (val) {\n                    radius = val;\n                    update();\n                },\n                curve: [[0, 0], [0.1, 2], [0.5, 50], [1, 200]],\n            });\n            const strengthSlider = new KlSlider({\n                label: LANG('filter-unsharp-mask-strength'),\n                width: 300,\n                height: 30,\n                min: 0,\n                max: 50,\n                value: 5.1,\n                //eventResMs: eventResMs,\n                onChange: function (val) {\n                    strength = val / 10;\n                    update();\n\n                },\n                curve: [[0, 0], [0.1, 2], [0.5, 10], [1, 50]],\n            });\n            radiusSlider.getElement().style.marginBottom = '10px';\n            strengthSlider.getElement().style.marginBottom = '10px';\n            rootEl.append(radiusSlider.getElement());\n            rootEl.append(strengthSlider.getElement());\n\n            const previewLayerArr: TProjectViewportProject['layers'] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                        isVisible: layers[i].isVisible,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr,\n                        hasClipping: false,\n                    });\n                }\n            }\n\n            const preview = new Preview({\n                width: getPreviewWidth(isSmall),\n                height: getPreviewHeight(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr,\n                },\n            });\n            update();\n            preview.getElement().classList.add(css({\n                marginLeft: '-20px',\n                marginRight: '-20px',\n            }));\n            rootEl.append(preview.getElement());\n\n            result.destroy = (): void => {\n                radiusSlider.destroy();\n                strengthSlider.destroy();\n                fxPreviewRenderer.destroy();\n                preview.destroy();\n            };\n            result.getInput = function (): TFilterUnsharpMaskInput {\n                result.destroy!();\n                return {\n                    radius: radius,\n                    strength: strength,\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n\n    apply (params: IFilterApply<TFilterUnsharpMaskInput>): boolean {\n        const context = params.context;\n        const history = params.history;\n        const radius = params.input.radius;\n        const strength = params.input.strength;\n        if (!context || radius === null || strength === null || !history) {\n            return false;\n        }\n        history.pause(true);\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false; // todo more specific error?\n        }\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).unsharpMask(radius, strength).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'unsharpMask'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterUnsharpMaskHistoryEntry);\n        return true;\n    },\n\n};","import {Options} from '../ui/components/options';\nimport {ColorOptions} from '../ui/components/color-options';\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult, IRGBA} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {TFilterHistoryEntry} from './filters';\nimport {FxPreviewRenderer} from '../ui/project-viewport/fx-preview-renderer';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {css} from '@emotion/css/dist/emotion-css.cjs';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {BB} from '../../bb/bb';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth} from '../ui/utils/preview-size';\n\nexport type TFilterToAlphaInput = {\n    sourceId: string;\n    selectedRgbaObj: IRGBA | null;\n};\n\nexport type TFilterToAlphaHistoryEntry = TFilterHistoryEntry<\n    'toAlpha',\n    TFilterToAlphaInput>;\n\nexport const filterToAlpha = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = klCanvas.getLayerIndex(context.canvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterToAlphaInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        function finishInit () {\n\n            const fxPreviewRenderer = new FxPreviewRenderer({\n                original: context.canvas,\n                onUpdate: (fxCanvas) => {\n                    return fxCanvas.toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj);\n                },\n            });\n\n            // source\n            let sourceId = 'inverted-luminance';\n            const sourceOptions = new Options({\n                optionArr: [\n                    {\n                        id: 'inverted-luminance',\n                        label: LANG('filter-to-alpha-inverted-lum'),\n                    },\n                    {\n                        id: 'luminance',\n                        label: LANG('filter-to-alpha-lum'),\n                    },\n                ],\n                initId: sourceId,\n                onChange: function (id) {\n                    sourceId = id;\n                    preview.render();\n                },\n            });\n            rootEl.append(sourceOptions.getElement());\n\n            // color\n            let selectedRgbaObj: IRGBA | null = {r: 0, g: 0, b: 0, a: 1};\n            const colorOptionsArr = [\n                null,\n                {r: 0, g: 0, b: 0, a: 1},\n                {r: 255, g: 255, b: 255, a: 1},\n                {\n                    r: params.currentColorRgb.r,\n                    g: params.currentColorRgb.g,\n                    b: params.currentColorRgb.b,\n                    a: 1,\n                },\n                {\n                    r: params.secondaryColorRgb.r,\n                    g: params.secondaryColorRgb.g,\n                    b: params.secondaryColorRgb.b,\n                    a: 1,\n                },\n            ];\n\n            const colorOptions = new ColorOptions({\n                label: LANG('filter-to-alpha-replace'),\n                colorArr: colorOptionsArr,\n                initialIndex: 1,\n                onChange: function (rgbaObj) {\n                    selectedRgbaObj = rgbaObj;\n                    preview.render();\n                },\n            });\n            colorOptions.getElement().style.marginTop = '10px';\n            colorOptions.getElement().style.marginBottom = '10px';\n            rootEl.append(colorOptions.getElement());\n\n\n            const previewLayerArr: TProjectViewportProject['layers'] = [];\n            {\n                for (let i = 0; i < layers.length; i++) {\n                    previewLayerArr.push({\n                        image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                        isVisible: layers[i].isVisible,\n                        opacity: layers[i].opacity,\n                        mixModeStr: layers[i].mixModeStr,\n                        hasClipping: false,\n                    });\n                }\n            }\n\n            const preview = new Preview({\n                width: getPreviewWidth(isSmall),\n                height: getPreviewHeight(isSmall),\n                project: {\n                    width: context.canvas.width,\n                    height: context.canvas.height,\n                    layers: previewLayerArr,\n                },\n            });\n            preview.render();\n            preview.getElement().classList.add(css({\n                marginLeft: '-20px',\n                marginRight: '-20px',\n            }));\n            rootEl.append(preview.getElement());\n\n            result.destroy = (): void => {\n                sourceOptions.destroy();\n                colorOptions.destroy();\n                fxPreviewRenderer.destroy();\n                preview.destroy();\n            };\n            result.getInput = function (): TFilterToAlphaInput {\n                result.destroy!();\n                return {\n                    sourceId: sourceId,\n                    selectedRgbaObj: selectedRgbaObj,\n                };\n            };\n        }\n\n        setTimeout(finishInit, 1);\n\n        return result;\n    },\n\n\n    apply (params: IFilterApply<TFilterToAlphaInput>): boolean {\n        const context = params.context;\n        const history = params.history;\n        const sourceId = params.input.sourceId;\n        const selectedRgbaObj = params.input.selectedRgbaObj;\n        if (!context || !sourceId || !history) {\n            return false;\n        }\n        history.pause(true);\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false; // todo more specific error?\n        }\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).toAlpha(sourceId === 'inverted-luminance', selectedRgbaObj).update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'toAlpha'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterToAlphaHistoryEntry);\n        return true;\n    },\n\n};","import {BB} from '../../bb/bb';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {input} from '../ui/components/input';\nimport {ColorOptions} from '../ui/components/color-options';\nimport {drawGrid} from '../image-operations/draw-grid';\nimport {TFilterHistoryEntry} from './filters';\nimport {throwIfNull} from '../../bb/base/base';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {css} from '@emotion/css/dist/emotion-css.cjs';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth} from '../ui/utils/preview-size';\n\nexport type TFilterGridInput = {\n    x: number;\n    y: number;\n    thickness: number;\n    color: string;\n    opacity: number;\n};\n\nexport type TFilterGridHistoryEntry = TFilterHistoryEntry<\n    'grid',\n    TFilterGridInput>;\n\nexport const filterGrid = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterGridInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        const settingsObj: TFilterGridInput = {\n            x: 2,\n            y: 2,\n            thickness: 8,\n            color: '#000',\n            opacity: 1,\n        };\n\n        const line1 = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n            },\n        });\n        const line2 = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginTop: '10px',\n                marginBottom: '10px',\n            },\n        });\n        const xInput = input({\n            init: 2,\n            type: 'number',\n            min: 1,\n            css: {width: '75px', marginRight: '20px'},\n            callback: function (v) {\n                settingsObj.x = parseFloat(v);\n                updatePreview();\n            },\n        });\n        const yInput = input({\n            init: 2,\n            type: 'number',\n            min: 1,\n            css: {width: '75px', marginRight: '20px'},\n            callback: function (v) {\n                settingsObj.y = parseFloat(v);\n                updatePreview();\n            },\n        });\n        const thicknessInput = input({\n            init: settingsObj.thickness,\n            type: 'number',\n            min: 1,\n            css: {width: '75px', marginRight: '20px'},\n            callback: function (v) {\n                settingsObj.thickness = parseFloat(v);\n                updatePreview();\n            },\n        });\n\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\n        const colorOptionsArr = [\n            {r: 0, g: 0, b: 0, a: 1},\n            {r: 255, g: 255, b: 255, a: 1},\n        ];\n        colorOptionsArr.push({\n            r: params.currentColorRgb.r,\n            g: params.currentColorRgb.g,\n            b: params.currentColorRgb.b,\n            a: 1,\n        });\n        colorOptionsArr.push({\n            r: params.secondaryColorRgb.r,\n            g: params.secondaryColorRgb.g,\n            b: params.secondaryColorRgb.b,\n            a: 1,\n        });\n        settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\n\n        const colorOptions = new ColorOptions({\n            label: LANG('shape-stroke'),\n            colorArr: colorOptionsArr,\n            onChange: function (rgbaObj) {\n                selectedRgbaObj = rgbaObj!;\n                settingsObj.color = BB.ColorConverter.toRgbStr(selectedRgbaObj);\n                updatePreview();\n            },\n        });\n\n        const labelStyle = {\n            display: 'inline-block',\n            marginRight: '5px',\n        };\n        line1.append(\n            BB.el({content: 'X:', css: labelStyle}),\n            xInput,\n            BB.el({content: 'Y:', css: labelStyle}),\n            yInput,\n        );\n        line2.append(\n            BB.el({content: LANG('shape-line-width') + ':', css: labelStyle}),\n            thicknessInput,\n            BB.el({css:{flexGrow: '1'}}),\n            colorOptions.getElement(),\n        );\n\n        const previewCanvas = BB.canvas(context.canvas.width, context.canvas.height);\n        const previewCtx = BB.ctx(previewCanvas);\n        const previewLayerArr = layers.map((item, i) => {\n            return {\n                image: i === selectedLayerIndex ? previewCanvas : item.context.canvas,\n                isVisible: item.isVisible,\n                opacity: item.opacity,\n                mixModeStr: item.mixModeStr,\n                hasClipping: false,\n            };\n        });\n\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n        });\n\n        preview.getElement().classList.add(css({\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        }));\n        rootEl.append(preview.getElement());\n\n        function updatePreview (): void {\n            const ctx = previewCtx;\n            ctx.save();\n            ctx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);\n            ctx.drawImage(context.canvas, 0, 0);\n            drawGrid(ctx, settingsObj.x, settingsObj.y, Math.max(settingsObj.thickness, 1), settingsObj.color, settingsObj.opacity);\n            ctx.restore();\n            preview.render();\n        }\n        updatePreview();\n        preview.render();\n\n\n        result.destroy = (): void => {\n            preview.destroy();\n            BB.freeCanvas(previewCanvas);\n            colorOptions.destroy();\n        };\n        result.getInput = function (): TFilterGridInput {\n            result.destroy!();\n            return BB.copyObj(settingsObj);\n        };\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterGridInput>): boolean {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        const history = params.history;\n        if (!context || !klCanvas || !history) {\n            return false;\n        }\n\n        history.pause(true);\n        drawGrid(\n            context,\n            params.input.x,\n            params.input.y,\n            params.input.thickness,\n            params.input.color,\n            params.input.opacity,\n        );\n        history.pause(false);\n\n        history.push({\n            tool: ['filter', 'grid'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterGridHistoryEntry);\n        return true;\n    },\n\n};","\n// ideas: padding, gutter, other shapes\n\nexport function drawGrid (\n    ctx: CanvasRenderingContext2D,\n    cellsX: number,\n    cellsY: number,\n    thickness: number, // px\n    color: string,\n    opacity: number, // 0 - 1\n): void {\n    ctx.save();\n    const w = ctx.canvas.width;\n    const h = ctx.canvas.height;\n    thickness = Math.round(thickness);\n    const thickIsRound = thickness % 2 === 0;\n\n    ctx.beginPath();\n    ctx.lineWidth = thickness;\n    ctx.strokeStyle = color;\n    ctx.globalAlpha = opacity;\n\n    for(let i = 0; i < cellsX - 1; i++) {\n        const cw = w / (cellsX);\n        let pos = cw * (i + 1);\n        if (thickIsRound) {\n            pos = Math.round(pos);\n        } else {\n            pos = Math.round(pos + 0.5) - 0.5;\n        }\n        ctx.moveTo(pos, 0);\n        ctx.lineTo(pos, h);\n\n    }\n    for(let i = 0; i < cellsY - 1; i++) {\n        const ch = h / (cellsY);\n        let pos = ch * (i + 1);\n        if (thickIsRound) {\n            pos = Math.round(pos);\n        } else {\n            pos = Math.round(pos + 0.5) - 0.5;\n        }\n\n        ctx.moveTo(0, pos);\n        ctx.lineTo(w, pos);\n    }\n\n    ctx.stroke();\n    ctx.restore();\n}","import {BB} from '../../bb/bb';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult, IRGB, TMixMode} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\nimport {Options} from '../ui/components/options';\nimport {eventResMs} from './filters-consts';\nimport {Select} from '../ui/components/select';\nimport {translateBlending} from '../canvas/translate-blending';\nimport {KL} from '../kl';\nimport {ColorConverter} from '../../bb/color/color';\nimport {Checkbox} from '../ui/components/checkbox';\nimport {TFxCanvas} from '../../fx-canvas/fx-canvas-types';\nimport {TKlCanvasHistoryEntry} from '../canvas/kl-canvas';\nimport {throwIfNull} from '../../bb/base/base';\nimport {FxPreviewRenderer} from '../ui/project-viewport/fx-preview-renderer';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {css} from '@emotion/css/dist/emotion-css.cjs';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {getPreviewHeight, getPreviewWidth} from '../ui/utils/preview-size';\nimport {testIsSmall} from '../ui/utils/test-is-small';\n\n// see noise(...) in fx-canvas\ninterface INoisePreset {\n    type: number;\n    scaleX: number;\n    scaleY: number;\n    offsetX: number;\n    offsetY: number;\n    octaves: number;\n    samples: number;\n    peaks: number;\n    brightness: number;\n    contrast: number;\n    isReversed: boolean;\n}\n\ntype TNoiseChannels = 'rgb' | 'alpha';\n\ninterface INoiseSettings extends INoisePreset {\n    seed?: number;\n    colA?: IRGB;\n    colB?: IRGB;\n    channels?: TNoiseChannels; // default rgb\n}\n\nexport type TFilterNoiseInput = {\n    seed: number;\n    presetIndex: number; // which preset from presetArr\n    scale: number; // applies to both scaleX and scaleX\n    opacity: number; // aka strength\n    isReversed: boolean; // reverse direction of color gradient\n    channels: TNoiseChannels;\n\n    // only for channels = rgb\n    mixModeStr: GlobalCompositeOperation; // how mixed with image\n    colA: IRGB;\n    colB: IRGB;\n}\n\nconst presetArr: INoisePreset[] = [\n    // each pixel random value\n    {type: 0, scaleX: 1, scaleY: 1, offsetX: 0, offsetY: 0, octaves: 1, samples: 1, peaks: 0, brightness: 0, contrast: 0, isReversed: true},\n\n    // cloud\n    {type: 1, scaleX: 166, scaleY: 164, offsetX: 105, offsetY: 30, octaves: 6, samples: 1, peaks: 0, brightness: 0.055, contrast: 0.23, isReversed: true},\n\n    // thin lines\n    {type: 1, scaleX: 235, scaleY: 190, offsetX: 3227, offsetY: 2156, octaves: 4, samples: 16, peaks: 22, brightness: -0.375, contrast: 1, isReversed: false},\n\n    // soft large simplex, only 1 octave\n    {type: 1, scaleX: 40, scaleY: 40, offsetX: 0, offsetY: 0, octaves: 1, samples: 1, peaks: 0, brightness: 0, contrast: 0, isReversed: false},\n\n    // two value large pixels\n    {type: 0, scaleX: 26, scaleY: 26, offsetX: 557, offsetY: 365, octaves: 1, samples: 1, peaks: 0, brightness: 0.02, contrast: 1, isReversed: true},\n\n    // zebra\n    {type: 1, scaleX: 1500, scaleY: 1500, offsetX: 745, offsetY: 2871, octaves: 5, samples: 16, peaks: 156.02, brightness: 0.03, contrast: 1, isReversed: true},\n\n    // sparse dots / stars\n    {type: 1, scaleX: 11, scaleY: 11, offsetX: 2940, offsetY: 2045, octaves: 1, samples: 16, peaks: 1, brightness: -0.045, contrast: 1, isReversed: true},\n\n    // pseudo marble\n    {type: 2, scaleX: 74, scaleY: 74, offsetX: 4816, offsetY: 1304, octaves: 3, samples: 1, peaks: 2.78, brightness: 0, contrast: 0, isReversed: false},\n];\n\nfunction drawNoise (fxCanvas: TFxCanvas, settings: INoiseSettings): void {\n    fxCanvas.noise(\n        settings.seed,\n        settings.type,\n        [settings.scaleX, settings.scaleY],\n        [fxCanvas.width / 2, fxCanvas.height / 2],\n        settings.octaves,\n        settings.samples,\n        settings.peaks,\n        settings.brightness,\n        settings.contrast,\n        settings.isReversed,\n        settings.colA,\n        settings.colB,\n        settings.channels ? settings.channels : 'rgb',\n    ).update();\n}\n\n\nexport const filterNoise = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\n\n        const thumbImgArr: HTMLImageElement[] = [];\n        const thumbSize = 32;\n        {\n            const fxCanvas = throwIfNull(getSharedFx());\n            const canvas = BB.canvas(thumbSize, thumbSize);\n            const ctx = BB.ctx(canvas);\n            const texture = fxCanvas.texture(canvas);\n            fxCanvas.draw(texture).update(); // update fxCanvas size\n            texture.destroy();\n\n            presetArr.forEach((preset) => {\n                const thumbImg = new Image();\n                const presetCopy = BB.copyObj(preset) as INoiseSettings;\n                presetCopy.scaleX /= 10;\n                presetCopy.scaleY /= 10;\n                drawNoise(fxCanvas, presetCopy);\n                ctx.drawImage(fxCanvas, 0, 0);\n                thumbImg.src = canvas.toDataURL('image/png');\n                thumbImgArr.push(thumbImg);\n            });\n\n            texture.destroy();\n        }\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterNoiseInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        const settingsObj: TFilterNoiseInput = {\n            seed: Math.random() * 300,\n            presetIndex: 0,\n            scale: 50,\n            opacity: 0.5,\n            isReversed: false,\n            channels: 'rgb',\n            mixModeStr: 'source-over' as GlobalCompositeOperation,\n            colA: {r: 0, g: 0, b: 0},\n            colB: {r: 255, g: 255, b: 255},\n        };\n\n        const presetOptions = new Options({\n            optionArr: thumbImgArr.map((img, index) => {\n                BB.css(img, {\n                    margin: '1px',\n                    borderRadius: '3px',\n                    transition: 'all 0.1s ease-in-out',\n                });\n                return {\n                    id: '' + index,\n                    label: img,\n                };\n            }),\n            initId: '0',\n            onChange: (id) => {\n                settingsObj.presetIndex = Number(id);\n                update();\n            },\n        });\n        presetOptions.getElement().style.marginBottom = '10px';\n        rootEl.append(presetOptions.getElement());\n\n        const scaleSlider = new KlSlider({\n            label: LANG('filter-noise-scale'),\n            width: 300,\n            height: 30,\n            min: 1,\n            max: 1000,\n            value: settingsObj.scale,\n            eventResMs: eventResMs,\n            curve: BB.quadraticSplineInput(1, 1000, 0.1),\n            onChange: (value) => {\n                settingsObj.scale = value;\n                update();\n            },\n        });\n        scaleSlider.getElement().style.marginBottom = '10px';\n\n        const opacitySlider = new KlSlider({\n            label: LANG('opacity'),\n            width: 300,\n            height: 30,\n            min: 1 / 100,\n            max: 1,\n            value: settingsObj.opacity,\n            eventResMs: eventResMs,\n            toValue: (displayValue) => displayValue / 100,\n            toDisplayValue: (value) => value * 100,\n            onChange: (value) => {\n                settingsObj.opacity = value;\n                update();\n            },\n        });\n        opacitySlider.getElement().style.marginBottom = '10px';\n\n        const row1El = BB.el({\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginBottom: '10px',\n            },\n        });\n\n        const row2El = BB.el({\n            css: {\n                display: 'flex',\n                marginBottom: '10px',\n            },\n        });\n\n        const channelsOptions = new Options<TNoiseChannels>({\n            optionArr: [\n                {id: 'rgb', label: 'RGB'},\n                {id: 'alpha', label: LANG('filter-noise-alpha')},\n            ],\n            initId: 'rgb',\n            onChange: (id: TNoiseChannels) => {\n                settingsObj.channels = id;\n                if (id === 'rgb') {\n                    row2El.style.visibility = '';\n                } else {\n                    row2El.style.visibility = 'hidden';\n                }\n                update();\n            },\n        });\n\n        const reverseToggle = new Checkbox({\n            label: LANG('reverse'),\n            callback: (val) => {\n                settingsObj.isReversed = val;\n                update();\n            },\n            allowTab: true,\n        });\n\n        const mixModes: (TMixMode | undefined)[] = [\n            'source-over',\n            undefined,\n            'darken',\n            'multiply',\n            'color-burn',\n            undefined,\n            'lighten',\n            'screen',\n            'color-dodge',\n            undefined,\n            'overlay',\n            'soft-light',\n            'hard-light',\n            undefined,\n            'difference',\n            'exclusion',\n            undefined,\n            'hue',\n            'saturation',\n            'color',\n            'luminosity',\n        ];\n\n        const blendSelect = new Select({\n            isFocusable: true,\n            optionArr: mixModes.map(item => {\n                return item ? ([item, translateBlending(item)] as [TMixMode, string]) : undefined;\n            }),\n            initValue: settingsObj.mixModeStr,\n            onChange: (val: GlobalCompositeOperation) => {\n                settingsObj.mixModeStr = val;\n                update();\n            },\n        });\n        blendSelect.getElement().title = LANG('layers-blending');\n\n        const colorWrapper = BB.el({\n            css: {\n                display: 'flex',\n            },\n        });\n\n        const colInputStyle = {\n            width: '34px',\n            height: '34px',\n            marginRight: '5px',\n        };\n        const colAInput = KL.input({\n            type: 'color',\n            init: '#' + ColorConverter.toHexString(settingsObj.colA),\n            callback: (val) => {\n                const newColor = ColorConverter.hexToRGB(val);\n                if (newColor) {\n                    settingsObj.colA = newColor;\n                    update();\n                }\n            },\n            css: colInputStyle,\n        });\n\n        const colBInput = KL.input({\n            type: 'color',\n            init: '#' + ColorConverter.toHexString(settingsObj.colB),\n            callback: (val) => {\n                const newColor = ColorConverter.hexToRGB(val);\n                if (newColor) {\n                    settingsObj.colB = newColor;\n                    update();\n                }\n            },\n            css: colInputStyle,\n        });\n\n        colorWrapper.append(\n            colAInput,\n            colBInput,\n        );\n\n\n        row1El.append(\n            channelsOptions.getElement(),\n            BB.el({css:{flexGrow: '1'}}),\n            reverseToggle.getElement(),\n        );\n\n        row2El.append(\n            blendSelect.getElement(),\n            BB.el({css:{flexGrow: '1'}}),\n            colorWrapper,\n        );\n\n        rootEl.append(\n            scaleSlider.getElement(),\n            opacitySlider.getElement(),\n            row1El,\n            row2El,\n        );\n\n\n\n\n        const fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas, transform) => {\n                const settingsCopy = BB.copyObj(presetArr[settingsObj.presetIndex]) as INoiseSettings;\n                settingsCopy.seed = settingsObj.seed;\n                settingsCopy.scaleX = settingsCopy.scaleX  * settingsObj.scale / 50 * transform.scaleX;\n                settingsCopy.scaleY = settingsCopy.scaleY  * settingsObj.scale / 50 * transform.scaleY;\n                settingsCopy.colA = settingsObj.colA;\n                settingsCopy.colB = settingsObj.colB;\n                settingsCopy.isReversed = settingsObj.isReversed ? !settingsCopy.isReversed : settingsCopy.isReversed;\n                settingsCopy.channels  = settingsObj.channels;\n                settingsCopy.offsetX = context.canvas.width / 2 * transform.scaleX + transform.x;\n                settingsCopy.offsetY = context.canvas.height / 2 * transform.scaleY + transform.y;\n\n                return fxCanvas.noise(\n                    settingsCopy.seed,\n                    settingsCopy.type,\n                    [settingsCopy.scaleX, settingsCopy.scaleY],\n                    [settingsCopy.offsetX, settingsCopy.offsetY],\n                    settingsCopy.octaves,\n                    settingsCopy.samples,\n                    settingsCopy.peaks,\n                    settingsCopy.brightness,\n                    settingsCopy.contrast,\n                    settingsCopy.isReversed,\n                    settingsCopy.colA,\n                    settingsCopy.colB,\n                    settingsCopy.channels ? settingsCopy.channels : 'rgb',\n                );\n            },\n            postMix: {\n                opacity: settingsObj.opacity,\n                operation: settingsObj.channels === 'alpha' ? 'destination-out' : settingsObj.mixModeStr,\n            },\n        });\n\n        const previewLayerArr: TProjectViewportProject['layers'] = [];\n        {\n            for (let i = 0; i < layers.length; i++) {\n                previewLayerArr.push({\n                    image: i === selectedLayerIndex ? fxPreviewRenderer.render : layers[i].context.canvas,\n                    isVisible: layers[i].isVisible,\n                    opacity: layers[i].opacity,\n                    mixModeStr: layers[i].mixModeStr,\n                    hasClipping: false,\n                });\n            }\n        }\n\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n        });\n        preview.render();\n        preview.getElement().classList.add(css({\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        }));\n        rootEl.append(preview.getElement());\n\n        function update (): void {\n            fxPreviewRenderer.setPostMix({\n                opacity: settingsObj.opacity,\n                operation: settingsObj.channels === 'alpha' ? 'destination-out' : settingsObj.mixModeStr,\n            });\n            preview.render();\n        }\n\n\n        result.destroy = (): void => {\n            presetOptions.destroy();\n            scaleSlider.destroy();\n            opacitySlider.destroy();\n            reverseToggle.destroy();\n            channelsOptions.destroy();\n            blendSelect.destroy();\n            preview.destroy();\n            fxPreviewRenderer.destroy();\n        };\n        result.getInput = function (): TFilterNoiseInput {\n            result.destroy!();\n            return BB.copyObj(settingsObj);\n        };\n\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterNoiseInput>): boolean {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        const history = params.history;\n        if (!context || !klCanvas || !history) {\n            return false;\n        }\n\n        history.pause(true);\n\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false; // todo more specific error?\n        }\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).update();\n        texture.destroy();\n\n        const input = params.input;\n\n        const presetCopy: INoiseSettings = BB.copyObj(presetArr[input.presetIndex]) as INoiseSettings;\n        presetCopy.seed = input.seed;\n        presetCopy.scaleX = presetCopy.scaleX  * input.scale / 50;\n        presetCopy.scaleY = presetCopy.scaleY  * input.scale / 50;\n        presetCopy.colA = input.colA;\n        presetCopy.colB = input.colB;\n        presetCopy.isReversed = input.isReversed ? !presetCopy.isReversed : presetCopy.isReversed;\n        presetCopy.channels  = input.channels;\n        drawNoise(fxCanvas, presetCopy);\n\n        context.save();\n        context.globalAlpha = input.opacity;\n        if (input.channels === 'alpha') {\n            context.globalCompositeOperation = 'destination-out';\n        } else {\n            context.globalCompositeOperation = input.mixModeStr;\n        }\n        context.drawImage(fxCanvas, 0, 0);\n        context.restore();\n\n        history.pause(false);\n\n        history.push({\n            tool: ['canvas'],\n            action: 'replaceLayer',\n            params: [\n                klCanvas.getLayerIndex(context.canvas),\n                context.getImageData(0, 0, context.canvas.width, context.canvas.height),\n            ],\n        } as TKlCanvasHistoryEntry);\n        return true;\n    },\n\n};","import {BB} from '../../bb/bb';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult, IKlBasicLayer} from '../kl-types';\nimport {input} from '../ui/components/input';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport {LANG} from '../../language/language';\nimport {eventResMs} from './filters-consts';\nimport {KlCanvasPreview} from '../canvas-ui/canvas-preview';\nimport {TwoTabs} from '../ui/components/two-tabs';\nimport {IVector2D} from '../../bb/bb-types';\nimport {TFilterHistoryEntry} from './filters';\nimport {throwIfNull} from '../../bb/base/base';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth, mediumPreview} from '../ui/utils/preview-size';\n\n\nexport type TFilterPatternInput = {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    blend: number; // [0, 1] - 1 will blend linearly across whole length\n    offsetX: number;\n    offsetY: number;\n};\n\nexport type TFilterPatternHistoryEntry = TFilterHistoryEntry<\n    'pattern',\n    TFilterPatternInput>;\n\n/**\n * Draws pattern onto context. Pattern generated from context.\n * Can use blending for smoother transition. Will use area outside of bounds for blending.\n *\n * @param context\n * @param settings\n */\nfunction drawPattern (context: CanvasRenderingContext2D, settings: TFilterPatternInput): void {\n\n    // keep bounds in center via offset\n    // because blending done towards bottom right\n    const blendOffsetX = settings.blend ? Math.round(settings.blend * settings.width / 2) : 0;\n    const blendOffsetY = settings.blend ? Math.round(settings.blend * settings.height / 2) : 0;\n\n    const finalPatternCanvas = BB.canvas(settings.width, settings.height);\n\n    if (settings.blend) {\n        // construct pattern via linear blending\n\n        const blendCanvas = BB.canvas(settings.width * 2, settings.height * 2);\n        const blendCtx = BB.ctx(blendCanvas);\n        const colTransparent = '#0000';\n        const colOpaque = '#000';\n\n        // transfer source to blendCanvas\n        blendCtx.drawImage(\n            context.canvas,\n            -settings.x + blendOffsetX,\n            -settings.y + blendOffsetY,\n        );\n\n        // --- 1 cross-fade vertical ------------------------\n\n        // erase vertical gradient bottom half\n        blendCtx.save();\n        let blendGradient = blendCtx.createLinearGradient(0, settings.height, 0, settings.height * 2);\n        blendGradient.addColorStop(0, colOpaque);\n        blendGradient.addColorStop(settings.blend, colTransparent);\n        blendCtx.globalCompositeOperation = 'destination-in';\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\n        blendCtx.restore();\n\n        // erase vertical gradient top half\n        blendCtx.save();\n        blendGradient = blendCtx.createLinearGradient(0, 0, 0, settings.height);\n        blendGradient.addColorStop(0, colTransparent);\n        blendGradient.addColorStop(settings.blend, colOpaque);\n        blendCtx.globalCompositeOperation = 'destination-in';\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\n        blendCtx.restore();\n\n        // draw bottom half over top half\n        blendCtx.save();\n        // lighter needed for accurate cross-fade\n        blendCtx.globalCompositeOperation = 'lighter';\n        blendCtx.drawImage(blendCanvas, 0, -settings.height);\n        blendCtx.restore();\n\n\n\n        // --- 2 cross-fade horizontal ------------------------\n\n        // erase horizontal gradient right half\n        blendCtx.save();\n        blendGradient = blendCtx.createLinearGradient(settings.width, 0, settings.width * 2, 0);\n        blendGradient.addColorStop(0, colOpaque);\n        blendGradient.addColorStop(settings.blend, colTransparent);\n        blendCtx.globalCompositeOperation = 'destination-in';\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, blendCanvas.width, blendCanvas.height);\n        blendCtx.restore();\n\n        // erase horizontal gradient left half\n        blendCtx.save();\n        blendGradient = blendCtx.createLinearGradient(0, 0, settings.width, 0);\n        blendGradient.addColorStop(0, colTransparent);\n        blendGradient.addColorStop(settings.blend, colOpaque);\n        blendCtx.globalCompositeOperation = 'destination-in';\n        blendCtx.fillStyle = blendGradient;\n        blendCtx.fillRect(0, 0, settings.width * 2, settings.height * 2);\n        blendCtx.restore();\n\n        // draw right half over left half\n        blendCtx.save();\n        // lighter needed for accurate cross-fade\n        blendCtx.globalCompositeOperation = 'lighter';\n        blendCtx.drawImage(blendCanvas, -settings.width, 0);\n        blendCtx.restore();\n\n        // transfer to pattern canvas\n        BB.ctx(finalPatternCanvas).drawImage(blendCanvas, 0, 0);\n\n    } else {\n        BB.ctx(finalPatternCanvas).drawImage(\n            context.canvas,\n            -settings.x,\n            -settings.y,\n        );\n    }\n\n    context.save();\n\n    context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n    context.translate(settings.offsetX - blendOffsetX, settings.offsetY - blendOffsetY);\n    context.fillStyle = throwIfNull(context.createPattern(finalPatternCanvas, 'repeat'));\n    context.fillRect(-settings.offsetX + blendOffsetX, -settings.offsetY + blendOffsetY, context.canvas.width, context.canvas.height);\n\n    context.restore();\n}\n\n\nexport const filterPattern = {\n\n    getDialog (params: IFilterGetDialogParam) {\n\n        const isSmall = testIsSmall();\n        const maxSize = 1024;\n        const rootEl = BB.el();\n        const context = params.context;\n        const width = context.canvas.width;\n        const height = context.canvas.height;\n\n        let settings: TFilterPatternInput = {\n            x: 0,\n            y: 0,\n            width: width <= 250 ? Math.round(width / 4) : 200,\n            height: height <= 250 ? Math.round(height / 4) : 200,\n            blend: 0,\n            offsetX: 0,\n            offsetY: 0,\n        };\n        let lastDrawnSettings: TFilterPatternInput | undefined;\n\n        // determine bounds\n        const bounds = BB.canvasBounds(context);\n        // adjust settings according to bounds\n        if ( // use layer bounds if:\n            bounds &&\n            (bounds.width <= maxSize && bounds.height <= maxSize) && // don't exceed max size\n            (bounds.width < width * 0.75 || bounds.height < height * 0.75) // aren't too large (heuristic)\n        ) {\n            settings.x = bounds.x;\n            settings.y = bounds.y;\n            settings.width = bounds.width;\n            settings.height = bounds.height;\n        } else { // otherwise use default size in center\n            settings.x = Math.round(width / 2 - settings.width / 2);\n            settings.y = Math.round(height / 2 - settings.height / 2);\n        }\n\n        // ---- controls ----\n\n        const xInput = input({\n            init: settings.x,\n            type: 'number',\n            min: 0,\n            max: width,\n            css: {width: '100%'},\n            callback: function (v) {\n                settings.x = Number(v);\n                updatePreview();\n            },\n        });\n        const yInput = input({\n            init: settings.y,\n            type: 'number',\n            min: 0,\n            max: height,\n            css: {width: '100%'},\n            callback: function (v) {\n                settings.y = Number(v);\n                updatePreview();\n            },\n        });\n        const widthInput = input({\n            init: settings.width,\n            type: 'number',\n            min: 1,\n            max: Math.min(maxSize, width),\n            css: {width: '100%'},\n            callback: function (v) {\n                settings.width = Number(v);\n                updatePreview();\n            },\n        });\n        const heightInput = input({\n            init: settings.height,\n            type: 'number',\n            min: 1,\n            max: Math.min(maxSize, height),\n            css: {width: '100%'},\n            callback: function (v) {\n                settings.height = Number(v);\n                updatePreview();\n            },\n        });\n\n        const inputStyle = {\n            marginLeft: '5px',\n            flex: '1',\n        };\n        rootEl.append(\n            BB.el({\n               content: [\n\n                   BB.el({\n                       tagName: 'label',\n                       content: [\n                           'X:',\n                           xInput,\n                       ],\n                       css: inputStyle,\n                   }),\n\n                   BB.el({\n                       tagName: 'label',\n                       content: [\n                           'Y:',\n                           yInput,\n                       ],\n                       css: inputStyle,\n                   }),\n\n                   BB.el({\n                       tagName: 'label',\n                       content: [\n                           LANG('width') + ':',\n                           widthInput,\n                       ],\n                       css: inputStyle,\n                   }),\n\n                   BB.el({\n                       tagName: 'label',\n                       content: [\n                           LANG('height') + ':',\n                           heightInput,\n                       ],\n                       css: inputStyle,\n                   }),\n               ],\n               css: {\n                   display: 'flex',\n                   marginLeft: '-5px',\n               },\n            }),\n        );\n\n\n        const blendSlider = new KlSlider({\n            label: LANG('brush-blending'),\n            width: 300,\n            height: 30,\n            min: 0,\n            max: 1,\n            value: settings.blend,\n            eventResMs: eventResMs,\n            onChange: function (val) {\n                settings.blend = val;\n                updatePreview();\n            },\n            formatFunc: (val) => {\n                return BB.round(val, 2);\n            },\n            manualInputRoundDigits: 2,\n        });\n        BB.css(blendSlider.getElement(), {\n            margin: '10px 0',\n        });\n\n        rootEl.append(\n            blendSlider.getElement(),\n        );\n\n        // ---- preview tabs ----\n        let previewMode = 1; // 0 before, 1 after\n        const beforeAfterTabs = new TwoTabs({\n            left: LANG('compare-before'),\n            right: LANG('compare-after'),\n            init: previewMode,\n            onChange: (val) => {\n                previewMode = val;\n                overlayCanvas.style.display = val === 0 ? 'block' : 'none';\n                updatePreview(true);\n            },\n        });\n        rootEl.append(beforeAfterTabs.getElement());\n\n        // ---- previews ----\n\n        const klCanvas = params.klCanvas;\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\n\n        const fit = BB.fitInto(context.canvas.width, context.canvas.height, isSmall ? 280 : 490, isSmall ? 200 : 240, 1);\n        const w = parseInt('' + fit.width), h = parseInt('' + fit.height);\n        const renderW = Math.min(w, context.canvas.width);\n        const renderH = Math.min(h, context.canvas.height);\n        // const renderFactor = renderW / context.canvas.width;\n        const previewFactor = w / context.canvas.width;\n\n        const previewWrapper = BB.el({\n            className: 'kl-preview-wrapper',\n            css: {\n                width: getPreviewWidth(isSmall) + 'px',\n                height: getPreviewHeight(isSmall) + 'px',\n                marginTop: '0',\n            },\n        });\n\n        const previewLayer: IKlBasicLayer = {\n            image: BB.canvas(renderW, renderH),\n            isVisible: layers[selectedLayerIndex].isVisible,\n            opacity: layers[selectedLayerIndex].opacity,\n            mixModeStr: layers[selectedLayerIndex].mixModeStr,\n        };\n        const previewLayerArr = layers.map((item, i) => {\n            if (i === selectedLayerIndex) {\n                return previewLayer;\n            } else {\n                return {\n                    image: item.context.canvas,\n                    isVisible: item.isVisible,\n                    opacity: item.opacity,\n                    mixModeStr: item.mixModeStr,\n                };\n            }\n        });\n        const klCanvasPreview = new KlCanvasPreview({\n            width: Math.round(w),\n            height: Math.round(h),\n            layers: previewLayerArr,\n        });\n\n        const overlayCanvas = BB.canvas(w, h);\n        BB.css(overlayCanvas, {\n            position: 'absolute',\n            left: '0',\n            top: '0',\n            mixBlendMode: 'difference',\n            imageRendering: 'pixelated',\n        });\n\n        const previewInnerWrapper = BB.el({\n            className: 'kl-preview-wrapper__canvas',\n            css: {\n                width: parseInt('' + w) + 'px',\n                height: parseInt('' + h) + 'px',\n            },\n        });\n        previewInnerWrapper.append(\n            klCanvasPreview.getElement(),\n            overlayCanvas\n        );\n        previewWrapper.append(previewInnerWrapper);\n        rootEl.append(previewWrapper);\n\n\n        // ---- preview input processing ----\n        const inputs = {} as {\n            start: IVector2D;\n            end: IVector2D | null;\n            oldSettings: TFilterPatternInput;\n            state: null | 'move' | 'select';\n        };\n\n        function syncInputs (): void {\n            xInput.value = '' + settings.x;\n            yInput.value = '' + settings.y;\n            widthInput.value = '' + settings.width;\n            heightInput.value = '' + settings.height;\n        }\n\n        const keyListener = new BB.KeyListener({\n        });\n\n        previewWrapper.oncontextmenu = function () {\n            return false;\n        };\n        previewInnerWrapper.style.touchAction = 'none';\n        const pointerListener = new BB.PointerListener({\n            target: previewInnerWrapper,\n            onPointer: (event) => {\n                if (previewMode === 0) {\n                    if (event.type === 'pointerdown') {\n                        if (!inputs.state) {\n                            inputs.oldSettings = BB.copyObj(settings);\n\n                            const x = event.relX / previewFactor;\n                            const y = event.relY / previewFactor;\n\n                            if (BB.isInsideRect(\n                                {x, y},\n                                {x: settings.x, y: settings.y, width: settings.width, height: settings.height},\n                            )) {\n                                inputs.state = 'move';\n                            } else {\n                                inputs.state = 'select';\n                            }\n                            inputs.start = {x, y};\n                        }\n                    } else if (event.type === 'pointermove') {\n\n                        const x = event.relX / previewFactor;\n                        const y = event.relY / previewFactor;\n\n                        if (inputs.state === 'select') {\n                            inputs.end = {x, y};\n\n                            const x1 = Math.max(0, Math.min(inputs.start.x, inputs.end.x));\n                            const y1 = Math.max(0, Math.min(inputs.start.y, inputs.end.y));\n                            const x2 = Math.min(width, Math.max(inputs.start.x, inputs.end.x));\n                            const y2 = Math.min(height, Math.max(inputs.start.y, inputs.end.y));\n\n                            settings.x = Math.floor(x1);\n                            settings.y = Math.floor(y1);\n                            settings.width = Math.min(maxSize, Math.ceil(x2 - settings.x));\n                            settings.height = Math.min(maxSize, Math.ceil(y2 - settings.y));\n\n                            if (keyListener.isPressed('shift')) {\n                                settings.width = Math.min(settings.width, settings.height);\n                                settings.height = Math.min(settings.width, settings.height);\n                            }\n\n                            if (settings.width === 0 || settings.height === 0) {\n                                settings = BB.copyObj(inputs.oldSettings);\n                            }\n\n                            syncInputs();\n                            updatePreview();\n                        } else if (inputs.state === 'move') {\n                            const dX = Math.round(x - inputs.start.x);\n                            const dY = Math.round(y - inputs.start.y);\n\n                            settings.x = BB.clamp(inputs.oldSettings.x + dX, 0, width - settings.width);\n                            settings.y = BB.clamp(inputs.oldSettings.y + dY, 0, height - settings.height);\n\n                            syncInputs();\n                            updatePreview();\n                        }\n                    } else if (event.type === 'pointerup') {\n                        if (inputs.state) {\n                            inputs.state = null;\n                        }\n                    }\n                } else {\n                    if (event.type === 'pointerdown') {\n                        if (!inputs.state) {\n                            inputs.state = 'move';\n                            inputs.oldSettings = BB.copyObj(settings);\n                            inputs.start = {x: event.relX / previewFactor, y: event.relY / previewFactor};\n                            inputs.end = null;\n                        }\n                    } else if (event.type === 'pointermove') {\n                        if (inputs.state) {\n                            inputs.end = {x: event.relX / previewFactor, y: event.relY / previewFactor};\n\n                            settings.offsetX = Math.round(inputs.end.x - inputs.start.x) + inputs.oldSettings.offsetX;\n                            settings.offsetY = Math.round(inputs.end.y - inputs.start.y) + inputs.oldSettings.offsetY;\n\n                            updatePreview();\n                        }\n                    } else if (event.type === 'pointerup') {\n                        if (inputs.state) {\n                            if (!inputs.end) {\n                                settings.offsetX = 0;\n                                settings.offsetY = 0;\n                                updatePreview();\n                            }\n                            inputs.state = null;\n                        }\n                    }\n                }\n            },\n        });\n\n        // ---------- rendering ---------------------\n        const fullSizeCanvas = BB.canvas(width, height);\n        const fullSizeCtx = BB.ctx(fullSizeCanvas);\n\n        function sharpStrokeRect (\n            context: CanvasRenderingContext2D,\n            x: number,\n            y: number,\n            width: number,\n            height: number\n        ): void {\n            const drawX = Math.round(x + 0.5) - 0.5;\n            const drawY = Math.round(y + 0.5) - 0.5;\n            const drawWidth = Math.round(x + width - drawX);\n            const drawHeight = Math.round(y + height - drawY);\n            context.strokeRect(drawX, drawY, drawWidth, drawHeight);\n        }\n\n        function updatePreview (doForce?: boolean) {\n            if (!doForce && lastDrawnSettings && JSON.stringify(lastDrawnSettings) === JSON.stringify(settings)) {\n                return;\n            }\n\n            if (previewMode === 0) { // before\n                fullSizeCtx.clearRect(0, 0, width, height);\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\n\n                const previewCanvas = previewLayer.image as HTMLCanvasElement;\n                const previewCtx = BB.ctx(previewCanvas);\n                previewCtx.save();\n                previewCtx.clearRect(0, 0, renderW, renderH);\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\n                previewCtx.restore();\n\n                const pW = settings.width * previewFactor;\n                const pH = settings.height * previewFactor;\n\n                const overlayCtx = BB.ctx(overlayCanvas);\n                overlayCtx.save();\n                overlayCtx.clearRect(0, 0, w, h);\n                overlayCtx.strokeStyle = '#fff';\n                sharpStrokeRect(\n                    overlayCtx,\n                    settings.x * previewFactor,\n                    settings.y * previewFactor,\n                    pW,\n                    pH\n                );\n                if (settings.blend > 0.05) {\n                    overlayCtx.strokeStyle = '#f0f';\n                    sharpStrokeRect(\n                        overlayCtx,\n                        settings.x * previewFactor - pW / 2 * settings.blend,\n                        settings.y * previewFactor - pH / 2 * settings.blend,\n                        pW * (1 + settings.blend),\n                        pH * (1 + settings.blend),\n                    );\n                }\n                overlayCtx.restore();\n\n\n\n            } else { // after\n                fullSizeCtx.clearRect(0, 0, width, height);\n                fullSizeCtx.drawImage(context.canvas, 0, 0);\n                drawPattern(fullSizeCtx, settings);\n\n                const previewCanvas = previewLayer.image as HTMLCanvasElement;\n                const previewCtx = BB.ctx(previewCanvas);\n                previewCtx.clearRect(0, 0, renderW, renderH);\n                previewCtx.drawImage(fullSizeCanvas, 0, 0, renderW, renderH);\n            }\n\n\n            klCanvasPreview.render();\n            lastDrawnSettings = BB.copyObj(settings);\n        }\n\n        updatePreview();\n\n\n        // ----- result -------------------\n        const destroy = () => {\n            blendSlider.destroy();\n            keyListener.destroy();\n            pointerListener.destroy();\n            klCanvasPreview.destroy();\n        };\n        const result: TFilterGetDialogResult<TFilterPatternInput> = {\n            element: rootEl,\n            destroy,\n            getInput: () => {\n                destroy();\n                return BB.copyObj(settings);\n            },\n        };\n        if (!isSmall) {\n            result.width = mediumPreview.width;\n        }\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterPatternInput>): boolean {\n        const klCanvas = params.klCanvas;\n        const ctx = params.context;\n        const history = params.history;\n        if (!klCanvas || !history) {\n            return false;\n        }\n        history.pause(true);\n\n        drawPattern(ctx, params.input);\n\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'pattern'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterPatternHistoryEntry);\n        return true;\n    },\n\n};","import {BB} from '../../bb/bb';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult} from '../kl-types';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport {LANG} from '../../language/language';\nimport {eventResMs} from './filters-consts';\nimport {getSharedFx} from '../../fx-canvas/shared-fx';\nimport {Options} from '../ui/components/options';\nimport {Checkbox} from '../ui/components/checkbox';\nimport {TFilterHistoryEntry} from './filters';\nimport {throwIfNull} from '../../bb/base/base';\nimport {TFilterDistortSettings} from '../../fx-canvas/filters/distort';\nimport {FxPreviewRenderer} from '../ui/project-viewport/fx-preview-renderer';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {css} from '@emotion/css/dist/emotion-css.cjs';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth, mediumPreview} from '../ui/utils/preview-size';\n\n\n// see fx-canvas distort\nexport type TFilterDistortInput = {\n    stepSize: number; // [0, inf]\n    distortType: 0 | 1 | 2;\n    scale: { x: number; y: number };\n    strength: { x: number; y: number };\n    phase: { x: number; y: number };\n    offset: { x: number; y: number };\n};\n\nexport type TFilterDistortHistoryEntry = TFilterHistoryEntry<\n    'distort',\n    TFilterDistortInput>;\n\nexport const filterDistort = {\n\n    getDialog (params: IFilterGetDialogParam) {\n\n        const isSmall = testIsSmall();\n        const rootEl = BB.el();\n        const context = params.context;\n\n        let isSynced = true;\n        const settings: TFilterDistortInput = {\n            stepSize: 1,\n            distortType: 0,\n            scale: {x: 100, y: 100},\n            strength: {x: 20, y: 20},\n            phase: {x: 0, y: 0},\n            offset: {x: 0, y: 0},\n        };\n        // let lastDrawnSettings = null;\n\n        // ---- thumb -------\n        const thumbImgArr: HTMLImageElement[] = [];\n        const thumbSize = 32;\n        {\n            const canvas = BB.canvas(thumbSize, thumbSize);\n            const ctx = BB.ctx(canvas);\n\n            ctx.beginPath();\n            ctx.arc(thumbSize / 2, thumbSize / 2, thumbSize / 2.5, 0, Math.PI * 2);\n            ctx.fill();\n\n            let gradient = ctx.createLinearGradient(0, 0, thumbSize, thumbSize);\n            gradient.addColorStop(0, '#00f');\n            gradient.addColorStop(0.5, '#f00');\n            gradient.addColorStop(1, '#fff');\n            ctx.fillStyle = gradient;\n            ctx.globalCompositeOperation = 'source-atop';\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\n\n            gradient = ctx.createLinearGradient(thumbSize, 0, 0, thumbSize);\n            gradient.addColorStop(0, '#000');\n            gradient.addColorStop(1, '#000');\n            ctx.fillStyle = gradient;\n            ctx.globalCompositeOperation = 'destination-atop';\n            ctx.fillRect(0, 0, thumbSize, thumbSize);\n\n            const fxCanvas = throwIfNull(getSharedFx());\n            const texture = fxCanvas.texture(canvas);\n            fxCanvas.draw(texture).update(); // update fxCanvas size\n\n            const scaleFactor = 20;\n\n            ([0, 1, 2] as const).forEach(item => {\n                const thumbImg = new Image();\n                const settingsCopy: TFilterDistortSettings = BB.copyObj(settings);\n                settingsCopy.distortType = item;\n                settingsCopy.scale.x /= scaleFactor;\n                settingsCopy.scale.y /= scaleFactor;\n                settingsCopy.strength.x /= scaleFactor;\n                settingsCopy.strength.y /= scaleFactor;\n                fxCanvas.draw(texture).multiplyAlpha().distort(settingsCopy).unmultiplyAlpha().update();\n                ctx.clearRect(0, 0, thumbSize, thumbSize);\n                ctx.drawImage(fxCanvas, 0, 0);\n                thumbImg.src = canvas.toDataURL('image/png');\n                thumbImgArr.push(thumbImg);\n            });\n\n            texture.destroy();\n        }\n\n\n        // ---- controls ----\n\n        const topRowEl = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n            },\n        });\n\n        const typeOptions = new Options({\n            optionArr: thumbImgArr.map((img, index) => {\n                BB.css(img, {\n                    margin: '1px',\n                    borderRadius: '3px',\n                    transition: 'all 0.1s ease-in-out',\n                });\n                return {\n                    id: '' + index,\n                    label: img,\n                };\n            }),\n            initId: '0',\n            onChange: (id) => {\n                settings.distortType = Number(id) as TFilterDistortSettings['distortType'];\n                preview.render();\n            },\n        });\n\n        function sync (from: 'x' | 'y') {\n            if (from === 'x') {\n                settings.scale.y = (settings.scale.x);\n                settings.strength.y = (settings.strength.x);\n                settings.phase.y = (settings.phase.x);\n\n                sliderArr[3].setValue(settings.scale.y);\n                sliderArr[4].setValue(settings.strength.y);\n                sliderArr[5].setValue(settings.phase.y);\n            } else {\n                settings.scale.x = (settings.scale.y);\n                settings.strength.x = (settings.strength.y);\n                settings.phase.x = (settings.phase.y);\n\n                sliderArr[0].setValue(settings.scale.x);\n                sliderArr[1].setValue(settings.strength.x);\n                sliderArr[2].setValue(settings.phase.x);\n            }\n            preview.render();\n        }\n\n        const syncToggle = new Checkbox({\n            init: true,\n            label: LANG('filter-distort-sync-xy'),\n            callback: (val) => {\n                isSynced = val;\n                if (isSynced) {\n                    sync('x');\n                }\n            },\n        });\n\n        topRowEl.append(\n            typeOptions.getElement(),\n            BB.el({css: {flexGrow: '1'}}),\n            syncToggle.getElement(),\n        );\n\n        const xyRowEl = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                flexWrap: 'wrap',\n            },\n        });\n        const leftCol = BB.el({\n            parent: xyRowEl,\n            css: {\n                marginRight: '10px',\n            },\n        });\n        const rightCol = BB.el({parent: xyRowEl});\n\n        const sliderWidth = isSmall ? 300 : 245;\n        const sliderArr: KlSlider[] = [];\n\n        (['x', 'y'] as const).forEach((item, index) => {\n            const targetEl = index === 0 ? leftCol : rightCol;\n\n            const scaleSlider = new KlSlider({\n                label: LANG('filter-noise-scale') + ' ' + item.toUpperCase(),\n                width: sliderWidth,\n                height: 30,\n                min: 1,\n                max: 1000,\n                curve: 'quadratic',\n                value: settings.scale[item],\n                eventResMs: eventResMs,\n                onChange: (val) => {\n                    settings.scale[item] = val;\n                    if (isSynced) {\n                        sync(item);\n                    } else {\n                        preview.render();\n                    }\n                },\n            });\n            scaleSlider.getElement().style.marginTop = '20px';\n            targetEl.append(scaleSlider.getElement());\n\n            const strengthSlider = new KlSlider({\n                label: LANG('filter-unsharp-mask-strength') + ' ' + item.toUpperCase(),\n                width: sliderWidth,\n                height: 30,\n                min: 0,\n                max: 200,\n                curve: 'quadratic',\n                value: settings.strength[item],\n                eventResMs: eventResMs,\n                onChange: (val) => {\n                    settings.strength[item] = val;\n                    if (isSynced) {\n                        sync(item);\n                    } else {\n                        preview.render();\n                    }\n                },\n            });\n            strengthSlider.getElement().style.marginTop = '10px';\n            targetEl.append(strengthSlider.getElement());\n\n            const phaseSlider = new KlSlider({\n                label: LANG('filter-distort-phase') + ' ' + item.toUpperCase(),\n                width: sliderWidth,\n                height: 30,\n                min: 0,\n                max: 1,\n                value: settings.phase[item],\n                manualInputRoundDigits: 2,\n                eventResMs: eventResMs,\n                formatFunc: (val) => BB.round(val, 2),\n                onChange: (val) => {\n                    settings.phase[item] = val;\n                    if (isSynced) {\n                        sync(item);\n                    } else {\n                        preview.render();\n                    }\n                },\n            });\n            phaseSlider.getElement().style.marginTop = '10px';\n            targetEl.append(phaseSlider.getElement());\n\n            sliderArr.push(scaleSlider);\n            sliderArr.push(strengthSlider);\n            sliderArr.push(phaseSlider);\n        });\n\n        const stepSlider = new KlSlider({\n            label: LANG('filter-distort-stepsize'),\n            width: 300,\n            height: 30,\n            min: 1,\n            max: 300,\n            curve: 'quadratic',\n            value: settings.stepSize,\n            eventResMs: eventResMs,\n            onChange: (val) => {\n                settings.stepSize = Math.round(val);\n                preview.render();\n            },\n        });\n\n        stepSlider.getElement().style.marginTop = '20px';\n        stepSlider.getElement().style.marginBottom = '10px';\n        rootEl.append(stepSlider.getElement());\n\n\n        // ---- preview ----\n\n        const klCanvas = params.klCanvas;\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\n\n\n        const fxPreviewRenderer = new FxPreviewRenderer({\n            original: context.canvas,\n            onUpdate: (fxCanvas, transform) => {\n                const scaledSettings = BB.copyObj(settings);\n                scaledSettings.stepSize *= transform.scaleX;\n                scaledSettings.strength.x *= transform.scaleX;\n                scaledSettings.strength.y *= transform.scaleY;\n                if (scaledSettings.distortType !== 2) {\n                    scaledSettings.scale.x *= transform.scaleX;\n                    scaledSettings.scale.y *= transform.scaleY;\n                }\n                scaledSettings.offset.x = -transform.x;\n                scaledSettings.offset.y = -transform.y;\n\n                return fxCanvas.multiplyAlpha().distort(scaledSettings).unmultiplyAlpha();\n            },\n        });\n\n        const previewLayerArr: TProjectViewportProject['layers'] = layers.map((item, i) => {\n            return {\n                image: i === selectedLayerIndex ? fxPreviewRenderer.render : item.context.canvas,\n                isVisible: item.isVisible,\n                opacity: item.opacity,\n                mixModeStr: item.mixModeStr,\n                hasClipping: false,\n            };\n        });\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n        });\n        preview.render();\n        preview.getElement().classList.add(css({\n            marginLeft: '-20px',\n            marginRight: '-20px',\n        }));\n        rootEl.append(preview.getElement());\n\n        const destroy = () => {\n            typeOptions.destroy();\n            sliderArr.forEach(item => item.destroy());\n            stepSlider.destroy();\n            syncToggle.destroy();\n            fxPreviewRenderer.destroy();\n            preview.destroy();\n        };\n\n        // ----- result -------------------\n        const result: TFilterGetDialogResult<TFilterDistortInput> = {\n            element: rootEl,\n            destroy,\n            getInput: () => {\n                destroy();\n                return BB.copyObj(settings);\n            },\n        };\n        if (!isSmall) {\n            result.width = mediumPreview.width;\n        }\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterDistortInput>): boolean {\n        const klCanvas = params.klCanvas;\n        const context = params.context;\n        const history = params.history;\n        if (!klCanvas || !history) {\n            return false;\n        }\n        history.pause(true);\n\n        const fxCanvas = getSharedFx();\n        if (!fxCanvas) {\n            return false; // todo more specific error?\n        }\n        const texture = fxCanvas.texture(context.canvas);\n        fxCanvas.draw(texture).multiplyAlpha().distort(params.input).unmultiplyAlpha().update();\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n        context.drawImage(fxCanvas, 0, 0);\n        texture.destroy();\n\n        history.pause(false);\n        history.push({\n            tool: ['filter', 'distort'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterDistortHistoryEntry);\n        return true;\n    },\n\n};","import {BB} from '../../bb/bb';\nimport {IFilterApply, IFilterGetDialogParam, TFilterGetDialogResult, IRGB} from '../kl-types';\nimport {LANG} from '../../language/language';\nimport {input} from '../ui/components/input';\nimport {ColorOptions} from '../ui/components/color-options';\nimport {drawVanishPoint} from '../image-operations/draw-vanish-point';\nimport {KlSlider} from '../ui/components/kl-slider';\nimport {eventResMs} from './filters-consts';\nimport {TFilterHistoryEntry} from './filters';\nimport {throwIfNull} from '../../bb/base/base';\nimport {Preview} from '../ui/project-viewport/preview';\nimport {TProjectViewportProject} from '../ui/project-viewport/project-viewport';\nimport {DraggableInput} from '../ui/components/draggable-input';\nimport {testIsSmall} from '../ui/utils/test-is-small';\nimport {getPreviewHeight, getPreviewWidth} from '../ui/utils/preview-size';\n\nexport type TFilterVanishPointInput = {\n    x: number;\n    y: number;\n    lines: number;\n    thickness: number;\n    color: IRGB;\n    opacity: number;\n};\n\nexport type TFilterVanishPointHistoryEntry = TFilterHistoryEntry<\n    'vanishPoint',\n    TFilterVanishPointInput>;\n\nexport const filterVanishPoint = {\n\n    getDialog (params: IFilterGetDialogParam) {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        if (!context || !klCanvas) {\n            return false;\n        }\n\n        const layers = klCanvas.getLayers();\n        const selectedLayerIndex = throwIfNull(klCanvas.getLayerIndex(context.canvas));\n\n        const previewCanvas = BB.canvas(context.canvas.width, context.canvas.height);\n        const previewCtx = BB.ctx(previewCanvas);\n\n        const rootEl = BB.el();\n        const result: TFilterGetDialogResult<TFilterVanishPointInput> = {\n            element: rootEl,\n        };\n        const isSmall = testIsSmall();\n        if (!isSmall) {\n            result.width = getPreviewWidth(isSmall);\n        }\n\n        const settingsObj: TFilterVanishPointInput = {\n            x: context.canvas.width / 2,\n            y: context.canvas.height / 2,\n            lines: 8,\n            thickness: 2,\n            color: {r: 0, g: 0, b: 0},\n            opacity: 1,\n        };\n\n        const linesSlider = new KlSlider({\n            label: LANG('filter-vanish-point-lines'),\n            width: 300,\n            height: 30,\n            min: 2,\n            max: 20,\n            value: settingsObj.lines,\n            curve: 'quadratic',\n            eventResMs: eventResMs,\n            onChange: function (val) {\n                settingsObj.lines = Math.round(val);\n                update();\n            },\n        });\n        linesSlider.getElement().style.marginBottom = '10px';\n        rootEl.append(linesSlider.getElement());\n\n        const line1 = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n            },\n        });\n        const line2 = BB.el({\n            parent: rootEl,\n            css: {\n                display: 'flex',\n                alignItems: 'center',\n                marginTop: '10px',\n                marginBottom: '10px',\n            },\n        });\n        const xInput = input({\n            init: settingsObj.x,\n            type: 'number',\n            css: {width: '75px', marginRight: '20px'},\n            callback: function (v) {\n                settingsObj.x = parseFloat(v);\n                dragInput.setValue({\n                    x: settingsObj.x,\n                    y: settingsObj.y,\n                });\n                update();\n            },\n        });\n        const yInput = input({\n            init: settingsObj.y,\n            type: 'number',\n            css: {width: '75px', marginRight: '20px'},\n            callback: function (v) {\n                settingsObj.y = parseFloat(v);\n                dragInput.setValue({\n                    x: settingsObj.x,\n                    y: settingsObj.y,\n                });\n                update();\n            },\n        });\n        const thicknessInput = input({\n            init: 2,\n            type: 'number',\n            min: 1,\n            css: {width: '75px', marginRight: '20px'},\n            callback: function (v) {\n                settingsObj.thickness = parseFloat(v);\n                update();\n            },\n        });\n\n        let selectedRgbaObj = {r: 0, g: 0, b: 0, a: 1};\n        const colorOptionsArr = [\n            {r: 0, g: 0, b: 0, a: 1},\n            {r: 255, g: 255, b: 255, a: 1},\n        ];\n        colorOptionsArr.push({\n            r: params.currentColorRgb.r,\n            g: params.currentColorRgb.g,\n            b: params.currentColorRgb.b,\n            a: 1,\n        });\n        colorOptionsArr.push({\n            r: params.secondaryColorRgb.r,\n            g: params.secondaryColorRgb.g,\n            b: params.secondaryColorRgb.b,\n            a: 1,\n        });\n        settingsObj.color = BB.copyObj(selectedRgbaObj);\n\n        const colorOptions = new ColorOptions({\n            label: LANG('shape-stroke'),\n            colorArr: colorOptionsArr,\n            onChange: function (rgbaObj) {\n                selectedRgbaObj = rgbaObj!;\n                settingsObj.color = BB.copyObj(selectedRgbaObj);\n                update();\n            },\n        });\n\n        const labelStyle = {\n            display: 'inline-block',\n            marginRight: '5px',\n        };\n        line1.append(\n            BB.el({content: 'X:', css: labelStyle}),\n            xInput,\n            BB.el({content: 'Y:', css: labelStyle}),\n            yInput,\n        );\n        line2.append(\n            BB.el({content: LANG('shape-line-width') + ':', css: labelStyle}),\n            thicknessInput,\n            BB.el({css:{flexGrow: '1'}}),\n            colorOptions.getElement(),\n        );\n\n        // ---- preview input processing ----\n        function syncInputs (): void {\n            xInput.value = '' + settingsObj.x;\n            yInput.value = '' + settingsObj.y;\n        }\n\n        function update (): void {\n            const ctx = previewCtx;\n            const w = previewCanvas.width;\n            const h = previewCanvas.height;\n\n            ctx.save();\n            ctx.clearRect(0, 0, w, h);\n            ctx.drawImage(context.canvas, 0, 0, w, h);\n            drawVanishPoint(\n                ctx,\n                settingsObj.x,\n                settingsObj.y,\n                settingsObj.lines,\n                Math.max(settingsObj.thickness, 1),\n                settingsObj.color,\n                settingsObj.opacity,\n            );\n\n            ctx.restore();\n            preview.render();\n        }\n\n        const onRender = () => {\n            dragInput.setTransform(preview.getTransform());\n            return previewCanvas;\n        };\n\n        const previewLayerArr: TProjectViewportProject['layers'] = [];\n        {\n            for (let i = 0; i < layers.length; i++) {\n                previewLayerArr.push({\n                    image: i === selectedLayerIndex ? onRender : layers[i].context.canvas,\n                    isVisible: layers[i].isVisible,\n                    opacity: layers[i].opacity,\n                    mixModeStr: layers[i].mixModeStr,\n                    hasClipping: false,\n                });\n            }\n        }\n\n        const preview = new Preview({\n            width: getPreviewWidth(isSmall),\n            height: getPreviewHeight(isSmall),\n            project: {\n                width: context.canvas.width,\n                height: context.canvas.height,\n                layers: previewLayerArr,\n            },\n        });\n        BB.css(preview.getElement(), {\n            marginLeft: '-20px',\n            marginRight: '-20px',\n            overflow: 'hidden',\n        });\n\n        const dragInput = new DraggableInput({\n            value: {\n                x: settingsObj.x,\n                y: settingsObj.y,\n            },\n            onChange: (val) => {\n                settingsObj.x = Math.round(val.x);\n                settingsObj.y = Math.round(val.y);\n                syncInputs();\n                update();\n            },\n        });\n\n        update();\n\n        preview.getElement().append(dragInput.getElement());\n        rootEl.append(preview.getElement());\n\n\n\n        result.destroy = () => {\n            linesSlider.destroy();\n            colorOptions.destroy();\n            preview.destroy();\n        };\n        result.getInput = function (): TFilterVanishPointInput {\n            result.destroy!();\n            return BB.copyObj(settingsObj);\n        };\n        return result;\n    },\n\n    apply (params: IFilterApply<TFilterVanishPointInput>): boolean {\n        const context = params.context;\n        const klCanvas = params.klCanvas;\n        const history = params.history;\n        if (!context || !klCanvas || !history) {\n            return false;\n        }\n\n        history.pause(true);\n        drawVanishPoint(\n            context,\n            params.input.x,\n            params.input.y,\n            params.input.lines,\n            params.input.thickness,\n            params.input.color,\n            params.input.opacity,\n        );\n        history.pause(false);\n\n        history.push({\n            tool: ['filter', 'vanishPoint'],\n            action: 'apply',\n            params: [{\n                input: params.input,\n            }],\n        } as TFilterVanishPointHistoryEntry);\n        return true;\n    },\n\n};","import {drawShape} from './shape-tool';\nimport {BB} from '../../bb/bb';\nimport {IRGB} from '../kl-types';\n\nexport function drawVanishPoint (\n    ctx: CanvasRenderingContext2D,\n    x: number,\n    y: number,\n    lines: number, // int, [2, inf]\n    thickness: number, // px\n    color: IRGB,\n    opacity: number, // 0 - 1\n): void {\n    ctx.save();\n\n    const degIncrement = 180 / lines;\n    for (let deg = 0; deg < 180; deg += degIncrement) {\n        const p2 = BB.rotateAround({x, y}, {x: x + 9999, y}, deg);\n        drawShape(\n            ctx,\n            {\n                type: 'line',\n                x1: x,\n                y1: y,\n                x2: p2.x,\n                y2: p2.y,\n                //angleRad: 0,\n                isOutwards: true,\n                opacity,\n                //isEraser: false,\n                strokeRgb: color,\n                lineWidth: thickness,\n                //doLockAlpha: false,\n            }\n        );\n    }\n\n    ctx.restore();\n}","import {KL} from '../kl';\nimport {KlCanvas} from '../canvas/kl-canvas';\nimport {Psd} from 'ag-psd/dist/psd';\nimport {loadAgPsd} from './load-ag-psd';\n\nexport async function klCanvasToPsdBlob (klCanvas: KlCanvas): Promise<Blob> {\n    const layerArr = klCanvas.getLayersFast();\n\n    const psdConfig: Psd = {\n        width: klCanvas.getWidth(),\n        height: klCanvas.getHeight(),\n        //canvas: klCanvas.getCompleteCanvas(1), // preview, can be skipped\n        children: layerArr.map(item => {\n            // todo - can be optimized if layer mostly empty\n            return {\n                name: item.name,\n                hidden: !item.isVisible,\n                opacity: item.opacity,\n                canvas: item.canvas,\n                blendMode: KL.PSD.blendKlToPsd(item.mixModeStr),\n                left: 0,\n                top: 0,\n            };\n        }),\n    };\n\n    const agPsd = await loadAgPsd();\n    const buffer = agPsd.writePsdBuffer(psdConfig);\n    return new Blob([buffer], { type: 'application/octet-stream' });\n}","import {BB} from '../../bb/bb';\nimport {IDrawMoveEvent, TDrawEvent} from '../kl-types';\n\n/**\n * Line smoothing. EventChain element. Smoothing via blending new position with old position.\n * for onDraw events from KlCanvasWorkspace.\n *\n * in some draw event\n * out some draw event\n *\n * type: 'line' Events are just passed through.\n */\nexport class LineSmoothing {\n\n    private chainOut: ((drawEvent: TDrawEvent) => void) | undefined;\n    private smoothing: number;\n    private lastMixedInput: {\n        x: number;\n        y: number;\n        pressure: number;\n    } | undefined;\n    private interval: ReturnType<typeof setInterval> | undefined;\n    private timeout: ReturnType<typeof setTimeout> | undefined;\n\n    // --- public ---\n    constructor (\n        p: {\n            smoothing: number; // 0-1, 0: no smoothing, 1: 100% smoothing -> would never catch up\n        }\n    ) {\n        this.smoothing = BB.clamp(p.smoothing, 0, 1);\n    }\n\n    chainIn (event: TDrawEvent): TDrawEvent | null {\n        event = BB.copyObj(event);\n        this.timeout && clearTimeout(this.timeout);\n        this.interval && clearInterval(this.interval);\n\n        if (event.type === 'down') {\n            this.lastMixedInput = {\n                x: event.x,\n                y: event.y,\n                pressure: event.pressure,\n            };\n        }\n\n        if (event.type === 'move') {\n\n            const inputX = event.x;\n            const inputY = event.y;\n            const inputPressure = event.pressure;\n\n            event.x = BB.mix(event.x, this.lastMixedInput!.x, this.smoothing);\n            event.y = BB.mix(event.y, this.lastMixedInput!.y, this.smoothing);\n            event.pressure = BB.mix(event.pressure, this.lastMixedInput!.pressure, this.smoothing);\n            this.lastMixedInput = {\n                x: event.x,\n                y: event.y,\n                pressure: event.pressure,\n            };\n\n            if (this.smoothing > 0) {\n                this.timeout = setTimeout(() => {\n                    this.interval = setInterval(() => {\n                        event = JSON.parse(JSON.stringify(event)) as IDrawMoveEvent;\n\n                        event.x = BB.mix(inputX, this.lastMixedInput!.x, this.smoothing);\n                        event.y = BB.mix(inputY, this.lastMixedInput!.y, this.smoothing);\n                        event.pressure = BB.mix(inputPressure, this.lastMixedInput!.pressure, this.smoothing);\n                        this.lastMixedInput = {\n                            x: event.x,\n                            y: event.y,\n                            pressure: event.pressure,\n                        };\n\n                        this.chainOut && this.chainOut(event);\n                    }, 35);\n                }, 80);\n            }\n\n        }\n\n        return event;\n    }\n\n    setChainOut (func: (drawEvent: TDrawEvent) => void): void {\n        this.chainOut = func;\n    }\n\n    setSmoothing (s: number): void {\n        this.smoothing = BB.clamp(s, 0, 1);\n    }\n}\n","import {TDrawEvent} from '../kl-types';\n\n/**\n * cleans up DrawEvents. More trustworthy events. EventChain element\n *\n * in some draw event?\n * out some draw event?\n *\n * that events can only go line this: down -> n x move -> up\n * so, sanitizes this: down, down, down. becomes only one down. the other downs are ignored/swallowed\n */\nexport class LineSanitizer {\n\n    private chainOut: ((drawEvent: TDrawEvent) => void) | undefined;\n    private isDrawing: boolean = false;\n\n    // --- public ---\n\n    chainIn (event: TDrawEvent): TDrawEvent | null {\n\n        if (event.type === 'down') {\n            if (this.isDrawing) {\n                //console.log('line sanitizer - down, but already drawing');\n                this.chainOut && this.chainOut({\n                    type: 'up',\n                    scale: event.scale,\n                    shiftIsPressed: event.shiftIsPressed,\n                    isCoalesced: false,\n                });\n            } else {\n                this.isDrawing = true;\n            }\n        }\n        if (!this.isDrawing && (event.type === 'move' || event.type === 'up')) {\n            //console.log('line sanitizer - ' + event.type + ' but not drawing');\n            return null;\n        }\n\n        if (event.type === 'up' && this.isDrawing) {\n            this.isDrawing = false;\n        }\n\n        return event;\n    }\n\n    setChainOut (func: (drawEvent: TDrawEvent) => void): void {\n        this.chainOut = func;\n    }\n\n    getIsDrawing (): boolean {\n        return this.isDrawing;\n    }\n}\n","/**\n * from stabilizer dropdown value to line-smoothing value\n * @param s\n */\nexport function translateSmoothing (s: number): number {\n    if (s == 1) {\n        return 1 - 0.5;\n    }\n    if (s == 2) {\n        return 1 - 0.16;\n    }\n    if (s == 3) {\n        return 1 - 0.035;\n    }\n    if (s == 4) {\n        return 1 - 0.0175;\n    }\n    if (s == 5) {\n        return 1 - 0.00875;\n    }\n    return s;\n}","import {IKlPsd, IRGB, TDropOption, TKlCanvasLayer} from '../klecks/kl-types';\nimport {KL} from '../klecks/kl';\nimport {LANG} from '../language/language';\nimport {BB} from '../bb/bb';\nimport {klHistory, TMiscImportImageHistoryEntry} from '../klecks/history/kl-history';\nimport {KlCanvas} from '../klecks/canvas/kl-canvas';\nimport {KlCanvasWorkspace} from '../klecks/canvas-ui/kl-canvas-workspace';\nimport {HandUi} from '../klecks/ui/tool-tabs/hand-ui';\nimport {LayerManager} from '../klecks/ui/tool-tabs/layer-manager/layer-manager';\nimport {IRect, ISize2D} from '../bb/bb-types';\nimport {throwIfNull, throwIfUndefined} from '../bb/base/base';\n\n// todo later:\n// onImage: (project: IKlProject) => void\n// onLayer: (index: number, canvas: HMTLCanvasElement,layerName: string) => void\n\nexport class ImportHandler {\n\n    private readonly klRootEl: HTMLElement;\n    private readonly klMaxCanvasSize: number;\n    private readonly layerManager: LayerManager;\n    private readonly setCurrentLayer: (layer: TKlCanvasLayer) => void;\n    private readonly klCanvas: KlCanvas;\n    private readonly klCanvasWorkspace: KlCanvasWorkspace;\n    private readonly handUi: HandUi;\n\n    private readonly onColor: (rgb: IRGB) => void;\n\n\n    /**\n     *\n     * @param importedImage - convertedPsd | {type: 'image', width: number, height: number, canvas: image | canvas}\n     * @param filename - string e.g. 'drawing.psd'\n     * @param optionStr? - 'default' | 'layer' | 'image'\n     */\n    private importFinishedLoading (\n        importedImage: IKlPsd | {\n            type: 'image';\n            width: number;\n            height: number;\n            canvas: HTMLCanvasElement | HTMLImageElement;\n        },\n        filename: string | undefined,\n        optionStr: 'default' | 'layer' | 'image',\n    ): void {\n        if (!importedImage || isNaN(importedImage.width) || isNaN(importedImage.height) || importedImage.width <= 0 || importedImage.height <= 0) {\n            KL.popup({\n                target: this.klRootEl,\n                type: 'error',\n                message: LANG('import-broken-file'),\n                buttons: ['Ok'],\n            });\n            return;\n        }\n\n        const getResizedDimensions = (width: number, height: number): ISize2D => {\n            let w = parseInt('' + width);\n            let h = parseInt('' + height);\n            if (w > this.klMaxCanvasSize) {\n                h = this.klMaxCanvasSize / w * h;\n                w = this.klMaxCanvasSize;\n            }\n            if (h > this.klMaxCanvasSize) {\n                w = this.klMaxCanvasSize / h * w;\n                h = this.klMaxCanvasSize;\n            }\n            w = parseInt('' + w);\n            h = parseInt('' + h);\n            return {\n                width: w,\n                height: h,\n            };\n        };\n\n        const importAsImage = (canvas: HTMLCanvasElement | HTMLImageElement) => {\n            const resizedDimensions = getResizedDimensions(canvas.width, canvas.height);\n\n            //resize first\n            const tempCanvas = BB.canvas(canvas.width, canvas.height);\n            const tempCanvasCtx = BB.ctx(tempCanvas);\n            tempCanvasCtx.drawImage(canvas, 0, 0);\n\n            BB.resizeCanvas(tempCanvas, resizedDimensions.width, resizedDimensions.height);\n\n            this.klCanvas.reset({\n                width: resizedDimensions.width,\n                height: resizedDimensions.height,\n                image: tempCanvas,\n                layerName: filename,\n            });\n\n            this.layerManager.update(0);\n            this.setCurrentLayer(this.klCanvas.getLayer(0)!);\n            this.klCanvasWorkspace.resetOrFitView();\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n        };\n\n        /**\n         *\n         * @param convertedPsdObj - if flattened then without layers\n         * @param cropObj? - {x: number, y: number, width: number, height: number}\n         */\n        const importAsImagePsd = (convertedPsdObj: IKlPsd, cropObj?: IRect) => {\n            // crop\n            const crop = (\n                targetCanvas: HTMLCanvasElement,\n                cropCanvas: HTMLCanvasElement,\n                cropObj: IRect,\n            ): void => {\n                // eslint-disable-next-line no-self-assign\n                cropCanvas.width = cropCanvas.width;\n                BB.ctx(cropCanvas).drawImage(targetCanvas, -cropObj.x, -cropObj.y);\n                targetCanvas.width = cropObj.width;\n                targetCanvas.height = cropObj.height;\n                BB.ctx(targetCanvas).drawImage(cropCanvas, 0, 0);\n            };\n            if (cropObj && (cropObj.width !== convertedPsdObj.width ||cropObj.height !== convertedPsdObj.height)) {\n                const cropCanvas = BB.canvas(cropObj.width, cropObj.height);\n                convertedPsdObj.width = cropObj.width;\n                convertedPsdObj.height = cropObj.height;\n\n                if (!convertedPsdObj.layers) {\n                    crop(convertedPsdObj.canvas, cropCanvas, cropObj);\n                }\n                if (convertedPsdObj.layers) {\n                    for (let i = 0; i < convertedPsdObj.layers.length; i++) {\n                        const item = convertedPsdObj.layers[i];\n                        crop(item.image, cropCanvas, cropObj);\n                    }\n                }\n            }\n\n            // resize\n            const resizedDimensions = getResizedDimensions(convertedPsdObj.width, convertedPsdObj.height);\n            convertedPsdObj.width = resizedDimensions.width;\n            convertedPsdObj.height = resizedDimensions.height;\n            if (!convertedPsdObj.layers) {\n                BB.resizeCanvas(convertedPsdObj.canvas, convertedPsdObj.width, convertedPsdObj.height);\n            }\n            if (convertedPsdObj.layers) {\n                for (let i = 0; i < convertedPsdObj.layers.length; i++) {\n                    const item = convertedPsdObj.layers[i];\n                    BB.resizeCanvas(item.image, convertedPsdObj.width, convertedPsdObj.height);\n                }\n            }\n\n            let layerIndex;\n            if (convertedPsdObj.layers) {\n                layerIndex = this.klCanvas.reset({\n                    width: convertedPsdObj.width,\n                    height: convertedPsdObj.height,\n                    layers: convertedPsdObj.layers,\n                });\n            } else {\n                layerIndex = this.klCanvas.reset({\n                    width: convertedPsdObj.width,\n                    height: convertedPsdObj.height,\n                    image: convertedPsdObj.canvas,\n                });\n            }\n            this.layerManager.update(layerIndex);\n            this.setCurrentLayer(throwIfNull(this.klCanvas.getLayer(layerIndex)));\n            this.klCanvasWorkspace.resetOrFitView();\n            this.handUi.update(this.klCanvasWorkspace.getScale(), this.klCanvasWorkspace.getAngleDeg());\n        };\n\n        const importAsLayer = (canvas: HTMLCanvasElement | HTMLImageElement) => {\n            KL.showImportAsLayerDialog({\n                target: this.klRootEl,\n                klCanvas: this.klCanvas,\n                importImage: canvas,\n                callback: (transformObj, isPixelated?: boolean) => {\n                    if (!transformObj) {\n                        return;\n                    }\n\n                    klHistory.pause(true);\n                    this.klCanvas.addLayer();\n                    const layers = this.klCanvas.getLayers();\n                    const activeLayerIndex = layers.length - 1;\n                    if (filename) {\n                        this.klCanvas.renameLayer(activeLayerIndex, filename);\n                    }\n                    const activeLayerContext = throwIfNull(this.klCanvas.getLayerContext(activeLayerIndex));\n                    BB.drawTransformedImageWithBounds(activeLayerContext, canvas, transformObj, undefined, isPixelated);\n                    this.setCurrentLayer(throwIfNull(this.klCanvas.getLayer(activeLayerIndex)));\n                    this.layerManager.update(activeLayerIndex);\n\n                    klHistory.pause(false);\n\n                    klHistory.push({\n                        tool: ['misc'],\n                        action: 'importImage',\n                        params: [BB.copyCanvas(activeLayerContext.canvas), filename],\n                    } as TMiscImportImageHistoryEntry);\n                },\n            });\n        };\n\n\n        if (optionStr === 'default' || !optionStr) {\n            KL.showImportImageDialog({\n                image: importedImage,\n                target: this.klRootEl,\n                maxSize: this.klMaxCanvasSize,\n                callback: (res) => {\n                    if (res.type === 'as-image') {\n                        importAsImage(res.image);\n                    } else if (res.type === 'as-image-psd') {\n                        importAsImagePsd(res.image, res.cropObj);\n                    } else if (res.type === 'as-layer') {\n                        importAsLayer(res.image);\n                    } else if (res.type === 'cancel') {\n                        // nothing to do\n                    }\n                },\n            });\n        }\n\n        if (optionStr === 'layer') {\n            importAsLayer(importedImage.canvas);\n        }\n        if (optionStr === 'image') {\n            if (importedImage.type === 'psd') {\n                importAsImagePsd(importedImage);\n            } else {\n                importAsImage(importedImage.canvas);\n            }\n        }\n\n    }\n\n    // ---- public ----\n    constructor (\n        input: {\n            klRootEl: HTMLElement;\n            klMaxCanvasSize: number;\n            layerManager: LayerManager;\n            setCurrentLayer: (layer: TKlCanvasLayer) => void;\n            klCanvas: KlCanvas;\n            klCanvasWorkspace: KlCanvasWorkspace;\n            handUi: HandUi;\n        },\n        callback: {\n            onColor: (rgb: IRGB) => void;\n        }\n    ) {\n        this.klRootEl = input.klRootEl;\n        this.klMaxCanvasSize = input.klMaxCanvasSize;\n        this.layerManager = input.layerManager;\n        this.setCurrentLayer = input.setCurrentLayer;\n        this.klCanvas = input.klCanvas;\n        this.klCanvasWorkspace = input.klCanvasWorkspace;\n        this.handUi = input.handUi;\n\n        this.onColor = callback.onColor;\n    }\n\n\n\n    // ---- interface ----\n\n    onPaste (e: ClipboardEvent): void{\n        if (KL.dialogCounter.get() > 0) {\n            return;\n        }\n\n        const retrieveImageFromClipboardAsBlob = (\n            items: DataTransferItemList,\n            callback: (file: File) => void,\n        ) => {\n            if (!items) {\n                return;\n            }\n            for (let i = 0; i < items.length; i++) {\n                if (items[i].type.indexOf('image') == -1) {\n                    continue;\n                }\n                const file = items[i].getAsFile();\n                file && callback(file);\n            }\n        };\n\n        e.stopPropagation();\n        e.preventDefault();\n\n        if (!e.clipboardData) {\n            return;\n        }\n\n        if (e.clipboardData.files[0]) {\n            retrieveImageFromClipboardAsBlob(e.clipboardData.items, (imageBlob) => {\n                // If there's an image, display it in the canvas\n                const img = new Image();\n                img.onload = () => {\n                    URL.revokeObjectURL(img.src);\n                    this.importFinishedLoading({\n                        type: 'image',\n                        width: img.width,\n                        height: img.height,\n                        canvas: img,\n                    }, undefined, 'default');\n                };\n                const URLObj = window.URL || window.webkitURL;\n                img.src = URLObj.createObjectURL(imageBlob);\n            });\n        } else if (e.clipboardData.items[0]) {\n            e.clipboardData.items[0].getAsString((pasteStr) => {\n                pasteStr = pasteStr.trim();\n                if (pasteStr.match(/^https?/)) {\n                    // url\n                    const img = new Image();\n                    img.onload = () => {\n                        this.importFinishedLoading({\n                            type: 'image',\n                            width: img.width,\n                            height: img.height,\n                            canvas: img,\n                        }, undefined, 'default');\n                    };\n                    img.onerror = (e) => {\n                        console.log('error loading', e);\n                    };\n                    img.crossOrigin = 'Anonymous';\n                    img.src = pasteStr;\n\n                } else if (pasteStr.match(/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)) {\n                    // url\n                    const rgbObj = BB.ColorConverter.hexToRGB(pasteStr.replace('#', ''));\n                    rgbObj && this.onColor(rgbObj);\n                }\n            });\n\n        }\n    }\n\n    handleFileSelect (files: FileList, optionStr: TDropOption): void {\n\n        const showWarningPsdFlattened = () => {\n            KL.popup({\n                target: this.klRootEl,\n                type: 'warning',\n                message: LANG('import-psd-unsupported') + '<br /><br />',\n                buttons: ['Ok'],\n            });\n        };\n\n        let hasUnsupportedFile = false;\n        // eslint-disable-next-line no-cond-assign\n        for (let i = 0, file; file = files[i]; i++) {\n            const nameSplit = file.name.split('.');\n            const extension = nameSplit[nameSplit.length - 1].toLowerCase();\n            if (extension === 'psd') {\n\n                ((f) => {\n                    const loaderSizeBytes = 1024 * 1024 * 25; // 25mb\n                    const maxSizeBytes = 1024 * 1024 * 1024; // 1gb\n                    const maxResolution = 4096;\n\n                    if (f.size >= maxSizeBytes) { // pretty likely to break stuff\n                        KL.popup({\n                            target: this.klRootEl,\n                            type: 'error',\n                            message: 'File too big. Unable to import.<br /><br />',\n                            buttons: ['Ok'],\n                        });\n                        return;\n                    }\n\n                    const doShowLoader = files.length === 1 && f.size >= loaderSizeBytes;\n                    let loaderIsOpen = true;\n                    let closeLoader: (() => void) | null;\n\n                    if (doShowLoader) {\n                        KL.popup({\n                            target: this.klRootEl,\n                            message: LANG('import-opening'),\n                            callback: (result) => {\n                                loaderIsOpen = false;\n                                closeLoader = null;\n                            },\n                            closeFunc: (f) => {\n                                closeLoader = f;\n                            },\n                        });\n                    }\n\n\n                    const reader = new FileReader();\n                    reader.onload = (readerResult) => {\n                        const target = throwIfNull(readerResult.target);\n\n                        KL.loadAgPsd().then((agPsdLazy) => {\n\n                            if (doShowLoader && !loaderIsOpen) {\n                                return;\n                            }\n\n                            try {\n                                let psd;\n\n                                // first pass, only read metadata\n                                psd = agPsdLazy.readPsd(\n                                    (target.result as any),\n                                    {\n                                        skipLayerImageData: true,\n                                        skipThumbnail: true,\n                                        skipCompositeImageData: true,\n                                    });\n                                if (psd.width > maxResolution || psd.height > maxResolution) {\n                                    if (closeLoader) {\n                                        closeLoader();\n                                    }\n                                    KL.popup({\n                                        target: this.klRootEl,\n                                        type: 'error',\n                                        message: LANG('import-psd-too-large').replace(/{x}/g, '' + maxResolution)\n                                            + '<br /><br />'\n                                            + LANG('import-psd-size') + ': ' + psd.width + ' x ' + psd.height + ' pixels'\n                                            + '<br /><br />'\n                                        ,\n                                        buttons: ['Ok'],\n                                    });\n                                    return;\n                                }\n\n\n                                // second pass, now load actual data.\n                                psd = null;\n\n                                try {\n                                    psd = agPsdLazy.readPsd((target.result as any));\n                                } catch (e) {\n                                    //console.log('failed regular psd import', e);\n                                }\n                                if (psd) {\n                                    //console.log('psd', psd);\n                                    const convertedPsd = KL.PSD.readPsd(psd);\n                                    //console.log('converted', convertedPsd);\n                                    if (optionStr === 'image' && convertedPsd.error) {\n                                        showWarningPsdFlattened();\n                                    }\n\n                                    if (closeLoader) {\n                                        closeLoader();\n                                    }\n                                    this.importFinishedLoading(convertedPsd, f.name, optionStr);\n                                } else {\n                                    psd = agPsdLazy.readPsd((target.result as any), { skipLayerImageData: true, skipThumbnail: true });\n\n                                    if (optionStr === 'image') {\n                                        showWarningPsdFlattened();\n                                    }\n\n                                    if (closeLoader) {\n                                        closeLoader();\n                                    }\n                                    this.importFinishedLoading({\n                                        type: 'psd',\n                                        width: psd.width,\n                                        height: psd.height,\n                                        canvas: throwIfUndefined(psd.canvas),\n                                        error: true,\n                                    }, f.name, optionStr);\n                                }\n\n                            } catch (e) {\n                                closeLoader && closeLoader();\n                                KL.popup({\n                                    target: this.klRootEl,\n                                    type: 'error',\n                                    message: 'Failed to load PSD.<br /><br />',\n                                    buttons: ['Ok'],\n                                });\n                                console.log(e);\n                                setTimeout(() => {\n                                    throw new Error('psd load error');\n                                });\n                            }\n                        }).catch((e) => {\n                            closeLoader && closeLoader();\n                            alert('Error: failed to load PSD library');\n                        });\n\n                    };\n                    reader.readAsArrayBuffer(f);\n                })(file);\n\n            } else if (file.type.match('image.*')) {\n                ((f) => {\n                    window.URL = window.URL || window.webkitURL;\n                    const url = window.URL.createObjectURL(f);\n                    const im = new Image();\n                    im.src = url;\n                    BB.loadImage(im, () => {\n                        this.importFinishedLoading({\n                            type: 'image',\n                            width: im.width,\n                            height: im.height,\n                            canvas: im,\n                        }, f.name, optionStr);\n                    });\n                })(file);\n            } else {\n                hasUnsupportedFile = true;\n            }\n        }\n        if (hasUnsupportedFile) {\n            KL.popup({\n                target: this.klRootEl,\n                message: LANG('import-unsupported-file'),\n                type: 'error',\n                buttons: ['OK'],\n            });\n        }\n    }\n}\n\n\n","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"tab-settings.be84ac7c.svg\";","module.exports = require('./helpers/bundle-url').getBundleURL('lrLBb') + \"tab-layers.c8a104e7.svg\";","import {IVector2D} from '../bb/bb-types';\n\n\n\nexport type TConsoleApi = {\n    readonly draw: (path: IVector2D[]) => void;\n    readonly help: () => void;\n};\n\nexport function createConsoleApi (\n    p: {\n        onDraw: (path: IVector2D[]) => void;\n    }\n): TConsoleApi {\n\n    const output = ['Draw via the console! Learn more: %cKL.help()', 'background: #000; color: #0f0;'];\n    'info' in (console as any) ? console.info(...output) : console.log(...output);\n\n    return Object.freeze({\n        draw: (path: IVector2D[]): void => {\n            p.onDraw(path);\n        },\n        help: (): void => {\n            console.log(`KL.draw({x: number; y: number}[]) // draw a line\nKL.help() // print help\n`);\n        },\n    });\n}"],"names":["$469fa98e1403db53$var$mx","$469fa98e1403db53$var$my","$e9d04a247aa46c18$var$kl2PsdMap","$e9d04a247aa46c18$var$psd2KlMap","$ca843f6dd01906cb$export$5822a9d0880a5d82","$ba022370a1e95297$var$floatPrecision","$e4b3248b4ce95ea5$var$agPsdLazy","options","cache","css","TMode","$3a2f95de72e4a634$var$TMode","$d9aa3b7905088459$export$e114d13b1a258938","$parcel$global","globalThis","self","window","global","$parcel$export","e","n","v","s","Object","defineProperty","get","set","enumerable","configurable","$parcel$interopDefault","a","__esModule","default","$parcel$modules","$parcel$inits","parcelRequire","id","exports","init","module","call","err","Error","code","register","parcelRegister","resolve","then","$20Uq9","bundle","Promise","reject","globalName","concat","Math","random","slice","m","cleanup","script","onerror","remove","document","createElement","async","type","charset","textContent","head","appendChild","$177758dc750d50ea$var$cachedBundles","$177758dc750d50ea$var$cachedPreloads","$177758dc750d50ea$var$cachedPrefetches","loader","$177758dc750d50ea$var$getCache","apply","arguments","catch","value","$1erBK","$4ea98ac1647cc6f1$var$_createEmotion","key","$4ea98ac1647cc6f1$var$flush","flush","$4ea98ac1647cc6f1$var$hydrate","hydrate","$4ea98ac1647cc6f1$var$cx","cx","$4ea98ac1647cc6f1$var$merge","merge","$4ea98ac1647cc6f1$var$getRegisteredStyles","getRegisteredStyles","$4ea98ac1647cc6f1$var$injectGlobal","injectGlobal","$4ea98ac1647cc6f1$var$keyframes","keyframes","$4ea98ac1647cc6f1$var$css","$4ea98ac1647cc6f1$var$sheet","sheet","$4ea98ac1647cc6f1$var$cache","$brs90","$7YdyD","$42Upt","$0e5c839687e65192$var$createCache__default","$0e5c839687e65192$var$insertWithoutScoping","serialized","undefined","inserted","name","insert","$0e5c839687e65192$var$merge","registered","className","registeredStyles","rawClassName","length","$0e5c839687e65192$var$classnames","classnames","args","cls","i","arg","toAdd","Array","isArray","k","speedy","isSpeedy","compat","_len","_key","serializeStyles","insertStyles","_len4","_key4","_len3","_key3","_len2","_key2","animation","styles","ids","forEach","bind","$85480c33a4508c92$export$2e2bcd8739ae039","$n9S4x","$fOtsb","$85480c33a4508c92$var$identifierWithPointTracking","begin","points","index","previous","character","peek","token","next","position","$85480c33a4508c92$var$toRules","parsed","delimit","from","$85480c33a4508c92$var$fixedElements","WeakMap","$85480c33a4508c92$var$compat","element","parent","isImplicitRule","column","line","props","charCodeAt","rules","dealloc","alloc","parentRules","j","replace","$85480c33a4508c92$var$removeLabel","$85480c33a4508c92$var$defaultStylisPlugins","children","callback","DECLARATION","$85480c33a4508c92$var$prefix","hash","WEBKIT","MOZ","MS","strlen","charat","indexof","KEYFRAMES","serialize","copy","RULESET","combine","match","container","_insert","currentSheet","ssrStyles","querySelectorAll","prototype","node","dataEmotionAttribute","getAttribute","indexOf","setAttribute","stylisPlugins","nodesToHydrate","attrib","split","push","finalizingPlugins","stringify","rulesheet","rule","serializer","middleware","omnipresentPlugins","selector","shouldCache","compile","StyleSheet","nonce","prepend","insertionPoint","$0459ce4c5047536b$export$9d753cd7ae895cce","_this","_insertTag","tag","before","tags","nextSibling","firstChild","insertBefore","ctr","_proto","nodes","createTextNode","$0459ce4c5047536b$var$sheetForTag","styleSheets","ownerNode","insertRule","cssRules","parentNode","removeChild","$3e52240dff875db8$export$71ad59f2e432cfe8","$3e52240dff875db8$export$2c0f367103c8d01c","$3e52240dff875db8$export$39dfd62a25e0fe93","$3e52240dff875db8$export$aa3a2e812ca8570d","$3e52240dff875db8$export$527d108ccf083c2b","$3e52240dff875db8$export$b44a8529a35fcb60","$3e52240dff875db8$export$6788812c4e6611e6","$3e52240dff875db8$export$d6af199866bfb566","$3e52240dff875db8$export$a9db5e087081082d","$3e52240dff875db8$export$4659b591c19bdf3d","$3e52240dff875db8$export$77ad94ebf1c2b9ed","$3e52240dff875db8$export$f8e21b1e77979a08","$3e52240dff875db8$export$36776f635604f274","$3e52240dff875db8$export$1be1fc439b849fdf","$3e52240dff875db8$export$5880b8b5730aff45","$3e52240dff875db8$export$784d13d8ee351f07","$3e52240dff875db8$export$48cfd1e771a65c4f","$3e52240dff875db8$export$4d3fb11e950abb9e","$3e52240dff875db8$export$58adb3bec8346d0f","$3e52240dff875db8$export$9e1725a4cfeada27","$3e52240dff875db8$export$2de70f21292aac9e","$3e52240dff875db8$export$45918ac1574455b1","$3e52240dff875db8$export$410ac95b9ec204b8","$3e52240dff875db8$export$ef7acd7185315e22","$3e52240dff875db8$export$dfdc1655ccc5b9cb","$3e52240dff875db8$export$fac44ee5b035f737","$3e52240dff875db8$export$5a7767152ae0305f","$3e52240dff875db8$export$38bcb760f1d4871c","$3e52240dff875db8$export$a29989082612d0d9","$3e52240dff875db8$export$2335f513bbd82c6d","abs","String","fromCharCode","$3e52240dff875db8$export$e6e34fd1f2686227","assign","r","exec","$3e52240dff875db8$export$2f35ab04d2335697","$3e52240dff875db8$export$10d8903dec122b9d","map","join","$3e52240dff875db8$export$53f1d5ea8de3d7c","$3e52240dff875db8$export$4e0c71f277ca26b3","$3e52240dff875db8$export$f24224f1c91d8156","$3e52240dff875db8$export$c0306caf338ac095","$3e52240dff875db8$export$30a86d91af8ff6e6","$3e52240dff875db8$export$35059013cd4a06db","c","t","root","return","$3e52240dff875db8$export$c889f2fcc19dbf12","trim","$3e52240dff875db8$export$98e6a39c04603d36","u","f","o","l","p","h","b","w","d","$","g","x","y","$3e52240dff875db8$export$7af1228ff777d175","$3e52240dff875db8$export$955ba06d119e085e","$3e52240dff875db8$export$e88cb2efb12ae807","$3e52240dff875db8$export$4254d4e2b3745c4c","$3e52240dff875db8$export$f8483753829ec8f3","$3e52240dff875db8$export$3307ffa7023ede1e","$3e52240dff875db8$export$232faf9add678146","$3e52240dff875db8$export$c2ab62c7bf24634","$058ff0798b669563$export$2e2bcd8739ae039","fn","create","$5cd8a743d76500ca$export$6321afa313b251b5","$5cd8a743d76500ca$var$cursor","$9Z4kD","$6mYn6","$tBGmN","$5cd8a743d76500ca$var$hyphenateRegex","$5cd8a743d76500ca$var$animationRegex","$5cd8a743d76500ca$var$isCustomProperty","property","$5cd8a743d76500ca$var$isProcessableValue","$5cd8a743d76500ca$var$processStyleName","styleName","toLowerCase","$5cd8a743d76500ca$var$processStyleValue","p1","p2","$5cd8a743d76500ca$var$handleInterpolation","mergedProps","interpolation","__emotion_styles","anim","$5cd8a743d76500ca$var$createStringFromObject","obj","string","_i","interpolated","previousCursor","result","cached","$5cd8a743d76500ca$var$labelPattern","stringMode","strings","raw","lastIndex","identifierName","$744d2bc027be075c$export$2e2bcd8739ae039","str","len","toString","$4a33a0aed687e21c$export$2e2bcd8739ae039","animationIterationCount","aspectRatio","borderImageOutset","borderImageSlice","borderImageWidth","boxFlex","boxFlexGroup","boxOrdinalGroup","columnCount","columns","flex","flexGrow","flexPositive","flexShrink","flexNegative","flexOrder","gridRow","gridRowEnd","gridRowSpan","gridRowStart","gridColumn","gridColumnEnd","gridColumnSpan","gridColumnStart","msGridRow","msGridRowSpan","msGridColumn","msGridColumnSpan","fontWeight","lineHeight","opacity","order","orphans","tabSize","widows","zIndex","zoom","WebkitLineClamp","fillOpacity","floodOpacity","stopOpacity","strokeDasharray","strokeDashoffset","strokeMiterlimit","strokeOpacity","strokeWidth","$2f231b2c70f2d4a5$export$95d99596f328fd52","classNames","$2f231b2c70f2d4a5$export$6f077d94b33a01aa","$2f231b2c70f2d4a5$export$580009a5da2a8b4b","isStringTag","current","createDocumentFragment","Node","Element","Document","DocumentFragment","hasOwnProperty","writable","padStart","repeat","findIndex","TypeError","scrollLeft","scrollTop","flat","depth","isNaN","Number","reduce","acc","cur","replaceAll","searchValue","replaceValue","RegExp","fromEntries","entries","Symbol","iterator","keys","localStorage","getItem","setItem","removeItem","$fc4403c8ee6a33dc$export$dbf350e5966cf602","el","styleObj","keyStr","keyArr","style","webkitUserSelect","$fc4403c8ee6a33dc$export$f81847884871263e","$fc4403c8ee6a33dc$export$533b26079ad0b4b","numerator","denominator","$fc4403c8ee6a33dc$export$af0d87255f3cfd7e","JSON","parse","$fc4403c8ee6a33dc$export$c54fe3b9ecaa84cf","createElementNS","elementType","item","child","append","$fc4403c8ee6a33dc$export$b813e062795b89b5","$fc4403c8ee6a33dc$export$5c097f720de072a2","message","$fc4403c8ee6a33dc$export$d802c22d109d9806","$fc4403c8ee6a33dc$var$matchMediaDark","matchMedia","$fc4403c8ee6a33dc$export$a79ad82046afa44e","matches","$fc4403c8ee6a33dc$export$a9dfd81f95a8a526","func","addEventListener","$d2dccce11beb16cf$var$historyInstance","$d2dccce11beb16cf$export$2a772a91f059c0f9","pause","addListener","undo","redo","getAll","canRedo","canUndo","getState","getActionNumber","$d2dccce11beb16cf$export$28b6f4d98dde9845","broadcast","setTimeout","listeners","state","pauseStack","max","newEntry","actionNumber","pop","lastEntry","tool","action","params","maxBefore","maxState","bufferUpdate","constructor","$6b37b427615ca1fa$export$17eb8275e0c4cab8","emit","count","increase","decrease","subscribe","listener","$604d9bbf77127967$export$b7d78993b74f766d","navigator","userAgent","$604d9bbf77127967$export$4ec3bfbae69fbb50","eventUsesHighResTimeStamp","Event","timeStamp","$604d9bbf77127967$export$b7b64c480b083ae0","PointerEvent","$604d9bbf77127967$export$fe0a7220ab4eecad","test","div","top","left","body","offsetLeft","$08e838e8af75c5e2$var$globalKey","keyStrToKeyObj","keyStrArr","isDownObj","keyToKeyStrObj","comboArr","codeIsDownObj","listenerArr","emitDown","emitUp","emitBlur","keyDown","keyUp","oldComboStr","includes","blur","splice","eventArr","preventDefault","stopPropagation","add","keyListenerRef","first","last","removeEventListener","getIsDown","getCombo","$7b537f840072781f$export$c734b8535f2f8e38","delta","sequenceUnit","deltaY","round","pageX","pageY","clientX","clientY","endSequence","toEmitDelta","knownUnitArr","sequenceLength","process","event","endSequenceTimeout","clearTimeout","deltaMode","absDelta","$9414f5ea41e9cf25$export$2c9e8a9632a706b2","$9414f5ea41e9cf25$export$6c4a311cc157c764","ax","ay","bx","by","sqrt","pow","$9414f5ea41e9cf25$export$627023b405ba5028","atan2","$9414f5ea41e9cf25$export$c03a8450eabc2532","PI","$9414f5ea41e9cf25$export$7d15b64cf5a3a4c4","num","min","$9414f5ea41e9cf25$export$bb628a54ab399bc9","deg","theta","cs","cos","sn","sin","$a07742141701d1f2$var$pointerArr","$a07742141701d1f2$var$getButtonStr","buttons","$a07742141701d1f2$var$pressureNormalizer","normalize","pressure","avgPressure","normalizeIsComplete","normalizeFactor","$a07742141701d1f2$var$timeStampOffset","performance","timing","navigationStart","$a07742141701d1f2$var$pointerDownEvt","$a07742141701d1f2$var$pointerMoveEvt","$a07742141701d1f2$var$pointerUpEvt","$a07742141701d1f2$var$pointerCancelEvt","$a07742141701d1f2$var$pointerLeaveEvt","$a07742141701d1f2$var$pointerEnterEvt","$a07742141701d1f2$var$correctPointerEvent","corrected","correctedObj","pointerId","pointerType","movementX","movementY","button","coalescedArr","eventPreventDefault","eventStopPropagation","customPressure","coalescedEventArr","getCoalescedEvents","pointerObj","$a07742141701d1f2$var$getPointer","$a07742141701d1f2$var$addPointer","lastPageX","lastPageY","shift","totalLastX","totalLastY","eventItem","$a07742141701d1f2$export$9371bd96776f4e82","getDragObj","dragObjArr","removeDragObj","removedDragObj","dragPointerIdArr","createPointerOutEvent","typeStr","correctedEvent","custom","bounds","targetElement","getBoundingClientRect","relX","relY","dX","dY","time","coalescedItem","setupDocumentListeners","windowOnPointerMove","windowOnPointerUp","windowOnPointerLeave","destroyDocumentListeners","destroy","isDestroyed","onPointerEnter","onPointerLeave","onPointerMove","onPointerDown","onWheel","onTouchMoveScribbleFix","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel","isOverCounter","lastPointerType","didSkip","target","onPointerCallback","onPointer","onWheelCallback","onEnterLeaveCallback","onEnterLeave","maxPointers","wheelCleaner","cleanerEvent","whlEvent","tempLastPointerType","outEvent","onSkipGlobal","dragObj","downPageX","downPageY","lastTimeStamp","touchToFakePointer","touch","touchEvent","isDown","identifier","handleTouch","changedTouches","fakePointer","fixScribble","$9f64dcf89d8f9132$export$cd3d1f114b139967","width","height","$13d5aa49e37e2734$export$754559b36e94ea2f","size","isDark","ctx","canvas","getContext","fillStyle","fillRect","$13d5aa49e37e2734$export$42af33c76b681867","modeStr","parseInt","toDataURL","$1460f8c17429a8fd$var$multiplyMatrixAndPoint","matrix","point","$1460f8c17429a8fd$export$5b12bf1653c0dd85","freeze","getIdentity","multiplyMatrixAndPoint","multiplyMatrices","matrixA","matrixB","row0","row1","row2","row3","result0","result1","result2","result3","createTranslationMatrix","createRotationMatrix","angleRad","createScaleMatrix","$2890e4902986ac94$export$ac4bca90992eed1","sub","nor","dist","mul","angle","dot","aArr","bArr","$4e47553489a532e8$export$8b36a4a83269a640","getAtDist","remainder","getLength","segmentArr","fac","$b68f66663c02a5d5$export$d2edaecd208aed43","$b68f66663c02a5d5$export$8f9ece5a47764b93","$b68f66663c02a5d5$export$89d3f85304bf0767","$b68f66663c02a5d5$export$fb7efcd2e153af6e","_RGBtoHSV","RGB","minVal","maxVal","del_R","del_G","del_B","_HSVtoRGB","HSV","var_h","var_i","var_1","var_2","var_3","var_r","var_g","var_b","floor","_CMYKtoRGB","CMYK","_RGBtoCMYK","toRGB","toHSV","toCMYK","toHexString","ha","hb","hc","toRgbStr","rgbObj","toRgbaStr","rgbaObj","hexToRGB","hexStr","$52ad4d7a7d6372c1$export$906dfdb7df31ccfc","_document_activeElement","activeElement","tagName","$52ad4d7a7d6372c1$export$6bd63bfceaafae0c","preventFocus","didFocusRelated","relatedTarget","focus","console","error","currentTarget","$52ad4d7a7d6372c1$var$els","$52ad4d7a7d6372c1$export$c3da0dad1b44eea9","content","innerHTML","$d9f9f4926aa80a1c$export$921068d8846a1559","title","onClick","noRef","onChange","customKeyArr","$e0f57e18e675096c$export$9860cd9e09e6f8ba","unsubscribe","msg","$0ecef66681b62a8c$export$19fffca37ef3e106","getError","$5ba93bbe34fd1582$export$d62358ac2d82abb3","end","gestureObj","eventQueueArr","fail","doSwallow","timeoutObj","secondFingerTimeout","chainOut","setupFailTimeout","timeMS","diff","nowTime","processEvent","pointersDownIdArr","now","touchPointerArr","isInProgress","continuePinch","beginPinch","otherPointerIdArr","downRelX","downRelY","untilSecondFingerDurationMs","touchPointerObj","firstFingerMaxDistancePx","endPinch","pincherArr","scale","onPinch","actionObj","startDist","distance","startAngle","chainIn","setChainOut","$afe05ecd8ae7f4be$export$db3963a21c01d803","success","lastSequenceItem","sequenceArr","onDoubleTap","setupTimeout","timeoutStr","targetFunc","noComparison","allowedPointerTypeArr","gestureFailed","lastUpTime","minSilenceBeforeDurationMs","allowedButtonArr","maxInbetweenDistancePx","maxUntilSecondDown","maxUntilSecondDownDurationMs","maxPressedDurationMs","maxPressedDistancePx","maxUpToUpDurationMs","isUp","minSilenceAfterMs","setAllowedPointerTypeArr","arr","setAllowedButtonArr","isInstant","$68c13f25614f29c1$export$71ff2f51bf1f4062","ignorePointerIdArr","downPointerId","$3c485cff20ed4548$export$649a211db9812745","continueChain","chainArr","hasPointerEvents","isCssMinMaxSupported","canShareFiles","unsetEventHandler","handlers","handler","insertAfter","referenceNode","newNode","loadImage","im","counter","check","alert","complete","setAttributes","attrObj","els","fragment","fitInto","aw","ah","bw","bh","centerWithin","getDate","date","Date","year","getFullYear","getMonth","getHours","getMinutes","gcd","decToFraction","decimalNumber","imageBlobToUrl","blobObj","Blob","URL","createObjectURL","fauxBlob","encoding","data","dateDayDifference","dateA","dateB","setHours","getTime","copyObj","shareCanvas","mimetype","toBlob","blob","filesArray","File","fileName","share","files","handleClick","clickEvent","allowClick","createSvg","BbLog","LocalStorage","throwIfNull","nullToUndefined","mix","distSquared","lenSquared","pointsToAngleRad","pointsToAngleDeg","isInsideRect","rect","clamp","rotate","rotateAround","center","rot","Matrix","Vec2","intDxy","fDx","fDy","roundEven","above","ceil","below","roundUneven","digits","digitMult","updateBounds","x1","y1","x2","y2","boundsInArea","projectPointOnLine","lineStart","lineEnd","PointLine","BezierLine","getBezierPoints","p3","p4","resolution","curvePoints","spacing","controlsCallback","pointLine","lastPoint","pointArr","lastSpacing","dir","lastDot","pointM1","pointM2","pointM3","tempSpacing","lastCallbackPoint","dAngle","lastAngle","addFinal","newP","SplineInterpolator","getFirstX","getLastX","interpolate","ya","klo","khi","xa","findX","tempX","tempY","tempDist","sort","wx","sig","ddydx","quadraticSplineInput","startVal","endVal","stepSize","dec","resultArr","copyCanvas","resultCanvas","drawImage","testShouldPixelate","transform","scaleX","scaleY","angleDeg","whSwapped","drawTransformedImageWithBounds","destCtx","transformImage","pixelated","save","imageSmoothingEnabled","imageSmoothingQuality","translate","restore","drawTransformedImageOnCanvas","baseCanvas","transformObj","angleDegree","createCheckerCanvas","createCheckerDataUrl","resizeCanvas","$13d5aa49e37e2734$export$59b33278b5b2fc8a","tmp1","tmp2","ew","eh","base2","getBase2Obj","oldW","oldH","newW","newH","oldWidthEx","log2","oldHeightEx","newWidthEx","newHeightEx","buffer1","buffer2","bufferCtx","globalCompositeOperation","currentWidth","currentHeight","newWidth","newHeight","tmp","canvasCtx","tmp1Ctx","convertToAlphaChannelCanvas","imdat","getImageData","putImageData","freeCanvas","canvasBounds","context","boundsObj","tempBounds","ColorConverter","testIsWhiteBestContrast","appendTextDiv","text","clearSelection","getSelection","sel","empty","removeAllRanges","makeUnfocusable","destroyEl","isInputFocused","unfocusAnyInput","focusEl","select","KeyListener","isPressed","getComboStr","comboOnlyContains","ref","onDown","onUp","onBlur","PointerListener","sameKeys","comboAStr","comboBStr","EventChain","DoubleTapper","NFingerTapper","failGesture","firstLastDownTimeout","tapTimeout","fingerArr","onTap","tempLastEventTime","lastEventTime","fingers","maxFirstLastFingerDownMs","downTimeMs","firstDownTime","maxTapMs","fingerObj","allAreUp","PinchZoomer","CoalescedExploder","eventCopy","isCoalesced","OnePointerLimiter","$970d7af44d8b8038$export$33e6c23ebe2ee669","$970d7af44d8b8038$export$d0d68bb9ed2c643d","$970d7af44d8b8038$export$f02cbd868e2f57cf","$63d0b335c576c718$export$991796128b2ca217","$63d0b335c576c718$export$64783e31db14f0ba","useLocalStorage","langs","navLangs","languages","language","unshift","lang","found","find","$63d0b335c576c718$var$activeLanguageCode","$63d0b335c576c718$export$ea44c9eff2c31da6","setLanguage","langCode","documentElement","getLanguage","getAutoLanguage","autoCode","getCode","subscriber","$63d0b335c576c718$export$ce37e184d908d785","$63d0b335c576c718$export$7a2ea9f2e4d199d3","onscroll","$3850a23a79465c04$exports","getBundleURL","$b9928cc2ba634150$exports","$2016c314bff36ab9$export$d7e8d4d4450c819c","autoFocus","clickOnEnterBtn","icon","isClosed","ignoreBackground","rootRootEl","right","bottom","overflow","rootEl","scrollContent","minHeight","display","flexDirection","justifyContent","alignItems","bgEl","close","xButton","titleHeight","background","boxShadow","ok","warning","upload","boxClasses","boxEl","marginRight","marginBottom","keyListener","comboStr","click","wheelPrevent","onclick","buttonRowEl","flexWrap","marginTop","marginLeft","btnElArr","buttonName","iconUrl","iconImg","btnClasses","primaries","label","src","btn","scrollTo","clickOnEnter","closeFunc","setIgnoreBackground","$18361e3f5d6257e8$export$185108a9b725b68","updatePos","onClose","animationName","animationDuration","animationTimingFunction","popupEl","borderRadius","elW","offsetWidth","elH","offsetHeight","innerWidth","innerHeight","titleEl","paddingLeft","tabindex","contentEl","$213947897b67ec3a$export$48513f6b9f8ce62d","getValue","checked","setValue","doHighlight","classList","toggle","getElement","onchange","innerEl","margin","allowTab","tabIndex","$760dd90d44275661$export$f5b8910cec6cf069","input","pointerListener","_p_type","_p_step","gap","step","lastValidValue","handleChange","oldVal","newValue","doResetIfInvalid","didChange","parseFloat","doScrollWithoutFocus","$760dd90d44275661$export$b7e3ae3d7c15e42e","$b1ef42bd443626ca$export$ef9b1a59e592288f","val","selectEl","setDeltaValue","optionArr","option","updateLabel","setOptionArr","changeListener","cursor","fontSize","padding","isFocusable","initValue","$a14a8e8cf8cc5885$export$b6d053cded550773","update","isActive","darkInvert","backgroundImage","image","isRadio","$fa6faa989b2cc6b2$export$7cc1012a658e6ad8","activeIndex","radioEl","initialIndex","createOption","initId","$cd94405b237f3b25$exports","$8d99bd5fadaac7f9$export$2358c75ad3c15b2d","pointerEvents","$218f70778c2bf652$export$9da2e8821e6cbb57","isChecked","changeCallback","toggleEl","backgroundSize","backgroundRepeat","$6e485eb0c82960d0$export$f8e41e222e32615d","isRightButton","$31b6ab403d8e5713$export$db3d4fde05db9a5e","lastValue","privateOnClose","scrollBefore","setIsEnabled","isEnabled","roundDigits","currentValue","onblur","scrollX","scrollY","$cd73d123a4560ac3$export$a1855b925e534de7","valueToSliderValue","useSpline","splineInterpolator","sliderValueToValue","sliderValue","displayValue","valueToDisplayValue","formatFunc","toLocaleString","unit","textEl","control","elementWidth","isFinal","isChangeOnFinal","eventResMs","emitInterval","clearInterval","emitValue","setInterval","updateEnable","sliderWrapperEl","manualInput","showManualInput","displayValueToValue","manualInputRoundDigits","changeSliderValue","config","curve","curveArr","isDisabled","pointerListenerTimeout","virtualVal","elementHeight","toValue","toDisplayValue","userSelect","oncontextmenu","labelFontSize","controlInner","doubleTapper","eventChain","deltaX","$832ede4dddff27fa$exports","$934e5f47c3374e21$export$db3b6bfb95261072","inner","_decomp_tagName","HTMLElement","decomp","$934e5f47c3374e21$var$decomposeElString","classes","$934e5f47c3374e21$var$applyStyleNames","styleNames","operations","color","bg","py","paddingTop","paddingBottom","pt","pr","paddingRight","pb","pl","mt","mr","mb","ml","grow","justify","items","hidden","nowrap","whiteSpace","minh","z","pos","pointer","$259a10c9e59c769e$var$insertWithoutScoping","$259a10c9e59c769e$var$merge","$259a10c9e59c769e$var$classnames","$c072f29bb0ad2433$var$_createEmotion","$c072f29bb0ad2433$export$dbf350e5966cf602","$49ce344532144fcf$export$cc42e119007cb939","lastValidRgb","previewEl","hexLabel","hexInput","rgbArr","copyButton","clipboard","writeText","hexRowEl","maxWidth","createRgbInputRow","labelStr","attributeStr","inputEl","borderCollapse","resultStr","$1675a096da5c857d$exports","$74a507c74cfe9692$var$LS_THEME_KEY","$74a507c74cfe9692$export$bca14c5b3b88a9c9","updateTheme","oldTheme","theme","storedTheme","mediaQueryTheme","readLocalStorage","addIsDarkListener","removeIsDarkListener","getMediaQueryTheme","getStoredTheme","setStoredTheme","$7a2aeb795d64bafc$export$e4203cb02d5e5b28","$8f768338795db7a0$export$66306bf21a9ff39e","updateSV","canvasSV","gradient1","createLinearGradient","colleft","colright","addColorStop","updateSVPointer","heightSV","pointerSV","updateHPointer","pointerH","setColor","getColor","svPointerListener","hPointerListener","svPointerId","hPointerId","canvasH","heightH","gradH","col","cssFloat","borderLeft","borderRight","virtualHSV","factor","clear","$867da577d723d824$export$ac00cea56cec3037","getEl","setActive","sliderPoint","backgroundColor","sliderPos","pointSize","redrawPoint","isFirst","imaginaryPos","$3032e23fa8f3a9e5$export$24ba9b81662d4366","colorArr","selectedIndex","buttonArr","updateCheckerboard","colorInput","oninput","_p_title","checkerUrl","onColorInputChange","newRawColor","sItem","colorButton","buttonSize","showPicker","setIsSelected","$1166276dc18d3ea9$export$c019608e5b5bb4cb","getIndex","selectedId","wrapperEl","classArr","isSmall","optionObj","changeOnInit","$ae5de6f4526dc7dd$exports","$855520c81dfcb96a$export$9b20165a36586806","$077740f52fe6870e$export$70ae2c07e401031b","denom","$bd2ee0a774cbe423$export$fce6876652108ab","$cf0617f9860dc277$export$d73ee8ef04f5226a","tx","ty","$611d5fdbbcda65d9$export$51186ad6e864892a","matrices","multiply","m1","m2","rest","$611d5fdbbcda65d9$export$f672e0b6f7222cd7","$20520e5c69c4ad5d$var$cos","$20520e5c69c4ad5d$var$sin","$20520e5c69c4ad5d$var$PI","$20520e5c69c4ad5d$export$bb628a54ab399bc9","cy","cosAngle","sinAngle","rotationMatrix","$a78c550eaaca7cca$export$dcdf75081b88279d","sx","sy","scaleMatrix","tan","$efe14c63f0506f3c$var$tan","$2c16fa132dd43ca2$export$f21cea08b0dd60e8","expected","location","setPrototypeOf","$2c16fa132dd43ca2$var$peg$padEnd","targetLength","padString","$a8ca0a6a49a8f94f$export$d562d1c5145f86d0","$0ca7fca685ce788f$var$fixScale","pixels","$2c16fa132dd43ca2$var$peg$subclass","C","format","sources","source","start","offset_s","offset","loc","filler","hatLen","buildMessage","DESCRIBE_EXPECTATION_FNS","literal","expectation","literalEscape","class","escapedParts","parts","part","classEscape","inverted","any","other","description","hex","ch","toUpperCase","describeExpectation","describeExpected","descriptions","$0ca7fca685ce788f$export$a140ed60c2ca052c","render","doResize","resFactor","useNativeResolution","devicePixelRatio","renderedTransform","project","renderedMat","drawBackground","pattern","scaledPixelX","scaledPixelY","setTransform","layers","layer","isVisible","mixModeStr","globalAlpha","res","setSize","doFillParent","getTransform","setUseNativeResolution","getUseNativeResolution","onIsDark","resizeListener","createPattern","oldDPR","imageRendering","fillParent","$28619fc623d210a6$exports","$eb15d36c7e085410$exports","$038147589e0b18d4$exports","$acb9aa66d548f601$exports","$0c94c5abf484f496$exports","$b18d1bd8e7aad78b$export$8c03162b1a39d183","oldScale","stepNum","newStep","$9ed053ee5aed84fa$export$99c68a89351e15c0","viewportPoint","canvasPoint","topLeftP","$87cc58581059531b$export$935bc53f7df03c95","viewportP","canvasP","$324add89932145ee$export$133773870222880f","requestRerender","doRender","resetOrZoom","isReset","viewport","reset","fit","transformCanvas","old","_t_vX","_t_vY","viewportRect","vX","vY","metaTransform","pointerChain","animationFrameId","cancelAnimationFrame","viewportPointerListener","modeToggle","_p_padding","oldTransform","lastEmittedTransform","renderLoop","requestAnimationFrame","viewportTransform","onTransformChange","newScale","tl","br","isInside","pinchZoomer","touchAction","hasEditMode","_p_editIcon","editIcon","backgroundPosition","onModeChange","elCss","hasBorder","borderTop","borderBottom","$15f04c4a93604cc0$exports","$c5a9090dbc3ef918$export$40175a5948a88a57","resetCrop","crop","getViewportSelectionRect","preview","updateCroppedCanvas","croppedCanvas","croppedImage","updateSelectionRect","selectionRectEl","eventTarget","removeProperty","getRect","getCroppedCanvas","param","startP","updateCropTimeout","mode","isInsideSelectionRect","isNotCopy","Image","hasClipping","genCrop","inverseMat","bottomRightP","origTopLeftP","origBottomRightP","startCrop","isDragging","didMove","doUpdate","shiftIsPressed","$469fa98e1403db53$var$moveIndex","$469fa98e1403db53$var$testAndFill","srcArr","targetArr","initRgba","tolerance","$469fa98e1403db53$export$13d50f258a8034f","rgbaArr","isContiguous","Uint8Array","ArrayBuffer","$469fa98e1403db53$var$floodFill","px","x0","y0","tr","bl","q","$469fa98e1403db53$var$fillRect","$583d130d11db85ad$export$71b514a25c47df50","shapeObj","isOutwards","isEraser","doLockAlpha","lineWidth","fillRgb","strokeRgb","colorRGB","strokeStyle","isAngleSnap","r1","r2","pAngleDeg","pAngleDegSnapped","rotated","isFixedRatio","rx","ry","rdX","rdY","x1r","y1r","x2r","y2r","x1f","y1f","x2f","y2f","beginPath","moveTo","lineTo","stroke","strokeRect","ellipse","fill","$67e715fe604c9329$export$482c90f94eb9717c","textAlign","align","letterSpacing","fontArr","font","isBold","isItalic","lineJoin","lines","lineIndex","_p_lineHeight","metrics","measureText","mRect","$67e715fe604c9329$var$textMetricToRect","_metrics_fontBoundingBoxAscent","_metrics_fontBoundingBoxDescent","ascent","fontBoundingBoxAscent","actualBoundingBoxAscent","descent","fontBoundingBoxDescent","actualBoundingBoxDescent","strokeText","fillText","$2b8bf7b32e5ba51f$export$5f63a7b18dc4503a","$64881aa9f7f8f596$export$b1f70a113e3b5c1b","gradientObj","gradient","doSnap","baseColor","color1","color2","isReversed","temp","createRadialGradient","$d26b85e649dca02a$var$allowedMixModes","$326f2f7e3662b29f$export$6e1bedb2a6cdff30","blendMode","codes","$4ef8c9863a7c659b$exports","$be599a9dc46f5101$export$e44a253a59704894","rootElement","setEnabled","enabled","onSetEnabled","isExpanded","buttonTitle","itemMap","itemButton","onItemClick","disabled","menu","force","contains","$ba2d502a1716cf71$exports","$354ec009c03792ca$exports","$11941175d9bc2cc9$exports","$26ad1ae4e7165e60$exports","$7a2d968e7fdd2ce9$exports","$336ce3ce60e7688c$export$6b9252711ea5997f","compass","updateCursor","brushCircleOuter","brushCircleInner","radius","updateColorPreview","pickerPreviewCol","pickerPreviewBorder","borderColor","updateCompass","compassInner","compassLineCircle","compassSize","transition","compassBaseCircle","compassUpperTriangle","compassLowerTriangle","$6fd92874f57fb7a5$exports","$bbfe35d8993ac0b3$exports","$31fff149ff4d9066$exports","$49c01d25d090419f$exports","$c840f4bdaa4c78fa$export$d429e21f52463d17","downEvent","direction","onDraw","pressure0","pressure1","eventQueue","$5a2f7ed66bdaf6a4$export$4d6077ff8d823dfb","filenameBase","$3a2f95de72e4a634$var$MIN_SCALE","$f48eb0413169e026$export$e258ade1648009b7","clearRect","$0a34fd024ca1cadf$exports","$9e052f3767af1736$export$958c2bfe8d7142a9","$9e052f3767af1736$export$234b1c16dfa57d6a","$9e052f3767af1736$export$3fba3b383c654cc6","$d42d1384577ab84d$export$79a74567acf241b0","updateScaled","scaled","corners","snapCorner","iX","iY","_snap_x","_snap_y","snappingEnabled","snap","snapX","minSnapDist","snapY","constrainCorner","cornerIndex","isConstrained","flip","ratio","updateCornerPositions","restoreRatio","widthChanged","heightChanged","angle90","updateTransformViaCorners","updateDOM","skipCallback","transEl","transformOrigin","boundsEl","edges","angleGrip","setIsConstrained","setSnapping","setPos","move","setAngleDeg","setViewportTransform","getRatio","boundsPointerListener","anglePointerListener","isInverted","cornerCursors","gripSize","edgeSize","pointerRemainder","boundsStartP","distX","distY","iP","projected","border","virtualPos","offsetArr","tinyOffset","tP","indexes","angleOffset","isVertical","tfD","ti","dimension","snapDeg","$03ec3d6a52165003$exports","$1fee4e0c7c231d15$export$205c2dd29f8a66b5","updatePreview","freeTransform","previewCanvas","transformIndex","initTransform","setTransformFit","imageWidth","imageHeight","setTransformCenter","getTransformation","getIsPixelated","previewLayerArr","_item_mixModeStr","$c4e8a5b20c195c16$export$71ed2b85d4ca43d3","cornerElArr","darken","outline","thirdsHorizontal","thirdsVertical","commit","grips","setScale","showThirds","outlinePointerListener","corner0PointerListener","corner1PointerListener","corner2PointerListener","corner3PointerListener","edge0PointerListener","edge1PointerListener","edge2PointerListener","edge3PointerListener","maxW","maxH","gripCursors","transformTop","transformRight","transformBottom","transformLeft","gripOverlay","$8522c24dbe0f81fc$export$8f6817a932bf45cd","$3ec5d4ed5944260f$export$d9bc74bec37df668","$3ec5d4ed5944260f$export$858e9cb22b0cda44","$3ec5d4ed5944260f$export$8b9199c1f5e4be8","$3ec5d4ed5944260f$export$94cffdbcf128864a","$3d723e4f59a76a82$exports","$731c195c2658f60e$exports","$080ff6c52dc9a16e$exports","$2612ca0d980e3a29$exports","$942db5a6ac0c3c49$exports","$2959e7daff7bd0dd$exports","$213fe7f980258b46$exports","$b4e2f077fc10d34e$exports","$7b6a173d3ec8bb59$exports","$fc02e0eba0126db4$exports","$b210eded9e92d550$exports","$d199831ecec4fae4$export$a0a40f8a0b8fee15","updateButton","activeButton","titleArr","currentActiveIndex","activeButtonIm","imArr","setIsSmall","smallMargin","dropdownBtnArr","arrowButton","activeStr","getActive","openTimeout","startX","startY","isOpen","showDropdown","elementFromPoint","wrapper","closeDropdown","boxSizing","overlay","dropdownWrapper","borderBottomLeftRadius","borderBottomRightRadius","createDropdownButton","show","onClickDropdownBtn","$b91422aab73859a6$exports","$21e002c0f7a05108$exports","$ae064bc6cfaee2ee$export$3c6d17ed0106bfb9","tabArr","activeTab","open","tabId","onOpen","roundRight","roundLeft","getOpenedTabId","setIsVisible","_p_height","roundSize","createTab","pTabObj","initialId","useAccent","openedTabObj","isOver","initTabObj","tab","$49efe074a761be4a$exports","$1b372d80cb7a52ec$export$9852986a3ec5f6a0","cellProps","row","rowIndex","rowEl","colIndex","cellEl","rowSpan","rowspan","$eb0faa9ee2fc3d88$exports","$5b663384e3b198ee$export$5cdfb22682d2a5dd","getValues","colorOptions","opacitySlider","onUpdate","colorOptionsArr","primaryColor","secondaryColor","svg","viewBox","childrenArr","$522d9ab1067712c4$exports","$e49bc9b550fae0b8$exports","$cffa7645bde262ed$exports","$59cebb3a23fccb55$exports","$b64406475c6f0850$exports","$1363e91d0ff2319d$exports","$2ae282efbf4a82b0$exports","$1c6e8e1187fd527a$exports","$420d435aedfcbcaf$exports","$7ecf019a8305bae0$exports","$cd209a85e47d47d8$exports","$99a6c57c852271ab$exports","$d5c2f2536a6b106c$exports","$e510888715a1a128$exports","$707db6a2345e41f4$exports","$28be07e609531d97$exports","$bc9d3745edcd36ae$exports","$0f0fc84a91258816$exports","$ff342a99ee3ddda9$exports","$e21e0b9213031611$exports","$87708897e681fd5f$exports","$8e39776a1261b902$export$f45fbea8fe20ca8a","url","$0d66a3ca6c18ec8d$var$importedFonts","fontFamily","fontName","$0d66a3ca6c18ec8d$var$didLoadBundledFonts","$0d66a3ca6c18ec8d$var$loadBundledFonts","promises","response","fetch","buffer","arrayBuffer","FontFace","fonts","all","$0d66a3ca6c18ec8d$export$2e7faedafda1fc85","loadBundledFonts","fontSelect","importFont","multiple","accept","toSelect","fontFamilies","file","importButton","innerText","sizeInput","letterSpacingInput","lineHeightInput","alignRadioList","italicToggle","boldToggle","fontPointerListener","onFocus","_p_letterSpacing","sizeLabel","$c73fdb6c21e3a26a$export$42bb0e3b48d549f6","lineWidthSlider","$be275a032c52a6ed$export$c6656360602b35c2","textInput","lastEmittedText","onInput","placeholder","resize","$4ada09c4693c46d4$export$1d311696e0fb2158","canZoom","zoomFac","changeZoomFac","zoomInBtn","zoomOutBtn","rotationSlider","textCtx","textCanvas","transformedOffset","rotatedXY","rotatedWH","centerX","centerY","fitBounds","targetCtx","layerArr","layerIndex","layersCtx","borderSize","emptyCanvasLight","emptyCanvas","targetCanvas","previewCtx","checkerPattern","layersCanvas","getInputsElement","inputsRootEl","setText","previewWrapper","interval","eventCapture","previewPointerListener","onDarkChange","isSmallWidth","isSmallHeight","klCanvas","getLayersFast","getWidth","getHeight","dragged","offsetDragged","onDragEnd","rad","$e9d04a247aa46c18$exports","$e9d04a247aa46c18$var$init","reverse","$e9d04a247aa46c18$export$6df36f0c42d2440f","$e9d04a247aa46c18$export$4e3b1f7d3ad623b4","$e9d04a247aa46c18$export$3d649861c4b13fa2","psdObj","layerCount","addWarning","warningStr","warningArr","getMixModeStr","bitsPerChannel","countWithinGroup","groupObj","clipping","adjustment","prepareMask","maskCanvas","defaultColor","groupMaskCtx","imData","convertGroup","psdGroupObj","groupCanvas","groupCtx","groupIsVisible","groupOpacity","groupMixModeStr","mask","convertedChildGroupItems","innerItem","innerCtx","clippingCanvas","clippingCtx","clippingItem","effects","$e9d04a247aa46c18$export$56493bf279c387b3","klPsd","$c122457b67184bc9$exports","$c122457b67184bc9$export$1347f8be1f25c479","$c122457b67184bc9$export$1448a0dd0d3fde8e","$c122457b67184bc9$export$21ade4eb935254aa","$c122457b67184bc9$export$42ffd38884aecdac","$c122457b67184bc9$var$indexedDbIsSupported","indexedDB","$c122457b67184bc9$var$dbNameStr","$c122457b67184bc9$var$storageNameStr","$c122457b67184bc9$var$execIndexedDBTransaction","actionFunction","successCallback","errorCallback","requestObj","hasFinished","onError","errorStr","onupgradeneeded","store","db","createObjectStore","keyPath","createIndex","unique","onsuccess","databaseObj","transactionObj","storeObj","objectStoreNames","deleteDatabase","transaction","objectStore","oncomplete","query","storageProject","put","delete","$f698b2728458c67c$exports","$40d2759ce9a63d61$exports","$ce8cff2073e0dbd0$exports","$ac0aca426899243b$exports","$b10b50b35445327f$exports","$2b9d4bef1fb7a247$exports","$593ff3f236561579$exports","$d8f018e35a94ad80$exports","$08a9274b2d3ddb77$exports","$4cf8ddf6b6b87b44$exports","$a1a23269f02c60e3$exports","$f6c5ea2c2b7b2ebc$exports","$527aa9d5f9dc6831$exports","$6d8eb0c4a83eec4b$exports","$848d8b186ce3b8b1$exports","$27475547fcd62d76$exports","$e034fd153bdc6206$exports","$aa2ca71db1de8ae6$export$7a4e0b62a5d854bc","isLoaded","$aa2ca71db1de8ae6$export$395d33c8e06b92c9","brightnessContrast","getDialog","inEmbed","webGL","cropExtend","curves","distort","hueSaturation","darkNoInvert","invert","perspective","tiltShift","toAlpha","unsharpMask","grid","noise","vanishPoint","$f49636f27554dab5$var$myModule","$f49636f27554dab5$var$Grad","dot2","$f49636f27554dab5$var$grad3","$f49636f27554dab5$var$p","$f49636f27554dab5$var$perm","$f49636f27554dab5$var$gradP","seed","$f49636f27554dab5$var$F2","$f49636f27554dab5$var$G2","$be08c7e8caa49ffa$export$74a44bbc21d06a28","scaleFac","createImageData","sFac2","simplex2","noisePattern","centerDist","$be08c7e8caa49ffa$export$eaa218d5d17c8f1c","centerSize","transitionSize","pDist","$be08c7e8caa49ffa$var$udSegment","ba","pa","xin","yin","n0","n1","n2","i1","j1","gi0","gi1","gi2","t0","t1","t2","$f1a560137f603778$export$d116ae91f77f1f19","$ab3d0b0688f50842$var$TWO_PI","$ec1ed8bc550ccd88$var$sampleCanvas","$ec1ed8bc550ccd88$var$sampleCtx","$8baf89d70f3487eb$export$7d68cd8857639377","PenBrush","updateAlphaCanvas","settingAlphaId","instructionArr","alphaCanvas128","alphaCanvas64","alphaCanvas32","settingColor","alphaOpacityArr","calcOpacity","settingOpacity","settingHasOpacityPressure","drawDot","settingLockLayerAlpha","settingColorStr","arc","closePath","hasDrawnDot","targetMipmap","continueLine","bezierLine","lastInput","drawArr","dotCallback","localPressure","lastInput2","localOpacity","localSize","settingSize","settingHasSizePressure","localSpacing","settingSpacing","startLine","historyEntry","actions","inputIsDrawing","lineToolLastDot","inputArr","goLine","endLine","maxInput","history","drawLineSegment","loopDist","mouseDist","eX","eY","bdist","isDrawing","setAlpha","setContext","setHistory","setOpacity","setSpacing","sizePressure","opacityPressure","setLockAlpha","getSpacing","getSize","getOpacity","getLockAlpha","$49faab2330529a96$export$6e4a713ddcda1e5e","DecoyKlHistory","BlendBrush","updateRedrawBounds","redrawBounds","getCellsWidth","drawChangedCells","cells","touchedCells","getTouchedCells","isTouched","drawCells","cellsW","sliceBounds","cell","cellOffsetX","cellOffsetY","cellWidth","cellHeight","inCellBounds","copyFromCanvas","tmpCanvas","tmpCtx","getAverage","ar","ag","ab","aa","alpha","slicedBounds","e2","prepDot","randI","randLen","randArr","samples","sampleArr","samplesSquared","sampleOffsets","sharpness","invSharpness","sizeSquared","distDivisor","alphaMinuend","ri","re","alphaO","invAlphaO","alphaU","underR","underG","underB","newAlpha","calcSpacing","localColNew","drawBuffer","settingSizePressure","bDist","avgX","avgY","blending","mixCol","average","localColOld","avgParams","blendCol","blendMix","bezierCallback","settingOpacityPressure","getBlending","setBlending","setSizePressure","setOpacityPressure","getIsDrawing","setIsTesting","isTesting","totalCells","imageData","SketchyBrush","rand","sketchySeed","setSeed","getSeed","settingBlending","getScale","settingScale","lastX","lastY","p_x","p_y","preMixedColor","mixr","mixg","mixb","mixX","mixY","mixW","mixH","imDat","countMix","mixed","mixMode","c1","c2","PixelBrush","updateDither","ditherCtx","settingIsEraser","ditherArr","ditherPattern","ditherCanvas","cubicCurveOverThreshold","maxAngleRad","d2","d3","plotCubicBezierLine","isOverThreshold","plotLine","settingUseDither","controlCallback","controlObj","skipFirst","sX","sY","setIsEraser","setUseDither","getIsEraser","getUseDither","ChemyBrush","updateCompleteRedrawBounds","settingXSymmetry","settingYSymmetry","settingMode","completeRedrawBounds","drawShape","path","Path2D","settingGradient","startAtTop","minY","maxY","draw","setMode","getMode","setDistort","settingDistort","getDistort","setXSymmetry","getXSymmetry","setYSymmetry","getYSymmetry","setGradient","getGradient","historyCanvas","historyCtx","SmudgeBrush","resetRedrawBounds","copiedCells","copyImageData","e3","$baef4a032d46c3b8$var$prepSmudge","imWidth","imHeight","aP","bP","brush","alphaLock","$baef4a032d46c3b8$var$smudge","cSize","cX","cY","aIndex","bIndex","softnessPx","pixel","ai","bi","ix","iy","fac2","bx1","bx2","yStart","ImageData","historyIm","EraserBrush","isBaseLayer","isTransparentBG","radgrad","oFac","useSizePressure","useOpacityPressure","started","_this_historyEntry_actions","setTransparentBG","$4d613c579dce68ed$exports","$74487dc42eb45244$export$a0d4983f3b0b5c8e","brushInterface","tooltip","sizeSlider","alphaNames","Ui","onSizeChange","alphaOptions","lockAlphaToggle","spacingSpline","onOpacityChange","pressureSizeToggle","pressureOpacityToggle","increaseSize","decreaseSize","getBrush","$d0b3741389f08f3c$exports","$389b24b4f03b3a27$export$156bb4fe8f4bcb4b","blendingSlider","$04232cea90849ea3$exports","$ed2b11ff6c0e7481$export$ffae56164d1bde68","blendSlider","scaleSlider","$dea88774f907e549$exports","$c8f3acddc3f49bc0$export$d001f3406562d07","eraserToggle","ditherToggle","toggleRow","toggleEraser","$901bf8c8c32809dc$exports","$411f23605301883c$export$cf481ecf227135a8","isTransparentBg","transparencyToggle","getIsTransparentBg","$ac5f262f132efcf8$exports","$4218d17c2806f1f8$export$84831662ba707e7a","bottomRow","$6f76f2b9c1cc7b0f$exports","$720edf36b0105568$export$80819a93636ebb04","modeOptions","iconSize","brushSize","onConfigChange","mirrorXToggle","mirrorYToggle","gradientToggle","$165d2995997b2f9b$export$35fa34e5af64bd4a","isEmbed","linkEl","iframe","href","popup","onload","contentWindow","isMaxHeight","$1a83f3b0ed28fe18$export$9c72cf485ef46673","updateAge","ageStr","timestamp","age","ageEl","resetButtons","storeButtonEl","clearButtonEl","updateThumb","thumbnail","projectStore","getProject","saveReminder","klRootEl","hide","infoEl","storeListener","_this_options","gridTemplateColumns","gridTemplateRows","gridTemplateAreas","gridArea","isBroken","textSize","btnCustom","hideClearButton","visibility","readResult","read","$dda762a0c02e643a$export$b3fb17ae4345ac8f","base64Str","binStr","atob","view","$c39dea662ab37110$var$loadImage","revokeObjectURL","onabort","$c39dea662ab37110$export$f3c1ac6650038646","createThumbnail","createStorageProject","HTMLCanvasElement","readStorageProject","storageLayer","$e42d359db0fc5c76$var$makeAsync","nonAsyncFunc","$ace2472bd08b6811$exports","$ed5eddfb5f6912a0$export$d731e22ecd0c25d3","shader","uniforms","textureIn","textureOut","_","texture","use","spareTexture","drawTo","drawRect","swapWith","$ba022370a1e95297$export$7d9b0d118d0c4108","getDefaultShader","defaultShader","compileSource","nameStr","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","testPrecisionSupport","precisionType","getShaderPrecisionFormat","FRAGMENT_SHADER","precision","deleteProgram","program","useProgram","getUniformLocation","uniform1fv","Float32Array","uniform2fv","uniform3fv","uniform4fv","uniformMatrix3fv","uniformMatrix4fv","uniform1f","textures","uniform1i","getParameter","VIEWPORT","vertexBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","texCoordBuffer","vertexAttribute","getAttribLocation","enableVertexAttribArray","texCoordAttribute","vertexAttribPointer","FLOAT","drawArrays","TRIANGLE_STRIP","vertexSource","fragmentSource","createProgram","HIGH_FLOAT","MEDIUM_FLOAT","attachShader","VERTEX_SHADER","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","$7aae3f183f304a55$export$6408eeb1703e74b8","brightness","contrast","$4f7270b6400c73d7$export$7e6fd232cff50dd1","fromElement","RGBA","UNSIGNED_BYTE","loadContentsOf","videoWidth","videoHeight","bindTexture","TEXTURE_2D","texImage2D","initFromBytes","deleteTexture","activeTexture","TEXTURE0","unuse","ensureFormat","ensureFormatViaTexture","framebuffer","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","gl","createTexture","texParameteri","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","$6d7ade6aa4027844$export$4f237735eca1f248","interpolator","array","$38704cd148486d5a$export$6894093bf294bea5","red","green","blue","redRamp","greenRamp","blueRamp","extraTexture","$f13b1fa3c138ed02$export$ef28bbbd731e79bf","hue","saturation","$c0f1e1206ce9bdf1$exports","$615309a02e3c3ec4$export$d3022aad56692482","octaves","peaks","colA","colB","channels","texSize","$aec050322e5cb9b9$export$af69f7ca07da04c9","$c794506a27d0c6d6$export$6e852234f1597a14","triangleBlur","$caa405d6896c91bf$export$4545acb2b6bb8f22","endX","endY","blurRadius","gradientRadius","dx","dy","$83fc0aef7d823507$export$820b3a44cb7b2b21","uniformsStr","warpStr","$a7bdfb25622fe8b9$export$1c447127d27d7be4","x3","y3","dx1","dy1","dx2","dy2","dx3","dy3","det","$a7bdfb25622fe8b9$export$68b3343017e80691","$4f209890e041e7d6$export$a93b0222aeadc54b","inverse","useTextureSpace","matrixWarp","$41fe2bf18cc268d3$export$915fb7313c578ba2","strength","originalTexture","$12b73c4d8c20eb5a$export$be1ee5ea42904fdc","replaceRGBA","$6109e928236947f2$export$6897c284b6f9f4dc","$7d03762724365e43$export$541149539f3a4684","after","$1b7199a5e15fe4d8$export$b324c80262feb891","unmultiplyAlpha","$8f4949fd56b66485$export$7c9b924528782480","settings","distortType","phase","$7b72315ed3e98576$export$57b05c961ff98d6a","multiplyAlpha","$03f71ba115904ed2$export$a04cfca62fd2892f","wrapTexture","initialize","textureType","getTextureType","getExtension","testTexture","flippedShader","isInitialized","contents","getPixelArray","readPixels","wrap","WebGLRenderingContext","premultipliedAlpha","contextNames","$5caaf17bca0749c7$var$failed","$5caaf17bca0749c7$var$fx","$5caaf17bca0749c7$export$8c4423af32b21158","isContextLost","$9add721614c7ca2f$exports","$1acd53d54391923e$var$upload","imgurKey","img","gif","filter","labelText","formData","FormData","method","headers","Authorization","json","link","$e4b3248b4ce95ea5$export$ab3d838b1d336b38","$5ecc5a61dcd332b6$var$LS_REMINDER_KEY","$39ab97e4ee30a834$export$2bc2a80e311129ac","download","rel","$0eb1f8ad6bbf0528$var$execHistoryEntry","brushes","setCurrentLayerCtx","getCurrentLayerCtx","getLayerContext","filterLib","addLayer","renameLayer","$2cc9052c3f36f7f1$export$272bfd3ef9ef2f48","skipSubscriber","subscriberArr","emitColor","emitSize","emitOpacity","emitSliderConfig","sliderConfig","onSetColor","onSetSize","onSetOpacity","onGetColor","onGetSize","onGetOpacity","getSliderConfig","onGetSliderConfig","instance","$324b66e6d8cad1f5$exports","$bd9eeb1157230cb2$exports","brushesUI","penBrush","blendBrush","sketchyBrush","pixelBrush","chemyBrush","smudgeBrush","eraserBrush","BrushSettingService","KlCanvas","emitChange","changeListenerArr","updateIndices","layerCanvasArr","layerOpacity","layerName","layerFill","isLayerLimitReached","toCopyCanvas","origLayers","getLayers","removeLayer","getLayerCount","algorithm","layerCanvas","layerContext","offX","offY","ctemp","layerCtx","fillColor","selected","layerNrOffset","duplicateLayer","doReturnNull","setLayerIsVisible","moveLayer","targetIndex","mergeLayers","layerBottomIndex","layerTopIndex","topOpacity","mergeAll","isHorizontal","tempCtx","colorObj","compositeOperation","floodFill","rgb","sampleStr","targetImageData","srcCanvas","getCompleteCanvas","srcImageData","srcCtx","srcIndex","targetData","drawGradient","replaceLayer","clearLayer","getLayerIndex","canvasObj","getLayer","getColorAt","pickCanvas","addChangeListener","removeChangeListener","setMixMode","setComposite","compositeObj","inLayers","projectObj","drawProject","WorkspaceSvgOverlay","KlCanvasWorkspace","getRenderedTransform","renderedTransformObj","highResTransformObj","updateChangeListener","lastRenderedState","reqFrame","modeInt","doForce","currentMode","oldMode","globalMode","oldIsHand","currentIsHand","mainDoubleTapper","svgOverlay","internalZoomByStep","targetTransformObj","effectiveFactor","origin","transformIsDirty","mixTransformObj","transformA","transformB","blendFactor","centerPosA","canvasToWorkspaceCoord","centerPosB","mixedPos","doResizeCanvas","renderTargetCanvas","renderWidth","renderHeight","renderContext","renderTargetCtx","testBgVisible","workspacePointArr","art","coords","bgVisible","emptyLightCanvas","compositeCanvas","compositeCtx","workspaceToCanvasCoord","snapAngleRad","snapDegIncrement","maxDistDeg","modDeg","minimizeAngleRad","resetInputProcessor","currentInputProcessor","doRedrawCanvas","animationFrameRequested","updateLoop","newState","elapsedFrames","lastRenderTime","checkChange","doAnimateTranslate","brushRadius","$3a2f95de72e4a634$var$ANIMATION_SPEED","usesCssCursor","renderTime","setCanvas","klC","lastDrawEvent","resetView","oldWidth","oldHeight","setCursorSize","diameter","hideBrushCursorTimeout","zoomByStep","onViewChange","changed","doAnimate","fitView","newAngle","canvasPointsArr","boundsWidth","boundsHeight","fitWidth","newTargetTransformObj","resetOrFitView","disableAutoFit","setAngle","isRelative","centerObj","oldAngleRad","translateView","getAngleDeg","getMaxScale","getMinScale","requestFrame","setLastDrawEvent","oldTransformObj","cursorPos","isRepeat","dialogCounter","onKeyDown","inputProcessorObj","spaceHand","altPicker","onKeyUp","linetoolProcessor","getMatrix","coord","onFill","onGradient","onText","shape","onShape","hand","offsetX","offsetY","picker","pickedColor","onPick","startAngleRad","dAngleRad","angleIsExtraSticky","middleDoubleTapper","twoFingerTap","onUndo","threeFingerTap","onRedo","pointerEventChain","wheelEvent","KlCanvasPreview","filterLibStatus","UndoRedoCatchup","shouldIgnoreTest","doIgnore","getKlCanvas","initState","getInitState","oldSize","entry","klCanvasWorkspace","handUi","layerManager","layerPreview","setLayer","brushUiMap","getCurrentBrush","currentLayerIndex","catchup","logParam","localCurrentLayerCtx","renderText","floodFillBits","ShapeTool","downX","downY","downAngleRad","onMove","GradientTool","PSD","setDbName","indexedDb","ProjectStore","lowLevelStore","lowLevelRead","lowLevelClear","updateTimestamp","accessHasFailed","loadAgPsd","SaveToComputer","saveImage","filename","mimeType","getExportType","fullCanvas","fileBase","fnameArr","psdConfig","blendKlToPsd","agPsdLazy","writePsdBuffer","calcSliderFalloffFactor","Checkbox","Select","ImageToggle","ImageRadioList","RadioList","inputs","ignoreFocus","createPenPressureToggle","KlSlider","HexColorDialog","KlColorSlider","updatePrimaryHSV","hsv","primaryColorHSV","updateSVCanvas","hueStop","svHeight","setColPreview","divPreview","primaryColorRGB","pickerButton","hexButton","updateSecondaryColor","secondaryColorBtn","secondaryColorRGB","controlH","getSecondaryRGB","setPickCallback","pickCallback","pickingDone","isPicking","enable","outputDiv","setHeight","svSvg","SVContainer","swapColors","secondaryColorHSV","getOutputElement","startValue","svWrapper","DOMParser","parseFromString","querySelector","divH","createHueBg","targetEl","cv","alt","KlColorSliderSmall","PointSlider","ColorOptions","Options","BoxToggle","StatusOverlay","updateUiState","uiState","setWide","isWide","setUiState","out","doPulse","angleIm","innerInnerEl","timeout3","timeout","timeout2","verticalAlign","CropCopy","FreeTransform","FreeTransformCanvas","Cropper","LayerPreview","updateCheckerPatterns","checker","animationCanvasCheckerPattern","animationCanvasCtx","largeCanvasCheckerPattern","animate","animationCount","animationLength","animationCanvas","drawLargeCanvas","largeCanvasIsVisible","layerObj","canvasDimensions","largeCanvasSize","largeCanvas","largeCanvasCtx","largeCanvasWrapper","layerIsVisible","checkEl","parentElement","nameLabelEl","opacityEl","lastDrawnSize","canvasSize","lastDrawnState","contentWrapperEl","currentState","klCanvasLayerObj","stateStr","largeCanvasAnimationTimeout","checkWrapper","canvasWrapperEl","minWidth","nameWrapper","clickableEl","webkitTouchCallout","removeLargeCanvas","showLargeCanvas","largeCanvasAnimationDurationMs","KlImageDropper","textShadow","optionStyle","optionLayerEl","optionImageEl","rootCounter","optionLayerCounter","optionImageCounter","testAcceptType","dataTransfer","types","updateOptions","enabledTest","optionStr","onDrop","OverlayToolspace","sizeObj","hHeight","sliderHeight","queuedObj","colorEl","colorSlider","brushSettingService","selectedColorEl","subscriptionFunc","initialColor","updateColor","updateUI","mousePos","ToolspaceTopRow","createButton","extraPadding","contain","logoButton","onLogo","logoImg","newButton","onNew","onImport","saveButton","onSave","shareButton","onShare","helpButton","onHelp","ToolDropdown","ToolspaceToolRow","toolDropdown","handButton","zoomInButton","zoomOutButton","undoButton","redoButton","zoomInNOutButton","undoNRedoButton","setEnableZoomIn","setIsEnabledLeft","setEnableZoomOut","setIsEnabledRight","setEnableUndo","setEnableRedo","doEmit","currentActiveStr","onActivate","doLighten","doMirror","createTriangleButton","preserveAspectRatio","defs","in","stdDeviation","in2","operator","k2","k3","svgTriangleLeft","onLeft","svgTriangleRight","onRight","leftPointerListener","rightPointerListener","leftIm","leftImage","rightIm","rightImage","onZoomIn","onZoomOut","ToolspaceStabilizerRow","strengthSelect","smoothing","onSelect","TabRow","ToolspaceCollapser","directionStr","stateIsOpen","setDirection","dirStr","BrowserStorageUi","SaveReminder","showPopup","lastSavedAt","psdWrapper","storageWrapper","psdBtn","onSaveAsPsd","storageUi","lastReminderShownAt","lastSavedActionNumber","showReminder","visibilityState","unsavedActions","timeLimitMs","setting","onbeforeunload","onBeforeUnload","changeTitle","unsavedInterval","returnValue","getSetting","setSetting","_localStorage_getItem","ToolspaceScroller","newUpDisplay","upBtn","newDownDisplay","downBtn","toolspace","scrollHeight","upInterval","downInterval","scrollBy","wheelListener","observer","MutationObserver","observe","attributes","childList","subtree","Popup","clipboardDialog","cropCallback","output","showCropButton","cropTimeout","clipboardItemIsSupported","ClipboardItem","topWrapper","cropCopy","toClipboard","write","KeyEvent","rectObj","showImportAsLayerDialog","noteEl","originalSizeBtn","freeTransformCanvas","fitSizeBtn","centerBtn","klCanvasLayerArr","importImage","buttonStr","newImageDialog","currentColor","maxCanvasSize","canvasWidth","canvasHeight","workspaceWidth","workspaceHeight","onConfirm","onCancel","createRatioSize","ratioX","ratioY","newImDiv","widthInput","unitStyle","widthUnit","heightInput","heightUnit","updateRatio","sizeTable","ratioWrapper","templateWrapper","presetFitBtn","presetCurrentBtn","presetSquareBtn","presetLandscapeBtn","presetPortraitBtn","presetOversizeBtn","screen","backgroundRGBA","initColorIndex","commonRatios","reducedArr","closestRatio","closestDistance","realw","T","hcf","U","V","onkeyup","secondRow","secondRowLeft","textToolDialog","viewportWrapper","viewportUI","tabs","textUI","fontUI","colorWrapper","fillUI","strokeUI","modal","viewportInputsCss","tabWrapperCss","inputsCss","onResize","onScroll","showImportImageDialog","flattenCheckbox","warningsEl","resolutionEl","updateResolution","maxSize","doFlatten","warnings","showWarnings","psdWarningArr","contentArr","warningMap","cropRect","isCropped","cropObj","showIframePopup","imgurUpload","inputTitle","inputDescription","rows","labelTitle","labelDescription","tos","typeRadio","outDiv","infoHint","deletehash","HandUi","updateUi","scaleEl","angleEl","pIsVisible","pScale","onAngleChange","resetButton","onReset","fitButton","onFit","leftRotateButton","resetAngleButton","rightRotateButton","FillUi","colorDiv","getTolerance","toleranceSlider","getSample","modeSelect","getGrow","growSelect","getContiguous","selectRow","modeWrapper","growWrapper","contiguousToggle","GradientUi","updateIcons","col1","col2","iconArr","getSettings","typeOptions","reverseToggle","doSnapToggle","TextUi","ShapeUi","getShape","getLineWidth","getIsOutwards","outwardsToggle","getIsFixed","fixedToggle","getIsSnap","snapToggle","getDoLockAlpha","rectStrokeSvgRect","rectStrokeSvg","rectFilledSvgRect","rectFilledSvg","ellipseStrokeSvgEllipse","ellipseStrokeSvg","ellipseFilledSvgEllipse","ellipseFilledSvg","lineSvgLine","lineSvg","updatePreviews","shapeOptions","FileTab","refresh","triggerImport","exportType","onExportTypeChange","onFileSelect","onSaveImageToComputer","onNewImage","onShareImage","onUpload","onCopyToClipboard","fileMenu","uploadImgurButton","clipboardButton","importWrapper","innerMask","importFakeButton","exportTypeSelect","saveNote","createSpacer","clearer","fileBrowserStorage","saveRow","FilterTab","testHasWebGL","filters","hasWebGL","note","noteButton","filterKey","buttonLabel","filterName","finishedDialog","filterDialog","getInput","applyFilter","statusOverlay","klColorSlider","getKlMaxCanvasSize","maxHeight","currentColorRgb","getCurrentColor","secondaryColorRgb","addGroup","groupArr","isInit","SettingsTab","onLeftRight","customAbout","autoLanguage","langWrapper","languageSelect","languageHint","themeToLabel","themeSelect","reminderSelect","disableStr","makeLicenses","licensesCss","libraries","overflowY","replaceState","pathname","search","licenses","full","fontLicenses","minimalAbout","versionEl","LayerManager","oldSpotIndex","newSpotIndex","posy","layerElArr","spot","posY","layerHeight","layerSpacing","selectedSpotIndex","mergeBtn","posToSpot","updateLayersVerticalPosition","newspot","lastpos","layerSpot","parentEl","currentName","clearBtn","suggestions","suggestionBtns","newName","createLayerList","updateHeight","layerListEl","oldHistoryState","checkerImUrl","createLayerEntry","oldOpacity","klLayer","layercanvas","innerLayer","container1","container2","preventFunc","onpointerdown","onmousedown","thumbDimensions","thumb","thc","ondblclick","opacityLabel","textDecoration","isLast","onpointerover","largeThumbCanvas","largeThumbDiv","largeThumbInDocument","largeThumbInTimeout","largeThumbTimeout","onpointerout","dragstart","freshSelection","isSelected","activateLayer","newSpot","oldSpot","updateButtons","maxReached","oneLayer","addBtn","removeBtn","duplicateBtn","moreDropdown","activeLayerSpotIndex","getSelected","spotIndex","listDiv","renameBtn","newIndex","createButtons","topCanvas","spacer","alphaCanvas","bottomCanvas","historyState","klHistory","$db287580a54bd175$export$ce26cd3db18613a3","submitButton","onSubmit","leftRightButton","$7f838dbc615d3028$export$94ec999f33a691e3","setPostMix","postMix","textureSource","fxCanvas","oldOnUpdateProps","textureWidth","textureHeight","viewportWidth","viewportHeight","clippedViewportRect","viewportMat","topLeft","bottomRight","original","clippedTL","clippedBR","resultTransform","onUpdateProps","tlOffsetX","tlOffsetY","canvasTopLeft","canvasBottomRight","cw","resultFx","operation","$160131d78cb8ea88$export$4300cf0a0df418a6","$160131d78cb8ea88$export$1c43bf66c2a2e4da","p0","getModeButtons","modeButtons","areaH","areaW","curveArea","createPoint","lock","internalY","internalX","pointEl","newX","newY","updateControl","outCurves","drawCurve","spline","$db258f044f5ffd5c$export$b1241e74876d9bbe","leftTab","rightTab","$d90200485e14eee7$export$87247fc399965417","$d90200485e14eee7$var$SIZE","$2f1731fd923717a5$exports","$074907f5bc61bd8c$export$20d2db9c68afeac","cellsX","cellsY","thickness","thickIsRound","$f4f1194f773d88e8$var$presetArr","$f4f1194f773d88e8$var$drawNoise","$0fd8ddcd0821b85a$var$drawPattern","blendOffsetX","blend","blendOffsetY","finalPatternCanvas","blendCanvas","blendCtx","colTransparent","colOpaque","blendGradient","$9ccc4f1680c2a511$export$8f57d6bdbceb36d0","degIncrement","$a5bdfa66fb1ba8cd$var$importFilter","libObj","moduleObj","$3ccac2760787e643$export$92433b641be3f7a","agPsd","$2d79f7f8e2e2d334$export$c57e2ed65bcf4d6a","lastMixedInput","inputX","inputY","inputPressure","setSmoothing","$b47927ff4e129b10$export$91dcf4209534d21f","$b2e5423e81cbdb22$export$bcd109042a2e4bb5","$8edbd5a1c1dde18e$export$4ccbb8938b9d5723","importFinishedLoading","importedImage","getResizedDimensions","klMaxCanvasSize","importAsImage","resizedDimensions","tempCanvas","tempCanvasCtx","setCurrentLayer","importAsImagePsd","convertedPsdObj","cropCanvas","importAsLayer","isPixelated","activeLayerIndex","activeLayerContext","onPaste","clipboardData","retrieveImageFromClipboardAsBlob","getAsFile","imageBlob","URLObj","webkitURL","getAsString","pasteStr","log","crossOrigin","onColor","handleFileSelect","showWarningPsdFlattened","hasUnsupportedFile","nameSplit","extension","closeLoader","doShowLoader","loaderIsOpen","reader","FileReader","readerResult","psd","readPsd","skipLayerImageData","skipThumbnail","skipCompositeImageData","convertedPsd","readAsArrayBuffer","$6d04bb35ac2352cf$exports","$5ad3867a8e2df089$exports","selectedLayerIndex","fxPreviewRenderer","brightnessSlider","contrastSlider","previewFactor","leftChanged","rightChanged","topChanged","bottomChanged","lrWrapper","tbWrapper","leftInput","updateInput","rightInput","topInput","bottomInput","labelStyle","cropper","useRuleOfThirds","ruleOThirdsCheckbox","selectedRgbaObj","bgColorOverlay","flexRow","previewHeight","offsetWrapper","updateIsDark","doFlipCanvas","horizontalCheckbox","verticalCheckbox","targetOptions","previewLayer","klCanvasPreview","previewInnerWrapper","horizontal","vertical","flipCanvas","hueSlider","saturationSlider","isBefore","getFlatArr","beforeInputs","afterInputs","rectPoints","flatMap","beforeAfterTabs","widthWrapper","heightWrapper","inputWrapper","constrainIm","constrainCheckbox","algorithmSelect","secondRowElement","previewW","previewH","canvasWrapper","btnPlus","btnMinus","previewcell","fa","fb","gradientSlider","blurSlider","onInputsChanged","leftWrapper","rightWrapper","rotWrapper","inputR","inputRow","actionBtnCss","buttonRow","flipXBtn","flipYBtn","scaleRotLeftBtn","scaleRotRightBtn","scaleDoubleBtn","scaleHalfBtn","isSnapping","snappingCheckbox","checkboxWrapper","lastDrawnTransformStr","radiusSlider","strengthSlider","sourceId","sourceOptions","settingsObj","line1","line2","xInput","yInput","thicknessInput","thumbImgArr","preset","thumbImg","presetCopy","presetIndex","presetOptions","row1El","row2El","channelsOptions","blendSelect","mixModes","colInputStyle","colAInput","newColor","colBInput","settingsCopy","lastDrawnSettings","inputStyle","previewMode","overlayCanvas","renderW","renderH","mixBlendMode","syncInputs","oldSettings","fullSizeCanvas","fullSizeCtx","sharpStrokeRect","drawX","drawY","drawWidth","drawHeight","pW","pH","overlayCtx","isSynced","thumbSize","topRowEl","sync","sliderArr","syncToggle","xyRowEl","leftCol","rightCol","sliderWidth","phaseSlider","stepSlider","scaledSettings","linesSlider","dragInput","onRender","$b7af2ed4a75d4700$export$96f6458b62e4c2c","updateCollapse","uiWidth","collapseThreshold","toolspaceCollapser","toolWidth","uiHeight","updateBottomBar","bottomBar","newDisplay","toolspaceInner","bottomBarWrapper","toolspaceScroller","toolspaceToolRow","getPNG","swapUiLeftRight","embed","saveAsPsd","saveToComputer","lineSanitizer","pProject","pOptions","currentBrushUi","currentBrushId","lastNonEraserBrushId","overlayToolspace","toolspaceTopRow","mainTabRow","getPSD","Brush","currentLayerCtx","getNextBrushId","sizeWatcher","lineSmoothing","drawEventChain","textToolSettings","isDragDone","canvasX","canvasY","fillUi","gradientTool","shapeTool","viewChangeObj","undoRedoCatchup","updateMainTabVisibility","oldTabId","keysArr","copyToClipboard","brushTabRow","prevMode","newMode","brushUi","ui","onFailure","saveBtn","showNewImageDialog","fileTab","shareImage","p_color","doPick","setCurrentBrush","brushId","brushDiv","toolspaceStabilizerRow","gradientUi","textUi","shapeUi","isDone","filterTab","showCrop","inputObj","optionsStr","importHandler","app","settingsTab","aboutEl","info","help","windowResizeWatcher","ResizeObserver","prevent","$8e7310a6fc595c9c$var$initError","errorMsg","klApp","domIsLoaded","onDomLoaded","onProjectLoaded","loadingScreenEl","getElementById","klecks","COMMENT","PAGE","MEDIA","IMPORT","CHARSET","SUPPORTS","DOCUMENT","NAMESPACE","FONT_FACE","COUNTER_STYLE","FONT_FEATURE_VALUES","LAYER","replacement","substr","sizeof","characters","char","prev","caret","delimiter","tokenize","tokenizer","whitespace","escaping","commenter","rulesets","pseudo","declarations","atrule","variable","scanning","ampersand","reference","comment","declaration","ruleset","post","prefix","some","collection","prefixer","namespace"],"version":3,"file":"index.ab1dda3d.js.map"}